# Next.js Analytics â€” Deep Dive!

> **Chá»§ Ä‘á»**: Analytics â€” Äo lÆ°á»ng & theo dÃµi hiá»‡u nÄƒng trong Next.js
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/guides/analytics
> **LÆ°u Ã½**: Trang gá»‘c KHÃ”NG cÃ³ sÆ¡ Ä‘á»“ â€” táº¥t cáº£ diagrams dÆ°á»›i Ä‘Ã¢y lÃ  Tá»° Váº¼!

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Analytics LÃ  GÃ¬?](#1)
2. [Â§2. Web Vitals â€” 6 Metrics Cá»‘t LÃµi](#2)
3. [Â§3. Client Instrumentation â€” instrumentation-client.ts](#3)
4. [Â§4. Build Your Own â€” useReportWebVitals](#4)
5. [Â§5. Sending Results â€” Gá»­i Dá»¯ Liá»‡u Ra NgoÃ i](#5)
6. [Â§6. Google Analytics Integration](#6)
7. [Â§7. SÆ¡ Äá»“ Tá»•ng Há»£p â€” Analytics Pipeline](#7)
8. [Â§8. Vercel Analytics vs Self-Hosted](#8)
9. [Â§9. Tá»± Viáº¿t â€” WebVitalsEngine](#9)
10. [Â§10. CÃ¢u Há»i Luyá»‡n Táº­p](#10)

---

## Â§1. Tá»•ng Quan â€” Analytics LÃ  GÃ¬?

```
  ANALYTICS TRONG NEXT.JS â€” Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  ANALYTICS = ÄO LÆ¯á»œNG HIá»†U NÄ‚NG TRANG WEB!           â”‚
  â”‚                                                        â”‚
  â”‚  Next.js cÃ³ Sáº´N há»— trá»£:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  useReportWebVitals hook                       â”‚  â”‚
  â”‚  â”‚    â†’ Tá»± quáº£n lÃ½ reporting!                      â”‚  â”‚
  â”‚  â”‚    â†’ Full control â€” gá»­i data báº¥t ká»³ Ä‘Ã¢u!       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ Vercel Analytics (managed service)            â”‚  â”‚
  â”‚  â”‚    â†’ Tá»± Ä‘á»™ng collect + visualize!               â”‚  â”‚
  â”‚  â”‚    â†’ Dashboard Ä‘áº¹p sáºµn!                         â”‚  â”‚
  â”‚  â”‚    â†’ KhÃ´ng cáº§n code nhiá»u!                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ instrumentation-client.ts (advanced)          â”‚  â”‚
  â”‚  â”‚    â†’ Code cháº¡y TRÆ¯á»šC app start!                 â”‚  â”‚
  â”‚  â”‚    â†’ Setup global analytics/error tracking!     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO Cáº¦N ANALYTICS?                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Biáº¿t trang táº£i NHANH hay CHáº¬M!               â”‚  â”‚
  â”‚  â”‚  â†’ Biáº¿t user experience Tá»T hay Xáº¤U!            â”‚  â”‚
  â”‚  â”‚  â†’ Google dÃ¹ng Web Vitals Ä‘á»ƒ Xáº¾P Háº NG SEO!     â”‚  â”‚
  â”‚  â”‚  â†’ Debug performance issues!                     â”‚  â”‚
  â”‚  â”‚  â†’ A/B testing hiá»‡u quáº£!                        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Web Vitals â€” 6 Metrics Cá»‘t LÃµi!

```
  WEB VITALS â€” 6 METRICS CHÃNH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Web Vitals = Bá»™ metrics do Google Ä‘á»‹nh nghÄ©a!        â”‚
  â”‚  â†’ Äo lÆ°á»ng USER EXPERIENCE thá»±c táº¿!                  â”‚
  â”‚  â†’ Next.js Ä‘o ALL 6 metrics!                          â”‚
  â”‚                                                        â”‚
  â”‚  â‘  TTFB â€” Time to First Byte:                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ First Byte received     â”‚  â”‚
  â”‚  â”‚  â†â”€â”€â”€ TTFB (ms) â”€â”€â”€â†’                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Thá»i gian tá»« request â†’ nháº­n byte Ä‘áº§u tiÃªn   â”‚  â”‚
  â”‚  â”‚  â†’ Äo SERVER response time!                     â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 800ms                                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ FCP â€” First Contentful Paint:                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Navigation â”€â”€â†’ First text/image painted         â”‚  â”‚
  â”‚  â”‚  â†â”€â”€â”€ FCP (ms) â”€â”€â†’                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Thá»i gian Ä‘áº¿n khi Ná»˜I DUNG Äáº¦U TIÃŠN hiá»‡n!  â”‚  â”‚
  â”‚  â”‚  â†’ Text, image, SVG, canvas (non-white)          â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 1.8s                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ LCP â€” Largest Contentful Paint:                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Navigation â”€â”€â”€â”€â†’ Largest element painted        â”‚  â”‚
  â”‚  â”‚  â†â”€â”€â”€â”€ LCP (ms) â”€â”€â”€â”€â†’                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Thá»i gian Ä‘áº¿n khi PHáº¦N Tá»¬ Lá»šN NHáº¤T render! â”‚  â”‚
  â”‚  â”‚  â†’ Hero image, heading text, video poster       â”‚  â”‚
  â”‚  â”‚  â†’ Core Web Vital! â­                            â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 2.5s                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ FID â€” First Input Delay:                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  User click â”€â”€â†’ Browser processes event          â”‚  â”‚
  â”‚  â”‚  â†â”€â”€ FID (ms) â”€â”€â†’                                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Äá»™ trá»… tá»« user tÆ°Æ¡ng tÃ¡c â†’ browser xá»­ lÃ½!   â”‚  â”‚
  â”‚  â”‚  â†’ Click, tap, keypress láº§n Äáº¦U TIÃŠN!          â”‚  â”‚
  â”‚  â”‚  â†’ ÄÃ£ bá»‹ thay tháº¿ bá»Ÿi INP!                     â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 100ms                                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ CLS â€” Cumulative Layout Shift:                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
  â”‚  â”‚  â”‚ Button â”‚ â†’   â”‚ Button â”‚  â† Shift!            â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
  â”‚  â”‚  â†â”€â”€ CLS (score) â”€â”€â†’                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Äo má»©c Ä‘á»™ NHáº¢Y/Dá»ŠCH CHUYá»‚N layout!          â”‚  â”‚
  â”‚  â”‚  â†’ Unexpected shifts = user MIS-CLICK!          â”‚  â”‚
  â”‚  â”‚  â†’ Core Web Vital! â­                            â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 0.1                                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ INP â€” Interaction to Next Paint:                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  User interaction â”€â”€â†’ Visual update shown        â”‚  â”‚
  â”‚  â”‚  â†â”€â”€â”€â”€ INP (ms) â”€â”€â”€â”€â†’                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Äo TOÃ€N Bá»˜ interactions (khÃ´ng chá»‰ first!)  â”‚  â”‚
  â”‚  â”‚  â†’ Click, tap, keypress â†’ khi nÃ o UI update?   â”‚  â”‚
  â”‚  â”‚  â†’ Core Web Vital! â­ (thay tháº¿ FID!)           â”‚  â”‚
  â”‚  â”‚  â†’ Tá»‘t: < 200ms                                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  TIMELINE:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Request  TTFB  FCP    LCP                       â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚     â”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”‚ Server  â”‚     â”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”‚ process â”‚     â”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚Firstâ”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚paintâ”‚      â”‚                        â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤                        â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚     â”‚Largest                        â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚     â”‚paint â”‚                        â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â† Loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â† Interactive â”€â”€â†’        â”‚  â”‚
  â”‚  â”‚                     FID/INP                      â”‚  â”‚
  â”‚  â”‚                     CLS (throughout!)            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CORE WEB VITALS (Google Ranking!):                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Metric   â”‚ Tá»‘t           â”‚ Cáº§n cáº£i thiá»‡n         â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ LCP â­   â”‚ â‰¤ 2.5s        â”‚ > 4.0s = KÃ©m!        â”‚  â”‚
  â”‚  â”‚ INP â­   â”‚ â‰¤ 200ms       â”‚ > 500ms = KÃ©m!       â”‚  â”‚
  â”‚  â”‚ CLS â­   â”‚ â‰¤ 0.1         â”‚ > 0.25 = KÃ©m!        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Client Instrumentation â€” instrumentation-client.ts!

```
  CLIENT INSTRUMENTATION â€” CHáº Y TRÆ¯á»šC APP START:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  instrumentation-client.ts LÃ€ GÃŒ?                     â”‚
  â”‚  â†’ File CHáº Y TRÆ¯á»šC khi frontend code start!          â”‚
  â”‚  â†’ Setup GLOBAL analytics, error tracking!            â”‚
  â”‚  â†’ LÃ½ tÆ°á»Ÿng cho: performance monitoring tools!        â”‚
  â”‚                                                        â”‚
  â”‚  LIFECYCLE:                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Browser táº£i trang                               â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  â‘  instrumentation-client.ts CHáº Y Äáº¦U TIÃŠN!     â”‚  â”‚
  â”‚  â”‚    â†’ Setup analytics                             â”‚  â”‚
  â”‚  â”‚    â†’ Setup error tracking                        â”‚  â”‚
  â”‚  â”‚    â†’ Setup performance monitoring                â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  â‘¡ React hydration / app code                    â”‚  â”‚
  â”‚  â”‚    â†’ Components render                           â”‚  â”‚
  â”‚  â”‚    â†’ useEffect runs                              â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  â‘¢ App interactive!                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Vá»Š TRÃ FILE:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  my-project/                                     â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ app/                                        â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ instrumentation-client.ts  â† Äáº¶T á» ÄÃ‚Y!  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ package.json                                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CODE MáºªU:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // instrumentation-client.ts                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // â‘  Initialize analytics TRÆ¯á»šC app start      â”‚  â”‚
  â”‚  â”‚  console.log('Analytics initialized')            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // â‘¡ Setup global error tracking                â”‚  â”‚
  â”‚  â”‚  window.addEventListener('error', (event) => {   â”‚  â”‚
  â”‚  â”‚    // Gá»­i Ä‘áº¿n error tracking service!            â”‚  â”‚
  â”‚  â”‚    reportError(event.error)                      â”‚  â”‚
  â”‚  â”‚  })                                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO CHáº Y TRÆ¯á»šC?                                   â”‚
  â”‚  â†’ Báº¯t errors NGAY Tá»ª Äáº¦U (ká»ƒ cáº£ hydration errors!) â”‚
  â”‚  â†’ Analytics sáºµn sÃ ng TRÆ¯á»šC khi user tÆ°Æ¡ng tÃ¡c!      â”‚
  â”‚  â†’ KhÃ´ng bá» lá»¡ báº¥t ká»³ event nÃ o!                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Build Your Own â€” useReportWebVitals!

```
  BUILD YOUR OWN â€” useReportWebVitals HOOK:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 1: Táº¡o WebVitals component (Client Component!)  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // app/_components/web-vitals.tsx               â”‚  â”‚
  â”‚  â”‚  'use client'    â† Báº®T BUá»˜C!                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  import { useReportWebVitals }                   â”‚  â”‚
  â”‚  â”‚    from 'next/web-vitals'                        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  export function WebVitals() {                   â”‚  â”‚
  â”‚  â”‚    useReportWebVitals((metric) => {              â”‚  â”‚
  â”‚  â”‚      console.log(metric)                         â”‚  â”‚
  â”‚  â”‚      // metric object:                           â”‚  â”‚
  â”‚  â”‚      // {                                        â”‚  â”‚
  â”‚  â”‚      //   name: 'LCP',                           â”‚  â”‚
  â”‚  â”‚      //   value: 1234.56,                        â”‚  â”‚
  â”‚  â”‚      //   id: 'v3-1234567890',                   â”‚  â”‚
  â”‚  â”‚      //   delta: 1234.56,                        â”‚  â”‚
  â”‚  â”‚      //   entries: [...]                         â”‚  â”‚
  â”‚  â”‚      // }                                        â”‚  â”‚
  â”‚  â”‚    })                                            â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 2: Import vÃ o Root Layout!                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // app/layout.tsx                               â”‚  â”‚
  â”‚  â”‚  import { WebVitals }                            â”‚  â”‚
  â”‚  â”‚    from './_components/web-vitals'               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  export default function Layout({ children }) {  â”‚  â”‚
  â”‚  â”‚    return (                                      â”‚  â”‚
  â”‚  â”‚      <html>                                      â”‚  â”‚
  â”‚  â”‚        <body>                                    â”‚  â”‚
  â”‚  â”‚          <WebVitals />  â† Äáº¶T á» ÄÃ‚Y!          â”‚  â”‚
  â”‚  â”‚          {children}                              â”‚  â”‚
  â”‚  â”‚        </body>                                   â”‚  â”‚
  â”‚  â”‚      </html>                                     â”‚  â”‚
  â”‚  â”‚    )                                             â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO TÃCH COMPONENT RIÃŠNG?                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  useReportWebVitals cáº§n 'use client'!            â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u Ä‘áº·t trá»±c tiáº¿p trong layout.tsx:          â”‚  â”‚
  â”‚  â”‚    â†’ TOÃ€N Bá»˜ layout pháº£i lÃ  Client Component!   â”‚  â”‚
  â”‚  â”‚    â†’ Máº¥t lá»£i tháº¿ Server Component!              â”‚  â”‚
  â”‚  â”‚  â†’ TÃ¡ch ra WebVitals component riÃªng:           â”‚  â”‚
  â”‚  â”‚    â†’ CHá»ˆ WebVitals lÃ  Client Component!         â”‚  â”‚
  â”‚  â”‚    â†’ Layout váº«n lÃ  Server Component!            â”‚  â”‚
  â”‚  â”‚    â†’ Client boundary bá»‹ GIá»šI Háº N!              â”‚  â”‚
  â”‚  â”‚    â†’ âœ… PERFORMANT nháº¥t!                        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  layout.tsx (Server Component âœ…)          â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚ WebVitals (Client Component ğŸ”¶)   â”‚    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚ â† Client boundary CHá»ˆ á»Ÿ Ä‘Ã¢y!      â”‚    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  {children} â† Server Components!          â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Xá»¬ LÃ THEO METRIC NAME:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  useReportWebVitals((metric) => {                â”‚  â”‚
  â”‚  â”‚    switch (metric.name) {                        â”‚  â”‚
  â”‚  â”‚      case 'FCP':                                 â”‚  â”‚
  â”‚  â”‚        // First Contentful Paint                 â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚      case 'LCP':                                 â”‚  â”‚
  â”‚  â”‚        // Largest Contentful Paint               â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚      case 'CLS':                                 â”‚  â”‚
  â”‚  â”‚        // Cumulative Layout Shift                â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚      case 'INP':                                 â”‚  â”‚
  â”‚  â”‚        // Interaction to Next Paint              â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚      case 'TTFB':                                â”‚  â”‚
  â”‚  â”‚        // Time to First Byte                     â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚      case 'FID':                                 â”‚  â”‚
  â”‚  â”‚        // First Input Delay (legacy)             â”‚  â”‚
  â”‚  â”‚        break                                     â”‚  â”‚
  â”‚  â”‚    }                                             â”‚  â”‚
  â”‚  â”‚  })                                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Sending Results â€” Gá»­i Dá»¯ Liá»‡u Ra NgoÃ i!

```
  SENDING RESULTS â€” Gá»¬I DATA ANALYTICS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CÆ  CHáº¾ Gá»¬I: sendBeacon() â†’ fallback fetch()          â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  useReportWebVitals((metric) => {                â”‚  â”‚
  â”‚  â”‚    const body = JSON.stringify(metric)            â”‚  â”‚
  â”‚  â”‚    const url = 'https://example.com/analytics'   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    if (navigator.sendBeacon) {                   â”‚  â”‚
  â”‚  â”‚      // â‘  Æ¯UÃŠN: sendBeacon!                     â”‚  â”‚
  â”‚  â”‚      navigator.sendBeacon(url, body)             â”‚  â”‚
  â”‚  â”‚    } else {                                      â”‚  â”‚
  â”‚  â”‚      // â‘¡ FALLBACK: fetch!                      â”‚  â”‚
  â”‚  â”‚      fetch(url, {                                â”‚  â”‚
  â”‚  â”‚        body,                                     â”‚  â”‚
  â”‚  â”‚        method: 'POST',                           â”‚  â”‚
  â”‚  â”‚        keepalive: true  â† QUAN TRá»ŒNG!           â”‚  â”‚
  â”‚  â”‚      })                                          â”‚  â”‚
  â”‚  â”‚    }                                             â”‚  â”‚
  â”‚  â”‚  })                                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO sendBeacon?                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  sendBeacon vs fetch:                            â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
  â”‚  â”‚  â”‚             â”‚ sendBeacon   â”‚ fetch        â”‚   â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚
  â”‚  â”‚  â”‚ Page close  â”‚ âœ… Gá»­i Ä‘Æ°á»£c! â”‚ âŒ Bá»‹ cancel â”‚   â”‚  â”‚
  â”‚  â”‚  â”‚ Block UI    â”‚ âŒ KhÃ´ng     â”‚ âŒ KhÃ´ng     â”‚   â”‚  â”‚
  â”‚  â”‚  â”‚ Async       â”‚ âœ… Fire&forgetâ”‚ âœ… Promise  â”‚   â”‚  â”‚
  â”‚  â”‚  â”‚ Size limit  â”‚ ~64KB        â”‚ Unlimited    â”‚   â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ sendBeacon Gá»¬I ÄÆ¯á»¢C khi user Ä‘Ã³ng tab!      â”‚  â”‚
  â”‚  â”‚  â†’ fetch + keepalive = giá»‘ng sendBeacon!         â”‚  â”‚
  â”‚  â”‚  â†’ keepalive: true = request sá»‘ng sÃ³t sau close!â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  FLOW Gá»¬I DATA:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Browser Ä‘o metrics                              â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  useReportWebVitals callback                     â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ JSON.stringify(metric)                     â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ navigator.sendBeacon cÃ³?                  â”‚  â”‚
  â”‚  â”‚    â”‚   â”œâ”€â”€ âœ… â†’ sendBeacon(url, body)            â”‚  â”‚
  â”‚  â”‚    â”‚   â””â”€â”€ âŒ â†’ fetch(url, { keepalive })        â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  Server endpoint nháº­n data                       â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ LÆ°u database                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ Aggregate/analyze                         â”‚  â”‚
  â”‚  â”‚    â””â”€â”€ Visualize trÃªn dashboard                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Google Analytics Integration!

```
  GOOGLE ANALYTICS â€” TÃCH Há»¢P:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CODE MáºªU:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  useReportWebVitals((metric) => {                â”‚  â”‚
  â”‚  â”‚    window.gtag('event', metric.name, {           â”‚  â”‚
  â”‚  â”‚      value: Math.round(                          â”‚  â”‚
  â”‚  â”‚        metric.name === 'CLS'                     â”‚  â”‚
  â”‚  â”‚          ? metric.value * 1000  â† CLS nhÃ¢n 1000!â”‚  â”‚
  â”‚  â”‚          : metric.value                          â”‚  â”‚
  â”‚  â”‚      ),                                          â”‚  â”‚
  â”‚  â”‚      event_label: metric.id,   â† ID unique!     â”‚  â”‚
  â”‚  â”‚      non_interaction: true,    â† KhÃ´ng áº£nh hÆ°á»Ÿngâ”‚  â”‚
  â”‚  â”‚                                    bounce rate!  â”‚  â”‚
  â”‚  â”‚    })                                            â”‚  â”‚
  â”‚  â”‚  })                                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  PHÃ‚N TÃCH Tá»ªNG FIELD:                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  window.gtag('event', metric.name, {...})     â”‚  â”‚
  â”‚  â”‚    â†’ gtag = Google Analytics function!           â”‚  â”‚
  â”‚  â”‚    â†’ 'event' = send custom event!               â”‚  â”‚
  â”‚  â”‚    â†’ metric.name = 'LCP', 'FCP', 'CLS'...      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ value: Math.round(...)                        â”‚  â”‚
  â”‚  â”‚    â†’ GA4 yÃªu cáº§u INTEGER!                       â”‚  â”‚
  â”‚  â”‚    â†’ CLS * 1000 vÃ¬ CLS ráº¥t nhá» (0.05, 0.12)   â”‚  â”‚
  â”‚  â”‚    â†’ NhÃ¢n 1000 Ä‘á»ƒ cÃ³ integer cÃ³ Ã½ nghÄ©a!       â”‚  â”‚
  â”‚  â”‚    â†’ CÃ¡c metric khÃ¡c Ä‘Ã£ lÃ  ms (integer)         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ event_label: metric.id                        â”‚  â”‚
  â”‚  â”‚    â†’ ID unique cho Má»–I page load!               â”‚  â”‚
  â”‚  â”‚    â†’ Format: 'v3-1234567890-1:2345'             â”‚  â”‚
  â”‚  â”‚    â†’ DÃ¹ng Ä‘á»ƒ tÃ­nh percentiles (P75, P95)!       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘£ non_interaction: true                         â”‚  â”‚
  â”‚  â”‚    â†’ Analytics event KHÃ”NG tÃ­nh lÃ  interaction!  â”‚  â”‚
  â”‚  â”‚    â†’ Náº¿u false â†’ áº£nh hÆ°á»Ÿng bounce rate!        â”‚  â”‚
  â”‚  â”‚    â†’ User vÃ o trang, metrics gá»­i tá»± Ä‘á»™ng       â”‚  â”‚
  â”‚  â”‚    â†’ KHÃ”NG nÃªn tÃ­nh lÃ  "user tÆ°Æ¡ng tÃ¡c"         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. SÆ¡ Äá»“ Tá»•ng Há»£p â€” Analytics Pipeline!

```
  ANALYTICS PIPELINE â€” TOÃ€N Bá»˜ FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  BROWSER (Client-side):                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  instrumentation-client.ts                       â”‚  â”‚
  â”‚  â”‚  â†’ Setup global error tracking                   â”‚  â”‚
  â”‚  â”‚  â†’ cháº¡y TRÆ¯á»šC React!                            â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  React App starts                                â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  WebVitals component mounts                      â”‚  â”‚
  â”‚  â”‚  â†’ useReportWebVitals registers                  â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  Browser Ä‘o metrics liÃªn tá»¥c:                    â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
  â”‚  â”‚  â”‚ TTFB    â”‚ FCP     â”‚ LCP     â”‚                â”‚  â”‚
  â”‚  â”‚  â”‚ (early) â”‚ (paint) â”‚ (paint) â”‚                â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚  â”‚
  â”‚  â”‚  â”‚ FID     â”‚ CLS     â”‚ INP     â”‚                â”‚  â”‚
  â”‚  â”‚  â”‚ (input) â”‚ (shift) â”‚ (inter) â”‚                â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â–¼                                              â”‚  â”‚
  â”‚  â”‚  Má»—i metric ready â†’ callback fires!             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚             â”‚                                          â”‚
  â”‚             â–¼                                          â”‚
  â”‚  â‘¡ TRANSPORT:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  sendBeacon(url, JSON.stringify(metric))          â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ OR â”€â”€â”˜                                      â”‚  â”‚
  â”‚  â”‚  fetch(url, { method:'POST', keepalive:true })   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚             â”‚                                          â”‚
  â”‚             â–¼                                          â”‚
  â”‚  â‘¢ SERVER (Your analytics endpoint):                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  POST /analytics                                 â”‚  â”‚
  â”‚  â”‚  Body: {                                         â”‚  â”‚
  â”‚  â”‚    name: 'LCP',                                  â”‚  â”‚
  â”‚  â”‚    value: 1234,                                  â”‚  â”‚
  â”‚  â”‚    id: 'v3-xxx',                                 â”‚  â”‚
  â”‚  â”‚    delta: 1234                                   â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚    â”‚                                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ LÆ°u database                              â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ TÃ­nh percentiles (P75, P95)              â”‚  â”‚
  â”‚  â”‚    â””â”€â”€ Visualize trÃªn dashboard!                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Vercel Analytics vs Self-Hosted!

```
  SO SÃNH: VERCEL ANALYTICS vs SELF-HOSTED:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚              â”‚ Vercel          â”‚ Self-hosted      â”‚  â”‚
  â”‚  â”‚              â”‚ Analytics       â”‚ (Build Your Own) â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Setup        â”‚ 1 line code     â”‚ Component +      â”‚  â”‚
  â”‚  â”‚              â”‚ @vercel/        â”‚ endpoint + DB    â”‚  â”‚
  â”‚  â”‚              â”‚ analytics       â”‚                  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Dashboard    â”‚ âœ… Built-in     â”‚ âŒ Tá»± build     â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Data control â”‚ Vercel servers  â”‚ âœ… 100% control â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Cost         â”‚ Free tier +     â”‚ Infrastructure   â”‚  â”‚
  â”‚  â”‚              â”‚ paid plans      â”‚ cost only        â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Flexibility  â”‚ Opinionated     â”‚ âœ… Full custom  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Integration  â”‚ Google Analyticsâ”‚ Báº¥t ká»³ endpoint â”‚  â”‚
  â”‚  â”‚              â”‚ supported       â”‚ báº¡n muá»‘n!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  KHI NÃ€O DÃ™NG GÃŒ?                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  âœ… Vercel Analytics:                            â”‚  â”‚
  â”‚  â”‚  â†’ Muá»‘n nhanh, khÃ´ng cáº§n custom!               â”‚  â”‚
  â”‚  â”‚  â†’ ÄÃ£ deploy trÃªn Vercel!                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… Self-hosted (useReportWebVitals):            â”‚  â”‚
  â”‚  â”‚  â†’ Cáº§n full data control!                       â”‚  â”‚
  â”‚  â”‚  â†’ Custom analytics pipeline!                    â”‚  â”‚
  â”‚  â”‚  â†’ Gá»­i Ä‘áº¿n Google Analytics, Datadog, etc.      â”‚  â”‚
  â”‚  â”‚  â†’ Privacy-sensitive (GDPR)!                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Tá»± Viáº¿t â€” WebVitalsEngine!

```javascript
var WebVitalsEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. METRIC DEFINITIONS
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var METRICS = {
    TTFB: {
      name: "TTFB",
      fullName: "Time to First Byte",
      good: 800,
      poor: 1800,
      unit: "ms",
    },
    FCP: {
      name: "FCP",
      fullName: "First Contentful Paint",
      good: 1800,
      poor: 3000,
      unit: "ms",
    },
    LCP: {
      name: "LCP",
      fullName: "Largest Contentful Paint",
      good: 2500,
      poor: 4000,
      unit: "ms",
    },
    FID: {
      name: "FID",
      fullName: "First Input Delay",
      good: 100,
      poor: 300,
      unit: "ms",
    },
    CLS: {
      name: "CLS",
      fullName: "Cumulative Layout Shift",
      good: 0.1,
      poor: 0.25,
      unit: "score",
    },
    INP: {
      name: "INP",
      fullName: "Interaction to Next Paint",
      good: 200,
      poor: 500,
      unit: "ms",
    },
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. RATING
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function rateMetric(name, value) {
    var def = METRICS[name];
    if (!def) return "unknown";
    if (value <= def.good) return "good";
    if (value <= def.poor) return "needs-improvement";
    return "poor";
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. METRIC COLLECTOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function createCollector() {
    var collected = [];
    var callbacks = [];

    function report(metric) {
      var rated = {
        name: metric.name,
        value: metric.value,
        id: "v3-" + Date.now() + "-" + Math.random().toString(36).substr(2, 5),
        delta: metric.value,
        rating: rateMetric(metric.name, metric.value),
      };
      collected.push(rated);

      // Notify all registered callbacks
      for (var i = 0; i < callbacks.length; i++) {
        callbacks[i](rated);
      }
    }

    function onReport(callback) {
      callbacks.push(callback);
    }

    function getAll() {
      return collected.slice();
    }

    return {
      report: report,
      onReport: onReport,
      getAll: getAll,
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. TRANSPORT (sendBeacon simulation)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function createTransport(endpointUrl) {
    var sent = [];

    function send(metric) {
      var body = JSON.stringify(metric);

      // Simulate sendBeacon / fetch
      console.log(
        "  [SEND] " + metric.name + "=" + metric.value + " â†’ " + endpointUrl,
      );
      sent.push({ url: endpointUrl, body: body, timestamp: Date.now() });
    }

    function getSent() {
      return sent.slice();
    }

    return { send: send, getSent: getSent };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. GOOGLE ANALYTICS FORMATTER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function formatForGA(metric) {
    return {
      event: metric.name,
      value: Math.round(
        metric.name === "CLS" ? metric.value * 1000 : metric.value,
      ),
      event_label: metric.id,
      non_interaction: true,
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 6. DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘ WEB VITALS ENGINE                     â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // Create collector + transport
    var collector = createCollector();
    var transport = createTransport("https://example.com/analytics");

    // Register callback (like useReportWebVitals)
    collector.onReport(function (metric) {
      console.log(
        "\n  [METRIC] " +
          metric.name +
          " = " +
          metric.value +
          " (" +
          metric.rating +
          ")",
      );

      // Send to external system
      transport.send(metric);

      // Format for Google Analytics
      var ga = formatForGA(metric);
      console.log(
        '  [GA4] gtag("event", "' +
          ga.event +
          '", { value: ' +
          ga.value +
          " })",
      );
    });

    // Simulate browser measuring metrics
    console.log("\nâ”â”â” Simulating Page Load â”â”â”");

    collector.report({ name: "TTFB", value: 230 });
    collector.report({ name: "FCP", value: 1200 });
    collector.report({ name: "LCP", value: 2100 });
    collector.report({ name: "CLS", value: 0.05 });
    collector.report({ name: "INP", value: 150 });
    collector.report({ name: "FID", value: 45 });

    // Summary
    console.log("\nâ”â”â” Summary â”â”â”");
    var all = collector.getAll();
    for (var i = 0; i < all.length; i++) {
      var m = all[i];
      var icon =
        m.rating === "good"
          ? "âœ…"
          : m.rating === "needs-improvement"
            ? "âš ï¸"
            : "âŒ";
      console.log(
        "  " + icon + " " + m.name + ": " + m.value + " (" + m.rating + ")",
      );
    }

    console.log("\n  Total metrics sent: " + transport.getSent().length);
  }

  return { demo: demo, METRICS: METRICS };
})();
// Cháº¡y: WebVitalsEngine.demo();
```

---

## Â§10. CÃ¢u Há»i Luyá»‡n Táº­p!

**CÃ¢u 1**: Giáº£i thÃ­ch 3 Core Web Vitals vÃ  ngÆ°á»¡ng "tá»‘t" cá»§a chÃºng.

<details><summary>ÄÃ¡p Ã¡n</summary>

3 **Core Web Vitals** (áº£nh hÆ°á»Ÿng Google SEO ranking!):

| Metric  | Äo gÃ¬?                                | Tá»‘t     | Cáº§n cáº£i thiá»‡n | KÃ©m     |
| ------- | ------------------------------------- | ------- | ------------- | ------- |
| **LCP** | Thá»i gian render pháº§n tá»­ lá»›n nháº¥t     | â‰¤ 2.5s  | 2.5-4.0s      | > 4.0s  |
| **INP** | Äá»™ trá»… tá»« interaction â†’ visual update | â‰¤ 200ms | 200-500ms     | > 500ms |
| **CLS** | Má»©c Ä‘á»™ layout shift báº¥t ngá»           | â‰¤ 0.1   | 0.1-0.25      | > 0.25  |

**LCP** Ä‘o tá»‘c Ä‘á»™ táº£i (loading), **INP** Ä‘o kháº£ nÄƒng tÆ°Æ¡ng tÃ¡c (interactivity), **CLS** Ä‘o á»•n Ä‘á»‹nh visual (stability).

</details>

---

**CÃ¢u 2**: Táº¡i sao useReportWebVitals cáº§n 'use client' vÃ  nÃªn tÃ¡ch component riÃªng?

<details><summary>ÄÃ¡p Ã¡n</summary>

**Cáº§n 'use client'** vÃ¬:

- `useReportWebVitals` lÃ  React **hook** â†’ chá»‰ cháº¡y á»Ÿ client
- Hook cáº§n browser APIs (Performance Observer, PerformanceEntry)
- KhÃ´ng thá»ƒ Ä‘o web vitals á»Ÿ server (khÃ´ng cÃ³ browser!)

**NÃªn tÃ¡ch component riÃªng** vÃ¬:

- Náº¿u Ä‘áº·t trá»±c tiáº¿p trong `layout.tsx` â†’ layout pháº£i thÃªm `'use client'` â†’ **TOÃ€N Bá»˜** layout + children trá»Ÿ thÃ nh Client Components
- TÃ¡ch ra `WebVitals` component â†’ **CHá»ˆ** component Ä‘Ã³ lÃ  Client Component
- Layout váº«n lÃ  Server Component â†’ **client boundary giá»›i háº¡n** â†’ performant nháº¥t!

</details>

---

**CÃ¢u 3**: Táº¡i sao dÃ¹ng sendBeacon thay vÃ¬ fetch thÃ´ng thÆ°á»ng?

<details><summary>ÄÃ¡p Ã¡n</summary>

`navigator.sendBeacon()` cÃ³ Æ°u Ä‘iá»ƒm quan trá»ng:

1. **Gá»­i Ä‘Æ°á»£c khi user Ä‘Ã³ng tab/navigate away!** â€” fetch thÃ´ng thÆ°á»ng bá»‹ cancel khi page unload
2. **Asynchronous, fire-and-forget** â€” khÃ´ng block UI, khÃ´ng cáº§n await
3. **Designed for analytics** â€” W3C thiáº¿t káº¿ riÃªng cho use case nÃ y!

Fallback `fetch()` vá»›i `keepalive: true` hoáº¡t Ä‘á»™ng tÆ°Æ¡ng tá»± â€” request sá»‘ng sÃ³t sau page close. NhÆ°ng sendBeacon Ä‘Æ¡n giáº£n hÆ¡n (khÃ´ng cáº§n configure).

</details>

---

**CÃ¢u 4**: Táº¡i sao CLS value pháº£i nhÃ¢n 1000 khi gá»­i Ä‘áº¿n Google Analytics?

<details><summary>ÄÃ¡p Ã¡n</summary>

- CLS giÃ¡ trá»‹ ráº¥t nhá»: 0.05, 0.12, 0.001...
- Google Analytics yÃªu cáº§u `value` lÃ  **INTEGER** (sá»‘ nguyÃªn)!
- `Math.round(0.05)` = 0 â† máº¥t thÃ´ng tin!
- `Math.round(0.05 * 1000)` = 50 â† cÃ³ Ã½ nghÄ©a!

CÃ¡c metrics khÃ¡c (LCP, FCP, TTFB, INP, FID) Ä‘Ã£ lÃ  milliseconds (1234, 2100...) â†’ `Math.round()` trá»±c tiáº¿p Ä‘Ã£ cho integer cÃ³ Ã½ nghÄ©a.

</details>

---

**CÃ¢u 5**: So sÃ¡nh instrumentation-client.ts vá»›i useReportWebVitals â€” khi nÃ o dÃ¹ng gÃ¬?

<details><summary>ÄÃ¡p Ã¡n</summary>

|                 | `instrumentation-client.ts` | `useReportWebVitals` |
| --------------- | --------------------------- | -------------------- |
| **Cháº¡y khi**    | TRÆ¯á»šC React start           | SAU React mount      |
| **Scope**       | Global (toÃ n app)           | Per-component        |
| **Use case**    | Error tracking, SDK init    | Web Vitals metrics   |
| **React hook?** | âŒ KhÃ´ng (plain JS!)        | âœ… CÃ³ (hook)         |
| **Báº¯t errors**  | âœ… Cáº£ hydration errors!     | âŒ Sau mount thÃ´i    |

**Káº¿t há»£p cáº£ 2**:

- `instrumentation-client.ts` â†’ setup Sentry, global error tracking
- `useReportWebVitals` â†’ thu tháº­p vÃ  gá»­i Web Vitals metrics

</details>
