# HÃ nh TrÃ¬nh WebGPU Fluid â€” Tá»« WebGL Hack Äáº¿n Modern Graphics API

> PhÃ¢n tÃ­ch chuyÃªn sÃ¢u hÃ nh trÃ¬nh xÃ¢y dá»±ng fluid simulation trÃªn browser: tá»« WebGL hacks (13 nÄƒm), Ä‘áº¿n WebGPU vá»›i compute shaders, atomics, indirect dispatch. Bao gá»“m 4 giai Ä‘oáº¡n ká»¹ thuáº­t: Particle Simulation (SPH â†’ PBF), Marching Cubes, Rendering (VCT AO + SSS), vÃ  Composition.
> Äá»™ khÃ³: â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸ | Thá»i gian Ä‘á»c: ~25 phÃºt

---

## Má»¥c Lá»¥c

1. [Bá»‘i Cáº£nh â€” Táº¡i Sao WebGPU?](#1-bá»‘i-cáº£nh--táº¡i-sao-webgpu)
2. [WebGL vs WebGPU â€” Nhá»¯ng GÃ¬ ÄÃ£ Thay Äá»•i](#2-webgl-vs-webgpu--nhá»¯ng-gÃ¬-Ä‘Ã£-thay-Ä‘á»•i)
3. [Tá»•ng Quan Pipeline â€” 4 Giai Äoáº¡n](#3-tá»•ng-quan-pipeline--4-giai-Ä‘oáº¡n)
4. [Giai Äoáº¡n 1: Fluid Simulation (Particle)](#4-giai-Ä‘oáº¡n-1-fluid-simulation-particle)
5. [Giai Äoáº¡n 2: Marching Cubes (Geometry Generation)](#5-giai-Ä‘oáº¡n-2-marching-cubes-geometry-generation)
6. [Giai Äoáº¡n 3: Rendering (VCT AO + SSS)](#6-giai-Ä‘oáº¡n-3-rendering-vct-ao--sss)
7. [Giai Äoáº¡n 4: Composition (Post-Processing)](#7-giai-Ä‘oáº¡n-4-composition-post-processing)
8. [BÃ i Há»c Kinh Nghiá»‡m](#8-bÃ i-há»c-kinh-nghiá»‡m)
9. [CÃ¢u Há»i Phá»ng Váº¥n](#9-cÃ¢u-há»i-phá»ng-váº¥n)

---

## 1. Bá»‘i Cáº£nh â€” Táº¡i Sao WebGPU?

```
13 NÄ‚M HÃ€NH TRÃŒNH â€” Tá»ª WEBGL Äáº¾N WEBGPU:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  13 nÄƒm trÆ°á»›c:                                           â”‚
  â”‚  â†’ WebGL má»›i ra, hardware-accelerated 3D trong browser  â”‚
  â”‚  â†’ Muá»‘n lÃ m fluid simulation nhÆ°ng THIáº¾U:               â”‚
  â”‚    â€¢ Compute Shaders (tÃ­nh toÃ¡n trÃªn GPU)               â”‚
  â”‚    â€¢ Atomics (Ä‘á»“ng bá»™ ghi song song)                    â”‚
  â”‚    â€¢ Storage Buffers (bá»™ nhá»› chung GPU)                  â”‚
  â”‚    â€¢ 3D Textures (texture ba chiá»u)                      â”‚
  â”‚    â€¢ Indirect Draw/Dispatch (dynamic GPU commands)      â”‚
  â”‚                                                          â”‚
  â”‚  10 nÄƒm trÆ°á»›c:                                           â”‚
  â”‚  â†’ Báº¯t Ä‘áº§u "hack" WebGL: dÃ¹ng texture thay buffer,     â”‚
  â”‚    RGBA channels thay atomics, vertex shader thay        â”‚
  â”‚    compute shader...                                     â”‚
  â”‚  â†’ Káº¾T QUáº¢: cháº¡y Ä‘Æ°á»£c nhÆ°ng Xáº¤U vÃ  CHáº¬M                â”‚
  â”‚                                                          â”‚
  â”‚  7 nÄƒm trÆ°á»›c:                                            â”‚
  â”‚  â†’ Hybrid ray tracing trong WebGL                        â”‚
  â”‚  â†’ Äáº¹p hÆ¡n nhÆ°ng Cáº¦N GPU ráº¥t máº¡nh (NVidia 1080GTX)    â”‚
  â”‚  â†’ KhÃ´ng thá»ƒ production: mobile/laptop khÃ´ng cháº¡y ná»•i  â”‚
  â”‚  â†’ Tá»ª Bá» ğŸ˜                                             â”‚
  â”‚                                                          â”‚
  â”‚  HIá»†N Táº I â€” WEBGPU:                                      â”‚
  â”‚  â†’ Modern graphics API trÃªn browser                     â”‚
  â”‚  â†’ KHÃ”NG Cáº¦N HACK ná»¯a! Compute shader, atomics,        â”‚
  â”‚    storage buffers, indirect dispatch... Táº¤T Cáº¢ Äá»€U CÃ“ â”‚
  â”‚  â†’ Cuá»‘i cÃ¹ng cÃ³ thá»ƒ xÃ¢y fluid simulation "Ä‘Ã ng hoÃ ng" â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 2. WebGL vs WebGPU â€” Nhá»¯ng GÃ¬ ÄÃ£ Thay Äá»•i

```
WEBGL VS WEBGPU â€” SO SÃNH NÄ‚NG Lá»°C:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ TÃ­nh nÄƒng               â”‚ WebGL          â”‚ WebGPU         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Compute Shaders        â”‚ âŒ KhÃ´ng cÃ³    â”‚ âœ… Native      â”‚
  â”‚ (GPGPU computing)      â”‚ â†’ Pháº£i hack    â”‚ â†’ TÃ­nh toÃ¡n    â”‚
  â”‚                        â”‚   vertex shaderâ”‚   trá»±c tiáº¿p    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Storage Buffers        â”‚ âŒ KhÃ´ng cÃ³    â”‚ âœ… Native      â”‚
  â”‚                        â”‚ â†’ DÃ¹ng texture â”‚ â†’ GPU read/    â”‚
  â”‚                        â”‚   thay buffer  â”‚   write buffer â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Atomics                â”‚ âŒ KhÃ´ng cÃ³    â”‚ âœ… Native      â”‚
  â”‚ (concurrent write sync)â”‚ â†’ Multi draw   â”‚ â†’ Äá»“ng bá»™ ghi â”‚
  â”‚                        â”‚   call + RGBA  â”‚   song song    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 3D Textures            â”‚ âš ï¸ WebGL2 only â”‚ âœ… Native      â”‚
  â”‚                        â”‚ â†’ 2D layers    â”‚ â†’ Volume data  â”‚
  â”‚                        â”‚   simulate 3D  â”‚   trá»±c tiáº¿p    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Indirect Draw/Dispatch â”‚ âŒ KhÃ´ng cÃ³    â”‚ âœ… Native      â”‚
  â”‚                        â”‚ â†’ Fixed count  â”‚ â†’ GPU tá»± quyáº¿t â”‚
  â”‚                        â”‚   draw calls   â”‚   sá»‘ lÆ°á»£ng     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Pipeline Model         â”‚ Fixed-function â”‚ Programmable   â”‚
  â”‚                        â”‚ â†’ Ãt linh hoáº¡t â”‚ â†’ Full control â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Debug (Timestamp)      â”‚ âŒ             â”‚ âœ… Timestamp   â”‚
  â”‚                        â”‚                â”‚   query        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  WEBGL HACKS VS WEBGPU NATIVE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  WebGL (hack):                                           â”‚
  â”‚  "KhÃ´ng cÃ³ storage buffer â†’ dÃ¹ng texture lÆ°u data"     â”‚
  â”‚  "KhÃ´ng cÃ³ atomics â†’ multi draw call + RGBA channels"  â”‚
  â”‚  "KhÃ´ng cÃ³ compute â†’ vertex shader GPGPU"              â”‚
  â”‚  "KhÃ´ng cÃ³ 3D texture â†’ 2D layers simulate"            â”‚
  â”‚  "KhÃ´ng cÃ³ indirect â†’ fixed count draw calls"          â”‚
  â”‚  â†’ CHáº Y ÄÆ¯á»¢C nhÆ°ng: cháº­m, phá»©c táº¡p, khÃ³ maintain      â”‚
  â”‚                                                          â”‚
  â”‚  WebGPU (native):                                        â”‚
  â”‚  "Compute shader â†’ tÃ­nh toÃ¡n trá»±c tiáº¿p trÃªn GPU"       â”‚
  â”‚  "Storage buffer â†’ GPU Ä‘á»c/ghi buffer chung"           â”‚
  â”‚  "Atomics â†’ ghi Ä‘á»“ng thá»i an toÃ n"                     â”‚
  â”‚  "Indirect dispatch â†’ GPU tá»± quyáº¿t workload"           â”‚
  â”‚  â†’ Sáº CH, NHANH, ÄÃšNG CÃCH                              â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 3. Tá»•ng Quan Pipeline â€” 4 Giai Äoáº¡n

```
DEMO PIPELINE â€” Tá»ª PARTICLE Äáº¾N FINAL IMAGE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  â‘  FLUID SIMULATION (Particle)                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ PBF_applyForces.wgsl â†’ Gravity + Curl noise      â”‚  â”‚
  â”‚  â”‚ PBF_calculateDisplacements.wgsl â†’ Collision       â”‚  â”‚
  â”‚  â”‚ PBF_integrateVelocity.wgsl â†’ Update + 3D texture â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                       â”‚ Particle positions + 3D texture â”‚
  â”‚                       â–¼                                  â”‚
  â”‚  â‘¡ GEOMETRY GENERATION (Marching Cubes)                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Blur3D.wgsl â†’ Smooth potential field              â”‚  â”‚
  â”‚  â”‚ MarchCase.wgsl â†’ Find active voxels (atomics)    â”‚  â”‚
  â”‚  â”‚ EncodeBuffer.wgsl â†’ Indirect dispatch/draw paramsâ”‚  â”‚
  â”‚  â”‚ GenerateTriangles.wgsl â†’ Vertices + normals      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                       â”‚ Triangle mesh in storage buffer â”‚
  â”‚                       â–¼                                  â”‚
  â”‚  â‘¢ RENDERING                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ RenderMC.wgsl â†’ PBR material                     â”‚  â”‚
  â”‚  â”‚ VCT (Voxel Cone Tracing) â†’ Ambient occlusion     â”‚  â”‚
  â”‚  â”‚ SSS (Subsurface Scattering) â†’ Thickness â†’ glow   â”‚  â”‚
  â”‚  â”‚ Indirect draw â†’ GPU tá»± biáº¿t váº½ bao nhiÃªu         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                       â”‚ Rendered image                   â”‚
  â”‚                       â–¼                                  â”‚
  â”‚  â‘£ COMPOSITION (Post-Processing)                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Ground reflection (distance-based blur)           â”‚  â”‚
  â”‚  â”‚ Background gradient (backlight SSS)               â”‚  â”‚
  â”‚  â”‚ Bloom (enhance thin areas)                        â”‚  â”‚
  â”‚  â”‚ Color grading (brightness, contrast, gamma)       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  KEY FILES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Stage                         â”‚ Main Files            â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ Simulation pipeline           â”‚ PBF.js               â”‚
  â”‚ Force + grid build            â”‚ PBF_applyForces.wgsl â”‚
  â”‚ Collision + displacement      â”‚ PBF_calculate*.wgsl  â”‚
  â”‚ Velocity + 3D texture         â”‚ PBF_integrate*.wgsl  â”‚
  â”‚ 3D blur                       â”‚ Blur3D.js/.wgsl      â”‚
  â”‚ Voxel scanning                â”‚ MarchCase.wgsl       â”‚
  â”‚ Indirect encode               â”‚ EncodeBuffer.wgsl    â”‚
  â”‚ Triangle generation           â”‚ GenerateTriangles.wgslâ”‚
  â”‚ Triangles pipeline            â”‚ TrianglesGenerator.jsâ”‚
  â”‚ Material + render             â”‚ RenderMC.wgsl        â”‚
  â”‚ Mipmap for VCT                â”‚ MipMapCompute.wgsl   â”‚
  â”‚ Orchestration                 â”‚ Main.js              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 4. Giai Äoáº¡n 1: Fluid Simulation (Particle)

```
SPH VS PBF â€” Tá»ª Váº¬T LÃ Äáº¾N GAME-FRIENDLY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â‘  SPH (Smoothed Particle Hydrodynamics):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  TÆ°Æ¡ng tá»± "flocking / steering behaviors":              â”‚
  â”‚                                                          â”‚
  â”‚  Flocking:                                               â”‚
  â”‚  â†’ Attraction (hÃºt)    â†â†’  SPH: Pressure (Ã¡p suáº¥t)    â”‚
  â”‚  â†’ Repulsion (Ä‘áº©y)     â†â†’  SPH: Pressure (Ä‘áº©y lÃ¹i)   â”‚
  â”‚  â†’ Alignment (cÄƒn chá»‰nh)â†â†’ SPH: Viscosity (quÃ¡nh)     â”‚
  â”‚                                                          â”‚
  â”‚  SPH Flow:                                               â”‚
  â”‚  Khoáº£ng cÃ¡ch â†’ Máº­t Ä‘á»™ â†’ Ãp suáº¥t â†’ Lá»±c â†’ Di chuyá»ƒn    â”‚
  â”‚                                                          â”‚
  â”‚  âš ï¸ Váº¥n Ä‘á»:                                            â”‚
  â”‚  â†’ KHÃ“ Ä‘iá»u chá»‰nh tham sá»‘ (physical units)             â”‚
  â”‚  â†’ Cáº§n NHIá»€U pass: density, pressure, viscosity,        â”‚
  â”‚    surface tension...                                    â”‚
  â”‚  â†’ O(nÂ²) naive â†’ Cáº¦N acceleration structure            â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¡ PBF (Position Based Fluids) â€” NVidia:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  PBD (Position Based Dynamics) framework:                â”‚
  â”‚  â†’ Thay vÃ¬ tÃ­nh lá»±c â†’ dÃ¹ng CONSTRAINTS                 â”‚
  â”‚  â†’ Trá»±c tiáº¿p sá»­a Vá»Š TRÃ particles                      â”‚
  â”‚  â†’ á»”n Ä‘á»‹nh hÆ¡n, tham sá»‘ Dá»„ hiá»ƒu hÆ¡n (dimensionless)   â”‚
  â”‚                                                          â”‚
  â”‚  PBF = PBD applied to fluids:                            â”‚
  â”‚  â†’ Constraints Ä‘á»‹nh nghÄ©a displacement                  â”‚
  â”‚  â†’ KhÃ´ng cáº§n tÃ­nh density riÃªng                         â”‚
  â”‚                                                          â”‚
  â”‚  âš ï¸ NhÆ°ng cáº§n NHIá»€U iterations:                         â”‚
  â”‚  â†’ Compute constraints â†’ apply â†’ viscosity â†’ repeat    â”‚
  â”‚  â†’ Tá»‘n GPU budget!                                      â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¢ GIáº¢I PHÃP THá»°C Táº¾ Cá»¦A DEMO â€” "Cáº®T GÃ“C":
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  GPU budget: pháº£i chia cho simulation + geometry +       â”‚
  â”‚  rendering + composition â†’ KHÃ”NG Äá»¦ cho nhiá»u PBF      â”‚
  â”‚  iterations!                                             â”‚
  â”‚                                                          â”‚
  â”‚  Giáº£i phÃ¡p:                                              â”‚
  â”‚  â†’ Gravity = lá»±c chÃ­nh                                   â”‚
  â”‚  â†’ Curl noise = lá»±c phá»¥ (táº¡o cáº£m giÃ¡c fluid)           â”‚
  â”‚  â†’ Mouse repulsion = tÆ°Æ¡ng tÃ¡c user                     â”‚
  â”‚  â†’ Collision = 1 pass PBD (trÃ¡nh particles chá»“ng)      â”‚
  â”‚                                                          â”‚
  â”‚  â†’ KHÃ”NG realistic nhÆ° PBF Ä‘áº§y Ä‘á»§                       â”‚
  â”‚  â†’ NhÆ°ng NHANH HÆ N nhiá»u â†’ cÃ²n budget cho rendering    â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  VOXEL GRID â€” ACCELERATION STRUCTURE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Naive: O(nÂ²) â€” má»—i particle check Táº¤T Cáº¢ particles   â”‚
  â”‚  â†’ 80,000 particles = 6.4 BILLION comparisons! âŒ      â”‚
  â”‚                                                          â”‚
  â”‚  Voxel Grid: O(kÂ·n) â€” chá»‰ check NEIGHBORS              â”‚
  â”‚  â†’ Chia khÃ´ng gian thÃ nh grid cells                     â”‚
  â”‚  â†’ Má»—i cell chá»©a tá»‘i Ä‘a 4 particle indices             â”‚
  â”‚  â†’ Check 27 cells xung quanh (3x3x3)                   â”‚
  â”‚  â†’ 27 Ã— 4 = max 108 checks per particle                â”‚
  â”‚  â†’ 80,000 Ã— 108 = 8.6 million checks âœ…               â”‚
  â”‚                                                          â”‚
  â”‚  Atomics trong WebGPU:                                   â”‚
  â”‚  â†’ Nhiá»u threads cÃ¹ng ghi index vÃ o grid cell           â”‚
  â”‚  â†’ Atomics Ä‘áº£m báº£o KHÃ”NG race condition                 â”‚
  â”‚  â†’ Chá»‰ vÃ i dÃ²ng code! (trÆ°á»›c Ä‘Ã¢y hack ráº¥t phá»©c táº¡p)   â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  SIMULATION PIPELINE (3 shaders):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Pass 1: PBF_applyForces.wgsl                           â”‚
  â”‚  â†’ Apply gravity, curl noise, mouse repulsion           â”‚
  â”‚  â†’ Äá»“ng thá»i BUILD voxel grid (atomics!)               â”‚
  â”‚                                                          â”‚
  â”‚  Pass 2: PBF_calculateDisplacements.wgsl                â”‚
  â”‚  â†’ Traverse 27 neighbor cells                           â”‚
  â”‚  â†’ Collision detection + response                       â”‚
  â”‚  â†’ Environment collision (bounding box)                 â”‚
  â”‚                                                          â”‚
  â”‚  Pass 3: PBF_integrateVelocity.wgsl                     â”‚
  â”‚  â†’ Update positions â†’ newPos - oldPos = velocity        â”‚
  â”‚  â†’ Write particle info â†’ 3D texture (for marching cubes)â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 5. Giai Äoáº¡n 2: Marching Cubes (Geometry Generation)

```
Táº I SAO MARCHING CUBES?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  3 CÃCH RENDER SURFACE Tá»ª PARTICLES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  â‘  Point Splatting:                                      â”‚
  â”‚  â†’ Screen-space: render points + blur + normals         â”‚
  â”‚  â†’ â­ Nhanh nháº¥t, cÃ³ thá»ƒ lÃ m reflection/caustics       â”‚
  â”‚  â†’ âš ï¸ Screen-space only, khÃ³ integrate vÃ o scene       â”‚
  â”‚                                                          â”‚
  â”‚  â‘¡ Ray Marching:                                         â”‚
  â”‚  â†’ Tá»« particles â†’ distance field â†’ step sampling       â”‚
  â”‚  â†’ â­ Äáº¹p nháº¥t (multi-bounce reflection/refraction)    â”‚
  â”‚  â†’ âŒ Ráº¤T CHáº¬M, khÃ´ng realtime                         â”‚
  â”‚                                                          â”‚
  â”‚  â‘¢ Marching Cubes:                                       â”‚
  â”‚  â†’ Tá»« potential field â†’ extract iso-surface â†’ mesh      â”‚
  â”‚  â†’ â­ World-space geometry, rasterize á»•n Ä‘á»‹nh           â”‚
  â”‚  â†’ â­ Reflection "ráº»" (váº½ mesh 2 láº§n)                  â”‚
  â”‚  â†’ âš ï¸ Phá»©c táº¡p hÆ¡n Ä‘á»ƒ implement trÃªn GPU               â”‚
  â”‚                                                          â”‚
  â”‚  Demo chá»n Marching Cubes vÃ¬:                            â”‚
  â”‚  â†’ World-space â†’ dá»… integrate vÃ o scene                 â”‚
  â”‚  â†’ Mesh â†’ reflection = váº½ 2 láº§n (ráº» hÆ¡n ray marching) â”‚
  â”‚  â†’ Táº­n dá»¥ng voxel grid Ä‘Ã£ cÃ³ tá»« simulation             â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### Marching Cubes â€” CÃ¡ch Hoáº¡t Äá»™ng

```
MARCHING CUBES PIPELINE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  NguyÃªn lÃ½: trÃ­ch xuáº¥t ISO-SURFACE tá»« potential field

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  BÆ¯á»šC 1: Táº¡o Potential Field (Blur3D.wgsl)             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  3D texture tá»« particles                           â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  3D Gaussian Blur (3 passes: X, Y, Z)             â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  Smooth potential field                             â”‚ â”‚
  â”‚  â”‚  (â‰ˆ "distance field nghÃ¨o" nhÆ°ng Äá»¦ DÃ™NG)        â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  Táº¡i sao blur THAY VÃŒ Jump Flood (chÃ­nh xÃ¡c hÆ¡n)?â”‚ â”‚
  â”‚  â”‚  â†’ Jump Flood quÃ¡ chÃ­nh xÃ¡c â†’ giá»‘ng SPHERES       â”‚ â”‚
  â”‚  â”‚  â†’ Blur "xÃ³a nhÃ²a" particles â†’ giá»‘ng Bá»€ Máº¶T      â”‚ â”‚
  â”‚  â”‚  â†’ Blur nhanh hÆ¡n VÃ€ Ä‘áº¹p hÆ¡n cho má»¥c Ä‘Ã­ch nÃ y!   â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                          â”‚
  â”‚  BÆ¯á»šC 2: Scan Voxels (MarchCase.wgsl)                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  Duyá»‡t TOÃ€N Bá»˜ voxel grid                         â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  Má»—i voxel: 8 corners â†’ sample potential          â”‚ â”‚
  â”‚  â”‚  â†’ XÃ¡c Ä‘á»‹nh 1 trong 256 "cases"                   â”‚ â”‚
  â”‚  â”‚  â†’ Má»—i case sinh 0-5 triangles                    â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  â­ Atomics: ghi voxel coords + case               â”‚ â”‚
  â”‚  â”‚     vÃ o CONTIGUOUS storage buffer                   â”‚ â”‚
  â”‚  â”‚  â†’ CHá»ˆ active voxels Ä‘Æ°á»£c ghi!                     â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                          â”‚
  â”‚  BÆ¯á»šC 3: Encode Indirect Params (EncodeBuffer.wgsl)     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  Äá»c sá»‘ voxels tá»« bÆ°á»›c 2                           â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  TÃ­nh: bao nhiÃªu vertices cáº§n generate?            â”‚ â”‚
  â”‚  â”‚  TÃ­nh: bao nhiÃªu triangles cáº§n draw?               â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  Encode thÃ nh:                                      â”‚ â”‚
  â”‚  â”‚  â†’ Indirect DISPATCH params (cho bÆ°á»›c 4)           â”‚ â”‚
  â”‚  â”‚  â†’ Indirect DRAW params (cho rendering)            â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  â­ CPU KHÃ”NG Cáº¦N biáº¿t sá»‘ lÆ°á»£ng!                   â”‚ â”‚
  â”‚  â”‚  â†’ GPU tá»± quyáº¿t dispatch/draw bao nhiÃªu            â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                          â”‚
  â”‚  BÆ¯á»šC 4: Generate Triangles (GenerateTriangles.wgsl)    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â”‚  Cháº¡y qua INDIRECT DISPATCH                        â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  Global thread index â†’ voxel + vertex              â”‚ â”‚
  â”‚  â”‚  â†’ Linear interpolation giá»¯a 2 corners            â”‚ â”‚
  â”‚  â”‚     â†’ Vertex position                               â”‚ â”‚
  â”‚  â”‚  â†’ Gradient interpolation                          â”‚ â”‚
  â”‚  â”‚     â†’ Vertex normal                                 â”‚ â”‚
  â”‚  â”‚      â”‚                                              â”‚ â”‚
  â”‚  â”‚      â–¼                                              â”‚ â”‚
  â”‚  â”‚  Output: vertices + normals â†’ storage buffer       â”‚ â”‚
  â”‚  â”‚  (Sáºµn sÃ ng cho rendering!)                         â”‚ â”‚
  â”‚  â”‚                                                    â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 6. Giai Äoáº¡n 3: Rendering (VCT AO + SSS)

```
RENDERING â€” GPU BUDGET ALLOCATION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Váº¤N Äá»€ Lá»šN NHáº¤T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  GPU budget Ä‘Ã£ dÃ¹ng PHáº¦N Lá»šN cho:                       â”‚
  â”‚  â†’ Particle simulation                                  â”‚
  â”‚  â†’ Marching cubes geometry generation                   â”‚
  â”‚                                                          â”‚
  â”‚  â†’ CÃ²n Ráº¤T ÃT budget cho rendering!                     â”‚
  â”‚  â†’ Pháº£i chá»n effects "Ráºº nhÆ°ng HIá»†U QUáº¢"              â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘  VOXEL CONE TRACING (VCT) â€” AO:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  AO (Ambient Occlusion) = vÃ¹ng bá»‹ che cháº¯n â†’ tá»‘i hÆ¡n  â”‚
  â”‚                                                          â”‚
  â”‚  ThÃ´ng thÆ°á»ng VCT cáº§n:                                   â”‚
  â”‚  â†’ Voxelize triangles vÃ o grid                          â”‚
  â”‚  â†’ Rá»“i trace cones tá»« surface                           â”‚
  â”‚                                                          â”‚
  â”‚  NhÆ°ng demo nÃ y NGÆ¯á»¢C Láº I:                               â”‚
  â”‚  â†’ Ta tá»« VOXEL GRID sinh ra triangles!                  â”‚
  â”‚  â†’ Voxel data ÄÃƒ CÃ“ Sáº´N!                               â”‚
  â”‚  â†’ Chá»‰ cáº§n THÃŠM 2 DÃ’NG vÃ o MarchCase.wgsl:            â”‚
  â”‚    â‘  Voxel cÃ³ triangle â†’ mark = 1                      â”‚
  â”‚    â‘¡ Voxel khÃ´ng cÃ³ â†’ mark = 0                         â”‚
  â”‚    â‘¢ Ground voxels â†’ mark = 0.5 (ground AO)           â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Táº¡o mipmap cho 3D texture (MipMapCompute.wgsl)      â”‚
  â”‚  â†’ Trace cones qua mipmap levels = AO data             â”‚
  â”‚                                                          â”‚
  â”‚  â­ Gáº§n nhÆ° "FREE" vÃ¬ data Ä‘Ã£ cÃ³ sáºµn tá»« MC pipeline!   â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¡ SSS (Subsurface Scattering) â€” THICKNESS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  SSS = Ã¡nh sÃ¡ng xuyÃªn qua váº­t thá»ƒ má»ng â†’ phÃ¡t sÃ¡ng    â”‚
  â”‚  (nhÆ° náº¿n, da tay, cháº¥t lá»ng má»ng)                      â”‚
  â”‚                                                          â”‚
  â”‚  Cáº§n biáº¿t THICKNESS (Ä‘á»™ dÃ y) cá»§a geometry:               â”‚
  â”‚  â†’ DÃ€Y â†’ Ã­t Ã¡nh sÃ¡ng xuyÃªn qua â†’ tá»‘i                  â”‚
  â”‚  â†’ Má»NG â†’ nhiá»u Ã¡nh sÃ¡ng â†’ sÃ¡ng (glow effect)         â”‚
  â”‚                                                          â”‚
  â”‚  ThÃ´ng thÆ°á»ng dÃ¹ng "thickness map" bake sáºµn             â”‚
  â”‚  â†’ NhÆ°ng fluid THAY Äá»”I LIÃŠN Tá»¤C â†’ khÃ´ng bake Ä‘Æ°á»£c!  â”‚
  â”‚                                                          â”‚
  â”‚  Giáº£i phÃ¡p:                                              â”‚
  â”‚  â†’ Ta Ä‘Ã£ cÃ³ potential field (â‰ˆ distance field)          â”‚
  â”‚  â†’ Shoot ray VÃ€O BÃŠN TRONG geometry                    â”‚
  â”‚  â†’ Sample distance field dá»c ray                        â”‚
  â”‚  â†’ Estimate thickness = bao nhiÃªu "cháº¥t liá»‡u" trÃªn rayâ”‚
  â”‚  â†’ (TÆ°Æ¡ng tá»± cÃ¡ch IÃ±igo Quilez tÃ­nh AO tá»« SDF)         â”‚
  â”‚                                                          â”‚
  â”‚  â­ Potential field tá»« blur step â†’ táº­n dá»¥ng láº¡i!        â”‚
  â”‚  â†’ Gáº§n nhÆ° khÃ´ng tá»‘n thÃªm data                          â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¢ INDIRECT DRAW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  CPU KHÃ”NG BIáº¾T marching cubes sinh ra bao nhiÃªu â–³      â”‚
  â”‚  â†’ Dá»¯ liá»‡u náº±m hoÃ n toÃ n trÃªn GPU                     â”‚
  â”‚                                                          â”‚
  â”‚  Giáº£i phÃ¡p: Indirect Draw                                â”‚
  â”‚  â†’ EncodeBuffer.wgsl Ä‘Ã£ encode draw params              â”‚
  â”‚  â†’ GPU tá»± biáº¿t váº½ bao nhiÃªu triangles                  â”‚
  â”‚  â†’ CPU chá»‰ gá»i drawIndirect(), khÃ´ng cáº§n biáº¿t count    â”‚
  â”‚                                                          â”‚
  â”‚  + 2 matrix sets:                                        â”‚
  â”‚    â†’ Normal view matrix (gÃ³c nhÃ¬n thÆ°á»ng)               â”‚
  â”‚    â†’ Reflection matrix (váº½ mesh láº§n 2 cho pháº£n chiáº¿u)  â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 7. Giai Äoáº¡n 4: Composition (Post-Processing)

```
COMPOSITION â€” "COMPOSITION QUYáº¾T Äá»ŠNH Táº¤T Cáº¢":
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  BÃ i há»c quan trá»ng nháº¥t:
  "Báº¡n cÃ³ thá»ƒ cÃ³ simulation phá»©c táº¡p nháº¥t, material
   Ä‘áº¹p nháº¥t â€” nhÆ°ng náº¿u NHÃŒN xáº¥u thÃ¬ nÃ³ VáºªN Xáº¤U"

  â‘  GROUND REFLECTION (Pháº£n chiáº¿u máº·t Ä‘áº¥t):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Marching cubes â†’ mesh â†’ reflection = Váº¼ MESH 2 Láº¦N   â”‚
  â”‚  (Ráº» hÆ¡n ray marching Ráº¤T NHIá»€U!)                      â”‚
  â”‚                                                          â”‚
  â”‚  Váº¥n Ä‘á»: reflection quÃ¡ CLEAR â†’ giáº£ táº¡o               â”‚
  â”‚  Giáº£i phÃ¡p: BLUR reflection theo khoáº£ng cÃ¡ch            â”‚
  â”‚  â†’ Xa máº·t Ä‘áº¥t â†’ blur nhiá»u hÆ¡n (roughness effect)     â”‚
  â”‚  â†’ Gáº§n máº·t Ä‘áº¥t â†’ blur Ã­t hÆ¡n (sharper reflection)     â”‚
  â”‚                                                          â”‚
  â”‚  Trick: pre-process pass ghi "nearest height" vÃ o       â”‚
  â”‚  texture â†’ vÃ¹ng TRá»NG cÅ©ng biáº¿t blur bao nhiÃªu         â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¡ BACKGROUND + LIGHTING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  SSS giáº£ sá»­ Ã¡nh sÃ¡ng LUÃ”N tá»« phÃ­a sau geometry         â”‚
  â”‚  â†’ Background gradient: sÃ¡ng phÃ­a sau = giáº£i thÃ­ch     â”‚
  â”‚    light direction tá»± nhiÃªn                              â”‚
  â”‚  â†’ Background color gáº§n material â†’ hÃ²a há»£p hÆ¡n         â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¢ BLOOM:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Thin areas (geometry má»ng) â†’ SSS máº¡nh â†’ bright       â”‚
  â”‚  â†’ Bloom tÄƒng cÆ°á»ng â†’ glow effect cho vÃ¹ng má»ng        â”‚
  â”‚  â†’ Káº¿t há»£p SSS + Bloom â†’ visual impact máº¡nh           â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘£ COLOR GRADING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  â†’ Brightness adjustment                                 â”‚
  â”‚  â†’ Contrast adjustment                                   â”‚
  â”‚  â†’ Gamma correction                                      â”‚
  â”‚  â†’ Warm tone â†’ má»m máº¡i, cÃ³ "mood"                      â”‚
  â”‚                                                          â”‚
  â”‚  Táº¥t cáº£ xá»­ lÃ½ bá»Ÿi compute shaders, gá»i tá»« Main.js     â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 8. BÃ i Há»c Kinh Nghiá»‡m

```
BÃ€I Há»ŒC Tá»ª 13 NÄ‚M LÃ€M FLUID TRÃŠN BROWSER:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â‘  Ká»¸ THUáº¬T vs THáº¨M Má»¸:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  "Simulation phá»©c táº¡p nháº¥t + material Ä‘á»‰nh nháº¥t         â”‚
  â”‚   = VáºªN Xáº¤U náº¿u composition tá»‡"                        â”‚
  â”‚                                                          â”‚
  â”‚  â†’ DÃ nh thá»i gian cho visual polish                     â”‚
  â”‚  â†’ Composition > raw technical complexity                â”‚
  â”‚  â†’ Há»i ngÆ°á»i khÃ¡c feedback trÆ°á»›c khi publish           â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¡ GPU BUDGET MANAGEMENT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Total GPU time = simulation + geometry + render + post â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Simulation: cáº¯t gÃ³c (1 pass force + collision)      â”‚
  â”‚  â†’ Geometry: indirect dispatch (chá»‰ táº¡o cáº§n thiáº¿t)    â”‚
  â”‚  â†’ Render: táº­n dá»¥ng data cÃ³ sáºµn (VCT, SSS from SDF)   â”‚
  â”‚  â†’ Post: ráº» nhÆ°ng impact cao (bloom, color grading)    â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Demo KHÃ”NG production-ready!                          â”‚
  â”‚    M3 Max ~120fps, M1 Pro ~60fps, Air: "broken dreams" â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘¢ TÃI Sá»¬ Dá»¤NG DATA:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Voxel grid (simulation) â†’ reuse cho VCT AO            â”‚
  â”‚  Potential field (blur) â†’ reuse cho SSS thickness       â”‚
  â”‚  Mesh (marching cubes) â†’ reuse cho reflection (2x draw)â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Má»–I data structure phá»¥c vá»¥ NHIá»€U má»¥c Ä‘Ã­ch           â”‚
  â”‚  â†’ Giáº£m GPU time Ä‘Ã¡ng ká»ƒ                               â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â‘£ MODULE HÃ“A:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  Demo = Táº¬P Há»¢P nhiá»u ká»¹ thuáº­t Äá»˜C Láº¬P:               â”‚
  â”‚  â†’ Particle animation (riÃªng)                           â”‚
  â”‚  â†’ Surface from potential field (riÃªng)                 â”‚
  â”‚  â†’ Indirect light (riÃªng)                               â”‚
  â”‚  â†’ World-space AO (riÃªng)                               â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Báº¡n cÃ³ thá»ƒ Láº¤Y 1 pháº§n Ä‘á»ƒ dÃ¹ng cho project KHÃC     â”‚
  â”‚  â†’ KhÃ´ng cáº§n clone toÃ n bá»™                              â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## 9. CÃ¢u Há»i Phá»ng Váº¥n

### Q1: WebGPU khÃ¡c WebGL tháº¿ nÃ o? Táº¡i sao cáº§n WebGPU?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  WebGL dá»±a trÃªn OpenGL ES â€” API Ä‘á»“ há»a Äá»œI CÅ¨:             â”‚
â”‚  â†’ Thiáº¿u compute shaders, atomics, storage buffers,         â”‚
â”‚    indirect dispatch, 3D textures                            â”‚
â”‚  â†’ Pháº£i "hack" báº±ng texture thay buffer, vertex shader      â”‚
â”‚    thay compute, RGBA channels thay atomics...               â”‚
â”‚                                                              â”‚
â”‚  WebGPU dá»±a trÃªn MODERN APIs (Vulkan/Metal/DX12):           â”‚
â”‚  â†’ Compute shaders: GPGPU tÃ­nh toÃ¡n trá»±c tiáº¿p              â”‚
â”‚  â†’ Storage buffers: GPU Ä‘á»c/ghi data trá»±c tiáº¿p             â”‚
â”‚  â†’ Atomics: ghi Ä‘á»“ng thá»i an toÃ n                           â”‚
â”‚  â†’ Indirect dispatch/draw: GPU tá»± quyáº¿t workload           â”‚
â”‚  â†’ Programmable pipeline: full control                      â”‚
â”‚                                                              â”‚
â”‚  â†’ KhÃ´ng cáº§n hack, code sáº¡ch hÆ¡n, nhanh hÆ¡n, Ä‘Ãºng cÃ¡ch    â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Q2: SPH vÃ  PBF khÃ¡c nhau tháº¿ nÃ o? Demo chá»n cÃ¡ch nÃ o?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  SPH (Smoothed Particle Hydrodynamics):                      â”‚
â”‚  â†’ TÃ­nh density â†’ pressure â†’ force â†’ displacement          â”‚
â”‚  â†’ Physical parameters (units) â†’ KHÃ“ Ä‘iá»u chá»‰nh           â”‚
â”‚  â†’ Nhiá»u pass: density, pressure, viscosity, tension        â”‚
â”‚                                                              â”‚
â”‚  PBF (Position Based Fluids):                                â”‚
â”‚  â†’ DÃ¹ng constraints trá»±c tiáº¿p sá»­a Vá»Š TRÃ                  â”‚
â”‚  â†’ Dimensionless parameters â†’ Dá»„ Ä‘iá»u chá»‰nh               â”‚
â”‚  â†’ á»”n Ä‘á»‹nh hÆ¡n nhÆ°ng cáº§n nhiá»u iterations                  â”‚
â”‚                                                              â”‚
â”‚  Demo chá»n: PBD simplified (1 pass)                          â”‚
â”‚  â†’ Gravity + curl noise + mouse repulsion + collision       â”‚
â”‚  â†’ KhÃ´ng realistic 100% nhÆ°ng NHANH â†’ cÃ²n GPU budget      â”‚
â”‚    cho geometry generation + rendering                      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Q3: Marching Cubes hoáº¡t Ä‘á»™ng tháº¿ nÃ o? Táº¡i sao dÃ¹ng cho fluid?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Marching Cubes = trÃ­ch xuáº¥t iso-surface tá»« potential field: â”‚
â”‚                                                              â”‚
â”‚  â‘  Tá»« particles â†’ 3D texture â†’ blur â†’ potential field     â”‚
â”‚  â‘¡ Má»—i voxel: 8 corners sample potential                   â”‚
â”‚     â†’ 256 cases â†’ 0-5 triangles má»—i voxel                 â”‚
â”‚  â‘¢ Atomics ghi active voxels vÃ o contiguous buffer         â”‚
â”‚  â‘£ Indirect dispatch: GPU tá»± táº¡o Ä‘Ãºng sá»‘ triangles        â”‚
â”‚  â‘¤ Interpolate positions + normals â†’ mesh                  â”‚
â”‚                                                              â”‚
â”‚  Táº¡i sao cho fluid:                                          â”‚
â”‚  â†’ World-space geometry â†’ dá»… integrate vÃ o scene           â”‚
â”‚  â†’ Mesh â†’ reflection ráº» (váº½ 2 láº§n, khÃ´ng ray march)       â”‚
â”‚  â†’ Táº­n dá»¥ng voxel grid cÃ³ sáºµn tá»« simulation               â”‚
â”‚                                                              â”‚
â”‚  So vá»›i point splatting (nhanh hÆ¡n) vÃ  ray marching          â”‚
â”‚  (Ä‘áº¹p hÆ¡n), marching cubes lÃ  trung gian tá»‘t nháº¥t         â”‚
â”‚  cho opaque/translucent liquids                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Q4: Táº¡i sao 3D blur thay vÃ¬ Jump Flood cho potential field?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Jump Flood Algorithm:                                       â”‚
â”‚  â†’ Táº¡o distance field CHÃNH XÃC tá»« particles               â”‚
â”‚  â†’ NhÆ°ng QUÃ chÃ­nh xÃ¡c â†’ káº¿t quáº£ giá»‘ng SPHERES            â”‚
â”‚  â†’ Iso-surface "ná»‘i" spheres láº¡i nhÆ°ng KHÃ”NG smooth        â”‚
â”‚  â†’ Cáº§n Ráº¤T NHIá»€U particles má»›i trÃ´ng liÃªn tá»¥c             â”‚
â”‚                                                              â”‚
â”‚  3D Gaussian Blur:                                           â”‚
â”‚  â†’ "XÃ³a nhÃ²a" particles â†’ máº¥t táº§n sá»‘ cao                  â”‚
â”‚  â†’ Káº¿t quáº£ giá»‘ng Bá»€ Máº¶T LIÃŠN Tá»¤C tá»± nhiÃªn                â”‚
â”‚  â†’ Blur nhiá»u hÆ¡n = mÆ°á»£t hÆ¡n                               â”‚
â”‚  â†’ CÃ³ thá»ƒ mix blur methods cho visual effects khÃ¡c nhau    â”‚
â”‚                                                              â”‚
â”‚  Paradox: phÆ°Æ¡ng phÃ¡p ÄÆ N GIáº¢N hÆ¡n láº¡i cho káº¿t quáº£        â”‚
â”‚  Äáº¸P hÆ¡n VÃ€ NHANH hÆ¡n cho má»¥c Ä‘Ã­ch nÃ y!                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Q5: Voxel Cone Tracing AO trong demo táº­n dá»¥ng data cÃ³ sáºµn tháº¿ nÃ o?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  VCT thÃ´ng thÆ°á»ng cáº§n:                                       â”‚
â”‚  â‘  Voxelize triangles vÃ o 3D grid (Tá»N THá»œI GIAN!)        â”‚
â”‚  â‘¡ Táº¡o mipmap cho 3D texture                               â”‚
â”‚  â‘¢ Trace cones â†’ AO                                        â”‚
â”‚                                                              â”‚
â”‚  Demo nÃ y NGÆ¯á»¢C: triangles tá»« VOXEL â†’ bÆ°á»›c â‘  ÄÃƒ CÃ“!      â”‚
â”‚  â†’ Chá»‰ thÃªm 2 dÃ²ng vÃ o MarchCase.wgsl:                    â”‚
â”‚    â†’ Voxel cÃ³ triangle = 1                                  â”‚
â”‚    â†’ Voxel khÃ´ng cÃ³ = 0                                      â”‚
â”‚    â†’ Ground voxels = 0.5                                     â”‚
â”‚  â†’ Táº¡o mipmap (MipMapCompute.wgsl)                         â”‚
â”‚  â†’ Trace cones â†’ AO                                        â”‚
â”‚                                                              â”‚
â”‚  â†’ Gáº§n nhÆ° "FREE" cost vÃ¬ data structures ÄÃƒ Tá»’N Táº I     â”‚
â”‚    trong pipeline! ÄÃ¢y lÃ  Æ°u Ä‘iá»ƒm cá»§a thiáº¿t káº¿ module      â”‚
â”‚    tÃ¡i sá»­ dá»¥ng data.                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Q6: SSS (Subsurface Scattering) estimate thickness tháº¿ nÃ o khi fluid thay Ä‘á»•i liÃªn tá»¥c?

```
TRáº¢ Lá»œI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  ThÃ´ng thÆ°á»ng SSS dÃ¹ng BAKED thickness map                   â”‚
â”‚  â†’ Fluid thay Ä‘á»•i má»—i frame â†’ KHÃ”NG thá»ƒ bake!             â”‚
â”‚                                                              â”‚
â”‚  Giáº£i phÃ¡p: táº­n dá»¥ng POTENTIAL FIELD (â‰ˆ distance field)     â”‚
â”‚  tá»« blur step (Ä‘Ã£ cÃ³ sáºµn!)                                  â”‚
â”‚                                                              â”‚
â”‚  â‘  Báº¯n ray VÃ€O BÃŠN TRONG geometry (ngÆ°á»£c surface normal)  â”‚
â”‚  â‘¡ Sample potential field dá»c ray                           â”‚
â”‚  â‘¢ Potential cao = á»Ÿ sÃ¢u bÃªn trong â†’ DÃ€Y                   â”‚
â”‚  â‘£ Potential tháº¥p = gáº§n bá» máº·t â†’ Má»NG                     â”‚
â”‚                                                              â”‚
â”‚  â†’ DÃ y â†’ Ã­t light xuyÃªn qua â†’ tá»‘i                          â”‚
â”‚  â†’ Má»ng â†’ nhiá»u light â†’ sÃ¡ng (glow)                        â”‚
â”‚                                                              â”‚
â”‚  TÆ°Æ¡ng tá»± IÃ±igo Quilez AO from SDF technique               â”‚
â”‚  â†’ REALTIME, khÃ´ng cáº§n bake, táº­n dá»¥ng data cÃ³ sáºµn         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
