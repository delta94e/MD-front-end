# Next.js Image Optimization â€” Deep Dive!

> **Chá»§ Ä‘á»**: Image Optimization trong Next.js App Router
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/getting-started/images

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” `<Image>` Component](#1)
2. [Â§2. PhÃ¢n TÃ­ch SÆ¡ Äá»“ â€” Local Image File Structure](#2)
3. [Â§3. Local Images â€” Static Files](#3)
4. [Â§4. Static Import â€” Tá»± Äá»™ng width/height](#4)
5. [Â§5. Remote Images â€” URL Tá»« Server NgoÃ i](#5)
6. [Â§6. remotePatterns â€” Báº£o Máº­t](#6)
7. [Â§7. SÆ¡ Äá»“ Tá»•ng Há»£p â€” Image Pipeline](#7)
8. [Â§8. Tá»± Viáº¿t â€” ImageOptimizationEngine](#8)
9. [Â§9. CÃ¢u Há»i Luyá»‡n Táº­p](#9)

---

## Â§1. Tá»•ng Quan â€” `<Image>` Component!

```
  NEXT.JS <IMAGE> â€” 4 TÃNH NÄ‚NG CHÃNH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  <Image> = PHIÃŠN Báº¢N NÃ‚NG Cáº¤P cá»§a <img> HTML!        â”‚
  â”‚  import Image from 'next/image'                        â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  SIZE OPTIMIZATION (Tá»‘i Æ°u kÃ­ch thÆ°á»›c)        â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Tá»± Ä‘á»™ng serve áº£nh ÄÃšNG SIZE cho device â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Desktop: 1200px, Tablet: 768px,        â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    Mobile: 375px                           â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ DÃ¹ng format HIá»†N Äáº I: WebP             â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ WebP nhá» hÆ¡n JPEG/PNG 25-35%!          â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ VISUAL STABILITY (á»”n Ä‘á»‹nh thá»‹ giÃ¡c)          â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Tá»± Ä‘á»™ng NGÄ‚N Layout Shift (CLS)!       â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ CLS = ná»™i dung nháº£y/dá»‹ch chuyá»ƒn vá»‹ trÃ­ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    khi áº£nh load xong                        â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ <Image> RESERVE khÃ´ng gian trÆ°á»›c!       â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ FASTER PAGE LOADS (Táº£i trang nhanh hÆ¡n)      â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ LAZY LOADING máº·c Ä‘á»‹nh (native browser) â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Chá»‰ load áº£nh khi CUá»˜N Ä‘áº¿n viewport!    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Tuá»³ chá»n: blur-up placeholder         â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    (áº£nh má» â†’ áº£nh rÃµ khi load xong)        â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘£ ASSET FLEXIBILITY (Linh hoáº¡t tÃ i nguyÃªn)     â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Resize áº£nh ON-DEMAND (theo yÃªu cáº§u)    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ Ká»ƒ cáº£ áº£nh tá»« REMOTE SERVER!            â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ KhÃ´ng cáº§n xá»­ lÃ½ áº£nh trÆ°á»›c!             â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SO SÃNH <img> vs <Image>:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                   â”‚ <img>    â”‚ <Image>            â”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ Auto resize       â”‚ âŒ       â”‚ âœ… Per device      â”‚ â”‚
  â”‚  â”‚ WebP format       â”‚ âŒ       â”‚ âœ… Tá»± Ä‘á»™ng         â”‚ â”‚
  â”‚  â”‚ Lazy loading      â”‚ Manual   â”‚ âœ… Máº·c Ä‘á»‹nh        â”‚ â”‚
  â”‚  â”‚ CLS prevention    â”‚ âŒ       â”‚ âœ… Tá»± Ä‘á»™ng         â”‚ â”‚
  â”‚  â”‚ Blur placeholder  â”‚ âŒ       â”‚ âœ… Tuá»³ chá»n        â”‚ â”‚
  â”‚  â”‚ Remote resize     â”‚ âŒ       â”‚ âœ… On-demand       â”‚ â”‚
  â”‚  â”‚ Size output       â”‚ NguyÃªn   â”‚ âœ… Tá»‘i Æ°u          â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                        â”‚
  â”‚  Sá»¬ Dá»¤NG CÆ  Báº¢N:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  import Image from 'next/image'                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  export default function Page() {                â”‚  â”‚
  â”‚  â”‚    return <Image src="" alt="" />                 â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ src cÃ³ thá»ƒ lÃ  LOCAL hoáº·c REMOTE!             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CLS (Cumulative Layout Shift) lÃ  gÃ¬?**

```
  CLS â€” HIá»†N TÆ¯á»¢NG LAYOUT SHIFT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TRÆ¯á»šC khi áº£nh load:       SAU khi áº£nh load:           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚ Title            â”‚       â”‚ Title            â”‚        â”‚
  â”‚  â”‚ Text paragraph   â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
  â”‚  â”‚ More text...     â”‚       â”‚ â”‚   IMAGE!!!   â”‚ â”‚ â† áº¢nh â”‚
  â”‚  â”‚ Footer           â”‚       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   xuáº¥t â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ Text paragraph   â”‚   hiá»‡n â”‚
  â”‚                             â”‚ More text... â†“â†“â†“ â”‚ â† Nháº£y!â”‚
  â”‚                             â”‚ Footer      â†“â†“â†“ â”‚ â† Nháº£y!â”‚
  â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Ná»™i dung Bá»Š NHáº¢Y xuá»‘ng khi áº£nh load!              â”‚
  â”‚  â†’ Tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng Ráº¤T Tá»†!                   â”‚
  â”‚  â†’ Google Core Web Vitals TRá»ªNG PHáº T CLS cao!        â”‚
  â”‚                                                        â”‚
  â”‚  <Image> GIáº¢I QUYáº¾T báº±ng cÃ¡ch:                        â”‚
  â”‚  â†’ width + height Ä‘Æ°á»£c set TRÆ¯á»šC                      â”‚
  â”‚  â†’ Browser RESERVE khÃ´ng gian Ä‘Ãºng kÃ­ch thÆ°á»›c!        â”‚
  â”‚  â†’ Content KHÃ”NG BAO GIá»œ bá»‹ nháº£y!                    â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. PhÃ¢n TÃ­ch SÆ¡ Äá»“ â€” Local Image File Structure!

**SÆ¡ Ä‘á»“ gá»‘c trÃªn trang:**

![Local Image File Structure](images/nextjs-image-local-file-structure.png)

```
  PHÃ‚N TÃCH SÆ  Äá»’ â€” FILE STRUCTURE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SÆ¡ Ä‘á»“ hiá»ƒn thá»‹ Cáº¤U TRÃšC THÆ¯ Má»¤C Gá»C:               â”‚
  â”‚                                                        â”‚
  â”‚  project-root/                                         â”‚
  â”‚  â”œâ”€â”€ ğŸ“ app          â† ThÆ° má»¥c App Router             â”‚
  â”‚  â”‚   â”œâ”€â”€ page.tsx    â† Trang chÃ­nh                    â”‚
  â”‚  â”‚   â”œâ”€â”€ layout.tsx  â† Root layout                    â”‚
  â”‚  â”‚   â””â”€â”€ ...                                           â”‚
  â”‚  â”‚                                                     â”‚
  â”‚  â””â”€â”€ ğŸ“ public  ğŸ”µ   â† CHá»® CÃ“ Dáº¤U CHáº¤M XANH!       â”‚
  â”‚      â”œâ”€â”€ profile.png â† áº¢nh static                    â”‚
  â”‚      â”œâ”€â”€ logo.svg    â† Logo                           â”‚
  â”‚      â””â”€â”€ fonts/      â† Font files                     â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
  â”‚                                                        â”‚
  â”‚  Dáº¤U CHáº¤M XANH ğŸ”µ = ÄIá»‚M QUAN TRá»ŒNG:                â”‚
  â”‚  â†’ public/ lÃ  thÆ° má»¥c Äáº¶C BIá»†T trong Next.js!       â”‚
  â”‚  â†’ Files trong public/ Ä‘Æ°á»£c serve STATIC!             â”‚
  â”‚  â†’ Truy cáº­p tá»« base URL: /                            â”‚
  â”‚                                                        â”‚
  â”‚  MAPPING:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  public/profile.png  â†’  src="/profile.png"       â”‚  â”‚
  â”‚  â”‚  public/logo.svg     â†’  src="/logo.svg"          â”‚  â”‚
  â”‚  â”‚  public/imgs/a.jpg   â†’  src="/imgs/a.jpg"        â”‚  â”‚
  â”‚  â”‚         â†‘                      â†‘                  â”‚  â”‚
  â”‚  â”‚    ÄÆ°á»ng dáº«n file          URL trÃªn browser       â”‚  â”‚
  â”‚  â”‚    (filesystem)            (base URL = /)         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CODE TÆ¯Æ NG á»¨NG (ngay dÆ°á»›i sÆ¡ Ä‘á»“ trÃªn trang):        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // app/page.tsx                                 â”‚  â”‚
  â”‚  â”‚  import Image from 'next/image'                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  export default function Page() {                â”‚  â”‚
  â”‚  â”‚    return (                                       â”‚  â”‚
  â”‚  â”‚      <Image                                       â”‚  â”‚
  â”‚  â”‚        src="/profile.png"   â† tá»« public/!       â”‚  â”‚
  â”‚  â”‚        alt="Picture of the author"                â”‚  â”‚
  â”‚  â”‚        width={500}          â† PHáº¢I cung cáº¥p     â”‚  â”‚
  â”‚  â”‚        height={500}         â† PHáº¢I cung cáº¥p     â”‚  â”‚
  â”‚  â”‚      />                                           â”‚  â”‚
  â”‚  â”‚    )                                              â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âš ï¸ LÆ¯U Ã:                                            â”‚
  â”‚  â†’ DÃ¹ng string path: PHáº¢I cung cáº¥p width + height!   â”‚
  â”‚  â†’ DÃ¹ng static import: width/height Tá»° Äá»˜NG!         â”‚
  â”‚  â†’ Xem Â§4 Ä‘á»ƒ hiá»ƒu sá»± khÃ¡c biá»‡t!                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Local Images â€” Static Files!

```
  LOCAL IMAGES â€” 2 CÃCH Sá»¬ Dá»¤NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CÃCH 1: String Path (tá»« public/)                â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  <Image                                    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    src="/profile.png"  â† path tá»« public/  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    alt="Author"                            â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    width={500}   â† Báº®T BUá»˜C!             â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    height={500}  â† Báº®T BUá»˜C!             â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  />                                        â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚  â†’ PHáº¢I specify width + height thá»§ cÃ´ng!        â”‚  â”‚
  â”‚  â”‚  â†’ VÃ¬ Next.js khÃ´ng biáº¿t kÃ­ch thÆ°á»›c áº£nh!        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CÃCH 2: Static Import                           â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  import ProfileImage from './profile.png'  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  <Image                                    â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    src={ProfileImage}  â† import trá»±c tiáº¿p â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    alt="Author"                            â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    // width, height Tá»° Äá»˜NG!              â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    // blurDataURL Tá»° Äá»˜NG!                â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚    placeholder="blur"  â† tuá»³ chá»n        â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  />                                        â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG Cáº¦N width + height!                    â”‚  â”‚
  â”‚  â”‚  â†’ Next.js Tá»° Äá»ŒC kÃ­ch thÆ°á»›c tá»« file!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SO SÃNH 2 CÃCH:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                      â”‚ String   â”‚ Static Import   â”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ Nguá»“n áº£nh            â”‚ public/  â”‚ Anywhere (src/) â”‚ â”‚
  â”‚  â”‚ width/height         â”‚ Báº®T BUá»˜C â”‚ Tá»° Äá»˜NG âœ…     â”‚ â”‚
  â”‚  â”‚ blurDataURL          â”‚ Manual   â”‚ Tá»° Äá»˜NG âœ…     â”‚ â”‚
  â”‚  â”‚ placeholder="blur"   â”‚ Cáº§n BDURLâ”‚ Sáºµn sÃ ng âœ…    â”‚ â”‚
  â”‚  â”‚ Build-time optimized â”‚ CÃ³       â”‚ CÃ³              â”‚ â”‚
  â”‚  â”‚ Tree-shakeable       â”‚ KhÃ´ng    â”‚ CÃ³ âœ…           â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Static Import â€” Tá»± Äá»™ng width/height!

```
  STATIC IMPORT â€” BEHIND THE SCENES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  KHI Báº N VIáº¾T:                                        â”‚
  â”‚  import ProfileImage from './profile.png'              â”‚
  â”‚                                                        â”‚
  â”‚  NEXT.JS WEBPACK LOADER Tá»° Äá»˜NG:                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  1. Äá»ŒC file áº£nh profile.png                     â”‚  â”‚
  â”‚  â”‚  2. PHÃ‚N TÃCH metadata (width, height, format)   â”‚  â”‚
  â”‚  â”‚  3. GENERATE blurDataURL (base64 thumbnail)      â”‚  â”‚
  â”‚  â”‚  4. TRáº¢ Vá»€ object:                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  ProfileImage = {                                 â”‚  â”‚
  â”‚  â”‚    src: '/_next/static/media/profile.abc123.png', â”‚  â”‚
  â”‚  â”‚    width: 1200,         â† Tá»° Äá»˜NG!              â”‚  â”‚
  â”‚  â”‚    height: 800,         â† Tá»° Äá»˜NG!              â”‚  â”‚
  â”‚  â”‚    blurDataURL: 'data:image/jpeg;base64,...',     â”‚  â”‚
  â”‚  â”‚    blurWidth: 8,                                  â”‚  â”‚
  â”‚  â”‚    blurHeight: 6,                                 â”‚  â”‚
  â”‚  â”‚  }                                                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BLUR-UP PLACEHOLDER FLOW:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  Trang load â†’ hiá»ƒn thá»‹ áº£nh Má»œ (8x6px blur)   â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â† blurDataURL (tiny!)    â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚                             â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚           â”‚                                       â”‚  â”‚
  â”‚  â”‚           â–¼ áº¢nh gá»‘c load xong                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ Transition SMOOTH sang áº£nh rÃµ!               â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚  ğŸ“· CLEAR IMAGE â”‚  â† áº¢nh gá»‘c (optimized)    â”‚  â”‚
  â”‚  â”‚  â”‚  ğŸ“· CLEAR IMAGE â”‚                             â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Tráº£i nghiá»‡m MÆ¯á»¢T MÃ€, khÃ´ng bá»‹ trá»‘ng!        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// STATIC IMPORT â€” VÃ Dá»¤ Äáº¦Y Äá»¦:
import Image from 'next/image'
import ProfileImage from './profile.png'

export default function Page() {
  return (
    <Image
      src={ProfileImage}
      alt="Picture of the author"
      // width={500}   â† Tá»° Äá»˜NG cung cáº¥p bá»Ÿi static import!
      // height={500}  â† Tá»° Äá»˜NG cung cáº¥p!
      // blurDataURL="data:..."  â† Tá»° Äá»˜NG generate!
      placeholder="blur"  // â† Báº­t blur-up effect!
    />
  )
}
```

---

## Â§5. Remote Images â€” URL Tá»« Server NgoÃ i!

```
  REMOTE IMAGES â€” Sá»° KHÃC BIá»†T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Remote = áº£nh tá»« SERVER KHÃC (S3, CDN, etc.)          â”‚
  â”‚  â†’ Next.js KHÃ”NG CÃ“ quyá»n truy cáº­p file khi build!  â”‚
  â”‚  â†’ PHáº¢I cung cáº¥p thá»§ cÃ´ng: width, height             â”‚
  â”‚                                                        â”‚
  â”‚  VÃ Dá»¤:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  import Image from 'next/image'                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  export default function Page() {                â”‚  â”‚
  â”‚  â”‚    return (                                       â”‚  â”‚
  â”‚  â”‚      <Image                                       â”‚  â”‚
  â”‚  â”‚        src="https://s3.amazonaws.com/             â”‚  â”‚
  â”‚  â”‚             my-bucket/profile.png"                â”‚  â”‚
  â”‚  â”‚        alt="Picture of the author"                â”‚  â”‚
  â”‚  â”‚        width={500}   â† Báº®T BUá»˜C!                â”‚  â”‚
  â”‚  â”‚        height={500}  â† Báº®T BUá»˜C!                â”‚  â”‚
  â”‚  â”‚      />                                           â”‚  â”‚
  â”‚  â”‚    )                                              â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO PHáº¢I CÃ“ width/height?                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  width + height â†’ tÃ­nh ASPECT RATIO!             â”‚  â”‚
  â”‚  â”‚  â†’ Browser RESERVE Ä‘Ãºng khÃ´ng gian!              â”‚  â”‚
  â”‚  â”‚  â†’ NGÄ‚N CLS (layout shift)!                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  VÃ Dá»¤: width=500, height=300                    â”‚  â”‚
  â”‚  â”‚  â†’ ratio = 500/300 = 5:3                         â”‚  â”‚
  â”‚  â”‚  â†’ DÃ¹ áº£nh chÆ°a load, browser giá»¯ tá»· lá»‡ 5:3!   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  THAY THáº¾: DÃ™NG fill PROPERTY!                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  <Image                                           â”‚  â”‚
  â”‚  â”‚    src="https://..."                              â”‚  â”‚
  â”‚  â”‚    alt="..."                                      â”‚  â”‚
  â”‚  â”‚    fill    â† KHÃ”NG cáº§n width/height!             â”‚  â”‚
  â”‚  â”‚  />                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ fill = áº£nh láº¥p Ä‘áº§y PARENT element!            â”‚  â”‚
  â”‚  â”‚  â†’ Parent pháº£i cÃ³ position: relative!            â”‚  â”‚
  â”‚  â”‚  â†’ áº¢nh sáº½ cÃ³ object-fit Ä‘á»ƒ kiá»ƒm soÃ¡t!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  LOCAL vs REMOTE:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚                      â”‚ Local    â”‚ Remote          â”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ src                  â”‚ String / â”‚ URL string      â”‚ â”‚
  â”‚  â”‚                      â”‚ Import   â”‚ (https://...)   â”‚ â”‚
  â”‚  â”‚ width/height         â”‚ Tuá»³     â”‚ Báº®T BUá»˜C       â”‚ â”‚
  â”‚  â”‚ blurDataURL          â”‚ Tá»± Ä‘á»™ng  â”‚ Manual          â”‚ â”‚
  â”‚  â”‚ Build-time optimize  â”‚ CÃ³       â”‚ On-demand       â”‚ â”‚
  â”‚  â”‚ Cáº§n remotePatterns?  â”‚ KhÃ´ng    â”‚ CÃ“! (báº£o máº­t) â”‚ â”‚
  â”‚  â”‚ Cáº§n fill thay tháº¿?   â”‚ CÃ³ thá»ƒ   â”‚ CÃ³ thá»ƒ          â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. remotePatterns â€” Báº£o Máº­t!

```
  REMOTE PATTERNS â€” Táº I SAO Cáº¦N?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  âš ï¸ Báº¢O Máº¬T: Náº¿u cho phÃ©p Báº¤T Ká»² URL nÃ o...        â”‚
  â”‚  â†’ Hacker cÃ³ thá»ƒ inject áº£nh Äá»˜C Háº I!                â”‚
  â”‚  â†’ Hoáº·c lá»£i dá»¥ng Image Optimization API!             â”‚
  â”‚  â†’ DDoS qua viá»‡c load áº£nh liÃªn tá»¥c tá»« URL láº¡!       â”‚
  â”‚                                                        â”‚
  â”‚  â†’ PHáº¢I define WHITELIST trong next.config.js!        â”‚
  â”‚                                                        â”‚
  â”‚  Cáº¤U HÃŒNH:                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // next.config.js                               â”‚  â”‚
  â”‚  â”‚  import type { NextConfig } from 'next'          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  const config: NextConfig = {                    â”‚  â”‚
  â”‚  â”‚    images: {                                     â”‚  â”‚
  â”‚  â”‚      remotePatterns: [                           â”‚  â”‚
  â”‚  â”‚        {                                         â”‚  â”‚
  â”‚  â”‚          protocol: 'https',      â† chá»‰ HTTPS!  â”‚  â”‚
  â”‚  â”‚          hostname: 's3.amazonaws.com',           â”‚  â”‚
  â”‚  â”‚          port: '',               â† default port â”‚  â”‚
  â”‚  â”‚          pathname: '/my-bucket/**',              â”‚  â”‚
  â”‚  â”‚          search: '',             â† no query     â”‚  â”‚
  â”‚  â”‚        },                                        â”‚  â”‚
  â”‚  â”‚      ],                                          â”‚  â”‚
  â”‚  â”‚    },                                             â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚  export default config                           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  PHÃ‚N TÃCH Tá»ªNG FIELD:                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  protocol: 'https'                               â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ cho phÃ©p HTTPS (báº£o máº­t!)               â”‚  â”‚
  â”‚  â”‚  â†’ HTTP sáº½ Bá»Š CHáº¶N!                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  hostname: 's3.amazonaws.com'                    â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ cho phÃ©p domain NÃ€Y!                    â”‚  â”‚
  â”‚  â”‚  â†’ Wildcard: '*.example.com' cho subdomain      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  port: ''                                        â”‚  â”‚
  â”‚  â”‚  â†’ Default port (443 cho HTTPS)                 â”‚  â”‚
  â”‚  â”‚  â†’ CÃ³ thá»ƒ specify: '8080'                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  pathname: '/my-bucket/**'                       â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ cho phÃ©p path Báº®T Äáº¦U báº±ng /my-bucket/ â”‚  â”‚
  â”‚  â”‚  â†’ ** = wildcard (báº¥t ká»³ sub-path nÃ o)          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  search: ''                                      â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cho phÃ©p query string!                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  URL MATCHING:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  âœ… https://s3.amazonaws.com/my-bucket/img.png  â”‚  â”‚
  â”‚  â”‚  âœ… https://s3.amazonaws.com/my-bucket/a/b.jpg  â”‚  â”‚
  â”‚  â”‚  âŒ http://s3.amazonaws.com/my-bucket/img.png   â”‚  â”‚
  â”‚  â”‚     (HTTP, khÃ´ng pháº£i HTTPS!)                    â”‚  â”‚
  â”‚  â”‚  âŒ https://evil.com/my-bucket/img.png          â”‚  â”‚
  â”‚  â”‚     (hostname khÃ¡c!)                             â”‚  â”‚
  â”‚  â”‚  âŒ https://s3.amazonaws.com/other/img.png      â”‚  â”‚
  â”‚  â”‚     (pathname khÃ´ng match /my-bucket/**)         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. SÆ¡ Äá»“ Tá»•ng Há»£p â€” Image Pipeline!

```
  NEXT.JS IMAGE PIPELINE â€” TOÃ€N Bá»˜ FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚                SOURCE                            â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
  â”‚  â”‚  â”‚ LOCAL              â”‚ REMOTE                â”‚  â”‚   â”‚
  â”‚  â”‚  â”‚ /public/img.png   â”‚ https://cdn.com/img   â”‚  â”‚   â”‚
  â”‚  â”‚  â”‚ import from ./img â”‚                        â”‚  â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                â”‚                   â”‚                    â”‚
  â”‚                â–¼                   â–¼                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚            <Image> COMPONENT                     â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
  â”‚  â”‚  â”‚  Props:                                   â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ src (string | StaticImport)         â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ alt (required!)                     â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ width / height (or fill)            â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ placeholder ("blur" | "empty")      â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ priority (disable lazy loading)     â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€ quality (1-100, default 75)         â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â””â”€â”€ sizes (responsive hints)            â”‚   â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                        â”‚                                â”‚
  â”‚                        â–¼                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚         IMAGE OPTIMIZATION API                   â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
  â”‚  â”‚  â”‚  â‘  Detect device (viewport width)        â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â‘¡ Choose optimal size (deviceSizes)     â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â‘¢ Convert format (â†’ WebP if supported)  â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â‘£ Compress (quality setting)            â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  â‘¤ Cache result (CDN / local)            â”‚   â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                        â”‚                                â”‚
  â”‚                        â–¼                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚              OUTPUT TO BROWSER                   â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
  â”‚  â”‚  â”‚  <img                                     â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚    srcset="/_next/image?url=...&w=640,    â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚           /_next/image?url=...&w=1200"    â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚    loading="lazy"  â† native lazy!        â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚    decoding="async"                       â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚    style="..." â† prevent CLS!            â”‚   â”‚   â”‚
  â”‚  â”‚  â”‚  />                                       â”‚   â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  DECISION TREE â€” CHá»ŒN CÃCH NÃ€O?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  áº¢nh á»Ÿ Ä‘Ã¢u?                                           â”‚
  â”‚  â”‚                                                     â”‚
  â”‚  â”œâ”€â”€ Local (trong project)?                            â”‚
  â”‚  â”‚   â”‚                                                 â”‚
  â”‚  â”‚   â”œâ”€â”€ Cáº§n auto width/height + blur?                â”‚
  â”‚  â”‚   â”‚   â””â”€â”€ âœ… Static Import (import from './...')   â”‚
  â”‚  â”‚   â”‚                                                 â”‚
  â”‚  â”‚   â””â”€â”€ áº¢nh trong public/ (shared/favicon)?          â”‚
  â”‚  â”‚       â””â”€â”€ âœ… String Path (src="/...")               â”‚
  â”‚  â”‚           â†’ PHáº¢I set width + height!               â”‚
  â”‚  â”‚                                                     â”‚
  â”‚  â””â”€â”€ Remote (CDN / S3 / external)?                     â”‚
  â”‚      â”‚                                                 â”‚
  â”‚      â”œâ”€â”€ Biáº¿t kÃ­ch thÆ°á»›c áº£nh?                          â”‚
  â”‚      â”‚   â””â”€â”€ âœ… width + height props                  â”‚
  â”‚      â”‚                                                 â”‚
  â”‚      â”œâ”€â”€ KhÃ´ng biáº¿t kÃ­ch thÆ°á»›c?                        â”‚
  â”‚      â”‚   â””â”€â”€ âœ… fill prop (parent = relative)         â”‚
  â”‚      â”‚                                                 â”‚
  â”‚      â””â”€â”€ Config next.config.js!                        â”‚
  â”‚          â””â”€â”€ âœ… remotePatterns (WHITELIST!)            â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Tá»± Viáº¿t â€” ImageOptimizationEngine!

```javascript
var ImageOptimizationEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. IMAGE REGISTRY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var images = [];
  var remotePatterns = [];
  var deviceSizes = [640, 750, 828, 1080, 1200, 1920, 2048, 3840];

  function addRemotePattern(pattern) {
    remotePatterns.push(pattern);
    console.log(
      "  [Config] Added remote pattern:",
      pattern.hostname + pattern.pathname,
    );
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. REGISTER IMAGE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function registerImage(src, options) {
    var img = {
      src: src,
      alt: options.alt || "",
      width: options.width || null,
      height: options.height || null,
      fill: options.fill || false,
      placeholder: options.placeholder || "empty",
      isRemote: src.startsWith("http"),
      isStaticImport: typeof src === "object",
    };

    // Static import simulation
    if (img.isStaticImport) {
      img.width = src.width;
      img.height = src.height;
      img.blurDataURL = src.blurDataURL;
      img.resolvedSrc = src.src;
      console.log(
        "  [Static Import] Auto width=" + img.width + ", height=" + img.height,
      );
    } else {
      img.resolvedSrc = src;
    }

    images.push(img);
    return img;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. VALIDATE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function validate(img) {
    var errors = [];
    if (!img.alt) errors.push("Missing alt text (accessibility!)");
    if (!img.fill && !img.width) errors.push("Missing width (CLS risk!)");
    if (!img.fill && !img.height) errors.push("Missing height (CLS risk!)");

    if (img.isRemote) {
      var allowed = remotePatterns.some(function (pattern) {
        try {
          var url = new URL(img.resolvedSrc);
          var protoMatch =
            !pattern.protocol || url.protocol === pattern.protocol + ":";
          var hostMatch =
            url.hostname === pattern.hostname ||
            (pattern.hostname.startsWith("*") &&
              url.hostname.endsWith(pattern.hostname.slice(1)));
          var pathMatch =
            !pattern.pathname ||
            url.pathname.startsWith(pattern.pathname.replace("/**", ""));
          return protoMatch && hostMatch && pathMatch;
        } catch (e) {
          return false;
        }
      });
      if (!allowed) errors.push("Remote URL not in remotePatterns!");
    }
    return errors;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. OPTIMIZE (simulate)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function optimize(img, viewportWidth) {
    var targetWidth = deviceSizes.reduce(function (prev, curr) {
      return curr >= viewportWidth && (!prev || curr < prev) ? curr : prev;
    }, null);

    var ratio = img.width && img.height ? img.width / img.height : 1;
    var optimizedHeight = Math.round(targetWidth / ratio);
    var originalSize = img.width * img.height * 3; // approx bytes (RGB)
    var webpSize = Math.round(originalSize * 0.3); // WebP ~30% of original

    return {
      originalFormat: "PNG/JPEG",
      outputFormat: "WebP",
      originalWidth: img.width,
      outputWidth: targetWidth,
      outputHeight: optimizedHeight,
      originalSize: (originalSize / 1024).toFixed(0) + "KB",
      optimizedSize: (webpSize / 1024).toFixed(0) + "KB",
      savings: "~70%",
      url:
        "/_next/image?url=" +
        encodeURIComponent(img.resolvedSrc) +
        "&w=" +
        targetWidth,
      lazyLoading: true,
      decodingAsync: true,
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. GENERATE HTML OUTPUT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function generateOutput(img) {
    var errors = validate(img);
    if (errors.length > 0) {
      console.log("  âŒ Validation FAILED:");
      errors.forEach(function (e) {
        console.log("    â†’ " + e);
      });
      return null;
    }

    var srcset = deviceSizes
      .slice(0, 4)
      .map(function (w) {
        return (
          "/_next/image?url=" +
          encodeURIComponent(img.resolvedSrc) +
          "&w=" +
          w +
          " " +
          w +
          "w"
        );
      })
      .join(", ");

    var html = "<img";
    html += ' srcset="' + srcset + '"';
    html += ' src="' + img.resolvedSrc + '"';
    html += ' alt="' + img.alt + '"';
    html += ' loading="lazy"';
    html += ' decoding="async"';
    if (img.width) html += ' width="' + img.width + '"';
    if (img.height) html += ' height="' + img.height + '"';
    html += " />";

    return html;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 6. DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘ IMAGE OPTIMIZATION ENGINE             â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // Config
    addRemotePattern({
      protocol: "https",
      hostname: "s3.amazonaws.com",
      pathname: "/my-bucket/**",
    });

    // Local image (string path)
    console.log("\nâ”â”â” 1. Local Image (String Path) â”â”â”");
    var local = registerImage("/profile.png", {
      alt: "Author",
      width: 500,
      height: 500,
    });
    var localErrors = validate(local);
    console.log(
      "  Validation:",
      localErrors.length === 0 ? "âœ… PASS" : "âŒ FAIL",
    );
    var opt1 = optimize(local, 768);
    console.log(
      "  Optimized for 768px viewport:",
      opt1.outputWidth + "x" + opt1.outputHeight,
    );
    console.log("  Format: " + opt1.originalFormat + " â†’ " + opt1.outputFormat);
    console.log(
      "  Size: " +
        opt1.originalSize +
        " â†’ " +
        opt1.optimizedSize +
        " (savings: " +
        opt1.savings +
        ")",
    );

    // Static import
    console.log("\nâ”â”â” 2. Static Import â”â”â”");
    var staticImg = registerImage(
      {
        src: "/_next/static/media/profile.abc.png",
        width: 1200,
        height: 800,
        blurDataURL: "data:image/jpeg;base64,...",
      },
      { alt: "Author", placeholder: "blur" },
    );
    var staticErrors = validate(staticImg);
    console.log(
      "  Validation:",
      staticErrors.length === 0 ? "âœ… PASS" : "âŒ FAIL",
    );
    console.log("  Placeholder:", staticImg.placeholder, "â†’ blur-up enabled!");

    // Remote image (OK)
    console.log("\nâ”â”â” 3. Remote Image (Allowed) â”â”â”");
    var remote = registerImage("https://s3.amazonaws.com/my-bucket/photo.png", {
      alt: "Photo",
      width: 800,
      height: 600,
    });
    var remoteErrors = validate(remote);
    console.log(
      "  Validation:",
      remoteErrors.length === 0 ? "âœ… PASS" : "âŒ FAIL",
    );

    // Remote image (BLOCKED)
    console.log("\nâ”â”â” 4. Remote Image (BLOCKED!) â”â”â”");
    var blocked = registerImage("https://evil.com/malware.png", {
      alt: "Bad",
      width: 100,
      height: 100,
    });
    validate(blocked); // Will show error

    // Generate HTML
    console.log("\nâ”â”â” 5. Generated HTML â”â”â”");
    var html = generateOutput(local);
    console.log("  " + (html ? html.substring(0, 80) + "..." : "N/A"));
  }

  return { demo: demo };
})();
// Cháº¡y: ImageOptimizationEngine.demo();
```

---

## Â§9. CÃ¢u Há»i Luyá»‡n Táº­p!

**CÃ¢u 1**: `<Image>` component giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬ mÃ  `<img>` HTML khÃ´ng lÃ m Ä‘Æ°á»£c?

<details><summary>ÄÃ¡p Ã¡n</summary>

`<Image>` giáº£i quyáº¿t **4 váº¥n Ä‘á» lá»›n**:

1. **Size optimization**: Tá»± Ä‘á»™ng serve áº£nh Ä‘Ãºng kÃ­ch thÆ°á»›c cho má»—i device (mobile nháº­n áº£nh nhá» hÆ¡n desktop) + convert sang **WebP** (nhá» hÆ¡n 25-35%)
2. **Visual stability (CLS)**: Tá»± Ä‘á»™ng reserve khÃ´ng gian báº±ng width/height â†’ ná»™i dung **khÃ´ng bá»‹ nháº£y** khi áº£nh load
3. **Lazy loading**: Máº·c Ä‘á»‹nh chá»‰ load áº£nh khi **cuá»™n Ä‘áº¿n viewport** + cÃ³ blur-up placeholder
4. **Asset flexibility**: Resize áº£nh **on-demand** ngay cáº£ tá»« remote server â†’ khÃ´ng cáº§n chuáº©n bá»‹ nhiá»u size trÆ°á»›c

</details>

---

**CÃ¢u 2**: Sá»± khÃ¡c biá»‡t giá»¯a string path vÃ  static import cho local images?

<details><summary>ÄÃ¡p Ã¡n</summary>

|                        | String Path            | Static Import                 |
| ---------------------- | ---------------------- | ----------------------------- |
| **CÃº phÃ¡p**            | `src="/img.png"`       | `import img from './img.png'` |
| **Nguá»“n**              | `public/` folder       | Báº¥t ká»³ Ä‘Ã¢u trong `src/`       |
| **width/height**       | **Báº®T BUá»˜C** thá»§ cÃ´ng  | **Tá»° Äá»˜NG** tá»« file metadata  |
| **blurDataURL**        | Pháº£i cung cáº¥p thá»§ cÃ´ng | **Tá»° Äá»˜NG** generate base64   |
| **placeholder="blur"** | Cáº§n blurDataURL        | Sáºµn sÃ ng, chá»‰ cáº§n enable      |

â†’ **Static import Æ°u viá»‡t hÆ¡n** cho áº£nh trong project vÃ¬ tá»± Ä‘á»™ng xá»­ lÃ½ má»i thá»©!

</details>

---

**CÃ¢u 3**: Táº¡i sao cáº§n `remotePatterns` trong `next.config.js`?

<details><summary>ÄÃ¡p Ã¡n</summary>

VÃ¬ **báº£o máº­t**:

1. Náº¿u cho phÃ©p **báº¥t ká»³ URL** nÃ o â†’ hacker cÃ³ thá»ƒ inject áº£nh Ä‘á»™c háº¡i
2. Attacker cÃ³ thá»ƒ **lá»£i dá»¥ng** Image Optimization API (DDoS)
3. `remotePatterns` táº¡o **whitelist** chá»‰ cho phÃ©p domain/path cá»¥ thá»ƒ
4. Config gá»“m: `protocol`, `hostname`, `port`, `pathname`, `search`
5. Pháº£i **cÃ ng specific cÃ ng tá»‘t** â€” vÃ­ dá»¥ chá»‰ cho phÃ©p `https://s3.amazonaws.com/my-bucket/**`

</details>

---

**CÃ¢u 4**: Remote image khÃ¡c local image á»Ÿ Ä‘iá»ƒm nÃ o quan trá»ng nháº¥t?

<details><summary>ÄÃ¡p Ã¡n</summary>

Äiá»ƒm khÃ¡c biá»‡t **quan trá»ng nháº¥t**: Next.js **KHÃ”NG CÃ“ quyá»n truy cáº­p** remote file khi build!

Há»‡ quáº£:

- **PHáº¢I** cung cáº¥p `width` + `height` thá»§ cÃ´ng (hoáº·c dÃ¹ng `fill`)
- **PHáº¢I** config `remotePatterns` (whitelist domain)
- **KHÃ”NG** tá»± Ä‘á»™ng generate `blurDataURL` (pháº£i cung cáº¥p thá»§ cÃ´ng náº¿u muá»‘n blur)
- Optimize **on-demand** táº¡i runtime (khÃ´ng pháº£i build-time)

Thay tháº¿ `width/height`: dÃ¹ng `fill` prop â†’ áº£nh láº¥p Ä‘áº§y parent element (parent cáº§n `position: relative`)

</details>

---

**CÃ¢u 5**: Giáº£i thÃ­ch flow khi browser request má»™t `<Image>` component vá»›i src="/photo.png", width=1200.

<details><summary>ÄÃ¡p Ã¡n</summary>

```
1. React render â†’ <img srcset="/_next/image?url=/photo.png&w=640,
                               /_next/image?url=/photo.png&w=1200,
                               ..." />

2. Browser detect viewport width (e.g. 768px)

3. Browser chá»n áº£nh phÃ¹ há»£p tá»« srcset â†’ request /_next/image?url=/photo.png&w=828

4. Next.js Image Optimization API:
   â‘  Äá»c áº£nh gá»‘c /public/photo.png
   â‘¡ Resize vá» width=828
   â‘¢ Convert format â†’ WebP (náº¿u browser support)
   â‘£ Compress theo quality (default 75)
   â‘¤ Cache káº¿t quáº£

5. Tráº£ áº£nh WebP tá»‘i Æ°u â†’ browser hiá»ƒn thá»‹!
   â†’ loading="lazy" â†’ chá»‰ load khi scroll Ä‘áº¿n!
   â†’ width/height â†’ browser reserve space â†’ NO CLS!
```

</details>
