# React Suspense â€” Deep Dive!

> **Chá»§ Ä‘á»**: React Suspense â€” CÆ¡ Cháº¿ "Chá»" Dá»¯ Liá»‡u + Lazy Loading
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: "React Suspense" â€” Juejin React Basics and Advanced

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Suspense LÃ  GÃ¬?](#1)
2. [Â§2. React.lazy â€” Dynamic Import](#2)
3. [Â§3. CÆ¡ Cháº¿ Hoáº¡t Äá»™ng â€” throw Promise!](#3)
4. [Â§4. wrapPromise â€” Pattern Thá»±c Táº¿](#4)
5. [Â§5. Truyá»n Resource Qua Props](#5)
6. [Â§6. Parallel Fetching â€” Nhiá»u API](#6)
7. [Â§7. Race Conditions â€” Giáº£i Quyáº¿t!](#7)
8. [Â§8. Error Boundary â€” Xá»­ LÃ½ Lá»—i](#8)
9. [Â§9. Source Code â€” Symbol Constant](#9)
10. [Â§10. SÆ¡ Äá»“ Tá»± Váº½](#10)
11. [Â§11. Tá»± Viáº¿t â€” SuspenseEngine](#11)
12. [Â§12. CÃ¢u Há»i Luyá»‡n Táº­p](#12)

---

## Â§1. Tá»•ng Quan â€” Suspense LÃ  GÃ¬?

```
  REACT SUSPENSE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Äá»ŠNH NGHÄ¨A (React 16.6+):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Suspense fallback={<Spinner />}>                    â”‚    â”‚
  â”‚  â”‚   <SomeComponent />                                  â”‚    â”‚
  â”‚  â”‚ </Suspense>                                          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ "Suspense" = Táº M NGÆ¯NG, CHá»œ Äá»¢I!              â”‚    â”‚
  â”‚  â”‚ â†’ Cho phÃ©p component "chá»" thá»© gÃ¬ Ä‘Ã³!             â”‚    â”‚
  â”‚  â”‚ â†’ Trong lÃºc chá» â†’ hiá»ƒn thá»‹ fallback (spinner!)    â”‚    â”‚
  â”‚  â”‚ â†’ Khi xong â†’ hiá»ƒn thá»‹ component tháº­t!             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  2 USE CASE CHÃNH:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  React.lazy â€” Dynamic import component!           â”‚    â”‚
  â”‚  â”‚   â†’ Chá» code chunk LOAD xong!                      â”‚    â”‚
  â”‚  â”‚   â†’ import('./ProfilePage') â†’ Promise!             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ Data Fetching â€” Chá» API response!                â”‚    â”‚
  â”‚  â”‚   â†’ Chá» fetch() tráº£ vá» data!                       â”‚    â”‚
  â”‚  â”‚   â†’ wrapPromise pattern!                            â”‚    â”‚
  â”‚  â”‚   â†’ Giáº£i quyáº¿t Race Conditions!                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÆ  CHáº¾ Cá»T LÃ•I:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Component throw Promise!                             â”‚    â”‚
  â”‚  â”‚   â†“                                                  â”‚    â”‚
  â”‚  â”‚ React báº¯t exception â†’ nháº­n ra lÃ  Promise!          â”‚    â”‚
  â”‚  â”‚   â†“                                                  â”‚    â”‚
  â”‚  â”‚ Hiá»ƒn thá»‹ fallback + .then() vÃ o Promise!            â”‚    â”‚
  â”‚  â”‚   â†“                                                  â”‚    â”‚
  â”‚  â”‚ Promise resolve â†’ .then() trigger!                  â”‚    â”‚
  â”‚  â”‚   â†“                                                  â”‚    â”‚
  â”‚  â”‚ Re-render component â†’ hiá»ƒn thá»‹ data tháº­t!          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. React.lazy â€” Dynamic Import!

```
  REACT.LAZY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  CÃš PHÃP:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // Lazy load component!                              â”‚    â”‚
  â”‚  â”‚ const ProfilePage = React.lazy(                      â”‚    â”‚
  â”‚  â”‚   () => import('./ProfilePage')                      â”‚    â”‚
  â”‚  â”‚ );                                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // DÃ¹ng vá»›i Suspense!                               â”‚    â”‚
  â”‚  â”‚ <Suspense fallback={<Spinner />}>                    â”‚    â”‚
  â”‚  â”‚   <ProfilePage />                                    â”‚    â”‚
  â”‚  â”‚ </Suspense>                                          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLOW:                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  React render <ProfilePage />                     â”‚    â”‚
  â”‚  â”‚ â‘¡ React.lazy() â†’ import('./ProfilePage')           â”‚    â”‚
  â”‚  â”‚ â‘¢ import() tráº£ vá» Promise â†’ CHÆ¯A CÃ“ code!        â”‚    â”‚
  â”‚  â”‚ â‘£ throw Promise! â†’ React báº¯t!                      â”‚    â”‚
  â”‚  â”‚ â‘¤ Hiá»ƒn thá»‹ <Spinner /> (fallback!)                 â”‚    â”‚
  â”‚  â”‚ â‘¥ Code chunk LOAD xong â†’ Promise resolve!         â”‚    â”‚
  â”‚  â”‚ â‘¦ Re-render â†’ hiá»ƒn thá»‹ <ProfilePage /> tháº­t!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Lá»¢I ÃCH:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Code Splitting! KhÃ´ng load ALL code upfront!     â”‚    â”‚
  â”‚  â”‚ â†’ Giáº£m bundle size ban Ä‘áº§u!                        â”‚    â”‚
  â”‚  â”‚ â†’ Load COMPONENT khi Cáº¦N!                         â”‚    â”‚
  â”‚  â”‚ â†’ UX tá»‘t hÆ¡n: nhanh load trang, lazy pháº§n phá»¥!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. CÆ¡ Cháº¿ Hoáº¡t Äá»™ng â€” throw Promise!

```
  CÆ  CHáº¾:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  VÃ Dá»¤ ÄÆ N GIáº¢N:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ let data, promise;                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function fetchData() {                               â”‚    â”‚
  â”‚  â”‚   if (data) return data;  // â‘¢ láº§n 2: CÃ“ data!    â”‚    â”‚
  â”‚  â”‚   promise = new Promise(resolve => {                â”‚    â”‚
  â”‚  â”‚     setTimeout(() => {                               â”‚    â”‚
  â”‚  â”‚       data = 'data fetched';                         â”‚    â”‚
  â”‚  â”‚       resolve();   // â‘¡ 3s sau: resolve!           â”‚    â”‚
  â”‚  â”‚     }, 3000);                                        â”‚    â”‚
  â”‚  â”‚   });                                                â”‚    â”‚
  â”‚  â”‚   throw promise;   // â‘  láº§n 1: throw Promise!     â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function Content() {                                 â”‚    â”‚
  â”‚  â”‚   const data = fetchData();                          â”‚    â”‚
  â”‚  â”‚   return <p>{data}</p>;                              â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function App() {                                     â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <Suspense fallback={'loading data'}>             â”‚    â”‚
  â”‚  â”‚       <Content />                                    â”‚    â”‚
  â”‚  â”‚     </Suspense>                                      â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TIMELINE:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0ms:                                               â”‚    â”‚
  â”‚  â”‚ â†’ React render <Content />                          â”‚    â”‚
  â”‚  â”‚ â†’ fetchData() â†’ data = undefined â†’ throw promise! â”‚    â”‚
  â”‚  â”‚ â†’ React Báº®T exception!                             â”‚    â”‚
  â”‚  â”‚ â†’ Nháº­n ra: Ä‘Ã¢y lÃ  Promise! (not Error!)            â”‚    â”‚
  â”‚  â”‚ â†’ Gáº¯n .then() vÃ o promise!                         â”‚    â”‚
  â”‚  â”‚ â†’ Hiá»ƒn thá»‹ fallback: "loading data"                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ t=3000ms:                                            â”‚    â”‚
  â”‚  â”‚ â†’ setTimeout callback: data = 'data fetched'       â”‚    â”‚
  â”‚  â”‚ â†’ resolve() â†’ .then() cháº¡y!                        â”‚    â”‚
  â”‚  â”‚ â†’ React UPDATE Suspense!                            â”‚    â”‚
  â”‚  â”‚ â†’ Re-render <Content />                             â”‚    â”‚
  â”‚  â”‚ â†’ fetchData() â†’ data CÃ“ Rá»’I â†’ return data!       â”‚    â”‚
  â”‚  â”‚ â†’ KHÃ”NG throw â†’ hiá»ƒn thá»‹ <p>data fetched</p>      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KEY INSIGHT:                                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â˜… throw Promise = "TÃ´i chÆ°a sáºµn sÃ ng!"           â”‚    â”‚
  â”‚  â”‚ â˜… React báº¯t Promise â†’ hiá»ƒn thá»‹ fallback!          â”‚    â”‚
  â”‚  â”‚ â˜… Promise resolve â†’ re-render â†’ data sáºµn sÃ ng!   â”‚    â”‚
  â”‚  â”‚ â˜… throw Error = lá»—i! â†’ ErrorBoundary báº¯t!        â”‚    â”‚
  â”‚  â”‚ â˜… throw Promise â‰  throw Error! React phÃ¢n biá»‡t!  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. wrapPromise â€” Pattern Thá»±c Táº¿!

```
  wrapPromise:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€: Viáº¿t fetchData cho má»—i request = REDUNDANT!       â”‚
  â”‚  GIáº¢I PHÃP: wrapPromise â€” abstract pattern!                 â”‚
  â”‚                                                              â”‚
  â”‚  SOURCE CODE:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ function wrapPromise(promise) {                      â”‚    â”‚
  â”‚  â”‚   let status = 'pending'; // â‘  tráº¡ng thÃ¡i ban Ä‘áº§u!â”‚    â”‚
  â”‚  â”‚   let result;                                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   // Gáº¯n .then() ngay láº­p tá»©c!                     â”‚    â”‚
  â”‚  â”‚   let suspender = promise.then(                      â”‚    â”‚
  â”‚  â”‚     r => {                                           â”‚    â”‚
  â”‚  â”‚       status = 'success'; // â‘¡ thÃ nh cÃ´ng!         â”‚    â”‚
  â”‚  â”‚       result = r;                                    â”‚    â”‚
  â”‚  â”‚     },                                               â”‚    â”‚
  â”‚  â”‚     e => {                                           â”‚    â”‚
  â”‚  â”‚       status = 'error'; // â‘¢ tháº¥t báº¡i!             â”‚    â”‚
  â”‚  â”‚       result = e;                                    â”‚    â”‚
  â”‚  â”‚     }                                                â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   return {                                           â”‚    â”‚
  â”‚  â”‚     read() {                                         â”‚    â”‚
  â”‚  â”‚       if (status === 'pending') {                    â”‚    â”‚
  â”‚  â”‚         throw suspender; // â†’ Suspense báº¯t!       â”‚    â”‚
  â”‚  â”‚       } else if (status === 'error') {               â”‚    â”‚
  â”‚  â”‚         throw result; // â†’ ErrorBoundary báº¯t!     â”‚    â”‚
  â”‚  â”‚       } else if (status === 'success') {             â”‚    â”‚
  â”‚  â”‚         return result; // â†’ render data!            â”‚    â”‚
  â”‚  â”‚       }                                              â”‚    â”‚
  â”‚  â”‚     }                                                â”‚    â”‚
  â”‚  â”‚   };                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Sá»¬ Dá»¤NG:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ const fakeFetch = () =>                              â”‚    â”‚
  â”‚  â”‚   new Promise(res =>                                 â”‚    â”‚
  â”‚  â”‚     setTimeout(() => res('data fetched'), 3000)      â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â˜… Request TRÆ¯á»šC khi render!                     â”‚    â”‚
  â”‚  â”‚ const resource = wrapPromise(fakeFetch());           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function Content() {                                 â”‚    â”‚
  â”‚  â”‚   const data = resource.read(); // throw hoáº·c data!â”‚    â”‚
  â”‚  â”‚   return <p>{data}</p>;                              â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function App() {                                     â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <Suspense fallback={'loading data'}>             â”‚    â”‚
  â”‚  â”‚       <Content />                                    â”‚    â”‚
  â”‚  â”‚     </Suspense>                                      â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Táº I SAO read() LÃ€ METHOD?                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ ÄÃ³ng gÃ³i = DELAYED EXECUTION!                    â”‚    â”‚
  â”‚  â”‚ â†’ Chá»‰ gá»i khi Suspense re-render!                  â”‚    â”‚
  â”‚  â”‚ â†’ Má»—i láº§n gá»i â†’ kiá»ƒm tra status Má»šI NHáº¤T!       â”‚    â”‚
  â”‚  â”‚ â†’ pending â†’ throw! success â†’ return!               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  3 TRáº NG THÃI:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ 'pending'  â†’ throw suspender â†’ Suspense fallback! â”‚    â”‚
  â”‚  â”‚ 'success'  â†’ return result   â†’ render data! âœ…    â”‚    â”‚
  â”‚  â”‚ 'error'    â†’ throw result    â†’ ErrorBoundary! âŒ  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Truyá»n Resource Qua Props!

```
  RESOURCE AS PROPS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€: Request dá»±a trÃªn user action (click, id)?         â”‚
  â”‚  GIáº¢I PHÃP: resource = state, set khi click!                â”‚
  â”‚                                                              â”‚
  â”‚  CODE:                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ const fakeFetch = (id) =>                            â”‚    â”‚
  â”‚  â”‚   new Promise(res =>                                 â”‚    â”‚
  â”‚  â”‚     setTimeout(() => res(id + ' data'), 3000)        â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â‘  Initial resource!                              â”‚    â”‚
  â”‚  â”‚ const initialResource = wrapPromise(fakeFetch(1));   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function Content({ resource }) {                     â”‚    â”‚
  â”‚  â”‚   // â‘¢ Äá»c data tá»« resource prop!                  â”‚    â”‚
  â”‚  â”‚   const data = resource.read();                      â”‚    â”‚
  â”‚  â”‚   return <p>{data}</p>;                              â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function App() {                                     â”‚    â”‚
  â”‚  â”‚   // â‘¡ Resource lÃ  STATE!                           â”‚    â”‚
  â”‚  â”‚   const [resource, setResource] =                    â”‚    â”‚
  â”‚  â”‚     useState(initialResource);                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   // â‘£ Click â†’ táº¡o resource Má»šI!                  â”‚    â”‚
  â”‚  â”‚   const handleClick = (id) => () => {                â”‚    â”‚
  â”‚  â”‚     setResource(wrapPromise(fakeFetch(id)));         â”‚    â”‚
  â”‚  â”‚   };                                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <>                                               â”‚    â”‚
  â”‚  â”‚       <button onClick={handleClick(1)}>tab 1</button>â”‚    â”‚
  â”‚  â”‚       <button onClick={handleClick(2)}>tab 2</button>â”‚    â”‚
  â”‚  â”‚       <Suspense fallback={'loading data'}>           â”‚    â”‚
  â”‚  â”‚         <Content resource={resource} />              â”‚    â”‚
  â”‚  â”‚       </Suspense>                                    â”‚    â”‚
  â”‚  â”‚     </>                                              â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLOW KHI CLICK:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Click "tab 2":                                       â”‚    â”‚
  â”‚  â”‚ â†’ wrapPromise(fakeFetch(2)) â†’ resource Má»šI!       â”‚    â”‚
  â”‚  â”‚ â†’ setResource(newResource) â†’ re-render!            â”‚    â”‚
  â”‚  â”‚ â†’ <Content resource={newResource} />                â”‚    â”‚
  â”‚  â”‚ â†’ resource.read() â†’ status='pending' â†’ throw!     â”‚    â”‚
  â”‚  â”‚ â†’ Suspense: hiá»ƒn thá»‹ "loading data"!               â”‚    â”‚
  â”‚  â”‚ â†’ 3s sau: resolve â†’ re-render â†’ data hiá»ƒn thá»‹!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Parallel Fetching â€” Nhiá»u API!

```
  PARALLEL FETCHING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Æ¯U ÄIá»‚M Lá»šN NHáº¤T Cá»¦A SUSPENSE:                             â”‚
  â”‚  â†’ REQUEST Ä‘Æ°á»£c gá»­i NGAY Tá»ª Äáº¦U (Render-as-you-fetch!)   â”‚
  â”‚                                                              â”‚
  â”‚  SO SÃNH Vá»šI CÅ¨:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ TRÆ¯á»šC (Fetch-on-render):                             â”‚    â”‚
  â”‚  â”‚ â‘  Render component                                  â”‚    â”‚
  â”‚  â”‚ â‘¡ componentDidMount / useEffect                     â”‚    â”‚
  â”‚  â”‚ â‘¢ fetch() â†’ chá» response                           â”‚    â”‚
  â”‚  â”‚ â‘£ setState â†’ re-render!                             â”‚    â”‚
  â”‚  â”‚ â†’ Render TRÆ¯á»šC, request SAU!                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ SAU (Render-as-you-fetch â€” Suspense!):               â”‚    â”‚
  â”‚  â”‚ â‘  fetch() â†’ request NGAY Láº¬P Tá»¨C!                â”‚    â”‚
  â”‚  â”‚ â‘¡ Render component â†’ fallback!                     â”‚    â”‚
  â”‚  â”‚ â‘¢ Response tráº£ vá» â†’ re-render!                     â”‚    â”‚
  â”‚  â”‚ â†’ Request TRÆ¯á»šC, render SAU!                       â”‚    â”‚
  â”‚  â”‚ â†’ NHANH HÆ N! âš¡                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  NESTED SUSPENSE Vá»šI NHIá»€U API:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ function fetchData(id) {                             â”‚    â”‚
  â”‚  â”‚   return {                                           â”‚    â”‚
  â”‚  â”‚     user: wrapPromise(fakeFetchUser(id)),            â”‚    â”‚
  â”‚  â”‚     posts: wrapPromise(fakeFetchPosts(id))           â”‚    â”‚
  â”‚  â”‚   };                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â˜… SONG SONG! Cáº£ 2 API gá»­i CÃ™NG LÃšC!         â”‚    â”‚
  â”‚  â”‚ const resource = fetchData(1);                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ <Suspense fallback={'loading user'}>                 â”‚    â”‚
  â”‚  â”‚   <User resource={resource} />                       â”‚    â”‚
  â”‚  â”‚   <Suspense fallback={'loading posts'}>              â”‚    â”‚
  â”‚  â”‚     <Posts resource={resource} />                    â”‚    â”‚
  â”‚  â”‚   </Suspense>                                        â”‚    â”‚
  â”‚  â”‚ </Suspense>                                          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  3 TRÆ¯á»œNG Há»¢P:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  User tráº£ Vá»€ TRÆ¯á»šC posts:                        â”‚    â”‚
  â”‚  â”‚   â†’ Hiá»ƒn thá»‹ User! + "loading posts"              â”‚    â”‚
  â”‚  â”‚   â†’ Posts tráº£ vá» â†’ hiá»ƒn thá»‹ Posts!                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ Posts tráº£ Vá»€ TRÆ¯á»šC user:                        â”‚    â”‚
  â”‚  â”‚   â†’ Chá»! VÃ¬ outer Suspense chÆ°a resolved!         â”‚    â”‚
  â”‚  â”‚   â†’ User tráº£ vá» â†’ hiá»ƒn thá»‹ CÃ™NG LÃšC User+Posts! â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¢ Cáº£ 2 tráº£ vá» CÃ™NG LÃšC:                           â”‚    â”‚
  â”‚  â”‚   â†’ Hiá»ƒn thá»‹ cáº£ User + Posts! Show!               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SO Vá»šI Promise.all:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Promise.all([fetchUser, fetchPosts]):                â”‚    â”‚
  â”‚  â”‚ â†’ CHá»œ Táº¤T Cáº¢ xong â†’ rá»“i má»›i render!            â”‚    â”‚
  â”‚  â”‚ â†’ 1 reject â†’ Táº¤T Cáº¢ fail! âŒ                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Suspense:                                            â”‚    â”‚
  â”‚  â”‚ â†’ Hiá»ƒn thá»‹ KHI Sáº´N SÃ€NG! Progressive!             â”‚    â”‚
  â”‚  â”‚ â†’ CÃ¡i nÃ o xong TRÆ¯á»šC â†’ show TRÆ¯á»šC!               â”‚    â”‚
  â”‚  â”‚ â†’ Error Independence! 1 fail â‰  all fail! âœ…       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Race Conditions â€” Giáº£i Quyáº¿t!

```
  RACE CONDITIONS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€ (KHÃ”NG CÃ“ SUSPENSE):                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ THá»¨ Tá»° TRUYá»€N THá»NG:                                â”‚    â”‚
  â”‚  â”‚ â‘  Click "Nick" â†’ fetch(Nick)                       â”‚    â”‚
  â”‚  â”‚ â‘¡ Click "Deb" â†’ fetch(Deb)  (Nick chÆ°a tráº£ vá»!) â”‚    â”‚
  â”‚  â”‚ â‘¢ Deb response Äáº¾N TRÆ¯á»šC â†’ setState(Deb)! âœ…    â”‚    â”‚
  â”‚  â”‚ â‘£ Nick response Äáº¾N SAU â†’ setState(Nick)! âŒ     â”‚    â”‚
  â”‚  â”‚ â†’ Hiá»ƒn thá»‹ "Deb" title + "Nick" data! RACE! ğŸ”´   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Thá»© tá»±: Request â†’ Response â†’ setState              â”‚    â”‚
  â”‚  â”‚ Váº¥n Ä‘á»: response ORDER â‰  request ORDER!           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  GIáº¢I PHÃP (SUSPENSE):                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ THá»¨ Tá»° Vá»šI SUSPENSE:                                â”‚    â”‚
  â”‚  â”‚ â‘  Click "Nick" â†’ fetch(Nick) â†’ setState resource! â”‚    â”‚
  â”‚  â”‚ â‘¡ Click "Deb" â†’ fetch(Deb) â†’ setState resource!  â”‚    â”‚
  â”‚  â”‚ â‘¢ Nick response â†’ nhÆ°ng resource ÄÃƒ LÃ€ Deb!     â”‚    â”‚
  â”‚  â”‚ â‘£ Deb response â†’ resource.read() â†’ show Deb! âœ…  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Thá»© tá»±: Request â†’ setState â†’ Response â†’ re-render  â”‚    â”‚
  â”‚  â”‚ â†’ setState ngay TRÆ¯á»šC response!                    â”‚    â”‚
  â”‚  â”‚ â†’ Resource Má»šI NHáº¤T = resource cuá»‘i cÃ¹ng setState!â”‚    â”‚
  â”‚  â”‚ â†’ Response cÅ© ÄÃƒ Bá»Š Bá» QUA vÃ¬ resource Ä‘á»•i!    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CODE:                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ function App() {                                     â”‚    â”‚
  â”‚  â”‚   const [person, setPerson] = useState('Nick');      â”‚    â”‚
  â”‚  â”‚   const [resource, setResource] =                    â”‚    â”‚
  â”‚  â”‚     useState(initialResource);                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   const handleClick = (name) => () => {              â”‚    â”‚
  â”‚  â”‚     setPerson(name);                                 â”‚    â”‚
  â”‚  â”‚     // â˜… setState NGAY! KhÃ´ng chá» response!       â”‚    â”‚
  â”‚  â”‚     setResource(fetchData(name));                    â”‚    â”‚
  â”‚  â”‚   };                                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <>                                               â”‚    â”‚
  â”‚  â”‚       <button onClick={handleClick('Nick')}>Nick     â”‚    â”‚
  â”‚  â”‚       </button>                                      â”‚    â”‚
  â”‚  â”‚       <button onClick={handleClick('Deb')}>Deb      â”‚    â”‚
  â”‚  â”‚       </button>                                      â”‚    â”‚
  â”‚  â”‚       <h1>{person}</h1>                              â”‚    â”‚
  â”‚  â”‚       <Suspense fallback={'loading'}>                â”‚    â”‚
  â”‚  â”‚         <User resource={resource} />                 â”‚    â”‚
  â”‚  â”‚       </Suspense>                                    â”‚    â”‚
  â”‚  â”‚     </>                                              â”‚    â”‚
  â”‚  â”‚   );                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Táº I SAO KHÃ”NG RACE?                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Click "Deb" â†’ setResource(newResource)!          â”‚    â”‚
  â”‚  â”‚ â†’ resource THAY Äá»”I â†’ old resource (Nick) bá»‹ Bá»!â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ Nick response â†’ khÃ´ng ai .read() Nick ná»¯a!  â”‚    â”‚
  â”‚  â”‚ â†’ Suspense re-render â†’ resource Má»šI (Deb) â†’ ok!  â”‚    â”‚
  â”‚  â”‚ â†’ IDENTITY-BASED! Resource object = truth! âœ…     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Error Boundary â€” Xá»­ LÃ½ Lá»—i!

```
  ERROR BOUNDARY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ wrapPromise.read():                                  â”‚    â”‚
  â”‚  â”‚ â†’ throw Promise â†’ Suspense báº¯t! âœ…                â”‚    â”‚
  â”‚  â”‚ â†’ throw Error â†’ AI Báº®T? âŒ â†’ CRASH!              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ React chá»‰ xá»­ lÃ½ throw Promise!                     â”‚    â”‚
  â”‚  â”‚ throw Error â†’ rendering CRASH!                      â”‚    â”‚
  â”‚  â”‚ â†’ Cáº§n ErrorBoundary!                                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CODE ErrorBoundary:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ class ErrorBoundary extends React.Component {        â”‚    â”‚
  â”‚  â”‚   state = { hasError: false, error: null };          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   static getDerivedStateFromError(error) {           â”‚    â”‚
  â”‚  â”‚     return { hasError: true, error };                â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   render() {                                         â”‚    â”‚
  â”‚  â”‚     if (this.state.hasError) {                       â”‚    â”‚
  â”‚  â”‚       return this.props.fallback;                    â”‚    â”‚
  â”‚  â”‚     }                                                â”‚    â”‚
  â”‚  â”‚     return this.props.children;                      â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Sá»¬ Dá»¤NG:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <ErrorBoundary fallback={<h2>Error!</h2>}>           â”‚    â”‚
  â”‚  â”‚   <Suspense fallback={'loading...'}>                 â”‚    â”‚
  â”‚  â”‚     <Content resource={resource} />                  â”‚    â”‚
  â”‚  â”‚   </Suspense>                                        â”‚    â”‚
  â”‚  â”‚ </ErrorBoundary>                                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ FLOW:                                                â”‚    â”‚
  â”‚  â”‚ pending â†’ throw Promise â†’ Suspense! (fallback!)   â”‚    â”‚
  â”‚  â”‚ success â†’ return data   â†’ render! âœ…              â”‚    â”‚
  â”‚  â”‚ error   â†’ throw Error   â†’ ErrorBoundary! âŒ       â”‚    â”‚
  â”‚  â”‚                          â†’ hiá»ƒn thá»‹ "Error!"      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  PHÃ‚N Táº¦NG:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ ErrorBoundary                                        â”‚    â”‚
  â”‚  â”‚   â””â”€â”€ Suspense                                       â”‚    â”‚
  â”‚  â”‚         â””â”€â”€ Content                                   â”‚    â”‚
  â”‚  â”‚               â””â”€â”€ resource.read()                     â”‚    â”‚
  â”‚  â”‚                     â”œâ”€â”€ throw Promise â†’ Suspense!   â”‚    â”‚
  â”‚  â”‚                     â”œâ”€â”€ return data â†’ render!        â”‚    â”‚
  â”‚  â”‚                     â””â”€â”€ throw Error â†’ ErrorBoundary!â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Source Code â€” Symbol Constant!

```
  SOURCE CODE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  React.js:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ import { REACT_SUSPENSE_TYPE }                       â”‚    â”‚
  â”‚  â”‚   from 'shared/ReactSymbols';                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export { REACT_SUSPENSE_TYPE as Suspense };          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Suspense = chá»‰ lÃ  1 CONSTANT! â˜…               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  shared/ReactSymbols.js:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ export const REACT_SUSPENSE_TYPE =                   â”‚    â”‚
  â”‚  â”‚   Symbol.for('react.suspense');                      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â†’ Má»™t Symbol unique!                             â”‚    â”‚
  â”‚  â”‚ // â†’ KhÃ´ng pháº£i component hay function!             â”‚    â”‚
  â”‚  â”‚ // â†’ Chá»‰ lÃ  MARKER Ä‘á»ƒ React nháº­n biáº¿t!            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHI VIáº¾T JSX:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Suspense fallback={'loading'}>                      â”‚    â”‚
  â”‚  â”‚   <Content />                                        â”‚    â”‚
  â”‚  â”‚ </Suspense>                                          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Babel transform sang:                             â”‚    â”‚
  â”‚  â”‚ React.createElement(                                 â”‚    â”‚
  â”‚  â”‚   Suspense,          // = Symbol.for('react.suspense')â”‚   â”‚
  â”‚  â”‚   { fallback: 'loading' },                           â”‚    â”‚
  â”‚  â”‚   React.createElement(Content, null)                 â”‚    â”‚
  â”‚  â”‚ );                                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Suspense = symbol constant!                      â”‚    â”‚
  â”‚  â”‚ // Logic xá»­ lÃ½ náº±m trong React RECONCILER!        â”‚    â”‚
  â”‚  â”‚ // KhÃ´ng náº±m trong component code!                  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KEY INSIGHT:                                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Suspense KHÃ”NG pháº£i component thay nhau!         â”‚    â”‚
  â”‚  â”‚ â†’ Suspense = Symbol marker!                         â”‚    â”‚
  â”‚  â”‚ â†’ React reconciler xem type === REACT_SUSPENSE_TYPEâ”‚    â”‚
  â”‚  â”‚ â†’ Náº¿u Ä‘Ãºng â†’ xá»­ lÃ½ throw Promise logic!          â”‚    â”‚
  â”‚  â”‚ â†’ Logic náº±m trong react-reconciler package!        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. SÆ¡ Äá»“ Tá»± Váº½!

### SÆ¡ Äá»“ 1: Suspense Flow â€” throw Promise!

```
  SUSPENSE FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â‘  React render <Content />                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  â”‚  â”‚ Content  â”‚ â†’ resource.read()                             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â”œâ”€â”€ status='pending' â†’ throw Promise! â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚       â”‚                                            â†“         â”‚
  â”‚       â”‚                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚       â”‚                                     â”‚ Suspense â”‚    â”‚
  â”‚       â”‚                                     â”‚ Báº®T!     â”‚    â”‚
  â”‚       â”‚                                     â”‚ â†’ .then()â”‚    â”‚
  â”‚       â”‚                                     â”‚ â†’ fallbk â”‚    â”‚
  â”‚       â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚       â”‚                                            â”‚         â”‚
  â”‚       â”‚         Promise resolves! â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚       â”‚                                                      â”‚
  â”‚  â‘¡ Re-render <Content />                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
  â”‚  â”‚ Content  â”‚ â†’ resource.read()                             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â””â”€â”€ status='success' â†’ return data! âœ…                â”‚
  â”‚           â†’ <p>data fetched</p>                             â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 2: Fetch-on-render vs Render-as-you-fetch

```
  2 APPROACHES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  FETCH-ON-RENDER (truyá»n thá»‘ng):                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0    [Render Parent]                               â”‚    â”‚
  â”‚  â”‚ t=1    [Render Child ][mount!]                       â”‚    â”‚
  â”‚  â”‚ t=2              [fetch()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€]              â”‚    â”‚
  â”‚  â”‚ t=5                                   [setState]     â”‚    â”‚
  â”‚  â”‚ t=6                                   [Re-render]    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Render TRÆ¯á»šC! Request SAU!                       â”‚    â”‚
  â”‚  â”‚ â†’ Waterfall: parent render â†’ child mount â†’ fetch! â”‚    â”‚
  â”‚  â”‚ â†’ CHáº¬M! âŒ                                        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  RENDER-AS-YOU-FETCH (Suspense!):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0    [fetch()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€]                        â”‚    â”‚
  â”‚  â”‚ t=0    [Render â†’ fallback!]                         â”‚    â”‚
  â”‚  â”‚ t=3                         [resolve]                â”‚    â”‚
  â”‚  â”‚ t=3                         [Re-render â†’ data!]     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Request + Render CÃ™NG LÃšC!                      â”‚    â”‚
  â”‚  â”‚ â†’ fetch() SONG SONG vá»›i render!                    â”‚    â”‚
  â”‚  â”‚ â†’ NHANH HÆ N! âš¡ âœ…                                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 3: Nested Suspense â€” Parallel APIs

```
  NESTED SUSPENSE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  t=0: fetch(user) + fetch(posts) SONG SONG!                 â”‚
  â”‚                                                              â”‚
  â”‚  CASE 1: User tráº£ Vá»€ TRÆ¯á»šC!                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0:  [fetch userâ”€â”€â”€â”€][fetch postsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€]       â”‚    â”‚
  â”‚  â”‚ t=0:  [loading user...]                              â”‚    â”‚
  â”‚  â”‚ t=2:  User done! â†’ [Show User] + [loading posts..] â”‚    â”‚
  â”‚  â”‚ t=4:  Posts done! â†’ [Show User] + [Show Posts] âœ…  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CASE 2: Posts tráº£ Vá»€ TRÆ¯á»šC!                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0:  [fetch userâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€][fetch postsâ”€â”€â”€â”€]       â”‚    â”‚
  â”‚  â”‚ t=0:  [loading user...]                              â”‚    â”‚
  â”‚  â”‚ t=2:  Posts done! â†’ VáºªN chá» User (outer Suspense!) â”‚    â”‚
  â”‚  â”‚ t=4:  User done! â†’ [Show User] + [Show Posts] âœ…  â”‚    â”‚
  â”‚  â”‚        (hiá»ƒn thá»‹ CÃ™NG LÃšC vÃ¬ outer resolve!)       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 4: Race Conditions â€” Truyá»n Thá»‘ng vs Suspense

```
  RACE CONDITIONS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  TRUYá»€N THá»NG (RACE!):                                       â”‚
  â”‚  Click Nick â†’ Click Deb (nhanh!)                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0: fetch(Nick)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[res Nick]    â”‚    â”‚
  â”‚  â”‚ t=1:      fetch(Deb)â”€â”€â”€â”€â”€â”€[res Deb]                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ t=3: setState(Deb) â† Deb response! Title="Deb"    â”‚    â”‚
  â”‚  â”‚ t=5: setState(Nick) â† Nick response! DATA="Nick"   â”‚    â”‚
  â”‚  â”‚ â†’ Title: "Deb" + Data: "Nick" = SAAAI! ğŸ”´         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SUSPENSE (NO RACE!):                                        â”‚
  â”‚  Click Nick â†’ Click Deb (nhanh!)                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ t=0: fetch(Nick) + setResource(nickResource)        â”‚    â”‚
  â”‚  â”‚ t=1: fetch(Deb) + setResource(debResource) â˜…      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ resource = debResource! (latest setState!)          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ t=3: Nick response â†’ nhÆ°ng NOBODY reads nickRes!   â”‚    â”‚
  â”‚  â”‚ t=4: Deb response â†’ debResource.read() â†’ data! âœ… â”‚    â”‚
  â”‚  â”‚ â†’ Title: "Deb" + Data: "Deb" = ÄÃšNG! ğŸŸ¢          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 5: Error Handling Layers

```
  ERROR HANDLING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ ErrorBoundary                            â”‚                â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
  â”‚  â”‚ â”‚ Suspense                            â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ Content                         â”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ resource.read()             â”‚ â”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚                             â”‚ â”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ pending â†’ throw Promise â”€â”€â†’ â”‚Sâ”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ success â†’ return data   â”€â”€â†’ render! â”‚               â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ error   â†’ throw Error   â”€â”€â†’ â”‚ â”‚Eâ”‚ â”‚               â”‚
  â”‚  â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚                â”‚
  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚                â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚                                                              â”‚
  â”‚  S = Suspense catches Promise â†’ fallback!                   â”‚
  â”‚  E = ErrorBoundary catches Error â†’ error UI!                â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. Tá»± Viáº¿t â€” SuspenseEngine!

```javascript
/**
 * SuspenseEngine â€” MÃ´ phá»ng React Suspense!
 * Tá»± viáº¿t báº±ng tay, KHÃ”NG dÃ¹ng thÆ° viá»‡n!
 */
var SuspenseEngine = (function () {

  var log = [];
  var fakeTime = 0;
  function reset() { log = []; fakeTime = 0; }
  function advance(ms) { fakeTime += ms; }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. wrapPromise â€” CORE PATTERN!
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function wrapPromise(promiseFactory, delay) {
    var status = 'pending';
    var result = null;

    // Simulate promise
    var resolveTime = fakeTime + delay;

    return {
      _resolveTime: resolveTime,
      _status: function () { return status; },
      _tryResolve: function (currentTime) {
        if (status === 'pending' && currentTime >= resolveTime) {
          status = 'success';
          result = promiseFactory;
        }
      },
      read: function () {
        if (status === 'pending') {
          return { thrown: 'promise', value: 'Promise<pending>' };
        } else if (status === 'error') {
          return { thrown: 'error', value: result };
        } else {
          return { thrown: false, value: result };
        }
      }
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. Suspense SIMULATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateSuspense(resource, fallbackText) {
    var readResult = resource.read();

    if (readResult.thrown === 'promise') {
      log.push('t=' + fakeTime + 'ms: Suspense â†’ fallback: "' +
        fallbackText + '"');
      return { display: fallbackText, status: 'suspended' };
    } else if (readResult.thrown === 'error') {
      log.push('t=' + fakeTime + 'ms: ErrorBoundary â†’ error!');
      return { display: 'ERROR!', status: 'error' };
    } else {
      log.push('t=' + fakeTime + 'ms: Rendered â†’ "' +
        readResult.value + '"');
      return { display: readResult.value, status: 'resolved' };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. RACE CONDITIONS SIMULATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateRaceConditions(usesSuspense) {
    log.push('=== Race Conditions (' +
      (usesSuspense ? 'Suspense' : 'Traditional') + ') ===');

    if (!usesSuspense) {
      // Traditional: setState on response!
      var stateData = null;
      var stateTitle = null;

      // Click Nick
      stateTitle = 'Nick'; // instant
      log.push('t=0: Click Nick! title=' + stateTitle);

      // Click Deb before Nick responds
      advance(500);
      stateTitle = 'Deb'; // instant
      log.push('t=' + fakeTime + 'ms: Click Deb! title=' + stateTitle);

      // Deb responds first!
      advance(1500);
      stateData = 'Deb data';
      log.push('t=' + fakeTime + 'ms: Deb response â†’ data=' + stateData);

      // Nick responds later!
      advance(2000);
      stateData = 'Nick data'; // OVERWRITES!
      log.push('t=' + fakeTime + 'ms: Nick response â†’ data=' + stateData);

      log.push('RESULT: title="' + stateTitle + '" data="' +
        stateData + '" â†’ MISMATCH! ğŸ”´');

      return { title: stateTitle, data: stateData, race: true };

    } else {
      // Suspense: setState resource immediately!
      var currentResource = null;

      // Click Nick
      reset();
      currentResource = wrapPromise('Nick data', 4000);
      log.push('t=0: Click Nick â†’ setResource(nickRes)');

      // Click Deb
      advance(500);
      currentResource = wrapPromise('Deb data', 2000);
      log.push('t=' + fakeTime + 'ms: Click Deb â†’ setResource(debRes) â˜…');

      // Tick time until Deb resolves
      advance(2000);
      currentResource._tryResolve(fakeTime);
      var result = simulateSuspense(currentResource, 'loading...');

      log.push('RESULT: resource=Deb data â†’ CORRECT! ğŸŸ¢');

      return { title: 'Deb', data: result.display, race: false };
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. PARALLEL FETCH SIMULATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateParallelFetch() {
    log.push('=== Parallel Fetch ===');
    reset();

    var userResource = wrapPromise('User: John', 2000);
    var postsResource = wrapPromise('Posts: [1,2,3]', 4000);
    log.push('t=0: fetch(user) + fetch(posts) SONG SONG!');

    // t=0: both pending
    simulateSuspense(userResource, 'loading user');
    simulateSuspense(postsResource, 'loading posts');

    // t=2000: user resolves
    advance(2000);
    userResource._tryResolve(fakeTime);
    postsResource._tryResolve(fakeTime);
    simulateSuspense(userResource, 'loading user');
    simulateSuspense(postsResource, 'loading posts');

    // t=4000: posts resolves
    advance(2000);
    postsResource._tryResolve(fakeTime);
    simulateSuspense(userResource, 'loading user');
    simulateSuspense(postsResource, 'loading posts');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. wrapPromise STATE MACHINE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demoStateMachine() {
    log.push('=== wrapPromise State Machine ===');
    reset();

    var resource = wrapPromise('data fetched!', 3000);

    // pending
    var r1 = resource.read();
    log.push('t=0: read() â†’ thrown=' + r1.thrown + ' (PENDING â†’ Suspense!)');

    // still pending
    advance(1500);
    resource._tryResolve(fakeTime);
    var r2 = resource.read();
    log.push('t=' + fakeTime + 'ms: read() â†’ thrown=' + r2.thrown +
      ' (still pending!)');

    // resolved!
    advance(1500);
    resource._tryResolve(fakeTime);
    var r3 = resource.read();
    log.push('t=' + fakeTime + 'ms: read() â†’ thrown=' + r3.thrown +
      ' value="' + r3.value + '" âœ…');
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  SUSPENSE ENGINE â€” DEMO                     â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    // 1. State Machine
    console.log('\n--- 1. wrapPromise State Machine ---');
    reset();
    demoStateMachine();
    log.forEach(function (l) { console.log('  ' + l); });

    // 2. Parallel Fetch
    console.log('\n--- 2. Parallel Fetch ---');
    reset();
    simulateParallelFetch();
    log.forEach(function (l) { console.log('  ' + l); });

    // 3. Race Conditions â€” Traditional
    console.log('\n--- 3. Race Conditions â€” Traditional ---');
    reset();
    simulateRaceConditions(false);
    log.forEach(function (l) { console.log('  ' + l); });

    // 4. Race Conditions â€” Suspense
    console.log('\n--- 4. Race Conditions â€” Suspense ---');
    reset();
    simulateRaceConditions(true);
    log.forEach(function (l) { console.log('  ' + l); });

    console.log('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  âœ… Demo Complete!                           â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  }

  return {
    wrapPromise: wrapPromise,
    simulateSuspense: simulateSuspense,
    simulateRaceConditions: simulateRaceConditions,
    simulateParallelFetch: simulateParallelFetch,
    demo: demo, reset: reset
  };
})();

// Cháº¡y: SuspenseEngine.demo();
```

---

## Â§12. CÃ¢u Há»i Luyá»‡n Táº­p!

### â“ CÃ¢u 1: React Suspense lÃ  gÃ¬?

**Tráº£ lá»i:**

- Component cho phÃ©p **"chá»"** thá»© gÃ¬ Ä‘Ã³ (code chunk, data...)!
- Trong lÃºc chá» â†’ hiá»ƒn thá»‹ **fallback** (spinner, text...)!
- Khi sáºµn sÃ ng â†’ hiá»ƒn thá»‹ **component tháº­t**!
- React 16.6+ giá»›i thiá»‡u!
- 2 use cases: **React.lazy** (code splitting) + **Data fetching**!

### â“ CÃ¢u 2: CÆ¡ cháº¿ throw Promise hoáº¡t Ä‘á»™ng tháº¿ nÃ o?

**Tráº£ lá»i:**

```
â‘  Component render â†’ resource.read()
â‘¡ status = 'pending' â†’ throw Promise!
â‘¢ React Báº®T exception â†’ nháº­n ra lÃ  Promise (khÃ´ng pháº£i Error!)
â‘£ Gáº¯n .then() vÃ o Promise â†’ hiá»ƒn thá»‹ fallback!
â‘¤ Promise resolve â†’ .then() trigger!
â‘¥ React re-render Suspense â†’ component render láº¡i
â‘¦ resource.read() â†’ status = 'success' â†’ return data!
â‘§ Hiá»ƒn thá»‹ data tháº­t! âœ…
```

### â“ CÃ¢u 3: wrapPromise cÃ³ 3 tráº¡ng thÃ¡i gÃ¬?

**Tráº£ lá»i:**

| Status | read() action | Catch bá»Ÿi |
|---|---|---|
| `pending` | **throw suspender** (Promise!) | **Suspense** â†’ fallback! |
| `success` | **return result** (data!) | Render bÃ¬nh thÆ°á»ng! âœ… |
| `error` | **throw result** (Error!) | **ErrorBoundary** â†’ error UI! âŒ |

- `read()` lÃ  **method** â†’ delayed execution â†’ gá»i khi re-render!
- Má»—i láº§n gá»i â†’ kiá»ƒm tra status Má»šI NHáº¤T!

### â“ CÃ¢u 4: Render-as-you-fetch khÃ¡c gÃ¬ Fetch-on-render?

**Tráº£ lá»i:**

| | Fetch-on-render | Render-as-you-fetch |
|---|---|---|
| Thá»© tá»± | Render â†’ mount â†’ fetch | fetch + render **CÃ™NG LÃšC!** |
| Waterfall | CÃ³! Parent â†’ child â†’ fetch | KHÃ”NG! Parallel! |
| Tá»‘c Ä‘á»™ | CHáº¬M âŒ | NHANH âš¡ âœ… |
| Multi-API | Promise.all (chá» ALL) | Progressive (show khi sáºµn!) |

### â“ CÃ¢u 5: Suspense giáº£i quyáº¿t Race Conditions tháº¿ nÃ o?

**Tráº£ lá»i:**

**Truyá»n thá»‘ng**: Request â†’ Response â†’ setState
- Response order â‰  request order â†’ **RACE!**

**Suspense**: Request â†’ **setState resource** â†’ Response â†’ re-render
- setState **NGAY** khi click! Resource má»›i THAY THáº¾ resource cÅ©!
- Response cÅ© â†’ **khÃ´ng ai .read()** resource cÅ© ná»¯a!
- **Identity-based**: resource object hiá»‡n táº¡i = truth!
- â†’ **KHÃ”NG BAO GIá»œ** race! âœ…

### â“ CÃ¢u 6: Suspense trong source code React lÃ  gÃ¬?

**Tráº£ lá»i:**

- `Suspense` = **Symbol constant**: `Symbol.for('react.suspense')`!
- **KHÃ”NG pháº£i** component hay function!
- Chá»‰ lÃ  **MARKER** Ä‘á»ƒ React reconciler nháº­n biáº¿t!
- Logic xá»­ lÃ½ náº±m trong **react-reconciler** package!
- JSX `<Suspense>` â†’ `createElement(REACT_SUSPENSE_TYPE, { fallback })`!

### â“ CÃ¢u 7: ErrorBoundary + Suspense phá»‘i há»£p tháº¿ nÃ o?

**Tráº£ lá»i:**

```
ErrorBoundary (báº¯t Error)
  â””â”€â”€ Suspense (báº¯t Promise)
        â””â”€â”€ Content
              â””â”€â”€ resource.read()
                    â”œâ”€â”€ throw Promise â†’ Suspense! (fallback!)
                    â”œâ”€â”€ return data â†’ render! âœ…
                    â””â”€â”€ throw Error â†’ ErrorBoundary! (error UI!) âŒ
```

- **Suspense** chá»‰ báº¯t **Promise** â†’ pending state!
- **ErrorBoundary** báº¯t **Error** â†’ error state!
- Káº¿t há»£p cáº£ 2 â†’ xá»­ lÃ½ **Äáº¦Y Äá»¦** 3 tráº¡ng thÃ¡i: pending, success, error!

---

> ğŸ¯ **Tá»•ng káº¿t React Suspense:**
> - **Suspense**: component "chá»" â†’ fallback â†’ data tháº­t!
> - **CÆ¡ cháº¿**: throw Promise â†’ React báº¯t â†’ .then() â†’ re-render!
> - **wrapPromise**: 3 status (pending/success/error), read() method!
> - **React.lazy**: dynamic import â†’ code splitting!
> - **Render-as-you-fetch**: fetch + render CÃ™NG LÃšC â†’ nhanh hÆ¡n!
> - **Nested Suspense**: nhiá»u API song song, progressive display!
> - **Race Conditions**: setState resource NGAY â†’ identity-based â†’ no race!
> - **ErrorBoundary**: báº¯t Error, Suspense báº¯t Promise â†’ Ä‘áº§y Ä‘á»§!
> - **Source code**: Suspense = Symbol.for('react.suspense') â†’ marker!
> - **SuspenseEngine** tá»± viáº¿t: wrapPromise, race sim, parallel fetch!
> - **7 cÃ¢u há»i** luyá»‡n táº­p vá»›i Ä‘Ã¡p Ã¡n chi tiáº¿t!
