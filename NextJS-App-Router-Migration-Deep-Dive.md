# Next.js App Router Migration â€” Deep Dive!

> **Chá»§ Ä‘á»**: Di Chuyá»ƒn Tá»« Pages Router Sang App Router!
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/guides/migrating/app-router-migration
> **LÆ°u Ã½**: Trang gá»‘c KHÃ”NG cÃ³ sÆ¡ Ä‘á»“ â€” táº¥t cáº£ diagrams lÃ  Tá»° Váº¼!

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Táº¡i Sao Migration](#1)
2. [Â§2. Upgrading â€” Versions](#2)
3. [Â§3. New Features â€” Image/Link/Script/Font](#3)
4. [Â§4. Step 1-2: app Dir + Root Layout](#4)
5. [Â§5. Step 3-4: next/head + Pages Migration](#5)
6. [Â§6. Step 5: Routing Hooks Migration](#6)
7. [Â§7. Step 6: Data Fetching Migration](#7)
8. [Â§8. Step 7: Styling + Coexistence + Codemods](#8)
9. [Â§9. Tá»± Viáº¿t â€” MigrationEngine](#9)
10. [Â§10. CÃ¢u Há»i Luyá»‡n Táº­p](#10)

---

## Â§1. Tá»•ng Quan â€” Táº¡i Sao Migration!

```
  PAGES ROUTER vs APP ROUTER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  Pages Router (cÅ©):                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ pages/                                               â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ _app.js        â† Global wrapper                â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ _document.js   â† HTML structure                â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ _error.js      â† Error page                    â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ 404.js         â† Not found                     â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ index.js       â† Route: /                      â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ about.js       â† Route: /about                 â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ blog/[slug].js â† Dynamic route                 â”‚  â”‚
  â”‚  â”‚ â””â”€â”€ api/hello.js   â† API route                     â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Data: getServerSideProps, getStaticProps             â”‚  â”‚
  â”‚  â”‚ Components: ALL are Client Components!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  App Router (má»›i):                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ app/                                                 â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ layout.tsx    â† Root layout (thay _app+_doc)   â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ page.tsx      â† Route: /                       â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ error.tsx     â† Error boundary                 â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ not-found.tsx â† Not found                      â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ about/                                          â”‚  â”‚
  â”‚  â”‚ â”‚   â””â”€â”€ page.tsx  â† Route: /about                  â”‚  â”‚
  â”‚  â”‚ â”œâ”€â”€ blog/[slug]/                                    â”‚  â”‚
  â”‚  â”‚ â”‚   â””â”€â”€ page.tsx  â† Dynamic route                  â”‚  â”‚
  â”‚  â”‚ â””â”€â”€ api/hello/                                      â”‚  â”‚
  â”‚  â”‚     â””â”€â”€ route.ts  â† Route Handler                  â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Data: async Server Components + fetch()             â”‚  â”‚
  â”‚  â”‚ Components: Server Components by DEFAULT!            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  KEY: CÃ“ THá»‚ CHáº Y Äá»’NG THá»œI!                            â”‚
  â”‚  pages/ + app/ cÃ¹ng tá»“n táº¡i â†’ migrate Tá»ªNG TRANG!      â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  MAPPING TABLE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Pages Router            â”‚ App Router                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ pages/_app.js           â”‚ app/layout.tsx               â”‚
  â”‚ pages/_document.js      â”‚ app/layout.tsx               â”‚
  â”‚ pages/_error.js         â”‚ app/error.tsx                â”‚
  â”‚ pages/404.js            â”‚ app/not-found.tsx            â”‚
  â”‚ pages/index.js          â”‚ app/page.tsx                 â”‚
  â”‚ pages/about.js          â”‚ app/about/page.tsx           â”‚
  â”‚ pages/blog/[slug].js    â”‚ app/blog/[slug]/page.tsx     â”‚
  â”‚ pages/api/hello.js      â”‚ app/api/hello/route.ts       â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ getServerSideProps       â”‚ fetch(url, {cache:'no-store'})â”‚
  â”‚ getStaticProps           â”‚ fetch(url) (force-cache)     â”‚
  â”‚ getStaticPaths           â”‚ generateStaticParams         â”‚
  â”‚ fallback: true/false     â”‚ dynamicParams: true/false    â”‚
  â”‚ revalidate: 60           â”‚ next: { revalidate: 60 }     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ next/head                â”‚ export const metadata        â”‚
  â”‚ next/router (useRouter)  â”‚ next/navigation (useRouter)  â”‚
  â”‚ router.pathname          â”‚ usePathname()                â”‚
  â”‚ router.query             â”‚ useSearchParams() + useParamsâ”‚
  â”‚ getLayout pattern        â”‚ layout.tsx (native)          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Upgrading â€” Versions!

```
  VERSION REQUIREMENTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  â‘  Node.js: v18.17+ (tá»‘i thiá»ƒu!)                       â”‚
  â”‚  â‘¡ Next.js: v13+ (App Router available)                 â”‚
  â”‚     v13.4+ recommended (stable App Router!)             â”‚
  â”‚  â‘¢ ESLint: eslint-config-next@latest                    â”‚
  â”‚                                                          â”‚
  â”‚  COMMANDS:                                                â”‚
  â”‚  pnpm add next@latest react@latest react-dom@latest     â”‚
  â”‚  pnpm add -D eslint-config-next@latest                  â”‚
  â”‚                                                          â”‚
  â”‚  âš ï¸ Restart ESLint server sau update:                   â”‚
  â”‚  Cmd+Shift+P â†’ "ESLint: Restart ESLint Server"        â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. New Features â€” Image/Link/Script/Font!

```
  4 FEATURES Má»šI (dÃ¹ng Ä‘Æ°á»£c cáº£ pages + app):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  â‘  <Image/> Component:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: next/image (old) â†’ next/legacy/image        â”‚  â”‚
  â”‚  â”‚ AFTER:  next/future/image â†’ next/image (default!)   â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Cáº£i tiáº¿n: Ã­t client JS, native lazy loading,       â”‚  â”‚
  â”‚  â”‚ dá»… style, better accessibility!                     â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Codemods:                                            â”‚  â”‚
  â”‚  â”‚ 1. next-image-to-legacy-image (rename imports)      â”‚  â”‚
  â”‚  â”‚ 2. next-image-experimental (add inline styles)      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¡ <Link> Component:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: <Link href="/about"><a>About</a></Link>     â”‚  â”‚
  â”‚  â”‚ AFTER:  <Link href="/about">About</Link>            â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â†’ <a> tag KHÃ”NG cáº§n ná»¯a! Auto render <a>!         â”‚  â”‚
  â”‚  â”‚ â†’ Codemod: new-link                                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¢ <Script> Component:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ â†’ beforeInteractive: _document.js â†’ app/layout.tsx â”‚  â”‚
  â”‚  â”‚ â†’ worker strategy: KHÃ”NG hoáº¡t Ä‘á»™ng trong app!     â”‚  â”‚
  â”‚  â”‚ â†’ onLoad/onReady/onError: pháº£i á»Ÿ Client Component! â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘£ Font Optimization:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: Inline font CSS (chá»‰ pages)                â”‚  â”‚
  â”‚  â”‚ AFTER:  next/font module (cáº£ pages + app!)         â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â†’ Performance + privacy!                            â”‚  â”‚
  â”‚  â”‚ â†’ Inline CSS KHÃ”NG hoáº¡t Ä‘á»™ng trong app!            â”‚  â”‚
  â”‚  â”‚ â†’ PHáº¢I dÃ¹ng next/font trong app!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Step 1-2: app Dir + Root Layout!

```
  STEP 1: Táº O app/ DIR:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  pnpm add next@latest  (â‰¥ 13.4)                         â”‚
  â”‚  mkdir app/            (hoáº·c src/app/)                   â”‚
  â”‚                                                          â”‚
  â”‚  my-project/                                              â”‚
  â”‚  â”œâ”€â”€ app/              â† Má»šI!                          â”‚
  â”‚  â”œâ”€â”€ pages/            â† VáºªN GIá»®!                     â”‚
  â”‚  â”œâ”€â”€ next.config.js                                      â”‚
  â”‚  â””â”€â”€ package.json                                        â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  STEP 2: ROOT LAYOUT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  TRÆ¯á»šC (2 files):                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ pages/_app.js:    Global providers, styles         â”‚  â”‚
  â”‚  â”‚ pages/_document.js: <html>, <body>, <head>         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                          â”‚
  â”‚  SAU (1 file):                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ app/layout.tsx:                                    â”‚  â”‚
  â”‚  â”‚ export default function RootLayout({ children }) { â”‚  â”‚
  â”‚  â”‚   return (                                         â”‚  â”‚
  â”‚  â”‚     <html lang="en">                               â”‚  â”‚
  â”‚  â”‚       <body>{children}</body>                       â”‚  â”‚
  â”‚  â”‚     </html>                                        â”‚  â”‚
  â”‚  â”‚   )                                                â”‚  â”‚
  â”‚  â”‚ }                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                          â”‚
  â”‚  QUY Táº®C:                                                â”‚
  â”‚  â†’ app/ Báº®T BUá»˜C cÃ³ root layout!                      â”‚
  â”‚  â†’ PHáº¢I define <html> + <body>!                        â”‚
  â”‚  â†’ Copy global styles + providers tá»« _app.js          â”‚
  â”‚  â†’ GIá»® _app/_document cho Ä‘áº¿n khi migrate xong pages!â”‚
  â”‚  â†’ React Context providers â†’ Client Component!        â”‚
  â”‚                                                          â”‚
  â”‚  getLayout() pattern â†’ native layout.tsx:               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ TRÆ¯á»šC: Page.getLayout = (page) => <Layout>{page}  â”‚  â”‚
  â”‚  â”‚                        </Layout>                    â”‚  â”‚
  â”‚  â”‚                                                    â”‚  â”‚
  â”‚  â”‚ SAU:   app/dashboard/layout.tsx (automatic!)       â”‚  â”‚
  â”‚  â”‚        app/dashboard/page.tsx                       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Step 3-4: next/head + Pages Migration!

```
  STEP 3: METADATA (thay next/head):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  TRÆ¯á»šC:                                                   â”‚
  â”‚  import Head from 'next/head'                            â”‚
  â”‚  <Head><title>My Page</title></Head>                     â”‚
  â”‚                                                          â”‚
  â”‚  SAU:                                                     â”‚
  â”‚  export const metadata: Metadata = {                     â”‚
  â”‚    title: 'My Page',                                     â”‚
  â”‚    description: 'Welcome...',                            â”‚
  â”‚  }                                                       â”‚
  â”‚                                                          â”‚
  â”‚  â†’ KhÃ´ng cáº§n import component!                          â”‚
  â”‚  â†’ Export trá»±c tiáº¿p tá»« page/layout!                    â”‚
  â”‚  â†’ Next.js tá»± xá»­ lÃ½ <head>!                           â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  STEP 4: PAGE MIGRATION (2 bÆ°á»›c má»—i page):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  BÆ°á»›c A: Extract Client Component                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ // app/home-page.tsx                                 â”‚  â”‚
  â”‚  â”‚ 'use client'                                         â”‚  â”‚
  â”‚  â”‚ export default function HomePage({ recentPosts }) {  â”‚  â”‚
  â”‚  â”‚   return <div>...</div>  // State, effects, etc.    â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  BÆ°á»›c B: Create Server Component page                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ // app/page.tsx (Server Component â€” default!)        â”‚  â”‚
  â”‚  â”‚ import HomePage from './home-page'                   â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ async function getPosts() {                          â”‚  â”‚
  â”‚  â”‚   const res = await fetch('https://...')             â”‚  â”‚
  â”‚  â”‚   return res.json()                                  â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ export default async function Page() {               â”‚  â”‚
  â”‚  â”‚   const posts = await getPosts()                     â”‚  â”‚
  â”‚  â”‚   return <HomePage recentPosts={posts} />            â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  FLOW:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ pages/index.js (Client Component + GSP)     â”‚           â”‚
  â”‚  â”‚         â†“                                   â”‚           â”‚
  â”‚  â”‚ app/home-page.tsx ('use client' â€” UI only!) â”‚           â”‚
  â”‚  â”‚ app/page.tsx (Server â€” data fetching!)      â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Step 5: Routing Hooks Migration!

```
  ROUTING HOOKS â€” BEFORE vs AFTER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  import source THAY Äá»”I:                                  â”‚
  â”‚  BEFORE: import { useRouter } from 'next/router'          â”‚
  â”‚  AFTER:  import {                                          â”‚
  â”‚            useRouter,                                      â”‚
  â”‚            usePathname,                                    â”‚
  â”‚            useSearchParams                                 â”‚
  â”‚          } from 'next/navigation'                          â”‚
  â”‚                                                            â”‚
  â”‚  PHÃ‚N TÃCH:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Pages Router     â”‚ App Router                       â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ router.pathname  â”‚ usePathname()                    â”‚   â”‚
  â”‚  â”‚ router.query     â”‚ useSearchParams() + useParams()  â”‚   â”‚
  â”‚  â”‚ router.push()    â”‚ router.push() (váº«n cÃ³!)        â”‚   â”‚
  â”‚  â”‚ router.replace() â”‚ router.replace() (váº«n cÃ³!)     â”‚   â”‚
  â”‚  â”‚ router.back()    â”‚ router.back() (váº«n cÃ³!)        â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                            â”‚
  â”‚  THUá»˜C TÃNH Bá»Š XÃ“A:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Bá»‹ xÃ³a           â”‚ LÃ½ do                            â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ isFallback       â”‚ fallback â†’ dynamicParams        â”‚   â”‚
  â”‚  â”‚ locale/locales   â”‚ i18n built-in khÃ´ng cáº§n ná»¯a    â”‚   â”‚
  â”‚  â”‚ basePath         â”‚ ChÆ°a implement láº¡i              â”‚   â”‚
  â”‚  â”‚ asPath           â”‚ Concept "as" bá»‹ loáº¡i bá»        â”‚   â”‚
  â”‚  â”‚ isReady          â”‚ KhÃ´ng cáº§n (useSearchParams lazy)â”‚   â”‚
  â”‚  â”‚ route            â”‚ â†’ usePathname()                 â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                            â”‚
  â”‚  âš ï¸ Chá»‰ dÃ¹ng trong Client Components!                    â”‚
  â”‚  âš ï¸ next/router KHÃ”NG hoáº¡t Ä‘á»™ng trong app/!             â”‚
  â”‚                                                            â”‚
  â”‚  CHIA Sáºº components giá»¯a pages + app:                     â”‚
  â”‚  â†’ import from 'next/compat/router'                      â”‚
  â”‚  â†’ DÃ¹ng táº¡m khi migration, sau chuyá»ƒn next/navigation   â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Step 6: Data Fetching Migration!

```
  DATA FETCHING â€” PAGES vs APP:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  â‘  getServerSideProps â†’ fetch({ cache: 'no-store' })     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE:                                              â”‚  â”‚
  â”‚  â”‚ export async function getServerSideProps() {         â”‚  â”‚
  â”‚  â”‚   const res = await fetch('...')                     â”‚  â”‚
  â”‚  â”‚   return { props: { data: await res.json() } }      â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â”‚ export default function Page({ data }) { ... }       â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ AFTER:                                               â”‚  â”‚
  â”‚  â”‚ export default async function Page() {               â”‚  â”‚
  â”‚  â”‚   const res = await fetch('...', {cache:'no-store'}) â”‚  â”‚
  â”‚  â”‚   const data = await res.json()                      â”‚  â”‚
  â”‚  â”‚   return <div>{data}</div>                           â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¡ getStaticProps â†’ fetch() (default: force-cache)        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ â†’ fetch() khÃ´ng option = cached until invalidated   â”‚  â”‚
  â”‚  â”‚ â†’ Giá»‘ng getStaticProps: build-time data!            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¢ getStaticPaths â†’ generateStaticParams                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE:                                              â”‚  â”‚
  â”‚  â”‚ export async function getStaticPaths() {             â”‚  â”‚
  â”‚  â”‚   return {                                           â”‚  â”‚
  â”‚  â”‚     paths: [{ params: { id: '1' } }],                â”‚  â”‚
  â”‚  â”‚     fallback: 'blocking'                             â”‚  â”‚
  â”‚  â”‚   }                                                  â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ AFTER:                                               â”‚  â”‚
  â”‚  â”‚ export async function generateStaticParams() {       â”‚  â”‚
  â”‚  â”‚   return [{ id: '1' }, { id: '2' }]                  â”‚  â”‚
  â”‚  â”‚ }                                                    â”‚  â”‚
  â”‚  â”‚ export const dynamicParams = true // = fallback      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘£ ISR (revalidate) â†’ next: { revalidate: N }            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: return { props, revalidate: 60 }             â”‚  â”‚
  â”‚  â”‚ AFTER:  fetch('...', { next: { revalidate: 60 } })  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¤ Request Object:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: getServerSideProps({ req }) â†’ req.cookies   â”‚  â”‚
  â”‚  â”‚ AFTER:  import { cookies, headers } from             â”‚  â”‚
  â”‚  â”‚         'next/headers'                               â”‚  â”‚
  â”‚  â”‚         (await cookies()).get('theme')               â”‚  â”‚
  â”‚  â”‚         (await headers()).get('authorization')       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¥ API Routes â†’ Route Handlers:                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ BEFORE: pages/api/hello.js (req, res) â†’ res.json() â”‚  â”‚
  â”‚  â”‚ AFTER:  app/api/hello/route.ts                      â”‚  â”‚
  â”‚  â”‚         export async function GET(request: Request)  â”‚  â”‚
  â”‚  â”‚         { return Response.json({ hello: 'world' }) } â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Step 7: Styling + Coexistence + Codemods!

```
  STYLING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  BEFORE: Global CSS chá»‰ trong pages/_app.js!           â”‚
  â”‚  AFTER:  Global CSS á»Ÿ Báº¤T Ká»² layout/page/component!   â”‚
  â”‚                                                          â”‚
  â”‚  Tailwind: thÃªm app/ vÃ o content:                       â”‚
  â”‚  content: [                                              â”‚
  â”‚    './app/**/*.{js,ts,jsx,tsx,mdx}',  â† THÃŠM!         â”‚
  â”‚    './pages/**/*.{js,ts,jsx,tsx,mdx}',                   â”‚
  â”‚    './components/**/*.{js,ts,jsx,tsx,mdx}',              â”‚
  â”‚  ]                                                       â”‚
  â”‚                                                          â”‚
  â”‚  Import globals.css trong app/layout.tsx!                â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  COEXISTENCE (pages/ + app/):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  âš ï¸ Navigate giá»¯a pages/ â†” app/ = HARD NAVIGATION!   â”‚
  â”‚  â†’ Full page reload (khÃ´ng SPA transition!)             â”‚
  â”‚  â†’ next/link KHÃ”NG prefetch cross-router!              â”‚
  â”‚                                                          â”‚
  â”‚  â†’ Migrate Tá»ªNG PAGE má»™t!                              â”‚
  â”‚  â†’ CÃ¹ng route â†’ chá»n pages/ HOáº¶C app/ (khÃ´ng cáº£ 2!) â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  3 CODEMODS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Codemod              â”‚ Chá»©c nÄƒng                  â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ next-image-to-       â”‚ Rename next/image â†’       â”‚   â”‚
  â”‚  â”‚ legacy-image         â”‚ next/legacy/image          â”‚   â”‚
  â”‚  â”‚                      â”‚                            â”‚   â”‚
  â”‚  â”‚ next-image-          â”‚ Add inline styles,         â”‚   â”‚
  â”‚  â”‚ experimental         â”‚ remove unused props        â”‚   â”‚
  â”‚  â”‚                      â”‚                            â”‚   â”‚
  â”‚  â”‚ new-link             â”‚ Remove nested <a> from     â”‚   â”‚
  â”‚  â”‚                      â”‚ <Link>                     â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Tá»± Viáº¿t â€” MigrationEngine!

```javascript
var MigrationEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. PAGES ROUTER SIMULATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var pagesRouter = {
    routes: {},
    _app: null,
    _document: null,

    register: function (path, config) {
      this.routes[path] = {
        component: config.component,
        getServerSideProps: config.getServerSideProps || null,
        getStaticProps: config.getStaticProps || null,
        getStaticPaths: config.getStaticPaths || null,
        getLayout: config.getLayout || null,
      };
    },

    render: function (path) {
      var route = this.routes[path];
      if (!route) return "404";
      var props = {};

      // Data fetching
      if (route.getServerSideProps) {
        props = route.getServerSideProps({
          req: { cookies: {}, headers: {} },
          query: {},
        }).props;
        console.log("  [Pages] getServerSideProps â†’", props);
      }
      if (route.getStaticProps) {
        props = route.getStaticProps({ params: {} }).props;
        console.log("  [Pages] getStaticProps â†’", props);
      }

      // Render
      var html = route.component(props);
      if (route.getLayout) {
        html = route.getLayout(html);
      }
      return html;
    },
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. APP ROUTER SIMULATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var appRouter = {
    routes: {},
    rootLayout: null,

    setRootLayout: function (layoutFn) {
      this.rootLayout = layoutFn;
    },

    register: function (path, config) {
      this.routes[path] = {
        page: config.page, // async Server Component!
        layout: config.layout || null,
        metadata: config.metadata || {},
        generateStaticParams: config.generateStaticParams || null,
        dynamicParams: config.dynamicParams !== false,
      };
    },

    render: async function (path) {
      var route = this.routes[path];
      if (!route) {
        console.log("  [App] not-found.tsx â†’ 404");
        return "404";
      }

      console.log("  [App] Metadata:", JSON.stringify(route.metadata));

      // Server Component renders with data
      var content = await route.page();

      // Wrap with layout
      if (route.layout) {
        content = route.layout(content);
      }

      // Wrap with root layout
      if (this.rootLayout) {
        content = this.rootLayout(content);
      }

      return content;
    },
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. DATA FETCHING MIGRATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function migrateDataFetching(pagesConfig) {
    var result = { method: "", appCode: "" };

    if (pagesConfig.getServerSideProps) {
      result.method = "getServerSideProps â†’ fetch(no-store)";
      result.appCode = 'const data = await fetch(url, {cache:"no-store"})';
    }
    if (pagesConfig.getStaticProps) {
      result.method = "getStaticProps â†’ fetch(force-cache)";
      result.appCode = "const data = await fetch(url)";

      if (pagesConfig.revalidate) {
        result.method += " + ISR";
        result.appCode =
          "const data = await fetch(url, " +
          "{next:{revalidate:" +
          pagesConfig.revalidate +
          "}})";
      }
    }
    if (pagesConfig.getStaticPaths) {
      result.method += " + getStaticPaths â†’ generateStaticParams";
      result.appCode +=
        "\nexport function generateStaticParams() " + "{ return [...] }";
    }
    return result;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. ROUTING HOOKS MIGRATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function migrateHooks(pagesHooks) {
    var mapping = {
      useRouter: "useRouter (from next/navigation)",
      "router.pathname": "usePathname()",
      "router.query": "useSearchParams() + useParams()",
      "router.push": "router.push() (same!)",
      "router.replace": "router.replace() (same!)",
      "router.isFallback": "REMOVED (use dynamicParams)",
      "router.locale": "REMOVED (use i18n library)",
      "router.asPath": "REMOVED (concept removed)",
      "router.isReady": "REMOVED (not needed)",
    };
    var result = [];
    for (var i = 0; i < pagesHooks.length; i++) {
      var hook = pagesHooks[i];
      result.push({
        from: hook,
        to: mapping[hook] || "UNKNOWN",
      });
    }
    return result;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. CODEMOD SIMULATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function runCodemod(name, code) {
    console.log("  ğŸ”§ Codemod: " + name);
    var result = code;

    if (name === "new-link") {
      result = code
        .replace(/<Link href="([^"]+)">\s*<a>/g, '<Link href="$1">')
        .replace(/<\/a>\s*<\/Link>/g, "</Link>");
    }
    if (name === "next-image-to-legacy-image") {
      result = code.replace(/from 'next\/image'/g, "from 'next/legacy/image'");
    }
    console.log("  Before: " + code.slice(0, 60));
    console.log("  After:  " + result.slice(0, 60));
    return result;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 6. DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘  MIGRATION ENGINE DEMO              â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // Scenario 1: Pages Router
    console.log("\nâ”€â”€ Scenario 1: Pages Router â”€â”€");
    pagesRouter.register("/", {
      component: function (props) {
        return "<h1>Home: " + (props.title || "") + "</h1>";
      },
      getStaticProps: function () {
        return { props: { title: "Welcome" } };
      },
    });
    console.log(pagesRouter.render("/"));

    // Scenario 2: App Router
    console.log("\nâ”€â”€ Scenario 2: App Router â”€â”€");
    appRouter.setRootLayout(function (c) {
      return "<html><body>" + c + "</body></html>";
    });
    appRouter.register("/", {
      metadata: { title: "Home" },
      page: async function () {
        var data = { title: "Welcome" }; // fetch simulation
        return "<h1>Home: " + data.title + "</h1>";
      },
    });
    appRouter.render("/");

    // Scenario 3: Data fetching migration
    console.log("\nâ”€â”€ Scenario 3: Data Fetching â”€â”€");
    var m1 = migrateDataFetching({
      getServerSideProps: true,
    });
    console.log("  " + m1.method);
    console.log("  Code: " + m1.appCode);

    var m2 = migrateDataFetching({
      getStaticProps: true,
      revalidate: 60,
      getStaticPaths: true,
    });
    console.log("  " + m2.method);
    console.log("  Code: " + m2.appCode);

    // Scenario 4: Hooks migration
    console.log("\nâ”€â”€ Scenario 4: Hooks â”€â”€");
    var hooks = migrateHooks([
      "router.pathname",
      "router.query",
      "router.isFallback",
      "router.locale",
    ]);
    for (var i = 0; i < hooks.length; i++) {
      console.log("  " + hooks[i].from + " â†’ " + hooks[i].to);
    }

    // Scenario 5: Codemods
    console.log("\nâ”€â”€ Scenario 5: Codemods â”€â”€");
    runCodemod("new-link", '<Link href="/about"> <a>About</a> </Link>');
    runCodemod("next-image-to-legacy-image", "import Image from 'next/image'");
  }

  return { demo: demo };
})();
// Cháº¡y: MigrationEngine.demo();
```

---

## Â§10. CÃ¢u Há»i Luyá»‡n Táº­p!

**CÃ¢u 1**: Liá»‡t kÃª mapping giá»¯a Pages Router files vÃ  App Router files.

<details><summary>ÄÃ¡p Ã¡n</summary>

| Pages Router                           | App Router                                     |
| -------------------------------------- | ---------------------------------------------- |
| `pages/_app.js` + `pages/_document.js` | `app/layout.tsx` (root layout = káº¿t há»£p cáº£ 2!) |
| `pages/_error.js`                      | `app/error.tsx` (error boundary)               |
| `pages/404.js`                         | `app/not-found.tsx`                            |
| `pages/index.js`                       | `app/page.tsx`                                 |
| `pages/about.js`                       | `app/about/page.tsx` (nested folder!)          |
| `pages/blog/[slug].js`                 | `app/blog/[slug]/page.tsx`                     |
| `pages/api/hello.js`                   | `app/api/hello/route.ts` (Route Handler)       |

Root layout **Báº®T BUá»˜C** cÃ³ `<html>` + `<body>` â€” Next.js **KHÃ”NG** auto táº¡o.

</details>

---

**CÃ¢u 2**: Data fetching thay Ä‘á»•i tháº¿ nÃ o tá»« Pages â†’ App?

<details><summary>ÄÃ¡p Ã¡n</summary>

| Pages Router                              | App Router                                                    |
| ----------------------------------------- | ------------------------------------------------------------- |
| `getServerSideProps` â†’ props              | `fetch(url, {cache:'no-store'})` trong async Server Component |
| `getStaticProps` â†’ props                  | `fetch(url)` (default force-cache)                            |
| `getStaticProps` + `revalidate: 60`       | `fetch(url, {next:{revalidate:60}})`                          |
| `getStaticPaths` + `fallback`             | `generateStaticParams()` + `dynamicParams`                    |
| `req.cookies`, `req.headers` (tá»« context) | `cookies()`, `headers()` tá»« `next/headers`                    |
| API Routes (`pages/api/`)                 | Route Handlers (`app/api/.../route.ts`)                       |

**Key change**: KhÃ´ng cÃ²n data fetching functions riÃªng biá»‡t â†’ trá»±c tiáº¿p `await fetch()` trong async Server Component! Ãt code hÆ¡n, linh hoáº¡t hÆ¡n.

</details>

---

**CÃ¢u 3**: useRouter thay Ä‘á»•i gÃ¬? Thuá»™c tÃ­nh nÃ o bá»‹ xÃ³a?

<details><summary>ÄÃ¡p Ã¡n</summary>

**Import**: `next/router` â†’ `next/navigation`  
**PhÃ¢n tÃ¡ch**: `useRouter()` tÃ¡ch thÃ nh 3 hooks: `useRouter()`, `usePathname()`, `useSearchParams()`

**Bá»‹ xÃ³a**: `isFallback` (â†’ dynamicParams), `locale/locales/defaultLocales` (â†’ i18n library), `basePath` (chÆ°a implement), `asPath` (concept removed), `isReady` (khÃ´ng cáº§n), `route` (â†’ usePathname)

**Chia sáº» components**: DÃ¹ng `next/compat/router` táº¡m thá»i khi cáº£ pages + app cÃ¹ng tá»“n táº¡i.

**Chá»‰ dÃ¹ng trong Client Components!** Server Components KHÃ”NG dÃ¹ng routing hooks.

</details>

---

**CÃ¢u 4**: Migrate 1 page theo 2 bÆ°á»›c â€” táº¡i sao tÃ¡ch Client + Server?

<details><summary>ÄÃ¡p Ã¡n</summary>

**BÆ°á»›c 1**: Extract page component â†’ `'use client'` Client Component (giá»¯ UI, state, effects)  
**BÆ°á»›c 2**: Táº¡o `app/.../page.tsx` Server Component â†’ import Client Component, fetch data trá»±c tiáº¿p

**Táº¡i sao tÃ¡ch**:

1. **Server Component** (page.tsx): Fetch data trÃªn server â†’ **0KB client JS** cho data fetching!
2. **Client Component** (home-page.tsx): UI interactive â†’ chá»‰ JS cáº§n thiáº¿t cho interactivity
3. Pages Router: **ALL** page JS gá»­i client (data fetching + UI) â†’ bundle lá»›n
4. App Router: Data fetching **á»Ÿ server**, chá»‰ gá»­i **rendered HTML + UI JS** â†’ bundle nhá» hÆ¡n

ÄÃ¢y lÃ  migration path **dá»… nháº¥t** vÃ¬ behavior tÆ°Æ¡ng tá»± Pages Router (Client Component váº«n prerender SSR nhÆ° cÅ©).

</details>
