# Selective Hydration â€” Deep Dive: Tá»± Viáº¿t Tay Tá»« Sá»‘ 0

> **TÃ i liá»‡u há»c táº­p chuyÃªn sÃ¢u â€” HoÃ n toÃ n báº±ng Tiáº¿ng Viá»‡t**
> Tá»± viáº¿t tay má»i thá»©, khÃ´ng phá»¥ thuá»™c thÆ° viá»‡n â€” Giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t kÃ¨m sÆ¡ Ä‘á»“

---

## Má»¥c Lá»¥c

```
Â§1.  Váº¥n Ä‘á» cá»§a SSR truyá»n thá»‘ng â€” Táº¡i sao cáº§n Selective Hydration?
Â§2.  Selective Hydration lÃ  gÃ¬? â€” Äá»‹nh nghÄ©a & Ã tÆ°á»Ÿng cá»‘t lÃµi
Â§3.  Streaming SSR â€” renderToPipeableStream thay tháº¿ renderToString
Â§4.  Suspense trÃªn Server â€” KhÃ´ng chá» component cháº­m!
Â§5.  Hydration TRÆ¯á»šC khi táº£i háº¿t JS â€” Selective Hydration trong thá»±c táº¿
Â§6.  Æ¯u tiÃªn Hydration theo User Interaction
Â§7.  Tá»± viáº¿t tay Streaming SSR Server â€” KhÃ´ng dÃ¹ng framework
Â§8.  Tá»± viáº¿t tay Client Hydration vá»›i hydrateRoot
Â§9.  Tá»± viáº¿t tay Suspense-like Placeholder cho SSR
Â§10. Code-Splitting + Selective Hydration â€” Káº¿t há»£p hoÃ n chá»‰nh
Â§11. So sÃ¡nh: renderToString vs renderToPipeableStream
Â§12. Next.js App Router â€” Selective Hydration tÃ­ch há»£p sáºµn
Â§13. Best Practices & Anti-Patterns
Â§14. Phá»ng váº¥n Q&A â€” CÃ¢u há»i thÆ°á»ng gáº·p
```

---

## Â§1. Váº¥n Äá» Cá»§a SSR Truyá»n Thá»‘ng â€” Táº¡i Sao Cáº§n Selective Hydration?

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SSR TRUYá»€N THá»NG CÃ“ 3 Váº¤N Äá»€ Lá»šN!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Váº¤N Äá»€ Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SSR truyá»n thá»‘ng (React 17 trá»Ÿ vá» trÆ°á»›c):            â”‚
  â”‚  â†’ DÃ¹ng renderToString() trÃªn server                  â”‚
  â”‚  â†’ DÃ¹ng hydrate() trÃªn client                         â”‚
  â”‚                                                        â”‚
  â”‚  CÃ“ 3 ÄIá»‚M NGHáº¼N (bottleneck) NGHIÃŠM TRá»ŒNG:        â”‚
  â”‚                                                        â”‚
  â”‚  â‘  Server PHáº¢I render XONG Háº¾T má»›i gá»­i HTML!        â”‚
  â”‚  â‘¡ Client PHáº¢I táº£i XONG Háº¾T JS má»›i hydrate!         â”‚
  â”‚  â‘¢ PHáº¢I hydrate XONG Háº¾T má»›i tÆ°Æ¡ng tÃ¡c!             â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Má»—i bÆ°á»›c PHáº¢I Äá»¢I bÆ°á»›c trÆ°á»›c HOÃ€N Táº¤T!         â”‚
  â”‚  â†’ Component CHáº¬M kÃ©o TOÃ€N Bá»˜ app cháº­m theo!        â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Váº¤N Äá»€ â‘ : SERVER PHáº¢I RENDER XONG Háº¾T!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  renderToString(<App />) hoáº¡t Ä‘á»™ng:                    â”‚
  â”‚                                                        â”‚
  â”‚  Server báº¯t Ä‘áº§u render:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  <App>                                        â”‚      â”‚
  â”‚  â”‚    <Header />        âœ… Render xong! (5ms)   â”‚      â”‚
  â”‚  â”‚    <Navigation />    âœ… Render xong! (3ms)   â”‚      â”‚
  â”‚  â”‚    <HeroBanner />    âœ… Render xong! (2ms)   â”‚      â”‚
  â”‚  â”‚    <ProductList />   âœ… Render xong! (10ms)  â”‚      â”‚
  â”‚  â”‚    <Comments />      â³ Äang fetch API...    â”‚      â”‚
  â”‚  â”‚                       â³ Äá»£i 2000ms!         â”‚      â”‚
  â”‚  â”‚                       â³ ...váº«n Ä‘ang Ä‘á»£i...  â”‚      â”‚
  â”‚  â”‚    <Footer />        â¸ CHÆ¯A Äáº¾N LÆ¯á»¢T!      â”‚      â”‚
  â”‚  â”‚  </App>                                       â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Comments fetch API máº¥t 2 GIÃ‚Y!                     â”‚
  â”‚  â†’ Header, Navigation, Hero... ÄÃƒ Sáº´N SÃ€NG!         â”‚
  â”‚  â†’ NHÆ¯NG khÃ´ng Ä‘Æ°á»£c gá»­i! VÃ¬ renderToString()          â”‚
  â”‚    pháº£i Ä‘á»£i TOÃ€N Bá»˜ cÃ¢y render xong!                 â”‚
  â”‚  â†’ User Ä‘á»£i 2 GIÃ‚Y má»›i nháº­n Ä‘Æ°á»£c Báº¤T Cá»¨ GÃŒ!       â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ 1 component CHáº¬M â†’ TOÃ€N Bá»˜ trang CHáº¬M!          â”‚
  â”‚                                                        â”‚
  â”‚  TIMELINE:                                              â”‚
  â”‚  0ms â”€â”€â”€â”€ 20ms â”€â”€â”€â”€ 2000ms â”€â”€â”€â”€ 2020ms               â”‚
  â”‚  â”‚         â”‚          â”‚            â”‚                    â”‚
  â”‚  â”‚ Header  â”‚ Comments â”‚ Footer     â”‚                    â”‚
  â”‚  â”‚ Nav     â”‚ Ä‘ang     â”‚ render     â”‚                    â”‚
  â”‚  â”‚ Hero    â”‚ fetch    â”‚ xong!      â”‚                    â”‚
  â”‚  â”‚ Product â”‚ API...   â”‚            â”‚                    â”‚
  â”‚  â”‚ XONG!   â”‚          â”‚            â”‚                    â”‚
  â”‚  â”‚         â”‚          â”‚            â”‚                    â”‚
  â”‚  â”‚         â”‚â—€â”€ BLOCK â”€â–¶â”‚            â”‚                    â”‚
  â”‚  â”‚         â”‚ 2 GIÃ‚Y!  â”‚            â”‚                    â”‚
  â”‚  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ CHÆ¯A Gá»¬I GÃŒ CHO CLIENT! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚      â”‚
  â”‚  â”‚                                    Gá»¬I HTML! â”‚      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Váº¤N Äá»€ â‘¡: CLIENT PHáº¢I Táº¢I XONG Háº¾T JS!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Sau khi nháº­n HTML, client cáº§n táº£i JS Ä‘á»ƒ hydrate:     â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  JavaScript Bundle:                           â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
  â”‚  â”‚  â”‚ header.js    (15KB)  âœ… Táº£i xong!       â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ nav.js       (10KB)  âœ… Táº£i xong!       â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ product.js   (20KB)  âœ… Táº£i xong!       â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ comments.js  (200KB) â³ Äang táº£i...     â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ footer.js    (5KB)   âœ… Táº£i xong!       â”‚ â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
  â”‚  â”‚                                                â”‚      â”‚
  â”‚  â”‚  hydrate(<App />, root)                        â”‚      â”‚
  â”‚  â”‚  â†’ PHáº¢I Äá»¢I comments.js (200KB) táº£i xong!   â”‚      â”‚
  â”‚  â”‚  â†’ DÃ¹ Header, Nav, Footer ÄÃƒ Sáº´N SÃ€NG!     â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG THá»‚ hydrate Tá»ªNG component!          â”‚      â”‚
  â”‚  â”‚  â†’ Táº¤T Cáº¢ hoáº·c KHÃ”NG GÃŒ Cáº¢!                â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ 1 bundle Lá»šN â†’ TOÃ€N Bá»˜ trang Ä‘á»£i!               â”‚
  â”‚  â†’ Header ÄÃƒ CÃ“ JS nhÆ°ng KHÃ”NG HYDRATE Ä‘Æ°á»£c!        â”‚
  â”‚  â†’ VÃ¬ React hydrate() cáº§n Táº¤T Cáº¢ JS!                â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Váº¤N Äá»€ â‘¢: PHáº¢I HYDRATE XONG Háº¾T Má»šI TÆ¯Æ NG TÃC!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  hydrate(<App />, root) duyá»‡t Cáº¢ CÃ‚Y:               â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  <App>                                        â”‚      â”‚
  â”‚  â”‚    <Header />       â³ Äang hydrate...       â”‚      â”‚
  â”‚  â”‚    <Navigation />   â¸ Chá» Header...          â”‚      â”‚
  â”‚  â”‚    <ProductList />  â¸ Chá» Navigation...      â”‚      â”‚
  â”‚  â”‚    <Comments />     â¸ Chá» ProductList...     â”‚      â”‚
  â”‚  â”‚    â”‚                                          â”‚      â”‚
  â”‚  â”‚    â”‚ User CLICK Navigation! ğŸ–±ï¸               â”‚      â”‚
  â”‚  â”‚    â”‚ â†’ KHÃ”NG PHáº¢N Há»’I!                       â”‚      â”‚
  â”‚  â”‚    â”‚ â†’ VÃ¬ Navigation CHÆ¯A Ä‘Æ°á»£c hydrate!      â”‚      â”‚
  â”‚  â”‚    â”‚ â†’ Äang Äá»’NG Bá»˜ hydrate tá»« trÃªn xuá»‘ng!  â”‚      â”‚
  â”‚  â”‚    â”‚ â†’ KHÃ”NG THá»‚ nháº£y qua!                   â”‚      â”‚
  â”‚  â”‚    â”‚                                          â”‚      â”‚
  â”‚  â”‚    <Footer />       â¸ Cuá»‘i cÃ¹ng!             â”‚      â”‚
  â”‚  â”‚  </App>                                       â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Hydration lÃ  Äá»’NG Bá»˜ (synchronous)!               â”‚
  â”‚  â†’ React PHáº¢I hydrate XONG Cáº¢ CÃ‚Y rá»“i má»›i cho      â”‚
  â”‚    user tÆ°Æ¡ng tÃ¡c!                                    â”‚
  â”‚  â†’ Main thread Bá»Š BLOCK trong suá»‘t quÃ¡ trÃ¬nh!       â”‚
  â”‚  â†’ = UNCANNY VALLEY!                                   â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ Tá»”NG Káº¾T 3 Váº¤N Äá»€:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SSR TRUYá»€N THá»NG = 3 BÆ¯á»šC TUáº¦N Tá»°, BLOCKING!       â”‚
  â”‚                                                        â”‚
  â”‚  SERVER:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ Render Táº¤T Cáº¢ components          â”‚                â”‚
  â”‚  â”‚ (Ä‘á»£i component cháº­m!)             â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚                  â”‚ Äá»¢I XONG Háº¾T!                     â”‚
  â”‚                  â–¼                                      â”‚
  â”‚  CLIENT (nháº­n HTML):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ Táº£i Táº¤T Cáº¢ JavaScript             â”‚                â”‚
  â”‚  â”‚ (Ä‘á»£i bundle lá»›n!)                  â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚                  â”‚ Äá»¢I XONG Háº¾T!                     â”‚
  â”‚                  â–¼                                      â”‚
  â”‚  HYDRATION:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ Hydrate Táº¤T Cáº¢ components         â”‚                â”‚
  â”‚  â”‚ (Ä‘á»“ng bá»™, blocking!)              â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚                  â”‚ Äá»¢I XONG Háº¾T!                     â”‚
  â”‚                  â–¼                                      â”‚
  â”‚  âš¡ TTI (Time To Interactive)                          â”‚
  â”‚  â†’ User Má»šI tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c!                          â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Má»—i bÆ°á»›c = "ALL or NOTHING"!                     â”‚
  â”‚  â†’ KHÃ”NG THá»‚ lÃ m tá»«ng pháº§n!                          â”‚
  â”‚  â†’ 1 pháº§n cháº­m â†’ Cáº¢ TRANG cháº­m!                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Selective Hydration LÃ  GÃ¬? â€” Äá»‹nh NghÄ©a & Ã TÆ°á»Ÿng Cá»‘t LÃµi

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SELECTIVE HYDRATION = HYDRATE CÃ“ CHá»ŒN Lá»ŒC!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Äá»ŠNH NGHÄ¨A:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Selective Hydration (React 18) = Hydration CÃ“ CHá»ŒN  â”‚
  â”‚  Lá»ŒC, KHÃ”NG Ä‘á»“ng bá»™, KHÃ”NG blocking!                 â”‚
  â”‚                                                        â”‚
  â”‚  "Selective" = "CÃ³ chá»n lá»c"                           â”‚
  â”‚  â†’ CHá»ŒN component nÃ o hydrate TRÆ¯á»šC!                  â”‚
  â”‚  â†’ CHá»ŒN Æ°u tiÃªn dá»±a trÃªn user interaction!           â”‚
  â”‚  â†’ KHÃ”NG Cáº¦N Ä‘á»£i táº¥t cáº£!                             â”‚
  â”‚                                                        â”‚
  â”‚  GIáº¢I QUYáº¾T Cáº¢ 3 Váº¤N Äá»€:                            â”‚
  â”‚  âœ… â‘  Server Gá»¬I HTML theo STREAM (dáº§n dáº§n!)        â”‚
  â”‚     â†’ KhÃ´ng Ä‘á»£i component cháº­m!                       â”‚
  â”‚  âœ… â‘¡ Client hydrate NGAY khi JS sáºµn sÃ ng!          â”‚
  â”‚     â†’ KhÃ´ng Ä‘á»£i táº£i háº¿t JS!                          â”‚
  â”‚  âœ… â‘¢ Hydrate CÃ“ Æ¯U TIÃŠN theo user interaction!     â”‚
  â”‚     â†’ User click Ä‘Ã¢u â†’ hydrate ÄÃ“ trÆ°á»›c!           â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  CÃ”NG NGHá»† Sá»¬ Dá»¤NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 18 cung cáº¥p 3 thá»© Má»šI:                         â”‚
  â”‚                                                        â”‚
  â”‚  â‘  renderToPipeableStream() (server):                 â”‚
  â”‚     â†’ Thay tháº¿ renderToString()!                      â”‚
  â”‚     â†’ STREAM HTML dáº§n dáº§n, KHÃ”NG Ä‘á»£i háº¿t!            â”‚
  â”‚     â†’ Suspense boundaries = Ä‘iá»ƒm stream!              â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ hydrateRoot() (client):                            â”‚
  â”‚     â†’ Thay tháº¿ hydrate()!                             â”‚
  â”‚     â†’ Há»— trá»£ CONCURRENT hydration!                   â”‚
  â”‚     â†’ CÃ³ thá»ƒ PAUSE, RESUME, Æ¯U TIÃŠN!                â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ <Suspense> trÃªn Server:                            â”‚
  â”‚     â†’ TrÆ°á»›c React 18: Suspense CHá»ˆ cho client!       â”‚
  â”‚     â†’ React 18: Suspense HOáº T Äá»˜NG trÃªn server!      â”‚
  â”‚     â†’ Server render fallback â†’ stream HTML sau!       â”‚
  â”‚     â†’ = RANH GIá»šI Ä‘á»ƒ selective hydration!             â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ Ã TÆ¯á»NG Cá»T LÃ•I:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• SSR TRUYá»€N THá»NG â•â•â•                              â”‚
  â”‚                                                        â”‚
  â”‚  Server: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ Gá»­i 1 láº§n!   â”‚
  â”‚          (render TOÃ€N Bá»˜, rá»“i gá»­i!)                  â”‚
  â”‚                                                        â”‚
  â”‚  Client: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] â†’ Táº£i Háº¾T JS  â”‚
  â”‚          [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ Hydrate Háº¾T!  â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• SELECTIVE HYDRATION (React 18) â•â•â•                â”‚
  â”‚                                                        â”‚
  â”‚  Server: [â–ˆâ–ˆâ–ˆâ–ˆ] â†’ Gá»­i shell!                           â”‚
  â”‚          ......[â–ˆâ–ˆâ–ˆâ–ˆ] â†’ Stream thÃªm Sidebar!           â”‚
  â”‚          ...........[â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] â†’ Stream Comments!       â”‚
  â”‚          (gá»­i Dáº¦N Dáº¦N, KHÃ”NG Ä‘á»£i!)                   â”‚
  â”‚                                                        â”‚
  â”‚  Client: [â–ˆâ–ˆ] Hydrate Header!                          â”‚
  â”‚          ....[â–ˆâ–ˆ] Hydrate Nav! (JS Ä‘Ã£ sáºµn!)          â”‚
  â”‚          ........[â–ˆâ–ˆ] Hydrate Sidebar!                  â”‚
  â”‚          ............[â–ˆâ–ˆ] Hydrate Comments!             â”‚
  â”‚          (hydrate Tá»ªNG PHáº¦N, ngay khi cÃ³ JS!)         â”‚
  â”‚                                                        â”‚
  â”‚  User click Nav? â†’ Æ¯U TIÃŠN hydrate Nav TRÆ¯á»šC!        â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ KIáº¾N TRÃšC SELECTIVE HYDRATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚           â”‚         SERVER          â”‚                  â”‚
  â”‚           â”‚                         â”‚                  â”‚
  â”‚           â”‚  renderToPipeableStream  â”‚                  â”‚
  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
  â”‚           â”‚  â”‚ <App>             â”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚   <Header />  â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ Stream ngay!  â”‚
  â”‚           â”‚  â”‚   <Suspense>      â”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚     <Sidebar />â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â–¶ Stream khi   â”‚
  â”‚           â”‚  â”‚   </Suspense>     â”‚  â”‚    sáºµn sÃ ng!   â”‚
  â”‚           â”‚  â”‚   <Main />    â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ Stream ngay!  â”‚
  â”‚           â”‚  â”‚   <Suspense>      â”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚     <Comments />â”€â”€â”¼â”€â”€â”¼â”€â”€â–¶ Stream khi   â”‚
  â”‚           â”‚  â”‚   </Suspense>     â”‚  â”‚    data ready!  â”‚
  â”‚           â”‚  â”‚ </App>            â”‚  â”‚                  â”‚
  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                      â”‚                                  â”‚
  â”‚                      â”‚ HTML stream                      â”‚
  â”‚                      â–¼                                  â”‚
  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚           â”‚         CLIENT          â”‚                  â”‚
  â”‚           â”‚                         â”‚                  â”‚
  â”‚           â”‚  hydrateRoot()          â”‚                  â”‚
  â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚
  â”‚           â”‚  â”‚ Header  âœ… hydrateâ”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚ Sidebar â³ chá» JSâ”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚ Main    âœ… hydrateâ”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚ Comments â³ chá»  â”‚  â”‚                  â”‚
  â”‚           â”‚  â”‚          stream   â”‚  â”‚                  â”‚
  â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚
  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Streaming SSR â€” renderToPipeableStream Thay Tháº¿ renderToString

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  STREAMING SSR = Gá»¬I HTML Dáº¦N Dáº¦N NHÆ¯ SUá»I CHáº¢Y!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  renderToString vs renderToPipeableStream:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• renderToString() â€” CÅ¨! â•â•â•                       â”‚
  â”‚                                                        â”‚
  â”‚  const html = renderToString(<App />);                 â”‚
  â”‚                                                        â”‚
  â”‚  CÃ¡ch hoáº¡t Ä‘á»™ng:                                       â”‚
  â”‚  â‘  Render TOÃ€N Bá»˜ cÃ¢y React                          â”‚
  â”‚  â‘¡ Chuyá»ƒn thÃ nh 1 STRING HTML duy nháº¥t               â”‚
  â”‚  â‘¢ String HOÃ€N CHá»ˆNH má»›i res.send()!                 â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ Server render:                           â”‚           â”‚
  â”‚  â”‚                                          â”‚           â”‚
  â”‚  â”‚  Start â”€â”€â–¶ Header â”€â”€â–¶ Nav â”€â”€â–¶ Main     â”‚           â”‚
  â”‚  â”‚              â”€â”€â–¶ Comments (CHáº¬M! 2s!)   â”‚           â”‚
  â”‚  â”‚              â”€â”€â–¶ Footer                  â”‚           â”‚
  â”‚  â”‚              â”€â”€â–¶ Káº¾T QUáº¢: 1 chuá»—i HTMLâ”‚           â”‚
  â”‚  â”‚                                          â”‚           â”‚
  â”‚  â”‚  res.send(html); // Gá»¬I 1 Láº¦N!         â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€:                                               â”‚
  â”‚  â†’ BLOCKING! Pháº£i Ä‘á»£i 2s cho Comments!                â”‚
  â”‚  â†’ Client khÃ´ng nháº­n Ä‘Æ°á»£c gÃ¬ trong 2s!                â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• renderToPipeableStream() â€” Má»šI! â•â•â•              â”‚
  â”‚                                                        â”‚
  â”‚  CÃ¡ch hoáº¡t Ä‘á»™ng:                                       â”‚
  â”‚  â‘  Render CÃI GÃŒ Sáº´N SÃ€NG â†’ gá»­i NGAY!              â”‚
  â”‚  â‘¡ Component CHÆ¯A Sáº´N SÃ€NG â†’ gá»­i fallback!          â”‚
  â”‚  â‘¢ Khi sáºµn sÃ ng â†’ STREAM thÃªm HTML + <script>!      â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ Server stream:                           â”‚           â”‚
  â”‚  â”‚                                          â”‚           â”‚
  â”‚  â”‚  Chunk 1 (ngay láº­p tá»©c!):               â”‚           â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
  â”‚  â”‚  â”‚ <!DOCTYPE html>                   â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚ <html><body>                      â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <header>My App</header>         â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <nav>Home | About</nav>         â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <main>Products...</main>        â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <!-- $? -->                      â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <div>Loading comments...</div>   â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <!-- /$ -->                      â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <footer>Â© 2024</footer>          â”‚    â”‚           â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚
  â”‚  â”‚  â†’ Gá»­i NGAY! KhÃ´ng Ä‘á»£i Comments!       â”‚           â”‚
  â”‚  â”‚                                          â”‚           â”‚
  â”‚  â”‚  ........2 giÃ¢y sau........              â”‚           â”‚
  â”‚  â”‚                                          â”‚           â”‚
  â”‚  â”‚  Chunk 2 (khi Comments sáºµn sÃ ng!):     â”‚           â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
  â”‚  â”‚  â”‚ <div hidden id="comments-html">   â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   <div class="comments">          â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚     <p>Comment 1...</p>           â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚     <p>Comment 2...</p>           â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   </div>                          â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚ </div>                            â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚ <script>                          â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   // THAY THáº¾ fallback báº±ng HTML â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   // tháº­t! React tá»± inject!      â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚   $RC("comments-html", "...");    â”‚    â”‚           â”‚
  â”‚  â”‚  â”‚ </script>                         â”‚    â”‚           â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚
  â”‚  â”‚  â†’ Thay "Loading comments..." báº±ng      â”‚           â”‚
  â”‚  â”‚    ná»™i dung tháº­t!                        â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ User tháº¥y trang NGAY (FCP nhanh!)                 â”‚
  â”‚  â†’ Comments táº£i sau, NHÆ¯NG pháº§n cÃ²n láº¡i ÄÃƒ CÃ“!     â”‚
  â”‚  â†’ Trang KHÃ”NG bá»‹ "tráº¯ng" 2 giÃ¢y!                    â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ SO SÃNH TIMELINE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• renderToString â•â•â•                                â”‚
  â”‚  0s     1s     2s     3s     4s     5s                â”‚
  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚                  â”‚
  â”‚  â”‚Server render...   â”‚HTML! â”‚Táº£i JSâ”‚Hydrateâ”‚          â”‚
  â”‚  â”‚(Ä‘á»£i Comments!)   â”‚      â”‚      â”‚ Háº¾T! â”‚          â”‚
  â”‚  â”‚                   â”‚      â”‚      â”‚      â”‚          â”‚
  â”‚  â”‚â† Tráº¯ng xÃ³a! â”€â”€â”€â”€â–¶â”‚ FCP â”‚      â”‚ TTI  â”‚          â”‚
  â”‚  â”‚                   â”‚      â”‚      â”‚ âš¡   â”‚          â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• renderToPipeableStream â•â•â•                        â”‚
  â”‚  0s   0.1s   1s     2s     2.5s   3s                  â”‚
  â”‚  â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”‚                  â”‚
  â”‚  â”‚Shell!â”‚Hydrate â”‚Commentsâ”‚Hydrate â”‚                   â”‚
  â”‚  â”‚      â”‚Header, â”‚stream â”‚Commentsâ”‚                   â”‚
  â”‚  â”‚      â”‚Nav,Mainâ”‚vÃ o!   â”‚       â”‚                   â”‚
  â”‚  â”‚      â”‚        â”‚        â”‚        â”‚                   â”‚
  â”‚  â”‚ FCP  â”‚ TTI    â”‚        â”‚ Full   â”‚                   â”‚
  â”‚  â”‚ âš¡  â”‚ âš¡    â”‚        â”‚ TTI âš¡â”‚                   â”‚
  â”‚  â”‚(cho  â”‚(cho    â”‚        â”‚        â”‚                   â”‚
  â”‚  â”‚shell)â”‚shell!) â”‚        â”‚        â”‚                   â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ FCP nhanh hÆ¡n 2 GIÃ‚Y!                             â”‚
  â”‚  ğŸ’¡ TTI cho pháº§n chÃ­nh nhanh hÆ¡n 2 GIÃ‚Y!             â”‚
  â”‚  ğŸ’¡ Comments táº£i sau KHÃ”NG áº£nh hÆ°á»Ÿng pháº§n khÃ¡c!      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Suspense TrÃªn Server â€” KhÃ´ng Chá» Component Cháº­m!

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SUSPENSE = RANH GIá»šI Äá»‚ STREAM + SELECTIVE HYDRATE!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  SUSPENSE TRÃŠN SERVER â€” Äá»˜T PHÃ Cá»¦A REACT 18:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TrÆ°á»›c React 18:                                       â”‚
  â”‚  â†’ <Suspense> CHá»ˆ hoáº¡t Ä‘á»™ng trÃªn CLIENT!             â”‚
  â”‚  â†’ Server gáº·p Suspense â†’ THROW ERROR!                â”‚
  â”‚  â†’ Pháº£i dÃ¹ng renderToString (khÃ´ng stream)            â”‚
  â”‚                                                        â”‚
  â”‚  React 18:                                              â”‚
  â”‚  â†’ <Suspense> hoáº¡t Ä‘á»™ng TRÃŠN Cáº¢HAI server + client! â”‚
  â”‚  â†’ Server gáº·p Suspense:                               â”‚
  â”‚    â†’ Render FALLBACK ngay!                            â”‚
  â”‚    â†’ Tiáº¿p tá»¥c render pháº§n cÃ²n láº¡i!                   â”‚
  â”‚    â†’ Khi component sáºµn sÃ ng â†’ STREAM thÃªm HTML!     â”‚
  â”‚  â†’ Client gáº·p Suspense:                               â”‚
  â”‚    â†’ Hiá»ƒn thá»‹ fallback cho Ä‘áº¿n khi JS + data ready!  â”‚
  â”‚    â†’ Hydrate Äá»˜CLáº¬P, khÃ´ng block!                    â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  CODE VÃ Dá»¤ â€” SUSPENSE TRÃŠN SERVER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // App.jsx â€” DÃ¹ng Suspense bá»c component cháº­m!       â”‚
  â”‚  import { Suspense, lazy } from 'react';               â”‚
  â”‚                                                        â”‚
  â”‚  // â‘  Lazy load Comments (code-splitting!)             â”‚
  â”‚  const Comments = lazy(() => import('./Comments'));     â”‚
  â”‚                                                        â”‚
  â”‚  function App() {                                      â”‚
  â”‚    return (                                            â”‚
  â”‚      <html>                                            â”‚
  â”‚        <body>                                          â”‚
  â”‚          {/* â‘¡ Pháº§n chÃ­nh â€” render + stream NGAY! */} â”‚
  â”‚          <Header />                                    â”‚
  â”‚          <Navigation />                                â”‚
  â”‚          <MainContent />                               â”‚
  â”‚                                                        â”‚
  â”‚          {/* â‘¢ Sidebar â€” stream khi sáºµn sÃ ng! */}    â”‚
  â”‚          <Suspense fallback={<SidebarSkeleton />}>     â”‚
  â”‚            <Sidebar />                                 â”‚
  â”‚          </Suspense>                                   â”‚
  â”‚                                                        â”‚
  â”‚          {/* â‘£ Comments â€” stream khi data ready! */}  â”‚
  â”‚          <Suspense fallback={<CommentsLoading />}>     â”‚
  â”‚            <Comments />                                â”‚
  â”‚          </Suspense>                                   â”‚
  â”‚                                                        â”‚
  â”‚          <Footer />                                    â”‚
  â”‚        </body>                                         â”‚
  â”‚      </html>                                           â”‚
  â”‚    );                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  GIáº¢I THÃCH CÃCH REACT 18 Xá»¬ LÃ:                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Server render App:                           â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â‘  Header        â†’ HTML sáºµn! â”€â”€â–¶ STREAM!    â”‚      â”‚
  â”‚  â”‚  â‘¡ Navigation    â†’ HTML sáºµn! â”€â”€â–¶ STREAM!    â”‚      â”‚
  â”‚  â”‚  â‘¢ MainContent   â†’ HTML sáºµn! â”€â”€â–¶ STREAM!    â”‚      â”‚
  â”‚  â”‚  â‘£ Sidebar       â†’ CHÆ¯A sáºµn!               â”‚      â”‚
  â”‚  â”‚     â†’ Gáº·p Suspense!                         â”‚      â”‚
  â”‚  â”‚     â†’ Render <SidebarSkeleton /> â”€â”€â–¶ STREAM!â”‚      â”‚
  â”‚  â”‚  â‘¤ Comments      â†’ CHÆ¯A sáºµn! (fetch API!) â”‚      â”‚
  â”‚  â”‚     â†’ Gáº·p Suspense!                         â”‚      â”‚
  â”‚  â”‚     â†’ Render <CommentsLoading /> â”€â”€â–¶ STREAM!â”‚      â”‚
  â”‚  â”‚  â‘¥ Footer        â†’ HTML sáºµn! â”€â”€â–¶ STREAM!    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ TRANG HIá»†N NGAY vá»›i skeleton/loading!     â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG Bá»Š BLOCK!                           â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ....sau 500ms....                            â”‚      â”‚
  â”‚  â”‚  â‘¦ Sidebar sáºµn sÃ ng!                       â”‚      â”‚
  â”‚  â”‚     â†’ STREAM HTML Sidebar tháº­t!              â”‚      â”‚
  â”‚  â”‚     â†’ <script> thay SidebarSkeleton!         â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ....sau 2000ms....                           â”‚      â”‚
  â”‚  â”‚  â‘§ Comments data sáºµn sÃ ng!                 â”‚      â”‚
  â”‚  â”‚     â†’ STREAM HTML Comments tháº­t!             â”‚      â”‚
  â”‚  â”‚     â†’ <script> thay CommentsLoading!          â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ HTML STREAM THEO THá»œI GIAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  t=0ms (Shell â€” gá»­i NGAY!):                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
  â”‚  â”‚  â”‚         HEADER                     â”‚   â”‚          â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚          â”‚
  â”‚  â”‚  â”‚  Home â”‚ About â”‚ Products â”‚ Contact â”‚   â”‚          â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚          â”‚
  â”‚  â”‚  â”‚                  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚   Main Content   â”‚ Sidebar Loading â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚   (Ä‘áº§y Ä‘á»§!)    â”‚ (skeleton!)     â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚                  â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚   â”‚          â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚          â”‚
  â”‚  â”‚  â”‚  â³ Loading comments...             â”‚   â”‚          â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚          â”‚
  â”‚  â”‚  â”‚         FOOTER                     â”‚   â”‚          â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚  â†’ User THáº¤Y trang ngay! FCP = ~100ms!                â”‚
  â”‚                                                        â”‚
  â”‚  t=500ms (Sidebar stream vÃ o!):                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
  â”‚  â”‚  â”‚                  â”‚ âœ… Sidebar THáº¬T â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚   Main Content   â”‚ â€¢ Category 1    â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚                  â”‚ â€¢ Category 2    â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚                  â”‚ â€¢ Tag Cloud     â”‚   â”‚          â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚  â†’ Skeleton BIáº¾N Máº¤T, ná»™i dung tháº­t HIá»†N!            â”‚
  â”‚                                                        â”‚
  â”‚  t=2000ms (Comments stream vÃ o!):                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚          â”‚
  â”‚  â”‚  â”‚  âœ… Comments THáº¬T!                 â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚  ğŸ‘¤ Alice: "Great post!"           â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚  ğŸ‘¤ Bob: "Thanks for sharing!"     â”‚   â”‚          â”‚
  â”‚  â”‚  â”‚  ğŸ‘¤ Charlie: "Very helpful!"       â”‚   â”‚          â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚  â†’ "Loading comments..." BIáº¾N Máº¤T!                   â”‚
  â”‚  â†’ Ná»™i dung tháº­t HIá»†N NGAY khÃ´ng cáº§n reload!         â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Hydration TRÆ¯á»šC Khi Táº£i Háº¿t JS â€” Selective Hydration Trong Thá»±c Táº¿

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  HYDRATE Tá»ªNG PHáº¦N â€” KHÃ”NG CHá»œ Táº¢I Háº¾T JS!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  NGUYÃŠN LÃ:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 18 + Suspense + Code-Splitting:                 â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Má»—i <Suspense> boundary = 1 "Ä‘Æ¡n vá»‹ hydration"  â”‚
  â”‚  â†’ JS cho má»—i boundary Ä‘Æ°á»£c Táº¢I RIÃŠNG (chunk!)      â”‚
  â”‚  â†’ Boundary nÃ o Táº¢I XONG JS â†’ HYDRATE NGAY!         â”‚
  â”‚  â†’ KHÃ”NG Äá»¢I cÃ¡c boundary khÃ¡c!                      â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Giá»‘ng hÃ ng Ä‘á»£i á»Ÿ sÃ¢n bay:                        â”‚
  â”‚  â†’ Má»—i quáº§y check-in = 1 Suspense boundary           â”‚
  â”‚  â†’ HÃ nh khÃ¡ch nÃ o cÃ³ BOARDING PASS (JS) â†’ lÃªn mÃ¡y    â”‚
  â”‚    bay NGAY!                                           â”‚
  â”‚  â†’ KHÃ”NG Cáº¦N Ä‘á»£i táº¥t cáº£ hÃ nh khÃ¡ch cÃ³ boarding pass!â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ HYDRATION Tá»ªNG PHáº¦N:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  HTML Ä‘Ã£ nháº­n tá»« server:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  <Header />     â”‚ JS: header.js (15KB)   â”‚          â”‚
  â”‚  â”‚  <Nav />        â”‚ JS: nav.js (10KB)      â”‚          â”‚
  â”‚  â”‚  <Main />       â”‚ JS: main.js (20KB)     â”‚          â”‚
  â”‚  â”‚  <Sidebar />    â”‚ JS: sidebar.js (30KB)  â”‚          â”‚
  â”‚  â”‚  <Comments />   â”‚ JS: comments.js (200KB)â”‚          â”‚
  â”‚  â”‚  <Footer />     â”‚ JS: footer.js (5KB)    â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â”‚  THá»¨Tá»° Táº¢I JS + HYDRATE:                             â”‚
  â”‚                                                        â”‚
  â”‚  t=100ms: footer.js (5KB) táº£i xong!                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header  â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Nav     â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Main    â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Sidebar â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Commentsâ–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Footer  âœ… HYDRATED! (JS nhá», táº£i nhanh!)â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â”‚  t=200ms: nav.js (10KB) táº£i xong!                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header  â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  Nav     âœ… HYDRATED! (click Ä‘Æ°á»£c!)       â”‚          â”‚
  â”‚  â”‚  Main    â–‘â–‘â–‘ (chá» JS)                    â”‚          â”‚
  â”‚  â”‚  ...                                      â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â”‚  t=300ms: header.js (15KB) táº£i xong!                  â”‚
  â”‚  â†’ Header âœ… HYDRATED!                                â”‚
  â”‚                                                        â”‚
  â”‚  t=500ms: main.js (20KB) táº£i xong!                    â”‚
  â”‚  â†’ Main âœ… HYDRATED!                                  â”‚
  â”‚                                                        â”‚
  â”‚  t=800ms: sidebar.js (30KB) táº£i xong!                 â”‚
  â”‚  â†’ Sidebar âœ… HYDRATED!                               â”‚
  â”‚                                                        â”‚
  â”‚  t=2000ms: comments.js (200KB) táº£i xong!              â”‚
  â”‚  â†’ Comments âœ… HYDRATED!                              â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ User tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c Nav tá»« t=200ms!              â”‚
  â”‚  â†’ KHÃ”NG Cáº¦N Ä‘á»£i comments.js (200KB)!                â”‚
  â”‚  â†’ TrÆ°á»›c Ä‘Ã¢y: pháº£i Ä‘á»£i 2000ms cho Táº¤T Cáº¢!          â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Æ¯u TiÃªn Hydration Theo User Interaction

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  USER CLICK ÄÃ‚U â†’ HYDRATE ÄÃ“ TRÆ¯á»šC! (Tá»° Äá»˜NG!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CÆ  CHáº¾ Æ¯U TIÃŠN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 18 Selective Hydration cÃ³ Äáº¶C ÄIá»‚M Äá»˜C ÄÃO:â”‚
  â”‚                                                        â”‚
  â”‚  Khi user CLICK vÃ o component CHÆ¯A hydrate:           â”‚
  â”‚  â†’ React GHI NHáº¬N event Ä‘Ã³!                          â”‚
  â”‚  â†’ NGá»ªNG hydrate component hiá»‡n táº¡i!                  â”‚
  â”‚  â†’ Æ¯U TIÃŠN hydrate component mÃ  user Ä‘ang click!    â”‚
  â”‚  â†’ SAU KHI hydrate xong â†’ REPLAY event Ä‘Ã£ ghi!      â”‚
  â”‚  â†’ User cáº£m tháº¥y trang PHáº¢N Há»’I NGAY!              â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ KhÃ´ng cáº§n developer cáº¥u hÃ¬nh gÃ¬!                  â”‚
  â”‚  â†’ React Tá»° Äá»˜NG phÃ¡t hiá»‡n vÃ  Æ°u tiÃªn!              â”‚
  â”‚  â†’ ÄÃ¢y lÃ  sá»©c máº¡nh cá»§a CONCURRENT MODE!               â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ Æ¯U TIÃŠN HYDRATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TRáº NG THÃI BAN Äáº¦U:                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header     âœ… Hydrated                  â”‚          â”‚
  â”‚  â”‚  Sidebar    â³ Äang hydrate... (50%)     â”‚          â”‚
  â”‚  â”‚  Main       â¸ Chá»...                     â”‚          â”‚
  â”‚  â”‚  Comments   â¸ Chá»...                     â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚              â”‚                                         â”‚
  â”‚              â”‚ User CLICK vÃ o Comments! ğŸ–±ï¸            â”‚
  â”‚              â”‚ (Comments CHÆ¯A hydrate!)                â”‚
  â”‚              â–¼                                         â”‚
  â”‚  REACT PHÃT HIá»†N:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚                                           â”‚          â”‚
  â”‚  â”‚  â‘  "User muá»‘n tÆ°Æ¡ng tÃ¡c Comments!"      â”‚          â”‚
  â”‚  â”‚  â‘¡ PAUSE hydrate Sidebar (50%)!          â”‚          â”‚
  â”‚  â”‚  â‘¢ Æ¯U TIÃŠN hydrate Comments TRÆ¯á»šC!      â”‚          â”‚
  â”‚  â”‚  â‘£ GHI Láº I click event!                  â”‚          â”‚
  â”‚  â”‚                                           â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚              â”‚                                         â”‚
  â”‚              â–¼                                         â”‚
  â”‚  SAU KHI Æ¯U TIÃŠN:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header     âœ… Hydrated                  â”‚          â”‚
  â”‚  â”‚  Sidebar    â¸ Táº M Dá»ªNG! (50%)           â”‚          â”‚
  â”‚  â”‚  Main       â¸ Chá»...                     â”‚          â”‚
  â”‚  â”‚  Comments   âš¡ ÄANG HYDRATE! (Æ°u tiÃªn!) â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚              â”‚                                         â”‚
  â”‚              â–¼                                         â”‚
  â”‚  COMMENTS HYDRATE XONG:                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header     âœ… Hydrated                  â”‚          â”‚
  â”‚  â”‚  Sidebar    â¸ Táº M Dá»ªNG (50%)            â”‚          â”‚
  â”‚  â”‚  Main       â¸ Chá»...                     â”‚          â”‚
  â”‚  â”‚  Comments   âœ… Hydrated!                  â”‚          â”‚
  â”‚  â”‚             â”‚                              â”‚          â”‚
  â”‚  â”‚             â””â†’ REPLAY click event!         â”‚          â”‚
  â”‚  â”‚                â†’ onClick handler cháº¡y!     â”‚          â”‚
  â”‚  â”‚                â†’ User tháº¥y pháº£n há»“i NGAY! â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚              â”‚                                         â”‚
  â”‚              â–¼                                         â”‚
  â”‚  TIáº¾P Tá»¤C HYDRATE BÃŒNH THÆ¯á»œNG:                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Header     âœ… Hydrated                  â”‚          â”‚
  â”‚  â”‚  Sidebar    â³ TIáº¾P Tá»¤C tá»« 50%...       â”‚          â”‚
  â”‚  â”‚  Main       â³ Äang hydrate...            â”‚          â”‚
  â”‚  â”‚  Comments   âœ… Hydrated                  â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ TOÃ€N Bá»˜ quÃ¡ trÃ¬nh Tá»° Äá»˜NG!                       â”‚
  â”‚  â†’ Developer chá»‰ cáº§n bá»c <Suspense>!                 â”‚
  â”‚  â†’ React tá»± Æ°u tiÃªn dá»±a trÃªn user interaction!       â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ CONCURRENT RENDERING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 18 â€” Concurrent Mode:                           â”‚
  â”‚                                                        â”‚
  â”‚  Main Thread Timeline:                                 â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚  â”‚Hydrateâ”‚Hydrateâ”‚USER â”‚Hydrateâ”‚Hydrateâ”‚Hydrateâ”‚     â”‚
  â”‚  â”‚Header â”‚Sidebarâ”‚CLICKâ”‚Commentâ”‚Commentâ”‚Sidebarâ”‚     â”‚
  â”‚  â”‚       â”‚(báº¯t  â”‚ !!! â”‚(Æ°u   â”‚ XONG! â”‚(tiáº¿p  â”‚     â”‚
  â”‚  â”‚ XONG! â”‚ Ä‘áº§u) â”‚     â”‚tiÃªn!)â”‚       â”‚ tá»¥c!) â”‚     â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
  â”‚                   â”‚                                     â”‚
  â”‚                   â–¼                                     â”‚
  â”‚          React YIELD main thread!                       â”‚
  â”‚          â†’ Xá»­ lÃ½ user event!                          â”‚
  â”‚          â†’ Ghi nháº­n click!                             â”‚
  â”‚          â†’ Chuyá»ƒn Æ°u tiÃªn!                            â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ "YIELD" = nhÆ°á»ng quyá»n!                           â”‚
  â”‚  â†’ React KHÃ”NG chiáº¿m main thread liÃªn tá»¥c!            â”‚
  â”‚  â†’ Má»—i ~5ms React kiá»ƒm tra: "CÃ³ event nÃ o khÃ´ng?"   â”‚
  â”‚  â†’ Náº¿u CÃ“ â†’ pause hydration, xá»­ lÃ½ event!           â”‚
  â”‚  â†’ ÄÃ¢y lÃ  Concurrent Mode!                            â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Tá»± Viáº¿t Tay Streaming SSR Server â€” KhÃ´ng DÃ¹ng Framework

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Tá»° VIáº¾T SERVER STREAMING SSR Tá»ª Sá» 0!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CODE SERVER â€” STREAMING Vá»šI renderToPipeableStream:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // server.js â€” Tá»± viáº¿t tay, giáº£i thÃ­ch tá»«ng dÃ²ng!   â”‚
  â”‚  import express from 'express';                        â”‚
  â”‚  import { renderToPipeableStream }                     â”‚
  â”‚    from 'react-dom/server';                            â”‚
  â”‚  import App from './App';                              â”‚
  â”‚                                                        â”‚
  â”‚  const app = express();                                â”‚
  â”‚                                                        â”‚
  â”‚  // Serve static files (JS chunks!)                    â”‚
  â”‚  app.use('/static', express.static('build/static'));   â”‚
  â”‚                                                        â”‚
  â”‚  app.get('/', (req, res) => {                          â”‚
  â”‚    // â‘  Gá»i renderToPipeableStream!                   â”‚
  â”‚    const { pipe, abort } = renderToPipeableStream(     â”‚
  â”‚      // Component cáº§n render                           â”‚
  â”‚      <App />,                                          â”‚
  â”‚      {                                                 â”‚
  â”‚        // â‘¡ JS files cáº§n táº£i trÃªn client!             â”‚
  â”‚        bootstrapScripts: ['/static/main.js'],          â”‚
  â”‚                                                        â”‚
  â”‚        // â‘¢ "Shell" sáºµn sÃ ng = pháº§n KHÃ”NG            â”‚
  â”‚        // náº±m trong Suspense!                          â”‚
  â”‚        onShellReady() {                                â”‚
  â”‚          // Set header TRÆ¯á»šC khi stream!               â”‚
  â”‚          res.statusCode = 200;                         â”‚
  â”‚          res.setHeader(                                â”‚
  â”‚            'Content-Type',                             â”‚
  â”‚            'text/html; charset=utf-8'                  â”‚
  â”‚          );                                            â”‚
  â”‚          // â‘£ Báº®T Äáº¦U stream HTML!                   â”‚
  â”‚          // pipe() = "ná»‘i á»‘ng" tá»« React â†’ response!  â”‚
  â”‚          pipe(res);                                    â”‚
  â”‚        },                                              â”‚
  â”‚                                                        â”‚
  â”‚        // â‘¤ Shell bá»‹ lá»—i!                             â”‚
  â”‚        onShellError(error) {                           â”‚
  â”‚          res.statusCode = 500;                         â”‚
  â”‚          res.send('<!DOCTYPE html><p>Error!</p>');     â”‚
  â”‚        },                                              â”‚
  â”‚                                                        â”‚
  â”‚        // â‘¥ ToÃ n bá»™ stream hoÃ n táº¥t!                â”‚
  â”‚        onAllReady() {                                  â”‚
  â”‚          // CÃ³ thá»ƒ log hoáº·c cleanup                   â”‚
  â”‚          console.log('All content streamed!');         â”‚
  â”‚        },                                              â”‚
  â”‚                                                        â”‚
  â”‚        // â‘¦ Lá»—i trong Suspense boundary!             â”‚
  â”‚        onError(error) {                                â”‚
  â”‚          console.error('Streaming error:', error);     â”‚
  â”‚        },                                              â”‚
  â”‚      }                                                 â”‚
  â”‚    );                                                  â”‚
  â”‚                                                        â”‚
  â”‚    // â‘§ Timeout: há»§y stream sau 10 giÃ¢y!            â”‚
  â”‚    setTimeout(() => abort(), 10000);                   â”‚
  â”‚  });                                                   â”‚
  â”‚                                                        â”‚
  â”‚  app.listen(3000);                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  GIáº¢I THÃCH Tá»ªNG CALLBACK:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  onShellReady():                              â”‚      â”‚
  â”‚  â”‚  â†’ "Shell" = HTML NGOÃ€I Suspense boundaries! â”‚      â”‚
  â”‚  â”‚  â†’ Header, Nav, Footer = shell!               â”‚      â”‚
  â”‚  â”‚  â†’ Suspense fallbacks CÅ¨NG náº±m trong shell!  â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i pipe(res) Ä‘á»ƒ Báº®T Äáº¦U stream!        â”‚      â”‚
  â”‚  â”‚  â†’ Client nháº­n HTML NGAY!                     â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  onAllReady():                                â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i khi Táº¤T Cáº¢ Suspense Ä‘Ã£ resolve!     â”‚      â”‚
  â”‚  â”‚  â†’ Bao gá»“m cáº£ component cháº­m!               â”‚      â”‚
  â”‚  â”‚  â†’ DÃ¹ng cho SSG (Static Generation):         â”‚      â”‚
  â”‚  â”‚    â†’ Náº¿u muá»‘n Ä‘á»£i Háº¾T má»›i gá»­i!             â”‚      â”‚
  â”‚  â”‚    â†’ Thay pipe(res) vÃ o onAllReady!           â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  onShellError():                              â”‚      â”‚
  â”‚  â”‚  â†’ Shell render THáº¤T Báº I!                    â”‚      â”‚
  â”‚  â”‚  â†’ Tráº£ 500 error page!                       â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG stream!                              â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  onError():                                   â”‚      â”‚
  â”‚  â”‚  â†’ Lá»—i trong Suspense boundary!              â”‚      â”‚
  â”‚  â”‚  â†’ KhÃ´ng crash page!                          â”‚      â”‚
  â”‚  â”‚  â†’ Fallback váº«n hiá»ƒn thá»‹!                    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  bootstrapScripts:                            â”‚      â”‚
  â”‚  â”‚  â†’ React Tá»° THÃŠM <script> tags vÃ o HTML!    â”‚      â”‚
  â”‚  â”‚  â†’ Client táº£i JS â†’ hydrateRoot Tá»° Äá»˜NG!    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ pipe() STREAM:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  renderToPipeableStream(<App />)                       â”‚
  â”‚           â”‚                                             â”‚
  â”‚           â”‚ Táº¡o "pipeable stream"                      â”‚
  â”‚           â–¼                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚  â”‚  React Renderer   â”‚       â”‚  HTTP Response   â”‚       â”‚
  â”‚  â”‚                   â”‚ pipe()â”‚  (res)           â”‚       â”‚
  â”‚  â”‚  Chunk 1: Shell   â”œâ”€â”€â”€â”€â”€â”€â”€â–¶  â†’ Client nháº­n! â”‚       â”‚
  â”‚  â”‚  Chunk 2: Sidebar â”œâ”€â”€â”€â”€â”€â”€â”€â–¶  â†’ Client nháº­n! â”‚       â”‚
  â”‚  â”‚  Chunk 3: Commentsâ”œâ”€â”€â”€â”€â”€â”€â”€â–¶  â†’ Client nháº­n! â”‚       â”‚
  â”‚  â”‚  ...              â”‚       â”‚                  â”‚       â”‚
  â”‚  â”‚  END              â”œâ”€â”€â”€â”€â”€â”€â”€â–¶  â†’ Stream káº¿t   â”‚       â”‚
  â”‚  â”‚                   â”‚       â”‚    thÃºc!         â”‚       â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Giá»‘ng "á»‘ng nÆ°á»›c" (pipe):                           â”‚
  â”‚  â†’ NÆ°á»›c (HTML) cháº£y Dáº¦N Dáº¦N qua á»‘ng!                â”‚
  â”‚  â†’ KHÃ”NG Äá»¢I Ä‘áº§y bá»ƒ má»›i xáº£!                        â”‚
  â”‚  â†’ Client nháº­n tá»«ng "giá»t" HTML!                      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Tá»± Viáº¿t Tay Client Hydration Vá»›i hydrateRoot

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  hydrateRoot â€” CLIENT-SIDE SELECTIVE HYDRATION!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  hydrate() vs hydrateRoot():
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• React 17: hydrate() â•â•â•                           â”‚
  â”‚                                                        â”‚
  â”‚  import { hydrate } from 'react-dom';                  â”‚
  â”‚  hydrate(<App />, document.getElementById('root'));    â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Äá»’NG Bá»˜ (synchronous)!                            â”‚
  â”‚  â†’ Block main thread!                                  â”‚
  â”‚  â†’ Hydrate Táº¤T Cáº¢ hoáº·c KHÃ”NG GÃŒ!                   â”‚
  â”‚  â†’ KHÃ”NG há»— trá»£ Concurrent Mode!                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• React 18: hydrateRoot() â•â•â•                       â”‚
  â”‚                                                        â”‚
  â”‚  import { hydrateRoot } from 'react-dom/client';       â”‚
  â”‚  hydrateRoot(                                          â”‚
  â”‚    document.getElementById('root'),                    â”‚
  â”‚    <App />                                             â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Báº¤T Äá»’NG Bá»˜ (async, concurrent)!                 â”‚
  â”‚  â†’ KHÃ”NG block main thread liÃªn tá»¥c!                  â”‚
  â”‚  â†’ Hydrate Tá»ªNG Suspense boundary!                   â”‚
  â”‚  â†’ CÃ³ thá»ƒ PAUSE, RESUME, Æ¯U TIÃŠN!                   â”‚
  â”‚  â†’ PhÃ¡t hiá»‡n user interaction â†’ Æ°u tiÃªn!             â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  CODE CLIENT â€” Tá»° VIáº¾T TAY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // index.jsx â€” Client entry point!                    â”‚
  â”‚  import { hydrateRoot } from 'react-dom/client';       â”‚
  â”‚  import App from './App';                              â”‚
  â”‚                                                        â”‚
  â”‚  // â‘  Láº¥y root element (server Ä‘Ã£ render HTML!)      â”‚
  â”‚  const rootElement = document.getElementById('root');  â”‚
  â”‚                                                        â”‚
  â”‚  // â‘¡ hydrateRoot = báº¯t Ä‘áº§u selective hydration!     â”‚
  â”‚  const root = hydrateRoot(                             â”‚
  â”‚    rootElement,                                        â”‚
  â”‚    <App />,                                            â”‚
  â”‚    {                                                   â”‚
  â”‚      // â‘¢ Xá»­ lÃ½ hydration mismatch!                  â”‚
  â”‚      onRecoverableError(error) {                       â”‚
  â”‚        console.warn('Hydration mismatch:', error);     â”‚
  â”‚        // React tá»± kháº¯c phá»¥c báº±ng cÃ¡ch                â”‚
  â”‚        // re-render pháº§n bá»‹ lá»—i trÃªn client!         â”‚
  â”‚      },                                                â”‚
  â”‚    }                                                   â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  GIáº¢I THÃCH:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  hydrateRoot(container, reactNode, options)    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  container:                                   â”‚      â”‚
  â”‚  â”‚  â†’ DOM element chá»©a HTML tá»« server!          â”‚      â”‚
  â”‚  â”‚  â†’ React sáº½ "gáº¯n" vÃ o DOM nÃ y!              â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  reactNode:                                   â”‚      â”‚
  â”‚  â”‚  â†’ React component tree (PHáº¢I GIá»NG server!) â”‚      â”‚
  â”‚  â”‚  â†’ React so sÃ¡nh Ä‘á»ƒ tÃ¬m Ä‘iá»ƒm gáº¯n events!  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  options.onRecoverableError:                   â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i khi HTML server â‰  client render!     â”‚      â”‚
  â”‚  â”‚  â†’ React 18 Tá»° KHáº®C PHá»¤C (re-render!)      â”‚      â”‚
  â”‚  â”‚  â†’ React 17: crash hoáº·c warning!             â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Tráº£ vá» root object:                          â”‚      â”‚
  â”‚  â”‚  â†’ root.render(<NewApp />) = update!          â”‚      â”‚
  â”‚  â”‚  â†’ root.unmount() = unmount!                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Tá»± Viáº¿t Tay Suspense-like Placeholder Cho SSR

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  HIá»‚U SUSPENSE Báº°NG CÃCH Tá»° VIáº¾T!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CÃCH REACT 18 Xá»¬ LÃ SUSPENSE TRÃŠN SERVER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Khi server gáº·p <Suspense>, React lÃ m 3 bÆ°á»›c:        â”‚
  â”‚                                                        â”‚
  â”‚  â‘  Render FALLBACK thÃ nh HTML:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  <!--$?-->                                â”‚          â”‚
  â”‚  â”‚  <template id="B:0"></template>           â”‚          â”‚
  â”‚  â”‚  <div class="spinner">Loading...</div>    â”‚ Fallback â”‚
  â”‚  â”‚  <!--/$-->                                â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚  â†’ <!--$?--> vÃ  <!--/$--> = marker cho React!        â”‚
  â”‚  â†’ <template id="B:0"> = vá»‹ trÃ­ sáº½ THAY THáº¾!       â”‚
  â”‚  â†’ Fallback HTML HIá»†N cho user!                       â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Khi data READY â†’ stream thÃªm HTML:               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  <div hidden id="S:0">                   â”‚          â”‚
  â”‚  â”‚    <div class="comments">                â”‚ Ná»™i dung â”‚
  â”‚  â”‚      <p>Comment 1</p>                    â”‚ THáº¬T!    â”‚
  â”‚  â”‚      <p>Comment 2</p>                    â”‚          â”‚
  â”‚  â”‚    </div>                                â”‚          â”‚
  â”‚  â”‚  </div>                                  â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚  â†’ hidden: áº¨N trong DOM, user KHÃ”NG tháº¥y!           â”‚
  â”‚  â†’ id="S:0": React dÃ¹ng Ä‘á»ƒ tÃ¬m ná»™i dung!            â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Inline <script> THAY THáº¾ fallback:                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  <script>                                â”‚          â”‚
  â”‚  â”‚    // $RC = "Replace Content"             â”‚          â”‚
  â”‚  â”‚    // React gá»i hÃ m ná»™i bá»™:             â”‚          â”‚
  â”‚  â”‚    $RC("B:0", "S:0");                    â”‚          â”‚
  â”‚  â”‚    // â†’ TÃ¬m template B:0                â”‚          â”‚
  â”‚  â”‚    // â†’ TÃ¬m ná»™i dung S:0               â”‚          â”‚
  â”‚  â”‚    // â†’ THAY THáº¾ fallback báº±ng ná»™i dungâ”‚          â”‚
  â”‚  â”‚    // â†’ User tháº¥y comments HIá»†N!        â”‚          â”‚
  â”‚  â”‚  </script>                               â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Tá»° VIáº¾T HÃ€M $RC (REPLACE CONTENT):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // MÃ´ phá»ng hÃ m $RC mÃ  React 18 tá»± inject!         â”‚
  â”‚  // ÄÆ¡n giáº£n hÃ³a Ä‘á»ƒ HIá»‚U NGUYÃŠN LÃ!                 â”‚
  â”‚                                                        â”‚
  â”‚  function $RC(boundaryId, contentId) {                 â”‚
  â”‚    // â‘  TÃ¬m template marker (vá»‹ trÃ­ fallback)        â”‚
  â”‚    const boundary =                                    â”‚
  â”‚      document.getElementById(boundaryId);              â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¡ TÃ¬m ná»™i dung tháº­t (áº©n trong DOM)            â”‚
  â”‚    const content =                                     â”‚
  â”‚      document.getElementById(contentId);               â”‚
  â”‚                                                        â”‚
  â”‚    if (!boundary || !content) return;                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¢ TÃ¬m Suspense boundary markers                â”‚
  â”‚    // <!--$?--> ... <!--/$-->                          â”‚
  â”‚    const startMarker = boundary;                       â”‚
  â”‚    let node = startMarker.nextSibling;                 â”‚
  â”‚    const nodesToRemove = [];                           â”‚
  â”‚                                                        â”‚
  â”‚    // â‘£ Thu tháº­p Táº¤T Cáº¢ nodes giá»¯a markers          â”‚
  â”‚    // (fallback content!)                              â”‚
  â”‚    while (node) {                                      â”‚
  â”‚      if (node.nodeType === 8 &&                        â”‚
  â”‚          node.data === '/$') {                         â”‚
  â”‚        // TÃ¬m tháº¥y end marker!                        â”‚
  â”‚        break;                                          â”‚
  â”‚      }                                                 â”‚
  â”‚      nodesToRemove.push(node);                         â”‚
  â”‚      node = node.nextSibling;                          â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¤ XÃ“A fallback nodes!                          â”‚
  â”‚    nodesToRemove.forEach(n => n.remove());             â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¥ CHÃˆN ná»™i dung tháº­t vÃ o vá»‹ trÃ­!             â”‚
  â”‚    const parent = startMarker.parentNode;              â”‚
  â”‚    while (content.firstChild) {                        â”‚
  â”‚      parent.insertBefore(                              â”‚
  â”‚        content.firstChild,                             â”‚
  â”‚        startMarker.nextSibling                         â”‚
  â”‚      );                                                â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¦ Cleanup: xÃ³a template + hidden div!          â”‚
  â”‚    startMarker.remove();                               â”‚
  â”‚    content.remove();                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘§ React sáº½ HYDRATE pháº§n má»›i nÃ y!              â”‚
  â”‚    // â†’ Gáº¯n events, state...                          â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ TRÆ¯á»šC/SAU $RC():                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  TRÆ¯á»šC $RC("B:0", "S:0"):                    â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
  â”‚  â”‚  â”‚  <!--$?-->                         â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚  <template id="B:0"></template>    â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚  <div class="spinner">Loading</div>â”‚ HIá»†N! â”‚      â”‚
  â”‚  â”‚  â”‚  <!--/$-->                         â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚                                    â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚  <div hidden id="S:0">             â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚    <p>Comment 1</p>               â”‚ áº¨N!   â”‚      â”‚
  â”‚  â”‚  â”‚    <p>Comment 2</p>               â”‚        â”‚      â”‚
  â”‚  â”‚  â”‚  </div>                            â”‚        â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  SAU $RC("B:0", "S:0"):                      â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
  â”‚  â”‚  â”‚  <p>Comment 1</p>                â”‚ HIá»†N!  â”‚      â”‚
  â”‚  â”‚  â”‚  <p>Comment 2</p>                â”‚        â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
  â”‚  â”‚  â†’ Spinner BIáº¾N Máº¤T!                        â”‚      â”‚
  â”‚  â”‚  â†’ Ná»™i dung tháº­t HIá»†N!                      â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG reload trang!                        â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. Code-Splitting + Selective Hydration â€” Káº¿t Há»£p HoÃ n Chá»‰nh

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CODE-SPLITTING + SUSPENSE = SELECTIVE HYDRATION HOÃ€N Háº¢O!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CODE á»¨NG Dá»¤NG HOÃ€N CHá»ˆNH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // App.jsx â€” Káº¿t há»£p táº¥t cáº£ ká»¹ thuáº­t!               â”‚
  â”‚  import { Suspense, lazy } from 'react';               â”‚
  â”‚                                                        â”‚
  â”‚  // â‘  Code-split: má»—i component = 1 JS chunk!        â”‚
  â”‚  const Sidebar = lazy(() => import('./Sidebar'));       â”‚
  â”‚  const Comments = lazy(() => import('./Comments'));     â”‚
  â”‚  const RelatedPosts = lazy(                            â”‚
  â”‚    () => import('./RelatedPosts')                      â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  export default function App() {                       â”‚
  â”‚    return (                                            â”‚
  â”‚      <html>                                            â”‚
  â”‚        <head>                                          â”‚
  â”‚          <title>My Blog</title>                        â”‚
  â”‚        </head>                                         â”‚
  â”‚        <body>                                          â”‚
  â”‚          {/* â‘¡ CRITICAL: Hydrate NGAY! */}            â”‚
  â”‚          <Header />                                    â”‚
  â”‚          <Navigation />                                â”‚
  â”‚                                                        â”‚
  â”‚          <div className="layout">                      â”‚
  â”‚            {/* â‘¢ Main content: NGAY! */}               â”‚
  â”‚            <main>                                      â”‚
  â”‚              <ArticleContent />                        â”‚
  â”‚            </main>                                     â”‚
  â”‚                                                        â”‚
  â”‚            {/* â‘£ Sidebar: stream riÃªng! */}           â”‚
  â”‚            <Suspense                                   â”‚
  â”‚              fallback={<SidebarSkeleton />}             â”‚
  â”‚            >                                           â”‚
  â”‚              <Sidebar />                               â”‚
  â”‚            </Suspense>                                 â”‚
  â”‚          </div>                                        â”‚
  â”‚                                                        â”‚
  â”‚          {/* â‘¤ Comments: stream riÃªng! */}            â”‚
  â”‚          <Suspense                                     â”‚
  â”‚            fallback={<CommentsSkeleton />}              â”‚
  â”‚          >                                             â”‚
  â”‚            <Comments articleId={123} />                 â”‚
  â”‚          </Suspense>                                   â”‚
  â”‚                                                        â”‚
  â”‚          {/* â‘¥ Related: stream riÃªng! */}             â”‚
  â”‚          <Suspense                                     â”‚
  â”‚            fallback={<div>Loading...</div>}             â”‚
  â”‚          >                                             â”‚
  â”‚            <RelatedPosts />                            â”‚
  â”‚          </Suspense>                                   â”‚
  â”‚                                                        â”‚
  â”‚          <Footer />                                    â”‚
  â”‚        </body>                                         â”‚
  â”‚      </html>                                           â”‚
  â”‚    );                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ JS CHUNKS + HYDRATION ORDER:                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Webpack/Vite output:                         â”‚      â”‚
  â”‚  â”‚  â”œâ”€â”€ main.js       (50KB)  = Shell            â”‚      â”‚
  â”‚  â”‚  â”‚   (Header, Nav, Article, Footer)           â”‚      â”‚
  â”‚  â”‚  â”œâ”€â”€ sidebar.js    (25KB)  = Suspense #1      â”‚      â”‚
  â”‚  â”‚  â”œâ”€â”€ comments.js   (80KB)  = Suspense #2      â”‚      â”‚
  â”‚  â”‚  â””â”€â”€ related.js    (30KB)  = Suspense #3      â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Hydration order:                             â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
  â”‚  â”‚  â”‚main.jsâ”‚â”€â–¶â”‚Shell â”‚â”€â–¶â”‚sidebar â”‚â”€â–¶â”‚commentâ”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ 50KB  â”‚  â”‚hydrateâ”‚ â”‚hydrate â”‚  â”‚hydrateâ”‚ â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ Shell hydrate TRÆ¯á»šC (critical!)           â”‚      â”‚
  â”‚  â”‚  â†’ Suspense boundaries hydrate RIÃŠNG!        â”‚      â”‚
  â”‚  â”‚  â†’ User click Sidebar â†’ Æ°u tiÃªn Sidebar!    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. So SÃ¡nh: renderToString vs renderToPipeableStream

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Báº¢NG SO SÃNH TOÃ€N DIá»†N!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                 â”‚renderToString â”‚renderTo         â”‚  â”‚
  â”‚  â”‚                 â”‚(React 17)    â”‚PipeableStream   â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚(React 18)      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Output          â”‚ 1 chuá»—i HTMLâ”‚ Stream (chunks) â”‚  â”‚
  â”‚  â”‚                 â”‚ duy nháº¥t     â”‚ dáº§n dáº§n        â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Blocking?       â”‚ CÃ“! Äá»£i    â”‚ KHÃ”NG! Gá»­i    â”‚  â”‚
  â”‚  â”‚                 â”‚ háº¿t má»›i gá»­i â”‚ ngay khi sáºµn  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Suspense       â”‚ KHÃ”NG Há»–    â”‚ Há»– TRá»¢!       â”‚  â”‚
  â”‚  â”‚ trÃªn server    â”‚ TRá»¢!         â”‚ Render fallback â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ â†’ stream sau! â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Lazy loading   â”‚ KHÃ”NG!        â”‚ CÃ“! lazy() +  â”‚  â”‚
  â”‚  â”‚ (SSR)          â”‚               â”‚ Suspense!      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ FCP            â”‚ CHáº¬M (Ä‘á»£i   â”‚ NHANH (shell   â”‚  â”‚
  â”‚  â”‚                 â”‚ táº¥t cáº£!)    â”‚ gá»­i ngay!)    â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ TTI            â”‚ CHáº¬M (hydrateâ”‚ NHANH (hydrate â”‚  â”‚
  â”‚  â”‚                 â”‚ táº¥t cáº£!)    â”‚ tá»«ng pháº§n!)   â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Hydration      â”‚ hydrate()     â”‚ hydrateRoot()  â”‚  â”‚
  â”‚  â”‚                 â”‚ (Ä‘á»“ng bá»™)   â”‚ (concurrent!)  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ User priority  â”‚ KHÃ”NG!        â”‚ CÃ“! Click â†’   â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ Æ°u tiÃªn!      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Error handling â”‚ Crash cáº£    â”‚ Tá»«ng Suspense  â”‚  â”‚
  â”‚  â”‚                 â”‚ trang!       â”‚ boundary!      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ SEO            â”‚ Tá»‘t          â”‚ Tá»‘t (shell    â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ cÃ³ HTML Ä‘á»§!) â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§12. Next.js App Router â€” Selective Hydration TÃ­ch Há»£p Sáºµn

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  NEXT.JS 13+ = SELECTIVE HYDRATION MIá»„N PHÃ!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  NEXT.JS APP ROUTER Tá»° Äá»˜NG LÃ€M:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Má»—i route segment = 1 Suspense boundary Tá»° Äá»˜NG! â”‚
  â”‚  â‘¡ loading.js = Suspense fallback Tá»° Äá»˜NG!           â”‚
  â”‚  â‘¢ Server Components = KHÃ”NG cáº§n hydrate!             â”‚
  â”‚  â‘£ 'use client' = CHá»ˆ hydrate component nÃ y!         â”‚
  â”‚  â‘¤ Streaming SSR = renderToPipeableStream BÃŠN TRONG! â”‚
  â”‚                                                        â”‚
  â”‚  Cáº¤U TRÃšC APP ROUTER:                                 â”‚
  â”‚  app/                                                  â”‚
  â”‚  â”œâ”€â”€ layout.js        â†’ Server Component (ZERO JS!)  â”‚
  â”‚  â”œâ”€â”€ page.js          â†’ Server Component              â”‚
  â”‚  â”œâ”€â”€ loading.js       â†’ Suspense fallback Tá»° Äá»˜NG!  â”‚
  â”‚  â”œâ”€â”€ blog/                                             â”‚
  â”‚  â”‚   â”œâ”€â”€ page.js      â†’ Server Component              â”‚
  â”‚  â”‚   â”œâ”€â”€ loading.js   â†’ Suspense fallback cho /blog!  â”‚
  â”‚  â”‚   â””â”€â”€ [slug]/                                       â”‚
  â”‚  â”‚       â”œâ”€â”€ page.js  â†’ Server Component               â”‚
  â”‚  â”‚       â””â”€â”€ loading.js                                â”‚
  â”‚  â””â”€â”€ components/                                       â”‚
  â”‚      â”œâ”€â”€ SearchBar.js â†’ 'use client' (Cáº¦N hydrate!)  â”‚
  â”‚      â””â”€â”€ LikeButton.jsâ†’ 'use client' (Cáº¦N hydrate!) â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Next.js Tá»° Äá»˜NG bá»c Suspense quanh má»—i route!   â”‚
  â”‚  â†’ loading.js = Suspense fallback!                    â”‚
  â”‚  â†’ Developer KHÃ”NG Cáº¦N viáº¿t renderToPipeableStream!  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  CODE VÃ Dá»¤ NEXT.JS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // app/blog/[slug]/page.js â€” SERVER Component!       â”‚
  â”‚  // KHÃ”NG cÃ³ 'use client' â†’ cháº¡y CHá»ˆ trÃªn server!   â”‚
  â”‚                                                        â”‚
  â”‚  import { Suspense } from 'react';                     â”‚
  â”‚  import { LikeButton } from '@/components/LikeButton'; â”‚
  â”‚  import { Comments } from '@/components/Comments';     â”‚
  â”‚                                                        â”‚
  â”‚  // â‘  Async function = fetch trÃªn SERVER!             â”‚
  â”‚  export default async function BlogPost({ params }) {  â”‚
  â”‚    const post = await getPost(params.slug);            â”‚
  â”‚                                                        â”‚
  â”‚    return (                                            â”‚
  â”‚      <article>                                         â”‚
  â”‚        {/* â‘¡ Server render: ZERO JS! */}              â”‚
  â”‚        <h1>{post.title}</h1>                           â”‚
  â”‚        <div>{post.content}</div>                       â”‚
  â”‚                                                        â”‚
  â”‚        {/* â‘¢ Client Component: Cáº¦N hydrate! */}      â”‚
  â”‚        <LikeButton postId={post.id} />                 â”‚
  â”‚                                                        â”‚
  â”‚        {/* â‘£ Suspense: stream khi ready! */}          â”‚
  â”‚        <Suspense fallback={<p>Loading comments...</p>}>â”‚
  â”‚          <Comments postId={post.id} />                 â”‚
  â”‚        </Suspense>                                     â”‚
  â”‚      </article>                                        â”‚
  â”‚    );                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // components/LikeButton.js                           â”‚
  â”‚  'use client'; // â† CHá»ˆ component nÃ y cáº§n JS!        â”‚
  â”‚  import { useState } from 'react';                     â”‚
  â”‚                                                        â”‚
  â”‚  export function LikeButton({ postId }) {              â”‚
  â”‚    const [liked, setLiked] = useState(false);          â”‚
  â”‚    return (                                            â”‚
  â”‚      <button onClick={() => setLiked(!liked)}>         â”‚
  â”‚        {liked ? 'â¤ï¸' : 'ğŸ¤'} Like                    â”‚
  â”‚      </button>                                         â”‚
  â”‚    );                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Next.js App Router:                                â”‚
  â”‚  â†’ BlogPost (Server Component): ZERO JS gá»­i client! â”‚
  â”‚  â†’ LikeButton ('use client'): CHá»ˆ pháº§n nÃ y cáº§n JS!  â”‚
  â”‚  â†’ Comments (Suspense): stream khi data ready!        â”‚
  â”‚  â†’ Selective Hydration HOÃ€N TOÃ€N Tá»° Äá»˜NG!           â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§13. Best Practices & Anti-Patterns

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BEST PRACTICES + ANTI-PATTERNS!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  âœ… BEST PRACTICES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  DÃ¹ng Suspense bá»c component CHáº¬M / Náº¶G:          â”‚
  â”‚     â†’ Component fetch data bÃªn ngoÃ i                  â”‚
  â”‚     â†’ Component cÃ³ JS bundle Lá»šN                      â”‚
  â”‚     â†’ Component Ã­t quan trá»ng (below-the-fold)        â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Äáº·t Suspense boundaries ÄÃšÌ‰NG chá»—:              â”‚
  â”‚     â†’ Bá»c COMPONENT, khÃ´ng bá»c cáº£ trang!             â”‚
  â”‚     â†’ Má»—i Suspense = 1 Ä‘Æ¡n vá»‹ hydration!             â”‚
  â”‚     â†’ QuÃ¡ nhiá»u Suspense = overhead!                   â”‚
  â”‚     â†’ QuÃ¡ Ã­t = khÃ´ng táº­n dá»¥ng selective!              â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Critical components KHÃ”NG nÃªn trong Suspense:      â”‚
  â”‚     â†’ Navigation, Header (above-the-fold!)             â”‚
  â”‚     â†’ NÃºt CTA (Call-to-Action!)                       â”‚
  â”‚     â†’ Form inputs Ä‘ang hiá»ƒn thá»‹!                      â”‚
  â”‚     â†’ User THáº¤Y = user PHáº¢I tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c!          â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ DÃ¹ng renderToPipeableStream thay renderToString:   â”‚
  â”‚     â†’ React 18+ = LUÃ”N LUÃ”N dÃ¹ng stream!             â”‚
  â”‚     â†’ onShellReady = flush ngay!                       â”‚
  â”‚     â†’ KHÃ”NG dÃ¹ng onAllReady (trá»« SSG!)               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ DÃ¹ng hydrateRoot, KHÃ”NG hydrate:                  â”‚
  â”‚     â†’ hydrate() = DEPRECATED trong React 18!          â”‚
  â”‚     â†’ hydrateRoot() = concurrent features!             â”‚
  â”‚     â†’ Selective hydration CHá»ˆ hoáº¡t Ä‘á»™ng vá»›i           â”‚
  â”‚       hydrateRoot!                                     â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ Fallback PHáº¢I nháº¹ vÃ  nhanh:                       â”‚
  â”‚     â†’ Skeleton UI = Tá»T!                               â”‚
  â”‚     â†’ Spinner Ä‘Æ¡n giáº£n = OK!                          â”‚
  â”‚     â†’ null = OK cho pháº§n khÃ´ng quan trá»ng!            â”‚
  â”‚     â†’ Component PHá»¨C Táº P = KHÃ”NG! (lÃ m cháº­m shell!) â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  âŒ ANTI-PATTERNS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  âŒ â‘  Bá»c Suspense quanh TOÃ€N Bá»˜ app:               â”‚
  â”‚     // SAI!                                            â”‚
  â”‚     <Suspense fallback={<Loading />}>                   â”‚
  â”‚       <App />  â† TOÃ€N bá»™ app trong Suspense!         â”‚
  â”‚     </Suspense>                                        â”‚
  â”‚     â†’ = renderToString! KhÃ´ng selective gÃ¬ cáº£!       â”‚
  â”‚                                                        â”‚
  â”‚  âŒ â‘¡ DÃ¹ng renderToString vá»›i React 18:               â”‚
  â”‚     const html = renderToString(<App />);              â”‚
  â”‚     â†’ Máº¤T táº¥t cáº£ selective hydration!                 â”‚
  â”‚     â†’ Máº¤T streaming!                                   â”‚
  â”‚     â†’ Quay láº¡i váº¥n Ä‘á» cÅ©!                            â”‚
  â”‚                                                        â”‚
  â”‚  âŒ â‘¢ NÃºt báº¥m trong Suspense fallback:               â”‚
  â”‚     <Suspense fallback={<Spinner />}>                   â”‚
  â”‚       <BuyButton />  â† User THáº¤Y spinner,            â”‚
  â”‚     </Suspense>         KHÃ”NG click mua Ä‘Æ°á»£c!         â”‚
  â”‚     â†’ Critical buttons KHÃ”NG nÃªn trong Suspense!      â”‚
  â”‚                                                        â”‚
  â”‚  âŒ â‘£ KhÃ´ng dÃ¹ng code-splitting:                      â”‚
  â”‚     import Comments from './Comments';                 â”‚
  â”‚     â†’ Comments Náº°M trong main bundle!                 â”‚
  â”‚     â†’ Suspense KHÃ”NG tÃ¡ch Ä‘Æ°á»£c!                       â”‚
  â”‚     â†’ PHáº¢I dÃ¹ng lazy() hoáº·c dynamic import!           â”‚
  â”‚                                                        â”‚
  â”‚  âŒ â‘¤ QuÃªn onRecoverableError:                       â”‚
  â”‚     hydrateRoot(root, <App />);                        â”‚
  â”‚     â†’ Mismatch sáº½ SILENT fail!                        â”‚
  â”‚     â†’ LUÃ”N log onRecoverableError Ä‘á»ƒ debug!           â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§14. Phá»ng Váº¥n Q&A â€” CÃ¢u Há»i ThÆ°á»ng Gáº·p

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CÃ‚U Há»I PHá»NG Váº¤N Vá»€ SELECTIVE HYDRATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Q1: Selective Hydration lÃ  gÃ¬? NÃ³ giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Selective Hydration (React 18) cho phÃ©p hydrate   â”‚
  â”‚  Tá»ªNG PHáº¦N cÃ¢y component CÃ“ CHá»ŒN Lá»ŒC. NÃ³ giáº£i      â”‚
  â”‚  quyáº¿t 3 váº¥n Ä‘á» cá»§a SSR truyá»n thá»‘ng:               â”‚
  â”‚  â‘  Server pháº£i render xong háº¿t má»›i gá»­i HTML         â”‚
  â”‚    â†’ Stream: gá»­i dáº§n dáº§n!                             â”‚
  â”‚  â‘¡ Client pháº£i táº£i xong háº¿t JS má»›i hydrate          â”‚
  â”‚    â†’ Hydrate ngay khi JS chunk sáºµn sÃ ng!             â”‚
  â”‚  â‘¢ Hydration blocking, khÃ´ng tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c          â”‚
  â”‚    â†’ Concurrent: pause/resume, Æ°u tiÃªn theo click!  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q2: renderToPipeableStream khÃ¡c renderToString tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: renderToString táº¡o 1 chuá»—i HTML hoÃ n chá»‰nh,     â”‚
  â”‚  BLOCKING cho Ä‘áº¿n khi toÃ n bá»™ cÃ¢y render xong.       â”‚
  â”‚  renderToPipeableStream táº¡o má»™t STREAM, gá»­i HTML     â”‚
  â”‚  Dáº¦N Dáº¦N qua pipe(). Shell (ngoÃ i Suspense) gá»­i     â”‚
  â”‚  ngay qua onShellReady. Suspense boundaries gá»­i      â”‚
  â”‚  sau khi resolve, kÃ¨m inline <script> Ä‘á»ƒ thay tháº¿   â”‚
  â”‚  fallback. FCP nhanh hÆ¡n vÃ¬ client nháº­n HTML ngay!   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q3: Suspense trÃªn server hoáº¡t Ä‘á»™ng tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Server gáº·p <Suspense> â†’ render FALLBACK thÃ nh    â”‚
  â”‚  HTML, Ä‘Ã¡nh dáº¥u báº±ng comment markers (<!--$?-->).    â”‚
  â”‚  Tiáº¿p tá»¥c render pháº§n cÃ²n láº¡i KHÃ”NG Ä‘á»£i. Khi        â”‚
  â”‚  component bÃªn trong resolve (data ready), React      â”‚
  â”‚  stream thÃªm HTML áº©n (hidden div) + inline <script>  â”‚
  â”‚  gá»i $RC() Ä‘á»ƒ THAY THáº¾ fallback báº±ng ná»™i dung      â”‚
  â”‚  tháº­t. Client sau Ä‘Ã³ hydrate components má»›i.          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q4: React Æ°u tiÃªn hydration theo user interaction
      tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: React 18 Concurrent Mode cho phÃ©p PAUSE hydration â”‚
  â”‚  má»—i ~5ms Ä‘á»ƒ kiá»ƒm tra events. Khi user click vÃ o   â”‚
  â”‚  component CHÆ¯A hydrate, React:                       â”‚
  â”‚  â‘  Ghi nháº­n event (capture phase!)                   â”‚
  â”‚  â‘¡ PAUSE hydration component hiá»‡n táº¡i                â”‚
  â”‚  â‘¢ Æ¯U TIÃŠN hydrate component user Ä‘ang click        â”‚
  â”‚  â‘£ Sau hydrate xong â†’ REPLAY event Ä‘Ã£ ghi          â”‚
  â”‚  â†’ User tháº¥y pháº£n há»“i NGAY, khÃ´ng cáº§n code thÃªm!  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q5: Khi nÃ o dÃ¹ng onShellReady vs onAllReady?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: onShellReady: khi muá»‘n STREAMING SSR! Gá»i       â”‚
  â”‚  pipe(res) á»Ÿ Ä‘Ã¢y â†’ gá»­i shell + fallbacks NGAY!      â”‚
  â”‚  Suspense contents stream sau. DÃ¹ng cho WEB SERVER.   â”‚
  â”‚  onAllReady: khi muá»‘n Ä‘á»£i Táº¤T Cáº¢ content xong!     â”‚
  â”‚  DÃ¹ng cho SSG (Static Site Generation) hoáº·c           â”‚
  â”‚  crawlers/bots cáº§n HTML Ä‘áº§y Ä‘á»§.                      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q6: Next.js App Router táº­n dá»¥ng Selective Hydration
      tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Next.js App Router Tá»° Äá»˜NG:                      â”‚
  â”‚  â‘  Má»—i route segment = 1 Suspense boundary           â”‚
  â”‚  â‘¡ loading.js = Suspense fallback tá»± Ä‘á»™ng            â”‚
  â”‚  â‘¢ Server Components (default) = ZERO JS!             â”‚
  â”‚  â‘£ 'use client' = chá»‰ hydrate component Ä‘Ã³          â”‚
  â”‚  â‘¤ BÃªn trong dÃ¹ng renderToPipeableStream              â”‚
  â”‚  Developer KHÃ”NG cáº§n viáº¿t SSR logic!                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q7: hydrate() vs hydrateRoot() â€” khÃ¡c nhau tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: hydrate() (React 17): Äá»’NG Bá»˜, block main       â”‚
  â”‚  thread, hydrate Táº¤T Cáº¢ 1 láº§n, KHÃ”NG há»— trá»£        â”‚
  â”‚  concurrent features, KHÃ”NG selective hydration.       â”‚
  â”‚  hydrateRoot() (React 18): Báº¤T Äá»’NG Bá»˜, concurrent, â”‚
  â”‚  hydrate tá»«ng Suspense boundary riÃªng, cÃ³ thá»ƒ       â”‚
  â”‚  pause/resume, Æ°u tiÃªn theo user interaction,         â”‚
  â”‚  onRecoverableError cho hydration mismatch.            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q8: Inline <script> mÃ  React stream cÃ³ an toÃ n khÃ´ng?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: CÃ“! React tá»± generate inline scripts (hÃ m $RC,  â”‚
  â”‚  $RS...) Ä‘á»ƒ thay tháº¿ Suspense fallbacks. ÄÃ¢y lÃ       â”‚
  â”‚  scripts React Tá»° Táº O, khÃ´ng pháº£i user input â†’      â”‚
  â”‚  KHÃ”NG cÃ³ XSS risk. Scripts nÃ y Ráº¤T NHá» (vÃ i dÃ²ng) â”‚
  â”‚  vÃ  cháº¡y NGAY khi nháº­n â†’ khÃ´ng cáº§n Ä‘á»£i main bundle. â”‚
  â”‚  ChÃºng chá»‰ thá»±c hiá»‡n DOM manipulation Ä‘Æ¡n giáº£n.     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> **Káº¿t luáº­n**: Selective Hydration (React 18) giáº£i quyáº¿t triá»‡t Ä‘á»ƒ 3 bottleneck
> lá»›n nháº¥t cá»§a SSR truyá»n thá»‘ng: server blocking, client JS blocking, vÃ  hydration
> blocking. Báº±ng cÃ¡ch káº¿t há»£p Streaming SSR (`renderToPipeableStream`), Suspense
> trÃªn server, vÃ  Concurrent hydration (`hydrateRoot`), React 18 cho phÃ©p má»—i pháº§n
> cá»§a á»©ng dá»¥ng Ä‘Æ°á»£c render, stream, vÃ  hydrate Äá»˜C Láº¬P. User click Ä‘Ã¢u â†’ React
> Æ°u tiÃªn hydrate ÄÃ“ trÆ°á»›c â€” Táº¤T Cáº¢ Tá»° Äá»˜NG, khÃ´ng cáº§n developer viáº¿t thÃªm
> logic! ğŸš€
