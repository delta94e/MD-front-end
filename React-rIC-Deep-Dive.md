# React requestIdleCallback â€” Deep Dive!

> **Chá»§ Ä‘á»**: requestIdleCallback API â€” Browser Idle Time Execution
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: "Let's learn about React's requestIdleCallback"

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Browser Idle Time](#1)
2. [Â§2. CÃº PhÃ¡p + IdleDeadline Object](#2)
3. [Â§3. Thá»i Äiá»ƒm Thá»±c Thi â€” Idle Periods](#3)
4. [Â§4. 50ms Rule â€” Táº¡i Sao 50ms?](#4)
5. [Â§5. Táº§n Suáº¥t Thá»±c Thi â€” 20 Láº§n/GiÃ¢y?](#5)
6. [Â§6. Queue Task Processing â€” Xá»­ LÃ½ HÃ ng Äá»£i](#6)
7. [Â§7. Káº¿t Há»£p requestAnimationFrame](#7)
8. [Â§8. So SÃ¡nh: rIC vs KhÃ´ng rIC](#8)
9. [Â§9. Polyfill + Compatibility](#9)
10. [Â§10. SÆ¡ Äá»“ Tá»± Váº½](#10)
11. [Â§11. Tá»± Viáº¿t â€” IdleCallbackEngine](#11)
12. [Â§12. CÃ¢u Há»i Luyá»‡n Táº­p](#12)

---

## Â§1. Tá»•ng Quan â€” Browser Idle Time!

```
  requestIdleCallback (rIC):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  "idle" = Ráº¢NH, NHÃ€N Rá»–I!                                   â”‚
  â”‚                                                              â”‚
  â”‚  Äá»ŠNH NGHÄ¨A (MDN):                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ window.requestIdleCallback(callback)                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ ChÃ¨n 1 function sáº½ Ä‘Æ°á»£c gá»i khi browser Ráº¢NH!  â”‚    â”‚
  â”‚  â”‚ â†’ Cho phÃ©p cháº¡y code KHÃ”NG áº£nh hÆ°á»Ÿng:             â”‚    â”‚
  â”‚  â”‚   â†’ Animation!                                     â”‚    â”‚
  â”‚  â”‚   â†’ User input!                                    â”‚    â”‚
  â”‚  â”‚   â†’ Critical rendering!                            â”‚    â”‚
  â”‚  â”‚ â†’ PhÃ¹ há»£p cho: background + low-priority tasks!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Táº I SAO Cáº¦N?                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ FRAME LIFECYCLE (60fps = 16.67ms/frame):             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ [Input] â†’ [JS] â†’ [Style] â†’ [Layout] â†’ [Paint]     â”‚    â”‚
  â”‚  â”‚   â†‘                                                  â”‚    â”‚
  â”‚  â”‚   â””â”€â”€ Náº¿u JS cháº¡y quÃ¡ lÃ¢u â†’ block TOÃ€N Bá»˜!      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ GIáº¢I PHÃP:                                           â”‚    â”‚
  â”‚  â”‚ [Input][JS][Style][Layout][Paint][ IDLE TIME! ]     â”‚    â”‚
  â”‚  â”‚                                    â†‘                â”‚    â”‚
  â”‚  â”‚                            rIC cháº¡y ÄÃ‚Y!           â”‚    â”‚
  â”‚  â”‚                          Sau render, trÆ°á»›c frame má»›i!â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  REACT + rIC:                                                 â”‚
  â”‚  â†’ React tá»«ng dÃ¹ng rIC trong giai Ä‘oáº¡n Ä‘áº§u!                â”‚
  â”‚  â†’ Sau Ä‘Ã³ KHÃ”NG dÃ¹ng ná»¯a (compatibility!)                  â”‚
  â”‚  â†’ NhÆ°ng TRIáº¾T LÃ giá»‘ng nhau: cháº¡y khi browser ráº£nh!      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. CÃº PhÃ¡p + IdleDeadline Object!

```
  CÃš PHÃP:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SYNTAX:                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ var handle = window.requestIdleCallback(              â”‚    â”‚
  â”‚  â”‚   callback,                                          â”‚    â”‚
  â”‚  â”‚   { timeout: 1000 }  // optional!                   â”‚    â”‚
  â”‚  â”‚ );                                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Há»§y:                                             â”‚    â”‚
  â”‚  â”‚ window.cancelIdleCallback(handle);                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  THAM Sá»:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ handle:                                              â”‚    â”‚
  â”‚  â”‚ â†’ ID tráº£ vá» (dÃ¹ng cho cancelIdleCallback!)         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ callback(deadline):                                  â”‚    â”‚
  â”‚  â”‚ â†’ Function Ä‘Æ°á»£c gá»i khi browser ráº£nh!              â”‚    â”‚
  â”‚  â”‚ â†’ Nháº­n IdleDeadline object!                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ options.timeout:                                      â”‚    â”‚
  â”‚  â”‚ â†’ Náº¿u sau timeout ms váº«n chÆ°a gá»i callback       â”‚    â”‚
  â”‚  â”‚ â†’ Ã‰p callback vÃ o event loop! (didTimeout = true!) â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  IdleDeadline OBJECT:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ deadline = {                                         â”‚    â”‚
  â”‚  â”‚   didTimeout: false,                                 â”‚    â”‚
  â”‚  â”‚   // â†’ true náº¿u Ä‘Ã£ timeout mÃ  chÆ°a Ä‘Æ°á»£c gá»i!     â”‚    â”‚
  â”‚  â”‚   // â†’ false náº¿u Ä‘Æ°á»£c gá»i trong idle period!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   timeRemaining(): number                            â”‚    â”‚
  â”‚  â”‚   // â†’ Æ¯á»›c tÃ­nh cÃ²n bao nhiÃªu ms trong idle!       â”‚    â”‚
  â”‚  â”‚   // â†’ VÃ Dá»¤: 35.6ms (cÃ³ thá»ƒ > 16.67ms!)        â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  VÃ Dá»¤:                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ requestIdleCallback((deadline) => {                  â”‚    â”‚
  â”‚  â”‚   console.log(deadline.didTimeout);                  â”‚    â”‚
  â”‚  â”‚   // false â†’ chÆ°a timeout!                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   console.log(deadline.timeRemaining());             â”‚    â”‚
  â”‚  â”‚   // 35.6 â†’ cÃ²n 35.6ms!                            â”‚    â”‚
  â”‚  â”‚   // Táº¡i sao > 16.67ms? â†’ VÃ¬ idle period!         â”‚    â”‚
  â”‚  â”‚ }, { timeout: 1000 });                               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Thá»i Äiá»ƒm Thá»±c Thi â€” Idle Periods!

```
  KHI NÃ€O rIC THá»°C THI?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  THEO W3C SPEC:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Sau khi hoÃ n thÃ nh:                                  â”‚    â”‚
  â”‚  â”‚ â‘  Input processing (xá»­ lÃ½ input!)                  â”‚    â”‚
  â”‚  â”‚ â‘¡ Rendering (váº½!)                                   â”‚    â”‚
  â”‚  â”‚ â‘¢ Compositing (ghÃ©p layer!)                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Thread vÃ o IDLE PERIOD!                           â”‚    â”‚
  â”‚  â”‚ â†’ Cho Ä‘áº¿n khi:                                     â”‚    â”‚
  â”‚  â”‚   â†’ Frame tiáº¿p theo báº¯t Ä‘áº§u!                      â”‚    â”‚
  â”‚  â”‚   â†’ Task má»›i trong queue!                           â”‚    â”‚
  â”‚  â”‚   â†’ User input má»›i!                                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TRÆ¯á»œNG Há»¢P 1: CÃ“ Screen Refresh (60fps)                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  Frame #1              â”‚  Frame #2                   â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
  â”‚  â”‚  â”‚Run â”‚Updateâ”‚ Idle   â”‚â”‚â”‚Run â”‚Updateâ”‚ Idle   â”‚      â”‚    â”‚
  â”‚  â”‚  â”‚Taskâ”‚Renderâ”‚ Period â”‚â”‚â”‚Taskâ”‚Renderâ”‚ Period â”‚      â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
  â”‚  â”‚        â†â”€â”€ 16.67ms â”€â”€â†’                              â”‚    â”‚
  â”‚  â”‚                 â†‘                                    â”‚    â”‚
  â”‚  â”‚          rIC cháº¡y ÄÃ‚Y!                              â”‚    â”‚
  â”‚  â”‚    (thÆ°á»ng ráº¥t ngáº¯n, < 16ms!)                      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TRÆ¯á»œNG Há»¢P 2: KHÃ”NG CÃ“ Screen Refresh                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â† 50ms deadline â†’â”‚â† 50ms deadline â†’â”‚              â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚    â”‚
  â”‚  â”‚  â”‚  Idle Callback   â”‚â”‚  Idle Callback   â”‚             â”‚    â”‚
  â”‚  â”‚  â”‚  Idle Callback   â”‚â”‚  Idle Callback   â”‚             â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
  â”‚  â”‚         â†‘                                            â”‚    â”‚
  â”‚  â”‚  Tá»I ÄA 50ms/period! (rá»“i táº¡o period má»›i!)       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Káº¾T LUáº¬N:                                                    â”‚
  â”‚  â†’ CÃ³ screen refresh: idle = thá»i gian CÃ’N Láº I trong frame!â”‚
  â”‚  â†’ KhÃ´ng refresh: idle = liÃªn tá»¥c 50ms periods!             â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. 50ms Rule â€” Táº¡i Sao 50ms?

```
  50ms RULE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Táº I SAO GIá»šI Háº N 50ms?                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ NGHIÃŠN Cá»¨U UI/UX:                                    â”‚    â”‚
  â”‚  â”‚ â†’ User input pháº£i Ä‘Æ°á»£c pháº£n há»“i trong 100ms!       â”‚    â”‚
  â”‚  â”‚ â†’ < 100ms = Cáº¢M GIÃC Tá»¨C THÃŒ!                    â”‚    â”‚
  â”‚  â”‚ â†’ > 100ms = Cáº¢M GIÃC TRá»„!                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ RAIL Model (Google):                                  â”‚    â”‚
  â”‚  â”‚ R = Response: 100ms!                                 â”‚    â”‚
  â”‚  â”‚ A = Animation: 16ms/frame!                           â”‚    â”‚
  â”‚  â”‚ I = Idle: 50ms chunks!                               â”‚    â”‚
  â”‚  â”‚ L = Load: 1000ms!                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TÃNH TOÃN:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ 100ms budget cho response!                           â”‚    â”‚
  â”‚  â”‚ â†’ 50ms cho idle callback!                           â”‚    â”‚
  â”‚  â”‚ â†’ 50ms CÃ’N Láº I cho browser pháº£n há»“i user input!  â”‚    â”‚
  â”‚  â”‚ â†’ 50 + 50 = 100ms â†’ user khÃ´ng cáº£m tháº¥y trá»…!     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚    â”‚
  â”‚  â”‚ â”‚ [idle callback 50ms] [input response 50ms]â”‚        â”‚    â”‚
  â”‚  â”‚ â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 100ms budget â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚          â”‚    â”‚
  â”‚  â”‚ â”‚              USER: "Tá»©c thÃ¬!" âœ…       â”‚          â”‚    â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  timeRemaining() > 16.67ms?                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ CÃ“ THá»‚! Khi khÃ´ng cÃ³ screen refresh!            â”‚    â”‚
  â”‚  â”‚ â†’ Idle period = 50ms â†’ timeRemaining() = ~49ms!   â”‚    â”‚
  â”‚  â”‚ â†’ Frame chá»‰ 16.67ms á»Ÿ 60fps, nhÆ°ng idle cÃ³ thá»ƒ   â”‚    â”‚
  â”‚  â”‚   DÃ€I HÆ N khi browser khÃ´ng cáº§n render!            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Táº§n Suáº¥t Thá»±c Thi â€” 20 Láº§n/GiÃ¢y?

```
  Táº¦N SUáº¤T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  NHáº¬N XÃ‰T Tá»ª Cá»˜NG Äá»’NG:                                     â”‚
  â”‚  "requestIdleCallback chá»‰ Ä‘Æ°á»£c gá»i 20 láº§n/giÃ¢y"            â”‚
  â”‚                                                              â”‚
  â”‚  PHÃ‚N TÃCH:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Khi KHÃ”NG cÃ³ screen refresh:                      â”‚    â”‚
  â”‚  â”‚   â†’ idle period = 50ms liÃªn tá»¥c!                   â”‚    â”‚
  â”‚  â”‚   â†’ 1000ms / 50ms = 20 láº§n/giÃ¢y!                  â”‚    â”‚
  â”‚  â”‚   â†’ ÄÃºng! 20 calls/giÃ¢y!                           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Khi CÃ“ screen refresh (60fps):                   â”‚    â”‚
  â”‚  â”‚   â†’ idle = vÃ i ms cuá»‘i frame!                      â”‚    â”‚
  â”‚  â”‚   â†’ CÃ³ thá»ƒ 60 calls/giÃ¢y nhÆ°ng NGáº®N!             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SO SÃNH Vá»šI rAF:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ requestAnimationFrame (rAF):                          â”‚    â”‚
  â”‚  â”‚ â†’ 60 calls/giÃ¢y (á»Ÿ 60Hz!)                          â”‚    â”‚
  â”‚  â”‚ â†’ Má»—i call = 1 frame!                              â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng cho: ANIMATION!                             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ requestIdleCallback (rIC):                            â”‚    â”‚
  â”‚  â”‚ â†’ ~20 calls/giÃ¢y (khi idle!)                       â”‚    â”‚
  â”‚  â”‚ â†’ Má»—i call cÃ³ THá»‚ xá»­ lÃ½ NHIá»€U tasks!             â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng cho: LOW-PRIORITY tasks!                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â˜… rIC gá»i Ã­t hÆ¡n, nhÆ°ng Má»–I Láº¦N gá»i cÃ³ thá»ƒ     â”‚    â”‚
  â”‚  â”‚   xá»­ lÃ½ NHIá»€U tasks trong 1 idle period!           â”‚    â”‚
  â”‚  â”‚   â†’ Tá»•ng throughput KHÃ”NG kÃ©m!                     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Queue Task Processing â€” Xá»­ LÃ½ HÃ ng Äá»£i!

```
  QUEUE PROCESSING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  MáºªU CÆ  Báº¢N (MDN):                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ let taskList = [                                     â”‚    â”‚
  â”‚  â”‚   () => console.log('task1'),                        â”‚    â”‚
  â”‚  â”‚   () => console.log('task2'),                        â”‚    â”‚
  â”‚  â”‚   () => console.log('task3')                         â”‚    â”‚
  â”‚  â”‚ ];                                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ function runTaskQueue(deadline) {                    â”‚    â”‚
  â”‚  â”‚   // CÃ²n thá»i gian HOáº¶C Ä‘Ã£ timeout â†’ cháº¡y task!  â”‚    â”‚
  â”‚  â”‚   while (                                            â”‚    â”‚
  â”‚  â”‚     (deadline.timeRemaining() > 0 ||                 â”‚    â”‚
  â”‚  â”‚      deadline.didTimeout) &&                         â”‚    â”‚
  â”‚  â”‚     taskList.length                                  â”‚    â”‚
  â”‚  â”‚   ) {                                                â”‚    â”‚
  â”‚  â”‚     let task = taskList.shift();                     â”‚    â”‚
  â”‚  â”‚     task();                                          â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   // CÃ²n task? â†’ Ä‘á»£i idle tiáº¿p!                   â”‚    â”‚
  â”‚  â”‚   if (taskList.length) {                             â”‚    â”‚
  â”‚  â”‚     requestIdleCallback(runTaskQueue,                â”‚    â”‚
  â”‚  â”‚       { timeout: 1000 });                            â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ requestIdleCallback(runTaskQueue, { timeout: 1000 });â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLOW:                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ rIC(runTaskQueue)                                    â”‚    â”‚
  â”‚  â”‚   â”‚                                                  â”‚    â”‚
  â”‚  â”‚   â–¼ (browser idle!)                                  â”‚    â”‚
  â”‚  â”‚ runTaskQueue(deadline):                               â”‚    â”‚
  â”‚  â”‚   â†’ timeRemaining() = 49.9ms                        â”‚    â”‚
  â”‚  â”‚   â†’ task1() âœ…                                      â”‚    â”‚
  â”‚  â”‚   â†’ timeRemaining() = 48.1ms                        â”‚    â”‚
  â”‚  â”‚   â†’ task2() âœ…                                      â”‚    â”‚
  â”‚  â”‚   â†’ timeRemaining() = 11.4ms                        â”‚    â”‚
  â”‚  â”‚   â†’ task3() âœ…                                      â”‚    â”‚
  â”‚  â”‚   â†’ taskList empty â†’ DONE!                          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â˜… Task NHANH â†’ ALL 3 tasks in 1 idle period!       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHI TASK CHáº¬M (sleep 50ms):                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Idle period 1: deadline=49.9ms                       â”‚    â”‚
  â”‚  â”‚   â†’ task1() (sleep 50ms) â†’ timeRemaining < 0!      â”‚    â”‚
  â”‚  â”‚   â†’ BREAK! Gá»i rIC láº¡i!                            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Idle period 2: deadline=48.1ms                       â”‚    â”‚
  â”‚  â”‚   â†’ task2() (sleep 50ms) â†’ BREAK!                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Idle period 3: deadline=11.4ms                       â”‚    â”‚
  â”‚  â”‚   â†’ task3() (sleep 50ms) â†’ DONE!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â˜… Task CHáº¬M â†’ 1 task per idle period!              â”‚    â”‚
  â”‚  â”‚ â˜… 3 tasks = 3 idle periods = 3 láº§n console deadlineâ”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Káº¿t Há»£p requestAnimationFrame!

```
  rIC + rAF:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  QUY Táº®C QUAN TRá»ŒNG:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âŒ KHÃ”NG Ä‘Æ°á»£c thao tÃ¡c DOM trong rIC!               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Táº I SAO?                                             â”‚    â”‚
  â”‚  â”‚ â†’ rIC cháº¡y SAU khi frame Ä‘Ã£ render xong!           â”‚    â”‚
  â”‚  â”‚ â†’ Náº¿u sá»­a DOM â†’ Ã©p browser tÃ­nh LAYOUT Láº I!      â”‚    â”‚
  â”‚  â”‚ â†’ = Forced reflow! â†’ GIáº¬T!                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… NÃŠN dÃ¹ng rAF cho DOM updates!                   â”‚    â”‚
  â”‚  â”‚ â†’ rAF cháº¡y TRÆ¯á»šC render â†’ DOM changes Ä‘Æ°á»£c       â”‚    â”‚
  â”‚  â”‚   batched vÃ o frame tiáº¿p theo!                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  PATTERN:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // TÃ¡ch 2 concerns:                                  â”‚    â”‚
  â”‚  â”‚ // rIC â†’ TÃNH TOÃN (khÃ´ng DOM!)                    â”‚    â”‚
  â”‚  â”‚ // rAF â†’ Cáº¬P NHáº¬T DOM!                            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ let logFragment = null;                              â”‚    â”‚
  â”‚  â”‚ let statusRefreshScheduled = false;                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â‘  rIC: tÃ­nh toÃ¡n, ghi log vÃ o fragment!         â”‚    â”‚
  â”‚  â”‚ function runTaskQueue(deadline) {                    â”‚    â”‚
  â”‚  â”‚   while (deadline.timeRemaining() > 0 &&            â”‚    â”‚
  â”‚  â”‚          taskList.length) {                          â”‚    â”‚
  â”‚  â”‚     let task = taskList.shift();                     â”‚    â”‚
  â”‚  â”‚     task(); // Ghi vÃ o logFragment (KHÃ”NG DOM!)     â”‚    â”‚
  â”‚  â”‚     scheduleStatusRefresh();                         â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â‘¡ Schedule rAF (chá»‰ 1 láº§n!)                    â”‚    â”‚
  â”‚  â”‚ function scheduleStatusRefresh() {                   â”‚    â”‚
  â”‚  â”‚   if (!statusRefreshScheduled) {                     â”‚    â”‚
  â”‚  â”‚     requestAnimationFrame(updateDisplay);            â”‚    â”‚
  â”‚  â”‚     statusRefreshScheduled = true;                   â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // â‘¢ rAF: cáº­p nháº­t DOM tháº­t!                      â”‚    â”‚
  â”‚  â”‚ function updateDisplay() {                           â”‚    â”‚
  â”‚  â”‚   if (logFragment) {                                 â”‚    â”‚
  â”‚  â”‚     logElem.appendChild(logFragment);                â”‚    â”‚
  â”‚  â”‚     logFragment = null;                              â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚   statusRefreshScheduled = false;                    â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLOW TIMELINE:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Frame N:                                             â”‚    â”‚
  â”‚  â”‚ [Input][JS][Style][Layout][Paint][ rIC: tÃ­nh toÃ¡n! ]â”‚    â”‚
  â”‚  â”‚                                     â†‘               â”‚    â”‚
  â”‚  â”‚                              task() ghi fragment     â”‚    â”‚
  â”‚  â”‚                              scheduleStatusRefresh() â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Frame N+1:                                           â”‚    â”‚
  â”‚  â”‚ [rAF: updateDisplay!][Style][Layout][Paint][ IDLE ] â”‚    â”‚
  â”‚  â”‚   â†‘                                                 â”‚    â”‚
  â”‚  â”‚   appendChild(fragment) â†’ DOM cáº­p nháº­t!            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. So SÃ¡nh: rIC vs KhÃ´ng rIC!

```
  SO SÃNH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  KHÃ”NG CÃ“ rIC (synchronous DOM update):                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Click â†’ 50000 tasks â†’ DOM update trá»±c tiáº¿p!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ [â”€â”€â”€â”€â”€â”€ 2000ms JS + DOM â”€â”€â”€â”€â”€â”€][render]             â”‚    â”‚
  â”‚  â”‚ â† BLOCK! Animation Äá»¨NG! âŒ â†’                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CSS Loading animation: â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€             â”‚    â”‚
  â”‚  â”‚                        PAUSE! GIáº¬T! ğŸ”´               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÃ“ rIC:                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Click â†’ 50000 tasks â†’ rIC scheduled!               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ [task batch][render][task batch][render][task batch] â”‚    â”‚
  â”‚  â”‚ â† idle â†’ â† frame â†’ â† idle â†’ â† frame â†’ ...       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CSS Loading animation: â—â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€ â”€â”€â”€â”€ â”€â”€â”€â”€    â”‚    â”‚
  â”‚  â”‚                        MÆ¯á»¢T! KHÃ”NG GIáº¬T! âœ… ğŸŸ¢     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Táº I SAO rIC MÆ¯á»¢T?                                            â”‚
  â”‚  â†’ rIC chia work thÃ nh NHIá»€U idle periods!                  â”‚
  â”‚  â†’ Má»—i period: cháº¡y tasks khi cÃ²n timeRemaining!           â”‚
  â”‚  â†’ Háº¿t time â†’ NHÆ¯á»œNG cho browser render + animation!       â”‚
  â”‚  â†’ Browser render XEN Káº¼ â†’ animation KHÃ”NG bá»‹ block!       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Polyfill + Compatibility!

```
  COMPATIBILITY + POLYFILL:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  COMPATIBILITY:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Chrome: âœ… (v47+)                                    â”‚    â”‚
  â”‚  â”‚ Firefox: âœ… (v55+)                                   â”‚    â”‚
  â”‚  â”‚ Edge: âœ… (v79+)                                      â”‚    â”‚
  â”‚  â”‚ Safari: âŒ KHÃ”NG Há»– TRá»¢!                           â”‚    â”‚
  â”‚  â”‚ IE: âŒ KHÃ”NG Há»– TRá»¢!                               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Safari = LÃ DO React khÃ´ng dÃ¹ng rIC!            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  MDN POLYFILL (setTimeout fallback):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ window.requestIdleCallback =                         â”‚    â”‚
  â”‚  â”‚   window.requestIdleCallback ||                      â”‚    â”‚
  â”‚  â”‚   function(handler) {                                â”‚    â”‚
  â”‚  â”‚     let startTime = Date.now();                      â”‚    â”‚
  â”‚  â”‚     return setTimeout(function() {                   â”‚    â”‚
  â”‚  â”‚       handler({                                      â”‚    â”‚
  â”‚  â”‚         didTimeout: false,                           â”‚    â”‚
  â”‚  â”‚         timeRemaining: function() {                  â”‚    â”‚
  â”‚  â”‚           return Math.max(0,                         â”‚    â”‚
  â”‚  â”‚             50.0 - (Date.now() - startTime));        â”‚    â”‚
  â”‚  â”‚         }                                            â”‚    â”‚
  â”‚  â”‚       });                                            â”‚    â”‚
  â”‚  â”‚     }, 1);                                           â”‚    â”‚
  â”‚  â”‚   };                                                 â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Háº N CHáº¾ Cá»¦A POLYFILL:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  KHÃ”NG pháº£i polyfill tháº­t!                        â”‚    â”‚
  â”‚  â”‚   â†’ setTimeout KHÃ”NG biáº¿t browser cÃ³ ráº£nh khÃ´ng!   â”‚    â”‚
  â”‚  â”‚   â†’ Chá»‰ GIá»šI Háº N má»—i pass <= 50ms!               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ setTimeout minimum delay = 4ms!                   â”‚    â”‚
  â”‚  â”‚   â†’ Overhead má»—i láº§n gá»i!                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¢ timeRemaining() = 50 - elapsed!                   â”‚    â”‚
  â”‚  â”‚   â†’ Giáº£ láº­p 50ms idle, KHÃ”NG pháº£i real idle!       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. SÆ¡ Äá»“ Tá»± Váº½!

### SÆ¡ Äá»“ 1: Frame Lifecycle + Idle Period

```
  FRAME LIFECYCLE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â† â”€ â”€ â”€ â”€ â”€ â”€ 16.67ms (60fps) â”€ â”€ â”€ â”€ â”€ â”€ â†’            â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚Input â”‚  JS  â”‚Style â”‚Layoutâ”‚Paint â”‚ IDLE     â”‚          â”‚
  â”‚  â”‚Event â”‚ Exec â”‚Calc  â”‚      â”‚      â”‚ PERIOD   â”‚          â”‚
  â”‚  â”‚      â”‚      â”‚      â”‚      â”‚      â”‚          â”‚          â”‚
  â”‚  â”‚ 1ms  â”‚ 3ms  â”‚ 2ms  â”‚ 2ms  â”‚ 3ms  â”‚ 5.67ms   â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                        â†‘                    â”‚
  â”‚                                   rIC runs HERE!            â”‚
  â”‚                                   timeRemaining()           â”‚
  â”‚                                   = 5.67ms!                 â”‚
  â”‚                                                              â”‚
  â”‚  Náº¾U JS CHáº Y LÃ‚U:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”          â”‚
  â”‚  â”‚Input â”‚  JS (LONG!)          â”‚Style â”‚Layoutâ”‚Paâ”‚          â”‚
  â”‚  â”‚      â”‚  12ms                â”‚      â”‚      â”‚  â”‚          â”‚
  â”‚  â”‚ 1ms  â”‚                      â”‚ 1ms  â”‚ 1ms  â”‚1mâ”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜          â”‚
  â”‚                                                  â†‘          â”‚
  â”‚                                          0ms idle!          â”‚
  â”‚                                      rIC KHÃ”NG Ä‘Æ°á»£c gá»i!  â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 2: rIC + rAF Cooperation

```
  rIC + rAF FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  USER CLICK â†’ enqueueTask()                                  â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  taskList = [task1, task2, task3, ...]                       â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  requestIdleCallback(runTaskQueue)                           â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼ (browser idle!)                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  â”‚  â”‚ runTaskQueue(deadline):               â”‚                   â”‚
  â”‚  â”‚   while (timeRemaining > 0) {         â”‚                   â”‚
  â”‚  â”‚     task() â†’ ghi vÃ o DocumentFragment â”‚                   â”‚
  â”‚  â”‚     scheduleStatusRefresh()            â”‚                   â”‚
  â”‚  â”‚   }                                    â”‚                   â”‚
  â”‚  â”‚   if (cÃ²n tasks) rIC(runTaskQueue)     â”‚                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
  â”‚                   â”‚                                          â”‚
  â”‚                   â–¼                                          â”‚
  â”‚  scheduleStatusRefresh():                                    â”‚
  â”‚  â†’ requestAnimationFrame(updateDisplay)                     â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼ (next frame!)                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  â”‚  â”‚ updateDisplay():                      â”‚                   â”‚
  â”‚  â”‚   logElem.appendChild(fragment)       â”‚                   â”‚
  â”‚  â”‚   â†’ DOM Cáº¬P NHáº¬T! ğŸ¨                â”‚                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
  â”‚                                                              â”‚
  â”‚  KEY: rIC = COMPUTE!  rAF = RENDER!                         â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 3: Sync vs rIC Animation Impact

```
  ANIMATION IMPACT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SYNC (50000 tasks trá»±c tiáº¿p):                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ [â—] Loading animation                                â”‚    â”‚
  â”‚  â”‚  â†“                                                   â”‚    â”‚
  â”‚  â”‚  â—â”€â”€â”€â”€â”€â”€â”€ CLICK â†’ [JS 2000ms BLOCK!] â†’ â”€â”€â”€â”€â”€â”€â”€â—   â”‚    â”‚
  â”‚  â”‚           â†‘                              â†‘         â”‚    â”‚
  â”‚  â”‚     Animation FREEZES!          Animation RESUMES! â”‚    â”‚
  â”‚  â”‚     User tháº¥y: Äá»¨NG HÃŒNH! ğŸ”´                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  rIC (50000 tasks chia nhá»):                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ [â—] Loading animation                                â”‚    â”‚
  â”‚  â”‚  â†“                                                   â”‚    â”‚
  â”‚  â”‚  â—â”€â”€ CLICK â†’                                        â”‚    â”‚
  â”‚  â”‚  [idle:tasks][render:â—][idle:tasks][render:â—]...    â”‚    â”‚
  â”‚  â”‚              â†‘                    â†‘                 â”‚    â”‚
  â”‚  â”‚         Animation frame!     Animation frame!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  User tháº¥y: MÆ¯á»¢T MÃ€! ğŸŸ¢                           â”‚    â”‚
  â”‚  â”‚  VÃ¬ browser render XEN Káº¼ giá»¯a cÃ¡c task batches!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. Tá»± Viáº¿t â€” IdleCallbackEngine!

```javascript
/**
 * IdleCallbackEngine â€” MÃ´ phá»ng requestIdleCallback!
 * Tá»± viáº¿t báº±ng tay, KHÃ”NG dÃ¹ng thÆ° viá»‡n!
 */
var IdleCallbackEngine = (function () {

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // FAKE TIME
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var fakeTime = 0;
  var log = [];
  function now() { return fakeTime; }
  function advance(ms) { fakeTime += ms; }
  function reset() { fakeTime = 0; log = []; }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. IdleDeadline OBJECT
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function createDeadline(idleEnd, didTimeout) {
    return {
      didTimeout: didTimeout || false,
      timeRemaining: function () {
        var remaining = idleEnd - now();
        return Math.max(0, remaining);
      }
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. requestIdleCallback SIMULATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateRIC(callback, idleDuration) {
    idleDuration = idleDuration || 50; // 50ms max!
    var idleEnd = now() + idleDuration;
    var deadline = createDeadline(idleEnd, false);
    callback(deadline);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. QUEUE TASK PROCESSOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function processQueue(taskList, idleDuration) {
    idleDuration = idleDuration || 50;
    var idleCount = 0;

    while (taskList.length > 0) {
      idleCount++;
      var idleStart = now();
      var idleEnd = now() + idleDuration;
      log.push('--- Idle period ' + idleCount +
        ' (t=' + now() + 'ms, budget=' + idleDuration + 'ms) ---');

      while (taskList.length > 0) {
        var remaining = idleEnd - now();
        if (remaining <= 0) {
          log.push('  timeRemaining=0 â†’ BREAK! Schedule next idle!');
          break;
        }

        var task = taskList.shift();
        log.push('  timeRemaining=' + remaining.toFixed(1) +
          'ms â†’ Execute: ' + task.name);
        advance(task.duration);
      }
    }

    log.push('ALL TASKS DONE in ' + idleCount + ' idle periods!');
    return { idlePeriods: idleCount, totalTime: now() };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. POLYFILL SIMULATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulatePolyfill(callback) {
    // setTimeout(fn, 1) â†’ 4ms real delay!
    advance(4); // setTimeout overhead!
    var startTime = now();
    var deadline = {
      didTimeout: false,
      timeRemaining: function () {
        return Math.max(0, 50.0 - (now() - startTime));
      }
    };
    callback(deadline);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. rIC + rAF PATTERN
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateRICWithRAF(taskList, idleDuration) {
    idleDuration = idleDuration || 50;
    var fragment = []; // DocumentFragment simulation!
    var domUpdates = 0;
    var idleCount = 0;

    while (taskList.length > 0) {
      idleCount++;
      var idleEnd = now() + idleDuration;
      log.push('--- rIC period ' + idleCount + ' (t=' + now() + 'ms) ---');

      // rIC: compute only, no DOM!
      while (taskList.length > 0 && (idleEnd - now()) > 0) {
        var task = taskList.shift();
        var result = task.name + ' computed';
        fragment.push(result); // Write to fragment, NOT DOM!
        log.push('  rIC: ' + result + ' (fragment, no DOM!)');
        advance(task.duration);
      }

      // rAF: update DOM from fragment!
      if (fragment.length > 0) {
        domUpdates++;
        log.push('  rAF: appendChild ' + fragment.length +
          ' items â†’ DOM updated! ğŸ¨');
        fragment = [];
        advance(2); // rAF + render time
      }
    }

    log.push('Done! ' + idleCount + ' rIC periods, ' +
      domUpdates + ' rAF updates!');
    return { idlePeriods: idleCount, domUpdates: domUpdates };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  IDLE CALLBACK ENGINE â€” DEMO                â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    // 1. Fast tasks (all in 1 idle period!)
    console.log('\n--- 1. FAST TASKS (all in 1 idle!) ---');
    reset();
    var fastTasks = [
      { name: 'task1', duration: 1 },
      { name: 'task2', duration: 1 },
      { name: 'task3', duration: 1 }
    ];
    var r1 = processQueue(fastTasks.slice(), 50);
    log.forEach(function (l) { console.log(l); });
    console.log('Result: ' + r1.idlePeriods + ' idle periods!');

    // 2. Slow tasks (each in own idle period!)
    console.log('\n--- 2. SLOW TASKS (1 per idle!) ---');
    reset();
    var slowTasks = [
      { name: 'heavy1', duration: 50 },
      { name: 'heavy2', duration: 50 },
      { name: 'heavy3', duration: 50 }
    ];
    var r2 = processQueue(slowTasks.slice(), 50);
    log.forEach(function (l) { console.log(l); });
    console.log('Result: ' + r2.idlePeriods + ' idle periods!');

    // 3. Polyfill
    console.log('\n--- 3. POLYFILL ---');
    reset();
    simulatePolyfill(function (deadline) {
      console.log('didTimeout:', deadline.didTimeout);
      console.log('timeRemaining:', deadline.timeRemaining(), 'ms');
      advance(20);
      console.log('After 20ms work:', deadline.timeRemaining(), 'ms');
    });

    // 4. rIC + rAF pattern
    console.log('\n--- 4. rIC + rAF ---');
    reset();
    log = [];
    var mixedTasks = [
      { name: 'compute1', duration: 10 },
      { name: 'compute2', duration: 10 },
      { name: 'compute3', duration: 10 },
      { name: 'compute4', duration: 10 },
      { name: 'compute5', duration: 10 },
      { name: 'compute6', duration: 10 }
    ];
    var r4 = simulateRICWithRAF(mixedTasks.slice(), 25);
    log.forEach(function (l) { console.log(l); });
    console.log('Result: ' + r4.idlePeriods + ' rIC, ' +
      r4.domUpdates + ' rAF updates!');

    console.log('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  âœ… Demo Complete!                           â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  }

  return {
    createDeadline: createDeadline,
    simulateRIC: simulateRIC,
    processQueue: processQueue,
    simulatePolyfill: simulatePolyfill,
    simulateRICWithRAF: simulateRICWithRAF,
    demo: demo, reset: reset
  };
})();

// Cháº¡y: IdleCallbackEngine.demo();
```

---

## Â§12. CÃ¢u Há»i Luyá»‡n Táº­p!

### â“ CÃ¢u 1: requestIdleCallback lÃ  gÃ¬?

**Tráº£ lá»i:**

- Browser API cho phÃ©p cháº¡y code khi browser **Ráº¢NH**!
- Callback nháº­n `IdleDeadline` object:
  - `didTimeout`: Ä‘Ã£ timeout chÆ°a?
  - `timeRemaining()`: cÃ²n bao nhiÃªu ms idle?
- PhÃ¹ há»£p cho **background + low-priority tasks** (analytics, logging!)
- **KHÃ”NG** dÃ¹ng cho critical tasks hoáº·c animation!

### â“ CÃ¢u 2: Idle period xáº£y ra khi nÃ o?

**Tráº£ lá»i:**

**2 trÆ°á»ng há»£p:**

1. **CÃ³ screen refresh (60fps)**:
   - Sau render xong frame â†’ cÃ²n DÆ¯ thá»i gian â†’ idle!
   - ThÆ°á»ng ráº¥t ngáº¯n (vÃ i ms!)
   
2. **KhÃ´ng cÃ³ screen refresh**:
   - Browser khÃ´ng cáº§n render â†’ idle period liÃªn tá»¥c **50ms**!
   - Háº¿t 50ms â†’ táº¡o period má»›i 50ms â†’ liÃªn tá»¥c!
   - â†’ timeRemaining() cÃ³ thá»ƒ > 16.67ms!

### â“ CÃ¢u 3: Táº¡i sao giá»›i háº¡n 50ms?

**Tráº£ lá»i:**

**RAIL Model** (Google):
- User input pháº£i pháº£n há»“i trong **100ms** Ä‘á»ƒ cáº£m giÃ¡c tá»©c thÃ¬!
- 50ms idle + 50ms response = **100ms budget** = user khÃ´ng tháº¥y trá»…!
- Náº¿u idle > 50ms â†’ user input cÃ³ thá»ƒ bá»‹ delay > 100ms â†’ user Cáº¢M THáº¤Y TRá»„!

### â“ CÃ¢u 4: Táº¡i sao KHÃ”NG thao tÃ¡c DOM trong rIC?

**Tráº£ lá»i:**

- rIC cháº¡y **SAU** frame Ä‘Ã£ render xong!
- Sá»­a DOM trong rIC â†’ Ã©p browser tÃ­nh **Layout Láº I** (forced reflow!)
- â†’ Extra work KHÃ”NG Ä‘Æ°á»£c schedule â†’ **GIáº¬T!**
- **Giáº£i phÃ¡p**: dÃ¹ng `requestAnimationFrame` cho DOM updates!
  - rIC: **compute** (ghi vÃ o DocumentFragment!)
  - rAF: **render** (appendChild fragment vÃ o DOM!)

### â“ CÃ¢u 5: rIC gá»i 20 láº§n/giÃ¢y, táº¡i sao váº«n Ä‘á»§?

**Tráº£ lá»i:**

| | requestAnimationFrame | requestIdleCallback |
|---|---|---|
| Táº§n suáº¥t | 60/giÃ¢y | ~20/giÃ¢y |
| Má»—i call | 1 style change | **NHIá»€U tasks**! |
| Má»¥c Ä‘Ã­ch | Animation | Background work |

- rIC gá»i ÃT hÆ¡n nhÆ°ng **má»—i láº§n** = 50ms idle â†’ cháº¡y NHIá»€U tasks!
- Tá»•ng throughput KHÃ”NG kÃ©m rAF!
- rAF = **animation**, rIC = **computation**!

### â“ CÃ¢u 6: didTimeout = true nghÄ©a lÃ  gÃ¬?

**Tráº£ lá»i:**

```javascript
requestIdleCallback(callback, { timeout: 1000 });
```

- Náº¿u **1000ms** trÃ´i qua mÃ  browser CHÆ¯A idle â†’ callback bá»‹ Ã‰P vÃ o event loop!
- `didTimeout = true` â†’ callback Ä‘ang cháº¡y vÃ¬ **TIMEOUT**, khÃ´ng pháº£i vÃ¬ idle!
- `timeRemaining() = 0` â†’ khÃ´ng cÃ³ idle time!
- â†’ NÃªn kiá»ƒm tra: `deadline.timeRemaining() > 0 || deadline.didTimeout`!

### â“ CÃ¢u 7: MDN polyfill cÃ³ váº¥n Ä‘á» gÃ¬?

**Tráº£ lá»i:**

1. **KhÃ´ng pháº£i polyfill tháº­t!** setTimeout KHÃ”NG biáº¿t browser ráº£nh hay khÃ´ng!
2. **4ms overhead!** setTimeout(fn, 1) thá»±c táº¿ = setTimeout(fn, 4)!
3. **timeRemaining() giáº£!** = 50 - elapsed â†’ khÃ´ng pháº£i real idle time!
4. **KhÃ´ng cháº¡y khi ráº£nh!** Chá»‰ delay, khÃ´ng Ä‘á»£i idle!
5. Chá»‰ **giá»›i háº¡n** má»—i pass <= 50ms, khÃ´ng simulate idle!

---

> ğŸ¯ **Tá»•ng káº¿t requestIdleCallback:**
> - **rIC**: cháº¡y code khi browser **Ráº¢NH** (sau render, trÆ°á»›c frame má»›i!)
> - **IdleDeadline**: didTimeout + timeRemaining() â†’ biáº¿t cÃ²n bao nhiÃªu idle!
> - **50ms rule**: RAIL model, 100ms response budget = 50 idle + 50 response!
> - **2 idle types**: cÃ³ screen refresh (ngáº¯n) vs khÃ´ng refresh (50ms liÃªn tá»¥c!)
> - **~20 calls/giÃ¢y** nhÆ°ng má»—i call xá»­ lÃ½ NHIá»€U tasks!
> - **KHÃ”NG DOM trong rIC!** DÃ¹ng rAF cho DOM! (rIC=compute, rAF=render!)
> - **Polyfill**: setTimeout, KHÃ”NG tháº­t, 4ms overhead!
> - **React**: tá»«ng dÃ¹ng rIC, nay dÃ¹ng MessageChannel â†’ Time Slicing!
> - **IdleCallbackEngine** tá»± viáº¿t: deadline, queue, polyfill, rIC+rAF pattern!
> - **7 cÃ¢u há»i** luyá»‡n táº­p vá»›i Ä‘Ã¡p Ã¡n chi tiáº¿t!
