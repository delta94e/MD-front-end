# React Fiber â€” Deep Dive: Hiá»ƒu HoÃ n ToÃ n Tá»« Sá»‘ 0

> **TÃ i liá»‡u há»c táº­p chuyÃªn sÃ¢u â€” HoÃ n toÃ n báº±ng Tiáº¿ng Viá»‡t**
> Tá»± viáº¿t tay má»i thá»©, khÃ´ng phá»¥ thuá»™c thÆ° viá»‡n â€” Giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t kÃ¨m sÆ¡ Ä‘á»“

---

## Má»¥c Lá»¥c

```
Â§1.  Táº¡i sao cáº§n Fiber? â€” Váº¥n Ä‘á» cá»§a Stack Reconciler
Â§2.  Fiber lÃ  gÃ¬? â€” Má»¥c tiÃªu & Ã tÆ°á»Ÿng cá»‘t lÃµi
Â§3.  Kiáº¿n trÃºc React Runtime â€” 3 táº§ng Instance
Â§4.  Fiber Node â€” Cáº¥u trÃºc dá»¯ liá»‡u chi tiáº¿t
Â§5.  Fiber Tree â€” CÃ¢y liÃªn káº¿t Ä‘Æ¡n (Singly Linked List Tree)
Â§6.  workInProgress Tree â€” Double Buffering
Â§7.  Fiber Reconciler â€” 2 Phase: Render + Commit
Â§8.  Phase 1: Render/Reconciliation â€” Interruptible!
Â§9.  Phase 2: Commit â€” Uninterruptible!
Â§10. Work Loop â€” VÃ²ng láº·p cÃ´ng viá»‡c
Â§11. requestIdleCallback â€” Lá»‹ch trÃ¬nh há»£p tÃ¡c
Â§12. Priority Strategy â€” 6 má»©c Ä‘á»™ Æ°u tiÃªn
Â§13. Effect List â€” Thu tháº­p káº¿t quáº£
Â§14. Lifecycle Hooks trong Fiber
Â§15. Tá»± viáº¿t tay Mini Fiber Scheduler
Â§16. So sÃ¡nh: Stack Reconciler vs Fiber Reconciler
Â§17. Best Practices & Phá»ng váº¥n Q&A
```

---

## Â§1. Táº¡i Sao Cáº§n Fiber? â€” Váº¥n Äá» Cá»§a Stack Reconciler

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  STACK RECONCILER = Äá»† QUY Tá»ª TRÃŠN XUá»NG, KHÃ”NG Dá»ªNG ÄÆ¯á»¢C!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Váº¤N Äá»€ Gá»C: JAVASCRIPT CHáº Y TRÃŠN MAIN THREAD!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Browser Main Thread pháº£i xá»­ lÃ½ Táº¤T Cáº¢:             â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚          MAIN THREAD (1 thread duy nháº¥t!)    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
  â”‚  â”‚  â”‚ JavaScriptâ”‚  â”‚   Style   â”‚  â”‚  Layout  â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ Execution â”‚  â”‚Calculationâ”‚  â”‚          â”‚ â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
  â”‚  â”‚  â”‚  Paint    â”‚  â”‚ Animation â”‚  â”‚  User    â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚           â”‚  â”‚  Frames   â”‚  â”‚  Input   â”‚ â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ Táº¤T Cáº¢ chia sáº» 1 thread!                â”‚      â”‚
  â”‚  â”‚  â†’ JS cháº¡y = CÃC VIá»†C KHÃC PHáº¢I Äá»¢I!     â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  60fps = 16.67ms má»—i frame:                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  1 frame = 16.67ms                            â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
  â”‚  â”‚  â”‚Inputâ”‚Style â”‚Layoutâ”‚Paint â”‚Composeâ”‚        â”‚      â”‚
  â”‚  â”‚  â”‚ 2ms â”‚ 2ms  â”‚ 3ms  â”‚ 3ms â”‚ 2ms   â”‚        â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
  â”‚  â”‚  â†’ CÃ²n ~5ms cho JS!                          â”‚      â”‚
  â”‚  â”‚  â†’ Náº¿u JS cháº¡y > 16.67ms â†’ Máº¤T FRAME!     â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  STACK RECONCILER â€” Äá»† QUY KHÃ”NG Dá»ªNG ÄÆ¯á»¢C:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 15 (Stack Reconciler) â€” setState() â†’ diff:    â”‚
  â”‚                                                        â”‚
  â”‚  function reconcile(parentDom, vdom) {                 â”‚
  â”‚    // Äá»† QUY! Gá»i chÃ­nh nÃ³!                         â”‚
  â”‚    if (vdom.children) {                                â”‚
  â”‚      vdom.children.forEach(child => {                  â”‚
  â”‚        reconcile(parentDom, child); // â† Äá»† QUY!    â”‚
  â”‚      });                                               â”‚
  â”‚    }                                                   â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  CÃ¢y component cÃ³ 10,000 nodes:               â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  reconcile(App)                               â”‚      â”‚
  â”‚  â”‚    â””â†’ reconcile(Header)                       â”‚      â”‚
  â”‚  â”‚         â””â†’ reconcile(Logo)                    â”‚      â”‚
  â”‚  â”‚         â””â†’ reconcile(Nav)                     â”‚      â”‚
  â”‚  â”‚              â””â†’ reconcile(NavItem) x 20       â”‚      â”‚
  â”‚  â”‚    â””â†’ reconcile(Main)                         â”‚      â”‚
  â”‚  â”‚         â””â†’ reconcile(ProductList)             â”‚      â”‚
  â”‚  â”‚              â””â†’ reconcile(Product) x 1000     â”‚      â”‚
  â”‚  â”‚                   â””â†’ reconcile(Button)        â”‚      â”‚
  â”‚  â”‚                   â””â†’ reconcile(Image)         â”‚      â”‚
  â”‚  â”‚                   â””â†’ ...                      â”‚      â”‚
  â”‚  â”‚    â””â†’ reconcile(Footer)                       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ 10,000 láº§n gá»i Äá»† QUY!                  â”‚      â”‚
  â”‚  â”‚  â†’ Máº¥t 200ms+ liÃªn tá»¥c!                      â”‚      â”‚
  â”‚  â”‚  â†’ Main thread Bá»Š CHIáº¾M 200ms!              â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG THá»‚ Dá»ªNG giá»¯a chá»«ng!               â”‚      â”‚
  â”‚  â”‚  â†’ = Máº¤T 12+ FRAMES! (200/16.67)            â”‚      â”‚
  â”‚  â”‚  â†’ Animation GIáº¬T! Input KHÃ”NG pháº£n há»“i!    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  CALL STACK (há»‡ thá»‘ng):                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      â”‚
  â”‚  â”‚  â”‚ reconcile(App)          â† Ä‘Ã¡y  â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚ reconcile(Main)                  â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚ reconcile(ProductList)           â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚ reconcile(Product[0])            â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚ reconcile(Button)       â† Ä‘á»‰nh â”‚          â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ Context lÆ°u trong CALL STACK!             â”‚      â”‚
  â”‚  â”‚  â†’ Stack = há»‡ thá»‘ng quáº£n lÃ½!                â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG THá»‚ táº¡m dá»«ng + tiáº¿p tá»¥c!          â”‚      â”‚
  â”‚  â”‚  â†’ Pop ra = Máº¤T context!                     â”‚      â”‚
  â”‚  â”‚  â†’ Pháº£i cháº¡y Háº¾T hoáº·c KHÃ”NG GÃŒ Cáº¢!        â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ğŸ’¡ ÄÃ¢y lÃ  lÃ½ do gá»i lÃ  "STACK" Reconciler!â”‚      â”‚
  â”‚  â”‚  â†’ DÃ¹ng system stack Ä‘á»ƒ lÆ°u tráº¡ng thÃ¡i!     â”‚      â”‚
  â”‚  â”‚  â†’ Stack = khÃ´ng dá»«ng Ä‘Æ°á»£c!                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  TIMELINE â€” STACK RECONCILER GÃ‚Y GIáº¬T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Frame 1    Frame 2    Frame 3    ...    Frame 13      â”‚
  â”‚  16.67ms    16.67ms    16.67ms           16.67ms       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”          â”‚
  â”‚  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚           â”‚    â”‚          â”‚
  â”‚  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚           â”‚    â”‚          â”‚
  â”‚  â”‚    â”‚    â”‚    â”‚    â”‚    â”‚           â”‚    â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                        â”‚
  â”‚  â”‚â—€â”€â”€â”€â”€ JS reconcile CHIáº¾M 200ms! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚     â”‚
  â”‚  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚     â”‚
  â”‚  â”‚                                                â”‚     â”‚
  â”‚  â”‚ KHÃ”NG render frame nÃ o! = Máº¤T 12 frames!    â”‚     â”‚
  â”‚  â”‚ Animation Äá»¨NG! User input KHÃ”NG pháº£n há»“i!  â”‚     â”‚
  â”‚  â”‚ â†’ "JANK!" (giáº­t lag)                          â”‚     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Fiber LÃ  GÃ¬? â€” Má»¥c TiÃªu & Ã TÆ°á»Ÿng Cá»‘t LÃµi

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIBER = TÃI Cáº¤U TRÃšC HOÃ€N TOÃ€N RECONCILER!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Äá»ŠNH NGHÄ¨A:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  "Fiber" cÃ³ 2 nghÄ©a:                                  â”‚
  â”‚                                                        â”‚
  â”‚  â‘  React Fiber (viáº¿t HOA):                            â”‚
  â”‚     = ToÃ n bá»™ dá»± Ã¡n tÃ¡i cáº¥u trÃºc core algorithm      â”‚
  â”‚     = Fiber Reconciler thay tháº¿ Stack Reconciler       â”‚
  â”‚     = 2 nÄƒm phÃ¡t triá»ƒn!                               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ fiber (viáº¿t thÆ°á»ng):                               â”‚
  â”‚     = 1 node trong Fiber Tree                          â”‚
  â”‚     = 1 Ä‘Æ¡n vá»‹ cÃ´ng viá»‡c (unit of work)               â”‚
  â”‚     = 1 JavaScript object chá»©a thÃ´ng tin component    â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ "Fiber" = "sá»£i" (nhá» hÆ¡n "thread"!)             â”‚
  â”‚  â†’ Thread (luá»“ng) â†’ Fiber (sá»£i)                      â”‚
  â”‚  â†’ Ã nghÄ©a: chia nhá» cÃ´ng viá»‡c thÃ nh tá»«ng "sá»£i"!   â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  5 Má»¤C TIÃŠU Cá»¦A FIBER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Chia nhá» CÃ”NG VIá»†C thÃ nh chunks NHá»,             â”‚
  â”‚     cÃ³ thá»ƒ NGáº®T GIá»®A CHá»ªNG!                          â”‚
  â”‚     â†’ Stack: Ä‘á»‡ quy liÃªn tá»¥c, khÃ´ng dá»«ng!            â”‚
  â”‚     â†’ Fiber: vÃ²ng láº·p, xá»­ lÃ½ 1 fiber/láº§n, dá»«ng OK! â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Äiá»u chá»‰nh Äá»˜ Æ¯U TIÃŠN, lÃ m láº¡i hoáº·c TÃI Sá»¬  â”‚
  â”‚     Dá»¤NG káº¿t quáº£ Ä‘Ã£ hoÃ n thÃ nh!                      â”‚
  â”‚     â†’ Keyboard input = Æ°u tiÃªn CAO!                  â”‚
  â”‚     â†’ Network request = Æ°u tiÃªn THáº¤P!                â”‚
  â”‚     â†’ CÃ³ thá»ƒ Há»¦Y vÃ  LÃ€M Láº I!                       â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Chuyá»ƒn Ä‘á»•i linh hoáº¡t giá»¯a PARENT vÃ  CHILD        â”‚
  â”‚     (yield back and forth)!                            â”‚
  â”‚     â†’ Há»— trá»£ layout refresh trong khi React cháº¡y!   â”‚
  â”‚     â†’ Cooperative scheduling!                          â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ render() tráº£ vá» NHIá»€U elements!                    â”‚
  â”‚     â†’ React 15: render() CHá»ˆ tráº£ 1 element!          â”‚
  â”‚     â†’ React 16+: tráº£ arrays, fragments!               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ Há»— trá»£ Error Boundaries Tá»T HÆ N!                â”‚
  â”‚     â†’ componentDidCatch()!                             â”‚
  â”‚     â†’ Lá»—i 1 component KHÃ”NG crash toÃ n app!          â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Ã TÆ¯á»NG Cá»T LÃ•I â€” Äá»† QUY â†’ VÃ’NG Láº¶P:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• STACK RECONCILER (Äá»† QUY) â•â•â•                    â”‚
  â”‚                                                        â”‚
  â”‚  function reconcile(node) {                            â”‚
  â”‚    // Xá»­ lÃ½ node hiá»‡n táº¡i                             â”‚
  â”‚    updateNode(node);                                   â”‚
  â”‚    // Äá»† QUY xuá»‘ng children â€” KHÃ”NG Dá»ªNG ÄÆ¯á»¢C!      â”‚
  â”‚    node.children.forEach(child => reconcile(child));   â”‚
  â”‚  }                                                     â”‚
  â”‚  // â†’ DÃ¹ng SYSTEM STACK lÆ°u context!                  â”‚
  â”‚  // â†’ Pop stack = máº¥t context! KhÃ´ng resume Ä‘Æ°á»£c!    â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• FIBER RECONCILER (VÃ’NG Láº¶P) â•â•â•                  â”‚
  â”‚                                                        â”‚
  â”‚  let nextUnitOfWork = rootFiber;                       â”‚
  â”‚                                                        â”‚
  â”‚  function workLoop(deadline) {                         â”‚
  â”‚    while (nextUnitOfWork && deadline.timeRemaining()   â”‚
  â”‚           > 0) {                                       â”‚
  â”‚      // Xá»­ lÃ½ 1 fiber, tráº£ vá» fiber tiáº¿p theo!      â”‚
  â”‚      nextUnitOfWork =                                  â”‚
  â”‚        performUnitOfWork(nextUnitOfWork);              â”‚
  â”‚    }                                                   â”‚
  â”‚    // Háº¾T THá»œI GIAN â†’ dá»«ng! Láº§n sau tiáº¿p tá»¥c!     â”‚
  â”‚    if (nextUnitOfWork) {                               â”‚
  â”‚      requestIdleCallback(workLoop); // â† lÃªn lá»‹ch!  â”‚
  â”‚    }                                                   â”‚
  â”‚  }                                                     â”‚
  â”‚  // â†’ DÃ¹ng FIBER OBJECT lÆ°u context!                  â”‚
  â”‚  // â†’ Dá»«ng báº¥t cá»© lÃºc nÃ o! Resume = Ä‘á»c fiber!      â”‚
  â”‚  // â†’ ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t Cá»T LÃ•I!                â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ FIBER = "Virtual Stack Frame"!                     â”‚
  â”‚  â†’ Thay vÃ¬ dÃ¹ng system stack (khÃ´ng kiá»ƒm soÃ¡t),      â”‚
  â”‚    Fiber tá»± quáº£n lÃ½ "stack" báº±ng linked list!         â”‚
  â”‚  â†’ Má»—i fiber = 1 "stack frame" Ä‘Æ°á»£c lÆ°u trá»¯!        â”‚
  â”‚  â†’ CÃ³ thá»ƒ dá»«ng, lÆ°u, tiáº¿p tá»¥c Báº¤T Cá»¨ LÃšC NÃ€O!   â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Kiáº¿n TrÃºc React Runtime â€” 3 Táº§ng Instance

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  REACT RUNTIME = 3 Táº¦NG!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  3 Táº¦NG Cá»¦A REACT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  Táº¦NG 1: ELEMENTS                            â”‚      â”‚
  â”‚  â”‚  â†’ MÃ” Táº¢ UI trÃ´ng nhÆ° tháº¿ nÃ o!              â”‚      â”‚
  â”‚  â”‚  â†’ { type, props, children }                  â”‚      â”‚
  â”‚  â”‚  â†’ IMMUTABLE! Táº¡o má»›i má»—i láº§n render!       â”‚      â”‚
  â”‚  â”‚  â†’ React.createElement('div', {id: 'app'})   â”‚      â”‚
  â”‚  â”‚  â†’ = JSX biÃªn dá»‹ch ra!                       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  const element = {                            â”‚      â”‚
  â”‚  â”‚    type: 'div',                               â”‚      â”‚
  â”‚  â”‚    props: { className: 'app' },               â”‚      â”‚
  â”‚  â”‚    children: [...]                            â”‚      â”‚
  â”‚  â”‚  };                                           â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                     â”‚                                   â”‚
  â”‚                     â”‚ Táº¡o Instances tá»« Elements!       â”‚
  â”‚                     â–¼                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  Táº¦NG 2: INSTANCES (fiber nodes)             â”‚      â”‚
  â”‚  â”‚  â†’ QUáº¢N LÃ STATE + LIFECYCLE!               â”‚      â”‚
  â”‚  â”‚  â†’ Duy trÃ¬ quan há»‡ giá»¯a components!        â”‚      â”‚
  â”‚  â”‚  â†’ MUTABLE! Cáº­p nháº­t khi state thay Ä‘á»•i!   â”‚      â”‚
  â”‚  â”‚  â†’ Fiber tree = táº§ng nÃ y!                    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  React 15: vDOM tree (plain objects)          â”‚      â”‚
  â”‚  â”‚  React 16+: Fiber tree (fiber nodes!)         â”‚      â”‚
  â”‚  â”‚  â†’ THÃŠM thÃ´ng tin scheduling!                â”‚      â”‚
  â”‚  â”‚  â†’ THÃŠM priority, effect list!               â”‚      â”‚
  â”‚  â”‚  â†’ THÃŠM linked list pointers!                â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                     â”‚                                   â”‚
  â”‚                     â”‚ Ãp dá»¥ng thay Ä‘á»•i lÃªn DOM!      â”‚
  â”‚                     â–¼                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  Táº¦NG 3: DOM (Real DOM)                      â”‚      â”‚
  â”‚  â”‚  â†’ DOM THáº¬T trÃªn trÃ¬nh duyá»‡t!               â”‚      â”‚
  â”‚  â”‚  â†’ Chá»‰ Cáº¬P NHáº¬T khi commit!                 â”‚      â”‚
  â”‚  â”‚  â†’ document.createElement('div')              â”‚      â”‚
  â”‚  â”‚  â†’ Thao tÃ¡c DOM = Tá»N KÃ‰M!                 â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  REACT 16+ THÃŠM 2 Táº¦NG Táº M THá»œI:                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  DOM (Real DOM nodes)                         â”‚      â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚      â”‚
  â”‚  â”‚  effect list â† Táº M! LÆ°u káº¿t quáº£ diff!     â”‚      â”‚
  â”‚  â”‚  - - - - - - - - - - - - - - - -              â”‚      â”‚
  â”‚  â”‚  workInProgress â† Táº M! Snapshot tiáº¿n trÃ¬nh! â”‚      â”‚
  â”‚  â”‚  - - - - - - - - - - - - - - - -              â”‚      â”‚
  â”‚  â”‚  fiber tree â† CHÃNH! vDOM + scheduling info! â”‚      â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚      â”‚
  â”‚  â”‚  Elements (type, props)                       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ effect list: lÆ°u side effects (DOM changes)â”‚      â”‚
  â”‚  â”‚  â†’ workInProgress: cÃ¢y Ä‘ang xÃ¢y dá»±ng        â”‚      â”‚
  â”‚  â”‚  â†’ Chá»‰ tá»“n táº¡i TRONG KHI update!            â”‚      â”‚
  â”‚  â”‚  â†’ Sau commit â†’ workInProgress thÃ nh fiber!  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  2 PHáº¦N Cá»¦A REACT IMPLEMENTATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  RECONCILER       â”‚    â”‚  RENDERER             â”‚      â”‚
  â”‚  â”‚  (Bá»™ Ä‘iá»u hÃ²a)  â”‚    â”‚  (Bá»™ render)         â”‚      â”‚
  â”‚  â”‚                   â”‚    â”‚                       â”‚      â”‚
  â”‚  â”‚  XÃ¡c Ä‘á»‹nh KHÃC   â”‚    â”‚  Ãp dá»¥ng thay Ä‘á»•i   â”‚      â”‚
  â”‚  â”‚  BIá»†T giá»¯a 2     â”‚    â”‚  lÃªn PLATFORM!       â”‚      â”‚
  â”‚  â”‚  phiÃªn báº£n UI!   â”‚    â”‚                       â”‚      â”‚
  â”‚  â”‚                   â”‚    â”‚  â€¢ React DOM (web)    â”‚      â”‚
  â”‚  â”‚  â€¢ Stack (cÅ©)    â”‚    â”‚  â€¢ React Native (app) â”‚      â”‚
  â”‚  â”‚  â€¢ Fiber (má»›i!)  â”‚    â”‚  â€¢ React ART (canvas) â”‚      â”‚
  â”‚  â”‚                   â”‚    â”‚  â€¢ ReactHardware      â”‚      â”‚
  â”‚  â”‚  â†’ PLATFORM-     â”‚    â”‚  â€¢ React-pdf          â”‚      â”‚
  â”‚  â”‚    AGNOSTIC!      â”‚    â”‚  â€¢ React VR           â”‚      â”‚
  â”‚  â”‚  â†’ KhÃ´ng phá»¥    â”‚    â”‚  â†’ PLUGIN-based!      â”‚      â”‚
  â”‚  â”‚    thuá»™c DOM!    â”‚    â”‚  â†’ Thay Ä‘á»•i renderer â”‚      â”‚
  â”‚  â”‚                   â”‚    â”‚    = cháº¡y platform   â”‚      â”‚
  â”‚  â”‚                   â”‚    â”‚    khÃ¡c!              â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Fiber tÃ¡i cáº¥u trÃºc RECONCILER!                    â”‚
  â”‚  â†’ Renderer KHÃ”NG thay Ä‘á»•i!                          â”‚
  â”‚  â†’ "Bá»™ nÃ£o" má»›i, "tay chÃ¢n" giá»¯ nguyÃªn!            â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Fiber Node â€” Cáº¥u TrÃºc Dá»¯ Liá»‡u Chi Tiáº¿t

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Má»–I FIBER = 1 JAVASCRIPT OBJECT Vá»šI NHIá»€U TRÆ¯á»œNG!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Cáº¤U TRÃšC Cá»¦A 1 FIBER NODE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // Má»—i fiber node chá»©a cÃ¡c trÆ°á»ng sau:               â”‚
  â”‚  {                                                     â”‚
  â”‚    // â•â•â• NHáº¬N Dáº NG â•â•â•                                â”‚
  â”‚    tag,              // Loáº¡i fiber (Function, Class,   â”‚
  â”‚                      // HostComponent, HostText...)    â”‚
  â”‚    key,              // Key cho reconciliation          â”‚
  â”‚    type,             // Component function/class,      â”‚
  â”‚                      // hoáº·c tag name ('div', 'span') â”‚
  â”‚    elementType,      // Giá»¯ nguyÃªn type gá»‘c           â”‚
  â”‚                                                        â”‚
  â”‚    // â•â•â• QUAN Há»† (Linked List!) â•â•â•                  â”‚
  â”‚    return,           // â† PARENT fiber!               â”‚
  â”‚    child,            // â† FIRST child fiber!          â”‚
  â”‚    sibling,          // â† Anh/chá»‹ em TIáº¾P THEO!     â”‚
  â”‚    index,            // Vá»‹ trÃ­ trong children          â”‚
  â”‚                                                        â”‚
  â”‚    // â•â•â• TRáº NG THÃI â•â•â•                               â”‚
  â”‚    stateNode,        // Instance tháº­t:                  â”‚
  â”‚                      // - Class component: this        â”‚
  â”‚                      // - DOM element: DOM node        â”‚
  â”‚                      // - Function component: null     â”‚
  â”‚    pendingProps,      // Props Má»šI (chÆ°a xá»­ lÃ½)      â”‚
  â”‚    memoizedProps,     // Props ÄÃƒ xá»­ lÃ½             â”‚
  â”‚    memoizedState,     // State ÄÃƒ xá»­ lÃ½             â”‚
  â”‚    updateQueue,       // HÃ ng Ä‘á»£i state updates       â”‚
  â”‚                                                        â”‚
  â”‚    // â•â•â• EFFECTS (Side Effects) â•â•â•                   â”‚
  â”‚    effectTag,         // Loáº¡i effect (Placement,       â”‚
  â”‚                      // Update, Deletion...)           â”‚
  â”‚    firstEffect,       // â†’ Äáº§u effect list           â”‚
  â”‚    lastEffect,        // â†’ Cuá»‘i effect list           â”‚
  â”‚    nextEffect,        // â†’ Effect tiáº¿p theo           â”‚
  â”‚                                                        â”‚
  â”‚    // â•â•â• SCHEDULING â•â•â•                               â”‚
  â”‚    expirationTime,    // Thá»i háº¡n Æ°u tiÃªn            â”‚
  â”‚    alternate,         // â†’ fiber trong CÃ‚Y KHÃC      â”‚
  â”‚                      // (current â†” workInProgress)   â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  GIáº¢I THÃCH CÃC TRÆ¯á»œNG QUAN TRá»ŒNG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  return (KHÃ”NG pháº£i parent!):                       â”‚
  â”‚  â†’ TÃªn "return" vÃ¬: sau khi xá»­ lÃ½ XONG, fiber sáº½   â”‚
  â”‚    "RETURN" káº¿t quáº£ (effect list) cho node nÃ y!       â”‚
  â”‚  â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng parent pointer!                        â”‚
  â”‚  â†’ NhÆ°ng mang Ã½ nghÄ©a "ná»™p káº¿t quáº£ vá» Ä‘Ã¢u!"      â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ child + sibling (Linked List!):                    â”‚
  â”‚  â†’ KHÃ”NG pháº£i children array!                          â”‚
  â”‚  â†’ Child = CON Äáº¦U TIÃŠN!                             â”‚
  â”‚  â†’ Sibling = ANH EM TIáº¾P THEO!                       â”‚
  â”‚  â†’ = Singly Linked List!                               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ alternate (Cá»°C Ká»² QUAN TRá»ŒNG!):                  â”‚
  â”‚  â†’ Má»—i fiber cÃ³ 1 "báº£n sao" á»Ÿ cÃ¢y khÃ¡c!             â”‚
  â”‚  â†’ current fiber â†” workInProgress fiber               â”‚
  â”‚  â†’ current.alternate = workInProgress                  â”‚
  â”‚  â†’ workInProgress.alternate = current                  â”‚
  â”‚  â†’ = DOUBLE BUFFERING!                                 â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ effectTag (bitwise flags!):                        â”‚
  â”‚  â†’ DÃ¹ng BIT OPERATIONS cho hiá»‡u suáº¥t!                â”‚
  â”‚  â†’ Placement = 0b0000010 (thÃªm má»›i!)                 â”‚
  â”‚  â†’ Update    = 0b0000100 (cáº­p nháº­t!)                  â”‚
  â”‚  â†’ Deletion  = 0b0001000 (xÃ³a!)                       â”‚
  â”‚  â†’ CÃ³ thá»ƒ COMBINE: Placement | Update                 â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ stateNode:                                         â”‚
  â”‚  â†’ Class Component: instance (this!)                   â”‚
  â”‚  â†’ Host Component ('div'): DOM node tháº­t!             â”‚
  â”‚  â†’ Function Component: null (khÃ´ng cÃ³ instance!)      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Fiber Tree â€” CÃ¢y LiÃªn Káº¿t ÄÆ¡n (Singly Linked List Tree)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIBER TREE = CÃ‚Y DÃ™NG LINKED LIST, KHÃ”NG PHáº¢I ARRAY!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  SO SÃNH VDOM TREE vs FIBER TREE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• vDOM Tree (React 15) â•â•â•                          â”‚
  â”‚  â†’ Má»—i node cÃ³ Máº¢NG children!                        â”‚
  â”‚                                                        â”‚
  â”‚  {                                                     â”‚
  â”‚    type: 'div',                                        â”‚
  â”‚    children: [    â† Máº¢NG! Duyá»‡t báº±ng Äá»† QUY!       â”‚
  â”‚      { type: 'h1', children: [...] },                  â”‚
  â”‚      { type: 'p', children: [...] },                   â”‚
  â”‚      { type: 'ul', children: [...] }                   â”‚
  â”‚    ]                                                   â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• Fiber Tree (React 16+) â•â•â•                        â”‚
  â”‚  â†’ Má»—i node cÃ³ child, sibling, return!                â”‚
  â”‚                                                        â”‚
  â”‚  {                                                     â”‚
  â”‚    type: 'div',                                        â”‚
  â”‚    child: fiberH1,     â† CON Äáº¦U TIÃŠN!              â”‚
  â”‚    sibling: null,      â† KHÃ”NG cÃ³ anh em!            â”‚
  â”‚    return: parentFiber â† TRáº¢ Vá»€ cho ai!             â”‚
  â”‚  }                                                     â”‚
  â”‚  // fiberH1.sibling = fiberP                           â”‚
  â”‚  // fiberP.sibling = fiberUL                           â”‚
  â”‚  // â†’ LINKED LIST!                                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ FIBER TREE LIÃŠN Káº¾T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  JSX:                                                   â”‚
  â”‚  <App>                                                  â”‚
  â”‚    <Header>                                             â”‚
  â”‚      <Logo />                                           â”‚
  â”‚      <Nav />                                            â”‚
  â”‚    </Header>                                            â”‚
  â”‚    <Main>                                               â”‚
  â”‚      <Content />                                        â”‚
  â”‚      <Sidebar />                                        â”‚
  â”‚    </Main>                                              â”‚
  â”‚    <Footer />                                           â”‚
  â”‚  </App>                                                 â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  FIBER TREE (Linked List!):                             â”‚
  â”‚                                                        â”‚
  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
  â”‚          â”‚   App   â”‚                                    â”‚
  â”‚          â”‚         â”‚                                    â”‚
  â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                    â”‚
  â”‚               â”‚ child                                   â”‚
  â”‚               â–¼                                         â”‚
  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  sibling  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  sibling    â”‚
  â”‚          â”‚ Header  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Main   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  â”‚
  â”‚          â”‚         â”‚           â”‚         â”‚             â”‚
  â”‚          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜             â”‚
  â”‚               â”‚ child               â”‚ child    â”Œâ”€â”€â”€â”€â”€â”€â”â”‚
  â”‚               â–¼                     â–¼          â”‚Footerâ”‚â”‚
  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â””â”€â”€â”€â”€â”€â”€â”˜â”‚
  â”‚          â”‚  Logo   â”‚ sibling  â”‚ Content â”‚ sibling      â”‚
  â”‚          â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶     â”‚
  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚               â”‚                     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚               â–¼                     â–¼     â”‚ Sidebar â”‚  â”‚
  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚          â”‚   Nav   â”‚                                    â”‚
  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  Má»–I MÅ¨I TÃŠN lÃ  1 POINTER:                            â”‚
  â”‚  â”€â”€â”€ child â”€â”€â”€â–¶  : con Ä‘áº§u tiÃªn                      â”‚
  â”‚  â”€â”€ sibling â”€â”€â–¶  : anh em tiáº¿p theo                   â”‚
  â”‚  â”€â”€ return â”€â”€â”€â–¶  : tráº£ káº¿t quáº£ vá» (PARENT)           â”‚
  â”‚  (return ngÆ°á»£c chiá»u child/sibling, khÃ´ng váº½!)        â”‚
  â”‚                                                        â”‚
  â”‚  VÃ Dá»¤:                                                â”‚
  â”‚  App.child = Header                                    â”‚
  â”‚  Header.sibling = Main                                 â”‚
  â”‚  Main.sibling = Footer                                 â”‚
  â”‚  Header.child = Logo                                   â”‚
  â”‚  Logo.sibling = Nav                                    â”‚
  â”‚  Main.child = Content                                  â”‚
  â”‚  Content.sibling = Sidebar                             â”‚
  â”‚  Logo.return = Header                                  â”‚
  â”‚  Header.return = App                                   â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  THá»¨ Tá»° DUYá»†T (DFS báº±ng VÃ’NG Láº¶P!):                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  1. App        (báº¯t Ä‘áº§u!)                   â”‚      â”‚
  â”‚  â”‚  2. Header     (child cá»§a App!)              â”‚      â”‚
  â”‚  â”‚  3. Logo       (child cá»§a Header!)           â”‚      â”‚
  â”‚  â”‚  4. Nav        (sibling cá»§a Logo!)           â”‚      â”‚
  â”‚  â”‚  5. Main       (return Header â†’ sibling!)   â”‚      â”‚
  â”‚  â”‚  6. Content    (child cá»§a Main!)             â”‚      â”‚
  â”‚  â”‚  7. Sidebar    (sibling cá»§a Content!)        â”‚      â”‚
  â”‚  â”‚  8. Footer     (return Main â†’ sibling!)     â”‚      â”‚
  â”‚  â”‚  9. â†’ return App â†’ XONG!                   â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  THUáº¬T TOÃN:                                  â”‚      â”‚
  â”‚  â”‚  â‘  CÃ“ child? â†’ Ä‘i xuá»‘ng child!             â”‚      â”‚
  â”‚  â”‚  â‘¡ KHÃ”NG child? CÃ“ sibling? â†’ qua sibling! â”‚      â”‚
  â”‚  â”‚  â‘¢ KHÃ”NG cáº£ hai? â†’ return LÃŠN, tÃ¬m siblingâ”‚      â”‚
  â”‚  â”‚  â‘£ Return Ä‘áº¿n root? â†’ XONG!                â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ğŸ’¡ DFS (Depth-First Search) báº±ng VÃ’NG Láº¶P!â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG Äá»† QUY!                            â”‚      â”‚
  â”‚  â”‚  â†’ Dá»«ng báº¥t cá»© lÃºc nÃ o!                    â”‚      â”‚
  â”‚  â”‚  â†’ nextUnitOfWork = fiber tiáº¿p theo!         â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. workInProgress Tree â€” Double Buffering

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DOUBLE BUFFERING = 2 CÃ‚Y LUÃ‚N PHIÃŠN NHAU!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  NGUYÃŠN LÃ DOUBLE BUFFERING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React duy trÃ¬ 2 fiber trees:                          â”‚
  â”‚                                                        â”‚
  â”‚  â‘  current tree:                                      â”‚
  â”‚     â†’ CÃ¢y fiber ÄANG hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh!        â”‚
  â”‚     â†’ = tráº¡ng thÃ¡i UI hiá»‡n táº¡i!                      â”‚
  â”‚     â†’ KHÃ”NG Ä‘Æ°á»£c sá»­a trá»±c tiáº¿p!                      â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ workInProgress tree (WIP):                         â”‚
  â”‚     â†’ CÃ¢y fiber ÄANG Ä‘Æ°á»£c xÃ¢y dá»±ng!                  â”‚
  â”‚     â†’ = tráº¡ng thÃ¡i UI TIáº¾P THEO!                     â”‚
  â”‚     â†’ XÃ¢y dá»±ng trong phase render!                   â”‚
  â”‚     â†’ CÃ³ thá»ƒ Bá»Š Há»¦Y + xÃ¢y láº¡i!                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  QUÃ TRÃŒNH:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  setState() â†’ Báº¯t Ä‘áº§u update!               â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚      â”‚
  â”‚  â”‚  â”‚   current   â”‚ alt â”‚    WIP      â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚   tree      â”‚â—„â”€â”€â”€â–¶â”‚    tree     â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚             â”‚     â”‚ (Ä‘ang xÃ¢y!) â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”      â”‚     â”‚  â”Œâ”€â”€â”€â”      â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚  â”‚ A â”‚      â”‚     â”‚  â”‚ A'â”‚      â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”¤      â”‚     â”‚  â”œâ”€â”€â”€â”¤      â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚  â”‚ B â”‚ C â”‚  â”‚     â”‚  â”‚B' â”‚ C'â”‚  â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”˜   â”‚  â”‚     â”‚  â””â”€â”€â”€â”˜   â”‚  â”‚          â”‚      â”‚
  â”‚  â”‚  â”‚          â”‚  â”‚     â”‚          â”‚  â”‚          â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  A.alternate = A'                             â”‚      â”‚
  â”‚  â”‚  A'.alternate = A                             â”‚      â”‚
  â”‚  â”‚  (TÆ°Æ¡ng tá»± cho Bâ†”B', Câ†”C')                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Sau commit:                                  â”‚      â”‚
  â”‚  â”‚  â†’ WIP tree THÃ€NH current tree!              â”‚      â”‚
  â”‚  â”‚  â†’ current CÅ¨ thÃ nh "dá»± trá»¯" cho láº§n sau!  â”‚      â”‚
  â”‚  â”‚  â†’ Chá»‰ Ä‘á»•i POINTER! KhÃ´ng táº¡o má»›i!         â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  CODE Táº O workInProgress fiber:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  function createWorkInProgress(current) {     â”‚      â”‚
  â”‚  â”‚    // â‘  Kiá»ƒm tra alternate (báº£n sao cÅ©!)   â”‚      â”‚
  â”‚  â”‚    let workInProgress = current.alternate;    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚    if (workInProgress === null) {             â”‚      â”‚
  â”‚  â”‚      // â‘¡ Láº§n Ä‘áº§u: Táº O Má»šI!               â”‚      â”‚
  â”‚  â”‚      workInProgress = createFiber(            â”‚      â”‚
  â”‚  â”‚        current.tag,                           â”‚      â”‚
  â”‚  â”‚        current.pendingProps,                   â”‚      â”‚
  â”‚  â”‚        current.key                            â”‚      â”‚
  â”‚  â”‚      );                                       â”‚      â”‚
  â”‚  â”‚      // â‘¢ LiÃªn káº¿t 2 chiá»u!                 â”‚      â”‚
  â”‚  â”‚      workInProgress.alternate = current;      â”‚      â”‚
  â”‚  â”‚      current.alternate = workInProgress;      â”‚      â”‚
  â”‚  â”‚    } else {                                   â”‚      â”‚
  â”‚  â”‚      // â‘£ CÃ“ alternate â†’ TÃI Sá»¬ Dá»¤NG!    â”‚      â”‚
  â”‚  â”‚      workInProgress.pendingProps =            â”‚      â”‚
  â”‚  â”‚        current.pendingProps;                   â”‚      â”‚
  â”‚  â”‚      // â‘¤ Reset effects!                    â”‚      â”‚
  â”‚  â”‚      workInProgress.effectTag = NoEffect;     â”‚      â”‚
  â”‚  â”‚      workInProgress.firstEffect = null;       â”‚      â”‚
  â”‚  â”‚      workInProgress.lastEffect = null;        â”‚      â”‚
  â”‚  â”‚      workInProgress.nextEffect = null;        â”‚      â”‚
  â”‚  â”‚    }                                          â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚    return workInProgress;                     â”‚      â”‚
  â”‚  â”‚  }                                            â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ğŸ’¡ TÃI Sá»¬ Dá»¤NG fiber cÅ©:                   â”‚      â”‚
  â”‚  â”‚  â†’ Tiáº¿t kiá»‡m MEMORY ALLOCATION!              â”‚      â”‚
  â”‚  â”‚  â†’ Giáº£m GARBAGE COLLECTION!                  â”‚      â”‚
  â”‚  â”‚  â†’ fiber cÅ© thÃ nh "vá»" cho fiber má»›i!       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ DOUBLE BUFFERING TIMELINE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Láº§n 1 (Initial Render):                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
  â”‚  â”‚ current  â”‚ (xÃ¢y dá»±ng láº§n Ä‘áº§u!)                    â”‚
  â”‚  â”‚  Aâ”€Bâ”€C  â”‚                                          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
  â”‚                                                        â”‚
  â”‚  Láº§n 2 (Update: B thay Ä‘á»•i!):                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
  â”‚  â”‚ current  â”‚ alt â”‚   WIP    â”‚                         â”‚
  â”‚  â”‚  Aâ”€Bâ”€C  â”‚â—„â”€â”€â”€â–¶â”‚ A'â”€B'â”€C'â”‚  B' = B má»›i!           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
  â”‚        â”‚               â”‚                                â”‚
  â”‚        â”‚    commit!    â”‚                                â”‚
  â”‚        â–¼               â–¼                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
  â”‚  â”‚   cÅ©    â”‚ alt â”‚ current  â”‚ â† WIP THÃ€NH current!  â”‚
  â”‚  â”‚ (dá»± trá»¯)â”‚â—„â”€â”€â”€â–¶â”‚ A'â”€B'â”€C'â”‚                         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
  â”‚                                                        â”‚
  â”‚  Láº§n 3 (Update: C thay Ä‘á»•i!):                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
  â”‚  â”‚ current  â”‚ alt â”‚   WIP    â”‚                         â”‚
  â”‚  â”‚ A'â”€B'â”€C'â”‚â—„â”€â”€â”€â–¶â”‚A''â”€B''â”€C''â”‚ C'' = C má»›i!         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
  â”‚  (current cÅ© = WIP's â† TÃI Sá»¬ Dá»¤NG fiber objects!) â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ 2 cÃ¢y LUÃ‚N PHIÃŠN nhau, KHÃ”NG táº¡o má»›i!           â”‚
  â”‚  â†’ Giá»‘ng nhÆ° double buffer trong game rendering!       â”‚
  â”‚  â†’ Back buffer (WIP) â†’ Front buffer (current)!       â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Fiber Reconciler â€” 2 Phase: Render + Commit

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIBER RECONCILER CHIA THÃ€NH 2 GIAI ÄOáº N TÃCH BIá»†T!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  2 PHASES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Phase 1: RENDER / RECONCILIATION                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  â†’ CÃ“ THá»‚ NGáº®T! (Interruptible!)            â”‚      â”‚
  â”‚  â”‚  â†’ XÃ¢y dá»±ng workInProgress tree!             â”‚      â”‚
  â”‚  â”‚  â†’ Diff: tÃ¬m sá»± khÃ¡c biá»‡t!                 â”‚      â”‚
  â”‚  â”‚  â†’ Thu tháº­p effect list!                     â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG THAY Äá»”I DOM!                     â”‚      â”‚
  â”‚  â”‚  â†’ Chá»‰ TÃNH TOÃN!                           â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Lifecycle gá»i trong phase nÃ y:               â”‚      â”‚
  â”‚  â”‚  â€¢ constructor()                              â”‚      â”‚
  â”‚  â”‚  â€¢ getDerivedStateFromProps()                  â”‚      â”‚
  â”‚  â”‚  â€¢ shouldComponentUpdate()                    â”‚      â”‚
  â”‚  â”‚  â€¢ render()                                   â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âš  CÃ“ THá»‚ Gá»ŒI NHIá»€U Láº¦N!                  â”‚      â”‚
  â”‚  â”‚  â†’ Náº¿u bá»‹ ngáº¯t â†’ gá»i láº¡i!                  â”‚      â”‚
  â”‚  â”‚  â†’ KHÃ”NG Ä‘Æ°á»£c cÃ³ side effects!               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                     â”‚                                   â”‚
  â”‚                     â”‚ HoÃ n táº¥t â†’ pendingCommit!       â”‚
  â”‚                     â–¼                                   â”‚
  â”‚  Phase 2: COMMIT                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  â†’ KHÃ”NG THá»‚ NGáº®T! (Uninterruptible!)       â”‚      â”‚
  â”‚  â”‚  â†’ Thá»±c thi effect list!                     â”‚      â”‚
  â”‚  â”‚  â†’ THAY Äá»”I DOM tháº­t!                      â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i lifecycle functions!                  â”‚      â”‚
  â”‚  â”‚  â†’ Äá»’NG Bá»˜, cháº¡y 1 LÆ¯á»¢T!                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Lifecycle gá»i trong phase nÃ y:               â”‚      â”‚
  â”‚  â”‚  â€¢ componentDidMount()                        â”‚      â”‚
  â”‚  â”‚  â€¢ componentDidUpdate()                       â”‚      â”‚
  â”‚  â”‚  â€¢ componentWillUnmount()                     â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âœ… CHá»ˆ Gá»ŒI 1 Láº¦N!                         â”‚      â”‚
  â”‚  â”‚  â†’ KhÃ´ng bá»‹ ngáº¯t!                            â”‚      â”‚
  â”‚  â”‚  â†’ An toÃ n cho side effects!                 â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  Táº I SAO CHIA 2 PHASE?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Phase Render (diff) = TÃNH TOÃN thuáº§n tÃºy!        â”‚
  â”‚     â†’ So sÃ¡nh 2 cÃ¢y, tÃ¬m khÃ¡c biá»‡t!                 â”‚
  â”‚     â†’ TÃ­nh toÃ¡n = CÃ“ THá»‚ CHIA NHá»!                  â”‚
  â”‚     â†’ TÃ­nh ná»­a â†’ dá»«ng â†’ tÃ­nh tiáº¿p = OK!           â”‚
  â”‚     â†’ KHÃ”NG áº£nh hÆ°á»Ÿng UI (chÆ°a Ä‘á»¥ng DOM!)          â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Phase Commit (patch) = THAY Äá»”I DOM!             â”‚
  â”‚     â†’ ThÃªm/xÃ³a/sá»­a DOM nodes!                       â”‚
  â”‚     â†’ KHÃ”NG CHIA nhá» vÃ¬:                             â”‚
  â”‚     â†’ Náº¿u dá»«ng giá»¯a chá»«ng:                          â”‚
  â”‚       â†’ DOM half-updated = UI INCONSISTENT!           â”‚
  â”‚       â†’ User tháº¥y UI "ná»­a cÅ© ná»­a má»›i"!             â”‚
  â”‚       â†’ State khÃ´ng khá»›p DOM!                         â”‚
  â”‚     â†’ PHáº¢I cháº¡y 1 lÆ°á»£t!                              â”‚
  â”‚     â†’ May máº¯n: DOM operations NHANH hÆ¡n diff!       â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Phase 1: Render/Reconciliation â€” Interruptible!

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  PHASE RENDER = XÃ‚Y Dá»°NG workInProgress TREE Tá»ªNG NODE!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  QUY TRÃŒNH Xá»¬ LÃ Má»–I FIBER (Unit of Work):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  performUnitOfWork(fiber):                             â”‚
  â”‚                                                        â”‚
  â”‚  â‘  Kiá»ƒm tra: node cÃ³ Cáº¦N UPDATE khÃ´ng?              â”‚
  â”‚     â†’ So sÃ¡nh pendingProps vs memoizedProps!          â”‚
  â”‚     â†’ Kiá»ƒm tra state changes!                         â”‚
  â”‚     â†’ Kiá»ƒm tra context changes!                       â”‚
  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
  â”‚     â”‚ KHÃ”NG cáº§n update?                  â”‚              â”‚
  â”‚     â”‚ â†’ Clone children fibers!           â”‚              â”‚
  â”‚     â”‚ â†’ Nháº£y Ä‘áº¿n bÆ°á»›c â‘¥!              â”‚              â”‚
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Cáº­p nháº­t state hiá»‡n táº¡i:                           â”‚
  â”‚     â†’ Process updateQueue!                             â”‚
  â”‚     â†’ Merge pendingProps vÃ o memoizedProps!            â”‚
  â”‚     â†’ Update context!                                  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Kiá»ƒm tra shouldComponentUpdate():                  â”‚
  â”‚     â†’ Tráº£ false? â†’ Nháº£y bÆ°á»›c â‘¥!                    â”‚
  â”‚     â†’ Tráº£ true? â†’ Tiáº¿p tá»¥c!                         â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ Gá»i render() â†’ nháº­n children Má»šI:                â”‚
  â”‚     â†’ Táº¡o fiber cho má»—i child element!               â”‚
  â”‚     â†’ TÃI Sá»¬ Dá»¤NG fiber cÅ© náº¿u cÃ³ (key matching!)  â”‚
  â”‚     â†’ ÄÃ¡nh dáº¥u: Placement (thÃªm), Deletion (xÃ³a)   â”‚
  â”‚     â†’ Update (cáº­p nháº­t)!                              â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ CÃ³ child fiber?                                    â”‚
  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
  â”‚     â”‚ CÃ“ child:                          â”‚              â”‚
  â”‚     â”‚ â†’ return child; (xá»­ lÃ½ child tiáº¿p!)â”‚             â”‚
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ KHÃ”NG cÃ³ child â†’ completeUnitOfWork:              â”‚
  â”‚     â†’ Merge effect list LÃŠN return (parent)!          â”‚
  â”‚     â†’ CÃ³ sibling? â†’ return sibling!                   â”‚
  â”‚     â†’ KhÃ´ng? â†’ return lÃªn parent, tÃ¬m sibling!       â”‚
  â”‚     â†’ Return Ä‘áº¿n root? â†’ PHASE 1 XONG!              â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ DUYá»†T FIBER TREE TRONG PHASE RENDER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚           App                                           â”‚
  â”‚          / | \                                          â”‚
  â”‚      Header Main Footer                                â”‚
  â”‚       / \    |                                          â”‚
  â”‚    Logo  Nav Content                                    â”‚
  â”‚                                                        â”‚
  â”‚  beginWork (Ä‘i XUá»NG):          completeWork (Ä‘i LÃŠN):â”‚
  â”‚                                                        â”‚
  â”‚  â‘  beginWork(App)                                     â”‚
  â”‚  â‘¡ beginWork(Header)                                  â”‚
  â”‚  â‘¢ beginWork(Logo)                                    â”‚
  â”‚     â†’ KhÃ´ng cÃ³ child!                                 â”‚
  â”‚     â†’ completeWork(Logo) â† merge effects LÃŠN!       â”‚
  â”‚  â‘£ beginWork(Nav)           â† sibling cá»§a Logo!      â”‚
  â”‚     â†’ completeWork(Nav)                               â”‚
  â”‚     â†’ completeWork(Header)  â† return, xong children! â”‚
  â”‚  â‘¤ beginWork(Main)          â† sibling cá»§a Header!    â”‚
  â”‚  â‘¥ beginWork(Content)                                â”‚
  â”‚     â†’ completeWork(Content)                           â”‚
  â”‚     â†’ completeWork(Main)                              â”‚
  â”‚  â‘¦ beginWork(Footer)        â† sibling cá»§a Main!      â”‚
  â”‚     â†’ completeWork(Footer)                            â”‚
  â”‚     â†’ completeWork(App)    â† ROOT! PHASE 1 XONG!    â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  beginWork = "Báº®T Äáº¦U" xá»­ lÃ½ fiber!       â”‚      â”‚
  â”‚  â”‚  â†’ Kiá»ƒm tra updates!                        â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i render()!                            â”‚      â”‚
  â”‚  â”‚  â†’ Táº¡o child fibers!                        â”‚      â”‚
  â”‚  â”‚  â†’ Return CHILD (Ä‘i xuá»‘ng tiáº¿p!)            â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  completeWork = "HOÃ€N Táº¤T" fiber!            â”‚      â”‚
  â”‚  â”‚  â†’ Fiber ÄÃƒ Xá»¬ LÃ XONG!                   â”‚      â”‚
  â”‚  â”‚  â†’ Táº¡o/cáº­p nháº­t DOM element (nhÆ°ng CHÆ¯A      â”‚      â”‚
  â”‚  â”‚    gáº¯n vÃ o DOM tháº­t!)                        â”‚      â”‚
  â”‚  â”‚  â†’ Merge effect list LÃŠN parent!             â”‚      â”‚
  â”‚  â”‚  â†’ Return sibling hoáº·c parent!               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Phase 2: Commit â€” Uninterruptible!

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMMIT = THá»°C THI EFFECT LIST, ÃP Dá»¤NG LÃŠN DOM!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  QUÃ TRÃŒNH COMMIT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Phase Render XONG â†’ root.firstEffect chá»©a Táº¤T Cáº¢  â”‚
  â”‚  side effects cáº§n thá»±c thi!                           â”‚
  â”‚                                                        â”‚
  â”‚  Effect List (linked list!):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  next  â”Œâ”€â”€â”€â”€â”€â”€â”  next  â”Œâ”€â”€â”€â”€â”€â”€â”             â”‚
  â”‚  â”‚Logo  â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Nav   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚Footerâ”‚             â”‚
  â”‚  â”‚UPDATEâ”‚        â”‚PLACE â”‚        â”‚DELETEâ”‚             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  Commit DUYá»†T effect list, thá»±c thi 3 LOáº I:          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â‘  Placement (effectTag = 0b0000010):        â”‚      â”‚
  â”‚  â”‚     â†’ DOM node Má»šI! ChÃ¨n vÃ o DOM tree!      â”‚      â”‚
  â”‚  â”‚     â†’ parentDOM.appendChild(newDOM)           â”‚      â”‚
  â”‚  â”‚     â†’ Gá»i componentDidMount()!               â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â‘¡ Update (effectTag = 0b0000100):           â”‚      â”‚
  â”‚  â”‚     â†’ DOM node ÄÃƒ CÃ“! Cáº­p nháº­t attributes! â”‚      â”‚
  â”‚  â”‚     â†’ domNode.className = newClassName        â”‚      â”‚
  â”‚  â”‚     â†’ domNode.style = newStyle                â”‚      â”‚
  â”‚  â”‚     â†’ Gá»i componentDidUpdate()!              â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â‘¢ Deletion (effectTag = 0b0001000):         â”‚      â”‚
  â”‚  â”‚     â†’ XÃ“A DOM node!                          â”‚      â”‚
  â”‚  â”‚     â†’ parentDOM.removeChild(domNode)          â”‚      â”‚
  â”‚  â”‚     â†’ Gá»i componentWillUnmount()!            â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  + Cáº­p nháº­t refs!                             â”‚      â”‚
  â”‚  â”‚  + Cáº­p nháº­t internal state!                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  SAU KHI COMMIT XONG:                                   â”‚
  â”‚  â†’ workInProgress tree THÃ€NH current tree!             â”‚
  â”‚  â†’ current pointer Ä‘á»•i sang WIP!                      â”‚
  â”‚  â†’ UI cáº­p nháº­t!                                       â”‚
  â”‚  â†’ Phase 2 HOÃ€N Táº¤T!                                 â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ Tá»”NG THá»‚ 2 PHASES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  setState()                                             â”‚
  â”‚     â”‚                                                   â”‚
  â”‚     â–¼                                                   â”‚
  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              â”‚
  â”‚  â•‘  PHASE 1: RENDER (Interruptible!)     â•‘              â”‚
  â”‚  â•‘                                       â•‘              â”‚
  â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘              â”‚
  â”‚  â•‘  â”‚  current   â”‚    â”‚    WIP     â”‚     â•‘              â”‚
  â”‚  â•‘  â”‚   tree     â”‚â”€â”€â”€â–¶â”‚   tree     â”‚     â•‘              â”‚
  â”‚  â•‘  â”‚(khÃ´ng Ä‘á»•i!)â”‚    â”‚(Ä‘ang xÃ¢y!)â”‚     â•‘              â”‚
  â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â•‘              â”‚
  â”‚  â•‘                          â”‚             â•‘              â”‚
  â”‚  â•‘  CÃ³ thá»ƒ PAUSE/RESUME!  â”‚             â•‘              â”‚
  â”‚  â•‘  requestIdleCallback!   â”‚             â•‘              â”‚
  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ªâ•â•â•â•â•â•â•â•â•â•â•â•â•â•              â”‚
  â”‚                            â”‚                            â”‚
  â”‚                            â”‚ Effect List                â”‚
  â”‚                            â–¼                            â”‚
  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—              â”‚
  â”‚  â•‘  PHASE 2: COMMIT (Uninterruptible!)   â•‘              â”‚
  â”‚  â•‘                                       â•‘              â”‚
  â”‚  â•‘  Effect List â†’ DOM Updates!          â•‘              â”‚
  â”‚  â•‘  â†’ Placement (appendChild)           â•‘              â”‚
  â”‚  â•‘  â†’ Update (setAttribute)            â•‘              â”‚
  â”‚  â•‘  â†’ Deletion (removeChild)           â•‘              â”‚
  â”‚  â•‘  â†’ Lifecycle calls!                  â•‘              â”‚
  â”‚  â•‘                                       â•‘              â”‚
  â”‚  â•‘  Äá»’NG Bá»˜! Cháº¡y 1 LÆ¯á»¢T!            â•‘              â”‚
  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•              â”‚
  â”‚                            â”‚                            â”‚
  â”‚                            â–¼                            â”‚
  â”‚                     UI Cáº¬P NHáº¬T! âš¡                    â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. Work Loop â€” VÃ²ng Láº·p CÃ´ng Viá»‡c

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  WORK LOOP = TRÃI TIM Cá»¦A FIBER SCHEDULER!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CODE WORK LOOP (Tá»° VIáº¾T TAY Äá»‚ HIá»‚U):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // â•â•â• WORK LOOP â€” Tá»° VIáº¾T TAY! â•â•â•                 â”‚
  â”‚  // Dá»±a trÃªn nguyÃªn lÃ½ React Fiber Scheduler          â”‚
  â”‚                                                        â”‚
  â”‚  let nextUnitOfWork = null;    // Fiber tiáº¿p theo!    â”‚
  â”‚  let wipRoot = null;           // WIP root!            â”‚
  â”‚  let currentRoot = null;       // Current root!        â”‚
  â”‚  let deletions = [];           // Nodes cáº§n xÃ³a!     â”‚
  â”‚                                                        â”‚
  â”‚  // â‘  WORK LOOP â€” cháº¡y trong idle time!               â”‚
  â”‚  function workLoop(deadline) {                         â”‚
  â”‚    let shouldYield = false;                            â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¡ CÃ²n viá»‡c + cÃ²n thá»i gian â†’ lÃ m tiáº¿p!       â”‚
  â”‚    while (nextUnitOfWork && !shouldYield) {            â”‚
  â”‚      nextUnitOfWork =                                  â”‚
  â”‚        performUnitOfWork(nextUnitOfWork);              â”‚
  â”‚                                                        â”‚
  â”‚      // â‘¢ Kiá»ƒm tra: cÃ²n time khÃ´ng?                  â”‚
  â”‚      shouldYield =                                     â”‚
  â”‚        deadline.timeRemaining() < 1; // < 1ms â†’ dá»«ng!â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘£ Háº¿t viá»‡c + cÃ³ WIP root â†’ COMMIT!             â”‚
  â”‚    if (!nextUnitOfWork && wipRoot) {                   â”‚
  â”‚      commitRoot();  // Phase 2!                        â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¤ CÃ²n viá»‡c? LÃªn lá»‹ch tiáº¿p!                    â”‚
  â”‚    requestIdleCallback(workLoop);                      â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  // â‘¥ Báº®T Äáº¦U! LÃªn lá»‹ch work loop!                 â”‚
  â”‚  requestIdleCallback(workLoop);                        â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â‘¦ Xá»¬ LÃ 1 FIBER!                                â”‚
  â”‚  function performUnitOfWork(fiber) {                   â”‚
  â”‚    // A. beginWork: xá»­ lÃ½ fiber hiá»‡n táº¡i!            â”‚
  â”‚    //    â†’ Gá»i render(), táº¡o child fibers!           â”‚
  â”‚    beginWork(fiber);                                   â”‚
  â”‚                                                        â”‚
  â”‚    // B. CÃ³ child? â†’ return child!                    â”‚
  â”‚    if (fiber.child) {                                  â”‚
  â”‚      return fiber.child;                               â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // C. KhÃ´ng child â†’ completeWork + tÃ¬m tiáº¿p!     â”‚
  â”‚    let nextFiber = fiber;                              â”‚
  â”‚    while (nextFiber) {                                 â”‚
  â”‚      // HoÃ n táº¥t fiber nÃ y!                          â”‚
  â”‚      completeWork(nextFiber);                          â”‚
  â”‚                                                        â”‚
  â”‚      // CÃ³ sibling? â†’ return sibling!                 â”‚
  â”‚      if (nextFiber.sibling) {                          â”‚
  â”‚        return nextFiber.sibling;                       â”‚
  â”‚      }                                                 â”‚
  â”‚                                                        â”‚
  â”‚      // Return lÃªn parent!                             â”‚
  â”‚      nextFiber = nextFiber.return;                     â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // D. Return Ä‘áº¿n null (root) â†’ XONG PHASE 1!     â”‚
  â”‚    return null;                                        â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ WORK LOOP TIMELINE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Frame 1 (16.67ms):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ Browser  â”‚   â”‚ Idle time (5ms)          â”‚           â”‚
  â”‚  â”‚ work     â”‚   â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”         â”‚           â”‚
  â”‚  â”‚ (12ms)   â”‚   â”‚ â”‚ A  â”‚ B  â”‚ C  â”‚ yield! â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜         â”‚           â”‚
  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                    3 fibers processed!                   â”‚
  â”‚                                                        â”‚
  â”‚  Frame 2 (16.67ms):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ Browser  â”‚   â”‚ Idle time (8ms)          â”‚           â”‚
  â”‚  â”‚ work     â”‚   â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”    â”‚           â”‚
  â”‚  â”‚ (9ms)    â”‚   â”‚ â”‚ D  â”‚ E  â”‚ F  â”‚ G  â”‚   â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜    â”‚           â”‚
  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                    4 fibers processed!                   â”‚
  â”‚                                                        â”‚
  â”‚  Frame 3 (16.67ms):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
  â”‚  â”‚ Browser  â”‚   â”‚ Idle time (6ms)          â”‚           â”‚
  â”‚  â”‚ work     â”‚   â”‚ â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚           â”‚
  â”‚  â”‚ (11ms)   â”‚   â”‚ â”‚ H  â”‚doneâ”‚ COMMIT!  â”‚   â”‚           â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚           â”‚
  â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
  â”‚                    Phase 1 done â†’ Commit!               â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ KHÃ”NG Máº¤T FRAME NÃ€O!                              â”‚
  â”‚  â†’ Má»—i frame xá»­ lÃ½ vÃ i fibers!                       â”‚
  â”‚  â†’ Yield khi háº¿t time â†’ browser render animation!    â”‚
  â”‚  â†’ Smooth 60fps!                                       â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. requestIdleCallback â€” Lá»‹ch TrÃ¬nh Há»£p TÃ¡c

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  requestIdleCallback = "Gá»ŒI TÃ”I KHI Ráº¢NH NHÃ‰!"
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CÃCH HOáº T Äá»˜NG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  window.requestIdleCallback(callback, { timeout })     â”‚
  â”‚                                                        â”‚
  â”‚  â†’ ÄÄƒng kÃ½ callback cháº¡y trong IDLE TIME!            â”‚
  â”‚  â†’ Browser gá»i callback khi Ráº¢NH!                    â”‚
  â”‚  â†’ callback nháº­n idleDeadline object:                 â”‚
  â”‚    â†’ timeRemaining(): cÃ²n bao nhiÃªu ms?              â”‚
  â”‚    â†’ didTimeout: cÃ³ timeout chÆ°a?                    â”‚
  â”‚                                                        â”‚
  â”‚  1 FRAME (16.67ms):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚ Input â”‚ Style â”‚ Layout â”‚ Paint â”‚   IDLE   â”‚        â”‚
  â”‚  â”‚  2ms  â”‚  2ms  â”‚  3ms   â”‚  3ms  â”‚ â† Ráº¢Ì‰NH! â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚  â”‚â—€â”€â”€â”€â”€ Browser work (10ms) â”€â”€â”€â”€â–¶â”‚â—€ 6.67ms â–¶â”‚        â”‚
  â”‚                                    â†‘                    â”‚
  â”‚                                    â”‚                    â”‚
  â”‚                           requestIdleCallback           â”‚
  â”‚                           cháº¡y á»Ÿ ÄÃ‚Y!                â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ ThÆ°á»ng cÃ³ 10-50ms idle time!                      â”‚
  â”‚  â†’ Äá»§ Ä‘á»ƒ xá»­ lÃ½ vÃ i fiber nodes!                     â”‚
  â”‚  â†’ Háº¿t time â†’ yield â†’ frame tiáº¿p!                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  VÃ Dá»¤ Tá»° VIáº¾T TAY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // â‘  ÄÄƒng kÃ½ idle callback!                          â”‚
  â”‚  const handle = requestIdleCallback(                   â”‚
  â”‚    (idleDeadline) => {                                 â”‚
  â”‚      // â‘¡ Kiá»ƒm tra: cÃ³ timeout khÃ´ng?                â”‚
  â”‚      console.log(                                      â”‚
  â”‚        `Timeout? ${idleDeadline.didTimeout}`            â”‚
  â”‚      ); // false                                       â”‚
  â”‚                                                        â”‚
  â”‚      // â‘¢ Kiá»ƒm tra: cÃ²n bao nhiÃªu time?             â”‚
  â”‚      console.log(                                      â”‚
  â”‚        `CÃ²n ${idleDeadline.timeRemaining()}ms`         â”‚
  â”‚      ); // ~49ms                                       â”‚
  â”‚                                                        â”‚
  â”‚      // â‘£ LÃ m viá»‡c (xá»­ lÃ½ fibers!)                  â”‚
  â”‚      processNextFiber();                               â”‚
  â”‚                                                        â”‚
  â”‚      // â‘¤ Kiá»ƒm tra láº¡i!                              â”‚
  â”‚      console.log(                                      â”‚
  â”‚        `CÃ²n ${idleDeadline.timeRemaining()}ms`         â”‚
  â”‚      ); // ~38ms                                       â”‚
  â”‚    },                                                  â”‚
  â”‚    { timeout: 1000 } // Tá»‘i Ä‘a Ä‘á»£i 1 giÃ¢y!          â”‚
  â”‚  );                                                    â”‚
  â”‚                                                        â”‚
  â”‚  // â‘¥ Há»§y náº¿u cáº§n!                                  â”‚
  â”‚  cancelIdleCallback(handle);                           â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  âš  LÆ¯U Ã QUAN TRá»ŒNG:                                â”‚
  â”‚  â†’ React KHÃ”NG dÃ¹ng requestIdleCallback trá»±c tiáº¿p!  â”‚
  â”‚  â†’ React Tá»° VIáº¾T scheduler riÃªng!                    â”‚
  â”‚  â†’ VÃ¬ requestIdleCallback:                            â”‚
  â”‚    â†’ Browser support chÆ°a Ä‘áº§y Ä‘á»§!                   â”‚
  â”‚    â†’ Chá»‰ ~20fps (gá»i 1 láº§n/frame!)                 â”‚
  â”‚    â†’ KhÃ´ng Ä‘á»§ má»‹n cho React!                        â”‚
  â”‚  â†’ React dÃ¹ng MessageChannel + requestAnimationFrame  â”‚
  â”‚    Ä‘á»ƒ tá»± scheduler!                                   â”‚
  â”‚  â†’ NHÆ¯NG NGUYÃŠN LÃ GIá»NG Há»†T!                      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  COOPERATIVE SCHEDULING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  COOPERATIVE = "Há»¢P TÃC"!                             â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Task Tá»° NGUYá»†N tráº£ quyá»n cho main thread!        â”‚
  â”‚  â†’ KHÃ”NG bá»‹ OS cÆ°á»¡ng cháº¿!                           â”‚
  â”‚  â†’ Giá»‘ng nhÆ°: "TÃ´i lÃ m xong pháº§n mÃ¬nh,              â”‚
  â”‚    giá» anh lÃ m Ä‘i!" (nhÆ°á»ng nhau!)                   â”‚
  â”‚                                                        â”‚
  â”‚  3 CHIáº¾N LÆ¯á»¢C SCHEDULING:                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ â‘  Preemptive (Æ¯u tiÃªn trÆ°á»›c):              â”‚      â”‚
  â”‚  â”‚    â†’ OS cÆ°á»¡ng cháº¿ dá»«ng task!                â”‚      â”‚
  â”‚  â”‚    â†’ Task KHÃ”NG kiá»ƒm soÃ¡t Ä‘Æ°á»£c!             â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚ â‘¡ Cooperative (Há»£p tÃ¡c): â† FIBER DÃ™NG CÃI NÃ€Y!â”‚  â”‚
  â”‚  â”‚    â†’ Task Tá»° NGUYá»†N dá»«ng!                   â”‚      â”‚
  â”‚  â”‚    â†’ Task kiá»ƒm tra time rá»“i yield!           â”‚      â”‚
  â”‚  â”‚    â†’ Firefox cÅ©ng dÃ¹ng cho real DOM!         â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚ â‘¢ FIFO (First In First Out):                 â”‚      â”‚
  â”‚  â”‚    â†’ HÃ ng Ä‘á»£i Ä‘Æ¡n giáº£n!                    â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§12. Priority Strategy â€” 6 Má»©c Äá»™ Æ¯u TiÃªn

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIBER CÃ“ 6 Má»¨C Äá»˜ Æ¯U TIÃŠN!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  6 PRIORITY LEVELS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Prio â”‚ TÃªn          â”‚ MÃ´ táº£                    â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  1   â”‚ Synchronous  â”‚ Giá»‘ng Stack reconciler!   â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Cháº¡y Äá»’NG Bá»˜, block!    â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ DÃ¹ng cho INITIAL RENDER!  â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  2   â”‚ Task         â”‚ TrÆ°á»›c tick tiáº¿p theo!    â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Xá»­ lÃ½ NGAY SAU event!   â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  3   â”‚ Animation    â”‚ TrÆ°á»›c frame tiáº¿p theo!   â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ requestAnimationFrame!    â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Animation MÆ¯á»¢T!          â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  4   â”‚ High         â”‚ Keyboard input!           â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Cáº§n pháº£n há»“i NGAY!      â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ ~100ms deadline!           â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  5   â”‚ Low          â”‚ Network request!          â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Cháº­m 100-200ms OK!       â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Hiá»ƒn thá»‹ comments...     â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚  6   â”‚ Offscreen    â”‚ Element KHÃ”NG tháº¥y!      â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Render khi scroll tá»›i!   â”‚   â”‚
  â”‚  â”‚      â”‚              â”‚ Æ¯u tiÃªn THáº¤P NHáº¤T!     â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ Æ¯U TIÃŠN:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  Synchronous â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (CAO NHáº¤T!) â”‚      â”‚
  â”‚  â”‚  Task        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  â”‚      â”‚
  â”‚  â”‚  Animation   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  â”‚      â”‚
  â”‚  â”‚  High        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚      â”‚
  â”‚  â”‚  Low         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                          â”‚      â”‚
  â”‚  â”‚  Offscreen   â–ˆâ–ˆâ–ˆâ–ˆ              (THáº¤P NHáº¤T!)   â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ğŸ’¡ High-priority task CÃ“ THá»‚ CHEN NGANG!   â”‚      â”‚
  â”‚  â”‚  â†’ User Ä‘ang gÃµ keyboard (High priority!)   â”‚      â”‚
  â”‚  â”‚  â†’ React Ä‘ang render comments (Low!)         â”‚      â”‚
  â”‚  â”‚  â†’ NGá»ªNG comments! Æ¯U TIÃŠN keyboard!       â”‚      â”‚
  â”‚  â”‚  â†’ Xong keyboard â†’ tiáº¿p tá»¥c comments!       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  2 Váº¤N Äá»€ Cá»¦A PRIORITY:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âŒ â‘  Lifecycle gá»i NHIá»€U Láº¦N:              â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  VÃ Dá»¤:                                      â”‚      â”‚
  â”‚  â”‚  Low priority (A) báº¯t Ä‘áº§u:                  â”‚      â”‚
  â”‚  â”‚  â†’ componentWillUpdate() gá»i!               â”‚      â”‚
  â”‚  â”‚  â†’ ...Ä‘ang render...                         â”‚      â”‚
  â”‚  â”‚  â†’ High priority (B) CHEN NGANG!            â”‚      â”‚
  â”‚  â”‚  â†’ A bá»‹ Há»¦Y! componentWillUpdate Ä‘Ã£ gá»i!  â”‚      â”‚
  â”‚  â”‚  â†’ B cháº¡y xong!                              â”‚      â”‚
  â”‚  â”‚  â†’ A Báº®T Äáº¦U Láº I!                         â”‚      â”‚
  â”‚  â”‚  â†’ componentWillUpdate() gá»i Láº¦N 2!        â”‚      â”‚
  â”‚  â”‚  â†’ componentDidUpdate() gá»i 1 Láº¦N (commit!)â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  ğŸ’¡ ÄÃ¢y lÃ  lÃ½ do React DEPRECATED:          â”‚      â”‚
  â”‚  â”‚  â†’ componentWillMount                        â”‚      â”‚
  â”‚  â”‚  â†’ componentWillReceiveProps                  â”‚      â”‚
  â”‚  â”‚  â†’ componentWillUpdate                        â”‚      â”‚
  â”‚  â”‚  â†’ VÃ¬ chÃºng cÃ³ thá»ƒ gá»i NHIá»€U Láº¦N!        â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âŒ â‘¡ Starvation (Ä‘Ã³i!):                    â”‚      â”‚
  â”‚  â”‚  â†’ QuÃ¡ nhiá»u high-priority tasks!            â”‚      â”‚
  â”‚  â”‚  â†’ Low-priority KHÃ”NG BAO GIá»œ cháº¡y!        â”‚      â”‚
  â”‚  â”‚  â†’ Giáº£i phÃ¡p: expiration time!               â”‚      â”‚
  â”‚  â”‚    â†’ Äá»£i quÃ¡ lÃ¢u â†’ Tá»° NÃ‚NG priority!      â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§13. Effect List â€” Thu Tháº­p Káº¿t Quáº£

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  EFFECT LIST = DANH SÃCH SIDE EFFECTS Cáº¦N THá»°C THI!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CÃCH THU THáº¬P:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Má»—i fiber cÃ³:                                         â”‚
  â”‚  â†’ effectTag: loáº¡i effect (Placement/Update/Deletion) â”‚
  â”‚  â†’ firstEffect: â†’ effect Äáº¦U TIÃŠN trong list        â”‚
  â”‚  â†’ lastEffect: â†’ effect CUá»I CÃ™NG trong list         â”‚
  â”‚  â†’ nextEffect: â†’ effect TIáº¾P THEO                    â”‚
  â”‚                                                        â”‚
  â”‚  Khi completeWork(fiber):                              â”‚
  â”‚  â†’ Merge effect list Cá»¦A fiber LÃŠN parent (return)!  â”‚
  â”‚  â†’ parent.lastEffect.nextEffect = fiber.firstEffect!  â”‚
  â”‚  â†’ Náº¿u fiber CÃ“ effect â†’ thÃªm fiber vÃ o cuá»‘i!      â”‚
  â”‚                                                        â”‚
  â”‚  Káº¾T QUáº¢: root.firstEffect = Äáº¦U linked list!       â”‚
  â”‚  â†’ Duyá»‡t tá»« firstEffect â†’ nextEffect â†’ ... â†’ null!  â”‚
  â”‚  â†’ = Táº¤T Cáº¢ side effects trong cÃ¢y!                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  SÆ  Äá»’ MERGE EFFECT LIST:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Fiber Tree:                                            â”‚
  â”‚       App                                               â”‚
  â”‚      / | \                                              â”‚
  â”‚    A   B   C                                            â”‚
  â”‚   /|       |                                            â”‚
  â”‚  D  E      F                                            â”‚
  â”‚                                                        â”‚
  â”‚  Giáº£ sá»­ D(Update), E(Placement), B(Update), F(Delete)â”‚
  â”‚                                                        â”‚
  â”‚  â‘  completeWork(D):                                   â”‚
  â”‚     D.effectTag = Update                               â”‚
  â”‚     A.firstEffect = D, A.lastEffect = D               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ completeWork(E):                                   â”‚
  â”‚     E.effectTag = Placement                             â”‚
  â”‚     D.nextEffect = E                                   â”‚
  â”‚     A.lastEffect = E                                   â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ completeWork(A): (A khÃ´ng cÃ³ effect)               â”‚
  â”‚     App.firstEffect = D (merge A's list!)              â”‚
  â”‚     App.lastEffect = E                                 â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ completeWork(B):                                   â”‚
  â”‚     B.effectTag = Update                               â”‚
  â”‚     E.nextEffect = B                                   â”‚
  â”‚     App.lastEffect = B                                 â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ completeWork(F):                                   â”‚
  â”‚     F.effectTag = Deletion                              â”‚
  â”‚     C.firstEffect = F, C.lastEffect = F               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ completeWork(C): (C khÃ´ng cÃ³ effect)               â”‚
  â”‚     B.nextEffect = F (merge C's list!)                 â”‚
  â”‚     App.lastEffect = F                                 â”‚
  â”‚                                                        â”‚
  â”‚  Káº¾T QUáº¢ EFFECT LIST Táº I ROOT:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”  next  â”Œâ”€â”€â”€â”  next  â”Œâ”€â”€â”€â”  next  â”Œâ”€â”€â”€â”        â”‚
  â”‚  â”‚ D â”œâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚ E â”œâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚ B â”œâ”€â”€â”€â”€â”€â”€â”€â–¶â”‚ F â”‚        â”‚
  â”‚  â”‚UPDâ”‚        â”‚PLMâ”‚        â”‚UPDâ”‚        â”‚DELâ”‚        â”‚
  â”‚  â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜        â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Commit phase duyá»‡t list nÃ y, thá»±c thi tá»«ng cÃ¡i! â”‚
  â”‚  â†’ CHá»ˆ xá»­ lÃ½ nodes CÃ“ effect!                       â”‚
  â”‚  â†’ Nodes KHÃ”NG thay Ä‘á»•i = Bá» QUA!                   â”‚
  â”‚  â†’ HIá»†U QUáº¢ hÆ¡n duyá»‡t cáº£ cÃ¢y!                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§14. Lifecycle Hooks Trong Fiber

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  LIFECYCLE Bá»Š CHIA 2 PHASE â€” CÃ“ HOOK Bá»Š DEPRECATED!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CHIA THEO PHASE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â•â•â• PHASE 1: RENDER (CÃ“ THá»‚ Gá»ŒI NHIá»€U Láº¦N!) â•â•â•   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  âš  DEPRECATED (KHÃ”NG AN TOÃ€N!):             â”‚      â”‚
  â”‚  â”‚  âŒ componentWillMount                       â”‚      â”‚
  â”‚  â”‚  âŒ componentWillReceiveProps                 â”‚      â”‚
  â”‚  â”‚  âŒ componentWillUpdate                       â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i NHIá»€U Láº¦N náº¿u bá»‹ interrupt!          â”‚      â”‚
  â”‚  â”‚  â†’ Side effects sáº½ cháº¡y NHIá»€U Láº¦N!         â”‚      â”‚
  â”‚  â”‚  â†’ fetch API â†’ gá»i 3 láº§n = 3 requests!     â”‚      â”‚
  â”‚  â”‚  â†’ setState â†’ loop vÃ´ háº¡n!                 â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âœ… AN TOÃ€N (dÃ¹ng thay tháº¿!):                â”‚      â”‚
  â”‚  â”‚  âœ… constructor()                             â”‚      â”‚
  â”‚  â”‚  âœ… static getDerivedStateFromProps()         â”‚      â”‚
  â”‚  â”‚  âœ… shouldComponentUpdate()                   â”‚      â”‚
  â”‚  â”‚  âœ… render()                                  â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ PURE functions! KhÃ´ng side effects!        â”‚      â”‚
  â”‚  â”‚  â†’ Gá»i nhiá»u láº§n = Káº¾T QUáº¢ GIá»NG NHAU!    â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• PHASE 2: COMMIT (CHá»ˆ Gá»ŒI 1 Láº¦N!) â•â•â•           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  âœ… componentDidMount()                       â”‚      â”‚
  â”‚  â”‚  âœ… componentDidUpdate()                      â”‚      â”‚
  â”‚  â”‚  âœ… componentWillUnmount()                    â”‚      â”‚
  â”‚  â”‚  âœ… getSnapshotBeforeUpdate()                 â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  â†’ AN TOÃ€N cho side effects!                 â”‚      â”‚
  â”‚  â”‚  â†’ fetch API, subscriptions, DOM access!      â”‚      â”‚
  â”‚  â”‚  â†’ CHá»ˆ gá»i 1 láº§n!                           â”‚      â”‚
  â”‚  â”‚  â†’ Phase nÃ y KHÃ”NG bá»‹ interrupt!              â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ UPGRADE PATH:                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âŒ componentWillMount                        â”‚      â”‚
  â”‚  â”‚  â†’ âœ… constructor() + componentDidMount()    â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âŒ componentWillReceiveProps                  â”‚      â”‚
  â”‚  â”‚  â†’ âœ… static getDerivedStateFromProps()      â”‚      â”‚
  â”‚  â”‚  â†’ âœ… componentDidUpdate()                   â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â”‚  âŒ componentWillUpdate                        â”‚      â”‚
  â”‚  â”‚  â†’ âœ… getSnapshotBeforeUpdate()              â”‚      â”‚
  â”‚  â”‚  â†’ âœ… componentDidUpdate()                   â”‚      â”‚
  â”‚  â”‚                                               â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§15. Tá»± Viáº¿t Tay Mini Fiber Scheduler

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Tá»° VIáº¾T TAY MINI FIBER Äá»‚ HIá»‚U NGUYÃŠN LÃ!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  CODE HOÃ€N CHá»ˆNH â€” MINI FIBER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 1: Táº¡o Fiber Node â•â•â•                   â”‚
  â”‚  function createFiber(type, props, ...children) {      â”‚
  â”‚    return {                                            â”‚
  â”‚      type,                                             â”‚
  â”‚      props: {                                          â”‚
  â”‚        ...props,                                       â”‚
  â”‚        children: children.map(child =>                 â”‚
  â”‚          typeof child === 'object'                     â”‚
  â”‚            ? child                                     â”‚
  â”‚            : createTextFiber(child)                    â”‚
  â”‚        ),                                              â”‚
  â”‚      },                                                â”‚
  â”‚    };                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  function createTextFiber(text) {                      â”‚
  â”‚    return {                                            â”‚
  â”‚      type: 'TEXT_ELEMENT',                             â”‚
  â”‚      props: { nodeValue: text, children: [] },         â”‚
  â”‚    };                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 2: Render â€” Báº¯t Ä‘áº§u Work Loop â•â•â•      â”‚
  â”‚  let nextUnitOfWork = null;                            â”‚
  â”‚  let wipRoot = null;                                   â”‚
  â”‚  let currentRoot = null;                               â”‚
  â”‚  let deletions = null;                                 â”‚
  â”‚                                                        â”‚
  â”‚  function render(element, container) {                  â”‚
  â”‚    // Táº¡o root fiber!                                 â”‚
  â”‚    wipRoot = {                                         â”‚
  â”‚      dom: container,                                   â”‚
  â”‚      props: { children: [element] },                   â”‚
  â”‚      alternate: currentRoot, // â† double buffering!  â”‚
  â”‚    };                                                  â”‚
  â”‚    deletions = [];                                     â”‚
  â”‚    nextUnitOfWork = wipRoot;                           â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 3: Work Loop â•â•â•                        â”‚
  â”‚  function workLoop(deadline) {                         â”‚
  â”‚    let shouldYield = false;                            â”‚
  â”‚                                                        â”‚
  â”‚    while (nextUnitOfWork && !shouldYield) {            â”‚
  â”‚      nextUnitOfWork =                                  â”‚
  â”‚        performUnitOfWork(nextUnitOfWork);              â”‚
  â”‚      shouldYield = deadline.timeRemaining() < 1;       â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // Phase 1 xong â†’ commit!                          â”‚
  â”‚    if (!nextUnitOfWork && wipRoot) {                   â”‚
  â”‚      commitRoot();                                     â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    requestIdleCallback(workLoop);                      â”‚
  â”‚  }                                                     â”‚
  â”‚  requestIdleCallback(workLoop);                        â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 4: Perform Unit of Work â•â•â•             â”‚
  â”‚  function performUnitOfWork(fiber) {                   â”‚
  â”‚    // â‘  Táº¡o DOM node náº¿u chÆ°a cÃ³!                   â”‚
  â”‚    if (!fiber.dom) {                                   â”‚
  â”‚      fiber.dom = createDom(fiber);                     â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¡ Reconcile children â†’ táº¡o child fibers!      â”‚
  â”‚    const elements = fiber.props.children;              â”‚
  â”‚    reconcileChildren(fiber, elements);                  â”‚
  â”‚                                                        â”‚
  â”‚    // â‘¢ Tráº£ vá» fiber TIáº¾P THEO!                     â”‚
  â”‚    // â†’ child â†’ sibling â†’ uncle (return.sibling)    â”‚
  â”‚    if (fiber.child) return fiber.child;                â”‚
  â”‚                                                        â”‚
  â”‚    let nextFiber = fiber;                              â”‚
  â”‚    while (nextFiber) {                                 â”‚
  â”‚      if (nextFiber.sibling) return nextFiber.sibling;  â”‚
  â”‚      nextFiber = nextFiber.return;                     â”‚
  â”‚    }                                                   â”‚
  â”‚    return null;                                        â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 5: Reconcile Children (DIFF!) â•â•â•       â”‚
  â”‚  function reconcileChildren(wipFiber, elements) {      â”‚
  â”‚    let index = 0;                                      â”‚
  â”‚    let oldFiber =                                      â”‚
  â”‚      wipFiber.alternate &&                             â”‚
  â”‚      wipFiber.alternate.child;                         â”‚
  â”‚    let prevSibling = null;                             â”‚
  â”‚                                                        â”‚
  â”‚    while (index < elements.length || oldFiber) {       â”‚
  â”‚      const element = elements[index];                  â”‚
  â”‚      let newFiber = null;                              â”‚
  â”‚                                                        â”‚
  â”‚      const sameType =                                  â”‚
  â”‚        oldFiber &&                                     â”‚
  â”‚        element &&                                      â”‚
  â”‚        element.type === oldFiber.type;                 â”‚
  â”‚                                                        â”‚
  â”‚      // â‘  CÃ™NG type â†’ UPDATE!                        â”‚
  â”‚      if (sameType) {                                   â”‚
  â”‚        newFiber = {                                    â”‚
  â”‚          type: oldFiber.type,                          â”‚
  â”‚          props: element.props,                         â”‚
  â”‚          dom: oldFiber.dom,        // TÃI Sá»¬ Dá»¤NG!  â”‚
  â”‚          return: wipFiber,                             â”‚
  â”‚          alternate: oldFiber,      // DOUBLE BUFFER!  â”‚
  â”‚          effectTag: 'UPDATE',                          â”‚
  â”‚        };                                              â”‚
  â”‚      }                                                 â”‚
  â”‚                                                        â”‚
  â”‚      // â‘¡ KHÃC type + cÃ³ element â†’ THÃŠM Má»šI!       â”‚
  â”‚      if (element && !sameType) {                       â”‚
  â”‚        newFiber = {                                    â”‚
  â”‚          type: element.type,                           â”‚
  â”‚          props: element.props,                         â”‚
  â”‚          dom: null,                // Táº O Má»šI!       â”‚
  â”‚          return: wipFiber,                             â”‚
  â”‚          alternate: null,                              â”‚
  â”‚          effectTag: 'PLACEMENT',                       â”‚
  â”‚        };                                              â”‚
  â”‚      }                                                 â”‚
  â”‚                                                        â”‚
  â”‚      // â‘¢ KHÃC type + cÃ³ oldFiber â†’ XÃ“A!           â”‚
  â”‚      if (oldFiber && !sameType) {                      â”‚
  â”‚        oldFiber.effectTag = 'DELETION';                â”‚
  â”‚        deletions.push(oldFiber);                       â”‚
  â”‚      }                                                 â”‚
  â”‚                                                        â”‚
  â”‚      // Linked list!                                    â”‚
  â”‚      if (index === 0) {                                â”‚
  â”‚        wipFiber.child = newFiber;                      â”‚
  â”‚      } else if (element) {                             â”‚
  â”‚        prevSibling.sibling = newFiber;                 â”‚
  â”‚      }                                                 â”‚
  â”‚                                                        â”‚
  â”‚      prevSibling = newFiber;                           â”‚
  â”‚      if (oldFiber) oldFiber = oldFiber.sibling;        â”‚
  â”‚      index++;                                          â”‚
  â”‚    }                                                   â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚                                                        â”‚
  â”‚  // â•â•â• BÆ¯á»šC 6: Commit (Phase 2!) â•â•â•                â”‚
  â”‚  function commitRoot() {                               â”‚
  â”‚    deletions.forEach(commitWork);                      â”‚
  â”‚    commitWork(wipRoot.child);                          â”‚
  â”‚    currentRoot = wipRoot;   // â† SWAP!               â”‚
  â”‚    wipRoot = null;                                     â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  function commitWork(fiber) {                          â”‚
  â”‚    if (!fiber) return;                                 â”‚
  â”‚                                                        â”‚
  â”‚    const parentDom = fiber.return.dom;                  â”‚
  â”‚                                                        â”‚
  â”‚    if (fiber.effectTag === 'PLACEMENT' && fiber.dom) { â”‚
  â”‚      parentDom.appendChild(fiber.dom);                 â”‚
  â”‚    } else if (fiber.effectTag === 'UPDATE') {          â”‚
  â”‚      updateDom(fiber.dom, fiber.alternate.props,       â”‚
  â”‚                fiber.props);                            â”‚
  â”‚    } else if (fiber.effectTag === 'DELETION') {        â”‚
  â”‚      parentDom.removeChild(fiber.dom);                 â”‚
  â”‚    }                                                   â”‚
  â”‚                                                        â”‚
  â”‚    commitWork(fiber.child);                            â”‚
  â”‚    commitWork(fiber.sibling);                          â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§16. So SÃ¡nh: Stack Reconciler vs Fiber Reconciler

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Báº¢NG SO SÃNH TOÃ€N DIá»†N!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                 â”‚Stack          â”‚Fiber           â”‚  â”‚
  â”‚  â”‚                 â”‚(React â‰¤15)   â”‚(React 16+)    â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Thuáº­t toÃ¡n      â”‚ Äá»† QUY       â”‚ VÃ’NG Láº¶P     â”‚  â”‚
  â”‚  â”‚                 â”‚ (recursive)   â”‚ (iterative)    â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Interruptible?  â”‚ KHÃ”NG!        â”‚ CÃ“! (Phase 1) â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Context lÆ°u    â”‚ System call   â”‚ Fiber objects  â”‚  â”‚
  â”‚  â”‚   á»Ÿ Ä‘Ã¢u?      â”‚ stack         â”‚ (linked list)  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Cáº¥u trÃºc cÃ¢y  â”‚ Array         â”‚ Singly linked  â”‚  â”‚
  â”‚  â”‚                 â”‚ children      â”‚ list (child,   â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ sibling,return)â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Priority?       â”‚ KHÃ”NG!        â”‚ 6 levels!      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Animation       â”‚ GIáº¬T LAG!    â”‚ MÆ¯á»¢T 60fps!  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Double buffer?  â”‚ KHÃ”NG!        â”‚ CÃ“! current + â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ workInProgress â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Error boundary  â”‚ Háº N CHáº¾     â”‚ Äáº¦Y Äá»¦!     â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ render() tráº£  â”‚ 1 element     â”‚ Arrays,        â”‚  â”‚
  â”‚  â”‚ vá»            â”‚ DUY NHáº¤T!    â”‚ fragments,     â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ strings!       â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Source code     â”‚ mountComponentâ”‚ beginWork/     â”‚  â”‚
  â”‚  â”‚                 â”‚ updateComp.   â”‚ completeWork/  â”‚  â”‚
  â”‚  â”‚                 â”‚               â”‚ commitWork     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§17. Best Practices & Phá»ng Váº¥n Q&A

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CÃ‚U Há»I PHá»NG Váº¤N Vá»€ REACT FIBER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Q1: React Fiber lÃ  gÃ¬? Giáº£i quyáº¿t váº¥n Ä‘á» gÃ¬?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: React Fiber lÃ  dá»± Ã¡n tÃ¡i cáº¥u trÃºc CORE ALGORITHM â”‚
  â”‚  cá»§a React, thay tháº¿ Stack Reconciler báº±ng Fiber      â”‚
  â”‚  Reconciler. Stack Reconciler dÃ¹ng Äá»† QUY Ä‘á»“ng bá»™, â”‚
  â”‚  chiáº¿m main thread liá»n máº¡ch, gÃ¢y giáº­t lag. Fiber    â”‚
  â”‚  chuyá»ƒn sang VÃ’NG Láº¶P, chia nhá» rendering thÃ nh     â”‚
  â”‚  cÃ¡c unit of work, xá»­ lÃ½ tá»«ng fiber node/láº§n, cÃ³    â”‚
  â”‚  thá»ƒ Dá»ªNG + TIáº¾P Tá»¤C, nhÆ°á»ng main thread cho        â”‚
  â”‚  browser render animation vÃ  xá»­ lÃ½ input.            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q2: Fiber tree khÃ¡c gÃ¬ vDOM tree?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Fiber tree xÃ¢y dá»±ng trÃªn ná»n vDOM tree nhÆ°ng      â”‚
  â”‚  dÃ¹ng Singly Linked List (child, sibling, return)      â”‚
  â”‚  thay vÃ¬ array children. ThÃªm thÃ´ng tin scheduling:    â”‚
  â”‚  effectTag (Placement/Update/Deletion), effect list,   â”‚
  â”‚  expirationTime (priority), alternate (double buffer), â”‚
  â”‚  stateNode (DOM/component instance). Cho phÃ©p duyá»‡t  â”‚
  â”‚  báº±ng vÃ²ng láº·p thay vÃ¬ Ä‘á»‡ quy â†’ dá»«ng Ä‘Æ°á»£c!        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q3: 2 phase cá»§a Fiber Reconciler lÃ  gÃ¬?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Phase 1 (Render/Reconciliation): CÃ“ THá»‚ NGáº®T!   â”‚
  â”‚  XÃ¢y workInProgress tree, diff tÃ¬m khÃ¡c biá»‡t, thu   â”‚
  â”‚  tháº­p effect list. KHÃ”NG Ä‘á»¥ng DOM. Lifecycle: render, â”‚
  â”‚  shouldComponentUpdate, getDerivedStateFromProps.       â”‚
  â”‚  Phase 2 (Commit): KHÃ”NG THá»‚ NGáº®T! Duyá»‡t effect    â”‚
  â”‚  list, thá»±c thi DOM changes (add/update/remove),       â”‚
  â”‚  gá»i componentDidMount/Update/WillUnmount. Cháº¡y      â”‚
  â”‚  Ä‘á»“ng bá»™ 1 lÆ°á»£t vÃ¬ DOM pháº£i consistent.             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q4: Double buffering trong Fiber lÃ  gÃ¬?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: React duy trÃ¬ 2 fiber trees: current (Ä‘ang hiá»ƒn  â”‚
  â”‚  thá»‹) vÃ  workInProgress (Ä‘ang xÃ¢y). Má»—i fiber cÃ³    â”‚
  â”‚  alternate pointer trá» sang báº£n sao á»Ÿ cÃ¢y kia.      â”‚
  â”‚  Sau commit, WIP thÃ nh current (Ä‘á»•i pointer), cÃ¢y   â”‚
  â”‚  current cÅ© thÃ nh "dá»± trá»¯" cho WIP láº§n sau. TÃI     â”‚
  â”‚  Sá»¬ Dá»¤NG fiber objects â†’ tiáº¿t kiá»‡m memory vÃ  GC.    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q5: Táº¡i sao componentWillMount bá»‹ deprecated?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Trong Fiber, Phase 1 (render) CÃ“ THá»‚ Bá»Š NGáº®T   â”‚
  â”‚  bá»Ÿi high-priority task. Khi ngáº¯t, Phase 1 cháº¡y láº¡i â”‚
  â”‚  â†’ componentWillMount/WillReceiveProps/WillUpdate     â”‚
  â”‚  Gá»ŒI NHIá»€U Láº¦N! Side effects (fetch API, setState)  â”‚
  â”‚  sáº½ thá»±c thi NHIá»€U Láº¦N â†’ bugs! Thay báº±ng:          â”‚
  â”‚  getDerivedStateFromProps (static, pure) cho Phase 1,  â”‚
  â”‚  componentDidMount/Update (Phase 2, chá»‰ 1 láº§n).      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q6: requestIdleCallback trong Fiber hoáº¡t Ä‘á»™ng tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: NGUYÃŠN LÃ: browser gá»i callback khi main thread â”‚
  â”‚  Ráº¢NH (idle time trong má»—i frame ~5-50ms). React     â”‚
  â”‚  dÃ¹ng nguyÃªn lÃ½ nÃ y Ä‘á»ƒ schedule work loop: xá»­ lÃ½    â”‚
  â”‚  fiber â†’ kiá»ƒm tra deadline.timeRemaining() â†’ háº¿t    â”‚
  â”‚  time thÃ¬ yield, lÃªn lá»‹ch callback tiáº¿p. NHÆ¯NG      â”‚
  â”‚  thá»±c táº¿ React KHÃ”NG dÃ¹ng requestIdleCallback trá»±c   â”‚
  â”‚  tiáº¿p (browser support kÃ©m, chá»‰ 20fps). React tá»±    â”‚
  â”‚  viáº¿t scheduler dÃ¹ng MessageChannel + rAF.             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q7: Effect list lÃ  gÃ¬? Thu tháº­p tháº¿ nÃ o?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Effect list lÃ  linked list chá»©a Táº¤T Cáº¢ side     â”‚
  â”‚  effects (DOM changes) cáº§n thá»±c thi trong commit      â”‚
  â”‚  phase. Má»—i fiber cÃ³ effectTag (Placement/Update/     â”‚
  â”‚  Deletion) + firstEffect/lastEffect/nextEffect. Khi   â”‚
  â”‚  completeWork, effect list cá»§a child MERGE LÃŠN        â”‚
  â”‚  parent. Cuá»‘i cÃ¹ng, root.firstEffect chá»©a toÃ n bá»™  â”‚
  â”‚  effects â†’ commit phase chá»‰ duyá»‡t list nÃ y, Bá»     â”‚
  â”‚  QUA nodes khÃ´ng thay Ä‘á»•i â†’ hiá»‡u quáº£ hÆ¡n!          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Q8: Tá»« source code gÃ³c nhÃ¬n, Fiber thay Ä‘á»•i gÃ¬?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  A: Báº£n cháº¥t: Ä‘á»•i Äá»† QUY thÃ nh VÃ’NG Láº¶P! Cá»¥ thá»ƒ: â”‚
  â”‚  mountComponent/updateComponent â†’ beginWork/           â”‚
  â”‚  completeWork/commitWork. ReactDOMComponent â†’          â”‚
  â”‚  ReactDOMFiberComponent. ReactCompositeComponent â†’     â”‚
  â”‚  ReactFiberClassComponent. ReactReconciler â†’           â”‚
  â”‚  ReactFiberScheduler (task scheduling!). vDOM tree     â”‚
  â”‚  (array children) â†’ fiber tree (singly linked list).  â”‚
  â”‚  ThÃªm: priority scheduling, double buffering,          â”‚
  â”‚  interruptible rendering, effect list collection.       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> **Káº¿t luáº­n**: React Fiber lÃ  bÆ°á»›c tÃ¡i cáº¥u trÃºc Cá»T LÃ•I cá»§a React, chuyá»ƒn tá»«
> Stack Reconciler (Ä‘á»‡ quy Ä‘á»“ng bá»™, khÃ´ng dá»«ng Ä‘Æ°á»£c) sang Fiber Reconciler (vÃ²ng
> láº·p, chia nhá» thÃ nh units of work, dá»«ng/tiáº¿p tá»¥c báº¥t cá»© lÃºc nÃ o). Báº±ng cÃ¡ch
> lÆ°u context trong fiber objects (virtual stack frames) thay vÃ¬ system call stack,
> React 16+ cÃ³ thá»ƒ chia nhá» rendering, Ä‘iá»u chá»‰nh priority, yield main thread cho
> browser, vÃ  má»Ÿ ra ná»n táº£ng cho Concurrent Mode, Suspense, vÃ  Selective Hydration
> trong React 18+. ğŸš€

---

## Â§18. Demo Thá»±c Táº¿ â€” BlockList & 7 GiÃ¢y Äá»©ng HÃ¬nh (Liu Jiefeng)

> Nguá»“n: "What is React Fiber, the new engine for React?" â€” Liu Jiefeng (2017)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  DEMO THá»°C Táº¾: Tá»ª TRANG ÄÆ N GIáº¢N â†’ 7 GIÃ‚Y Äá»¨NG HÃŒNH!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


  Bá»I Cáº¢NH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React â€” Sá»¨ Má»†NH THAY Äá»”I!                          â”‚
  â”‚                                                        â”‚
  â”‚  BAN Äáº¦U (React website cÅ©):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  "We built React to solve one problem:           â”‚  â”‚
  â”‚  â”‚   building large applications with data that     â”‚  â”‚
  â”‚  â”‚   changes over time."                             â”‚  â”‚
  â”‚  â”‚  â†’ Giáº£i quyáº¿t: app Lá»šN + data THAY Äá»”I!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SAU NÃ€Y (React website má»›i):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  "React is a declarative, efficient, and         â”‚  â”‚
  â”‚  â”‚   flexible JavaScript library for building       â”‚  â”‚
  â”‚  â”‚   user interfaces."                               â”‚  â”‚
  â”‚  â”‚  â†’ Declarative + EFFICIENT + FLEXIBLE!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Sá»© má»‡nh má»›i: HIá»†U SUáº¤T + LINH HOáº T!            â”‚
  â”‚  â†’ NhÆ°ng thá»±c táº¿... trang phá»©c táº¡p â†’ CHÆ¯A Tá»T!     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.1. VÃ­ Dá»¥: BlockList Component

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ Dá»¤ Tá»ª BÃ€I VIáº¾T Gá»C â€” BlockList Component!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const NUMBER_OF_BLOCK = 2; // Ban Ä‘áº§u chá»‰ 2 blocks!

class ReactExample extends Component {
  constructor() {
    super();
    this.state = { timesOfButtonClicked: 0 };
  }

  _addTimesOfButtonClicked() {
    const { timesOfButtonClicked } = this.state;
    this.setState({
      timesOfButtonClicked: timesOfButtonClicked + 1,
    });
  }

  render() {
    const { timesOfButtonClicked } = this.state;
    return (
      <div>
        <input type="text" />
        <button onClick={this._addTimesOfButtonClicked.bind(this)}>
          Click Me
        </button>
        <BlockList
          displayNumber={timesOfButtonClicked}
          numberOfBlock={NUMBER_OF_BLOCK}
        />
      </div>
    );
  }
}

// Render ra DOM!
reactDOM.render(<ReactExample />, document.getElementById("app-container"));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIáº¢I THÃCH:
// â†’ Trang cÃ³: 1 input, 1 button, 1 BlockList component!
// â†’ BlockList hiá»ƒn thá»‹ NUMBER_OF_BLOCK Ã´ sá»‘!
// â†’ Má»—i Ã´ hiá»‡n sá»‘ láº§n click button!
// â†’ Ban Ä‘áº§u: NUMBER_OF_BLOCK = 2 â†’ chá»‰ 2 Ã´ hiá»ƒn thá»‹!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 18.2. Luá»“ng setState â†’ Virtual DOM Diff

```
  CLICK BUTTON â†’ setState â†’ VIRTUAL DOM DIFF:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  User click button!                                 â”‚
  â”‚  â‘¡ setState({ timesOfButtonClicked: 1 })              â”‚
  â”‚  â‘¢ React: "Data Má»šI = 1, táº¡o Virtual DOM má»›i!"     â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ SO SÃNH Old VDOM vs New VDOM:                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Old VDOM              New VDOM                  â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
  â”‚  â”‚  â”‚ div  â”‚              â”‚ div  â”‚                 â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜              â””â”€â”€â”¬â”€â”€â”€â”˜                 â”‚  â”‚
  â”‚  â”‚     â”œâ”€â”€ input              â”œâ”€â”€ input              â”‚  â”‚
  â”‚  â”‚     â”œâ”€â”€ button             â”œâ”€â”€ button             â”‚  â”‚
  â”‚  â”‚     â””â”€â”€ BlockList          â””â”€â”€ BlockList          â”‚  â”‚
  â”‚  â”‚         â”œâ”€â”€ Block(0)           â”œâ”€â”€ Block(1) ğŸŸ¡   â”‚  â”‚
  â”‚  â”‚         â””â”€â”€ Block(0)           â””â”€â”€ Block(1) ğŸŸ¡   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  ğŸŸ¡ = state ÄÃƒ THAY Äá»”I (0 â†’ 1)!              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ Diff tÃ¬m ra: 2 Block cáº§n UPDATE!                  â”‚
  â”‚  â‘¥ ÄÆ°a vÃ o UPDATE QUEUE!                             â”‚
  â”‚  â‘¦ Duyá»‡t queue â†’ cáº­p nháº­t DOM tháº­t!                 â”‚
  â”‚  â†’ React tá»± lo TOÃ€N Bá»˜!                              â”‚
  â”‚  â†’ Browser chá»‰ cáº§n compile + execute JS!              â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  MAIN THREAD â€” Tá»ª setState Äáº¾N RENDER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Main Thread (â”â” Ä‘Æ°á»ng dÃ y):                          â”‚
  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€ GIAI ÄOáº N 1 â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€ GIAI ÄOáº N 2 â”€â”€â”   â”‚
  â”‚  â”‚     SCHEDULING PHASE      â”‚â”‚  RENDERING PHASE â”‚   â”‚
  â”‚  â”‚                            â”‚â”‚                  â”‚   â”‚
  â”‚  â”‚ â‘  Táº¡o VDOM má»›i!          â”‚â”‚ â‘  Duyá»‡t update  â”‚   â”‚
  â”‚  â”‚ â‘¡ Duyá»‡t toÃ n bá»™ VDOM!  â”‚â”‚   queue!          â”‚   â”‚
  â”‚  â”‚ â‘¢ Diff: tÃ¬m thay Ä‘á»•i!  â”‚â”‚ â‘¡ Cáº­p nháº­t DOM! â”‚   â”‚
  â”‚  â”‚ â‘£ ÄÆ°a vÃ o update queue!â”‚â”‚ â‘¢ Browser repaintâ”‚   â”‚
  â”‚  â”‚                            â”‚â”‚                  â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚  Scheduling: XÃC Äá»ŠNH cáº§n update GÃŒ!                  â”‚
  â”‚  Rendering: THá»°C Sá»° cáº­p nháº­t DOM!                    â”‚
  â”‚                                                        â”‚
  â”‚  âš ï¸ Rendering KHÃ”NG CHá»ˆ browser!                      â”‚
  â”‚  â†’ Browser: DOM elements!                              â”‚
  â”‚  â†’ React Native: native components!                    â”‚
  â”‚  â†’ VR: VR elements!                                    â”‚
  â”‚  â†’ Hardware: hardware displays!                        â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.3. Khi NUMBER_OF_BLOCK = 100,000 â€” Tháº£m Há»a!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THAY Äá»”I DUY NHáº¤T: tá»« 2 â†’ 100,000!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const NUMBER_OF_BLOCK = 100000; // 100,000 blocks!
// â†‘ MÃ´ phá»ng trang web PHá»¨C Táº P!
// Pháº§n code cÃ²n láº¡i GIá»NG Há»†T!
```

```
  Ká»ŠCH Báº¢N TEST â€” 7 GIÃ‚Y Äá»¨NG HÃŒNH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Click button â†’ setState â†’ báº¯t Ä‘áº§u update!        â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Click input â†’ gÃµ "hireact"!                        â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ TRANG WEB KHÃ”NG PHáº¢N Há»’I! ğŸ”´                      â”‚
  â”‚     â†’ KhÃ´ng tháº¥y chá»¯ xuáº¥t hiá»‡n!                       â”‚
  â”‚     â†’ KhÃ´ng click Ä‘Æ°á»£c gÃ¬!                             â”‚
  â”‚     â†’ Äá»¨NG HÃŒNH HOÃ€N TOÃ€N 7 GIÃ‚Y!                   â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ SAU 7 GIÃ‚Y... â³                                   â”‚
  â”‚     â†’ "hireact" xuáº¥t hiá»‡n Äá»˜T NGá»˜T trong input!     â”‚
  â”‚     â†’ BlockList cÅ©ng update 0 â†’ 1!                   â”‚
  â”‚     â†’ Má»i thá»© cáº­p nháº­t CÃ™NG LÃšC!                    â”‚
  â”‚                                                        â”‚
  â”‚  USER NGHÄ¨ GÃŒ?                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  7 giÃ¢y khÃ´ng pháº£n há»“i:                          â”‚  â”‚
  â”‚  â”‚  â†’ "Website bá»‹ crash rá»“i!" ğŸ˜¤                   â”‚  â”‚
  â”‚  â”‚  â†’ "MÃ¡y tÃ´i bá»‹ Ä‘Æ¡!" ğŸ˜¡                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  0.5 giÃ¢y khÃ´ng pháº£n há»“i (nhiá»u láº§n):            â”‚  â”‚
  â”‚  â”‚  â†’ "Website tá»‡ quÃ¡!" ğŸ˜’                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ TRáº¢I NGHIá»†M Cá»°C Tá»†! âŒ                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  PHÃ‚N TÃCH PERFORMANCE â€” 7 GIÃ‚Y:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Browser Main Thread trong 7 giÃ¢y:                     â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€ 7 GIÃ‚Y Bá»Š CHIáº¾M â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚  â”‚                                              â”‚       â”‚
  â”‚  â”‚  ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡  ğŸŸ£ğŸŸ£  ğŸŸ¢   â”‚       â”‚
  â”‚  â”‚  â†â”€â”€â”€â”€ JS Execution â”€â”€â”€â”€â†’  â†DOMâ†’ â†Paintâ†’   â”‚       â”‚
  â”‚  â”‚        (6 GIÃ‚Y!)           (calc) (render)  â”‚       â”‚
  â”‚  â”‚                                              â”‚       â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                                                        â”‚
  â”‚  ğŸŸ¡ VÃ€NG = JavaScript (React chiáº¿m main thread!)     â”‚
  â”‚     â†’ 6 GIÃ‚Y liÃªn tá»¥c! Diff 100,000 elements!        â”‚
  â”‚     â†’ Main thread Bá»Š KHÃ“A!                           â”‚
  â”‚     â†’ User input Bá»Š IGNORE!                           â”‚
  â”‚                                                        â”‚
  â”‚  ğŸŸ£ TÃM = Browser tÃ­nh láº¡i DOM Tree (Reflow)!        â”‚
  â”‚     â†’ Báº®T BUá»˜C pháº£i lÃ m sau DOM thay Ä‘á»•i!            â”‚
  â”‚                                                        â”‚
  â”‚  ğŸŸ¢ XANH = Browser váº½ láº¡i trang (Repaint)!           â”‚
  â”‚     â†’ Báº®T BUá»˜C pháº£i lÃ m!                              â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Váº¤N Äá»€ CHÃNH:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  ğŸŸ£ TÃM + ğŸŸ¢ XANH = Báº®T BUá»˜C, khÃ´ng giáº£m!    â”‚  â”‚
  â”‚  â”‚  ğŸŸ¡ VÃ€NG = Váº¤N Äá»€! React chiáº¿m 6 GIÃ‚Y!        â”‚  â”‚
  â”‚  â”‚  â†’ Diff algorithm O(n) VáºªN Tá»T!                â”‚  â”‚
  â”‚  â”‚  â†’ Váº¥n Ä‘á»: CHIáº¾N LÆ¯á»¢C Lá»ŠCH TRÃŒNH!              â”‚  â”‚
  â”‚  â”‚  â†’ Stack Reconcile = cháº¡y 1 Máº CH!               â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG THá»‚ dá»«ng giá»¯a chá»«ng!                  â”‚  â”‚
  â”‚  â”‚  â†’ = function call stack!                         â”‚  â”‚
  â”‚  â”‚  â†’ Depth-first traversal 100k nodes!              â”‚  â”‚
  â”‚  â”‚  â†’ Pháº£i xong ALL má»›i pop stack!                   â”‚  â”‚
  â”‚  â”‚  â†’ Main thread bá»‹ KHÃ“A suá»‘t!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  ANIMATION CÅ¨NG Bá»Š CHáº¾T:                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  60fps = má»—i frame â‰¤ 16.6ms!                    â”‚  â”‚
  â”‚  â”‚  React chiáº¿m > 16.6ms â†’ Máº¤T FRAME!             â”‚  â”‚
  â”‚  â”‚  React chiáº¿m 6s â†’ Máº¤T 360 FRAMES!              â”‚  â”‚
  â”‚  â”‚  â†’ Animation GIáº¬T Cá»¨NG!                          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§19. Fiber Giáº£i Quyáº¿t â€” Code Demo & So SÃ¡nh!

### 19.1. Fiber Version â€” CÃ¹ng 100,000 Blocks!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIBER VERSION â€” CÃ™NG 100,000 BLOCKS!
// So sÃ¡nh trá»±c tiáº¿p vá»›i Stack version á»Ÿ Â§18!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const NUMBER_OF_BLOCK = 100000;

class FiberExample extends Component {
  constructor() {
    super();
    this.state = { timesOfButtonClicked: 0 };
  }

  _addTimesOfButtonClicked() {
    const { timesOfButtonClicked } = this.state;

    // â­ THAY Äá»”I 1: unstable_deferredUpdates!
    // â†’ Äáº·t task nÃ y = LOW PRIORITY!
    ReactDOMFiber.unstable_deferredUpdates(() =>
      this.setState((state) => ({
        timesOfButtonClicked: timesOfButtonClicked + 1,
      })),
    );
  }

  render() {
    const { timesOfButtonClicked } = this.state;

    // â­ THAY Äá»”I 2: return ARRAY trá»±c tiáº¿p!
    // â†’ KhÃ´ng cáº§n <div> wrapper!
    return [
      <input type="text" style={inputStyle} />,
      <button
        style={buttonStyle}
        onClick={this._addTimesOfButtonClicked.bind(this)}
      >
        Click Me
      </button>,
      <BlockList
        displayNumber={timesOfButtonClicked}
        numberOfDotList={NUMBER_OF_BLOCK}
      />,
    ];
  }
}

// â­ THAY Äá»”I 3: ReactDOMFiber.render!
ReactDOMFiber.render(
  <FiberExample />,
  document.getElementById("app-container"),
);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REACT FIBER CÃ’N Há»– TRá»¢ RETURN STRING/NUMBER:
//
// render() { return 'Hi, ReactFiber!'; }
// render() { return 123; }
//
// â†’ React 15: CHá»ˆ return 1 element!
// â†’ React 16+: return array, string, number!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 19.2. So SÃ¡nh Káº¿t Quáº£ â€” Stack vs Fiber

```
  STACK vs FIBER â€” CÃ™NG THAO TÃC, KHÃC Káº¾T QUáº¢:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CÃ¹ng thao tÃ¡c: click button + gÃµ "hireact" vÃ o input!â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• STACK RECONCILE â•â•â•                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  Click button â†’ setState                      â”‚  â”‚
  â”‚  â”‚  â‘¡ Click input â†’ gÃµ "hireact"                   â”‚  â”‚
  â”‚  â”‚  â‘¢ TRANG WEB KHÃ”NG PHáº¢N Há»’I! âŒ                â”‚  â”‚
  â”‚  â”‚  â‘£ Äá»£i 7 giÃ¢y...                                â”‚  â”‚
  â”‚  â”‚  â‘¤ "hireact" xuáº¥t hiá»‡n Äá»˜T NGá»˜T!              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Main Thread:                                     â”‚  â”‚
  â”‚  â”‚  ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡ğŸŸ¡  ğŸŸ£ğŸŸ¢      â”‚  â”‚
  â”‚  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€ JS: 6s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  DOM           â”‚  â”‚
  â”‚  â”‚              BLOCKED HOÃ€N TOÃ€N!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â•â•â• FIBER RECONCILE â•â•â•                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  Click button â†’ setState (LOW priority!)      â”‚  â”‚
  â”‚  â”‚  â‘¡ Click input â†’ gÃµ "hireact"                   â”‚  â”‚
  â”‚  â”‚  â‘¢ TRANG WEB PHáº¢N Há»’I NGAY! âœ…                 â”‚  â”‚
  â”‚  â”‚  â‘£ Chá»¯ xuáº¥t hiá»‡n REAL-TIME!                     â”‚  â”‚
  â”‚  â”‚  â‘¤ BlockList update SAU khi Commit!             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Main Thread:                                     â”‚  â”‚
  â”‚  â”‚  ğŸŸ¡ğŸŸ¡ ğŸŸ£ğŸŸ¢ ğŸŸ¡ğŸŸ¡ ğŸŸ£ğŸŸ¢ ğŸŸ¡ğŸŸ¡ ğŸŸ£ğŸŸ¢ ğŸŸ¡ğŸŸ¡       â”‚  â”‚
  â”‚  â”‚  JS   DOM   JS   DOM   JS   DOM   JS              â”‚  â”‚
  â”‚  â”‚  task Paint task Paint task Paint task             â”‚  â”‚
  â”‚  â”‚       â†‘          â†‘          â†‘                     â”‚  â”‚
  â”‚  â”‚     render     render     render                   â”‚  â”‚
  â”‚  â”‚     user       user       user                     â”‚  â”‚
  â”‚  â”‚     input!     input!     input!                   â”‚  â”‚
  â”‚  â”‚  â† USER CÃ“ THá»‚ TÆ¯Æ NG TÃC LIÃŠN Tá»¤C! â†’          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Trong lÃºc React cháº¡y JS (ğŸŸ¡), browser VáºªN:       â”‚
  â”‚  â†’ TÃ­nh láº¡i DOM Tree (ğŸŸ£)!                           â”‚
  â”‚  â†’ Váº½ láº¡i trang (ğŸŸ¢)!                                â”‚
  â”‚  â†’ Hiá»ƒn thá»‹ chá»¯ user ÄANG GÃ•!                       â”‚
  â”‚  â†’ Browser LUÃ”N PHáº¢N Há»’I user input!                 â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.3. PhÃ¢n TÃ­ch 4 Thay Äá»•i Code â€” Tá»« DÆ°á»›i LÃªn!

```
  4 THAY Äá»”I â€” Tá»ª STACK â†’ FIBER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  reactDOM.render â†’ ReactDOMFiber.render             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // CÅ¨ â€” Stack engine:                           â”‚  â”‚
  â”‚  â”‚  reactDOM.render(<App />, container);             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // Má»šI â€” Fiber engine:                           â”‚  â”‚
  â”‚  â”‚  ReactDOMFiber.render(<App />, container);        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Sá»­ dá»¥ng Fiber Reconciler!                     â”‚  â”‚
  â”‚  â”‚  â†’ CHIA NHá» task lá»›n â†’ nhiá»u task nhá»!         â”‚  â”‚
  â”‚  â”‚  â†’ Äáº·t PRIORITY máº·c Ä‘á»‹nh cho má»—i task!         â”‚  â”‚
  â”‚  â”‚  â†’ Sau má»—i task nhá»: NHÆ¯á»œNG main thread!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ render() tráº£ div â†’ tráº£ ARRAY!                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // CÅ¨ â€” React 15: PHáº¢I wrap trong 1 element!    â”‚  â”‚
  â”‚  â”‚  render() {                                       â”‚  â”‚
  â”‚  â”‚    return (<div> ... </div>);                      â”‚  â”‚
  â”‚  â”‚  }                                                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // Má»šI â€” React 16+: return ARRAY trá»±c tiáº¿p!     â”‚  â”‚
  â”‚  â”‚  render() {                                       â”‚  â”‚
  â”‚  â”‚    return [<input/>, <button/>, <BlockList/>];     â”‚  â”‚
  â”‚  â”‚  }                                                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // BONUS: return string hoáº·c number!             â”‚  â”‚
  â”‚  â”‚  render() { return 'Hi, ReactFiber!'; }           â”‚  â”‚
  â”‚  â”‚  render() { return 123; }                          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Fiber há»— trá»£ render NHIá»€U kiá»ƒu output!       â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cáº§n <div> wrapper thá»«a!                 â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ setState(object) â†’ setState(CALLBACK)              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // CÅ¨ â€” truyá»n OBJECT trá»±c tiáº¿p:                â”‚  â”‚
  â”‚  â”‚  this.setState({ count: count + 1 });             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // Má»šI â€” truyá»n CALLBACK tráº£ vá» state:          â”‚  â”‚
  â”‚  â”‚  this.setState(state => ({                        â”‚  â”‚
  â”‚  â”‚    count: state.count + 1                          â”‚  â”‚
  â”‚  â”‚  }));                                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Táº I SAO CALLBACK Tá»T HÆ N?                       â”‚  â”‚
  â”‚  â”‚  â†’ Fiber cÃ³ thá»ƒ NGáº®T + LÃ€M Láº I Phase 1!        â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u dÃ¹ng object: state cÃ³ thá»ƒ bá»‹ STALE!      â”‚  â”‚
  â”‚  â”‚  â†’ Callback: LUÃ”N nháº­n state HIá»†N Táº I!          â”‚  â”‚
  â”‚  â”‚  â†’ TrÃ¡nh race condition khi batch update!         â”‚  â”‚
  â”‚  â”‚  â†’ = RECOMMENDED approach!                        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ unstable_deferredUpdates â†’ LOW PRIORITY!           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // Äáº¶T TASK = LOW PRIORITY:                      â”‚  â”‚
  â”‚  â”‚  ReactDOMFiber.unstable_deferredUpdates(() =>     â”‚  â”‚
  â”‚  â”‚      this.setState(state => ({...}))              â”‚  â”‚
  â”‚  â”‚  );                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  PHÃ‚N TÃCH TÃŠN API:                                â”‚  â”‚
  â”‚  â”‚  â†’ deferred = "hoÃ£n láº¡i" = "trÃ¬ hoÃ£n update!"   â”‚  â”‚
  â”‚  â”‚  â†’ unstable = "chÆ°a á»•n Ä‘á»‹nh, Ä‘ang phÃ¡t triá»ƒn!" â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÃŠN TRONG SOURCE CODE:                            â”‚  â”‚
  â”‚  â”‚  â†’ unstable_deferredUpdates = set PRIORITY         â”‚  â”‚
  â”‚  â”‚    = lowPriority!                                  â”‚  â”‚
  â”‚  â”‚  â†’ Ná»™i bá»™: chá»‰ Ä‘áº·t priority = LOW!              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš ï¸ unstable_deferredUpdates cÃ³ thá»ƒ KHÃ”NG       â”‚  â”‚
  â”‚  â”‚  trá»Ÿ thÃ nh API chÃ­nh thá»©c!                        â”‚  â”‚
  â”‚  â”‚  â†’ React team muá»‘n: performWithPriority()         â”‚  â”‚
  â”‚  â”‚  â†’ NhÆ°ng chÆ°a implement!                          â”‚  â”‚
  â”‚  â”‚  â†’ BÃ i viáº¿t dÃ¹ng React@16.0.0-alpha.3!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 19.4. Luá»“ng Thá»±c Thi Chi Tiáº¿t â€” Khi Click Button + GÃµ Input

```
  LUá»’NG THá»°C THI CHI TIáº¾T â€” FIBER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 1: Click button!                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ _addTimesOfButtonClicked() Ä‘Æ°á»£c gá»i!          â”‚  â”‚
  â”‚  â”‚  â†’ unstable_deferredUpdates() Ä‘áº·t                â”‚  â”‚
  â”‚  â”‚    setState = LOW PRIORITY!                       â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cÃ³ task khÃ¡c â†’ React Báº®T Äáº¦U update! â”‚  â”‚
  â”‚  â”‚  â†’ Update task vÃ o RECONCILE PHASE!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 2: User click input + gÃµ chá»¯!                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ User interaction task Äáº¾N!                    â”‚  â”‚
  â”‚  â”‚  â†’ User input = HIGH PRIORITY!                    â”‚  â”‚
  â”‚  â”‚  â†’ HIGH > LOW!                                     â”‚  â”‚
  â”‚  â”‚  â†’ Dá»ªNG Reconcile Phase! â¸ï¸                      â”‚  â”‚
  â”‚  â”‚  â†’ Browser xá»­ lÃ½ user input TRÆ¯á»šC!               â”‚  â”‚
  â”‚  â”‚  â†’ Chá»¯ XUáº¤T HIá»†N NGAY trÃªn input!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 3: Input xong â†’ tiáº¿p tá»¥c Reconcile!            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Reconcile Phase TIáº¾P Tá»¤C tá»« chá»— dá»«ng!       â”‚  â”‚
  â”‚  â”‚  â†’ User gÃµ tiáº¿p? â†’ Dá»ªNG Láº I láº§n ná»¯a!         â”‚  â”‚
  â”‚  â”‚  â†’ User xong? â†’ Reconcile cháº¡y tiáº¿p!            â”‚  â”‚
  â”‚  â”‚  â†’ Reconcile hoÃ n táº¥t â†’ COMMIT Phase!            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BÆ¯á»šC 4: Commit Phase!                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Commit = KHÃ”NG THá»‚ NGáº®T!                     â”‚  â”‚
  â”‚  â”‚  â†’ DOM cáº­p nháº­t 1 lÆ°á»£t!                          â”‚  â”‚
  â”‚  â”‚  â†’ Browser render: input + BlockList Má»šI!        â”‚  â”‚
  â”‚  â”‚  â†’ Giai Ä‘oáº¡n commit thÆ°á»ng NHANH                 â”‚  â”‚
  â”‚  â”‚    (DOM operations nháº¹ hÆ¡n diff!)                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  TIMELINE:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Time â†’                                          â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚  â”‚
  â”‚  â”‚  â”‚ R  â”‚ â”‚Userâ”‚ â”‚ R  â”‚ â”‚Userâ”‚ â”‚ R  â”‚ â”‚Commitâ”‚ â”‚  â”‚
  â”‚  â”‚  â”‚ e  â”‚ â”‚ in â”‚ â”‚ e  â”‚ â”‚ in â”‚ â”‚ e  â”‚ â”‚(DOM) â”‚ â”‚  â”‚
  â”‚  â”‚  â”‚ c  â”‚ â”‚ putâ”‚ â”‚ c  â”‚ â”‚ putâ”‚ â”‚ c  â”‚ â”‚      â”‚ â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
  â”‚  â”‚  LOW â†•  HIGHâ†•  LOW â†•  HIGHâ†•  LOW â†•           â”‚  â”‚
  â”‚  â”‚       yield!       yield!       done!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  R = Reconcile (CÃ“ THá»‚ NGáº®T!)                  â”‚  â”‚
  â”‚  â”‚  User input = XEN GIá»®A Reconcile!                â”‚  â”‚
  â”‚  â”‚  Commit = CHáº Y 1 LÆ¯á»¢T, khÃ´ng ngáº¯t!             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  ğŸ’¡ Káº¾T QUáº¢:                                          â”‚
  â”‚  â†’ Developer cÃ³ QUYá»€N KIá»‚M SOÃT priority!            â”‚
  â”‚  â†’ Task nÃ o quan trá»ng â†’ priority CAO!               â”‚
  â”‚  â†’ Task nÃ o khÃ´ng gáº¥p â†’ priority THáº¤P!              â”‚
  â”‚  â†’ User experience Tá»T HÆ N NHIá»€U!                    â”‚
  â”‚  â†’ Browser LUÃ”N responsive!                            â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§20. Phá»¥ Lá»¥c â€” Caveats, API Evolution & Tá»•ng Káº¿t!

### 20.1. Caveats â€” Nhá»¯ng Äiá»u Cáº§n Biáº¿t!

```
  CAVEATS â€” FIBER KHÃ”NG PHáº¢I PHÃ‰P MÃ€U!
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  STARVATION (ÄÃ“I TASK):                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Náº¿u HIGH priority tasks Äáº¾N LIÃŠN Tá»¤C:         â”‚  â”‚
  â”‚  â”‚  â†’ LOW priority task KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c cháº¡y!  â”‚  â”‚
  â”‚  â”‚  â†’ VD: user gÃµ liÃªn tá»¥c â†’ BlockList update     â”‚  â”‚
  â”‚  â”‚    KHÃ”NG BAO GIá»œ hoÃ n thÃ nh!                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  GIáº¢I PHÃP (React team):                          â”‚  â”‚
  â”‚  â”‚  â†’ "Aging" = deadline cho LOW tasks!              â”‚  â”‚
  â”‚  â”‚  â†’ Sau N ms, nÃ¢ng priority LOW â†’ HIGH!           â”‚  â”‚
  â”‚  â”‚  â†’ Äáº£m báº£o Má»ŒI task Ä‘á»u Ä‘Æ°á»£c xá»­ lÃ½!           â”‚  â”‚
  â”‚  â”‚  â†’ React Scheduler (react-dom >= 18) Ä‘Ã£         â”‚  â”‚
  â”‚  â”‚    implement aging + expiration time!              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ LIFECYCLE Bá»Š Gá»ŒI NHIá»€U Láº¦N:                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  VÃ¬ Phase 1 CÃ“ THá»‚ bá»‹ ngáº¯t + cháº¡y láº¡i:        â”‚  â”‚
  â”‚  â”‚  â†’ componentWillMount gá»i 2+ láº§n! âš ï¸           â”‚  â”‚
  â”‚  â”‚  â†’ componentWillReceiveProps gá»i 2+ láº§n! âš ï¸    â”‚  â”‚
  â”‚  â”‚  â†’ componentWillUpdate gá»i 2+ láº§n! âš ï¸          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Side effects trong lifecycle nÃ y:                 â”‚  â”‚
  â”‚  â”‚  â†’ fetch data 2+ láº§n!                             â”‚  â”‚
  â”‚  â”‚  â†’ DOM manipulation 2+ láº§n!                       â”‚  â”‚
  â”‚  â”‚  â†’ setState 2+ láº§n! â†’ BUG!                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ React team DEPRECATED cÃ¡c lifecycle nÃ y!      â”‚  â”‚
  â”‚  â”‚  â†’ Â§17.5 giáº£i thÃ­ch chi tiáº¿t!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ COMMIT PHASE VáºªN BLOCKING:                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â†’ Fiber chá»‰ chia nhá» PHASE 1 (reconcile)!     â”‚  â”‚
  â”‚  â”‚  â†’ Phase 2 (commit) VáºªN CHáº Y 1 Máº CH!          â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u DOM changes QUÃ NHIá»€U â†’ váº«n lag!       â”‚  â”‚
  â”‚  â”‚  â†’ May máº¯n: DOM operations nhanh hÆ¡n diff!      â”‚  â”‚
  â”‚  â”‚  â†’ Commit phase thÆ°á»ng < 16ms!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ KHÃ”NG GIáº¢M Tá»”NG THá»œI GIAN:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Stack: 7 giÃ¢y liÃªn tá»¥c! â†’ User Ä‘á»£i 7s!        â”‚  â”‚
  â”‚  â”‚  Fiber: 7 giÃ¢y CHIA NHá»! â†’ User KHÃ”NG cáº£m     â”‚  â”‚
  â”‚  â”‚    tháº¥y Ä‘á»£i vÃ¬ browser váº«n pháº£n há»“i!           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Tá»”NG LÆ¯á»¢NG CÃ”NG VIá»†C = GIá»NG NHAU!          â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ¡c: CHIáº¾N LÆ¯á»¢C Lá»ŠCH TRÃŒNH!                â”‚  â”‚
  â”‚  â”‚  â†’ Fiber = "tráº£i Ä‘á»u" thay vÃ¬ "dá»“n 1 cá»¥c"!    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 20.2. API Evolution â€” Tá»« Alpha â†’ React 18+

```
  API EVOLUTION â€” UNSTABLE â†’ STABLE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React 16 Alpha (bÃ i viáº¿t gá»‘c):                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  ReactDOMFiber.unstable_deferredUpdates(() =>    â”‚  â”‚
  â”‚  â”‚      this.setState(...)                           â”‚  â”‚
  â”‚  â”‚  );                                               â”‚  â”‚
  â”‚  â”‚  â†’ unstable = API thá»­ nghiá»‡m!                   â”‚  â”‚
  â”‚  â”‚  â†’ ReactDOMFiber = tÃªn riÃªng cho Fiber engine!   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚            â†“ (React 16 stable)                         â”‚
  â”‚                                                        â”‚
  â”‚  React 16 Stable:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  ReactDOM.render(<App />, container);             â”‚  â”‚
  â”‚  â”‚  â†’ ReactDOMFiber MERGE vÃ o ReactDOM!             â”‚  â”‚
  â”‚  â”‚  â†’ Fiber lÃ  DEFAULT engine!                       â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cáº§n import riÃªng!                        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚            â†“ (React 18)                                â”‚
  â”‚                                                        â”‚
  â”‚  React 18 â€” Concurrent Features:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // â­ unstable_deferredUpdates â†’ startTransitionâ”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  import { startTransition } from 'react';        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  startTransition(() => {                          â”‚  â”‚
  â”‚  â”‚      setState(newState);                          â”‚  â”‚
  â”‚  â”‚  });                                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // HOáº¶C dÃ¹ng hook:                               â”‚  â”‚
  â”‚  â”‚  const [isPending, startTransition] =             â”‚  â”‚
  â”‚  â”‚      useTransition();                              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ startTransition = API chÃ­nh thá»©c!              â”‚  â”‚
  â”‚  â”‚  â†’ Äáº·t setState = LOW PRIORITY!                  â”‚  â”‚
  â”‚  â”‚  â†’ isPending = true khi Ä‘ang transition!        â”‚  â”‚
  â”‚  â”‚  â†’ UI loading indicator = easy!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â­ ReactDOM.createRoot (React 18+):                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // CÅ¨ (React 16-17): Legacy mode                 â”‚  â”‚
  â”‚  â”‚  ReactDOM.render(<App />, container);             â”‚  â”‚
  â”‚  â”‚  â†’ Fiber engine NHÆ¯NG khÃ´ng concurrent!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // Má»šI (React 18+): Concurrent mode              â”‚  â”‚
  â”‚  â”‚  const root = ReactDOM.createRoot(container);     â”‚  â”‚
  â”‚  â”‚  root.render(<App />);                             â”‚  â”‚
  â”‚  â”‚  â†’ Báº¬T concurrent features!                       â”‚  â”‚
  â”‚  â”‚  â†’ startTransition, useDeferredValue, etc.!      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Báº¢NG MAPPING API:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  React 16 Alpha      â†’ React 18 Stable           â”‚  â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
  â”‚  â”‚  ReactDOMFiber.render â†’ ReactDOM.createRoot      â”‚  â”‚
  â”‚  â”‚  unstable_deferred   â†’ startTransition           â”‚  â”‚
  â”‚  â”‚  Updates                                          â”‚  â”‚
  â”‚  â”‚  (khÃ´ng cÃ³)          â†’ useTransition (hook!)     â”‚  â”‚
  â”‚  â”‚  (khÃ´ng cÃ³)          â†’ useDeferredValue          â”‚  â”‚
  â”‚  â”‚  (khÃ´ng cÃ³)          â†’ Suspense for data!        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 20.3. Tá»•ng Káº¿t â€” Tá»« BÃ i Viáº¿t Gá»‘c + Bá»• Sung!

```
  â­ Tá»”NG Káº¾T TOÃ€N DIá»†N:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Váº¤N Äá»€ Gá»C:                                       â”‚
  â”‚  â†’ Trang phá»©c táº¡p (100k elements) â†’ 7s Ä‘á»©ng hÃ¬nh!  â”‚
  â”‚  â†’ Stack Reconciler: diff TOÃ€N Bá»˜ tree 1 máº¡ch!     â”‚
  â”‚  â†’ Main thread Bá»Š KHÃ“A â†’ user KHÃ”NG tÆ°Æ¡ng tÃ¡c!     â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ GIáº¢I PHÃP â€” FIBER:                                 â”‚
  â”‚  â†’ Chia task Lá»šN â†’ nhiá»u task NHá»!                  â”‚
  â”‚  â†’ Sau má»—i task nhá» â†’ NHÆ¯á»œNG main thread!          â”‚
  â”‚  â†’ User interaction â†’ NGáº®T task tháº¥p priority!      â”‚
  â”‚  â†’ Browser LUÃ”N responsive!                            â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Ká»¸ THUáº¬T CORE:                                      â”‚
  â”‚  â†’ Fiber node = virtual stack frame!                   â”‚
  â”‚  â†’ Linked list (child/sibling/return)!                 â”‚
  â”‚  â†’ Double buffering (current + workInProgress)!        â”‚
  â”‚  â†’ Effect list (thu tháº­p side effects)!                â”‚
  â”‚  â†’ Priority scheduling (6 má»©c priority)!               â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ 2 PHASE:                                            â”‚
  â”‚  â†’ Phase 1 (Reconcile): CÃ“ THá»‚ NGáº®T!                â”‚
  â”‚    â†’ Diff, táº¡o fiber, thu tháº­p effects!               â”‚
  â”‚  â†’ Phase 2 (Commit): KHÃ”NG THá»‚ NGáº®T!                â”‚
  â”‚    â†’ Cáº­p nháº­t DOM 1 lÆ°á»£t!                             â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ IMPACT LÃŠN DEVELOPER:                              â”‚
  â”‚  â†’ componentWillMount â†’ DEPRECATED!                   â”‚
  â”‚  â†’ setState(object) â†’ setState(callback)!              â”‚
  â”‚  â†’ ReactDOM.render â†’ ReactDOM.createRoot!              â”‚
  â”‚  â†’ unstable_deferredUpdates â†’ startTransition!        â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ FIBER Má» ÄÆ¯á»œNG CHO:                                â”‚
  â”‚  â†’ Concurrent Mode (React 18)!                         â”‚
  â”‚  â†’ Suspense (lazy loading + data fetching)!            â”‚
  â”‚  â†’ Selective Hydration (SSR optimization)!             â”‚
  â”‚  â†’ Server Components (React 19+)!                      â”‚
  â”‚  â†’ useTransition + useDeferredValue!                   â”‚
  â”‚                                                        â”‚
  â”‚  â‘¦ BÃ€I Há»ŒC CORE:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  "Váº¥n Ä‘á» khÃ´ng pháº£i THUáº¬T TOÃN (O(n) váº«n OK)! â”‚  â”‚
  â”‚  â”‚   Váº¥n Ä‘á» lÃ  CHIáº¾N LÆ¯á»¢C Lá»ŠCH TRÃŒNH!             â”‚  â”‚
  â”‚  â”‚   Stack: cháº¡y 1 máº¡ch, khÃ´ng dá»«ng!               â”‚  â”‚
  â”‚  â”‚   Fiber: chia nhá», dá»«ng/tiáº¿p, Æ°u tiÃªn!        â”‚  â”‚
  â”‚  â”‚   COOPERATIVE MULTITASKING giá»¯a React & Browser!"â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

> **Káº¿t luáº­n cuá»‘i cÃ¹ng**: React Fiber lÃ  bÆ°á»›c tÃ¡i cáº¥u trÃºc Cá»T LÃ•I nháº¥t trong lá»‹ch sá»­ React.
> Tá»« Stack Reconciler (Ä‘á»‡ quy Ä‘á»“ng bá»™, chiáº¿m main thread liÃªn tá»¥c, user báº¥t lá»±c Ä‘á»£i 7 giÃ¢y)
> sang Fiber Reconciler (vÃ²ng láº·p iterative, chia nhá» thÃ nh units of work, dá»«ng/tiáº¿p tá»¥c linh
> hoáº¡t, Æ°u tiÃªn task quan trá»ng). Báº±ng cÃ¡ch lÆ°u context trong fiber objects (virtual stack frames)
> thay vÃ¬ system call stack, React 16+ giáº£i quyáº¿t bÃ i toÃ¡n "trang phá»©c táº¡p = trang cháº­m" vÃ 
> má»Ÿ ra ná»n táº£ng cho Concurrent Mode, Suspense, Selective Hydration, vÃ  Server Components.
>
> **Tá»« bÃ i viáº¿t cá»§a Liu Jiefeng**: chá»‰ 4 dÃ²ng code thay Ä‘á»•i (`ReactDOMFiber.render`,
> `unstable_deferredUpdates`, `setState(callback)`, `return array`) â€” káº¿t quáº£: 100,000 blocks
> tá»« 7 giÃ¢y Ä‘á»©ng hÃ¬nh â†’ user gÃµ "hireact" mÆ°á»£t mÃ , BlockList update ná»n. ÄÃ³ chÃ­nh lÃ  sá»©c
> máº¡nh cá»§a COOPERATIVE MULTITASKING + PRIORITY SCHEDULING! ğŸš€
