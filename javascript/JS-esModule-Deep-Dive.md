# JavaScript \_\_esModule â€” Deep Dive!

> **Chá»§ Ä‘á»**: `__esModule` trong build artifacts â€” NguyÃªn lÃ½ & Chá»©c nÄƒng
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: BÃ i phá»ng váº¥n â€” "What is \_\_esModule in front-end build artifacts?"
> **HÃ¬nh áº£nh gá»‘c**: 1 screenshot (build output code)

---

## Má»¥c Lá»¥c

1. [Â§1. \_\_esModule lÃ  gÃ¬? â€” TL;DR](#1)
2. [Â§2. Táº¡i sao tá»“n táº¡i? â€” ESM vs CJS Semantics](#2)
3. [Â§3. \_\_esModule lÃ m gÃ¬ chÃ­nh xÃ¡c?](#3)
4. [Â§4. Váº¥n Ä‘á» cá»‘t lÃµi: Default Export Interop](#4)
5. [Â§5. Táº¡i sao khÃ´ng kiá»ƒm tra thuá»™c tÃ­nh default?](#5)
6. [Â§6. Khi nÃ o \_\_esModule Ä‘Æ°á»£c sinh ra?](#6)
7. [Â§7. Lá»‹ch sá»­ Module System â€” 3 tháº¿ há»‡](#7)
8. [Â§8. PhÃ¢n TÃ­ch HÃ¬nh Gá»‘c](#8)
9. [Â§9. SÆ¡ Äá»“ Tá»± Váº½](#9)
10. [Â§10. Tá»± Viáº¿t â€” ModuleInteropEngine](#10)
11. [Â§11. CÃ¢u Há»i Luyá»‡n Táº­p](#11)

---

## Â§1. \_\_esModule lÃ  gÃ¬? â€” TL;DR!

```
  __esModule â€” TL;DR:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  DÃ’NG CODE QUEN THUá»˜C:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Object.defineProperty(exports, "__esModule",         â”‚    â”‚
  â”‚  â”‚   { value: true });                                  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Báº¢N CHáº¤T:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Má»™t CÃI NHÃƒN (marker/tag)!                       â”‚    â”‚
  â”‚  â”‚ â†’ NÃ³i ráº±ng: "File CJS nÃ y Ä‘Æ°á»£c Dá»ŠCH tá»« ES Module!" â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng Ä‘á»ƒ TÆ¯Æ NG THÃCH default export semantics!     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ KHÃ”NG pháº£i:                                          â”‚    â”‚
  â”‚  â”‚ âœ— Code chá»©c nÄƒng                                    â”‚    â”‚
  â”‚  â”‚ âœ— Logic nghiá»‡p vá»¥                                  â”‚    â”‚
  â”‚  â”‚ âœ— TÃ­nh nÄƒng cá»§a ngÃ´n ngá»¯ JavaScript                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ MÃ€ LÃ€:                                               â”‚    â”‚
  â”‚  â”‚ âœ“ Compatibility marker (Ä‘Ã¡nh dáº¥u tÆ°Æ¡ng thÃ­ch!)     â”‚    â”‚
  â”‚  â”‚ âœ“ Quy Æ°á»›c cá»§a Babel/builders                        â”‚    â”‚
  â”‚  â”‚ âœ“ Community de facto standard                       â”‚    â”‚
  â”‚  â”‚ âœ“ Sáº£n pháº©m quÃ¡ Ä‘á»™ cá»§a lá»‹ch sá»­ module system!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÃ‚U TRáº¢ Lá»œI 1 DÃ’NG:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ "__esModule = true" = "Module nÃ y Gá»C lÃ  ESM,       â”‚    â”‚
  â”‚  â”‚  Ä‘Ã£ Ä‘Æ°á»£c CHUYá»‚N Äá»”I sang CJS bá»Ÿi build tool!"      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Táº¡i sao tá»“n táº¡i? â€” ESM vs CJS Semantics!

```
  Táº I SAO Tá»’N Táº I:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  NGUYÃŠN NHÃ‚N Gá»C Rá»„ DUY NHáº¤T:                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ ES Modules vÃ  CommonJS cÃ³ SEMANTICS KHÃC NHAU!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SO SÃNH "DEFAULT EXPORT":                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ ES MODULE:           â”‚  â”‚ COMMONJS:                  â”‚   â”‚
  â”‚  â”‚                      â”‚  â”‚                            â”‚   â”‚
  â”‚  â”‚ export default       â”‚  â”‚ module.exports =           â”‚   â”‚
  â”‚  â”‚   function foo() {}  â”‚  â”‚   function foo() {}        â”‚   â”‚
  â”‚  â”‚                      â”‚  â”‚                            â”‚   â”‚
  â”‚  â”‚ â†’ "default" lÃ        â”‚  â”‚ â†’ module.exports LÃ€       â”‚   â”‚
  â”‚  â”‚   1 NAMED binding!   â”‚  â”‚   GIÃ TRá»Š Ä‘Æ°á»£c export!    â”‚   â”‚
  â”‚  â”‚ â†’ Náº±m trong          â”‚  â”‚ â†’ KhÃ´ng cÃ³ khÃ¡i niá»‡m      â”‚   â”‚
  â”‚  â”‚   namespace object!  â”‚  â”‚   "default" riÃªng!        â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                              â”‚
  â”‚  CÃ¹ng gá»i "Default Export" nhÆ°ng CÆ  CHáº¾ BÃŠN TRONG          â”‚
  â”‚  HOÃ€N TOÃ€N KHÃC!                                             â”‚
  â”‚                                                              â”‚
  â”‚  KHI BUILD TOOL CHUYá»‚N ESM â†’ CJS:                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // ESM gá»‘c:                                          â”‚    â”‚
  â”‚  â”‚ export default function foo() {}                      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Sau khi chuyá»ƒn sang CJS:                          â”‚    â”‚
  â”‚  â”‚ Object.defineProperty(exports, "__esModule",         â”‚    â”‚
  â”‚  â”‚   { value: true });                                  â”‚    â”‚
  â”‚  â”‚ exports.default = foo;                               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Pháº£i "MÃ” PHá»NG" semantics cá»§a ESM!               â”‚    â”‚
  â”‚  â”‚ â†’ exports.default = giÃ¡ trá»‹ default export!         â”‚    â”‚
  â”‚  â”‚ â†’ __esModule = Ä‘Ã¡nh dáº¥u Ä‘Ã¢y lÃ  ESM converted!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÃ‚U Há»I THEN CHá»T:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ LÃ m sao PHÃ‚N BIá»†T:                                  â”‚    â”‚
  â”‚  â”‚ â€¢ "CJS module thÆ°á»ng" (viáº¿t tay!)                   â”‚    â”‚
  â”‚  â”‚ â€¢ "CJS module Ä‘Æ°á»£c CHUYá»‚N Tá»ª ESM" (bá»Ÿi Babel!)     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ __esModule chÃ­nh lÃ  CÃ‚U TRáº¢ Lá»œI!                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. \_\_esModule lÃ m gÃ¬ chÃ­nh xÃ¡c?

```
  __esModule LÃ€M GÃŒ:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  NÃ“ CHá»ˆ LÃ€ 1 MARKER!                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ exports.__esModule = true                            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ = "NÃ³i cho ngÆ°á»i khÃ¡c biáº¿t:                          â”‚    â”‚
  â”‚  â”‚    Module nÃ y Gá»C LÃ€ ES Module!"                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Háº¾T! Chá»‰ váº­y thÃ´i!                                 â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Táº I SAO DÃ™NG Object.defineProperty?                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // Thay vÃ¬:                                          â”‚    â”‚
  â”‚  â”‚ exports.__esModule = true;               // Ä‘Æ¡n giáº£nâ”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Babel dÃ¹ng:                                       â”‚    â”‚
  â”‚  â”‚ Object.defineProperty(exports, "__esModule",         â”‚    â”‚
  â”‚  â”‚   { value: true });                                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ LÃ DO:                                               â”‚    â”‚
  â”‚  â”‚ 1. NON-ENUMERABLE (khÃ´ng liá»‡t kÃª Ä‘Æ°á»£c!)            â”‚    â”‚
  â”‚  â”‚    â†’ for...in / Object.keys(exports) KHÃ”NG tháº¥y!   â”‚    â”‚
  â”‚  â”‚    â†’ TrÃ¡nh "Ã´ nhiá»…m" káº¿t quáº£ duyá»‡t!               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 2. TuÃ¢n theo chuáº©n output cá»§a Babel!                 â”‚    â”‚
  â”‚  â”‚    â†’ Quy Æ°á»›c chung cá»§a community!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 3. Descriptor máº·c Ä‘á»‹nh:                              â”‚    â”‚
  â”‚  â”‚    { value: true,                                    â”‚    â”‚
  â”‚  â”‚      writable: false,      â† KHÃ”NG ghi Ä‘Ã¨!         â”‚    â”‚
  â”‚  â”‚      enumerable: false,    â† KHÃ”NG liá»‡t kÃª!        â”‚    â”‚
  â”‚  â”‚      configurable: false } â† KHÃ”NG cáº¥u hÃ¬nh láº¡i!  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Váº¥n Ä‘á» cá»‘t lÃµi: Default Export Interop!

```
  Váº¤N Äá»€ Cá»T LÃ•I:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Ká»ŠCH Báº¢N KINH ÄIá»‚N:                                         â”‚
  â”‚                                                              â”‚
  â”‚  BÆ¯á»šC 1 â€” ESM gá»‘c:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // foo.js (ESM)                                      â”‚    â”‚
  â”‚  â”‚ export default function foo() {                      â”‚    â”‚
  â”‚  â”‚   console.log('Hello!');                             â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  BÆ¯á»šC 2 â€” Compiled sang CJS:                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // foo.js (compiled CJS)                             â”‚    â”‚
  â”‚  â”‚ Object.defineProperty(exports, "__esModule",         â”‚    â”‚
  â”‚  â”‚   { value: true });                                  â”‚    â”‚
  â”‚  â”‚ exports.default = foo;                               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ default export THÃ€NH exports.default!             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  BÆ¯á»šC 3 â€” Import báº±ng CJS:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ const foo = require('./foo');                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // foo THá»°C Táº¾ lÃ :                                   â”‚    â”‚
  â”‚  â”‚ {                                                    â”‚    â”‚
  â”‚  â”‚   __esModule: true,                                  â”‚    â”‚
  â”‚  â”‚   default: [Function: foo]   â† Náº°M TRONG .default! â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€ â€” CHÃšNG TA MUá»N:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ foo()                   â† Gá»i trá»±c tiáº¿p! âœ…        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  NHÆ¯NG THá»°C Táº¾ PHáº¢I:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ foo.default()           â† Pháº£i qua .default! ğŸ˜©    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
  â”‚                                                              â”‚
  â”‚  GIáº¢I PHÃP â€” _interopRequireDefault helper!                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ function _interopRequireDefault(obj) {               â”‚    â”‚
  â”‚  â”‚   return obj && obj.__esModule                       â”‚    â”‚
  â”‚  â”‚     ? obj          // ESM converted â†’ dÃ¹ng .default â”‚    â”‚
  â”‚  â”‚     : { default: obj } // CJS thÆ°á»ng â†’ wrap láº¡i!   â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ LOGIC:                                               â”‚    â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
  â”‚  â”‚ â”‚ CÃ“ __esModule?                                  â”‚  â”‚    â”‚
  â”‚  â”‚ â”‚   YES â†’ Module chuyá»ƒn tá»« ESM!                   â”‚  â”‚    â”‚
  â”‚  â”‚ â”‚         â†’ DÃ¹ng trá»±c tiáº¿p obj.default!           â”‚  â”‚    â”‚
  â”‚  â”‚ â”‚   NO  â†’ Module CJS thÆ°á»ng!                      â”‚  â”‚    â”‚
  â”‚  â”‚ â”‚         â†’ Wrap: { default: obj } Ä‘á»ƒ thá»‘ng nháº¥t! â”‚  â”‚    â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â†’ ÄÃ‚Y lÃ  chÃ¬a khÃ³a toÃ n bá»™ interoperability!              â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Táº¡i sao khÃ´ng kiá»ƒm tra thuá»™c tÃ­nh default?

```
  Táº I SAO KHÃ”NG KIá»‚M TRA .default?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â“ "Táº¡i sao khÃ´ng Ä‘Æ¡n giáº£n check obj.default?"              â”‚
  â”‚                                                              â”‚
  â”‚  VÃŒ CJS THÆ¯á»œNG CÅ¨NG CÃ“ THá»‚ CÃ“ .default!                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // CJS module thÆ°á»ng â€” VIáº¾T TAY!                     â”‚    â”‚
  â”‚  â”‚ module.exports = {                                   â”‚    â”‚
  â”‚  â”‚   default: something,   â† key tÃªn "default"!       â”‚    â”‚
  â”‚  â”‚   other: value                                       â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Object bÃ¬nh thÆ°á»ng TÃŒNH Cá»œ cÃ³ field "default"!   â”‚    â”‚
  â”‚  â”‚ â†’ KHÃ”NG pháº£i ESM converted!                         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHÃ”NG THá»‚ PHÃ‚N BIá»†T:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Case A: ESM compiled                                 â”‚    â”‚
  â”‚  â”‚ { default: foo, __esModule: true }                   â”‚    â”‚
  â”‚  â”‚ â†’ .default = LÃ€ default export!  âœ…                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Case B: CJS thÆ°á»ng                                   â”‚    â”‚
  â”‚  â”‚ { default: something }                               â”‚    â”‚
  â”‚  â”‚ â†’ .default = chá»‰ lÃ  1 key bÃ¬nh thÆ°á»ng!  âŒ         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Náº¿u chá»‰ check .default â†’ NHáº¦M Case B thÃ nh ESM!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â†’ Pháº£i cÃ³ "Dáº¤U HIá»†U CHÃNH THá»¨C" (official marker)!        â”‚
  â”‚  â†’ __esModule = de facto standard marker!                    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Khi nÃ o \_\_esModule Ä‘Æ°á»£c sinh ra?

```
  KHI NÃ€O SINH RA:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  ÄIá»€U KIá»†N: ESM â†’ CJS Translation!                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Báº¥t ká»³ khi nÃ o build tool CHUYá»‚N Äá»”I                â”‚    â”‚
  â”‚  â”‚ ES Module â†’ CommonJS â†’ háº§u háº¿t Ä‘á»u sinh __esModule!â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÃC Ká»ŠCH Báº¢N PHá»” BIáº¾N:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âœ… TypeScript compile: module = "commonjs"          â”‚    â”‚
  â”‚  â”‚    â†’ tsconfig: { "module": "commonjs" }             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… Babel preset-env: output CJS                     â”‚    â”‚
  â”‚  â”‚    â†’ @babel/preset-env + modules: "commonjs"        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… Webpack/RSpack: target node + CJS output         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… Node projects: mix import + require              â”‚    â”‚
  â”‚  â”‚    â†’ Legacy projects chuyá»ƒn Ä‘á»•i dáº§n!               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHI NÃ€O KHÃ”NG SINH:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âŒ package.json: { "type": "module" }               â”‚    â”‚
  â”‚  â”‚    â†’ Output native ESM â†’ KHÃ”NG cáº§n __esModule!     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ ESM â†’ ESM (khÃ´ng chuyá»ƒn Ä‘á»•i!)                   â”‚    â”‚
  â”‚  â”‚    â†’ Giá»¯ nguyÃªn format â†’ KHÃ”NG cáº§n marker!         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ Browser native ESM (type="module" script tag)    â”‚    â”‚
  â”‚  â”‚    â†’ TrÃ¬nh duyá»‡t hiá»ƒu ESM trá»±c tiáº¿p!              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ LÆ¯U Ã QUAN TRá»ŒNG:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ __esModule KHÃ”NG pháº£i tÃ­nh nÄƒng JavaScript!          â”‚    â”‚
  â”‚  â”‚ â†’ KhÃ´ng náº±m trong ECMAScript specification!         â”‚    â”‚
  â”‚  â”‚ â†’ LÃ  QUY Æ¯á»šC cá»§a Babel / Build tools!              â”‚    â”‚
  â”‚  â”‚ â†’ LÃ  TIÃŠU CHUáº¨N thá»±c táº¿ (de facto standard)!      â”‚    â”‚
  â”‚  â”‚ â†’ LÃ  giáº£i phÃ¡p táº§ng ENGINEERING level!              â”‚    â”‚
  â”‚  â”‚ â†’ LÃ  DI Sáº¢N QUÃ Äá»˜ cá»§a lá»‹ch sá»­ module system!    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Lá»‹ch sá»­ Module System â€” 3 Tháº¿ Há»‡!

```
  Lá»ŠCH Sá»¬ MODULE SYSTEM:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  THáº¾ Há»† 1: KHÃ”NG CÃ“ MODULE (Global Variables!)              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // Má»i thá»© = biáº¿n toÃ n cá»¥c!                         â”‚    â”‚
  â”‚  â”‚ var myLib = {}                                       â”‚    â”‚
  â”‚  â”‚ myLib.foo = function() {}                            â”‚    â”‚
  â”‚  â”‚ myLib.bar = function() {}                            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Namespace pattern                                 â”‚    â”‚
  â”‚  â”‚ â†’ IIFE pattern                                      â”‚    â”‚
  â”‚  â”‚ â†’ Dá»… xung Ä‘á»™t tÃªn!                                 â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  THáº¾ Há»† 2: COMMONJS (Node.js Era!)                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // Export:                                           â”‚    â”‚
  â”‚  â”‚ module.exports = { foo, bar }                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Import:                                           â”‚    â”‚
  â”‚  â”‚ const { foo, bar } = require('./module')             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Synchronous loading!                              â”‚    â”‚
  â”‚  â”‚ â†’ Server-side (Node.js)!                            â”‚    â”‚
  â”‚  â”‚ â†’ ToÃ n bá»™ há»‡ sinh thÃ¡i npm dÃ¹ng CJS!              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  THáº¾ Há»† 3: ES MODULES (TiÃªu Chuáº©n HÃ³a!)                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // Export:                                           â”‚    â”‚
  â”‚  â”‚ export default function foo() {}                     â”‚    â”‚
  â”‚  â”‚ export const bar = 42                                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // Import:                                           â”‚    â”‚
  â”‚  â”‚ import foo from './module'                           â”‚    â”‚
  â”‚  â”‚ import { bar } from './module'                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Static analysis (tree-shaking!)                   â”‚    â”‚
  â”‚  â”‚ â†’ Async loading!                                    â”‚    â”‚
  â”‚  â”‚ â†’ Language specification!                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
  â”‚                                                              â”‚
  â”‚  Váº¤N Äá»€:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Há»‡ sinh thÃ¡i Node.js/npm ÄÃƒ XÃ‚Y Dá»°NG trÃªn CJS!    â”‚    â”‚
  â”‚  â”‚ â†’ HÃ ng triá»‡u packages dÃ¹ng require/module.exports! â”‚    â”‚
  â”‚  â”‚ â†’ Code má»›i dÃ¹ng import/export (ESM)!                â”‚    â”‚
  â”‚  â”‚ â†’ Cáº¦N Cáº¦U Ná»I giá»¯a 2 tháº¿ giá»›i!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ __esModule = Má»˜T VIÃŠN Gáº CH cá»§a Cáº¦U Ná»I Ä‘Ã³!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Tá»“n táº¡i KHÃ”NG vÃ¬ thiáº¿t káº¿ Ä‘áº¹p,                     â”‚    â”‚
  â”‚  â”‚ mÃ  vÃ¬ TÆ¯Æ NG THÃCH Lá»ŠCH Sá»¬!                         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. PhÃ¢n TÃ­ch HÃ¬nh Gá»‘c!

> **BÃ i gá»‘c cÃ³ 1 screenshot** â€” build output code trong VSCode.

```
  HÃŒNH Gá»C â€” BUILD OUTPUT (app.controller.js):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  MÃ” Táº¢:                                                       â”‚
  â”‚  Screenshot tá»« VSCode hiá»ƒn thá»‹ file dist/app.controller.js   â”‚
  â”‚  â€” káº¿t quáº£ build tá»« NestJS TypeScript project!               â”‚
  â”‚                                                              â”‚
  â”‚  Ná»˜I DUNG:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  1  "use strict";                                    â”‚    â”‚
  â”‚  â”‚  2  var __decorate = (this && this.__decorate) || ..â”‚    â”‚
  â”‚  â”‚  3    var c = arguments.length, r = c < 3 ? ...     â”‚    â”‚
  â”‚  â”‚  ...                                                 â”‚    â”‚
  â”‚  â”‚  8  var __metadata = (this && this.__metadata) || ..â”‚    â”‚
  â”‚  â”‚  ...                                                 â”‚    â”‚
  â”‚  â”‚ 11  Object.defineProperty(exports, "__esModule",     â”‚    â”‚
  â”‚  â”‚       { value: true });   â† MÅ¨I TÃŠN Äá» CHá»ˆ ÄÃ‚Y!  â”‚    â”‚
  â”‚  â”‚ 12  exports.AppController = void 0;                  â”‚    â”‚
  â”‚  â”‚ 13  const openapi = require("@nestjs/swagger");      â”‚    â”‚
  â”‚  â”‚ 14  const common_1 = require("@nestjs/common");      â”‚    â”‚
  â”‚  â”‚ 15  const app_service_1 = require("./app.service");  â”‚    â”‚
  â”‚  â”‚ 16  let AppController = class AppController {        â”‚    â”‚
  â”‚  â”‚ 17    appService;                                    â”‚    â”‚
  â”‚  â”‚ 18    constructor(appService) {                      â”‚    â”‚
  â”‚  â”‚ 19      this.appService = appService;                â”‚    â”‚
  â”‚  â”‚ 20    }                                              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  PHÃ‚N TÃCH:                                                   â”‚
  â”‚                                                              â”‚
  â”‚  DÃ’NG 1: "use strict"                                         â”‚
  â”‚  â†’ Strict mode â€” tiÃªu chuáº©n cho compiled output!            â”‚
  â”‚                                                              â”‚
  â”‚  DÃ’NG 2-10: Babel/TS helper functions                         â”‚
  â”‚  â†’ __decorate: Decorator pattern cho NestJS!                 â”‚
  â”‚  â†’ __metadata: Metadata reflection cho dependency injection! â”‚
  â”‚  â†’ Helpers Ä‘Æ°á»£c "inline" vÃ o má»—i file!                      â”‚
  â”‚                                                              â”‚
  â”‚  â˜… DÃ’NG 11: Object.defineProperty(exports, "__esModule"...)  â”‚
  â”‚  â†’ ÄÃšNG DÃ’NG mÅ©i tÃªn Ä‘á» chá»‰ tá»›i!                          â”‚
  â”‚  â†’ Marker: "File nÃ y Gá»C lÃ  TypeScript ESM!"               â”‚
  â”‚  â†’ TypeScript compile ra CJS (module: "commonjs")!          â”‚
  â”‚  â†’ Build tool: tsc (TypeScript compiler)!                    â”‚
  â”‚                                                              â”‚
  â”‚  DÃ’NG 12: exports.AppController = void 0                     â”‚
  â”‚  â†’ "Hoisting" â€” khai bÃ¡o trÆ°á»›c, gÃ¡n giÃ¡ trá»‹ sau!            â”‚
  â”‚  â†’ void 0 = undefined (placeholder!)                         â”‚
  â”‚                                                              â”‚
  â”‚  DÃ’NG 13-15: require(...)                                     â”‚
  â”‚  â†’ CJS imports! ESM import â†’ require sau khi compile!       â”‚
  â”‚  â†’ import { Controller } from '@nestjs/common'              â”‚
  â”‚    â†’ const common_1 = require("@nestjs/common")             â”‚
  â”‚                                                              â”‚
  â”‚  DÃ’NG 16+: Class definition                                   â”‚
  â”‚  â†’ AppController class = CJS module.exports member!          â”‚
  â”‚                                                              â”‚
  â”‚  Káº¾T LUáº¬N:                                                    â”‚
  â”‚  â†’ NestJS (TypeScript) compile target = CJS!                 â”‚
  â”‚  â†’ Má»—i file .ts (ESM) â†’ .js (CJS) + __esModule marker!    â”‚
  â”‚  â†’ Helpers (__decorate, __metadata) injected inline!         â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. SÆ¡ Äá»“ Tá»± Váº½!

### SÆ¡ Äá»“ 1: ESM â†’ CJS Compile Flow

```
  ESM â†’ CJS COMPILATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SOURCE CODE (ESM):                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ import { Injectable } from '@nestjs/common';         â”‚    â”‚
  â”‚  â”‚ export default class AppService {                    â”‚    â”‚
  â”‚  â”‚   getHello() { return 'Hello!'; }                    â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                              â”‚                               â”‚
  â”‚                              â–¼                               â”‚
  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
  â”‚                    â”‚ BUILD TOOL       â”‚                      â”‚
  â”‚                    â”‚ (tsc / Babel /   â”‚                      â”‚
  â”‚                    â”‚  Webpack / RSpack)â”‚                     â”‚
  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
  â”‚                              â”‚                               â”‚
  â”‚                              â–¼                               â”‚
  â”‚  BUILD OUTPUT (CJS):                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ "use strict";                                        â”‚    â”‚
  â”‚  â”‚ Object.defineProperty(exports, "__esModule",         â”‚    â”‚
  â”‚  â”‚   { value: true });              â† â˜… MARKER!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ const common_1 = require("@nestjs/common");          â”‚    â”‚
  â”‚  â”‚                  â†‘ import â†’ require!                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ class AppService {                                   â”‚    â”‚
  â”‚  â”‚   getHello() { return 'Hello!'; }                    â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚ exports.default = AppService;                        â”‚    â”‚
  â”‚  â”‚            â†‘ export default â†’ exports.default!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  MAPPING:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ ESM                  â”‚  â”‚ CJS (compiled)           â”‚     â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
  â”‚  â”‚ import x from 'y'   â”‚â†’â”‚ const x = require('y')   â”‚     â”‚
  â”‚  â”‚ export default foo   â”‚â†’â”‚ exports.default = foo    â”‚     â”‚
  â”‚  â”‚ export const bar    â”‚â†’â”‚ exports.bar = bar         â”‚     â”‚
  â”‚  â”‚ export { baz }      â”‚â†’â”‚ exports.baz = baz         â”‚     â”‚
  â”‚  â”‚ (module identity)   â”‚â†’â”‚ __esModule = true         â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 2: \_interopRequireDefault Decision Tree

```
  _interopRequireDefault FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  const mod = require('./module')                             â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  _interopRequireDefault(mod)                                 â”‚
  â”‚       â”‚                                                      â”‚
  â”‚       â–¼                                                      â”‚
  â”‚  â”Œâ”€â”€â”€ mod.__esModule? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  YES (true)                   NO (undefined/false)   â”‚    â”‚
  â”‚  â”‚  â”‚                            â”‚                      â”‚    â”‚
  â”‚  â”‚  â–¼                            â–¼                      â”‚    â”‚
  â”‚  â”‚  Module ÄÃƒ CHUYá»‚N tá»« ESM!   Module CJS THÆ¯á»œNG!     â”‚    â”‚
  â”‚  â”‚  â†’ .default IS the export!   â†’ Whole obj IS export!â”‚    â”‚
  â”‚  â”‚  â†’ return mod (as is!)       â†’ return {default:mod}â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
  â”‚  â”‚  â”‚ mod = {             â”‚    â”‚ mod = function() {} â”‚ â”‚    â”‚
  â”‚  â”‚  â”‚   __esModule: true, â”‚    â”‚ â†“ wrap              â”‚ â”‚    â”‚
  â”‚  â”‚  â”‚   default: foo      â”‚    â”‚ { default: mod }    â”‚ â”‚    â”‚
  â”‚  â”‚  â”‚ }                   â”‚    â”‚ â†’ thá»‘ng nháº¥t API!   â”‚ â”‚    â”‚
  â”‚  â”‚  â”‚ â†’ result.default    â”‚    â”‚ â†’ result.default    â”‚ â”‚    â”‚
  â”‚  â”‚  â”‚   = foo âœ…          â”‚    â”‚   = mod âœ…          â”‚ â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â†’ Cáº£ 2 case: truy cáº­p qua .default = THá»NG NHáº¤T!         â”‚
  â”‚  â†’ __esModule = CHÃŒA KHÃ“A phÃ¢n biá»‡t 2 loáº¡i module!        â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 3: Module System Evolution Timeline

```
  TIMELINE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  ~2000          2009          2015          2020+            â”‚
  â”‚    â”‚              â”‚             â”‚             â”‚               â”‚
  â”‚    â–¼              â–¼             â–¼             â–¼               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚Globalâ”‚   â”‚CommonJS  â”‚  â”‚ES Moduleâ”‚  â”‚Native ESM    â”‚    â”‚
  â”‚  â”‚ Vars â”‚   â”‚(Node.js) â”‚  â”‚(ES2015) â”‚  â”‚in Node 14+!  â”‚    â”‚
  â”‚  â”‚      â”‚   â”‚          â”‚  â”‚         â”‚  â”‚              â”‚    â”‚
  â”‚  â”‚ var  â”‚   â”‚require() â”‚  â”‚import   â”‚  â”‚type:"module" â”‚    â”‚
  â”‚  â”‚ IIFE â”‚   â”‚module.   â”‚  â”‚export   â”‚  â”‚.mjs files    â”‚    â”‚
  â”‚  â”‚      â”‚   â”‚ exports  â”‚  â”‚default  â”‚  â”‚No __esModule!â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                    â”‚             â”‚                            â”‚
  â”‚                    â”‚    â•”â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•—                    â”‚
  â”‚                    â”‚    â•‘  BUILD TOOLS   â•‘                    â”‚
  â”‚                    â”‚    â•‘  Babel / tsc / â•‘                    â”‚
  â”‚                    â”‚    â•‘  Webpack       â•‘                    â”‚
  â”‚                    â”‚    â•šâ•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•                    â”‚
  â”‚                    â”‚            â”‚                             â”‚
  â”‚                    â–¼            â–¼                             â”‚
  â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
  â”‚               â”‚  __esModule = true   â”‚                       â”‚
  â”‚               â”‚  Cáº¦U Ná»I giá»¯a       â”‚                       â”‚
  â”‚               â”‚  CJS â†â†’ ESM!       â”‚                       â”‚
  â”‚               â”‚                      â”‚                       â”‚
  â”‚               â”‚  Di sáº£n quÃ¡ Ä‘á»™!     â”‚                       â”‚
  â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. Tá»± Viáº¿t â€” ModuleInteropEngine!

```javascript
/**
 * ModuleInteropEngine â€” MÃ´ phá»ng toÃ n bá»™ cÆ¡ cháº¿ __esModule!
 * Tá»± viáº¿t báº±ng tay, KHÃ”NG dÃ¹ng thÆ° viá»‡n nÃ o!
 * Covers: ESMâ†’CJS compile, interop, default import
 */
var ModuleInteropEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. SIMULATE ESM â†’ CJS COMPILATION
  // Babel/tsc chuyá»ƒn ESM sang CJS ra sao?
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function compileEsmToCjs(esmModule) {
    // Táº¡o CJS exports object
    var exports = {};

    // â˜… BÆ°á»›c 1: ÄÃ¡nh dáº¥u __esModule! (Object.defineProperty!)
    Object.defineProperty(exports, "__esModule", {
      value: true,
      // writable: false (default)
      // enumerable: false (default) â† KHÃ”NG liá»‡t kÃª!
      // configurable: false (default)
    });

    // BÆ°á»›c 2: Map tá»«ng export sang exports.*
    if (esmModule.defaultExport !== undefined) {
      exports.default = esmModule.defaultExport;
    }
    if (esmModule.namedExports) {
      for (var key in esmModule.namedExports) {
        exports[key] = esmModule.namedExports[key];
      }
    }

    return exports;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. _interopRequireDefault
  // Helper Babel sinh ra Ä‘á»ƒ import default!
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function _interopRequireDefault(obj) {
    return obj && obj.__esModule
      ? obj // ESM converted â†’ dÃ¹ng trá»±c tiáº¿p!
      : { default: obj }; // CJS thÆ°á»ng â†’ wrap!
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. _interopRequireWildcard
  // Helper cho import * as ns from '...'
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
      return obj; // ESM â†’ Ä‘Ã£ cÃ³ namespace object!
    }
    // CJS â†’ táº¡o namespace object!
    var newObj = {};
    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          newObj[key] = obj[key];
        }
      }
    }
    newObj.default = obj;
    return newObj;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. CHECK â€” __esModule properties
  // Kiá»ƒm tra tÃ­nh cháº¥t cá»§a marker
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function inspectMarker(exports) {
    var descriptor = Object.getOwnPropertyDescriptor(exports, "__esModule");
    return {
      exists: "__esModule" in exports,
      value: exports.__esModule,
      enumerable: descriptor ? descriptor.enumerable : "N/A",
      writable: descriptor ? descriptor.writable : "N/A",
      configurable: descriptor ? descriptor.configurable : "N/A",
      visibleInForIn: (function () {
        var keys = [];
        for (var k in exports) {
          keys.push(k);
        }
        return keys.indexOf("__esModule") !== -1;
      })(),
      visibleInKeys: Object.keys(exports).indexOf("__esModule") !== -1,
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘  MODULE INTEROP ENGINE â€” DEMO               â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // 1. Compile ESM â†’ CJS
    console.log("\n--- 1. ESM â†’ CJS COMPILATION ---");
    var esmFoo = {
      defaultExport: function foo() {
        return "Hello!";
      },
      namedExports: { bar: 42, baz: "world" },
    };
    var cjsFoo = compileEsmToCjs(esmFoo);
    console.log(
      "compiled exports:",
      JSON.stringify({
        __esModule: cjsFoo.__esModule,
        hasDefault: typeof cjsFoo.default === "function",
        bar: cjsFoo.bar,
        baz: cjsFoo.baz,
      }),
    );

    // 2. interopRequireDefault â€” ESM converted module
    console.log("\n--- 2. INTEROP â€” ESM CONVERTED ---");
    var imported1 = _interopRequireDefault(cjsFoo);
    console.log("imported1.default:", imported1.default());
    // â†’ 'Hello!' âœ…

    // 3. interopRequireDefault â€” Regular CJS module
    console.log("\n--- 3. INTEROP â€” CJS THÆ¯á»œNG ---");
    var cjsRegular = function greet() {
      return "Hi!";
    };
    var imported2 = _interopRequireDefault(cjsRegular);
    console.log("imported2.default:", imported2.default());
    // â†’ 'Hi!' âœ… (Ä‘Æ°á»£c wrap!)

    // 4. Inspect marker properties
    console.log("\n--- 4. MARKER PROPERTIES ---");
    console.log(JSON.stringify(inspectMarker(cjsFoo), null, 2));
    // â†’ enumerable: false, writable: false!

    // 5. Enumeration test
    console.log("\n--- 5. ENUMERATION TEST ---");
    console.log("Object.keys:", Object.keys(cjsFoo));
    // â†’ ['default', 'bar', 'baz'] â€” NO __esModule!
    console.log("__esModule visible?", "__esModule" in cjsFoo);
    // â†’ true (exists, but not enumerable!)

    // 6. Why not just check .default?
    console.log("\n--- 6. Táº I SAO KHÃ”NG CHECK .default? ---");
    var tricky = { default: "something" }; // CJS thÆ°á»ng!
    console.log("tricky.__esModule:", tricky.__esModule);
    // â†’ undefined! KhÃ´ng pháº£i ESM!
    console.log("tricky.default:", tricky.default);
    // â†’ 'something' â€” CÃ“ .default nhÆ°ng KHÃ”NG pháº£i ESM!

    console.log("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘  âœ… Demo Complete!                           â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
  }

  return {
    compileEsmToCjs: compileEsmToCjs,
    _interopRequireDefault: _interopRequireDefault,
    _interopRequireWildcard: _interopRequireWildcard,
    inspectMarker: inspectMarker,
    demo: demo,
  };
})();

// Cháº¡y: ModuleInteropEngine.demo();
```

---

## Â§11. CÃ¢u Há»i Luyá»‡n Táº­p!

### â“ CÃ¢u 1: \_\_esModule lÃ  gÃ¬? Giáº£i thÃ­ch báº±ng 1 cÃ¢u!

**Tráº£ lá»i:**

`__esModule = true` = **marker** nÃ³i ráº±ng "File CJS nÃ y Ä‘Æ°á»£c CHUYá»‚N Äá»”I tá»« ES Module bá»Ÿi build tool" â€” dÃ¹ng Ä‘á»ƒ **tÆ°Æ¡ng thÃ­ch** default export semantics giá»¯a ESM vÃ  CJS!

### â“ CÃ¢u 2: Táº¡i sao dÃ¹ng Object.defineProperty thay vÃ¬ gÃ¡n trá»±c tiáº¿p?

**Tráº£ lá»i:**

| CÃ¡ch                                                            | Káº¿t quáº£                                                                    |
| --------------------------------------------------------------- | -------------------------------------------------------------------------- |
| `exports.__esModule = true`                                     | **Enumerable!** â†’ xuáº¥t hiá»‡n trong `for...in`, `Object.keys()` â†’ "Ã´ nhiá»…m"! |
| `Object.defineProperty(exports, "__esModule", { value: true })` | **Non-enumerable!** (default) â†’ KHÃ”NG xuáº¥t hiá»‡n khi duyá»‡t! Clean!          |

â†’ defineProperty cho `enumerable: false`, `writable: false`, `configurable: false`!
â†’ TrÃ¡nh Ã´ nhiá»…m káº¿t quáº£ duyá»‡t + khÃ´ng bá»‹ ghi Ä‘Ã¨!

### â“ CÃ¢u 3: \_interopRequireDefault hoáº¡t Ä‘á»™ng tháº¿ nÃ o?

**Tráº£ lá»i:**

```javascript
function _interopRequireDefault(obj) {
  return obj && obj.__esModule
    ? obj // CÃ“ marker â†’ ESM converted â†’ dÃ¹ng trá»±c tiáº¿p!
    : { default: obj }; // KHÃ”NG cÃ³ â†’ CJS thÆ°á»ng â†’ wrap láº¡i!
}
```

â†’ Cáº£ 2 case: truy cáº­p `.default` Ä‘á»ƒ láº¥y giÃ¡ trá»‹ = **THá»NG NHáº¤T API**!
â†’ `__esModule` = chÃ¬a khÃ³a phÃ¢n biá»‡t!

### â“ CÃ¢u 4: Táº¡i sao khÃ´ng Ä‘Æ¡n giáº£n check .default?

**Tráº£ lá»i:**

VÃ¬ CJS thÆ°á»ng **CÅ¨NG CÃ“ THá»‚** cÃ³ field `.default`!

```javascript
// CJS thÆ°á»ng â€” VIáº¾T TAY!
module.exports = { default: "something" };
// â†’ CÃ“ .default nhÆ°ng KHÃ”NG pháº£i ESM!
```

â†’ KhÃ´ng thá»ƒ phÃ¢n biá»‡t ESM converted vs CJS tÃ¬nh cá» cÃ³ key "default"!
â†’ Cáº§n **official marker** â†’ `__esModule = true`!

### â“ CÃ¢u 5: \_\_esModule cÃ³ pháº£i tÃ­nh nÄƒng JavaScript khÃ´ng?

**Tráº£ lá»i:**

**KHÃ”NG!** `__esModule`:

- âŒ KHÃ”NG náº±m trong ECMAScript specification!
- âœ… LÃ  quy Æ°á»›c cá»§a Babel!
- âœ… LÃ  convention cá»§a build tools!
- âœ… LÃ  community de facto standard!
- âœ… LÃ  giáº£i phÃ¡p táº§ng **engineering level**!
- âœ… LÃ  **di sáº£n quÃ¡ Ä‘á»™** cá»§a lá»‹ch sá»­ module system!

### â“ CÃ¢u 6: Khi nÃ o KHÃ”NG cáº§n \_\_esModule?

**Tráº£ lá»i:**

Khi output lÃ  **native ESM** â€” khÃ´ng cáº§n bridge!

- `package.json: { "type": "module" }` â†’ native ESM! âŒ khÃ´ng cáº§n
- `.mjs` files â†’ native ESM! âŒ khÃ´ng cáº§n
- Browser `<script type="module">` â†’ native ESM! âŒ khÃ´ng cáº§n
- ESM â†’ ESM (khÃ´ng chuyá»ƒn Ä‘á»•i!) â†’ âŒ khÃ´ng cáº§n

Chá»‰ cáº§n khi: **ESM â†’ CJS translation** xáº£y ra!

### â“ CÃ¢u 7: XÃ³a \_\_esModule cÃ³ sao khÃ´ng?

**Tráº£ lá»i:**

**CÃ“ Váº¤N Äá»€!** Náº¿u xÃ³a:

- `_interopRequireDefault` sáº½ **NHáº¦M** module lÃ  CJS thÆ°á»ng!
- Sáº½ **wrap** thÃªm lá»›p `{ default: obj }` â†’ `obj.default.default` = BUG!
- Default import sáº½ **BROKEN**!

â†’ **KHÃ”NG XÃ“A!** ÄÃ¢y lÃ  marker quan trá»ng cho build tool interop!

---

> ğŸ¯ **Tá»•ng káº¿t \_\_esModule:**
>
> - **Báº£n cháº¥t**: Marker â€” "Module CJS nÃ y gá»‘c lÃ  ESM!"
> - **Má»¥c Ä‘Ã­ch**: TÆ°Æ¡ng thÃ­ch default export semantics giá»¯a ESM â†” CJS!
> - **CÆ¡ cháº¿**: `_interopRequireDefault` check marker â†’ quyáº¿t Ä‘á»‹nh wrap hay khÃ´ng!
> - **defineProperty**: Non-enumerable, non-writable, non-configurable!
> - **KhÃ´ng pháº£i JS spec**: Engineering convention, Babel/community standard!
> - **Lá»‹ch sá»­**: Di sáº£n quÃ¡ Ä‘á»™ tá»« CJS â†’ ESM, sáº½ máº¥t dáº§n khi native ESM phá»• biáº¿n!
> - **1 hÃ¬nh gá»‘c**: Build output NestJS â€” dÃ²ng 11 highlight \_\_esModule!
> - **ModuleInteropEngine**: compile, interopDefault, interopWildcard, inspectMarker!
> - **7 cÃ¢u há»i** luyá»‡n táº­p vá»›i Ä‘Ã¡p Ã¡n chi tiáº¿t!
