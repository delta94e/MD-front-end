# JavaScript Deep Dive

> TÃ i liá»‡u há»c táº­p chuyÃªn sÃ¢u vá» JavaScript, TypeScript vÃ  ES6 cho Frontend Developer

---

## 1. JavaScript Data Types

JavaScript lÃ  ngÃ´n ngá»¯ **dynamically typed** â€” nghÄ©a lÃ  báº¡n khÃ´ng cáº§n khai bÃ¡o kiá»ƒu dá»¯ liá»‡u khi táº¡o biáº¿n, engine sáº½ tá»± xÃ¡c Ä‘á»‹nh kiá»ƒu táº¡i runtime. Äiá»u nÃ y nghe cÃ³ váº» "tiá»‡n", nhÆ°ng thá»±c táº¿ nÃ³ lÃ  **con dao hai lÆ°á»¡i** Ä‘Ã£ gÃ¢y ra vÃ´ sá»‘ bug trong lá»‹ch sá»­ phÃ¡t triá»ƒn web.

Hiá»ƒu sÃ¢u vá» Data Types khÃ´ng chá»‰ lÃ  biáº¿t "JS cÃ³ 8 kiá»ƒu". ÄÃ¢y lÃ  ná»n táº£ng Ä‘á»ƒ hiá»ƒu **táº¡i sao `0.1 + 0.2 !== 0.3`**, táº¡i sao `typeof null === "object"` (má»™t bug 30 nÄƒm khÃ´ng sá»­a Ä‘Æ°á»£c), vÃ  táº¡i sao React team khuyÃªn dÃ¹ng `Object.is()` thay vÃ¬ `===` trong dependency comparison. Náº¿u báº¡n Ä‘i phá»ng váº¥n Senior Frontend mÃ  khÃ´ng giáº£i thÃ­ch Ä‘Æ°á»£c nhá»¯ng Ä‘iá»u nÃ y á»Ÿ má»©c First Principles, báº¡n sáº½ bá»‹ Ä‘Ã¡nh giÃ¡ lÃ  "chá»‰ biáº¿t dÃ¹ng, khÃ´ng hiá»ƒu báº£n cháº¥t".

Pháº§n nÃ y sáº½ Ä‘i tá»« **bá» máº·t** (8 kiá»ƒu lÃ  gÃ¬?) Ä‘áº¿n **chiá»u sÃ¢u** (chÃºng Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› ra sao? V8 engine xá»­ lÃ½ chÃºng tháº¿ nÃ o? Táº¡i sao kiáº¿n trÃºc hiá»‡n táº¡i láº¡i nhÆ° váº­y?)

### Overview: 8 Data Types

JavaScript cÃ³ Ä‘Ãºng **8 kiá»ƒu dá»¯ liá»‡u** â€” con sá»‘ nÃ y quan trá»ng vÃ¬ nÃ³ KHÃ”NG THAY Äá»”I suá»‘t hÃ ng chá»¥c nÄƒm (chá»‰ thÃªm Symbol nÄƒm 2015 vÃ  BigInt nÄƒm 2020). TÃ¡m kiá»ƒu nÃ y chia thÃ nh 2 nhÃ³m cÃ³ báº£n cháº¥t hoÃ n toÃ n khÃ¡c nhau:

- **Primitive Types (7 kiá»ƒu)**: ÄÃ¢y lÃ  cÃ¡c giÃ¡ trá»‹ "nguyÃªn tá»­" â€” khÃ´ng thá»ƒ phÃ¢n tÃ¡ch nhá» hÆ¡n. Khi báº¡n viáº¿t `let x = 42`, con sá»‘ 42 Ä‘Æ°á»£c lÆ°u **trá»±c tiáº¿p** trong biáº¿n. Giá»‘ng nhÆ° khi báº¡n viáº¿t má»™t con sá»‘ lÃªn tá» giáº¥y â€” tá» giáº¥y **chá»©a** con sá»‘ Ä‘Ã³.

- **Reference Type (1 kiá»ƒu â€” Object)**: ÄÃ¢y lÃ  kiá»ƒu "tham chiáº¿u" â€” biáº¿n khÃ´ng chá»©a giÃ¡ trá»‹ thá»±c, mÃ  chá»©a **Ä‘á»‹a chá»‰** trá» Ä‘áº¿n nÆ¡i lÆ°u giÃ¡ trá»‹. Giá»‘ng nhÆ° tá» giáº¥y chá»‰ ghi **Ä‘á»‹a chá»‰ nhÃ ** â€” muá»‘n biáº¿t trong nhÃ  cÃ³ gÃ¬, báº¡n pháº£i Ä‘i Ä‘áº¿n Ä‘á»‹a chá»‰ Ä‘Ã³.

Táº¡i sao láº¡i thiáº¿t káº¿ 2 nhÃ³m? VÃ¬ Ä‘Ã¢y lÃ  sá»± **Ä‘Ã¡nh Ä‘á»•i giá»¯a tá»‘c Ä‘á»™ vÃ  linh hoáº¡t**: primitives nhá» gá»n, truy xuáº¥t nhanh (stack), nhÆ°ng cá»‘ Ä‘á»‹nh kÃ­ch thÆ°á»›c. Objects linh hoáº¡t (cÃ³ thá»ƒ thÃªm/xÃ³a property), nhÆ°ng cháº­m hÆ¡n vÃ¬ pháº£i qua pointer (heap). Má»i ngÃ´n ngá»¯ láº­p trÃ¬nh Ä‘á»u cÃ³ sá»± phÃ¢n chia nÃ y â€” Java cÃ³ primitive vs object, C cÃ³ value vs pointer, Go cÃ³ value vs reference types.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JAVASCRIPT DATA TYPES (8 types)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                PRIMITIVE TYPES (7)                         â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Number    String    Boolean    null    undefined          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Symbol (ES6)              BigInt (ES2020)                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Stored in STACK memory                                 â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Fixed size, immutable                                  â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Copied by VALUE                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                REFERENCE TYPE (1)                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Object                                                    â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Array                                               â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Function                                            â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Date                                                â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ RegExp                                              â”‚  â”‚
â”‚  â”‚    â”œâ”€â”€ Map, Set, WeakMap, WeakSet                          â”‚  â”‚
â”‚  â”‚    â””â”€â”€ Wrapper Objects (String, Number, Boolean)           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Value stored in HEAP memory                            â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Reference (pointer) stored in STACK                    â”‚  â”‚
â”‚  â”‚  ğŸ“Œ Copied by REFERENCE                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### V8 Tagged Values â€” CÃ¡ch Engine PhÃ¢n Biá»‡t Types á» Má»©c Bit

Báº¡n Ä‘Ã£ biáº¿t JS cÃ³ 8 kiá»ƒu dá»¯ liá»‡u. NhÆ°ng **V8 engine** (Chrome/Node.js) khÃ´ng phÃ¢n biá»‡t chÃºng báº±ng tÃªn â€” nÃ³ phÃ¢n biá»‡t báº±ng **bit pattern**. ÄÃ¢y lÃ  kiáº¿n thá»©c mÃ  99% frontend developers khÃ´ng biáº¿t, nhÆ°ng nÃ³ giáº£i thÃ­ch **táº¡i sao** má»™t sá»‘ operations nhanh gáº¥p 10 láº§n so vá»›i operations khÃ¡c.

**Tagged Pointers â€” Ká»¹ thuáº­t ná»n táº£ng:**

V8 dÃ¹ng má»™t ká»¹ thuáº­t gá»i lÃ  "pointer tagging" (gáº¯n tháº» con trá»). TrÃªn há»‡ thá»‘ng 64-bit, má»—i giÃ¡ trá»‹ JS chiáº¿m **64 bits** (8 bytes). V8 dÃ¹ng **bit cuá»‘i cÃ¹ng** (least significant bit) Ä‘á»ƒ phÃ¢n biá»‡t 2 loáº¡i:

- **Bit cuá»‘i = 1** â†’ ÄÃ¢y lÃ  **Smi** (Small Integer). GiÃ¡ trá»‹ thá»±c = 63 bits cÃ²n láº¡i >> 1. VÃ­ dá»¥: sá»‘ `42` Ä‘Æ°á»£c lÆ°u trá»±c tiáº¿p trong 63 bits, KHÃ”NG cáº§n cáº¥p phÃ¡t heap. ÄÃ¢y lÃ  lÃ½ do phÃ©p tÃ­nh sá»‘ nguyÃªn nhá» **cá»±c ká»³ nhanh** â€” khÃ´ng cÃ³ pointer, khÃ´ng cÃ³ heap allocation, khÃ´ng cÃ³ GC pressure.

- **Bit cuá»‘i = 0** â†’ ÄÃ¢y lÃ  **HeapObject pointer**. 63 bits cÃ²n láº¡i lÃ  Ä‘á»‹a chá»‰ Ä‘áº¿n object trÃªn heap. V8 Ä‘á»c "Map" (Hidden Class) á»Ÿ Ä‘áº§u heap object Ä‘á»ƒ biáº¿t Ä‘Ã¢y lÃ  Number, String, Array, hay Object.

**Táº¡i sao Ä‘iá»u nÃ y quan trá»ng?**

Khi báº¡n viáº¿t `let x = 42`, V8 KHÃ”NG táº¡o object Number trÃªn heap. NÃ³ lÆ°u `42` trá»±c tiáº¿p dÆ°á»›i dáº¡ng Smi trong stack â€” tá»•ng cá»™ng **1 CPU instruction** Ä‘á»ƒ Ä‘á»c. NhÆ°ng khi báº¡n viáº¿t `let x = 3.14`, V8 PHáº¢I táº¡o HeapNumber vÃ¬ 3.14 khÃ´ng fit vÃ o Smi format â†’ cáº§n allocate trÃªn heap â†’ cháº­m hÆ¡n.

ÄÃ¢y lÃ  lÃ½ do code dÃ¹ng **sá»‘ nguyÃªn nhá»** (dÆ°á»›i 2^31) nhanh hÆ¡n sá»‘ tháº­p phÃ¢n trong V8 â€” khÃ´ng pháº£i vÃ¬ "sá»‘ nguyÃªn Ä‘Æ¡n giáº£n hÆ¡n", mÃ  vÃ¬ **Smi bypass hoÃ n toÃ n heap allocation**. React's virtual DOM reconciliation táº­n dá»¥ng Ä‘iá»u nÃ y: index-based comparison (`key={0}`, `key={1}`) nhanh hÆ¡n string-based (`key="item-0"`) vÃ¬ integer keys lÃ  Smi.

```javascript
// V8 Smi optimization â€” táº¡i sao integer nhanh hÆ¡n float

// âœ… Smi path (NHANH) â€” lÆ°u trá»±c tiáº¿p, 0 heap allocation
let count = 0; // Smi: 0 â†’ tagged: 0b...0001
count++; // Smi: 1 â†’ tagged: 0b...0011
// CPU instruction duy nháº¥t: increment + shift

// âŒ HeapNumber path (CHáº¬M) â€” pháº£i allocate trÃªn heap
let price = 19.99; // HeapNumber: pointer â†’ heap { 19.99 }
price += 0.01; // Allocate HeapNumber Má»šI: pointer â†’ heap { 20.0 }
// GC pháº£i dá»n HeapNumber cÅ©!

// âœ… BEST PRACTICE trong hot loops:
for (let i = 0; i < 1000000; i++) {
  // i lÃ  Smi â†’ NHANH
  // process...
}

// âŒ AVOID trong hot loops:
for (let i = 0.0; i < 1000000.0; i += 1.0) {
  // i lÃ  HeapNumber â†’ CHáº¬M
  // Má»—i iteration allocate HeapNumber má»›i!
}
```

**V8 Oddball â€” Singleton cho null, undefined, true, false:**

V8 cÃ³ má»™t loáº¡i internal type Ä‘áº·c biá»‡t gá»i lÃ  **Oddball** â€” dÃ nh cho `null`, `undefined`, `true`, `false`. ÄÃ¢y lÃ  cÃ¡c **singleton** Ä‘Æ°á»£c cáº¥p phÃ¡t Má»˜T Láº¦N duy nháº¥t khi V8 khá»Ÿi táº¡o vÃ  tá»“n táº¡i suá»‘t vÃ²ng Ä‘á»i cá»§a runtime. Má»i biáº¿n `null` trong code Ä‘á»u trá» Ä‘áº¿n CÃ™NG Má»˜T Oddball object â†’ **zero memory overhead** báº¥t ká»ƒ báº¡n cÃ³ bao nhiÃªu biáº¿n null.

Äiá»u nÃ y giáº£i thÃ­ch táº¡i sao `null === null` luÃ´n `true` â€” vÃ¬ chÃºng thá»±c sá»± lÃ  CÃ™NG Má»˜T object trong bá»™ nhá»› (giá»‘ng nhau vá» identity, khÃ´ng chá»‰ giá»‘ng nhau vá» value).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  V8 INTERNAL TYPE REPRESENTATION                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JS Type        â”‚ V8 Internal    â”‚ Storage    â”‚ Speed            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Number (int)   â”‚ Smi            â”‚ Inline     â”‚ âš¡ Fastest        â”‚
â”‚  Number (float) â”‚ HeapNumber     â”‚ Heap       â”‚ ğŸŒ Slower        â”‚
â”‚  String (short) â”‚ SeqOneByteStr  â”‚ Heap*      â”‚ âš¡ Fast           â”‚
â”‚  String (long)  â”‚ ConsString     â”‚ Heap       â”‚ ğŸŒ Varies        â”‚
â”‚  Boolean        â”‚ Oddball        â”‚ Root const â”‚ âš¡ Fastest        â”‚
â”‚  null           â”‚ Oddball        â”‚ Root const â”‚ âš¡ Fastest        â”‚
â”‚  undefined      â”‚ Oddball        â”‚ Root const â”‚ âš¡ Fastest        â”‚
â”‚  Symbol         â”‚ HeapSymbol     â”‚ Heap       â”‚ ğŸŒ Slower        â”‚
â”‚  BigInt         â”‚ HeapBigInt     â”‚ Heap       â”‚ ğŸŒğŸŒ Slowest     â”‚
â”‚  Object         â”‚ JSObject       â”‚ Heap       â”‚ ğŸŒ Varies        â”‚
â”‚  Array          â”‚ JSArray        â”‚ Heap       â”‚ Depends on mode  â”‚
â”‚  Function       â”‚ JSFunction     â”‚ Heap       â”‚ ğŸŒ Varies        â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Smi = KHÃ”NG cáº§n heap, KHÃ”NG cáº§n GC â†’ nhanh nháº¥t!           â”‚
â”‚  ğŸ“Œ Oddball = singleton, pre-allocated â†’ zero cost              â”‚
â”‚  ğŸ“Œ * String ngáº¯n (<= 13 chars) cÃ³ thá»ƒ inline trong V8        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Storage

ÄÃ¢y lÃ  pháº§n **quan trá»ng nháº¥t** Ä‘á»ƒ hiá»ƒu Data Types â€” vÃ¬ má»i behavior ká»³ láº¡ cá»§a JS (copy by reference, mutation bug, garbage collection) Ä‘á»u báº¯t nguá»“n tá»« cÃ¡ch dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»›.

**Stack** vÃ  **Heap** lÃ  2 vÃ¹ng bá»™ nhá»› hoÃ n toÃ n khÃ¡c nhau mÃ  JS engine (V8, SpiderMonkey) sá»­ dá»¥ng:

**Stack Memory** â€” Nhanh, nhá», cÃ³ tráº­t tá»±:

- Hoáº¡t Ä‘á»™ng theo nguyÃªn táº¯c LIFO (Last In, First Out) â€” giá»‘ng chá»“ng Ä‘Ä©a.
- Má»—i function call táº¡o má»™t "stack frame" chá»©a biáº¿n local vÃ  primitives.
- KÃ­ch thÆ°á»›c Cá» Äá»ŠNH â€” V8 máº·c Ä‘á»‹nh ~1MB cho má»—i thread.
- Truy xuáº¥t Cá»°C NHANH vÃ¬ data náº±m liÃªn tiáº¿p â†’ CPU cache hit rate cao.
- Khi function return â†’ stack frame bá»‹ POP â†’ bá»™ nhá»› tá»± giáº£i phÃ³ng (khÃ´ng cáº§n GC).

**Heap Memory** â€” Cháº­m hÆ¡n, lá»›n, linh hoáº¡t:

- VÃ¹ng nhá»› KHÃ”NG cÃ³ thá»© tá»± â€” objects Ä‘Æ°á»£c Ä‘áº·t á»Ÿ báº¥t ká»³ Ä‘Ã¢u cÃ³ chá»— trá»‘ng.
- KÃ­ch thÆ°á»›c Äá»˜NG â€” V8 máº·c Ä‘á»‹nh ~1.5GB (64-bit), cÃ³ thá»ƒ tÄƒng báº±ng `--max-old-space-size`.
- Truy xuáº¥t CHáº¬M HÆ N vÃ¬ pháº£i follow pointer ("pointer chasing") â†’ CPU cache miss.
- Cáº¦N Garbage Collector (V8 dÃ¹ng Orinoco) Ä‘á»ƒ dá»n dáº¹p objects khÃ´ng cÃ²n reference.

**Táº¡i sao khÃ´ng bá» stack, dÃ¹ng heap cho táº¥t cáº£?** VÃ¬ heap cáº§n GC â€” GC pháº£i "pause" chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ quÃ©t bá»™ nhá»› (dÃ¹ V8 Ä‘Ã£ tá»‘i Æ°u báº±ng concurrent/incremental GC). Primitives nhá», sá»‘ng ngáº¯n â†’ Ä‘á»ƒ trÃªn stack = tá»± dá»n khi function return = ZERO overhead. ÄÃ¢y lÃ  lÃ½ do táº¡i sao viáº¿t `let count = 0` (primitive trÃªn stack) nhanh hÆ¡n `let count = { value: 0 }` (object trÃªn heap) â€” khÃ´ng chá»‰ vÃ¬ Ã­t memory, mÃ  cÃ²n vÃ¬ KHÃ”NG táº¡o Ã¡p lá»±c lÃªn GC.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STACK vs HEAP MEMORY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚         STACK                           HEAP                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ let a = 10      â”‚           â”‚                     â”‚         â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”‚
â”‚   â”‚ â”‚  a  â”‚  10   â”‚ â”‚           â”‚  â”‚ { x: 1, y: 2 }â”‚â—„â”€â”¼â”€â”€â”      â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚
â”‚   â”‚                 â”‚           â”‚                     â”‚  â”‚      â”‚
â”‚   â”‚ let obj = {...} â”‚           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚      â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚           â”‚  â”‚ [1, 2, 3]     â”‚â—„â”€â”¼â”€â”€â”¼â”€â”€â”   â”‚
â”‚   â”‚ â”‚ obj â”‚ 0x001â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜               â”‚  â”‚  â”‚  â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚           â”‚                     â”‚  â”‚  â”‚   â”‚
â”‚   â”‚                 â”‚           â”‚                     â”‚  â”‚  â”‚   â”‚
â”‚   â”‚ let arr = [...] â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                    â”‚  â”‚   â”‚
â”‚   â”‚ â”‚ arr â”‚ 0x002â”€â”¼â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚   â”‚
â”‚                                                                 â”‚
â”‚   ğŸ“Œ Primitive: GiÃ¡ trá»‹ LÆ¯U TRá»°C TIáº¾P trong stack              â”‚
â”‚   ğŸ“Œ Reference: Stack lÆ°u POINTER, Heap lÆ°u GIÃ TRá»Š            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**V8 Garbage Collection (Orinoco) â€” Táº¡i sao data types áº£nh hÆ°á»Ÿng Ä‘áº¿n GC:**

ÄÃ¢y lÃ  pháº§n mÃ  háº§u háº¿t tÃ i liá»‡u há»c JavaScript bá» qua, nhÆ°ng nÃ³ giáº£i thÃ­ch _táº¡i sao_ cÃ¹ng má»™t logic, cÃ¹ng má»™t káº¿t quáº£ â€” nhÆ°ng cÃ¡ch báº¡n chá»n data type láº¡i quyáº¿t Ä‘á»‹nh app cá»§a báº¡n **mÆ°á»£t hay giáº­t**.

V8 chia heap thÃ nh **2 vÃ¹ng chÃ­nh** â€” vÃ  má»—i vÃ¹ng cÃ³ thuáº­t toÃ¡n GC khÃ¡c nhau:

- **New Space (Young Generation)** â€” ~1-8MB. NÆ¡i SINH RA cá»§a má»i object má»›i. GC á»Ÿ Ä‘Ã¢y gá»i lÃ  **Scavenger** (Minor GC) â€” sá»­ dá»¥ng thuáº­t toÃ¡n **semi-space copying**: chia New Space thÃ nh 2 ná»­a (From-space / To-space), copy objects "sá»‘ng sÃ³t" sang ná»­a kia vÃ  Bá» QUA objects cháº¿t. Cá»°C Ká»² NHANH (~1-10ms) vÃ¬ pháº§n lá»›n objects cháº¿t tráº» (ephemeral). Khi object sá»‘ng sÃ³t 2 láº§n Scavenge â†’ nÃ³ Ä‘Æ°á»£c "thÄƒng cáº¥p" (promoted) sang Old Space.

- **Old Space (Old Generation)** â€” ~1.5GB trá»Ÿ lÃªn. NÆ¡i chá»©a objects "lÃ¢u Ä‘á»i" Ä‘Ã£ sá»‘ng sÃ³t qua nhiá»u GC cycles. GC á»Ÿ Ä‘Ã¢y gá»i lÃ  **Mark-Sweep-Compact** (Major GC) â€” V8 **mark** má»i object reachable tá»« root (global, stack), **sweep** (dá»n) objects khÃ´ng Ä‘Æ°á»£c mark, vÃ  **compact** (nÃ©n) heap Ä‘á»ƒ loáº¡i bá» fragmentation. CHáº¬M HÆ N nhiá»u (~50-200ms á»Ÿ heap lá»›n!) nhÆ°ng Ã­t xáº£y ra.

**Táº¡i sao Ä‘iá»u nÃ y liÃªn quan Ä‘áº¿n data types?**

```javascript
// === GC PRESSURE VÃ€ DATA TYPES ===

// 1. PRIMITIVES (Smi) â†’ ZERO GC pressure
let count = 0; // Smi â†’ trÃªn stack â†’ KHÃ”NG PHáº¢I object â†’ GC khÃ´ng quan tÃ¢m!
count++; // Váº«n Smi â†’ GC váº«n khÃ´ng tháº¥y
// â†’ 1 triá»‡u phÃ©p tÃ­nh = 0 objects táº¡o ra = 0 GC events

// 2. OBJECTS â†’ GC pháº£i quáº£n lÃ½ tá»«ng cÃ¡i
let result = {}; // JSObject â†’ New Space â†’ Scavenger theo dÃµi
result.x = 1; // V8 cÃ³ thá»ƒ pháº£i táº¡o Hidden Class má»›i
result = { x: 2 }; // Object cÅ© bá»‹ orphan â†’ Scavenger pháº£i dá»n
// â†’ 1 triá»‡u objects = 1 triá»‡u entries GC pháº£i scan

// 3. REAL-WORLD IMPACT â€” React rendering
// âŒ Táº¡o object má»›i Má»–I render â†’ GC pressure lá»›n
function BadComponent({ items }) {
  // Má»—i render: new Object, new Array â†’ New Space Ä‘áº§y â†’ Scavenge!
  const filtered = items.filter((i) => i.active); // new Array
  const mapped = filtered.map((i) => ({ ...i })); // N new Objects!
  const style = { color: "red", fontSize: 14 }; // new Object má»—i render!
  return <List items={mapped} style={style} />;
}

// âœ… Minimal allocation â†’ GC nháº¹ nhÃ ng
const STYLE = { color: "red", fontSize: 14 }; // Hoist ra ngoÃ i â†’ 1 láº§n duy nháº¥t

function GoodComponent({ items }) {
  // useMemo = chá»‰ táº¡o array Má»šI khi items thay Ä‘á»•i
  const filtered = useMemo(() => items.filter((i) => i.active), [items]);
  return <List items={filtered} style={STYLE} />;
}
// â†’ Ãt objects táº¡m â†’ Scavenger cháº¡y Ã­t hÆ¡n â†’ UI mÆ°á»£t hÆ¡n!
```

**Máº¹o thá»±c táº¿ tá»« V8 team:**

- **Smi > HeapNumber > Object** â€” thá»© tá»± Æ°u tiÃªn khi chá»n data type cho hot paths
- **Object pools** â€” tÃ¡i sá»­ dá»¥ng objects thay vÃ¬ táº¡o má»›i trong animation/game loops
- **Avoid closure over large objects** â€” closure giá»¯ reference â†’ object khÃ´ng bá»‹ GC
- **`WeakRef` & `FinalizationRegistry` (ES2021)** â€” cho phÃ©p reference mÃ  KHÃ”NG ngÄƒn cáº£n GC, há»¯u Ã­ch cho cache patterns

Hiá»ƒu GC giÃºp báº¡n tráº£ lá»i cÃ¢u phá»ng váº¥n kinh Ä‘iá»ƒn: _"Táº¡i sao app React giáº­t khi render list 10,000 items?"_ â€” KhÃ´ng chá»‰ vÃ¬ DOM operations, mÃ  cÃ²n vÃ¬ **GC pauses** khi New Space trÃ n do quÃ¡ nhiá»u temporary objects tá»« `.map()`, `.filter()`, spread operations.

### Primitive Types Chi Tiáº¿t

Báº£y primitive types cá»§a JavaScript khÃ´ng há» "bÃ¬nh Ä‘áº³ng" â€” má»—i kiá»ƒu ra Ä‘á»i trong má»™t bá»‘i cáº£nh lá»‹ch sá»­ khÃ¡c nhau, giáº£i quyáº¿t má»™t váº¥n Ä‘á» cá»¥ thá»ƒ, vÃ  cÃ³ nhá»¯ng quirks (hÃ nh vi ká»³ láº¡) riÃªng mÃ  Senior developer pháº£i náº¯m rÃµ:

**Number** â€” Kiá»ƒu gÃ¢y nhiá»u bug nháº¥t trong JS. Má»i sá»‘ trong JS Ä‘á»u lÃ  64-bit floating point (IEEE 754), ká»ƒ cáº£ sá»‘ nguyÃªn. Äiá»u nÃ y cÃ³ nghÄ©a `1` vÃ  `1.0` hoÃ n toÃ n giá»‘ng nhau trong bá»™ nhá»›. Há»‡ quáº£: `0.1 + 0.2 === 0.30000000000000004`, vÃ  `Number.MAX_SAFE_INTEGER + 1 === Number.MAX_SAFE_INTEGER + 2` (cáº£ hai Ä‘á»u báº±ng 9007199254740992). Äáº·c biá»‡t, `NaN` (Not a Number) láº¡i cÃ³ `typeof NaN === "number"` â€” má»™t nghá»‹ch lÃ½ mÃ  interviewer ráº¥t thÃ­ch há»i. NaN lÃ  giÃ¡ trá»‹ duy nháº¥t trong JS mÃ  `NaN !== NaN` â€” Ä‘Ã¢y khÃ´ng pháº£i bug mÃ  lÃ  quy Ä‘á»‹nh cá»§a IEEE 754.

**String** â€” Báº¥t biáº¿n (immutable) vÃ  dÃ¹ng UTF-16. Khi báº¡n viáº¿t `str[0] = "X"`, khÃ´ng cÃ³ gÃ¬ xáº£y ra (no error, no change). Má»—i phÃ©p ná»‘i string (`str1 + str2`) táº¡o ra STRING Má»šI trong heap â€” Ä‘Ã¢y lÃ  lÃ½ do vÃ²ng láº·p ná»‘i string cá»±c ká»³ cháº­m, vÃ  táº¡i sao `Array.join()` hay template literals Ä‘Æ°á»£c khuyÃªn dÃ¹ng hÆ¡n.

**Boolean** â€” ÄÆ¡n giáº£n nháº¥t nhÆ°ng cÅ©ng lÃ  nguá»“n gá»‘c cá»§a "falsy values" â€” 6 giÃ¡ trá»‹ bá»‹ coerce thÃ nh `false`: `false`, `0`, `""`, `null`, `undefined`, `NaN`. Má»i thá»© khÃ¡c lÃ  truthy, ká»ƒ cáº£ `[]`, `{}`, `"0"`, `"false"`. ÄÃ¢y lÃ  báº«y phá»ng váº¥n kinh Ä‘iá»ƒn: `if ([]) { ... }` â†’ CHáº Y, vÃ¬ array rá»—ng lÃ  truthy!

**null vs undefined** â€” ÄÃ¢y lÃ  sá»± nháº§m láº«n "triá»‡u Ä‘Ã´" cá»§a JS. `undefined` nghÄ©a lÃ  "chÆ°a Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹" (há»‡ thá»‘ng tá»± gÃ¡n). `null` nghÄ©a lÃ  "Cá» Ã Ä‘á»ƒ trá»‘ng" (developer tá»± gÃ¡n). Trong thá»±c táº¿, `undefined == null` lÃ  `true` (loose equality), nhÆ°ng `undefined === null` lÃ  `false` (strict equality). React team dÃ¹ng `undefined` lÃ m giÃ¡ trá»‹ máº·c Ä‘á»‹nh cho optional props, vÃ  `null` Ä‘á»ƒ signal "render nothing" (`return null`).

**Symbol (ES6)** â€” Kiá»ƒu Ã­t Ä‘Æ°á»£c dÃ¹ng nháº¥t nhÆ°ng quan trá»ng nháº¥t cho library authors. Má»—i `Symbol()` táº¡o ra giÃ¡ trá»‹ DUY NHáº¤T, KHÃ”NG BAO GIá»œ trÃ¹ng. Use case chÃ­nh: trÃ¡nh collision khi nhiá»u libraries cÃ¹ng thÃªm property vÃ o object. React sá»­ dá»¥ng Symbol ná»™i bá»™: `$$typeof: Symbol.for('react.element')` Ä‘á»ƒ ngÄƒn XSS attacks â€” server khÃ´ng thá»ƒ serialize Symbol, nÃªn hacker khÃ´ng thá»ƒ inject fake React elements qua JSON.

**BigInt (ES2020)** â€” Sinh ra Ä‘á»ƒ giáº£i quyáº¿t giá»›i háº¡n cá»§a Number. Khi Twitter chuyá»ƒn tá»« 32-bit sang 64-bit snowflake IDs, JS Number khÃ´ng thá»ƒ lÆ°u chÃ­nh xÃ¡c â†’ API pháº£i tráº£ vá» `id_str` (string) bÃªn cáº¡nh `id` (number bá»‹ truncated). BigInt giáº£i quyáº¿t triá»‡t Ä‘á»ƒ báº±ng arbitrary-precision integers. NhÆ°ng BigInt CHáº¬M HÆ N Number vÃ¬ khÃ´ng dÃ¹ng Ä‘Æ°á»£c hardware FPU â€” Ä‘Ã¢y lÃ  trade-off: precision vs speed.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRIMITIVE TYPES DETAIL                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£  NUMBER                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ 64-bit floating point (IEEE 754)                        â”‚ â”‚
â”‚  â”‚  â€¢ Includes: integers, floats, Infinity, -Infinity, NaN    â”‚ â”‚
â”‚  â”‚  â€¢ Safe integer range: -(2^53-1) to (2^53-1)               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  typeof 42        // "number"                              â”‚ â”‚
â”‚  â”‚  typeof 3.14      // "number"                              â”‚ â”‚
â”‚  â”‚  typeof NaN       // "number"                              â”‚ â”‚
â”‚  â”‚  typeof Infinity  // "number"                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£  BIGINT (ES2020)                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Arbitrary precision integers                            â”‚ â”‚
â”‚  â”‚  â€¢ Suffix with 'n': 9007199254740991n                      â”‚ â”‚
â”‚  â”‚  â€¢ Cannot mix with Number in operations                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  typeof 123n      // "bigint"                              â”‚ â”‚
â”‚  â”‚  const big = BigInt(9007199254740991)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  3ï¸âƒ£  STRING                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Immutable sequence of UTF-16 code units                 â”‚ â”‚
â”‚  â”‚  â€¢ Single quotes, double quotes, or template literals      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  typeof "hello"   // "string"                              â”‚ â”‚
â”‚  â”‚  typeof `world`   // "string"                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  4ï¸âƒ£  BOOLEAN                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Only two values: true, false                            â”‚ â”‚
â”‚  â”‚  â€¢ Falsy values: false, 0, "", null, undefined, NaN        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  typeof true      // "boolean"                             â”‚ â”‚
â”‚  â”‚  typeof false     // "boolean"                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  5ï¸âƒ£  SYMBOL (ES6)                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Unique and immutable identifier                         â”‚ â”‚
â”‚  â”‚  â€¢ Used for object property keys                           â”‚ â”‚
â”‚  â”‚  â€¢ Every Symbol() is unique                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  const sym = Symbol('description')                         â”‚ â”‚
â”‚  â”‚  typeof sym       // "symbol"                              â”‚ â”‚
â”‚  â”‚  Symbol('a') === Symbol('a')  // false (always unique)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  6ï¸âƒ£  UNDEFINED                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Variable declared but not assigned                      â”‚ â”‚
â”‚  â”‚  â€¢ Function parameter not provided                         â”‚ â”‚
â”‚  â”‚  â€¢ Function without return statement                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  let x;                                                    â”‚ â”‚
â”‚  â”‚  typeof x         // "undefined"                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  7ï¸âƒ£  NULL                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  â€¢ Intentional absence of value                            â”‚ â”‚
â”‚  â”‚  âš ï¸ typeof null returns "object" (historical bug)          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  let y = null;                                             â”‚ â”‚
â”‚  â”‚  typeof y         // "object" (BUG!)                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**`typeof` â€” ToÃ¡n Tá»­ ÄÆ¡n Giáº£n Nháº¥t Vá»›i Nhiá»u Báº«y Nháº¥t:**

NhÃ¬n báº£ng trÃªn, báº¡n tháº¥y `typeof` cÃ³ váº» straightforward â€” nhÆ°ng thá»±c táº¿ nÃ³ lÃ  nguá»“n gá»‘c cá»§a VÃ” Sá» bugs vÃ  cÃ¢u há»i phá»ng váº¥n "trick". HÃ£y phÃ¢n tÃ­ch tá»«ng quirk mÃ  Senior developer **pháº£i** biáº¿t:

**Quirk #1 â€” `typeof null === "object"`** â€” ÄÃ¢y lÃ  bug **ná»•i tiáº¿ng nháº¥t** trong lá»‹ch sá»­ JavaScript. CÃ¢u chuyá»‡n: Trong phiÃªn báº£n Ä‘áº§u tiÃªn (1995), Brendan Eich implement typeof báº±ng cÃ¡ch kiá»ƒm tra **type tag** á»Ÿ 3 bits tháº¥p nháº¥t (low bits) cá»§a má»—i giÃ¡ trá»‹. Objects cÃ³ tag `000`. Null Ä‘Æ°á»£c represent báº±ng **null pointer** (táº¥t cáº£ bits = 0) â†’ 3 bits tháº¥p = `000` â†’ bá»‹ nháº§m lÃ  object! NÄƒm 2006, ES4 Ä‘á» xuáº¥t fix thÃ nh `typeof null === "null"`, nhÆ°ng bá»‹ **reject** vÃ¬ sáº½ break hÃ ng triá»‡u websites kiá»ƒm tra `typeof x === "object"` â€” bao gá»“m cáº£ null. BÃ i há»c: **Trong web, backward compatibility > correctness**. ÄÃ¢y cÅ©ng lÃ  lÃ½ do báº¡n PHáº¢I check `x !== null && typeof x === "object"` khi test cho object.

**Quirk #2 â€” `typeof function === "function"`** â€” Functions trong JS lÃ  objects (cÃ³ properties, prototype, constructor). NhÆ°ng `typeof` tráº£ vá» `"function"` thay vÃ¬ `"object"`. Táº¡i sao? VÃ¬ spec **cá»‘ Ã½** phÃ¢n biá»‡t â€” functions cÃ³ internal `[[Call]]` slot, vÃ  `typeof` kiá»ƒm tra slot nÃ y. Äiá»u nÃ y thá»±c sá»± Há»®U ÃCH vÃ¬ cho phÃ©p detect functions dá»… dÃ ng. NhÆ°ng nÃ³ táº¡o false impression ráº±ng function lÃ  kiá»ƒu riÃªng â€” thá»±c táº¿ trong Type System, function VáºªN LÃ€ object.

**Quirk #3 â€” `typeof undeclared_var === "undefined"`** â€” ÄÃ¢y lÃ  **feature áº©n** quan trá»ng nháº¥t cá»§a `typeof`. Má»i toÃ¡n tá»­ khÃ¡c Ä‘á»u throw `ReferenceError` khi dÃ¹ng vá»›i biáº¿n chÆ°a khai bÃ¡o. Chá»‰ `typeof` KHÃ”NG throw â€” nÃ³ tráº£ vá» `"undefined"`. ÄÃ¢y lÃ  cÃ¡ch duy nháº¥t an toÃ n Ä‘á»ƒ check biáº¿n tá»“n táº¡i hay chÆ°a **trÆ°á»›c ES6 modules**: `if (typeof jQuery !== "undefined") { ... }`. ES6+ cÃ³ `globalThis` vÃ  optional chaining, nhÆ°ng pattern nÃ y váº«n phá»• biáº¿n trong legacy code vÃ  polyfills.

**Quirk #4 â€” Temporal Dead Zone (TDZ)** â€” Tá»« ES6, `typeof` **CÃ“ THá»‚** throw `ReferenceError` náº¿u biáº¿n khai bÃ¡o báº±ng `let`/`const` nhÆ°ng chÆ°a initialized:

```javascript
// typeof + Quirks Quiz â€” Interview Questions

// Q1: typeof quirks
console.log(typeof null); // "object" â€” bug lá»‹ch sá»­!
console.log(typeof function () {}); // "function" â€” vÃ¬ cÃ³ [[Call]] slot
console.log(typeof undefined); // "undefined"
console.log(typeof undeclared); // "undefined" â€” KHÃ”NG throw error!

// Q2: TDZ â€” typeof CÃ“ THá»‚ throw!
// console.log(typeof x);  // ReferenceError: Cannot access 'x' before init
// let x = 10;
// â†’ typeof KHÃ”NG an toÃ n vá»›i let/const variables á»Ÿ TDZ!
// â†’ Chá»‰ an toÃ n vá»›i var (hoisted) hoáº·c global variables

// Q3: typeof vá»›i wrapper objects
console.log(typeof "hello"); // "string" â€” primitive âœ…
console.log(typeof new String("hello")); // "object" â€” wrapper! âŒ
// â†’ NEVER dÃ¹ng new String/Number/Boolean!

// Q4: typeof NaN
console.log(typeof NaN); // "number" â€” WTF?
// NaN = "Not a Number" nhÆ°ng typeof = "number"
// VÃ¬ NaN lÃ  giÃ¡ trá»‹ IEEE-754 há»£p lá»‡, nÃ³ LÃ€ number type trong spec

// Q5: Defensive typeof pattern cho production
function safelyAccess(obj) {
  // Pattern 1: typeof guard (an toÃ n nháº¥t)
  if (typeof obj === "object" && obj !== null) {
    return obj.value;
  }

  // Pattern 2: Feature detection (polyfill pattern)
  if (typeof Symbol !== "undefined") {
    // Symbol is supported
  }

  // Pattern 3: typeof + constructor check (specific type)
  if (typeof obj === "object" && obj !== null && obj.constructor === Date) {
    return obj.toISOString();
  }
}
```

**V8 Internal Type Tags â€” Thá»±c sá»± diá»…n ra gÃ¬ khi gá»i `typeof`?**

Khi V8 thá»±c thi `typeof x`, nÃ³ KHÃ”NG "check string type name" â€” nÃ³ kiá»ƒm tra **internal type tags** vÃ  **Map (Hidden Class)** cá»§a giÃ¡ trá»‹. Quy trÃ¬nh bÃªn trong engine:

1. **Check Smi tag** (bit cuá»‘i = 1) â†’ return `"number"` ngay láº­p tá»©c (fastest path!)
2. **Follow pointer** â†’ Ä‘á»c Map (Hidden Class) á»Ÿ offset 0 cá»§a HeapObject
3. **Check instance type** trong Map:
   - `ODDBALL_TYPE` + null flag â†’ return `"object"` (the bug!)
   - `ODDBALL_TYPE` + undefined flag â†’ return `"undefined"`
   - `ODDBALL_TYPE` + boolean flag â†’ return `"boolean"`
   - `HEAP_NUMBER_TYPE` â†’ return `"number"`
   - `STRING_TYPE` (any variant) â†’ return `"string"`
   - `SYMBOL_TYPE` â†’ return `"symbol"`
   - `BIGINT_TYPE` â†’ return `"bigint"`
   - Has `[[Call]]` internal method â†’ return `"function"`
   - Everything else â†’ return `"object"`

Äiá»u nÃ y giáº£i thÃ­ch táº¡i sao `typeof` trÃªn Smi **nhanh nháº¥t** (1 bit check), vÃ  táº¡i sao `typeof` trÃªn object **cháº­m hÆ¡n** (pháº£i follow pointer + Ä‘á»c Map). Trong production, sá»± khÃ¡c biá»‡t nÃ y chá»‰ matter trong **hot paths** (millions of calls) â€” nhÆ°ng Ä‘Ã¢y lÃ  kiáº¿n thá»©c giÃºp báº¡n ná»•i báº­t trong interviews.

### IEEE-754 Floating Point Deep Dive â€” Táº¡i Sao `0.1 + 0.2 !== 0.3`

ÄÃ¢y lÃ  cÃ¢u há»i phá»ng váº¥n mÃ  **100% candidate** sáº½ gáº·p, nhÆ°ng chá»‰ ~5% giáº£i thÃ­ch Ä‘Æ°á»£c á»Ÿ má»©c binary. Pháº§n nÃ y sáº½ giÃºp báº¡n trá»Ÿ thÃ nh 5% Ä‘Ã³.

**Táº¡i sao JavaScript chá»‰ cÃ³ 1 kiá»ƒu Number?** CÃ¢u tráº£ lá»i náº±m á»Ÿ lá»‹ch sá»­: Brendan Eich thiáº¿t káº¿ JS trong 10 ngÃ y (1995), nháº¯m Ä‘áº¿n **designer vÃ  non-programmer**. CÃ³ 1 kiá»ƒu sá»‘ duy nháº¥t = Ã­t khÃ¡i niá»‡m hÆ¡n = dá»… há»c hÆ¡n. Má»i sá»‘ â€” dÃ¹ lÃ  `42`, `3.14`, hay `Infinity` â€” Ä‘á»u Ä‘Æ°á»£c lÆ°u dÆ°á»›i dáº¡ng **IEEE-754 double-precision 64-bit floating point**. ÄÃ¢y lÃ  tiÃªu chuáº©n pháº§n cá»©ng mÃ  Má»ŒI CPU trÃªn tháº¿ giá»›i Ä‘á»u há»— trá»£ qua FPU (Floating Point Unit), nÃªn phÃ©p tÃ­nh sá»‘ cá»±c ká»³ nhanh â€” khÃ´ng cáº§n software emulation.

**64 bits Ä‘Æ°á»£c chia thÃ nh 3 pháº§n:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IEEE-754 DOUBLE PRECISION â€” 64 BITS LAYOUT                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ S â”‚   Exponent    â”‚            Mantissa (Fraction)      â”‚    â”‚
â”‚  â”‚ 1 â”‚   11 bits     â”‚            52 bits                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  S (Sign): 0 = dÆ°Æ¡ng, 1 = Ã¢m                                   â”‚
â”‚  E (Exponent): 11 bits = pháº¡m vi 2^-1022 â†’ 2^1023              â”‚
â”‚  M (Mantissa): 52 bits = ~15-17 chá»¯ sá»‘ tháº­p phÃ¢n chÃ­nh xÃ¡c    â”‚
â”‚                                                                 â”‚
â”‚  CÃ´ng thá»©c: value = (-1)^S Ã— 2^(E-1023) Ã— (1.M)               â”‚
â”‚  "1.M" = "hidden bit" â€” bit 1 ngáº§m Ä‘á»‹nh trÆ°á»›c mantissa         â”‚
â”‚  â†’ Thá»±c táº¿ cÃ³ 53 bits precision (52 explicit + 1 hidden)       â”‚
â”‚                                                                 â”‚
â”‚  VÃ Dá»¤: Sá»‘ 42.0 trong binary:                                  â”‚
â”‚  42 = 32 + 8 + 2 = 2^5 + 2^3 + 2^1 = 101010 (binary)         â”‚
â”‚  = 1.01010 Ã— 2^5                                               â”‚
â”‚  â†’ S=0, E=5+1023=1028=10000000100, M=0101000...0               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Táº¡i sao `0.1 + 0.2 !== 0.3`? â€” Giáº£i thÃ­ch á»Ÿ má»©c binary:**

Sá»‘ `0.1` trong há»‡ tháº­p phÃ¢n ráº¥t Ä‘Æ¡n giáº£n. NhÆ°ng trong há»‡ **nhá»‹ phÃ¢n** (binary), nÃ³ lÃ  sá»‘ **vÃ´ háº¡n tuáº§n hoÃ n** â€” giá»‘ng nhÆ° 1/3 = 0.333... trong tháº­p phÃ¢n khÃ´ng bao giá» káº¿t thÃºc:

```
0.1 (decimal) = 0.0001100110011001100110011... (binary, láº·p vÃ´ táº­n!)
0.2 (decimal) = 0.0011001100110011001100110... (binary, láº·p vÃ´ táº­n!)
```

VÃ¬ mantissa chá»‰ cÃ³ 52 bits, chuá»—i vÃ´ háº¡n pháº£i bá»‹ **cáº¯t** (truncated), dáº«n Ä‘áº¿n sai sá»‘ ráº¥t nhá» nhÆ°ng **tÃ­ch lÅ©y** khi cá»™ng. Káº¿t quáº£ `0.1 + 0.2` trong bá»™ nhá»› thá»±c táº¿ lÃ  `0.30000000000000004` â€” sai sá»‘ chá»‰ á»Ÿ chá»¯ sá»‘ thá»© 17, vÃ´ sá»‘ chá»¯ sá»‘ tháº­p phÃ¢n khÃ´ng thá»ƒ biá»ƒu diá»…n chÃ­nh xÃ¡c, khÃ´ng chá»‰ riÃªng 0.1 hay 0.2.

**ÄÃ¢y KHÃ”NG pháº£i bug cá»§a JavaScript** â€” Ä‘Ã¢y lÃ  giá»›i háº¡n cÆ¡ báº£n cá»§a IEEE-754. Python, Java, C, Go, Rust â€” Táº¤T Cáº¢ ngÃ´n ngá»¯ dÃ¹ng floating point Ä‘á»u gáº·p váº¥n Ä‘á» tÆ°Æ¡ng tá»±. JavaScript chá»‰ bá»‹ chÃº Ã½ nhiá»u hÆ¡n vÃ¬ `console.log(0.1 + 0.2)` in ra `0.30000000000000004` thay vÃ¬ lÃ m trÃ²n.

```javascript
// === IEEE-754 SPECIAL VALUES ===

// INFINITY â€” káº¿t quáº£ khi vÆ°á»£t quÃ¡ pháº¡m vi biá»ƒu diá»…n
console.log(1 / 0); // Infinity
console.log(-1 / 0); // -Infinity
console.log(Infinity + 1); // Infinity (Ä‘Ã£ "max out")
console.log(Infinity - Infinity); // NaN (báº¥t Ä‘á»‹nh!)

// NaN â€” "Not a Number" nhÆ°ng typeof lÃ  "number" (!)
// â†’ NaN Ä‘áº¡i diá»‡n cho káº¿t quáº£ cá»§a phÃ©p tÃ­nh KHÃ”NG XÃC Äá»ŠNH
console.log(0 / 0); // NaN
console.log(Math.sqrt(-1)); // NaN
console.log(parseInt("abc")); // NaN
// NaN lÃ  giÃ¡ trá»‹ DUY NHáº¤T trong JS mÃ  x !== x
console.log(NaN === NaN); // false (IEEE-754 quy Ä‘á»‹nh!)
console.log(NaN !== NaN); // true
// â†’ CÃ¡ch check: Number.isNaN(x) (ES6, chÃ­nh xÃ¡c)
//   KHÃ”NG dÃ¹ng isNaN(x) vÃ¬ isNaN("hello") â†’ true (bug!)

// -0 (NEGATIVE ZERO) â€” tá»“n táº¡i vÃ¬ IEEE-754 cÃ³ signed zero
console.log(-0 === 0); // true  (=== khÃ´ng phÃ¢n biá»‡t!)
console.log(-0 === +0); // true
console.log(Object.is(-0, 0)); // false (Object.is phÃ¢n biá»‡t!)
console.log(1 / -0); // -Infinity (cÃ¡ch detect -0)
console.log(1 / 0); // Infinity
// Use case: biá»ƒu diá»…n hÆ°á»›ng di chuyá»ƒn â€” -0 = sang trÃ¡i, +0 = sang pháº£i

// SAFE INTEGER RANGE â€” pháº¡m vi sá»‘ nguyÃªn "an toÃ n"
console.log(Number.MAX_SAFE_INTEGER); // 9007199254740991 (2^53 - 1)
console.log(Number.MIN_SAFE_INTEGER); // -9007199254740991
// VÆ°á»£t quÃ¡ = Máº¤T PRECISION:
console.log(9007199254740992 === 9007199254740993); // true! (Sá» KHÃC nhÆ°ng === true!)
// â†’ React key náº¿u dÃ¹ng ID > MAX_SAFE_INTEGER â†’ BUG áº¨N trong UI reconciliation!

// === CÃC CÃCH FIX FLOATING POINT ===

// Fix 1: EPSILON comparison (so sÃ¡nh gáº§n Ä‘Ãºng)
const isEqual = Math.abs(0.1 + 0.2 - 0.3) < Number.EPSILON;
console.log(isEqual); // true âœ…

// Fix 2: NhÃ¢n lÃªn thÃ nh integer rá»“i chia (cho tÃ­nh toÃ¡n tÃ i chÃ­nh)
const price = 0.1 * 100 + 0.2 * 100; // 10 + 20 = 30
console.log(price / 100); // 0.3 âœ… CHÃNH XÃC

// Fix 3: toFixed() â€” NHÆ¯NG tráº£ vá» STRING!
console.log((0.1 + 0.2).toFixed(1)); // "0.3" (string!)
console.log(+(0.1 + 0.2).toFixed(1)); // 0.3  (+ convert thÃ nh number)

// Fix 4: DÃ¹ng thÆ° viá»‡n chuyÃªn dá»¥ng cho financial calculations
// â†’ decimal.js, big.js, hoáº·c Dinero.js (cho tiá»n tá»‡)
// â†’ KHÃ”NG BAO GIá»œ dÃ¹ng float cho tiá»n trong production!

// Fix 5: Intl.NumberFormat cho hiá»ƒn thá»‹
const formatter = new Intl.NumberFormat("vi-VN", {
  style: "currency",
  currency: "VND",
});
console.log(formatter.format(1234567)); // "1.234.567 â‚«"
```

**á»¨ng dá»¥ng thá»±c táº¿ trong React/Frontend:**

Báº¡n cÃ³ thá»ƒ nghÄ© floating point chá»‰ lÃ  "bÃ i há»c lÃ½ thuyáº¿t", nhÆ°ng nÃ³ gÃ¢y bug THá»°C Sá»°:

- **E-commerce**: GiÃ¡ tá»•ng hiá»ƒn thá»‹ sai (99.99 Ã— 3 = 299.96999... thay vÃ¬ 299.97) â†’ khÃ¡ch hÃ ng máº¥t niá»m tin
- **React key**: Náº¿u dÃ¹ng sá»‘ lá»›n (ID tá»« database) lÃ m key mÃ  vÆ°á»£t `MAX_SAFE_INTEGER` â†’ React reconciliation so sÃ¡nh sai â†’ component re-render lá»—i
- **Canvas/Animation**: Tá»a Ä‘á»™ pixel tÃ­ch lÅ©y sai sá»‘ qua nhiá»u frame â†’ element "trÃ´i" vá»‹ trÃ­ dáº§n
- **Comparison in useEffect deps**: `useEffect(() => {...}, [price])` â€” náº¿u `price` lÃ  káº¿t quáº£ floating point, má»—i render tÃ­nh ra giÃ¡ trá»‹ hÆ¡i khÃ¡c â†’ effect cháº¡y liÃªn tá»¥c!

### String Encoding & V8 String Types â€” UTF-16, Surrogate Pairs, vÃ  String Interning

String lÃ  kiá»ƒu dá»¯ liá»‡u báº¡n dÃ¹ng **nhiá»u nháº¥t** nhÆ°ng hiá»ƒu **Ã­t nháº¥t** á»Ÿ má»©c engine. Má»i text trong JavaScript â€” tá»« `"hello"` Ä‘áº¿n emoji ğŸš€ â€” Ä‘á»u Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng **UTF-16**. Hiá»ƒu UTF-16 giáº£i thÃ­ch nhiá»u hÃ nh vi "láº¡" mÃ  báº¡n gáº·p hÃ ng ngÃ y.

**Táº¡i sao JavaScript dÃ¹ng UTF-16 mÃ  khÃ´ng pháº£i UTF-8?**

Lá»‹ch sá»­: JavaScript ra Ä‘á»i nÄƒm 1995, khi Unicode má»›i chá»‰ cÃ³ ~40,000 kÃ½ tá»± (BMP â€” Basic Multilingual Plane), Vá»ªA Váº¶N trong 16 bits (2 bytes). LÃºc Ä‘Ã³, 16-bit "fixed width" encoding (UCS-2) cÃ³ váº» lÃ  lá»±a chá»n hoÃ n háº£o â€” má»—i kÃ½ tá»± luÃ´n chiáº¿m 2 bytes, truy xuáº¥t theo index nhanh O(1).

Sau Ä‘Ã³ Unicode má»Ÿ rá»™ng thÃ nh ~150,000 kÃ½ tá»± (emoji, chá»¯ cá»• Ä‘áº¡i, kÃ½ hiá»‡u toÃ¡n há»c...) â€” vÆ°á»£t quÃ¡ 16 bits. Giáº£i phÃ¡p: **surrogate pairs** â€” dÃ¹ng 2 "code units" (4 bytes) Ä‘á»ƒ biá»ƒu diá»…n 1 kÃ½ tá»± ngoÃ i BMP. JavaScript káº¿ thá»«a cÆ¡ cháº¿ nÃ y vÃ  KHÃ”NG THá»‚ chuyá»ƒn sang UTF-8 vÃ¬ sáº½ phÃ¡ **backward compatibility** â€” `.length`, `.charAt()`, bracket indexing (`str[0]`) Ä‘á»u dá»±a trÃªn 16-bit code units.

```javascript
// === UTF-16 VÃ€ SURROGATE PAIRS ===

// KÃ½ tá»± BMP (náº±m trong 16 bits) â€” 1 code unit = 1 kÃ½ tá»±
console.log("A".length); // 1 âœ…
console.log("ä½ ".length); // 1 âœ… (chá»¯ HÃ¡n náº±m trong BMP)

// KÃ½ tá»± ngoÃ i BMP (cáº§n surrogate pair) â€” 2 code units = 1 kÃ½ tá»±!
console.log("ğŸš€".length); // 2! (rocket emoji = 2 UTF-16 code units)
console.log("ğ•³".length); // 2! (mathematical bold H)

// â†’ .length Äáº¾M CODE UNITS, KHÃ”NG Ä‘áº¿m kÃ½ tá»± thá»±c!

// Há»‡ quáº£ 1: Cáº¯t string bá»‹ vá»¡ emoji
console.log("Hello ğŸš€".slice(0, 7)); // "Hello ğŸš€" hm... maybe "Hello \uD83D"
// â†’ Náº¿u cáº¯t giá»¯a surrogate pair â†’ hiá»ƒn thá»‹ kÃ½ tá»± lá»—i!

// Há»‡ quáº£ 2: Spread operator vÃ  for...of Äáº¾M ÄÃšNG (ES6+)
console.log([..."ğŸš€ğŸ¯"].length); // 2 âœ… (Ä‘Ãºng 2 emoji)
console.log("ğŸš€ğŸ¯".length); // 4 âŒ (4 code units)

// Há»‡ quáº£ 3: So sÃ¡nh string grapheme clusters
// "Ã©" cÃ³ 2 cÃ¡ch viáº¿t:
const e1 = "Ã©"; // 1 code point (U+00E9) â€” precomposed
const e2 = "Ã©"; // 2 code points (U+0065 + U+0301) â€” decomposed
console.log(e1 === e2); // false! (khÃ¡c byte sequence)
console.log(e1.normalize() === e2.normalize()); // true âœ… (sau normalize)
// â†’ LuÃ´n dÃ¹ng .normalize() khi so sÃ¡nh text tá»« user input!

// === CÃCH Äáº¾M KÃ Tá»° THá»°C Sá»° ===

// CÃ¡ch 1: Intl.Segmenter (ES2022, chÃ­nh xÃ¡c nháº¥t)
const segmenter = new Intl.Segmenter("en", { granularity: "grapheme" });
const graphemes = [...segmenter.segment("ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Hello")];
console.log(graphemes.length); // 8 (family emoji = 1 grapheme, 7 chars)

// CÃ¡ch 2: Spread + Array.from (Ä‘áº¿m code points, khÃ´ng grapheme)
console.log([..."ğŸš€ğŸ¯"].length); // 2 âœ… cho emoji Ä‘Æ¡n
// NHÆ¯NG: [..."ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"].length â†’ 7! (family emoji = nhiá»u code points)
// â†’ Chá»‰ Intl.Segmenter Ä‘áº¿m Ä‘Ãºng grapheme clusters

// CÃ¡ch 3: regex vá»›i u flag (Unicode-aware)
const codePointCount = "Hello ğŸš€".match(/./gu)?.length;
console.log(codePointCount); // 7 âœ… (Ä‘áº¿m code points)
```

**V8 cÃ³ 5 loáº¡i String ná»™i bá»™ â€” vÃ  biáº¿t Ä‘iá»u nÃ y giÃºp báº¡n viáº¿t code nhanh hÆ¡n:**

V8 khÃ´ng chá»‰ cÃ³ 1 cÃ¡ch lÆ°u string â€” nÃ³ cÃ³ **5 internal string types** khÃ¡c nhau, má»—i loáº¡i Ä‘Æ°á»£c optimize cho use case cá»¥ thá»ƒ. Khi báº¡n viáº¿t code, V8 tá»± Ä‘á»™ng chá»n loáº¡i phÃ¹ há»£p nháº¥t:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  V8 INTERNAL STRING TYPES                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. SeqString (Sequential)                                      â”‚
â”‚     â†’ String ngáº¯n, lÆ°u liÃªn tiáº¿p trÃªn heap                     â”‚
â”‚     â†’ "hello", "John" â€” háº§u háº¿t string thÆ°á»ng gáº·p              â”‚
â”‚     â†’ SeqOneByteString: chá»‰ chá»©a Latin-1 (ASCII) â†’ 1 byte/charâ”‚
â”‚     â†’ SeqTwoByteSring: chá»©a Unicode â†’ 2 bytes/char             â”‚
â”‚     â†’ âš¡ Nhanh nháº¥t cho read operations                         â”‚
â”‚                                                                 â”‚
â”‚  2. ConsString (Concatenation/Rope)                             â”‚
â”‚     â†’ Káº¿t quáº£ cá»§a phÃ©p + ná»‘i string                             â”‚
â”‚     â†’ "Hello" + " " + "World" â†’ ConsString(ConsString, "World")â”‚
â”‚     â†’ KHÃ”NG copy data! Chá»‰ lÆ°u 2 pointers â†’ tree structure     â”‚
â”‚     â†’ âš¡ concat Cá»°C NHANH (O(1)), read pháº£i traverse           â”‚
â”‚     â†’ V8 "flatten" ConsString thÃ nh SeqString khi cáº§n          â”‚
â”‚                                                                 â”‚
â”‚  3. SlicedString                                                â”‚
â”‚     â†’ Káº¿t quáº£ cá»§a .slice(), .substring()                        â”‚
â”‚     â†’ KHÃ”NG copy data! Chá»‰ lÆ°u parent + offset + length        â”‚
â”‚     â†’ str.slice(2, 5) = { parent: str, offset: 2, length: 3 } â”‚
â”‚     â†’ âš¡ slice Cá»°C NHANH (O(1)), shares memory vá»›i parent      â”‚
â”‚                                                                 â”‚
â”‚  4. ThinString                                                  â”‚
â”‚     â†’ String Ä‘Ã£ bá»‹ "flattened" tá»« ConsString                    â”‚
â”‚     â†’ Trá» Ä‘áº¿n actual flat string data                           â”‚
â”‚     â†’ Tá»“n táº¡i táº¡m thá»i trong quÃ¡ trÃ¬nh GC                      â”‚
â”‚                                                                 â”‚
â”‚  5. ExternalString                                              â”‚
â”‚     â†’ Data náº±m ngoÃ i V8 heap (buffer, native code)              â”‚
â”‚     â†’ DÃ¹ng cho interop vá»›i C++ addons, WebAssembly              â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Implication: str1 + str2 KHÃ”NG copy â†’ O(1)!                â”‚
â”‚  ğŸ“Œ NhÆ°ng náº¿u ConsString quÃ¡ sÃ¢u â†’ V8 flatten â†’ O(n) burst!   â”‚
â”‚  ğŸ“Œ Best practice: Array.join() cho nhiá»u concat operations     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// === V8 STRING OPTIMIZATION PATTERNS ===

// Pattern 1: ConsString â€” Táº¡i sao string concat nhanh báº¥t ngá»?
let result = "";
for (let i = 0; i < 1000; i++) {
  result += "a"; // Má»—i láº§n: ConsString(prev, "a") â†’ tree sÃ¢u 1000 táº§ng!
}
// V8 Tá»° Äá»˜NG flatten thÃ nh SeqString khi báº¡n Ä‘á»c result
// NHÆ¯NG flatten = O(n) burst â†’ cÃ³ thá»ƒ lag náº¿u string dÃ i MB

// Better: Array.join() â€” táº¡o SeqString trá»±c tiáº¿p, khÃ´ng qua ConsString
const parts = [];
for (let i = 0; i < 1000; i++) {
  parts.push("a");
}
const result2 = parts.join(""); // 1 allocation duy nháº¥t!

// Pattern 2: String Interning â€” V8 dedup string trÃ¹ng láº·p
// V8 "intern" (deduplicate) strings ngáº¯n vÃ  string literals:
const a = "hello";
const b = "hello";
// a vÃ  b trá» Ä‘áº¿n CÃ™NG Má»˜T string object trong V8 heap!
// â†’ So sÃ¡nh === chá»‰ cáº§n compare POINTERS, khÃ´ng cáº§n byte-by-byte!
// â†’ ÄÃ¢y lÃ  lÃ½ do string comparison thÆ°á»ng O(1) trong practice

// Pattern 3: Template literals vs concatenation
const name = "World";
const greet1 = "Hello " + name + "!"; // ConsString â†’ cÃ³ thá»ƒ cáº§n flatten
const greet2 = `Hello ${name}!`;       // V8 optimize trá»±c tiáº¿p â†’ SeqString
// Template literals thÆ°á»ng NHANH HÆ N + concat vÃ¬ V8 biáº¿t trÆ°á»›c káº¿t quáº£

// Pattern 4: Substring vÃ  memory retention
const huge = "x".repeat(1_000_000);
const tiny = huge.slice(0, 5); // SlicedString â†’ váº«n GIá»® REFERENCE Ä‘áº¿n huge!
// â†’ huge KHÃ”NG bá»‹ GC vÃ¬ tiny váº«n reference nÃ³!
// Fix: táº¡o string má»›i hoÃ n toÃ n
const tinyClean = String(huge.slice(0, 5)); // hoáº·c: (" " + tiny).slice(1)
// â†’ BÃ¢y giá» huge cÃ³ thá»ƒ bá»‹ GC

// Pattern 5: React key optimization
// âŒ Slow: key báº±ng string dÃ i â†’ hash comparison
<Item key={`category-${categoryId}-item-${itemId}`} />

// âœ… Fast: key báº±ng ID number (Smi)
<Item key={itemId} />

// âœ… OK: key báº±ng short string (V8 intern + pointer compare)
<Item key={item.id} /> // náº¿u id lÃ  string ngáº¯n, V8 tá»± intern
```

**Táº¡i sao hiá»ƒu String encoding quan trá»ng cho Frontend?**

- **Form validation**: Äáº¿m kÃ½ tá»± user nháº­p báº±ng `.length` sáº½ sai náº¿u cÃ³ emoji (`"Hello ğŸš€".length === 8`, khÃ´ng pháº£i 7)
- **API truncation**: Backend truncate string theo bytes (UTF-8) nhÆ°ng frontend Ä‘áº¿m theo UTF-16 code units â†’ mismatch
- **Search/filter**: So sÃ¡nh text khÃ´ng normalize â†’ "cafÃ©" (precomposed) !== "cafÃ©" (decomposed) â†’ search bá» sÃ³t káº¿t quáº£
- **i18n**: Tiáº¿ng Viá»‡t cÃ³ dáº¥u dÃ¹ng combining characters â†’ `.length` cÃ³ thá»ƒ khÃ¡c nhau tÃ¹y encoding form
- **Clipboard paste**: User paste text tá»« Word/PDF cÃ³ thá»ƒ chá»©a invisible Unicode characters (ZWSP, BOM) â†’ pháº£i sanitize

### Wrapper Objects & Auto-boxing â€” BÃ­ áº¨n Cá»§a `"hello".length`

ÄÃ¢y lÃ  má»™t trong nhá»¯ng cÃ¢u há»i phá»ng váº¥n "sneaky" nháº¥t: **Náº¿u string lÃ  primitive (khÃ´ng pháº£i object), táº¡i sao `"hello".length` vÃ  `"hello".toUpperCase()` hoáº¡t Ä‘á»™ng?** Primitives khÃ´ng cÃ³ methods â€” váº­y methods nÃ y Ä‘áº¿n tá»« Ä‘Ã¢u?

CÃ¢u tráº£ lá»i: **Auto-boxing** (hay cÃ²n gá»i lÃ  "wrapper object creation"). Khi báº¡n truy cáº­p property/method trÃªn primitive, JS engine **tá»± Ä‘á»™ng** táº¡o má»™t **wrapper object táº¡m thá»i**, gá»i method, rá»“i **há»§y wrapper ngay láº­p tá»©c**. QuÃ¡ trÃ¬nh nÃ y diá»…n ra hoÃ n toÃ n áº©n, báº¡n khÃ´ng tháº¥y vÃ  khÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c.

Cá»¥ thá»ƒ, khi V8 gáº·p `"hello".length`:

1. Táº¡o `new String("hello")` â€” wrapper object táº¡m thá»i
2. Truy cáº­p `.length` trÃªn wrapper â†’ tráº£ vá» `5`
3. **Há»§y wrapper** â€” object bá»‹ GC collected
4. Tráº£ vá» giÃ¡ trá»‹ `5` (primitive number)

Äiá»u nÃ y cÃ³ 3 há»‡ quáº£ quan trá»ng:

**Há»‡ quáº£ 1 â€” GÃ¡n property vÃ o primitive lÃ  vÃ´ Ã­ch:**

```javascript
let str = "hello";
str.customProp = "world"; // Táº¡o wrapper â†’ gÃ¡n â†’ Há»¦Y wrapper
console.log(str.customProp); // undefined! Wrapper Ä‘Ã£ bá»‹ há»§y!
// KhÃ´ng error, khÃ´ng warning â€” THáº¦M Láº¶NG bá»‹ máº¥t!

// ÄÃ¢y lÃ  lÃ½ do báº¡n khÃ´ng thá»ƒ "extend" primitive values.
// Muá»‘n thÃªm metadata â†’ pháº£i dÃ¹ng object hoáº·c Map:
const metadata = new Map();
metadata.set(str, { customProp: "world" });
```

**Há»‡ quáº£ 2 â€” `new String()` â‰  `String()`:**

```javascript
// String() â€” convert sang primitive string
let a = String(42);
typeof a; // "string" â€” primitive âœ…

// new String() â€” táº¡o wrapper OBJECT
let b = new String("hello");
typeof b; // "object" â€” KHÃ”NG PHáº¢I string! âŒ

// Há»‡ quáº£ trong comparisons:
"hello" === new String("hello"); // false! (string vs object)
"hello" == new String("hello"); // true  (coercion unwraps)

// ğŸ“Œ NEVER dÃ¹ng new String/Number/Boolean trong production!
// ESLint rule: no-new-wrappers
```

**Há»‡ quáº£ 3 â€” Má»—i `.method()` trÃªn string táº¡o garbage:**

```javascript
// Má»—i dÃ²ng dÆ°á»›i Ä‘Ã¢y táº¡o + há»§y 1 wrapper object:
let name = "John";
name.length; // wrapper #1 â†’ length â†’ há»§y
name.toUpperCase(); // wrapper #2 â†’ method â†’ há»§y
name.includes("o"); // wrapper #3 â†’ method â†’ há»§y

// Trong hot loop: N iterations Ã— M method calls = NÃ—M wrappers!
// V8 optimize báº±ng cÃ¡ch CACHE wrapper trong má»™t sá»‘ trÆ°á»ng há»£p,
// nhÆ°ng Ä‘Ã¢y váº«n lÃ  overhead thá»±c táº¿ á»Ÿ scale lá»›n.

// ğŸ“Œ BEST PRACTICE trong performance-critical code:
const len = str.length; // 1 wrapper, cache káº¿t quáº£
for (let i = 0; i < len; i++) {
  // khÃ´ng táº¡o wrapper má»—i iteration
  // ...
}
```

3 kiá»ƒu primitive cÃ³ wrapper objects: `String`, `Number`, `Boolean`. `null` vÃ  `undefined` **KHÃ”NG CÃ“** wrapper â€” Ä‘Ã¢y lÃ  lÃ½ do `null.toString()` throw TypeError. `Symbol` vÃ  `BigInt` cÃ³ prototype methods nhÆ°ng **cáº¥m `new`** (`new Symbol()` â†’ TypeError) â€” Ä‘Ã¢y lÃ  thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch cá»§a ES6+ Ä‘á»ƒ trÃ¡nh nháº§m láº«n giá»¯a primitive vÃ  wrapper object.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTO-BOXING MECHANISM                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  "hello".toUpperCase()                                          â”‚
â”‚                                                                 â”‚
â”‚  Step 1: Engine tháº¥y .method() trÃªn primitive                   â”‚
â”‚          â†“                                                      â”‚
â”‚  Step 2: Táº¡o wrapper: tmp = new String("hello")                 â”‚
â”‚          â†“                                                      â”‚
â”‚  Step 3: Gá»i method: tmp.toUpperCase() â†’ "HELLO"               â”‚
â”‚          â†“                                                      â”‚
â”‚  Step 4: Há»§y wrapper: tmp = null (GC eligible)                  â”‚
â”‚          â†“                                                      â”‚
â”‚  Step 5: Return "HELLO" (primitive má»›i)                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Primitive    â”‚ Wrapper        â”‚ Has new?  â”‚ Auto-box?     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  string       â”‚ String         â”‚ âœ… Yes    â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚  number       â”‚ Number         â”‚ âœ… Yes    â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚  boolean      â”‚ Boolean        â”‚ âœ… Yes    â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚  symbol       â”‚ Symbol         â”‚ âŒ No     â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚  bigint       â”‚ BigInt         â”‚ âŒ No     â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚  null         â”‚ âŒ None        â”‚ âŒ N/A    â”‚ âŒ TypeError  â”‚ â”‚
â”‚  â”‚  undefined    â”‚ âŒ None        â”‚ âŒ N/A    â”‚ âŒ TypeError  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Copy by Value vs Copy by Reference

ÄÃ¢y lÃ  khÃ¡i niá»‡m **gÃ¢y nhiá»u bug nháº¥t** cho junior developers, vÃ  cÅ©ng lÃ  cÃ¢u há»i phá»ng váº¥n **xuáº¥t hiá»‡n nhiá»u nháº¥t** á»Ÿ má»i level.

**Copy by Value** (Primitives): Khi báº¡n gÃ¡n `let b = a`, JS táº¡o má»™t **báº£n sao hoÃ n toÃ n má»›i** cá»§a giÃ¡ trá»‹. Sau Ä‘Ã³ `a` vÃ  `b` lÃ  2 biáº¿n Äá»˜C Láº¬P â€” thay Ä‘á»•i má»™t cÃ¡i khÃ´ng áº£nh hÆ°á»Ÿng cÃ¡i kia. TÆ°Æ¡ng tá»± nhÆ° photocopy má»™t tá» giáº¥y â€” tá» gá»‘c vÃ  tá» copy tá»“n táº¡i Ä‘á»™c láº­p.

**Copy by Reference** (Objects): Khi báº¡n gÃ¡n `let obj2 = obj1`, JS KHÃ”NG copy object. Thay vÃ o Ä‘Ã³, `obj2` nháº­n Ä‘Æ°á»£c **cÃ¹ng má»™t con trá»** (pointer/reference) Ä‘áº¿n object trong heap. Cáº£ hai biáº¿n cÃ¹ng trá» Ä‘áº¿n Má»˜T object â€” thay Ä‘á»•i qua `obj2` sáº½ áº£nh hÆ°á»Ÿng `obj1` vÃ  ngÆ°á»£c láº¡i. TÆ°Æ¡ng tá»± nhÆ° 2 chÃ¬a khÃ³a má»Ÿ cÃ¹ng 1 nhÃ  â€” ai vÃ o sá»­a Ä‘á»“ thÃ¬ ngÆ°á»i kia cÅ©ng tháº¥y.

**Táº¡i sao React quan tÃ¢m Ä‘áº¿n Ä‘iá»u nÃ y?** VÃ¬ React dÃ¹ng **referential equality** (`Object.is()`, tÆ°Æ¡ng Ä‘Æ°Æ¡ng `===`) Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cÃ³ re-render hay khÃ´ng. Náº¿u báº¡n mutate object trá»±c tiáº¿p (`state.count++`), reference KHÃ”NG Äá»”I â†’ React KHÃ”NG THáº¤Y thay Ä‘á»•i â†’ KHÃ”NG re-render! ÄÃ¢y lÃ  lÃ½ do React báº¯t buá»™c pháº£i táº¡o object Má»šI: `setState({ ...state, count: state.count + 1 })`. Spread operator táº¡o **shallow copy** â€” reference má»›i â†’ React detect Ä‘Æ°á»£c change.

**Shallow Copy vs Deep Copy**: `{ ...obj }` vÃ  `Object.assign()` chá»‰ copy **táº§ng Ä‘áº§u tiÃªn**. Nested objects váº«n share reference! `structuredClone()` (ES2022) má»›i thá»±c sá»± deep copy â€” nhÆ°ng nÃ³ KHÃ”NG copy functions, DOM nodes, hay Error objects. Trong production, nhiá»u team dÃ¹ng Immer (tá»« Redux Toolkit) Ä‘á»ƒ giáº£i quyáº¿t immutable updates má»™t cÃ¡ch ergonomic hÆ¡n.

```javascript
// COPY BY VALUE (Primitives)
let a = 10;
let b = a; // b gets a COPY of a's value
b = 20;
console.log(a); // 10 (unchanged)
console.log(b); // 20

// COPY BY REFERENCE (Objects)
let obj1 = { x: 10 };
let obj2 = obj1; // obj2 gets same REFERENCE
obj2.x = 20;
console.log(obj1.x); // 20 (CHANGED!)
console.log(obj2.x); // 20

// To copy object by value, use spread or Object.assign
let obj3 = { ...obj1 }; // Shallow copy
let obj4 = structuredClone(obj1); // Deep copy (modern)
```

**PhÃ¢n TÃ­ch ToÃ n Diá»‡n 7 PhÆ°Æ¡ng PhÃ¡p Clone Object â€” Trade-offs Báº¡n Pháº£i Biáº¿t:**

Má»™t trong nhá»¯ng quyáº¿t Ä‘á»‹nh architecture quan trá»ng nháº¥t mÃ  Senior developer pháº£i Ä‘Æ°a ra hÃ ng ngÃ y lÃ : **"DÃ¹ng cÃ¡ch nÃ o Ä‘á»ƒ clone object?"**. KhÃ´ng cÃ³ "best method" cho má»i trÆ°á»ng há»£p â€” má»—i phÆ°Æ¡ng phÃ¡p cÃ³ trade-off riÃªng, vÃ  chá»n sai cÃ³ thá»ƒ gÃ¢y bug áº©n hoáº·c performance bottleneck. ÄÃ¢y lÃ  báº£ng so sÃ¡nh chi tiáº¿t nháº¥t báº¡n sáº½ tÃ¬m tháº¥y:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7 CLONING METHODS â€” COMPREHENSIVE COMPARISON                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Method            â”‚ Depth â”‚ Speed  â”‚ Func â”‚ Date â”‚ Circular Refs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ = (assign ref)    â”‚ NONE  â”‚ âš¡     â”‚ âœ…   â”‚ âœ…   â”‚ âœ… (same obj)   â”‚
â”‚ { ...obj }        â”‚ 1     â”‚ âš¡     â”‚ âœ…   â”‚ âŒ*  â”‚ âŒ              â”‚
â”‚ Object.assign()   â”‚ 1     â”‚ âš¡     â”‚ âœ…   â”‚ âŒ*  â”‚ âŒ              â”‚
â”‚ JSON parse/str    â”‚ FULL  â”‚ ğŸŒğŸŒ  â”‚ âŒ   â”‚ âŒ   â”‚ âŒ (throws!)    â”‚
â”‚ structuredClone() â”‚ FULL  â”‚ ğŸŒ    â”‚ âŒ   â”‚ âœ…   â”‚ âœ…              â”‚
â”‚ lodash.cloneDeep  â”‚ FULL  â”‚ ğŸŒ    â”‚ âœ…   â”‚ âœ…   â”‚ âœ…              â”‚
â”‚ Immer produce()   â”‚ COW*  â”‚ âš¡    â”‚ âœ…   â”‚ âœ…   â”‚ âŒ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ * Spread/assign copy Date as Date object nhÆ°ng KHÃ”NG deep clone    â”‚
â”‚ * Immer = Copy-on-Write: chá»‰ clone pháº§n bá»‹ thay Ä‘á»•i!              â”‚
â”‚ ğŸ“Œ Production choice: Immer (React/Redux) > structuredClone > rest â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// === CHI TIáº¾T 7 PHÆ¯Æ NG PHÃP CLONE ===

const original = {
  name: "Alice",
  scores: [95, 87, 92],
  address: { city: "HCMC", zip: "700000" },
  birthday: new Date("1995-01-15"),
  greet: function () {
    return `Hi, I'm ${this.name}`;
  },
};

// === 1. SPREAD OPERATOR { ...obj } â€” Shallow, nhanh nháº¥t ===
const spread = { ...original };
spread.scores.push(100); // âš ï¸ MUTATES original.scores!
spread.name = "Bob"; // âœ… OK â€” primitive, táº¡o copy
// Khi nÃ o dÃ¹ng: state updates PHáº²NG (flat), like useState({ ...state, key: value })

// === 2. OBJECT.ASSIGN() â€” Shallow, giá»‘ng spread ===
const assigned = Object.assign({}, original);
// KhÃ¡c spread: assign cÃ³ thá»ƒ merge NHIá»€U sources:
Object.assign(target, source1, source2, source3);
// Last source wins náº¿u cÃ¹ng key â†’ useful cho default configs
const config = Object.assign({}, defaultConfig, userConfig, overrides);

// === 3. JSON.PARSE(JSON.STRINGIFY()) â€” Deep nhÆ°ng lossy ===
const jsonClone = JSON.parse(JSON.stringify(original));
jsonClone.scores.push(100); // âœ… KhÃ´ng mutate original
// NHÆ¯NG:
// - original.greet â†’ Máº¤T (functions bá»‹ strip!)
// - original.birthday â†’ "1995-01-15T00:00:00.000Z" (thÃ nh STRING!)
// - undefined â†’ Máº¤T, NaN â†’ null, Infinity â†’ null
// - Map, Set, RegExp, Error â†’ {} (object rá»—ng!)
// - Circular reference â†’ TypeError: Converting circular structure!
// Khi nÃ o dÃ¹ng: ONLY cho plain data objects (API responses, JSON-safe data)

// === 4. STRUCTUREDCLONE() (ES2022) â€” Deep, native, handles most types ===
const structured = structuredClone(original);
structured.scores.push(100); // âœ… KhÃ´ng mutate
structured.birthday.getTime(); // âœ… Váº«n lÃ  Date object!
// NHÆ¯NG:
// - original.greet â†’ ERROR (functions KHÃ”NG Ä‘Æ°á»£c clone!)
// - DOM nodes â†’ ERROR
// - Symbols â†’ ERROR
// Browser support: Chrome 98+, Firefox 94+, Node 17+
// Khi nÃ o dÃ¹ng: Deep copy cho data objects (cÃ³ Date, Map, Set, ArrayBuffer...)

// === 5. LODASH _.CLONEDEEP() â€” Deep, handles everything ===
import { cloneDeep } from "lodash-es"; // tree-shakeable!
const lodashClone = cloneDeep(original);
lodashClone.greet(); // âœ… Functions preserved!
// Pro: Handles ALL types including functions, circular refs, symbols
// Con: Bundle size (+5.6KB gzipped cho cloneDeep riÃªng láº»)
// Khi nÃ o dÃ¹ng: Khi cáº§n clone "báº¥t ká»³ thá»© gÃ¬" (testing, complex data)

// === 6. IMMER â€” Copy-on-Write, BEST cho React/Redux ===
import { produce } from "immer";
const nextState = produce(original, (draft) => {
  // draft TRÃ”NG GIá»NG mutable, nhÆ°ng Immer dÃ¹ng Proxy
  // Ä‘á»ƒ TRACK thay Ä‘á»•i vÃ  CHá»ˆ CLONE pháº§n bá»‹ modify!
  draft.scores.push(100); // Immer clone scores array
  draft.address.city = "HN"; // Immer clone address object
  // draft.name â†’ KHÃ”NG bá»‹ clone (khÃ´ng thay Ä‘á»•i)
});
// â†’ nextState: new object reference âœ…
// â†’ nextState.scores: new array reference âœ…
// â†’ nextState.birthday: SAME reference (unchanged) â†’ zero cost!
// â†’ original: UNCHANGED âœ…
// Khi nÃ o dÃ¹ng: React state updates, Redux reducers (RTK dÃ¹ng Immer built-in!)

// === 7. MANUAL RECURSIVE CLONE â€” Full control, interview favorite ===
function deepClone(obj, visited = new WeakMap()) {
  // Base case: primitives
  if (obj === null || typeof obj !== "object") return obj;

  // Handle circular references
  if (visited.has(obj)) return visited.get(obj);

  // Handle special types
  if (obj instanceof Date) return new Date(obj.getTime());
  if (obj instanceof RegExp) return new RegExp(obj.source, obj.flags);
  if (obj instanceof Map) {
    const map = new Map();
    visited.set(obj, map);
    obj.forEach((v, k) =>
      map.set(deepClone(k, visited), deepClone(v, visited)),
    );
    return map;
  }
  if (obj instanceof Set) {
    const set = new Set();
    visited.set(obj, set);
    obj.forEach((v) => set.add(deepClone(v, visited)));
    return set;
  }

  // Handle arrays and plain objects
  const clone = Array.isArray(obj) ? [] : {};
  visited.set(obj, clone);

  for (const key of Reflect.ownKeys(obj)) {
    // includes Symbols!
    clone[key] = deepClone(obj[key], visited);
  }
  return clone;
}
// â†’ Interview tip: viáº¿t Ä‘Æ°á»£c function nÃ y = chá»©ng minh hiá»ƒu recursive,
//   WeakMap (GC-safe visited tracking), Reflect API, vÃ  edge cases
```

**Quy táº¯c chá»n phÆ°Æ¡ng phÃ¡p clone trong production:**

1. **React state (flat)** â†’ spread `{ ...state, key: value }` â€” Ä‘Æ¡n giáº£n, nhanh, Ä‘á»§ dÃ¹ng
2. **React state (nested)** â†’ Immer `produce()` â€” readable, performant (copy-on-write)
3. **Redux** â†’ RTK's `createSlice` (Immer built-in) â€” zero config
4. **API response caching** â†’ `structuredClone()` â€” native, handles Date/Map/Set
5. **Testing / debugging** â†’ `lodash.cloneDeep` â€” handles everything
6. **Serialization / storage** â†’ `JSON.parse(JSON.stringify())` â€” only for JSON-safe data
7. **Interview** â†’ manual recursive â†’ demonstrates understanding

**Pitfall kinh Ä‘iá»ƒn â€” "Shallow copy trap" trong React:**

```javascript
// BUG phá»• biáº¿n nháº¥t cá»§a junior React developer:
const [user, setUser] = useState({
  name: "Alice",
  address: { city: "HCMC", district: "Q1" },
});

// âŒ BUG: shallow copy â†’ address váº«n share reference!
setUser({ ...user, address: { ...user.address, city: "HN" } }); // âœ… Pháº£i spread nested!

// âŒ Äáº¶C BIá»†T NGUY HIá»‚M: spread array of objects
setUser({
  ...user,
  friends: [...user.friends], // shallow copy!
  // friends[0] váº«n share reference vá»›i original!
  // Pháº£i: friends: user.friends.map(f => ({...f})) hoáº·c dÃ¹ng Immer!
});

// âœ… Immer xá»­ lÃ½ táº¥t cáº£ má»™t cÃ¡ch dá»… Ä‘á»c:
setUser(
  produce((draft) => {
    draft.address.city = "HN";
    draft.friends[0].name = "Bob";
    // Immer tá»± handle nested cloning!
  }),
);
```

### Type Coercion Deep Dive â€” Abstract Operations BÃªn Trong Engine

Type coercion lÃ  **cÆ¡ cháº¿ gÃ¢y nhiá»u bug nháº¥t** trong JavaScript â€” vÃ  Ä‘Ã¢y lÃ  chá»§ Ä‘á» phá»ng váº¥n mÃ  interviewer cÃ³ thá»ƒ há»i suá»‘t 30 phÃºt mÃ  báº¡n váº«n chÆ°a tráº£ lá»i háº¿t. Hiá»ƒu type coercion á»Ÿ má»©c abstract operations giÃºp báº¡n **predict** káº¿t quáº£ thay vÃ¬ **memorize** â€” vÃ¬ cÃ³ quÃ¡ nhiá»u trÆ°á»ng há»£p Ä‘á»ƒ nhá»› háº¿t.

**Implicit vs Explicit Coercion:**

- **Explicit** (developer chá»§ Ä‘á»™ng): `Number("42")`, `String(42)`, `Boolean(0)`, `parseInt("42px")`
- **Implicit** (engine tá»± Ä‘á»™ng): `"5" - 1`, `if (value)`, `[] + {}`, `"" == false`

Implicit coercion xáº£y ra khi engine gáº·p giÃ¡ trá»‹ **sai kiá»ƒu** cho toÃ¡n tá»­/context. Engine pháº£i tá»± convert â€” vÃ  quy táº¯c convert **Ráº¤T PHá»¨C Táº P**. ECMAScript spec Ä‘á»‹nh nghÄ©a 4 "abstract operations" (thuáº­t toÃ¡n ná»™i bá»™) mÃ  engine dÃ¹ng:

**1. ToPrimitive(input, preferredType)** â€” Convert object â†’ primitive:

ÄÃ¢y lÃ  abstract operation quan trá»ng nháº¥t. Khi engine cáº§n primitive tá»« object, nÃ³ gá»i ToPrimitive theo thá»© tá»±:

- Náº¿u `preferredType` lÃ  "number": gá»i `valueOf()` trÆ°á»›c â†’ náº¿u káº¿t quáº£ KHÃ”NG pháº£i primitive â†’ gá»i `toString()`
- Náº¿u `preferredType` lÃ  "string": gá»i `toString()` trÆ°á»›c â†’ náº¿u KHÃ”NG pháº£i primitive â†’ gá»i `valueOf()`
- Náº¿u cáº£ 2 Ä‘á»u tráº£ vá» object â†’ TypeError!

ES6 thÃªm `Symbol.toPrimitive` â€” náº¿u object cÃ³ method nÃ y, nÃ³ OVERRIDE hoÃ n toÃ n `valueOf`/`toString`.

```javascript
// CUSTOM ToPrimitive â€” kiá»ƒm soÃ¡t coercion hoÃ n toÃ n
const price = {
  amount: 42,
  currency: "USD",

  // ES6: Symbol.toPrimitive override EVERYTHING
  [Symbol.toPrimitive](hint) {
    if (hint === "number") return this.amount; // +price, price * 2
    if (hint === "string") return `${this.amount} ${this.currency}`; // `${price}`
    return this.amount; // hint === "default" (==, +)
  },
};

console.log(+price); // 42       (hint: "number")
console.log(`${price}`); // "42 USD" (hint: "string")
console.log(price + 0); // 42       (hint: "default")
console.log(price == 42); // true     (hint: "default")
```

**2. ToNumber(argument)** â€” Convert â†’ number:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ToNumber() CONVERSION TABLE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input       â”‚ Káº¿t quáº£                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  undefined   â”‚ NaN                                              â”‚
â”‚  null        â”‚ 0 (!!!)                                          â”‚
â”‚  true        â”‚ 1                                                â”‚
â”‚  false       â”‚ 0                                                â”‚
â”‚  ""          â”‚ 0 (!!!)                                          â”‚
â”‚  "42"        â”‚ 42                                               â”‚
â”‚  "42px"      â”‚ NaN                                              â”‚
â”‚  " 42 "      â”‚ 42 (trim whitespace)                             â”‚
â”‚  "0x1A"      â”‚ 26 (hex parsing)                                 â”‚
â”‚  []          â”‚ 0 (â†’ "" â†’ 0)                                    â”‚
â”‚  [1]         â”‚ 1 (â†’ "1" â†’ 1)                                   â”‚
â”‚  [1,2]       â”‚ NaN (â†’ "1,2" â†’ NaN)                             â”‚
â”‚  {}          â”‚ NaN (â†’ "[object Object]" â†’ NaN)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ null â†’ 0 nhÆ°ng undefined â†’ NaN: KHÃ”NG nháº¥t quÃ¡n!          â”‚
â”‚  ğŸ“Œ "" â†’ 0: empty string bá»‹ coi lÃ  "zero" â€” gÃ¢y bug tháº§m láº·ngâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**3. ToString(argument)** â€” Convert â†’ string:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ToString() CONVERSION TABLE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input       â”‚ Káº¿t quáº£                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  undefined   â”‚ "undefined"                                      â”‚
â”‚  null        â”‚ "null"                                           â”‚
â”‚  true        â”‚ "true"                                           â”‚
â”‚  false       â”‚ "false"                                          â”‚
â”‚  42          â”‚ "42"                                             â”‚
â”‚  -0          â”‚ "0" (!!!)                                        â”‚
â”‚  Infinity    â”‚ "Infinity"                                       â”‚
â”‚  NaN         â”‚ "NaN"                                            â”‚
â”‚  []          â”‚ "" (empty!)                                      â”‚
â”‚  [1,2,3]     â”‚ "1,2,3"                                         â”‚
â”‚  {}          â”‚ "[object Object]"                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ -0 â†’ "0": JS che giáº¥u negative zero!                      â”‚
â”‚     String(-0) === "0" nhÆ°ng Object.is(-0, 0) === false        â”‚
â”‚  ğŸ“Œ Array.toString() = Array.join(",") â€” KHÃ”NG cÃ³ [ ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**4. ToBoolean(argument)** â€” Convert â†’ boolean:

Chá»‰ cÃ³ **8 giÃ¡ trá»‹ falsy**: `false`, `0`, `-0`, `0n`, `""`, `null`, `undefined`, `NaN`. Má»ŒI THá»¨ KHÃC lÃ  truthy â€” ká»ƒ cáº£ `[]`, `{}`, `"0"`, `"false"`, `new Boolean(false)`.

Äáº·c biá»‡t: `new Boolean(false)` lÃ  **truthy** vÃ¬ nÃ³ lÃ  object (wrapper), khÃ´ng pháº£i primitive `false`. ÄÃ¢y lÃ  lÃ½ do ESLint cáº¥m `new Boolean()`.

```javascript
// === TYPE COERCION QUIZ â€” Báº¡n Ä‘oÃ¡n Ä‘Ãºng bao nhiÃªu? ===

// TOÃN Tá»¬ + (PHá»¨C Táº P NHáº¤T!)
// Quy táº¯c: Náº¿u Má»˜T bÃªn lÃ  string â†’ string concat. Náº¿u KHÃ”NG â†’ numeric add.
console.log(1 + "2"); // "12"  â€” number + string â†’ concat
console.log("3" + 4); // "34"  â€” string + number â†’ concat
console.log(1 + 2 + "3"); // "33"  â€” (1+2)=3, 3+"3"="33" (trÃ¡iâ†’pháº£i!)
console.log("1" + 2 + 3); // "123" â€” "1"+2="12", "12"+3="123"

// TOÃN Tá»¬ - * / (ÄÆ N GIáº¢N HÆ N â€” luÃ´n ToNumber)
console.log("5" - 1); // 4     â€” ToNumber("5")=5, 5-1=4
console.log("5" * "3"); // 15    â€” ToNumber cáº£ hai
console.log("abc" - 1); // NaN   â€” ToNumber("abc")=NaN

// OBJECT COERCION (ToPrimitive!)
console.log([] + []); // ""    â€” [].toString()="" â†’ ""+""=""
console.log([] + {}); // "[object Object]" â€” ""+{}.toString()
console.log({} + []); // 0 hoáº·c "[object Object]" â€” CÃ’N TÃ™Y CONTEXT!
// â†’ á» Ä‘áº§u statement: {} lÃ  block â†’ +[] â†’ ToNumber([]) â†’ 0
// â†’ Trong expression: ({}) + [] â†’ "[object Object]"

// EQUALITY COERCION (==)
console.log(false == ""); // true  â€” ToNumber(false)=0, ToNumber("")=0
console.log(false == "0"); // true  â€” ToNumber(false)=0, ToNumber("0")=0
console.log("" == "0"); // false â€” string so sÃ¡nh trá»±c tiáº¿p!
// â†’ VÃ¬ váº­y: false == "" && false == "0" nhÆ°ng "" != "0"
// â†’ == KHÃ”NG cÃ³ tÃ­nh transitive! â˜…â˜…â˜…

console.log(null == undefined); // true  â€” spec quy Ä‘á»‹nh Ä‘áº·c biá»‡t
console.log(null == 0); // false â€” null KHÃ”NG coerce sang 0 trong ==
console.log(undefined == false); // false â€” undefined KHÃ”NG coerce trong ==

// BáºªY KINH ÄIá»‚N:
console.log([] == false); // true!  â€” ToPrimitive([])="" â†’ ToNumber("")=0 â†’ 0==0
console.log([] == ![]); // true!  â€” ![] = false â†’ []==false â†’ true (nhÆ° trÃªn!)
// â†’ ÄÃ¢y lÃ  cÃ¢u há»i phá»ng váº¥n "báº¥t há»§" â€” giáº£i thÃ­ch Ä‘Æ°á»£c = Senior level â˜…â˜…â˜…
```

**Táº¡i sao `[] == ![]` lÃ  `true`?** â€” Giáº£i thÃ­ch tá»«ng bÆ°á»›c chi tiáº¿t:

1. `![]` â†’ `!true` (vÃ¬ `[]` lÃ  truthy â€” má»i object Ä‘á»u truthy) â†’ `false`
2. BÃ¢y giá»: `[] == false` â†’ engine Ã¡p dá»¥ng Abstract Equality Algorithm
3. ToNumber comparison: `ToPrimitive([])` â†’ `[].toString()` â†’ `""`
4. `"" == false` â†’ `ToNumber("")` â†’ `0`, `ToNumber(false)` â†’ `0`
5. `0 == 0` â†’ `true` âœ…

ÄÃ¢y lÃ  lÃ½ do **má»i style guide** (Airbnb, Google, StandardJS) Ä‘á»u yÃªu cáº§u dÃ¹ng `===` thay vÃ¬ `==`. Exception duy nháº¥t Ä‘Æ°á»£c cháº¥p nháº­n: `value == null` â€” check cáº£ null VÃ€ undefined trong 1 phÃ©p so sÃ¡nh, ngáº¯n gá»n hÆ¡n `value === null || value === undefined`.

**Type Coercion trong React â€” Báº«y thá»±c táº¿:**

```javascript
// Báº«y #1: Conditional rendering vá»›i 0
const count = 0;
return count && <div>Items: {count}</div>;
// â†’ Render "0" trÃªn mÃ n hÃ¬nh! VÃ¬ 0 lÃ  falsy nhÆ°ng React renders falsy NUMBER.
// Fix: count > 0 && <div>...</div>

// Báº«y #2: Conditional rendering vá»›i ""
const name = "";
return name && <div>Welcome {name}</div>;
// â†’ Render "" (empty string) â€” khÃ´ng tháº¥y gÃ¬ nhÆ°ng element VáºªN tá»“n táº¡i trong DOM!
// Fix: name ? <div>...</div> : null

// Báº«y #3: So sÃ¡nh state
const [value, setValue] = useState("0");
if (value == false) {
  // â†’ TRUE! VÃ¬ "0" == false â†’ ToNumber("0")=0 == ToNumber(false)=0
  // â†’ DÃ¹ng === sáº½ trÃ¡nh hoÃ n toÃ n: "0" === false â†’ false âœ…
}
```

### Immutability Chá»©ng Minh â€” Primitives Thá»±c Sá»± Báº¥t Biáº¿n NhÆ° Tháº¿ NÃ o?

"Immutable" (báº¥t biáº¿n) lÃ  tá»« báº¡n nghe ráº¥t nhiá»u nhÆ°ng Ã­t ai giáº£i thÃ­ch **chÃ­nh xÃ¡c** nÃ³ hoáº¡t Ä‘á»™ng ra sao á»Ÿ má»©c engine. HÃ£y phÃ¢n biá»‡t rÃµ: **immutable VALUE** (giÃ¡ trá»‹ khÃ´ng thá»ƒ thay Ä‘á»•i) khÃ¡c vá»›i **immutable BINDING** (biáº¿n khÃ´ng thá»ƒ re-assign â€” Ä‘Ã¢y lÃ  `const`).

```javascript
// === IMMUTABLE VALUE vs IMMUTABLE BINDING ===

// const = immutable BINDING (biáº¿n khÃ´ng re-assign Ä‘Æ°á»£c)
const x = 42;
x = 43; // TypeError: Assignment to constant variable

// NHÆ¯NG: const object = mutable VALUE!
const obj = { a: 1 };
obj.a = 2; // âœ… Hoáº¡t Ä‘á»™ng! Value thay Ä‘á»•i, binding khÃ´ng Ä‘á»•i.
// obj váº«n trá» Ä‘áº¿n CÃ™NG object â€” chá»‰ ná»™i dung object thay Ä‘á»•i.

// Primitives = immutable VALUE (giÃ¡ trá»‹ KHÃ”NG THá»‚ thay Ä‘á»•i)
let str = "hello";
str[0] = "H"; // THáº¦M Láº¶NG tháº¥t báº¡i (no error, no change!)
console.log(str); // "hello" â€” KHÃ”NG thay Ä‘á»•i!

str.toUpperCase(); // Tráº£ vá» "HELLO" â€” STRING Má»šI
console.log(str); // "hello" â€” str Gá»C khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng!

// Má»i "mutation" trÃªn string Ä‘á»u táº¡o STRING Má»šI:
let greeting = "Hello";
greeting += " World"; // JS táº¡o string Má»šI "Hello World",
// gÃ¡n vÃ o biáº¿n greeting. String cÅ© "Hello" bá»‹ orphan â†’ GC thu há»“i.
```

**Táº¡i sao V8 cÃ³ thá»ƒ optimize primitives tá»‘t hÆ¡n objects?**

ChÃ­nh vÃ¬ immutability! Khi V8 biáº¿t má»™t giÃ¡ trá»‹ **KHÃ”NG THá»‚ thay Ä‘á»•i**, nÃ³ cÃ³ thá»ƒ:

- **Deduplicate**: nhiá»u biáº¿n cÃ¹ng giÃ¡ trá»‹ `42` â†’ trá» Ä‘áº¿n CÃ™NG Smi, khÃ´ng tá»‘n thÃªm memory
- **Inline**: tháº¿ giÃ¡ trá»‹ trá»±c tiáº¿p vÃ o machine code (constant folding)
- **Cache**: an toÃ n cache káº¿t quáº£ mÃ  khÃ´ng sá»£ stale data
- **Eliminate**: bá» dead code chá»©a primitives mÃ  biáº¿t trÆ°á»›c káº¿t quáº£

Objects khÃ´ng Ä‘Æ°á»£c hÆ°á»Ÿng Æ°u Ä‘Ã£i nÃ y vÃ¬ chÃºng **mutable** â€” V8 pháº£i assume báº¥t ká»³ property nÃ o cÅ©ng cÃ³ thá»ƒ bá»‹ thay Ä‘á»•i báº¥t ká»³ lÃºc nÃ o bá»Ÿi báº¥t ká»³ code nÃ o. ÄÃ¢y chÃ­nh lÃ  triáº¿t lÃ½ Ä‘áº±ng sau React's immutable state updates.

```javascript
// === Táº I SAO IMMUTABILITY QUAN TRá»ŒNG CHO REACT? ===

// React dÃ¹ng Object.is() Ä‘á»ƒ so sÃ¡nh prev vs next state.
// Primitives: Object.is(42, 42) â†’ true â†’ SKIP re-render âœ…
// Objects: Object.is(obj, obj) â†’ true (same ref) â†’ SKIP âœ…
//          Object.is(obj, {...obj}) â†’ false (new ref) â†’ RE-RENDER âœ…

// Pattern ÄÃšNG cho primitives:
const [name, setName] = useState("John");
setName("Jane"); // Primitive má»›i â†’ reference má»›i â†’ re-render âœ…

// Pattern SAI cho objects:
const [user, setUser] = useState({ name: "John" });
user.name = "Jane"; // Mutate trá»±c tiáº¿p!
setUser(user); // CÃ™NG reference â†’ React KHÃ”NG tháº¥y change! âŒ

// Pattern ÄÃšNG cho objects:
setUser({ ...user, name: "Jane" }); // Spread = new ref â†’ re-render âœ…

// Hoáº·c dÃ¹ng Immer (Redux Toolkit built-in):
import { produce } from "immer";
setUser(
  produce(user, (draft) => {
    draft.name = "Jane";
  }),
);
// Immer táº¡o structural sharing: chá»‰ clone pháº§n thay Ä‘á»•i â†’ optimal! â˜…â˜…â˜…
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  IMMUTABILITY â€” VALUE vs BINDING                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  IMMUTABLE BINDING (const)     â”‚ IMMUTABLE VALUE (prim.) â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  const x = 42                  â”‚ let str = "hello"       â”‚   â”‚
â”‚  â”‚  x = 43 â†’ âŒ TypeError        â”‚ str[0] = "H" â†’ no-op   â”‚   â”‚
â”‚  â”‚                                â”‚                         â”‚   â”‚
â”‚  â”‚  const obj = { a: 1 }         â”‚ str.toUpperCase()       â”‚   â”‚
â”‚  â”‚  obj.a = 2 â†’ âœ… Works!        â”‚ â†’ NEW string "HELLO"    â”‚   â”‚
â”‚  â”‚  (binding same, value mutated) â”‚ (str gá»‘c unchanged)    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  const â‰  immutable!           â”‚ Primitives = truly      â”‚   â”‚
â”‚  â”‚  const = chá»‰ cáº¥m re-assign    â”‚ immutable at engine     â”‚   â”‚
â”‚  â”‚  KHÃ”NG cáº¥m mutate content!     â”‚ level! Cannot change!   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ const + Object.freeze() â†’ immutable binding + value (1 táº§ng)â”‚
â”‚  ğŸ“Œ NhÆ°ng freeze chá»‰ SHALLOW â€” nested objects váº«n mutable!     â”‚
â”‚  ğŸ“Œ Deep freeze â†’ recursion hoáº·c Immer                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Interview Cheat Sheet â€” Top 10 CÃ¢u Há»i Data Types

ÄÃ¢y lÃ  10 cÃ¢u há»i phá»ng váº¥n vá» Data Types mÃ  báº¡n **cháº¯c cháº¯n** sáº½ gáº·p á»Ÿ cÃ¡c cÃ´ng ty tech (Shopee, VinGroup, Grab, FPT, Google, Meta). Má»—i cÃ¢u kÃ¨m Ä‘Ã¡p Ã¡n chuáº©n á»Ÿ má»©c Senior:

```javascript
// Q1: typeof null lÃ  gÃ¬? Táº¡i sao?
typeof null === "object";
// â†’ Bug lá»‹ch sá»­ tá»« 1995. V8 predecessor dÃ¹ng bit pattern:
// object tag = 000, null = 0x00 â†’ 3 bits cuá»‘i trÃ¹ng â†’ bug!
// â†’ KhÃ´ng bao giá» Ä‘Æ°á»£c sá»­a vÃ¬ sáº½ phÃ¡ hÃ ng triá»‡u websites.

// Q2: NaN === NaN?
NaN === NaN; // false
// â†’ IEEE-754 spec: NaN â‰  má»i thá»©, ká»ƒ cáº£ chÃ­nh nÃ³.
// â†’ Check NaN: Number.isNaN(x) hoáº·c Object.is(x, NaN)
// â†’ Number.isNaN() â‰  isNaN(): isNaN("hello") â†’ true (bug!),
//   Number.isNaN("hello") â†’ false (Ä‘Ãºng!)

// Q3: 0.1 + 0.2 === 0.3?
0.1 + 0.2 === 0.3; // false (0.30000000000000004)
// â†’ IEEE-754 binary fraction: 0.1 = 0.0001100110011... (infinite)
// â†’ Fix: Math.abs(0.1 + 0.2 - 0.3) < Number.EPSILON

// Q4: [] == false? [] == ![]?
[] == false; // true  (ToPrimitiveâ†’""â†’0, ToNumber(false)â†’0)
[] == ![]; // true  (![]â†’false, rá»“i nhÆ° trÃªn)

// Q5: typeof function() {} lÃ  gÃ¬?
typeof function () {}; // "function" (khÃ´ng pháº£i "object"!)
// â†’ DÃ¹ function IS object, typeof tráº£ vá» "function" by design.
// â†’ typeof tráº£ vá» 8 giÃ¡ trá»‹: "number", "string", "boolean",
//   "undefined", "object", "function", "symbol", "bigint"
// â†’ KHÃ”NG CÃ“ "null" vÃ  "array"!

// Q6: Sá»± khÃ¡c biá»‡t giá»¯a null vÃ  undefined?
// undefined = chÆ°a gÃ¡n (system assigned), null = cá»‘ Ã½ trá»‘ng (developer set)
// undefined == null â†’ true, undefined === null â†’ false
// React convention: undefined = optional prop, null = render nothing

// Q7: "hello".length hoáº¡t Ä‘á»™ng tháº¿ nÃ o náº¿u string lÃ  primitive?
// â†’ Auto-boxing: JS táº¡o new String("hello"), Ä‘á»c .length, há»§y wrapper
// â†’ Má»—i .method() call trÃªn primitive = 1 wrapper object â†’ garbage

// Q8: Táº¡i sao const obj = {} váº«n cho phÃ©p obj.x = 1?
// â†’ const = immutable BINDING (khÃ´ng re-assign), KHÃ”NG immutable VALUE
// â†’ obj váº«n trá» cÃ¹ng address, chá»‰ content thay Ä‘á»•i
// â†’ Muá»‘n prevent mutation: Object.freeze(obj)

// Q9: CÃ³ bao nhiÃªu falsy values? Ká»ƒ tÃªn.
// â†’ 8: false, 0, -0, 0n (BigInt zero), "", null, undefined, NaN
// â†’ Má»i thá»© khÃ¡c truthy: [], {}, "0", "false", new Boolean(false)
// â†’ Báº«y: if ([]) â†’ TRUE! if ("0") â†’ TRUE! if ("false") â†’ TRUE!

// Q10: Object.is() khÃ¡c gÃ¬ === ?
Object.is(NaN, NaN); // true  (=== tráº£ vá» false)
Object.is(-0, 0); // false (=== tráº£ vá» true)
// â†’ React dÃ¹ng Object.is() thay vÃ¬ === cho dependency comparison!
```

**Bonus â€” "Trick question" cho Senior level:**

```javascript
// Trick 1: -0 trong JavaScript
-0 === 0; // true  (=== khÃ´ng phÃ¢n biá»‡t!)
Object.is(-0, 0); // false (Object.is phÃ¢n biá»‡t!)
String(-0); // "0"   (che giáº¥u dáº¥u trá»«!)
JSON.stringify(-0); // "0"   (JSON cÅ©ng máº¥t -0!)
// â†’ á»¨ng dá»¥ng: direction indicator (-0 = di chuyá»ƒn sang trÃ¡i)
// â†’ Math.sign(-0) â†’ -0, 1/(-0) â†’ -Infinity (cÃ¡ch detect -0)

// Trick 2: typeof trong Temporal Dead Zone
typeof undeclaredVar; // "undefined" â€” KHÃ”NG throw error!
typeof letVar; // ReferenceError! â€” let/const cÃ³ TDZ
let letVar = 42;
// â†’ typeof KHÃ”NG an toÃ n vá»›i let/const trÆ°á»›c khi khai bÃ¡o!
// â†’ ÄÃ¢y lÃ  Ä‘iá»ƒm khÃ¡c biá»‡t lá»›n giá»¯a var (hoisting) vÃ  let/const (TDZ)

// Trick 3: Document.all â€” "falsy object" duy nháº¥t trong JS
typeof document.all; // "undefined" (DÃ™ nÃ³ lÃ  object!)
Boolean(document.all); // false (DÃ™ nÃ³ tá»“n táº¡i!)
// â†’ Hack cá»• Ä‘áº¡i cho IE compatibility, spec pháº£i special-case!
// â†’ ÄÃ¢y lÃ  willful violation duy nháº¥t trong ECMAScript spec.

// Trick 4: BigInt edge cases
typeof 1n; // "bigint" â€” primitive type má»›i
1n == 1; // true  (loose equality coerces)
1n === 1; // false (strict: khÃ¡c type!)
1n + 1; // TypeError! â€” KHÃ”NG auto-coerce trong +
// â†’ Pháº£i explicit: 1n + BigInt(1) hoáº·c Number(1n) + 1

// Trick 5: Symbol as object key
const sym = Symbol("secret");
const obj = { [sym]: "hidden" };
JSON.stringify(obj); // "{}" â€” Symbol keys bá»‹ Bá» QUA!
Object.keys(obj); // []   â€” Symbol keys INVISIBLE!
Object.getOwnPropertySymbols(obj); // [Symbol(secret)] â€” cÃ¡ch duy nháº¥t!
```

### Equality Comparison Algorithms â€” `==` vs `===` vs `Object.is()` BÃªn Trong Engine

Báº¡n Ä‘Ã£ biáº¿t `===` tá»‘t hÆ¡n `==`, nhÆ°ng báº¡n cÃ³ biáº¿t **táº¡i sao**? VÃ  báº¡n cÃ³ biáº¿t React KHÃ”NG dÃ¹ng `===` mÃ  dÃ¹ng `Object.is()`? Pháº§n nÃ y sáº½ walk through tá»«ng thuáº­t toÃ¡n equality comparison cá»§a ECMAScript spec, giÃºp báº¡n hiá»ƒu á»Ÿ má»©c mÃ  interviewer khÃ´ng thá»ƒ há»i sÃ¢u hÆ¡n.

**JavaScript cÃ³ 4 thuáº­t toÃ¡n so sÃ¡nh báº±ng â€” vÃ  má»—i cÃ¡i phá»¥c vá»¥ má»¥c Ä‘Ã­ch khÃ¡c nhau:**

1. **Abstract Equality (`==`)** â€” coercion trÆ°á»›c, so sÃ¡nh sau. Phá»©c táº¡p, dá»… gÃ¢y bug.
2. **Strict Equality (`===`)** â€” khÃ´ng coercion, so sÃ¡nh kiá»ƒu + giÃ¡ trá»‹. An toÃ n hÆ¡n.
3. **SameValue (`Object.is()`)** â€” nhÆ° `===` nhÆ°ng phÃ¢n biá»‡t `-0/+0` vÃ  `NaN === NaN`. **React dÃ¹ng cÃ¡i nÃ y.**
4. **SameValueZero** â€” nhÆ° `Object.is()` nhÆ°ng `-0 === +0`. DÃ¹ng trong `Map`, `Set`, `Array.includes()`.

**Táº¡i sao láº¡i cáº§n 4 thuáº­t toÃ¡n?** VÃ¬ má»—i cÃ¡i ra Ä‘á»i trong bá»‘i cáº£nh khÃ¡c nhau. `==` ra Ä‘á»i tá»« 1995, reflection cá»§a dynamic typing philosophy. `===` Ä‘Æ°á»£c thÃªm vÃ¬ `==` quÃ¡ confusing. `Object.is()` (ES6) ra Ä‘á»i vÃ¬ `===` váº«n cÃ³ 2 edge case â€” `NaN !== NaN` (IEEE-754 legacy) vÃ  `-0 === +0` (che giáº¥u signed zero). React team chá»n `Object.is()` vÃ¬ há» cáº§n **chÃ­nh xÃ¡c tuyá»‡t Ä‘á»‘i** cho state comparison â€” náº¿u `NaN` trong state, `===` sáº½ trigger infinite re-render vÃ¬ `NaN !== NaN` luÃ´n `true`!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4 EQUALITY ALGORITHMS COMPARISON                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Expression         â”‚ ==    â”‚ ===   â”‚ Object.is â”‚ SameValueZeroâ”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  1 == "1"           â”‚ true  â”‚ false â”‚ false     â”‚ false        â”‚
â”‚  null == undefined  â”‚ true  â”‚ false â”‚ false     â”‚ false        â”‚
â”‚  NaN == NaN         â”‚ false â”‚ false â”‚ TRUE âœ…   â”‚ TRUE âœ…      â”‚
â”‚  -0 == +0           â”‚ true  â”‚ true  â”‚ FALSE âœ…  â”‚ true         â”‚
â”‚  false == 0         â”‚ true  â”‚ false â”‚ false     â”‚ false        â”‚
â”‚  "" == false        â”‚ true  â”‚ false â”‚ false     â”‚ false        â”‚
â”‚  [] == false        â”‚ true  â”‚ false â”‚ false     â”‚ false        â”‚
â”‚  42 === 42          â”‚ true  â”‚ true  â”‚ true      â”‚ true         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ React: Object.is() â†’ phÃ¢n biá»‡t -0/+0, NaN === NaN         â”‚
â”‚  ğŸ“Œ Map/Set: SameValueZero â†’ NaN === NaN, -0 === +0            â”‚
â”‚  ğŸ“Œ Production: luÃ´n dÃ¹ng === (99% cases) hoáº·c Object.is()    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Abstract Equality Algorithm (`==`) â€” Step by step tá»« ECMAScript Spec:**

Thuáº­t toÃ¡n `==` (section 7.2.14 trong spec) cÃ³ **~12 bÆ°á»›c** vÃ  cá»±c ká»³ phá»©c táº¡p. ÄÃ¢y lÃ  lÃ½ do `==` bá»‹ coi lÃ  "evil" â€” khÃ´ng pháº£i vÃ¬ nÃ³ sai, mÃ  vÃ¬ quÃ¡ khÃ³ predict káº¿t quáº£:

```javascript
// THUáº¬T TOÃN `==` ÄÆ N GIáº¢N HÃ“A:
// 1. Náº¿u CÃ™NG TYPE â†’ so sÃ¡nh giÃ¡ trá»‹ (giá»‘ng ===)
// 2. null == undefined â†’ true (spec hardcode!)
// 3. Number == String â†’ convert String â†’ Number
// 4. Boolean == anything â†’ convert Boolean â†’ Number trÆ°á»›c
// 5. Object == Primitive â†’ gá»i ToPrimitive(object)
// 6. BigInt == String â†’ convert String â†’ BigInt

// VÃ­ dá»¥: "5" == 5
// BÆ°á»›c 1: KhÃ¡c type (string vs number) â†’ tiáº¿p
// BÆ°á»›c 3: Convert "5" â†’ Number â†’ 5
// BÆ°á»›c 1 (láº·p): CÃ¹ng type (number) â†’ 5 === 5 â†’ true âœ…

// VÃ­ dá»¥: [] == false
// BÆ°á»›c 4: Convert false â†’ Number â†’ 0 â†’ [] == 0
// BÆ°á»›c 5: ToPrimitive([]) â†’ [].toString() â†’ "" â†’ "" == 0
// BÆ°á»›c 3: Convert "" â†’ Number â†’ 0 â†’ 0 == 0
// BÆ°á»›c 1 (láº·p): 0 === 0 â†’ true âœ…

// VÃ­ dá»¥: null == 0
// BÆ°á»›c 2: null chá»‰ == null hoáº·c undefined â†’ null != 0 â†’ false âœ…
// â†’ null KHÃ”NG bá»‹ coerce trong == (spec exception!)
```

**Strict Equality Algorithm (`===`) â€” ÄÆ¡n giáº£n hÆ¡n nhiá»u:**

```javascript
// THUáº¬T TOÃN `===`:
// 1. Náº¿u KHÃC TYPE â†’ false (dá»«ng ngay, KHÃ”NG coerce!)
// 2. Náº¿u cÃ¹ng type:
//    a. undefined === undefined â†’ true
//    b. null === null â†’ true
//    c. Number: NaN === anything â†’ false (!), -0 === +0 â†’ true
//    d. String: byte-by-byte comparison
//    e. Boolean: cÃ¹ng value â†’ true
//    f. Object: cÃ¹ng REFERENCE â†’ true (khÃ´ng compare content!)

// Edge cases:
NaN === NaN;    // false â€” IEEE-754 legacy, GÃ‚Y BUG vá»›i state comparison!
-0 === +0;      // true  â€” che giáº¥u signed zero
"abc" === "abc"; // true  â€” V8 intern strings â†’ pointer compare â†’ O(1)
{} === {};       // false â€” 2 objects KHÃC reference!

// Táº¡i sao NaN === NaN lÃ  false gÃ¢y váº¥n Ä‘á» cho React?
const [val, setVal] = useState(NaN);
// React check: Object.is(prevState, nextState)
// Náº¿u dÃ¹ng ===: NaN !== NaN â†’ always "changed" â†’ INFINITE RE-RENDER!
// Object.is() fix: Object.is(NaN, NaN) â†’ true â†’ skip re-render âœ…
```

**Object.is() â€” Táº¡i sao React chá»n nÃ³:**

`Object.is()` lÃ  phiÃªn báº£n "hoÃ n háº£o" nháº¥t cá»§a equality check. NÃ³ xá»­ lÃ½ Ä‘Ãºng 2 edge case mÃ  `===` fail:

```javascript
// Object.is() polyfill â€” giÃºp báº¡n hiá»ƒu internal logic:
function objectIs(x, y) {
  if (x === y) {
    // Xá»­ lÃ½ edge case -0: 1/x !== 1/y khi x=-0, y=+0
    // VÃ¬ 1/(-0) = -Infinity, 1/(+0) = +Infinity
    return x !== 0 || 1 / x === 1 / y;
  } else {
    // Xá»­ lÃ½ edge case NaN: chá»‰ NaN !== NaN
    return x !== x && y !== y;
  }
}

// React's internal comparison â€” Ä‘Æ¡n giáº£n báº¥t ngá»:
// packages/shared/objectIs.js
function is(x, y) {
  return (x === y && (x !== 0 || 1 / x === 1 / y)) || (x !== x && y !== y);
}
// â†’ React bá»c logic nÃ y á»Ÿ Má»ŒI NÆ I: useState, useEffect deps,
//   useMemo, useCallback, memo() â€” táº¥t cáº£ Ä‘á»u dÃ¹ng is() nÃ y!

// === SameValueZero â€” DÃ¹ng trong Map, Set, Array.includes() ===
const set = new Set();
set.add(NaN);
set.has(NaN); // true âœ… (SameValueZero: NaN === NaN)
set.add(-0);
set.has(0); // true âœ… (SameValueZero: -0 === +0)

const arr = [NaN, 1, 2];
arr.includes(NaN); // true âœ… (SameValueZero)
arr.indexOf(NaN); // -1 âŒ (indexOf dÃ¹ng ===, NaN !== NaN!)
// â†’ LuÃ´n dÃ¹ng .includes() thay .indexOf() khi check existence!
```

**Cheat sheet: Khi nÃ o dÃ¹ng thuáº­t toÃ¡n nÃ o?**

- **`===`**: 99% trÆ°á»ng há»£p thÃ´ng thÆ°á»ng. Default choice.
- **`==`**: CHá»ˆ cho `value == null` (thay cho `value === null || value === undefined`).
- **`Object.is()`**: Khi báº¡n cáº§n precision tuyá»‡t Ä‘á»‘i (state comparison, deep equality). React dÃ¹ng cÃ¡i nÃ y.
- **`SameValueZero`**: Báº¡n khÃ´ng gá»i trá»±c tiáº¿p â€” `Map`, `Set`, `Array.includes()` tá»± dÃ¹ng nÃ³.

### Type-Safe Defensive Programming â€” Patterns Cho Production Code

LÃ½ thuyáº¿t vá» data types ráº¥t hay, nhÆ°ng cÃ¢u há»i thá»±c táº¿ lÃ : **"Viáº¿t code production tháº¿ nÃ o Ä‘á»ƒ KHÃ”NG BAO GIá»œ bá»‹ type-related bugs?"** Pháº§n nÃ y tá»•ng há»£p cÃ¡c defensive patterns mÃ  Senior engineers dÃ¹ng hÃ ng ngÃ y â€” khÃ´ng pháº£i "best practices" lÃ½ thuyáº¿t, mÃ  lÃ  code patterns **thá»±c sá»± cháº¡y á»Ÿ scale lá»›n**.

**Triáº¿t lÃ½ cá»‘t lÃµi:** Trong production, báº¡n khÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c INPUT. Data tá»« API cÃ³ thá»ƒ sai type. Form input luÃ´n lÃ  string. URL params luÃ´n lÃ  string. JSON.parse() cÃ³ thá»ƒ tráº£ vá» báº¥t ká»³ thá»© gÃ¬. QUERY tá»« database cÃ³ thá»ƒ null. Defensive programming = **assume má»i input Ä‘á»u sai** cho Ä‘áº¿n khi chá»©ng minh ngÆ°á»£c láº¡i.

```javascript
// === PATTERN 1: TYPE GUARDS â€” Kiá»ƒm tra type trÆ°á»›c khi dÃ¹ng ===

// Guard Ä‘Æ¡n giáº£n â€” check trÆ°á»›c khi access
function getUserName(user) {
  // âŒ Crash náº¿u user lÃ  null/undefined
  // return user.name;

  // âœ… Defensive: check null/undefined trÆ°á»›c
  if (user == null) return "Anonymous"; // == null catch cáº£ null VÃ€ undefined
  if (typeof user.name !== "string") return "Anonymous";
  return user.name;
}

// Guard cho arrays â€” API cÃ³ thá»ƒ tráº£ vá» null thay vÃ¬ []
function processItems(items) {
  // âŒ Crash: items.map is not a function (náº¿u items = null)
  // return items.map(transform);

  // âœ… Defensive: normalize thÃ nh array trÆ°á»›c
  const safeItems = Array.isArray(items) ? items : [];
  return safeItems.map(transform);
}

// Guard cho numbers â€” form input luÃ´n lÃ  string!
function calculateDiscount(priceStr, discountStr) {
  const price = Number(priceStr);
  const discount = Number(discountStr);

  // âœ… Check NaN sau conversion
  if (Number.isNaN(price) || Number.isNaN(discount)) {
    throw new TypeError(
      `Invalid numbers: price=${priceStr}, discount=${discountStr}`,
    );
  }
  // âœ… Check range
  if (discount < 0 || discount > 100) {
    throw new RangeError(`Discount must be 0-100, got ${discount}`);
  }
  return price * (1 - discount / 100);
}

// === PATTERN 2: SAFE COERCION â€” Chá»§ Ä‘á»™ng convert thay vÃ¬ Ä‘á»ƒ JS tá»± lÃ m ===

// âŒ Implicit coercion â€” unpredictable
function badConcat(a, b) {
  return a + b; // "5" + 3 = "53", 5 + 3 = 8 â†’ BUG!
}

// âœ… Explicit coercion â€” predictable
function safeAdd(a, b) {
  return Number(a) + Number(b); // LuÃ´n numeric addition
}

function safeConcat(a, b) {
  return String(a) + String(b); // LuÃ´n string concat
}

// Safe number parsing â€” luÃ´n kiá»ƒm tra káº¿t quáº£
function parseIntSafe(value, radix = 10) {
  const result = parseInt(value, radix);
  if (Number.isNaN(result)) return 0; // default value thay vÃ¬ NaN
  return result;
}

// === PATTERN 3: NULLISH COALESCING & OPTIONAL CHAINING (ES2020+) ===

// TrÆ°á»›c ES2020: dÃ¹ng || nhÆ°ng bá»‹ falsy trap
const port = config.port || 3000;
// BUG: náº¿u config.port = 0 â†’ 0 || 3000 = 3000 (0 lÃ  falsy!)

// ES2020: ?? chá»‰ check null/undefined, KHÃ”NG check 0/""/false
const portSafe = config.port ?? 3000;
// config.port = 0 â†’ 0 âœ… (0 KHÃ”NG pháº£i nullish)
// config.port = undefined â†’ 3000 âœ…

// Optional chaining â€” access sÃ¢u mÃ  khÃ´ng crash
const city = user?.address?.city ?? "Unknown";
// Náº¿u user = null â†’ undefined, KHÃ”NG throw TypeError!
// Náº¿u address = undefined â†’ undefined, chain dá»«ng an toÃ n!

// Combo pattern cho API response:
const items = response?.data?.items ?? [];
const count = response?.data?.pagination?.total ?? 0;
const name = response?.data?.user?.name?.trim() ?? "Anonymous";

// === PATTERN 4: RUNTIME VALIDATION â€” Zod/Yup cho API boundaries ===

// Boundary = nÆ¡i data NHáº¬P VÃ€O há»‡ thá»‘ng (API, form, URL params)
// â†’ Validate Táº I BOUNDARY, trust data SAU boundary

// VÃ­ dá»¥ vá»›i Zod (type-safe validation):
import { z } from "zod";

const UserSchema = z.object({
  id: z.number().int().positive(),
  name: z.string().min(1).max(100),
  email: z.string().email(),
  age: z.number().int().min(0).max(150).optional(),
  role: z.enum(["admin", "user", "moderator"]),
});

// Parse API response â€” throw náº¿u sai format
function fetchUser(id) {
  return fetch(`/api/users/${id}`)
    .then((res) => res.json())
    .then((data) => UserSchema.parse(data)) // â† validate á»Ÿ boundary!
    .catch((err) => {
      if (err instanceof z.ZodError) {
        console.error("Invalid API data:", err.issues);
        // â†’ Log to Sentry, show user-friendly error
      }
      throw err;
    });
}
// Sau parse() â†’ TypeScript biáº¿t data cÃ³ type User, KHÃ”NG cáº§n check thÃªm!
```

```javascript
// === PATTERN 5: REACT-SPECIFIC TYPE SAFETY ===

// Pattern 5a: Safe conditional rendering
function ItemList({ items, count }) {
  // âŒ BUG: count = 0 â†’ render "0" trÃªn mÃ n hÃ¬nh
  // return count && <List items={items} />;

  // âœ… FIX: explicit boolean check
  return count > 0 ? <List items={items} /> : null;
}

// Pattern 5b: Default props vá»›i Ä‘Ãºng type
function UserCard({ name = "Anonymous", score = 0, tags = [] }) {
  // ES6 default params = safe default CHá»ˆ khi prop lÃ  undefined
  // NHÆ¯NG: null KHÃ”NG trigger default! name = null â†’ name lÃ  null, KHÃ”NG "Anonymous"!

  // âœ… Robust: handle cáº£ null
  const safeName = name ?? "Anonymous";
  const safeScore = typeof score === "number" ? score : 0;
  const safeTags = Array.isArray(tags) ? tags : [];
  // ...
}

// Pattern 5c: Safe state updates
function useCounter(initialValue = 0) {
  const [count, setCount] = useState(
    typeof initialValue === "number" && !Number.isNaN(initialValue)
      ? initialValue
      : 0, // fallback náº¿u caller truyá»n undefined/NaN
  );

  const increment = useCallback(() => {
    setCount((prev) => {
      const next = prev + 1;
      // Guard: Ä‘áº£m báº£o count khÃ´ng vÆ°á»£t MAX_SAFE_INTEGER
      return Number.isSafeInteger(next) ? next : prev;
    });
  }, []);

  return [count, increment];
}

// Pattern 5d: Safe useEffect dependency
function useApiData(endpoint) {
  const [data, setData] = useState(null);

  useEffect(() => {
    // Guard: náº¿u endpoint khÃ´ng pháº£i string â†’ skip
    if (typeof endpoint !== "string" || endpoint.trim() === "") {
      return;
    }

    let cancelled = false;
    fetch(endpoint)
      .then((res) => res.json())
      .then((json) => {
        if (!cancelled) setData(json);
      })
      .catch((err) => {
        if (!cancelled) console.error(err);
      });

    return () => {
      cancelled = true;
    };
  }, [endpoint]); // endpoint validated inside effect

  return data;
}
```

**Tá»•ng káº¿t Defensive Programming:**

| Pattern            | Khi nÃ o dÃ¹ng                     | VÃ­ dá»¥                              |
| ------------------ | -------------------------------- | ---------------------------------- |
| Type Guards        | TrÆ°á»›c khi access property/method | `if (user == null) return default` |
| Safe Coercion      | Convert type cÃ³ chá»§ Ä‘Ã­ch         | `Number(input)` thay vÃ¬ `+input`   |
| `??` / `?.`        | Access data khÃ´ng cháº¯c cháº¯n      | `obj?.deep?.prop ?? fallback`      |
| Runtime Validation | API/form boundaries              | Zod schema.parse()                 |
| React Guards       | Conditional render, state init   | `count > 0 ?` thay vÃ¬ `count &&`   |

Triáº¿t lÃ½: **"Parse, don't validate"** â€” thay vÃ¬ check type rá»“i cast, dÃ¹ng parser (Zod) Ä‘á»ƒ vá»«a validate vá»«a tráº£ vá» typed data trong 1 bÆ°á»›c. Sau boundary, code bÃªn trong KHÃ”NG Cáº¦N kiá»ƒm tra type ná»¯a â†’ clean, fast, maintainable.

### PhÃ¢n TÃ­ch SÃ¢u â€” 6 Patterns TÆ° Duy Ãp Dá»¥ng Cho Data Types

Pháº§n trÃªn Ä‘Ã£ trÃ¬nh bÃ y **cÃ¡i gÃ¬** (what) â€” 8 kiá»ƒu dá»¯ liá»‡u, cÃ¡ch lÆ°u trá»¯, cÃ¡ch copy. Pháº§n nÃ y Ä‘i sÃ¢u hÆ¡n báº±ng cÃ¡ch Ã¡p dá»¥ng **6 phÆ°Æ¡ng phÃ¡p tÆ° duy chuyÃªn sÃ¢u** mÃ  cÃ¡c Senior Engineers sá»­ dá»¥ng Ä‘á»ƒ thá»±c sá»± **hiá»ƒu báº£n cháº¥t** thay vÃ¬ chá»‰ ghi nhá»›. Má»—i pattern lÃ  má»™t "á»‘ng kÃ­nh" khÃ¡c nhau â€” cÃ¹ng nhÃ¬n vÃ o Data Types nhÆ°ng tá»« gÃ³c Ä‘á»™ khÃ¡c, giÃºp báº¡n xÃ¢y dá»±ng hiá»ƒu biáº¿t Ä‘a chiá»u mÃ  khÃ´ng framework hay library nÃ o cÃ³ thá»ƒ lung lay.

#### Pattern 1: Äá»‡ Quy "Táº¡i Sao" (5 Whys) â€” Ãp dá»¥ng cho Number type

Ká»¹ thuáº­t 5 Whys báº¯t nguá»“n tá»« há»‡ thá»‘ng sáº£n xuáº¥t Toyota (Toyota Production System) â€” khi gáº·p má»™t lá»—i trÃªn dÃ¢y chuyá»n, ká»¹ sÆ° khÃ´ng dá»«ng á»Ÿ triá»‡u chá»©ng bá» máº·t mÃ  há»i "Táº¡i sao?" Ã­t nháº¥t 5 láº§n cho Ä‘áº¿n khi cháº¡m Ä‘áº¿n **nguyÃªn nhÃ¢n gá»‘c rá»…** (root cause).

Ãp dá»¥ng vÃ o JavaScript: khi ai Ä‘Ã³ há»i "Táº¡i sao `0.1 + 0.2 !== 0.3`?", háº§u háº¿t developers chá»‰ tráº£ lá»i "VÃ¬ floating point". NhÆ°ng Ä‘iá»u Ä‘Ã³ chá»‰ lÃ  **triá»‡u chá»©ng**. Náº¿u báº¡n tiáº¿p tá»¥c há»i "Táº¡i sao dÃ¹ng floating point?" â†’ "Táº¡i sao dÃ¹ng IEEE-754?" â†’ "Táº¡i sao chá»‰ 52 bits?" â†’ báº¡n sáº½ cháº¡m Ä‘áº¿n **giá»›i háº¡n váº­t lÃ½ cá»§a pháº§n cá»©ng**. ÄÃ¢y má»›i lÃ  cÃ¢u tráº£ lá»i thá»a mÃ£n interviewer á»Ÿ level Senior â€” vÃ¬ nÃ³ cho tháº¥y báº¡n hiá»ƒu khÃ´ng chá»‰ ngÃ´n ngá»¯, mÃ  cáº£ **ná»n táº£ng mÃ  ngÃ´n ngá»¯ cháº¡y trÃªn Ä‘Ã³**.

HÃ£y xem chuá»—i 5 Whys cá»¥ thá»ƒ cho cÃ¢u há»i "Táº¡i sao JavaScript chá»‰ cÃ³ 1 kiá»ƒu Number?":

```
  Táº I SAO JavaScript chá»‰ cÃ³ 1 kiá»ƒu Number (khÃ´ng cÃ³ int, float, double)?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHY #1: "Táº¡i sao JS khÃ´ng cÃ³ kiá»ƒu int riÃªng?"              â”‚
  â”‚  â†’ VÃ¬ Brendan Eich thiáº¿t káº¿ JS trong 10 ngÃ y (1995),        â”‚
  â”‚    muá»‘n ngÃ´n ngá»¯ ÄÆ N GIáº¢N cho designer, khÃ´ng pháº£i          â”‚
  â”‚    cho system programmer.                                    â”‚
  â”‚                                                              â”‚
  â”‚  WHY #2: "Táº¡i sao chá»n floating point thay vÃ¬ integer?"     â”‚
  â”‚  â†’ VÃ¬ web cáº§n cáº£ sá»‘ nguyÃªn LáºªN sá»‘ tháº­p phÃ¢n                 â”‚
  â”‚    (giÃ¡ tiá»n $19.99, tá»a Ä‘á»™ pixel 3.5).                      â”‚
  â”‚    1 kiá»ƒu float bao trÃ¹m cáº£ 2 â†’ Ã­t phá»©c táº¡p hÆ¡n.           â”‚
  â”‚                                                              â”‚
  â”‚  WHY #3: "Táº¡i sao chá»n 64-bit IEEE-754?"                    â”‚
  â”‚  â†’ VÃ¬ Ä‘Ã¢y lÃ  TIÃŠU CHUáº¨N PHáº¦N Cá»¨NG. CPU cá»§a má»i mÃ¡y         â”‚
  â”‚    tÃ­nh Ä‘á»u cÃ³ FPU (Floating Point Unit) há»— trá»£              â”‚
  â”‚    IEEE-754 báº±ng HARDWARE â†’ nhanh nháº¥t cÃ³ thá»ƒ!               â”‚
  â”‚                                                              â”‚
  â”‚  WHY #4: "Táº¡i sao IEEE-754 láº¡i máº¥t precision á»Ÿ sá»‘ lá»›n?"    â”‚
  â”‚  â†’ VÃ¬ 64 bits chia thÃ nh: 1 bit dáº¥u + 11 bits exponent     â”‚
  â”‚    + 52 bits mantissa. Mantissa chá»‰ cÃ³ 52 bits â†’             â”‚
  â”‚    chá»‰ biá»ƒu diá»…n chÃ­nh xÃ¡c Ä‘áº¿n 2^53 - 1.                    â”‚
  â”‚    Sá»‘ lá»›n hÆ¡n â†’ pháº£i LÃ€M TRÃ’N â†’ máº¥t precision!              â”‚
  â”‚                                                              â”‚
  â”‚  WHY #5: "Táº¡i sao khÃ´ng sá»­a lá»—i nÃ y?"                      â”‚
  â”‚  â†’ VÃ¬ Ä‘Ã¢y lÃ  GIá»šI Háº N Váº¬T LÃ! 64 bits = há»¯u háº¡n.          â”‚
  â”‚    Muá»‘n sá»‘ lá»›n hÆ¡n â†’ cáº§n kiá»ƒu má»›i = BigInt (ES2020).        â”‚
  â”‚    ÄÃ¢y lÃ  trade-off: tá»‘c Ä‘á»™ (hardware FPU) vs precision.     â”‚
  â”‚                                                              â”‚
  â”‚  Káº¾T LUáº¬N: Tá»« "JS chá»‰ cÃ³ 1 Number" â†’ ta truy váº¿t Ä‘áº¿n      â”‚
  â”‚  GIá»šI Háº N Váº¬T LÃ cá»§a CPU (52-bit mantissa)! â˜…â˜…â˜…            â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// CHá»¨NG MINH giá»›i háº¡n váº­t lÃ½ báº±ng code:

// 52-bit mantissa â†’ chÃ­nh xÃ¡c Ä‘áº¿n 2^53 - 1
console.log(Number.MAX_SAFE_INTEGER); // 9007199254740991
console.log(2 ** 53 - 1); // 9007199254740991 (giá»‘ng nhau!)

// VÆ°á»£t qua giá»›i háº¡n â†’ Máº¤T PRECISION:
console.log(9007199254740991 + 1); // 9007199254740992 âœ…
console.log(9007199254740991 + 2); // 9007199254740992 âŒ (pháº£i lÃ  ...993!)

// Táº¡i sao? VÃ¬ CPU pháº£i LÃ€M TRÃ’N sá»‘ ...993 vá» ...992
// do khÃ´ng Ä‘á»§ bits Ä‘á»ƒ biá»ƒu diá»…n chÃ­nh xÃ¡c!

// 0.1 + 0.2 !== 0.3 CÅ¨NG vÃ¬ lÃ½ do tÆ°Æ¡ng tá»±:
console.log(0.1 + 0.2); // 0.30000000000000004
// VÃ¬ 0.1 trong há»‡ nhá»‹ phÃ¢n lÃ  sá»‘ VÃ” Háº N TUáº¦N HOÃ€N:
// 0.1 (decimal) = 0.000110011001100110011... (binary, láº·p vÃ´ táº­n)
// 52 bits khÃ´ng Ä‘á»§ â†’ cáº¯t bá» â†’ sai sá»‘ tÃ­ch lÅ©y!
```

#### Pattern 2: First Principles â€” Data Types dÆ°á»›i gÃ³c nhÃ¬n pháº§n cá»©ng

First Principles Thinking (tÆ° duy tá»« nguyÃªn lÃ½ Ä‘áº§u tiÃªn) lÃ  phÆ°Æ¡ng phÃ¡p cá»§a Elon Musk vÃ  Richard Feynman â€” thay vÃ¬ so sÃ¡nh bá» máº·t ("Framework A tá»‘t hÆ¡n B"), ta **phÃ¢n rÃ£** váº¥n Ä‘á» xuá»‘ng nhá»¯ng sá»± tháº­t cÆ¡ báº£n nháº¥t khÃ´ng thá»ƒ chá»‘i cÃ£i: **Data Structures** (lÆ°u trá»¯ tháº¿ nÃ o?), **Algorithms** (truy xuáº¥t tháº¿ nÃ o?), vÃ  **Hardware** (táº­n dá»¥ng pháº§n cá»©ng ra sao?).

Khi Ã¡p dá»¥ng cho Data Types, Ä‘iá»u nÃ y cÃ³ Ã½ nghÄ©a thá»±c tiá»…n ráº¥t lá»›n. VÃ­ dá»¥: táº¡i sao truy xuáº¥t `obj.name` láº¡i cháº­m hÆ¡n Ä‘á»c biáº¿n `name`? Nhiá»u ngÆ°á»i Ä‘oÃ¡n "vÃ¬ object phá»©c táº¡p hÆ¡n". NhÆ°ng First Principles cho ta cÃ¢u tráº£ lá»i chÃ­nh xÃ¡c: **pointer chasing gÃ¢y CPU cache miss**. Stack data náº±m liÃªn tiáº¿p trong bá»™ nhá»› â†’ CPU Ä‘á»c luÃ´n cáº£ cache line (~64 bytes) â†’ cÃ¡c biáº¿n gáº§n nhau Ä‘á»u Ä‘Æ°á»£c cache sáºµn. Heap objects náº±m ráº£i rÃ¡c â†’ má»—i láº§n follow pointer lÃ  má»™t láº§n cÃ³ thá»ƒ cache miss â†’ cháº­m hÆ¡n 10-100x so vá»›i cache hit.

Hiá»ƒu Ä‘iá»u nÃ y giÃºp báº¡n viáº¿t code nhanh hÆ¡n mÃ  khÃ´ng cáº§n benchmark â€” _báº¡n biáº¿t trÆ°á»›c_ ráº±ng flat data structures sáº½ nhanh hÆ¡n deeply nested objects, ráº±ng array of numbers sáº½ nhanh hÆ¡n array of objects, vÃ  ráº±ng V8's Hidden Class chÃ­nh lÃ  cÃ¡ch engine "hack" Ä‘á»ƒ biáº¿n dynamic objects thÃ nh quasi-static structs.

```
  PHÃ‚N RÃƒ XUá»NG Táº¦NG THáº¤P NHáº¤T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  DATA STRUCTURES â€” JS lÆ°u trá»¯ data types tháº¿ nÃ o?           â”‚
  â”‚                                                              â”‚
  â”‚  1. PRIMITIVES â†’ Stack memory (cá»‘ Ä‘á»‹nh, liÃªn tiáº¿p)           â”‚
  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚     â”‚ Type    â”‚ KÃ­ch thÆ°á»›câ”‚ CÃ¡ch lÆ°u trong bá»™ nhá»›     â”‚       â”‚
  â”‚     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
  â”‚     â”‚ Number  â”‚ 8 bytes  â”‚ IEEE-754 double precision â”‚       â”‚
  â”‚     â”‚ Boolean â”‚ ~8 bytes â”‚ V8 dÃ¹ng Smi hoáº·c HeapObj  â”‚       â”‚
  â”‚     â”‚ null    â”‚ ~8 bytes â”‚ Pointer pref (tagged)      â”‚       â”‚
  â”‚     â”‚ undef.  â”‚ ~8 bytes â”‚ Root constant reference    â”‚       â”‚
  â”‚     â”‚ String  â”‚ varies   â”‚ Heap náº¿u dÃ i, inline náº¿u  â”‚       â”‚
  â”‚     â”‚         â”‚          â”‚ ngáº¯n (V8 SeqString)        â”‚       â”‚
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                                                              â”‚
  â”‚  2. OBJECTS â†’ Heap memory (dynamic, pointer-based)           â”‚
  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚     â”‚  V8 Engine lÆ°u Object dÆ°á»›i dáº¡ng:                 â”‚      â”‚
  â”‚     â”‚                                                  â”‚      â”‚
  â”‚     â”‚  Hidden Class (Map) + Properties Array           â”‚      â”‚
  â”‚     â”‚                                                  â”‚      â”‚
  â”‚     â”‚  { x: 10, y: 20 }                                â”‚      â”‚
  â”‚     â”‚  â†’ Map: "shape { x: offset_0, y: offset_1 }"    â”‚      â”‚
  â”‚     â”‚  â†’ Properties: [10, 20]   (compact array!)       â”‚      â”‚
  â”‚     â”‚                                                  â”‚      â”‚
  â”‚     â”‚  Táº¡i sao khÃ´ng dÃ¹ng Hash Table?                  â”‚      â”‚
  â”‚     â”‚  â†’ Hash Table: O(1) lookup nhÆ°ng CHáº¬M hÆ¡n       â”‚      â”‚
  â”‚     â”‚    offset-based access trong thá»±c táº¿!            â”‚      â”‚
  â”‚     â”‚  â†’ V8 dÃ¹ng "Hidden Class" Ä‘á»ƒ biáº¿n object        â”‚      â”‚
  â”‚     â”‚    thÃ nh struct-like â†’ truy xuáº¥t báº±ng OFFSET    â”‚      â”‚
  â”‚     â”‚    â†’ NHANH nhÆ° C struct! â˜…â˜…â˜…                     â”‚      â”‚
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  ALGORITHMS â€” Truy xuáº¥t data cÃ³ phá»©c táº¡p gÃ¬?                 â”‚
  â”‚  â€¢ Primitive lookup: O(1) â€” Ä‘á»c trá»±c tiáº¿p tá»« stack          â”‚
  â”‚  â€¢ Object property: O(1) â€” V8's Hidden Class offset         â”‚
  â”‚    (tá»‡ nháº¥t O(n) náº¿u property bá»‹ delete â†’ Hash Table)      â”‚
  â”‚  â€¢ Array element: O(1) â€” náº¿u compact, O(n) náº¿u sparse      â”‚
  â”‚                                                              â”‚
  â”‚  HARDWARE â€” Táº­n dá»¥ng CPU cache tháº¿ nÃ o?                      â”‚
  â”‚  â€¢ Stack data: Náº°M Cáº NH NHAU â†’ CPU cache hit rate CAO       â”‚
  â”‚    â†’ Primitives truy xuáº¥t NHANH hÆ¡n heap objects!            â”‚
  â”‚  â€¢ Heap objects: Pointer chasing â†’ CPU cache MISS            â”‚
  â”‚    â†’ ÄÃ¢y lÃ  lÃ½ do nested objects CHáº¬M hÆ¡n flat data! â˜…â˜…â˜…    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// CHá»¨NG MINH: Primitives NHANH hÆ¡n Objects

// âŒ Object access â€” pointer chasing, cache unfriendly
const obj = { value: 42 };
// CPU pháº£i: 1) Ä‘á»c pointer tá»« stack â†’ 2) follow Ä‘áº¿n heap â†’ 3) tÃ¬m property
// = 2-3 memory accesses, cÃ³ thá»ƒ cache miss!

// âœ… Primitive access â€” trá»±c tiáº¿p tá»« stack
const num = 42;
// CPU chá»‰ cáº§n: 1) Ä‘á»c giÃ¡ trá»‹ tá»« stack
// = 1 memory access, luÃ´n cache hit!

// ThÃ­ nghiá»‡m thá»±c táº¿ (V8):
// VÃ²ng láº·p 1 triá»‡u láº§n vá»›i primitive: ~2ms
// VÃ²ng láº·p 1 triá»‡u láº§n vá»›i obj.value: ~5ms
// â†’ Primitive nhanh hÆ¡n ~2.5x vÃ¬ KHÃ”NG CÃ“ pointer chasing!

// ÄÃ¢y lÃ  lÃ½ do táº¡i sao React dÃ¹ng primitive cho state Ä‘Æ¡n giáº£n:
const [count, setCount] = useState(0); // âœ… primitive â†’ nhanh
const [data, setData] = useState({ count: 0 }); // âŒ object â†’ cháº­m hÆ¡n
```

#### Pattern 3: Trade-off Analysis â€” So sÃ¡nh Dynamic vs Static Typing

Trong software engineering, khÃ´ng cÃ³ "giáº£i phÃ¡p hoÃ n háº£o" â€” chá»‰ cÃ³ **sá»± Ä‘Ã¡nh Ä‘á»•i tá»‘t nháº¥t** cho bá»‘i cáº£nh cá»¥ thá»ƒ. ÄÃ¢y lÃ  tÆ° duy mÃ  Senior engineers dÃ¹ng má»—i ngÃ y: khÃ´ng há»i "cÃ¡i nÃ o tá»‘t hÆ¡n?" mÃ  há»i "**cÃ¡i nÃ o tá»‘t hÆ¡n CHO BÃ€I TOÃN NÃ€Y?**"

Dynamic typing cá»§a JavaScript lÃ  vÃ­ dá»¥ kinh Ä‘iá»ƒn. Brendan Eich chá»n dynamic typing vÃ¬ JavaScript sinh ra Ä‘á»ƒ **scripting nhanh trÃªn browser** â€” designer cáº§n thÃªm dropdown, validate form, khÃ´ng cáº§n khai bÃ¡o `int counter = 0` nhÆ° C. Sá»± linh hoáº¡t nÃ y giÃºp JS trá»Ÿ thÃ nh ngÃ´n ngá»¯ phá»• biáº¿n nháº¥t tháº¿ giá»›i. NhÆ°ng cÃ¡i giÃ¡ pháº£i tráº£ lÃ  **type coercion bugs** â€” nhá»¯ng lá»—i mÃ  compiler khÃ´ng báº¯t Ä‘Æ°á»£c, chá»‰ phÃ¡t hiá»‡n khi user gáº·p á»Ÿ production.

CÃ¢u há»i then chá»‘t mÃ  interviewer thÆ°á»ng há»i: **"Ká»‹ch báº£n nÃ o thÃ¬ JavaScript's dynamic typing sáº½ tháº¥t báº¡i hoÃ n toÃ n?"** CÃ¢u tráº£ lá»i: khi codebase scale lÃªn 100+ files, 10+ developers, vÃ  API contracts thay Ä‘á»•i liÃªn tá»¥c. ÄÃ¢y chÃ­nh xÃ¡c lÃ  lÃ½ do TypeScript ra Ä‘á»i â€” khÃ´ng pháº£i Ä‘á»ƒ thay tháº¿ JS, mÃ  Ä‘á»ƒ thÃªm **lá»›p báº£o vá»‡ compile-time** cho nhá»¯ng dá»± Ã¡n mÃ  runtime errors quÃ¡ Ä‘áº¯t Ä‘á».

```
  DYNAMIC TYPING Cá»¦A JAVASCRIPT â€” CÃI GIÃ PHáº¢I TRáº¢:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  JavaScript = Dynamic Typing (kiá»ƒu Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh á»Ÿ RUNTIME) â”‚
  â”‚  TypeScript = Static Typing (kiá»ƒu Ä‘Æ°á»£c check á»Ÿ COMPILE TIME)â”‚
  â”‚  C/Java    = Static Typing (kiá»ƒu cá»‘ Ä‘á»‹nh tá»« lÃºc khai bÃ¡o)  â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ TiÃªu chÃ­       â”‚ Dynamic(JS) â”‚ Static(TS/C)            â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Tá»‘c Ä‘á»™ dev     â”‚ âœ… Nhanh    â”‚ âŒ Cháº­m hÆ¡n (viáº¿t type) â”‚  â”‚
  â”‚  â”‚ Safety         â”‚ âŒ Runtime  â”‚ âœ… Compile-time         â”‚  â”‚
  â”‚  â”‚ Performance    â”‚ âŒ Cháº­m hÆ¡n â”‚ âœ… Tá»‘i Æ°u tá»‘t hÆ¡n      â”‚  â”‚
  â”‚  â”‚ Refactoring    â”‚ âŒ Nguy hiá»ƒmâ”‚ âœ… An toÃ n              â”‚  â”‚
  â”‚  â”‚ Team scale     â”‚ âŒ KhÃ³ scaleâ”‚ âœ… Dá»… maintain          â”‚  â”‚
  â”‚  â”‚ Prototyping    â”‚ âœ… Cá»±c nhanhâ”‚ âŒ Overhead             â”‚  â”‚
  â”‚  â”‚ Learning curve â”‚ âœ… Dá»… há»c   â”‚ âŒ KhÃ³ hÆ¡n              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                              â”‚
  â”‚  "Ká»‹ch báº£n nÃ o Dynamic typing THáº¤T Báº I HOÃ€N TOÃ€N?"          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// Ká»ŠCH Báº¢N THáº¤T Báº I #1: Coercion báº¥t ngá»
console.log(1 + "2");      // "12" â€” string concat, khÃ´ng pháº£i 3!
console.log("5" - 1);      // 4   â€” trá»« thÃ¬ láº¡i convert to number!
console.log(true + true);  // 2   â€” boolean â†’ number!
console.log([] + []);      // ""  â€” empty string???
console.log([] + {});      // "[object Object]"
console.log({} + []);      // 0   â€” WAT???

// Táº¡i sao? VÃ¬ JS engine pháº£i ÄOÃN developer muá»‘n gÃ¬:
// 1 + "2" â†’ toÃ¡n tá»­ + gáº·p string â†’ chuyá»ƒn sang concat mode
// "5" - 1 â†’ toÃ¡n tá»­ - KHÃ”NG cÃ³ mode concat â†’ chuyá»ƒn stringâ†’number

// Ká»ŠCH Báº¢N THáº¤T Báº I #2: Bug áº©n trong production
function calculateTotal(price, quantity) {
  return price * quantity;  // KhÃ´ng cÃ³ type check!
}

// Dev gá»i vá»›i string tá»« form input:
calculateTotal("10", "3");  // 30 â€” may máº¯n, JS tá»± convert!
calculateTotal("abc", "3"); // NaN â€” CRASH THáº¦M Láº¶NG!
// KhÃ´ng error, khÃ´ng warning â€” NaN lan truyá»n kháº¯p code!

// GIáº¢I PHÃP: DÃ¹ng TypeScript hoáº·c runtime validation
function calculateTotalSafe(price: number, quantity: number): number {
  return price * quantity;  // TS báº¯t lá»—i náº¿u truyá»n string!
}
```

#### Pattern 4: Mental Mapping â€” Vá»‹ trÃ­ Data Types trong há»‡ thá»‘ng

"Hiá»ƒu sÃ¢u" khÃ´ng chá»‰ lÃ  biáº¿t chi tiáº¿t vá» má»™t thá»© â€” mÃ  cÃ²n lÃ  biáº¿t **thá»© Ä‘Ã³ náº±m á»Ÿ Ä‘Ã¢u trong bá»©c tranh lá»›n**. Mental Mapping lÃ  ká»¹ thuáº­t táº¡o "báº£n Ä‘á»“ tinh tháº§n" káº¿t ná»‘i cÃ¡c khÃ¡i niá»‡m theo táº§ng (layer), giÃºp báº¡n nhÃ¬n tháº¥y tÃ¡c Ä‘á»™ng xuyÃªn suá»‘t tá»« code báº¡n viáº¿t Ä‘áº¿n hardware bÃªn dÆ°á»›i.

Khi báº¡n viáº¿t `const [name, setName] = useState("John")`, cÃ³ váº» Ä‘Æ¡n giáº£n. NhÆ°ng thá»±c táº¿, chuá»—i `"John"` pháº£i Ä‘i qua **4 táº§ng** trÆ°á»›c khi Ä‘Æ°á»£c xá»­ lÃ½: _Táº§ng á»©ng dá»¥ng_ (React component) â†’ _Táº§ng JS engine_ (V8 phÃ¢n loáº¡i thÃ nh SeqOneByteString vÃ¬ chá»‰ chá»©a ASCII) â†’ _Táº§ng bá»™ nhá»›_ (lÆ°u vÃ o heap vÃ¬ string dÃ i hÆ¡n SMI threshold) â†’ _Táº§ng CPU_ (ALU so sÃ¡nh byte-by-byte khi React check `prevState !== nextState`).

Táº¡i sao Ä‘iá»u nÃ y quan trá»ng? VÃ¬ khi báº¡n gáº·p performance issue â€” vÃ­ dá»¥ component re-render cháº­m â€” báº¡n cáº§n biáº¿t **bottleneck á»Ÿ táº§ng nÃ o**. Náº¿u á»Ÿ táº§ng React â†’ optimize vá»›i `useMemo`. Náº¿u á»Ÿ táº§ng V8 â†’ trÃ¡nh de-optimization (megamorphic property access). Náº¿u á»Ÿ táº§ng Memory â†’ giáº£m heap allocation. Náº¿u á»Ÿ táº§ng CPU â†’ dÃ¹ng `SharedArrayBuffer` + Web Workers. KhÃ´ng cÃ³ mental map â†’ báº¡n chá»‰ "thá»­ random" vÃ  hy vá»ng nÃ³ nhanh hÆ¡n.

```
  DATA TYPES Náº°M á» ÄÃ‚U TRONG "Báº¢N Äá»’" Tá»”NG THá»‚?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Táº¦NG á»¨NG Dá»¤NG (React/Next.js)                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  const [name, setName] = useState("John")      â”‚          â”‚
  â”‚  â”‚  â†’ "John" lÃ  primitive STRING                   â”‚          â”‚
  â”‚  â”‚  â†’ useState giá»¯ nÃ³ trong closure (stack ref)    â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                         â”‚                                    â”‚
  â”‚                         â–¼                                    â”‚
  â”‚  Táº¦NG JS ENGINE (V8)                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  V8 phÃ¢n loáº¡i: SMI (Small Integer), HeapNumber, â”‚          â”‚
  â”‚  â”‚  HeapString, HeapObject...                      â”‚          â”‚
  â”‚  â”‚  â†’ "John" ngáº¯n â†’ V8 lÆ°u inline (SeqOneByteStr) â”‚          â”‚
  â”‚  â”‚  â†’ Object {...} â†’ V8 táº¡o Hidden Class + store   â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                         â”‚                                    â”‚
  â”‚                         â–¼                                    â”‚
  â”‚  Táº¦NG MEMORY (RAM)                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Stack: chá»©a primitives + pointers (liÃªn tiáº¿p)  â”‚          â”‚
  â”‚  â”‚  Heap: chá»©a objects (phÃ¢n tÃ¡n, GC quáº£n lÃ½)      â”‚          â”‚
  â”‚  â”‚  â†’ Garbage Collector (Orinoco) dá»n heap khi     â”‚          â”‚
  â”‚  â”‚    object háº¿t reference                          â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                         â”‚                                    â”‚
  â”‚                         â–¼                                    â”‚
  â”‚  Táº¦NG PHáº¦N Cá»¨NG (CPU)                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  Number â†’ CPU FPU (Floating Point Unit)         â”‚          â”‚
  â”‚  â”‚  String â†’ CPU ALU (byte-by-byte comparison)     â”‚          â”‚
  â”‚  â”‚  Object â†’ CPU Cache (pointer chasing = slow)    â”‚          â”‚
  â”‚  â”‚  â†’ L1 cache hit: ~1ns, L2: ~5ns, RAM: ~100ns   â”‚          â”‚
  â”‚  â”‚  â†’ Primitives thÆ°á»ng á»Ÿ L1, Objects á»Ÿ L2/RAM     â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                              â”‚
  â”‚  â†’ 1 dÃ²ng `useState("John")` kÃ©o theo Cáº¢ 4 Táº¦NG!           â”‚
  â”‚  â†’ Hiá»ƒu data types = hiá»ƒu Tá»ª APP Ä‘áº¿n HARDWARE! â˜…â˜…â˜…         â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Pattern 5: Reverse Engineering â€” Tá»± code há»‡ thá»‘ng type detection

Richard Feynman tá»«ng nÃ³i: _"What I cannot create, I do not understand."_ (CÃ¡i gÃ¬ tÃ´i khÃ´ng thá»ƒ tá»± tay xÃ¢y, tÃ´i khÃ´ng thá»±c sá»± hiá»ƒu.) ÄÃ¢y lÃ  triáº¿t lÃ½ cá»§a Reverse Engineering â€” thay vÃ¬ chá»‰ **dÃ¹ng** `typeof`, hÃ£y thá»­ **tá»± xÃ¢y láº¡i** nÃ³. QuÃ¡ trÃ¬nh nÃ y buá»™c báº¡n pháº£i Ä‘á»‘i máº·t vá»›i má»i edge case mÃ  bÃ¬nh thÆ°á»ng báº¡n bá» qua.

Khi tá»± implement `myTypeOf()`, báº¡n sáº½ phÃ¡t hiá»‡n ra:

- `typeof null === "object"` khÃ´ng pháº£i ngáº«u nhiÃªn â€” nÃ³ lÃ  bug tá»« cÃ¡ch V8's predecessor (SpiderMonkey gá»‘c) dÃ¹ng **bit pattern** Ä‘á»ƒ tag types: object cÃ³ tag `000`, null cÃ³ giÃ¡ trá»‹ `0x00` (all zeros) â†’ null bá»‹ nháº­n nháº§m lÃ  object vÃ¬ `0x00 & 0x7 === 0` (3 bits cuá»‘i Ä‘á»u báº±ng 0, trÃ¹ng vá»›i object tag).
- `typeof function() {}` tráº£ vá» `"function"` thay vÃ¬ `"object"` â€” dÃ¹ function IS an object. ÄÃ¢y lÃ  **quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch** vÃ¬ functions quÃ¡ quan trá»ng Ä‘á»ƒ bá»‹ gá»™p chung vá»›i objects.
- `Object.prototype.toString.call()` lÃ  cÃ¡ch duy nháº¥t chÃ­nh xÃ¡c 100% vÃ¬ nÃ³ Ä‘á»c **internal `[[Class]]` slot** â€” má»™t metadata mÃ  V8 gáº¯n vÃ o má»i object khi táº¡o, khÃ´ng thá»ƒ thay Ä‘á»•i báº±ng code thÆ°á»ng.

Viá»‡c tá»± implement giÃºp báº¡n hiá»ƒu ráº±ng `typeof` khÃ´ng pháº£i "magic" â€” nÃ³ chá»‰ lÃ  má»™t phÃ©p **kiá»ƒm tra bit pattern** á»Ÿ má»©c engine, cá»±c ká»³ nhanh (O(1), vÃ i CPU instructions).

```javascript
// Thay vÃ¬ CHá»ˆ dÃ¹ng typeof, hÃ£y Tá»° XÃ‚Y typeof Ä‘Æ¡n giáº£n!
// Äiá»u nÃ y giÃºp hiá»ƒu CÃCH JS engine phÃ¢n biá»‡t types.

// V8 engine dÃ¹ng "tagged pointers" Ä‘á»ƒ phÃ¢n biá»‡t types:
// - Bit cuá»‘i = 1 â†’ Ä‘Ã¢y lÃ  SMI (Small Integer), giÃ¡ trá»‹ = bits >> 1
// - Bit cuá»‘i = 0 â†’ Ä‘Ã¢y lÃ  pointer Ä‘áº¿n HeapObject, Ä‘á»c "Map" Ä‘á»ƒ biáº¿t type

// Ta mÃ´ phá»ng Ã½ tÆ°á»Ÿng nÃ y báº±ng JS:
function myTypeOf(value) {
  // BÆ°á»›c 1: Check null (bug lá»‹ch sá»­ â€” typeof null === "object")
  if (value === null) return "null";

  // BÆ°á»›c 2: Check undefined
  if (value === undefined) return "undefined";

  // BÆ°á»›c 3: Check primitives báº±ng typeof (nhanh, O(1))
  const t = typeof value;
  if (t !== "object" && t !== "function") return t;
  // â†’ "number", "string", "boolean", "symbol", "bigint"

  // BÆ°á»›c 4: Check function (typeof Ä‘Ã£ nháº­n diá»‡n)
  if (t === "function") return "function";

  // BÆ°á»›c 5: Vá»›i objects, dÃ¹ng internal [[Class]] tag
  // Ä‘Ã¢y lÃ  cÃ¡ch V8 thá»±c sá»± phÃ¢n biá»‡t Array vs Object vs Date:
  const tag = Object.prototype.toString.call(value);
  // "[object Array]" â†’ "Array"
  // "[object Date]"  â†’ "Date"
  // "[object RegExp]"â†’ "RegExp"
  return tag.slice(8, -1); // Cáº¯t "[object " vÃ  "]"
}

// Test:
console.log(myTypeOf(42)); // "number"
console.log(myTypeOf("hello")); // "string"
console.log(myTypeOf(null)); // "null" (ÄÃšNG, khÃ´ng pháº£i "object"!)
console.log(myTypeOf([])); // "Array"
console.log(myTypeOf({})); // "Object"
console.log(myTypeOf(new Date())); // "Date"
console.log(myTypeOf(/regex/)); // "RegExp"

// BÃ€I Há»ŒC: JavaScript engine phÃ¢n biá»‡t types báº±ng:
// 1) Tagged bits cho primitives (SMI, HeapNumber)
// 2) Internal "Map" (Hidden Class) cho objects
// 3) [[Class]] internal slot cho built-in objects
// â†’ Má»—i láº§n gá»i typeof, engine check BIT PATTERN, khÃ´ng parse string!
```

#### Pattern 6: Lá»‹ch sá»­ & Sá»± Tiáº¿n HÃ³a â€” Data Types qua cÃ¡c phiÃªn báº£n

Má»i cÃ´ng nghá»‡ sinh ra Ä‘á»u Ä‘á»ƒ **giáº£i quyáº¿t má»™t váº¥n Ä‘á» cá»¥ thá»ƒ** cá»§a cÃ´ng nghá»‡ tiá»n nhiá»‡m â€” vÃ  Data Types cá»§a JavaScript cÅ©ng váº­y. Hiá»ƒu **lá»‹ch sá»­ tiáº¿n hÃ³a** giÃºp báº¡n khÃ´ng chá»‰ biáº¿t "cÃ¡i gÃ¬" mÃ  cÃ²n biáº¿t **"táº¡i sao nÃ³ tá»“n táº¡i"** vÃ  **"nÃ³ thay tháº¿ cÃ¡i gÃ¬"**.

JavaScript ra Ä‘á»i nÄƒm 1995 vá»›i chá»‰ 5 kiá»ƒu â€” má»™t con sá»‘ cá»±c ká»³ nhá» so vá»›i C (cÃ³ `char`, `short`, `int`, `long`, `float`, `double`, `void`, pointer...). ÄÃ¢y lÃ  quyáº¿t Ä‘á»‹nh cÃ³ chá»§ Ä‘Ã­ch: Brendan Eich muá»‘n JS **Ä‘Æ¡n giáº£n Ä‘áº¿n má»©c designer cÅ©ng dÃ¹ng Ä‘Æ°á»£c**. NhÆ°ng sá»± Ä‘Æ¡n giáº£n Ä‘Ã³ Ä‘á»ƒ láº¡i 2 "váº¿t thÆ°Æ¡ng" khÃ´ng bao giá» lÃ nh: `typeof null === "object"` (bug lá»‹ch sá»­ tá»« bit pattern) vÃ  thiáº¿u kiá»ƒu integer (má»i sá»‘ Ä‘á»u lÃ  float â†’ precision problems).

20 nÄƒm sau, khi JavaScript Ä‘Ã£ trá»Ÿ thÃ nh ngÃ´n ngá»¯ cháº¡y má»i thá»© â€” tá»« browser Ä‘áº¿n server (Node.js), mobile (React Native), desktop (Electron) â€” 2 kiá»ƒu má»›i Ä‘Æ°á»£c thÃªm vÃ o. **Symbol (ES6, 2015)** giáº£i quyáº¿t bÃ i toÃ¡n **property name collision** khi ecosystem npm cÃ³ hÃ ng triá»‡u packages cÃ¹ng tÆ°Æ¡ng tÃ¡c vá»›i objects. **BigInt (ES2020)** giáº£i quyáº¿t bÃ i toÃ¡n **precision** khi JS pháº£i xá»­ lÃ½ 64-bit IDs tá»« Twitter, cryptocurrency amounts trong DeFi, vÃ  nanosecond timestamps trong high-frequency systems.

Äiá»u thÃº vá»‹: má»—i kiá»ƒu má»›i Ä‘á»u máº¥t **5-7 nÄƒm** tá»« proposal Ä‘áº¿n standardization (BigInt: TC39 proposal 2017, standardized 2020). ÄÃ¢y lÃ  tá»‘c Ä‘á»™ cá»±c ká»³ cháº­m so vá»›i thÃªm feature vÃ o framework â€” vÃ¬ thay Ä‘á»•i ngÃ´n ngá»¯ áº£nh hÆ°á»Ÿng Ä‘áº¿n **má»i browser, má»i runtime, má»i tool** trÃªn tháº¿ giá»›i. "Backward compatibility" lÃ  rÃ ng buá»™c cá»©ng nháº¥t cá»§a JavaScript â€” Ä‘Ã¢y cÅ©ng lÃ  lÃ½ do `typeof null` BUG khÃ´ng bao giá» Ä‘Æ°á»£c sá»­a: sá»­a nÃ³ sáº½ phÃ¡ vá»¡ hÃ ng triá»‡u websites Ä‘ang check `typeof x === "object"` Ä‘á»ƒ detect cáº£ null.

```
  Sá»° TIáº¾N HÃ“A Cá»¦A JS DATA TYPES (1995 â†’ nay):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  1995 â€” ES1: JavaScript ra Ä‘á»i (Brendan Eich, 10 ngÃ y)      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  5 types: Number, String, Boolean, Object, Null â”‚          â”‚
  â”‚  â”‚  + undefined (tá»“n táº¡i nhÆ°ng chÆ°a chÃ­nh thá»©c)    â”‚          â”‚
  â”‚  â”‚                                                  â”‚          â”‚
  â”‚  â”‚  Váº¥n Ä‘á»: typeof null === "object"                â”‚          â”‚
  â”‚  â”‚  â†’ BUG ngay tá»« Ä‘áº§u! Brendan Eich thá»«a nháº­n      â”‚          â”‚
  â”‚  â”‚    Ä‘Ã¢y lÃ  lá»—i do check type báº±ng bit pattern:    â”‚          â”‚
  â”‚  â”‚    object tag = 000, null = 0x00 (all zeros)     â”‚          â”‚
  â”‚  â”‚    â†’ null bá»‹ nháº­n nháº§m lÃ  object! â˜…â˜…â˜…            â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                              â”‚
  â”‚  1999 â€” ES3: undefined chÃ­nh thá»©c                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  6 types: + undefined (chÃ­nh thá»©c lÃ  type)       â”‚          â”‚
  â”‚  â”‚  TrÆ°á»›c ES3: undefined = global variable          â”‚          â”‚
  â”‚  â”‚  â†’ CÃ³ thá»ƒ ghi Ä‘Ã¨: undefined = 42 (NGUY HIá»‚M!)  â”‚          â”‚
  â”‚  â”‚  â†’ ES5 sá»­a: undefined thÃ nh read-only property  â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                              â”‚
  â”‚  2015 â€” ES6: Symbol ra Ä‘á»i                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  7 types: + Symbol                               â”‚          â”‚
  â”‚  â”‚                                                  â”‚          â”‚
  â”‚  â”‚  Táº¡i sao cáº§n Symbol?                              â”‚          â”‚
  â”‚  â”‚  â†’ TrÆ°á»›c ES6: object keys chá»‰ lÃ  string          â”‚          â”‚
  â”‚  â”‚  â†’ 2 libraries thÃªm cÃ¹ng key "id" â†’ COLLISION!   â”‚          â”‚
  â”‚  â”‚  â†’ Symbol = unique key â†’ KHÃ”NG BAO GIá»œ trÃ¹ng!    â”‚          â”‚
  â”‚  â”‚  â†’ Bonus: Symbol.iterator cho phÃ©p custom         â”‚          â”‚
  â”‚  â”‚    iteration protocol (for...of)                  â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                              â”‚
  â”‚  2020 â€” ES2020: BigInt ra Ä‘á»i                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
  â”‚  â”‚  8 types: + BigInt                               â”‚          â”‚
  â”‚  â”‚                                                  â”‚          â”‚
  â”‚  â”‚  Táº¡i sao cáº§n BigInt?                              â”‚          â”‚
  â”‚  â”‚  â†’ Twitter snowflake IDs: 1352367985346740225     â”‚          â”‚
  â”‚  â”‚  â†’ Lá»›n hÆ¡n MAX_SAFE_INTEGER!                      â”‚          â”‚
  â”‚  â”‚  â†’ JSON.parse(tweet) â†’ ID bá»‹ TRUNCATED!           â”‚          â”‚
  â”‚  â”‚  â†’ Blockchain/Crypto: transaction amounts         â”‚          â”‚
  â”‚  â”‚    cáº§n precision tuyá»‡t Ä‘á»‘i (1 wei = 10^-18 ETH)  â”‚          â”‚
  â”‚  â”‚  â†’ BigInt giáº£i quyáº¿t = arbitrary precision        â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
  â”‚                                                              â”‚
  â”‚  TIMELINE:                                                    â”‚
  â”‚  1995 â”€â”€â”€â”€ 1999 â”€â”€â”€â”€ 2015 â”€â”€â”€â”€ 2020 â”€â”€â”€â”€ future              â”‚
  â”‚  5 types   6 types   7 types   8 types   ???                 â”‚
  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
  â”‚  Má»—i type má»›i giáº£i quyáº¿t Váº¤N Äá»€ Cá»¤ THá»‚                     â”‚
  â”‚  cá»§a type cÅ©! KhÃ´ng cÃ³ type nÃ o "vÃ´ cá»›" tá»“n táº¡i! â˜…â˜…â˜…        â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// CHá»¨NG MINH: Táº¡i sao cáº§n BigInt â€” vÃ­ dá»¥ thá»±c táº¿ Twitter ID

// âŒ TRÆ¯á»šC BigInt: Twitter ID bá»‹ há»ng!
const tweetId = 1352367985346740225; // number literal
console.log(tweetId);
// â†’ 1352367985346740200 (Sá» CUá»I Bá»Š Äá»”I! Máº¥t precision!)
// â†’ Gá»i API vá»›i ID sai â†’ "Tweet not found" ğŸ˜±

// âœ… SAU BigInt (ES2020):
const tweetIdBig = 1352367985346740225n;
console.log(tweetIdBig);
// â†’ 1352367985346740225n (CHÃNH XÃC 100%!)

// âœ… Hoáº·c parse tá»« string:
const fromAPI = BigInt("1352367985346740225");
console.log(fromAPI.toString()); // "1352367985346740225"

// INSIGHT: ÄÃ¢y lÃ  lÃ½ do Twitter API tráº£ vá» ID
// dÆ°á»›i dáº¡ng STRING chá»© khÃ´ng pháº£i number!
// { "id": 1352367985346740225, "id_str": "1352367985346740225" }
// â†’ id bá»‹ sai, id_str má»›i Ä‘Ãºng! â˜…â˜…â˜…
```

---

## 2. Symbol Deep Dive (ES6)

Symbol lÃ  kiá»ƒu dá»¯ liá»‡u **Ã­t Ä‘Æ°á»£c hiá»ƒu Ä‘Ãºng nháº¥t** trong JavaScript. Háº§u háº¿t developers biáº¿t nÃ³ tá»“n táº¡i nhÆ°ng khÃ´ng biáº¿t **khi nÃ o** vÃ  **táº¡i sao** nÃªn dÃ¹ng. Sá»± tháº­t lÃ : báº¡n khÃ´ng cáº§n Symbol cho code hÃ ng ngÃ y â€” nhÆ°ng báº¡n Cáº¦N hiá»ƒu nÃ³ Ä‘á»ƒ Ä‘á»c source code cá»§a React, Redux, hay báº¥t ká»³ library nÃ o sá»­ dá»¥ng metaprogramming.

Symbol ra Ä‘á»i Ä‘á»ƒ giáº£i quyáº¿t má»™t váº¥n Ä‘á» cá»¥ thá»ƒ: **property name collision**. TrÆ°á»›c ES6, má»i object key Ä‘á»u lÃ  string. Khi 2 libraries cÃ¹ng thÃªm property `"id"` vÃ o cÃ¹ng má»™t object â†’ chÃºng ghi Ä‘Ã¨ láº«n nhau. Symbol giáº£i quyáº¿t báº±ng cÃ¡ch táº¡o ra key DUY NHáº¤T, khÃ´ng bao giá» trÃ¹ng vá»›i báº¥t ká»³ key nÃ o khÃ¡c â€” ká»ƒ cáº£ Symbol khÃ¡c cÃ³ cÃ¹ng description.

NgoÃ i ra, Symbol cÃ²n má»Ÿ ra tháº¿ giá»›i **Well-Known Symbols** â€” cÃ¡c "hooks" mÃ  JS engine cung cáº¥p Ä‘á»ƒ báº¡n customize hÃ nh vi cá»§a objects: `Symbol.iterator` (custom iteration), `Symbol.toPrimitive` (custom type conversion), `Symbol.hasInstance` (custom `instanceof` behavior). ÄÃ¢y lÃ  ná»n táº£ng cá»§a **metaprogramming** trong JS.

### Äáº·c Äiá»ƒm

Symbol lÃ  **primitive** (khÃ´ng pháº£i object), **immutable** (khÃ´ng thá»ƒ thay Ä‘á»•i), vÃ  **unique** (má»—i `Symbol()` táº¡o ra giÃ¡ trá»‹ má»›i duy nháº¥t). KhÃ´ng thá»ƒ dÃ¹ng `new Symbol()` vÃ¬ Symbol khÃ´ng pháº£i constructor â€” Ä‘Ã¢y lÃ  thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch Ä‘á»ƒ ngÄƒn viá»‡c táº¡o Symbol wrapper objects (nhÆ° `new String()` hay `new Number()`).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SYMBOL - UNIQUE IDENTIFIER                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Primitive data type (khÃ´ng pháº£i object)                     â”‚
â”‚  ğŸ“Œ Má»—i Symbol() táº¡o ra giÃ¡ trá»‹ DUY NHáº¤T                        â”‚
â”‚  ğŸ“Œ KHÃ”NG thá»ƒ dÃ¹ng new Symbol() (khÃ´ng pháº£i constructor)        â”‚
â”‚  ğŸ“Œ Má»¥c Ä‘Ã­ch chÃ­nh: lÃ m key cho object property                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Symbol()       â†’ Táº¡o symbol má»›i, luÃ´n unique              â”‚ â”‚
â”‚  â”‚  Symbol.for()   â†’ TÃ¬m hoáº·c táº¡o symbol trong global registryâ”‚ â”‚
â”‚  â”‚  Symbol.keyFor()â†’ Láº¥y key cá»§a symbol tá»« global registry    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Symbol() vs Symbol.for()

ÄÃ¢y lÃ  sá»± phÃ¢n biá»‡t quan trá»ng nháº¥t khi lÃ m viá»‡c vá»›i Symbol. `Symbol()` luÃ´n táº¡o giÃ¡ trá»‹ Má»šI â€” thÃ­ch há»£p cho private property keys mÃ  chá»‰ module hiá»‡n táº¡i cáº§n truy cáº­p. `Symbol.for(key)` tÃ¬m trong **global Symbol registry** trÆ°á»›c â€” náº¿u tá»“n táº¡i thÃ¬ tráº£ vá» Symbol cÅ©, náº¿u chÆ°a thÃ¬ táº¡o má»›i vÃ  Ä‘Äƒng kÃ½. ÄÃ¢y lÃ  cÃ¡ch Ä‘á»ƒ **chia sáº» Symbol giá»¯a cÃ¡c modules/files** mÃ  khÃ´ng cáº§n import/export. React dÃ¹ng `Symbol.for('react.element')` Ä‘á»ƒ má»i file Ä‘á»u nháº­n ra React elements báº¥t ká»ƒ build tool nÃ o.

```javascript
// Symbol() - LuÃ´n táº¡o symbol Má»šI vÃ  UNIQUE
let sym1 = Symbol();
let sym2 = Symbol();
console.log(sym1 === sym2); // false â† LuÃ´n khÃ¡c nhau!

let sym3 = Symbol("description");
let sym4 = Symbol("description");
console.log(sym3 === sym4); // false â† Description khÃ´ng áº£nh hÆ°á»Ÿng!

// typeof vÃ  constructor
console.log(typeof sym1); // "symbol"
console.log(sym1.constructor === Symbol); // true

// âŒ KhÃ´ng thá»ƒ dÃ¹ng new
new Symbol(); // TypeError: Symbol is not a constructor
```

```javascript
// Symbol.for() - DÃ¹ng Global Registry
let globalSym1 = Symbol.for("myKey");
let globalSym2 = Symbol.for("myKey");
console.log(globalSym1 === globalSym2); // true â† Báº°NG NHAU!

// Symbol.for() workflow:
// 1. TÃ¬m trong global registry vá»›i key 'myKey'
// 2. Náº¿u cÃ³ â†’ return symbol Ä‘Ã£ tá»“n táº¡i
// 3. Náº¿u khÃ´ng â†’ táº¡o má»›i, lÆ°u vÃ o registry, return

// Symbol.keyFor() - Láº¥y key tá»« global registry
console.log(Symbol.keyFor(globalSym1)); // "myKey"

let localSym = Symbol("local");
console.log(Symbol.keyFor(localSym)); // undefined (khÃ´ng trong registry)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Symbol() vs Symbol.for() COMPARISON                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     Symbol()       â”‚           Symbol.for(key)              â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ LuÃ´n táº¡o unique    â”‚ TÃ¬m trong registry trÆ°á»›c               â”‚â”‚
â”‚  â”‚ KhÃ´ng share Ä‘Æ°á»£c   â”‚ Share Ä‘Æ°á»£c across files/modules        â”‚â”‚
â”‚  â”‚ Local scope        â”‚ Global scope                           â”‚â”‚
â”‚  â”‚ Private-ish keys   â”‚ Well-known/shared keys                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Application Scenarios

Trong thá»±c táº¿, Symbol Ä‘Æ°á»£c dÃ¹ng nhiá»u nháº¥t cho 3 má»¥c Ä‘Ã­ch: **(1) Private-like properties** â€” dÃ¹ khÃ´ng thá»±c sá»± private (váº«n truy cáº­p Ä‘Æ°á»£c qua `Object.getOwnPropertySymbols()`), nhÆ°ng Symbol keys khÃ´ng xuáº¥t hiá»‡n trong `for...in`, `Object.keys()`, hay `JSON.stringify()` â†’ Ä‘á»§ "giáº¥u" cho háº§u háº¿t use cases. **(2) Protocol markers** â€” nhÆ° React's `$$typeof` Ä‘á»ƒ Ä‘Ã¡nh dáº¥u React elements, ngÄƒn XSS tá»« server-rendered JSON. **(3) Enum-like constants** â€” thay vÃ¬ dÃ¹ng string `"LOADING"`, dÃ¹ng `Symbol('LOADING')` Ä‘áº£m báº£o khÃ´ng bao giá» collision vá»›i giÃ¡ trá»‹ khÃ¡c.

```javascript
// 1ï¸âƒ£ OBJECT PROPERTY KEYS (TrÃ¡nh collision)
const id = Symbol("id");
const user = {
  name: "John",
  [id]: 12345, // Symbol as key
};

console.log(user[id]); // 12345
console.log(user.id); // undefined (khÃ¡c vá»›i symbol key)
console.log(Object.keys(user)); // ['name'] - Symbol khÃ´ng xuáº¥t hiá»‡n!

// 2ï¸âƒ£ THAY THáº¾ CONSTANTS (Äáº£m báº£o unique)
// âŒ Old way - cÃ³ thá»ƒ trÃ¹ng value
const STATUS_PENDING = "pending";
const STATUS_DONE = "done";

// âœ… Symbol way - guaranteed unique
const STATUS = {
  PENDING: Symbol("pending"),
  DONE: Symbol("done"),
  ERROR: Symbol("error"),
};

function handleStatus(status) {
  if (status === STATUS.PENDING) {
    /* ... */
  } else if (status === STATUS.DONE) {
    /* ... */
  }
}

// 3ï¸âƒ£ PRIVATE-ISH PROPERTIES
const _privateMethod = Symbol("privateMethod");

class MyClass {
  [_privateMethod]() {
    return "This is somewhat private";
  }

  publicMethod() {
    return this[_privateMethod]();
  }
}

const obj = new MyClass();
obj.publicMethod(); // Works
obj[_privateMethod](); // Only works if you have the symbol reference
```

### Well-Known Symbols

Well-Known Symbols lÃ  nhá»¯ng Symbols Ä‘Æ°á»£c **JS engine dÃ¹ng ná»™i bá»™** Ä‘á»ƒ Ä‘á»‹nh nghÄ©a hÃ nh vi cá»§a objects. Báº±ng cÃ¡ch override chÃºng, báº¡n cÃ³ thá»ƒ customize cÃ¡ch object hoáº¡t Ä‘á»™ng vá»›i cÃ¡c operators vÃ  built-in functions. Quan trá»ng nháº¥t lÃ  `Symbol.iterator` (biáº¿n báº¥t ká»³ object nÃ o thÃ nh iterable cho `for...of`), `Symbol.toPrimitive` (control cÃ¡ch object convert sang number/string khi dÃ¹ng vá»›i `+`, `==`), vÃ  `Symbol.hasInstance` (custom logic cho `instanceof`). ÄÃ¢y lÃ  táº§ng **metaprogramming** cá»§a JavaScript â€” báº¡n khÃ´ng chá»‰ viáº¿t code cháº¡y, mÃ  cÃ²n **thay Ä‘á»•i cÃ¡ch ngÃ´n ngá»¯ xá»­ lÃ½ code cá»§a báº¡n**.

```javascript
// Built-in symbols Ä‘á»ƒ customize object behavior
Symbol.iterator; // Äá»‹nh nghÄ©a iteration behavior
Symbol.toStringTag; // Customize Object.prototype.toString
Symbol.hasInstance; // Customize instanceof behavior

// Example: Custom iterator
const myIterable = {
  data: [1, 2, 3],
  [Symbol.iterator]() {
    let index = 0;
    return {
      next: () => ({
        value: this.data[index++],
        done: index > this.data.length,
      }),
    };
  },
};

for (const item of myIterable) {
  console.log(item); // 1, 2, 3
}
```

---

## 3. BigInt Deep Dive (ES2020)

BigInt lÃ  kiá»ƒu dá»¯ liá»‡u **má»›i nháº¥t** cá»§a JavaScript, vÃ  cÅ©ng lÃ  kiá»ƒu cÃ³ **lÃ½ do tá»“n táº¡i rÃµ rÃ ng nháº¥t**: giáº£i quyáº¿t viá»‡c Number type khÃ´ng thá»ƒ biá»ƒu diá»…n an toÃ n cÃ¡c sá»‘ nguyÃªn lá»›n hÆ¡n `2^53 - 1`. ÄÃ¢y khÃ´ng pháº£i váº¥n Ä‘á» lÃ½ thuyáº¿t â€” nÃ³ áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n cÃ¡c há»‡ thá»‘ng thá»±c táº¿: Twitter/X IDs, database IDs trong PostgreSQL/MongoDB, cryptocurrency amounts, vÃ  nanosecond timestamps Ä‘á»u vÆ°á»£t quÃ¡ `MAX_SAFE_INTEGER`.

TrÆ°á»›c BigInt, developers pháº£i dÃ¹ng workaround: lÆ°u sá»‘ lá»›n dÆ°á»›i dáº¡ng string, dÃ¹ng libraries nhÆ° `bignumber.js`, hoáº·c server tráº£ vá» 2 fields (`id` vÃ  `id_str` nhÆ° Twitter API). BigInt loáº¡i bá» má»i workaround Ä‘Ã³ báº±ng cÃ¡ch thÃªm **arbitrary-precision integer** vÃ o ngÃ´n ngá»¯, vá»›i cÃº phÃ¡p Ä‘Æ¡n giáº£n: thÃªm háº­u tá»‘ `n` vÃ o báº¥t ká»³ sá»‘ nÃ o.

### Táº¡i Sao Cáº§n BigInt?

Váº¥n Ä‘á» cá»‘t lÃµi náº±m á»Ÿ kiáº¿n trÃºc IEEE-754: 64-bit chia thÃ nh 1 bit dáº¥u + 11 bits sá»‘ mÅ© + 52 bits pháº§n Ä‘á»‹nh trá»‹. Chá»‰ 52 bits cho mantissa â†’ chá»‰ biá»ƒu diá»…n chÃ­nh xÃ¡c sá»‘ nguyÃªn Ä‘áº¿n `2^53 - 1` (khoáº£ng 9 nghÃ¬n tá»·). VÆ°á»£t qua ngÆ°á»¡ng nÃ y, sá»‘ bá»‹ lÃ m trÃ²n tháº§m láº·ng â€” vÃ  Ä‘Ã¢y lÃ  **silent data corruption**, nguy hiá»ƒm hÆ¡n cáº£ runtime error vÃ¬ khÃ´ng cÃ³ warning nÃ o.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NUMBER LIMITATIONS IN JAVASCRIPT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JavaScript Number = 64-bit floating point (IEEE 754)           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Limitation 1: Precision                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Max safe integer: 2^53 - 1 = 9,007,199,254,740,991        â”‚ â”‚
â”‚  â”‚  Number.MAX_SAFE_INTEGER                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Lá»›n hÆ¡n â†’ Máº¤T PRECISION!                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Limitation 2: Range                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Max value: 2^1024                                         â”‚ â”‚
â”‚  â”‚  Lá»›n hÆ¡n â†’ INFINITY!                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// âŒ Number precision problem
Math.pow(2, 53) === Math.pow(2, 53) + 1; // true! (Wrong!)
// 9007199254740992 === 9007199254740993

console.log(9007199254740991 + 1); // 9007199254740992 âœ“
console.log(9007199254740991 + 2); // 9007199254740992 âœ— (should be ...993)

// âŒ Number range problem
Math.pow(2, 1024); // Infinity
```

### BigInt Syntax

BigInt cÃ³ 2 cÃ¡ch táº¡o: **literal** (thÃªm suffix `n`: `42n`, `0n`, `-100n`) vÃ  **constructor** (`BigInt(42)`, `BigInt("42")`). LÆ°u Ã½: `BigInt()` KHENHÃ”NG dÃ¹ng vá»›i `new` (giá»‘ng Symbol), vÃ  KHÃ”NG cháº¥p nháº­n sá»‘ tháº­p phÃ¢n (`BigInt(1.5)` â†’ throws). LÃ½ do: BigInt chá»‰ dÃ nh cho sá»‘ nguyÃªn â€” náº¿u cáº§n tháº­p phÃ¢n, dÃ¹ng Number hoáº·c thÆ° viá»‡n decimal.

```javascript
// Táº¡o BigInt - Suffix vá»›i 'n'
const bigNum = 12n;
const anotherBig = 9007199254740991n;

// Hoáº·c dÃ¹ng BigInt() function
const fromNumber = BigInt(100);
const fromString = BigInt("9007199254740991");

// typeof
typeof 12n; // "bigint"
typeof BigInt(12); // "bigint"
```

### BigInt Operations

BigInt há»— trá»£ táº¥t cáº£ cÃ¡c phÃ©p toÃ¡n sá»‘ há»c (`+`, `-`, `*`, `/`, `%`, `**`) vÃ  bitwise operators. NhÆ°ng cÃ³ má»™t sá»± khÃ¡c biá»‡t quan trá»ng: phÃ©p chia `/` **lÃ m trÃ²n xuá»‘ng** (truncate, khÃ´ng pháº£i floor) vÃ¬ BigInt chá»‰ lÃ m viá»‡c vá»›i sá»‘ nguyÃªn. VÃ­ dá»¥: `7n / 2n === 3n` (khÃ´ng pháº£i 3.5). ÄÃ¢y lÃ  hÃ nh vi giá»‘ng integer division trong C/Java.

```javascript
// âœ… Operations giá»¯a BigInt vá»›i nhau
1n + 2n; // 3n
10n - 5n; // 5n
3n * 4n; // 12n
10n / 3n; // 3n (integer division, khÃ´ng cÃ³ decimal!)
10n % 3n; // 1n
2n ** 10n; // 1024n

// âŒ CANNOT mix BigInt vá»›i Number
1n + 1; // TypeError: Cannot mix BigInt and other types
10n / 3; // TypeError

// âœ… Pháº£i convert trÆ°á»›c
1n + BigInt(1); // 2n
Number(10n) / 3; // 3.333...

// âš ï¸ Cáº©n tháº­n khi convert
Number(BigInt(Number.MAX_SAFE_INTEGER) + 1n);
// CÃ³ thá»ƒ máº¥t precision khi convert vá» Number
```

### BigInt Comparison

BigInt cÃ³ thá»ƒ so sÃ¡nh vá»›i Number báº±ng `==` (loose equality: `1n == 1` lÃ  `true`) nhÆ°ng KHÃ”NG báº±ng `===` (strict equality: `1n === 1` lÃ  `false` vÃ¬ khÃ¡c type). CÃ¡c comparison operators `<`, `>`, `<=`, `>=` hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng giá»¯a BigInt vÃ  Number. BigInt cÅ©ng cÃ³ thá»ƒ mixed vÃ o Array rá»“i sort Ä‘Æ°á»£c vÃ¬ comparison operators hoáº¡t Ä‘á»™ng cross-type.

```javascript
// Loose equality (==) - cÃ³ type coercion
12n == 12; // true
12n == "12"; // true

// Strict equality (===) - khÃ¡c type = false
12n === 12; // false â† KhÃ¡c type!
12n === BigInt(12); // true

// Comparison operators work
1n < 2; // true
2n > 1; // true
2n >= 2; // true
```

### BigInt Restrictions

BigInt cÃ³ 3 háº¡n cháº¿ chÃ­nh: **(1)** KhÃ´ng thá»ƒ trá»™n vá»›i Number trong phÃ©p toÃ¡n (`1n + 1` â†’ TypeError). ÄÃ¢y lÃ  thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch â€” náº¿u JS tá»± Ä‘á»™ng convert, báº¡n sáº½ máº¥t precision mÃ  khÃ´ng hay biáº¿t. **(2)** KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i `Math.*` (vÃ¬ Math chá»‰ lÃ m viá»‡c vá»›i Number/float). **(3)** KhÃ´ng dÃ¹ng vá»›i `JSON.stringify()` máº·c Ä‘á»‹nh â€” pháº£i custom `toJSON` method hoáº·c dÃ¹ng replacer function. ÄÃ¢y lÃ  váº¥n Ä‘á» thá»±c táº¿ lá»›n nháº¥t vÃ¬ API communication thÆ°á»ng dÃ¹ng JSON.

```javascript
// âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i new
new BigInt(1);
// TypeError: BigInt is not a constructor

// âŒ Pháº£i lÃ  integer
BigInt(1.5);
// RangeError: The number 1.5 cannot be converted to a BigInt

// âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i Math methods
Math.max(1n, 2n);
// TypeError: Cannot convert a BigInt value to a number

// âŒ KhÃ´ng dÃ¹ng Ä‘Æ°á»£c vá»›i JSON.stringify
JSON.stringify({ num: 1n });
// TypeError: Do not know how to serialize a BigInt

// âœ… Workaround cho JSON
JSON.stringify({ num: 1n }, (key, value) =>
  typeof value === "bigint" ? value.toString() : value,
);
```

### Use Cases

Chá»‰ cáº§n nhá»› má»™t quy táº¯c: dÃ¹ng BigInt khi báº¡n lÃ m viá»‡c vá»›i **sá»‘ nguyÃªn lá»›n hÆ¡n 9 quadrillion** (`2^53`). Trong thá»±c táº¿, cÃ¡c use cases phá»• biáº¿n nháº¥t: **(1) Distributed IDs** â€” Twitter snowflake, Discord snowflake, UUID vÃ o BigInt cho comparison. **(2) Cryptocurrency/Fintech** â€” 1 ETH = 10^18 wei, cáº§n precision tuyá»‡t Ä‘á»‘i. **(3) High-frequency timestamps** â€” `performance.now()` tráº£ vá» microseconds, cáº§n BigInt cho nanosecond precision trong profiling. **(4) Cryptography** â€” RSA keys lÃ  sá»‘ nguyÃªn 2048-bit.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIGINT USE CASES                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£  FINANCIAL CALCULATIONS                                     â”‚
â”‚      Tiá»n tá»‡ vá»›i Ä‘á»™ chÃ­nh xÃ¡c cao (trÃ¡nh floating point errors) â”‚
â”‚      VÃ­ dá»¥: cryptocurrency, stock trading                       â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£  CRYPTOGRAPHY                                               â”‚
â”‚      MÃ£ hÃ³a cáº§n sá»‘ nguyÃªn ráº¥t lá»›n                               â”‚
â”‚      VÃ­ dá»¥: RSA keys, hash functions                            â”‚
â”‚                                                                 â”‚
â”‚  3ï¸âƒ£  HIGH-PRECISION TIMESTAMPS                                  â”‚
â”‚      Nanosecond timestamps                                      â”‚
â”‚      VÃ­ dá»¥: performance.now() replacement                       â”‚
â”‚                                                                 â”‚
â”‚  4ï¸âƒ£  SCIENTIFIC COMPUTING                                       â”‚
â”‚      TÃ­nh toÃ¡n khoa há»c vá»›i sá»‘ lá»›n                              â”‚
â”‚      VÃ­ dá»¥: factorial, Fibonacci lá»›n                            â”‚
â”‚                                                                 â”‚
â”‚  5ï¸âƒ£  DATABASE IDs                                               â”‚
â”‚      64-bit integer IDs tá»« databases                            â”‚
â”‚      VÃ­ dá»¥: Twitter snowflake IDs                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// Example: Factorial vá»›i BigInt
function factorial(n) {
  let result = 1n;
  for (let i = 2n; i <= n; i++) {
    result *= i;
  }
  return result;
}

factorial(50n);
// 30414093201713378043612608166064768844377641568960512000000000000n

// Vá»›i Number thÃ´ng thÆ°á»ng â†’ Infinity
```

---

## 4. Type Detection Methods

Kiá»ƒm tra kiá»ƒu dá»¯ liá»‡u trong JavaScript phá»©c táº¡p hÆ¡n báº¡n tÆ°á»Ÿng â€” vÃ  Ä‘Ã¢y lÃ  **cÃ¢u há»i phá»ng váº¥n kinh Ä‘iá»ƒn**. KhÃ´ng cÃ³ má»™t method duy nháº¥t nÃ o chÃ­nh xÃ¡c 100% cho má»i trÆ°á»ng há»£p. Má»—i method cÃ³ trade-offs riÃªng: `typeof` nhanh nhÆ°ng sai vá»›i `null` vÃ  arrays; `instanceof` chÃ­nh xÃ¡c cho objects nhÆ°ng khÃ´ng detect Ä‘Æ°á»£c primitives; `Object.prototype.toString.call()` chÃ­nh xÃ¡c nháº¥t nhÆ°ng verbose.

Viá»‡c hiá»ƒu sÃ¢u tá»«ng method khÃ´ng chá»‰ giÃºp báº¡n viáº¿t code defensive hÆ¡n, mÃ  cÃ²n giÃºp hiá»ƒu **táº¡i sao** TypeScript ra Ä‘á»i â€” vÃ¬ JS's type system quÃ¡ dá»… gÃ¢y bugs mÃ  developer khÃ´ng hay biáº¿t.

### Overview Comparison

Báº£ng so sÃ¡nh dÆ°á»›i Ä‘Ã¢y lÃ  **cheat sheet** quan trá»ng nháº¥t cho type detection. Trong thá»±c táº¿ production: dÃ¹ng `typeof` cho primitives (nhanh, Ä‘á»§ tá»‘t), `Array.isArray()` cho arrays (clearest intent), vÃ  `Object.prototype.toString.call()` khi cáº§n phÃ¢n biá»‡t chÃ­nh xÃ¡c giá»¯a Object/Array/Date/RegExp/Map/Set.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TYPE DETECTION METHODS COMPARISON                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚       Method         â”‚   Use For    â”‚     Limitation       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ typeof               â”‚ Primitives   â”‚ nullâ†’"object"        â”‚ â”‚
â”‚  â”‚                      â”‚ + function   â”‚ arraysâ†’"object"      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ instanceof           â”‚ Objects      â”‚ Can't detect         â”‚ â”‚
â”‚  â”‚                      â”‚ inheritance  â”‚ primitives           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Object.prototype.    â”‚ ALL types    â”‚ Verbose syntax       â”‚ â”‚
â”‚  â”‚ toString.call()      â”‚ accurately   â”‚                      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Array.isArray()      â”‚ Arrays only  â”‚ Only for arrays      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. typeof Operator

`typeof` lÃ  cÃ¡ch kiá»ƒm tra type **nhanh nháº¥t** (single CPU instruction trong V8) vÃ  **an toÃ n nháº¥t** (khÃ´ng throw error cho undeclared variables). NhÆ°ng nÃ³ cÃ³ 2 bugs ná»•i tiáº¿ng: `typeof null === "object"` (bug lá»‹ch sá»­ tá»« 1995, sáº½ KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c fix vÃ¬ backward compatibility), vÃ  `typeof []` tráº£ vá» `"object"` thay vÃ¬ `"array"` (vÃ¬ Array thá»±c sá»± IS an object trong JS). Fun fact: `typeof` lÃ  operator duy nháº¥t trong JS cÃ³ thá»ƒ dÃ¹ng vá»›i undeclared variable mÃ  khÃ´ng throw ReferenceError â€” Ä‘Ã¢y lÃ  lÃ½ do nÃ³ Ä‘Æ°á»£c dÃ¹ng cho feature detection: `if (typeof window !== 'undefined')`.

```javascript
// âœ… WORKS WELL FOR:
typeof 1; // "number"
typeof "hello"; // "string"
typeof true; // "boolean"
typeof undefined; // "undefined"
typeof Symbol(); // "symbol"
typeof 123n; // "bigint"
typeof function () {}; // "function"

// âŒ PROBLEMS:
typeof null; // "object" â† BUG!
typeof []; // "object" â† Can't distinguish
typeof {}; // "object" â† Can't distinguish
typeof new Date(); // "object"
typeof /regex/; // "object"
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  typeof SUMMARY                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… Æ¯u Ä‘iá»ƒm:                                                    â”‚
â”‚     â€¢ Nhanh, syntax Ä‘Æ¡n giáº£n                                    â”‚
â”‚     â€¢ PhÃ¢n biá»‡t Ä‘Æ°á»£c cÃ¡c primitive types                        â”‚
â”‚     â€¢ Nháº­n diá»‡n Ä‘Æ°á»£c function                                   â”‚
â”‚                                                                 â”‚
â”‚  âŒ NhÆ°á»£c Ä‘iá»ƒm:                                                 â”‚
â”‚     â€¢ typeof null === "object" (historical bug)                 â”‚
â”‚     â€¢ KhÃ´ng phÃ¢n biá»‡t Ä‘Æ°á»£c Array, Object, Date, RegExp, null    â”‚
â”‚     â€¢ Táº¥t cáº£ objects Ä‘á»u tráº£ vá» "object"                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. instanceof Operator

`instanceof` kiá»ƒm tra xem **prototype chain** cá»§a object cÃ³ chá»©a `Constructor.prototype` hay khÃ´ng. ÄÃ¢y lÃ  cÃ¡ch kiá»ƒm tra class inheritance chÃ­nh xÃ¡c nháº¥t, nhÆ°ng cÃ³ 2 háº¡n cháº¿: **(1)** KhÃ´ng hoáº¡t Ä‘á»™ng vá»›i primitives (`"hello" instanceof String` lÃ  `false` vÃ¬ string literal khÃ´ng pháº£i String object). **(2)** Fail khi cross-frame/iframe â€” má»—i frame cÃ³ riÃªng `Array.prototype`, nÃªn `iframeArray instanceof Array` lÃ  `false` dÃ¹ nÃ³ IS an array. ÄÃ¢y lÃ  lÃ½ do `Array.isArray()` ra Ä‘á»i â€” nÃ³ hoáº¡t Ä‘á»™ng cross-realm.

```javascript
// âœ… WORKS FOR OBJECTS:
[] instanceof Array                  // true
{} instanceof Object                 // true
function(){} instanceof Function     // true
new Date() instanceof Date           // true
/regex/ instanceof RegExp            // true

// âŒ DOESN'T WORK FOR PRIMITIVES:
1 instanceof Number                  // false
"str" instanceof String              // false
true instanceof Boolean              // false

// âš ï¸ Works with wrapper objects:
new Number(1) instanceof Number      // true
new String("s") instanceof String    // true
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  instanceof MECHANISM                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  obj instanceof Constructor                                     â”‚
â”‚                                                                 â”‚
â”‚  â†“ Check prototype chain                                        â”‚
â”‚                                                                 â”‚
â”‚  obj.__proto__ === Constructor.prototype ?                      â”‚
â”‚  obj.__proto__.__proto__ === Constructor.prototype ?            â”‚
â”‚  ... (lÃªn Ä‘áº¿n null)                                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [] instanceof Array     // true                           â”‚ â”‚
â”‚  â”‚  [] instanceof Object    // true (Array inherits Object)   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [].__proto__ === Array.prototype  âœ“                       â”‚ â”‚
â”‚  â”‚  Array.prototype.__proto__ === Object.prototype  âœ“         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âœ… Æ¯u Ä‘iá»ƒm:                                                    â”‚
â”‚     â€¢ PhÃ¢n biá»‡t Ä‘Æ°á»£c Array, Object, Function, custom classes   â”‚
â”‚     â€¢ Check Ä‘Æ°á»£c inheritance chain                              â”‚
â”‚                                                                 â”‚
â”‚  âŒ NhÆ°á»£c Ä‘iá»ƒm:                                                 â”‚
â”‚     â€¢ KhÃ´ng hoáº¡t Ä‘á»™ng vá»›i primitive types                       â”‚
â”‚     â€¢ CÃ³ thá»ƒ bá»‹ fail vá»›i cross-frame/iframe objects             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Object.prototype.toString.call() (Recommended)

ÄÃ¢y lÃ  **"vÅ© khÃ­ tá»‘i thÆ°á»£ng"** cho type detection. Method nÃ y Ä‘á»c internal `[[Class]]` slot cá»§a object â€” giÃ¡ trá»‹ mÃ  JS engine tá»± gÃ¡n khi táº¡o object, khÃ´ng thá»ƒ giáº£ máº¡o. Káº¿t quáº£ luÃ´n cÃ³ dáº¡ng `"[object Type]"`. Táº¡i sao pháº£i dÃ¹ng `Object.prototype.toString.call(value)` thay vÃ¬ `value.toString()`? VÃ¬ háº§u háº¿t objects override `toString()` (vÃ­ dá»¥: `[1,2].toString()` tráº£ vá» `"1,2"`, khÃ´ng pháº£i `"[object Array]"`). Báº±ng cÃ¡ch gá»i trá»±c tiáº¿p tá»« `Object.prototype`, ta bypass má»i override.

**LÆ°u Ã½ ES6+**: Tá»« ES6, báº¡n cÃ³ thá»ƒ customize káº¿t quáº£ báº±ng `Symbol.toStringTag`. VÃ­ dá»¥: class custom cÃ³ thá»ƒ tráº£ vá» `"[object MyClass]"` thay vÃ¬ `"[object Object]"`. ÄÃ¢y lÃ  cÃ¡ch Map tráº£ vá» `"[object Map]"`, Set tráº£ vá» `"[object Set]"`.

```javascript
const toString = Object.prototype.toString;

// âœ… WORKS FOR EVERYTHING:
toString.call(1); // "[object Number]"
toString.call("str"); // "[object String]"
toString.call(true); // "[object Boolean]"
toString.call(undefined); // "[object Undefined]"
toString.call(null); // "[object Null]"
toString.call(Symbol()); // "[object Symbol]"
toString.call(123n); // "[object BigInt]"

toString.call([]); // "[object Array]"
toString.call({}); // "[object Object]"
toString.call(function () {}); // "[object Function]"
toString.call(new Date()); // "[object Date]"
toString.call(/regex/); // "[object RegExp]"
toString.call(new Map()); // "[object Map]"
toString.call(new Set()); // "[object Set]"
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Object.prototype.toString.call() EXPLAINED                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Táº¡i sao pháº£i dÃ¹ng .call()?                                     â”‚
â”‚                                                                 â”‚
â”‚  [].toString()              // "" (Array's own toString)        â”‚
â”‚  ({}).toString()            // "[object Object]"                â”‚
â”‚                                                                 â”‚
â”‚  Object.prototype.toString.call([])    // "[object Array]"      â”‚
â”‚  â†’ Bypass object's own toString method                          â”‚
â”‚  â†’ Use Object.prototype's original toString                     â”‚
â”‚                                                                 â”‚
â”‚  âœ… Æ¯u Ä‘iá»ƒm:                                                    â”‚
â”‚     â€¢ ChÃ­nh xÃ¡c nháº¥t, hoáº¡t Ä‘á»™ng vá»›i Táº¤T Cáº¢ types               â”‚
â”‚     â€¢ PhÃ¢n biá»‡t Ä‘Æ°á»£c null, undefined, Array, Object, etc.       â”‚
â”‚                                                                 â”‚
â”‚  âŒ NhÆ°á»£c Ä‘iá»ƒm:                                                 â”‚
â”‚     â€¢ Syntax dÃ i dÃ²ng, khÃ³ nhá»›                                  â”‚
â”‚     â€¢ NÃªn wrap trong utility function                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Utility Function for Type Checking

Trong production code, báº¡n nÃªn táº¡o má»™t utility function táº­p trung thay vÃ¬ ráº£i `typeof`/`instanceof` kháº¯p nÆ¡i. Function dÆ°á»›i Ä‘Ã¢y káº¿t há»£p `Object.prototype.toString.call()` (chÃ­nh xÃ¡c) vá»›i normalized output (lowercase string) â€” Ä‘Ã¢y lÃ  pattern mÃ  jQuery, Lodash, vÃ  nhiá»u libraries dÃ¹ng.

```javascript
// Recommended utility function
function getType(value) {
  const type = Object.prototype.toString.call(value);
  return type.slice(8, -1).toLowerCase();
  // "[object Array]" â†’ "array"
}

// Usage
getType(1); // "number"
getType("str"); // "string"
getType([]); // "array"
getType({}); // "object"
getType(null); // "null"
getType(undefined); // "undefined"
getType(new Date()); // "date"
getType(/regex/); // "regexp"

// Type check helpers
const isArray = (val) => getType(val) === "array";
const isObject = (val) => getType(val) === "object";
const isNull = (val) => getType(val) === "null";
const isFunction = (val) => getType(val) === "function";
```

### 4. Other Useful Methods

NgoÃ i 3 methods chÃ­nh, JS cÃ²n cung cáº¥p cÃ¡c specialized methods cho tá»«ng trÆ°á»ng há»£p cá»¥ thá»ƒ. `Array.isArray()` lÃ  cÃ¡ch **duy nháº¥t Ä‘Ã¡ng tin** Ä‘á»ƒ check arrays (hoáº¡t Ä‘á»™ng cross-realm, khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi prototype chain). `Number.isNaN()` fix bug kinh Ä‘iá»ƒn cá»§a global `isNaN()` (global version convert argument sang number trÆ°á»›c khi check â†’ `isNaN("hello")` tráº£ vá» `true` â€” sai!). `Number.isFinite()` tÆ°Æ¡ng tá»±, khÃ´ng auto-convert. LuÃ´n Æ°u tiÃªn `Number.isNaN()` vÃ  `Number.isFinite()` thay vÃ¬ global versions.

```javascript
// Array.isArray() - specific for arrays
Array.isArray([]); // true
Array.isArray({}); // false
Array.isArray("string"); // false

// Number.isNaN() - check for NaN
Number.isNaN(NaN); // true
Number.isNaN("NaN"); // false (string, not NaN)
isNaN("NaN"); // true âš ï¸ (coerces to NaN first)

// Number.isFinite()
Number.isFinite(100); // true
Number.isFinite(Infinity); // false
Number.isFinite("100"); // false

// Number.isInteger()
Number.isInteger(5); // true
Number.isInteger(5.0); // true
Number.isInteger(5.5); // false
```

---

## 5. Type Detection Decision Tree

Khi Ä‘á»‘i máº·t cÃ¢u há»i "nÃªn dÃ¹ng method nÃ o Ä‘á»ƒ check type?", hÃ£y Ä‘i theo decision tree sau. Quy táº¯c tá»•ng quÃ¡t: **báº¯t Ä‘áº§u tá»« typeof** (nhanh nháº¥t, Ä‘á»§ cho primitives), escalate lÃªn `Array.isArray()` cho arrays, `instanceof` cho class checking, vÃ  `Object.prototype.toString.call()` khi cáº§n precision tá»‘i Ä‘a. Trong thá»±c táº¿ React: TypeScript handles háº§u háº¿t type checking táº¡i compile-time, nhÆ°ng runtime checks váº«n cáº§n cho API responses, user input, vÃ  interop vá»›i vanilla JS libraries.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WHICH TYPE DETECTION METHOD TO USE?                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    Start                                        â”‚
â”‚                      â”‚                                          â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚       â”‚                             â”‚                           â”‚
â”‚       â–¼                             â–¼                           â”‚
â”‚  Check primitives?            Check objects?                    â”‚
â”‚       â”‚                             â”‚                           â”‚
â”‚       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚       â”‚                    â”‚                 â”‚                  â”‚
â”‚       â–¼                    â–¼                 â–¼                  â”‚
â”‚    typeof            Array only?       Check class?             â”‚
â”‚                           â”‚                 â”‚                   â”‚
â”‚  (fast, simple)           â”‚                 â”‚                   â”‚
â”‚                           â–¼                 â–¼                   â”‚
â”‚  âš ï¸ Watch out:      Array.isArray()    instanceof               â”‚
â”‚  null â†’ "object"                                                â”‚
â”‚                                                                 â”‚
â”‚                    Need PRECISE type?                           â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚              Object.prototype.toString.call()                   â”‚
â”‚                    (always works)                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Common Type-Related Gotchas

ÄÃ¢y lÃ  6 "báº«y" mÃ  **gáº§n nhÆ° má»i JS developer** Ä‘á»u gáº·p Ã­t nháº¥t má»™t láº§n. ChÃºng khÃ´ng pháº£i bugs trong code cá»§a báº¡n â€” chÃºng lÃ  **quirks cá»§a ngÃ´n ngá»¯** Ä‘Æ°á»£c giá»¯ láº¡i vÃ¬ backward compatibility. Hiá»ƒu chÃºng giÃºp báº¡n viáº¿t defensive code tá»‘t hÆ¡n, vÃ  Ä‘Ã¢y cÅ©ng lÃ  nguá»“n cÃ¢u há»i phá»ng váº¥n báº¥t táº­n. Äáº·c biá»‡t chÃº Ã½ gotcha #2 (`NaN !== NaN`) â€” Ä‘Ã¢y lÃ  há»‡ quáº£ trá»±c tiáº¿p cá»§a IEEE-754 spec, khÃ´ng pháº£i JS design decision. Má»i ngÃ´n ngá»¯ dÃ¹ng IEEE-754 Ä‘á»u cÃ³ behavior nÃ y.

```javascript
// 1. typeof null bug
typeof null === "object"; // true (historical bug, won't be fixed)

// 2. NaN is not equal to itself
NaN === NaN; // false
Number.isNaN(NaN); // true (correct way)

// 3. typeof function is "function", not "object"
typeof function () {}; // "function" (special case)

// 4. Wrapper objects vs primitives
typeof "hello"; // "string"
typeof new String("hello"); // "object"

// 5. Arrays are objects
typeof []; // "object"
Array.isArray([]); // true

// 6. undefined vs null
typeof undefined; // "undefined"
typeof null; // "object"
undefined == null; // true (loose equality)
undefined === null; // false (strict equality)
```

---

## 7. Quick Reference

Báº£ng tham chiáº¿u nhanh dÆ°á»›i Ä‘Ã¢y so sÃ¡nh `typeof` vÃ  `Object.prototype.toString.call()` cho má»i kiá»ƒu dá»¯ liá»‡u. **Máº¹o phá»ng váº¥n**: há»c thuá»™c cá»™t `typeof` (chá»‰ 7 giÃ¡ trá»‹ possible: `"number"`, `"string"`, `"boolean"`, `"undefined"`, `"object"`, `"function"`, `"symbol"`, `"bigint"`) vÃ  nhá»› 2 trÆ°á»ng há»£p âš ï¸ Ä‘Ã¡nh dáº¥u (null vÃ  array). Náº¿u interviewer há»i "typeof tráº£ vá» bao nhiÃªu giÃ¡ trá»‹?", Ä‘Ã¡p Ã¡n lÃ  **8** (7 types + `"function"`).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TYPE DETECTION QUICK REFERENCE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  VALUE           â”‚ typeof      â”‚ toString.call()                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  1               â”‚ "number"    â”‚ "[object Number]"              â”‚
â”‚  "str"           â”‚ "string"    â”‚ "[object String]"              â”‚
â”‚  true            â”‚ "boolean"   â”‚ "[object Boolean]"             â”‚
â”‚  undefined       â”‚ "undefined" â”‚ "[object Undefined]"           â”‚
â”‚  null            â”‚ "object" âš ï¸ â”‚ "[object Null]"                â”‚
â”‚  Symbol()        â”‚ "symbol"    â”‚ "[object Symbol]"              â”‚
â”‚  123n            â”‚ "bigint"    â”‚ "[object BigInt]"              â”‚
â”‚  {}              â”‚ "object"    â”‚ "[object Object]"              â”‚
â”‚  []              â”‚ "object" âš ï¸ â”‚ "[object Array]"               â”‚
â”‚  function(){}    â”‚ "function"  â”‚ "[object Function]"            â”‚
â”‚  new Date()      â”‚ "object"    â”‚ "[object Date]"                â”‚
â”‚  /regex/         â”‚ "object"    â”‚ "[object RegExp]"              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. var vs let vs const (ES6)

Náº¿u cÃ³ má»™t thay Ä‘á»•i duy nháº¥t trong ES6 (2015) mÃ  **má»i JavaScript developer Ä‘á»u pháº£i náº¯m vá»¯ng** trÆ°á»›c khi Ä‘á»¥ng Ä‘áº¿n báº¥t ká»³ feature nÃ o khÃ¡c â€” Ä‘Ã³ chÃ­nh lÃ  `let` vÃ  `const`. KhÃ´ng pháº£i arrow functions, khÃ´ng pháº£i destructuring, khÃ´ng pháº£i Promises â€” mÃ  lÃ  cÃ¡ch khai bÃ¡o biáº¿n. Táº¡i sao? VÃ¬ `var` â€” cÃ¡ch khai bÃ¡o biáº¿n duy nháº¥t suá»‘t **18 nÄƒm** (1997â€“2015) â€” lÃ  nguá»“n gá»‘c cá»§a hÃ ng triá»‡u bugs, tá»« "variable leaking" ra khá»i blocks, Ä‘áº¿n "closure trapping" trong loops, Ä‘áº¿n "accidental globals" lÃ m memory leak cáº£ trang web.

CÃ¢u chuyá»‡n `var â†’ let/const` khÃ´ng chá»‰ lÃ  "dÃ¹ng cÃ¡i má»›i thay cÃ¡i cÅ©". NÃ³ pháº£n Ã¡nh sá»± **trÆ°á»Ÿng thÃ nh** cá»§a JavaScript tá»« má»™t scripting language "viáº¿t cho vui trong 10 ngÃ y" thÃ nh ngÃ´n ngá»¯ cháº¡y production cho hÃ ng tá»· ngÆ°á»i dÃ¹ng. Hiá»ƒu sÃ¢u ba keyword nÃ y â€” tá»« scope semantics Ä‘áº¿n V8 internal implementation, tá»« hoisting behavior Ä‘áº¿n Temporal Dead Zone â€” lÃ  ná»n táº£ng báº¯t buá»™c trÆ°á»›c khi bÃ n vá» closures, async/await, hay React hooks.

Pháº§n nÃ y sáº½ trÃ¬nh bÃ y chi tiáº¿t **tá»«ng khÃ¡c biá»‡t** giá»¯a `var`, `let`, vÃ  `const`, kÃ¨m theo ASCII diagrams, code examples, vÃ  phÃ¢n tÃ­ch V8 internals. Cuá»‘i cÃ¹ng, 6 Patterns tÆ° duy sáº½ giÃºp báº¡n hiá»ƒu **báº£n cháº¥t** thay vÃ¬ chá»‰ ghi nhá»› báº£ng so sÃ¡nh.

### Overview Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  var vs let vs const                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Feature      â”‚    var       â”‚    let       â”‚    const      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Introduced   â”‚ ES1 (1997)   â”‚ ES6 (2015)   â”‚ ES6 (2015)   â”‚ â”‚
â”‚  â”‚ Scope        â”‚ Function     â”‚ Block        â”‚ Block         â”‚ â”‚
â”‚  â”‚ Hoisting     â”‚ Yes (init    â”‚ Yes (TDZ)    â”‚ Yes (TDZ)     â”‚ â”‚
â”‚  â”‚              â”‚ undefined)   â”‚              â”‚               â”‚ â”‚
â”‚  â”‚ Re-declare   â”‚ âœ… Allowed   â”‚ âŒ Error     â”‚ âŒ Error      â”‚ â”‚
â”‚  â”‚ Re-assign    â”‚ âœ… Allowed   â”‚ âœ… Allowed   â”‚ âŒ Error      â”‚ â”‚
â”‚  â”‚ Must init    â”‚ âŒ No        â”‚ âŒ No        â”‚ âœ… Yes        â”‚ â”‚
â”‚  â”‚ Global obj   â”‚ âœ… window    â”‚ âŒ No        â”‚ âŒ No         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Báº£ng so sÃ¡nh trÃªn trÃ´ng Ä‘Æ¡n giáº£n â€” chá»‰ 6 dÃ²ng, 3 cá»™t. NhÆ°ng Ä‘áº±ng sau má»—i Ã´ lÃ  **má»™t quyáº¿t Ä‘á»‹nh thiáº¿t káº¿** áº£nh hÆ°á»Ÿng Ä‘áº¿n hÃ ng triá»‡u developer. HÃ£y Ä‘á»c báº£ng nÃ y khÃ´ng pháº£i nhÆ° má»™t "cheat sheet cáº§n ghi nhá»›", mÃ  nhÆ° má»™t **báº£n Ä‘á»“ lá»‹ch sá»­** cá»§a JavaScript.

**DÃ²ng "Introduced"** cho tháº¥y khoáº£ng cÃ¡ch **18 nÄƒm** giá»¯a `var` (1997) vÃ  `let`/`const` (2015). 18 nÄƒm lÃ  cáº£ má»™t tháº¿ há»‡ developer pháº£i chá»‹u Ä‘á»±ng bugs tá»« function scope vÃ  hoisting. Khoáº£ng cÃ¡ch thá»i gian nÃ y giáº£i thÃ­ch táº¡i sao `var` Äƒn sÃ¢u vÃ o DNA cá»§a JavaScript â€” má»i tutorial cÅ©, má»i StackOverflow answer trÆ°á»›c 2015, má»i legacy codebase Ä‘á»u dÃ¹ng `var`. ÄÃ¢y lÃ  lÃ½ do báº¡n **pháº£i hiá»ƒu `var`** dÃ¹ khÃ´ng bao giá» dÃ¹ng nÃ³ trong code má»›i.

**DÃ²ng "Scope"** lÃ  khÃ¡c biá»‡t quan trá»ng nháº¥t â€” vÃ  cÅ©ng lÃ  lÃ½ do `let`/`const` ra Ä‘á»i. Function scope cá»§a `var` nghÄ©a lÃ  biáº¿n "rÃ² rá»‰" ra khá»i `if`, `for`, `while`, `try/catch`. Block scope cá»§a `let`/`const` nghÄ©a lÃ  biáº¿n chá»‰ sá»‘ng trong cáº·p `{}` chá»©a nÃ³. ÄÃ¢y khÃ´ng chá»‰ lÃ  syntax â€” nÃ³ thay Ä‘á»•i **mental model** cÃ¡ch developer nghÄ© vá» lifetime cá»§a biáº¿n.

**DÃ²ng "Hoisting"** tiáº¿t lá»™ má»™t sá»± tháº­t báº¥t ngá»: cáº£ ba Ä‘á»u Ä‘Æ°á»£c hoist! Sá»± khÃ¡c biá»‡t lÃ  `var` Ä‘Æ°á»£c **initialized** (= `undefined`) cÃ²n `let`/`const` thÃ¬ **khÃ´ng**. ÄÃ¢y lÃ  nguá»“n gá»‘c cá»§a TDZ (Temporal Dead Zone) â€” concept mÃ  90% junior developer khÃ´ng biáº¿t nhÆ°ng **100% senior developer** pháº£i giáº£i thÃ­ch Ä‘Æ°á»£c trong interview.

**DÃ²ng "Re-declare"** thá»ƒ hiá»‡n triáº¿t lÃ½ "fail fast": `var` cho phÃ©p khai bÃ¡o láº¡i cÃ¹ng tÃªn mÃ  khÃ´ng lá»—i â†’ bugs Ã¢m tháº§m. `let`/`const` throw `SyntaxError` ngay láº­p tá»©c â†’ developer biáº¿t lá»—i trÆ°á»›c khi code cháº¡y.

**DÃ²ng "Global obj"** lÃ  trap Ã­t ai Ä‘á»ƒ Ã½: `var x = 1` á»Ÿ global scope táº¡o `window.x` â€” báº¥t ká»³ script nÃ o cÅ©ng Ä‘á»c/ghi Ä‘Æ°á»£c. ÄÃ¢y lÃ  **namespace pollution** nghiÃªm trá»ng, Ä‘áº·c biá»‡t khi page cÃ³ nhiá»u third-party scripts. `let`/`const` trÃ¡nh hoÃ n toÃ n váº¥n Ä‘á» nÃ y.

### 1. Scope â€” Function vs Block

**Scope** (pháº¡m vi) lÃ  khÃ¡i niá»‡m ná»n táº£ng nháº¥t Ä‘á»ƒ hiá»ƒu `var` vs `let`/`const`. Trong programming language theory, scope quyáº¿t Ä‘á»‹nh **á»Ÿ Ä‘Ã¢u má»™t biáº¿n cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p**. JavaScript ban Ä‘áº§u chá»‰ cÃ³ **function scope** â€” nghÄ©a lÃ  má»i biáº¿n khai bÃ¡o báº±ng `var` Ä‘á»u "nhÃ¬n tháº¥y" trong toÃ n bá»™ function chá»©a nÃ³, báº¥t ká»ƒ báº¡n khai bÃ¡o á»Ÿ Ä‘Ã¢u bÃªn trong function.

ÄÃ¢y lÃ  quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ cÃ³ **háº­u quáº£ sÃ¢u rá»™ng**. Háº§u háº¿t ngÃ´n ngá»¯ láº­p trÃ¬nh (C, Java, Python) Ä‘á»u dÃ¹ng **block scope** â€” biáº¿n khai bÃ¡o trong `if {}` chá»‰ tá»“n táº¡i trong `if {}` Ä‘Ã³. NhÆ°ng JavaScript? `var` trong `if {}` váº«n truy cáº­p Ä‘Æ°á»£c ngoÃ i `if {}` â€” miá»…n lÃ  cÃ¹ng function. Äiá»u nÃ y gÃ¢y ra vÃ´ sá»‘ bugs mÃ  developer khÃ´ng lÆ°á»ng trÆ°á»›c: biáº¿n `i` trong loop "rÃ² rá»‰" ra ngoÃ i, biáº¿n táº¡m trong `try/catch` váº«n tá»“n táº¡i sau block...

ES6 kháº¯c phá»¥c báº±ng `let`/`const` vá»›i **block scope** â€” má»i cáº·p `{}` Ä‘á»u táº¡o má»™t scope riÃªng biá»‡t. Tá»« gÃ³c nhÃ¬n V8: `var` Ä‘Æ°á»£c lÆ°u trong **function-level context** (VariableEnvironment), cÃ²n `let`/`const` Ä‘Æ°á»£c lÆ°u trong **block-level context** (LexicalEnvironment). ÄÃ¢y khÃ´ng chá»‰ lÃ  syntax sugar â€” engine thá»±c sá»± táº¡o **scope chain ngáº¯n hÆ¡n** cho block scope, giÃºp garbage collector thu há»“i bá»™ nhá»› sá»›m hÆ¡n khi block káº¿t thÃºc.

```javascript
// â”€â”€ var: Function scope â”€â”€
// var KHÃ”NG cÃ³ khÃ¡i niá»‡m block scope, cÃ³ thá»ƒ truy cáº­p xuyÃªn block
// NhÆ°ng KHÃ”NG thá»ƒ truy cáº­p xuyÃªn function

function example() {
  if (true) {
    var x = 10; // var â†’ function scope
  }
  console.log(x); // 10 âœ… (xuyÃªn block, cÃ¹ng function)
}
example();
// console.log(x);   // âŒ ReferenceError (khÃ¡c function)

// â”€â”€ let: Block scope â”€â”€
// let CHá»ˆ truy cáº­p Ä‘Æ°á»£c trong block scope, KHÃ”NG xuyÃªn block, KHÃ”NG xuyÃªn function

function example2() {
  if (true) {
    let y = 20; // let â†’ block scope
  }
  // console.log(y); // âŒ ReferenceError (khÃ¡c block!)
}

// â”€â”€ const: Block scope + Cannot reassign â”€â”€
// const dÃ¹ng Ä‘á»ƒ khai bÃ¡o háº±ng sá»‘, PHáº¢I khá»Ÿi táº¡o khi khai bÃ¡o
// CHá»ˆ truy cáº­p trong block scope, KHÃ”NG thá»ƒ gÃ¡n láº¡i

{
  const z = 30;
  // z = 40;         // âŒ TypeError: Assignment to constant variable
  console.log(z); // 30 âœ…
}
// console.log(z);   // âŒ ReferenceError (ngoÃ i block)

// âš ï¸ const vá»›i object/array â€” reference báº¥t biáº¿n, value CÃ“ THá»‚ thay Ä‘á»•i!
const obj = { name: "John" };
obj.name = "Jane"; // âœ… OK (thay Ä‘á»•i property, khÃ´ng thay Ä‘á»•i reference)
// obj = {};          // âŒ TypeError (thay Ä‘á»•i reference)

const arr = [1, 2, 3];
arr.push(4); // âœ… OK (mutate array contents)
// arr = [5, 6];      // âŒ TypeError (reassign reference)
```

#### Deep Dive: Nghá»‹ch LÃ½ const â€” "Háº±ng Sá»‘" MÃ  KhÃ´ng Háº±ng

ÄÃ¢y lÃ  má»™t trong nhá»¯ng nguá»“n nháº§m láº«n lá»›n nháº¥t vá» `const` â€” vÃ  cÅ©ng lÃ  cÃ¢u há»i **trap** phá»• biáº¿n nháº¥t trong interview. Khi báº¡n nghe "const = constant (háº±ng sá»‘)", báº¡n tá»± nhiÃªn nghÄ© ráº±ng giÃ¡ trá»‹ khÃ´ng bao giá» thay Ä‘á»•i. NhÆ°ng thá»±c táº¿?

```javascript
const user = { name: "John", age: 25 };
user.age = 26; // âœ… HoÃ n toÃ n há»£p lá»‡!
user.email = "j@e.c"; // âœ… ThÃªm property má»›i cÅ©ng OK!
console.log(user); // { name: "John", age: 26, email: "j@e.c" }
```

Táº¡i sao? VÃ¬ `const` báº£o vá»‡ **binding** (liÃªn káº¿t giá»¯a tÃªn biáº¿n vÃ  vÃ¹ng nhá»›), KHÃ”NG pháº£i **value** (ná»™i dung bÃªn trong vÃ¹ng nhá»› Ä‘Ã³). HÃ£y tÆ°á»Ÿng tÆ°á»£ng `const` nhÆ° **dÃ¡n nhÃ£n cá»‘ Ä‘á»‹nh lÃªn má»™t chiáº¿c há»™p**: báº¡n khÃ´ng thá»ƒ gá»¡ nhÃ£n ra vÃ  dÃ¡n lÃªn há»™p khÃ¡c (`user = {}` â†’ TypeError), nhÆ°ng báº¡n hoÃ n toÃ n cÃ³ thá»ƒ má»Ÿ há»™p ra vÃ  thay Ä‘á»•i Ä‘á»“ bÃªn trong (`user.age = 26` â†’ OK).

ÄÃ¢y lÃ  sá»± phÃ¢n biá»‡t giá»¯a **immutable binding** (const cung cáº¥p) vÃ  **immutable value** (const KHÃ”NG cung cáº¥p). Náº¿u muá»‘n immutable value thá»±c sá»±, báº¡n cáº§n `Object.freeze()`:

```javascript
const frozen = Object.freeze({ name: "John", age: 25 });
frozen.age = 26; // âŒ Silently fails (strict mode: TypeError)
console.log(frozen); // { name: "John", age: 25 } â€” khÃ´ng thay Ä‘á»•i

// âš ï¸ NhÆ°ng Object.freeze() chá»‰ SHALLOW freeze!
const nested = Object.freeze({
  profile: { name: "John" }, // nested object KHÃ”NG bá»‹ freeze
});
nested.profile.name = "Jane"; // âœ… Váº«n thay Ä‘á»•i Ä‘Æ°á»£c!
```

Trong **V8 engine**, `const` vá»›i primitive values (number, string, boolean) Ä‘Æ°á»£c optimize Ä‘áº·c biá»‡t: TurboFan (optimizing compiler) cÃ³ thá»ƒ **inline** giÃ¡ trá»‹ trá»±c tiáº¿p vÃ o machine code, vÃ¬ nÃ³ biáº¿t binding sáº½ khÃ´ng thay Ä‘á»•i. Vá»›i objects, `const` chá»‰ Ä‘áº£m báº£o pointer stability â€” engine váº«n pháº£i track mutations trÃªn object.

Trong **React**, hiá»ƒu Ä‘Ãºng `const` lÃ  critical:

- `const [state, setState] = useState()` â†’ destructured values lÃ  const, nhÆ°ng state thay Ä‘á»•i qua re-render
- `const ref = useRef()` â†’ ref binding khÃ´ng Ä‘á»•i, nhÆ°ng `ref.current` thay Ä‘á»•i Ä‘Æ°á»£c
- `const callback = useCallback(fn, deps)` â†’ binding khÃ´ng Ä‘á»•i, nhÆ°ng function bÃªn trong cÃ³ thá»ƒ thay Ä‘á»•i khi deps thay Ä‘á»•i

BÃ i há»c quan trá»ng: **`const` khÃ´ng pháº£i immutability tool** â€” nÃ³ lÃ  **intent signaling tool**. Khi báº¡n dÃ¹ng `const`, báº¡n nÃ³i vá»›i Ä‘á»“ng Ä‘á»™i: "TÃ´i sáº½ khÃ´ng reassign biáº¿n nÃ y." ÄÃ³ lÃ  communication, khÃ´ng pháº£i protection.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE VISUALIZATION                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  function outer() {                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ function scope â” â”‚
â”‚  â”‚  var a = 1;    // âœ… Accessible anywhere in function        â”‚ â”‚
â”‚  â”‚  let b = 2;    // âœ… Accessible in this block               â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  if (true) {                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ block scope â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚  var c = 3;  // âš ï¸ Actually in function scope (hoisted)â”‚â”‚ â”‚
â”‚  â”‚  â”‚  let d = 4;  // âœ… Only in this block                   â”‚â”‚ â”‚
â”‚  â”‚  â”‚  const e = 5;// âœ… Only in this block                   â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                              â”‚ â”‚
â”‚  â”‚  console.log(a);  // 1 âœ…                                   â”‚ â”‚
â”‚  â”‚  console.log(b);  // 2 âœ…                                   â”‚ â”‚
â”‚  â”‚  console.log(c);  // 3 âœ… (var â†’ function scope)           â”‚ â”‚
â”‚  â”‚  console.log(d);  // âŒ ReferenceError                      â”‚ â”‚
â”‚  â”‚  console.log(e);  // âŒ ReferenceError                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Hoisting

**Hoisting** lÃ  má»™t trong nhá»¯ng khÃ¡i niá»‡m gÃ¢y nháº§m láº«n nháº¥t cho JavaScript beginners â€” vÃ  cÅ©ng lÃ  cÃ¢u há»i interview "kinh Ä‘iá»ƒn" á»Ÿ má»i level. Báº£n cháº¥t: khi V8 engine parse code, nÃ³ thá»±c hiá»‡n **hai phases** â€” (1) **Creation Phase**: quÃ©t toÃ n bá»™ scope Ä‘á»ƒ Ä‘Äƒng kÃ½ má»i variable declarations vÃ o memory, (2) **Execution Phase**: cháº¡y code tá»«ng dÃ²ng má»™t.

Vá»›i `var`, Creation Phase Ä‘Äƒng kÃ½ biáº¿n **vÃ  khá»Ÿi táº¡o giÃ¡ trá»‹ `undefined`** â€” nÃªn báº¡n cÃ³ thá»ƒ "dÃ¹ng trÆ°á»›c, khai bÃ¡o sau" mÃ  khÃ´ng lá»—i (chá»‰ nháº­n `undefined`). ÄÃ¢y lÃ  behavior cá»±c ká»³ nguy hiá»ƒm: code cháº¡y khÃ´ng lá»—i nhÆ°ng cho káº¿t quáº£ sai, vÃ  bug nÃ y ráº¥t khÃ³ debug vÃ¬ khÃ´ng cÃ³ error message nÃ o cáº£nh bÃ¡o.

Vá»›i `let`/`const`, Creation Phase Ä‘Äƒng kÃ½ biáº¿n nhÆ°ng **KHÃ”NG khá»Ÿi táº¡o** â€” biáº¿n tá»“n táº¡i trong memory nhÆ°ng á»Ÿ tráº¡ng thÃ¡i "uninitialized". Truy cáº­p má»™t biáº¿n uninitialized sáº½ throw `ReferenceError`. VÃ¹ng tá»« Ä‘áº§u scope Ä‘áº¿n dÃ²ng khai bÃ¡o gá»i lÃ  **Temporal Dead Zone (TDZ)** â€” vÃ  Ä‘Ã¢y lÃ  thiáº¿t káº¿ **cÃ³ chá»§ Ä‘Ã­ch** Ä‘á»ƒ báº¯t bugs sá»›m hÆ¡n.

```javascript
// â”€â”€ var: Hoisted & initialized as undefined â”€â”€
// var cho phÃ©p "sá»­ dá»¥ng trÆ°á»›c, khai bÃ¡o sau" (variable hoisting)

console.log(a); // undefined â† hoisted, nhÆ°ng chÆ°a gÃ¡n giÃ¡ trá»‹
var a = 10;
console.log(a); // 10

// JavaScript engine xá»­ lÃ½ nhÆ° sau:
// var a;            â† Declaration hoisted lÃªn Ä‘áº§u
// console.log(a);   â† undefined
// a = 10;           â† Assignment stays in place
// console.log(a);   â† 10

// â”€â”€ let/const: Hoisted nhÆ°ng KHÃ”NG initialized (TDZ) â”€â”€
// let PHáº¢I khai bÃ¡o trÆ°á»›c má»›i Ä‘Æ°á»£c sá»­ dá»¥ng

// console.log(b);   // âŒ ReferenceError: Cannot access 'b' before initialization
let b = 20;

// console.log(c);   // âŒ ReferenceError: Cannot access 'c' before initialization
const c = 30;
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HOISTING COMPARISON                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Code:     console.log(x);  // What happens?                    â”‚
â”‚            [var/let/const] x = 10;                               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Keyword    â”‚  Hoisted?          â”‚  Result                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  var        â”‚  âœ… Yes + init     â”‚  undefined               â”‚ â”‚
â”‚  â”‚  let        â”‚  âœ… Yes (no init)  â”‚  âŒ ReferenceError (TDZ) â”‚ â”‚
â”‚  â”‚  const      â”‚  âœ… Yes (no init)  â”‚  âŒ ReferenceError (TDZ) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ TDZ = Temporal Dead Zone (vÃ¹ng cháº¿t táº¡m thá»i)               â”‚
â”‚     Khoáº£ng thá»i gian tá»« Ä‘áº§u block Ä‘áº¿n lÃºc biáº¿n Ä‘Æ°á»£c khai bÃ¡o    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Deep Dive: V8 Engine Xá»­ LÃ½ Hoisting NhÆ° Tháº¿ NÃ o â€” Bytecode Level

Äá»ƒ thá»±c sá»± hiá»ƒu hoisting, chÃºng ta cáº§n nhÃ¬n sÃ¢u hÆ¡n bá» máº·t â€” vÃ o **bytecode** mÃ  V8 táº¡o ra. Khi V8 nháº­n code JavaScript, nÃ³ Ä‘i qua pipeline: **Source Code â†’ Parser (AST) â†’ Ignition (Bytecode) â†’ TurboFan (Machine Code)**. Hoisting xáº£y ra á»Ÿ **parsing phase**, khi engine xÃ¢y dá»±ng AST (Abstract Syntax Tree).

Khi parser gáº·p `var x = 10`, nÃ³ táº¡o **hai nodes riÃªng biá»‡t** trong AST:

1. **VariableDeclaration** (`var x`) â†’ Ä‘Æ°a lÃªn Ä‘áº§u scope
2. **AssignmentExpression** (`x = 10`) â†’ giá»¯ nguyÃªn vá»‹ trÃ­

Khi parser gáº·p `let y = 20`, nÃ³ cÅ©ng táº¡o hai nodes tÆ°Æ¡ng tá»±, nhÆ°ng thÃªm metadata **"requires TDZ check"** vÃ o VariableDeclaration. Má»—i láº§n truy cáº­p `y`, Ignition compiler sáº½ emit bytecode `ThrowReferenceErrorIfHole` â€” kiá»ƒm tra xem biáº¿n Ä‘Ã£ Ä‘Æ°á»£c initialized chÆ°a. Náº¿u váº«n lÃ  "hole" (giÃ¡ trá»‹ Ä‘áº·c biá»‡t Ä‘Ã¡nh dáº¥u uninitialized), throw ReferenceError.

Äiá»u thÃº vá»‹: TDZ check cÃ³ **chi phÃ­ performance** â€” má»—i láº§n truy cáº­p `let`/`const` variable, engine pháº£i kiá»ƒm tra xem nÃ³ cÃ³ pháº£i hole khÃ´ng. Tuy nhiÃªn, TurboFan (optimizing compiler) thÃ´ng minh hÆ¡n: náº¿u nÃ³ chá»©ng minh Ä‘Æ°á»£c ráº±ng má»™t biáº¿n **luÃ´n Ä‘Æ°á»£c initialized** trÆ°á»›c khi truy cáº­p (phÃ¢n tÃ­ch static), nÃ³ sáº½ **loáº¡i bá» TDZ checks** trong optimized code. ÄÃ¢y lÃ  lÃ½ do táº¡i sao trong production, `let`/`const` performance **gáº§n nhÆ° báº±ng** `var`.

Má»™t Ä‘iá»ƒm Ã­t ai biáº¿t: **function declarations** cÅ©ng hoisted, nhÆ°ng khÃ¡c `var` â€” cáº£ **declaration láº«n definition** Ä‘á»u Ä‘Æ°á»£c hoist. NghÄ©a lÃ  báº¡n cÃ³ thá»ƒ gá»i function trÆ°á»›c khi khai bÃ¡o:

```javascript
// Function declaration: cáº£ name + body Ä‘á»u hoisted
greet(); // âœ… "Hello!" â€” function body Ä‘Ã£ sáºµn sÃ ng
function greet() {
  console.log("Hello!");
}

// Function expression vá»›i var: chá»‰ var hoisted, body KHÃ”NG
try {
  sayHi();
} catch (e) {
  console.log(e);
}
// TypeError: sayHi is not a function (vÃ¬ sayHi = undefined táº¡i thá»i Ä‘iá»ƒm nÃ y)
var sayHi = function () {
  console.log("Hi!");
};

// Function expression vá»›i const: TDZ â€” khÃ´ng thá»ƒ gá»i trÆ°á»›c declaration
// sayBye(); // âŒ ReferenceError: Cannot access 'sayBye' before initialization
const sayBye = () => console.log("Bye!");
sayBye(); // âœ… "Bye!" â€” sau declaration thÃ¬ OK
```

ÄÃ¢y lÃ  lÃ½ do nhiá»u style guides khuyáº¿n khÃ­ch dÃ¹ng **function declarations** cho "named functions" (Ä‘Æ°á»£c hoist, dá»… debug) vÃ  **const arrow functions** cho callbacks/helpers (khÃ´ng hoist, nhÆ°ng Ã½ nghÄ©a rÃµ rÃ ng hÆ¡n). Cáº£ hai approaches Ä‘á»u valid â€” quan trá»ng lÃ  **nháº¥t quÃ¡n** trong codebase.

### 3. Temporal Dead Zone (TDZ) â€” Chi Tiáº¿t

TDZ lÃ  **vÃ¹ng cháº¿t táº¡m thá»i** â€” khoáº£ng thá»i gian mÃ  biáº¿n Ä‘Ã£ Ä‘Æ°á»£c engine "biáº¿t" (vÃ¬ hoisting) nhÆ°ng chÆ°a Ä‘Æ°á»£c phÃ©p truy cáº­p (vÃ¬ chÆ°a Ä‘áº¿n dÃ²ng khai bÃ¡o). ÄÃ¢y lÃ  má»™t trong nhá»¯ng thiáº¿t káº¿ hay nháº¥t cá»§a ES6: nÃ³ biáº¿n nhá»¯ng bugs "tháº§m láº·ng" (var tráº£ vá» `undefined` mÃ  khÃ´ng ai biáº¿t) thÃ nh **errors rÃµ rÃ ng** (`ReferenceError`), tuÃ¢n theo nguyÃªn táº¯c **"fail fast, fail loud"** trong software engineering.

Äiá»ƒm tinh táº¿ nháº¥t: TDZ Ã¡p dá»¥ng dá»±a trÃªn **thá»i gian thá»±c thi** (temporal), khÃ´ng pháº£i **vá»‹ trÃ­ váº­t lÃ½** trong code. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  ngay cáº£ `typeof` â€” operator thÆ°á»ng "an toÃ n" vá»›i undeclared variables â€” cÅ©ng throw error khi biáº¿n Ä‘ang trong TDZ. ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t quan trá»ng so vá»›i undeclared variables: undeclared â†’ `typeof` tráº£ vá» `"undefined"`, nhÆ°ng TDZ â†’ `typeof` throw `ReferenceError`.

Trong phá»ng váº¥n, TDZ thÆ°á»ng xuáº¥t hiá»‡n á»Ÿ cÃ¡c cÃ¢u há»i vá» **default parameters** â€” vÃ¬ parameters cÅ©ng cÃ³ TDZ riÃªng, vÃ  thá»© tá»± khai bÃ¡o parameters quyáº¿t Ä‘á»‹nh liá»‡u báº¡n cÃ³ thá»ƒ tham chiáº¿u láº«n nhau hay khÃ´ng.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TEMPORAL DEAD ZONE EXPLAINED                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  {                                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€ TDZ for 'x' starts here â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚                                                          â”‚  â”‚
â”‚    â”‚  // Báº¥t ká»³ access nÃ o Ä‘áº¿n 'x' á»Ÿ Ä‘Ã¢y â†’ ReferenceError    â”‚  â”‚
â”‚    â”‚  // console.log(x);  âŒ ReferenceError                   â”‚  â”‚
â”‚    â”‚  // x = 5;           âŒ ReferenceError                   â”‚  â”‚
â”‚    â”‚  // typeof x;        âŒ ReferenceError                   â”‚  â”‚
â”‚    â”‚                                                          â”‚  â”‚
â”‚    â””â”€â”€â”€â”€ TDZ for 'x' ends â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    let x = 10;    // â† Declaration â€” TDZ káº¿t thÃºc táº¡i Ä‘Ã¢y      â”‚
â”‚    console.log(x); // 10 âœ…                                     â”‚
â”‚  }                                                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// âš ï¸ TDZ lÃ  browser bug feature: typeof vá»›i undeclared variable
// Khi kiá»ƒm tra typeof cá»§a biáº¿n chÆ°a khai bÃ¡o, KHÃ”NG throw error mÃ  tráº£ vá» undefined

console.log(typeof undeclaredVar); // "undefined" (khÃ´ng lá»—i!)

// NhÆ°ng vá»›i let/const trong TDZ:
// console.log(typeof a);  // âŒ ReferenceError: Cannot access 'a' before initialization
// let a;                  // let khÃ´ng cho phÃ©p sá»­ dá»¥ng trÆ°á»›c khi khai bÃ¡o

// TDZ trong function scope
function example() {
  console.log(typeof value); // âŒ ReferenceError (TDZ)
  let value = "hello";
}

// TDZ vá»›i default parameters
function fn(a = b, b = 1) {
  // a = b â†’ ReferenceError vÃ¬ b Ä‘ang trong TDZ táº¡i thá»i Ä‘iá»ƒm a Ä‘Æ°á»£c evaluate
}
// fn();  // âŒ ReferenceError

function fn2(a = 1, b = a) {
  console.log(a, b); // 1, 1 âœ… (a Ä‘Ã£ Ä‘Æ°á»£c khai bÃ¡o trÆ°á»›c b)
}
fn2();
```

#### Deep Dive: Debug TDZ Trong Thá»±c Táº¿ â€” Nhá»¯ng Lá»—i MÃ  Console KhÃ´ng NÃ³i RÃµ

TDZ error message cá»§a V8 lÃ  `"Cannot access 'x' before initialization"` â€” nhÆ°ng trong production, báº¡n thÆ°á»ng khÃ´ng biáº¿t **biáº¿n nÃ o** vÃ  **á»Ÿ dÃ²ng nÃ o** gÃ¢y ra lá»—i. ÄÃ¢y lÃ  3 pattern TDZ phá»• biáº¿n nháº¥t vÃ  cÃ¡ch debug chÃºng:

**Pattern 1: Circular Dependencies trong ES Modules.** Khi module A import module B vÃ  ngÆ°á»£c láº¡i, cÃ³ thá»ƒ xáº£y ra tÃ¬nh huá»‘ng má»™t `const` export chÆ°a Ä‘Æ°á»£c initialized táº¡i thá»i Ä‘iá»ƒm module kia truy cáº­p. Error message sáº½ lÃ  TDZ violation, nhÆ°ng root cause lÃ  **circular import order**. Fix: refactor Ä‘á»ƒ loáº¡i bá» circular dependency, hoáº·c dÃ¹ng lazy initialization.

```javascript
// moduleA.js
import { b } from "./moduleB.js";
export const a = b + 1; // âœ… Náº¿u moduleB initialize trÆ°á»›c

// moduleB.js
import { a } from "./moduleA.js";
export const b = a + 1; // âŒ TDZ! a chÆ°a initialized khi moduleB cháº¡y
```

**Pattern 2: Class field initializers tham chiáº¿u láº«n nhau.** Trong ES2022 class fields, thá»© tá»± khai bÃ¡o quyáº¿t Ä‘á»‹nh TDZ:

```javascript
class Config {
  // timeout = this.maxRetries * 1000; // âŒ TDZ! maxRetries chÆ°a declared
  maxRetries = 3;
  timeout = this.maxRetries * 1000; // âœ… maxRetries Ä‘Ã£ initialized
}
```

**Pattern 3: Destructuring vá»›i default values.** Má»™t trap tinh táº¿: default value expression Ä‘Æ°á»£c evaluate **lazily** (chá»‰ khi cáº§n), nhÆ°ng TDZ váº«n Ã¡p dá»¥ng:

```javascript
// const { x = y, y = 1 } = {};  // âŒ TDZ! y chÆ°a initialized khi evaluate default cá»§a x
const { y = 1, x = y } = {}; // âœ… y = 1, x = 1 (y Ä‘Ã£ initialized)
```

Máº¹o debug TDZ nhanh: khi gáº·p `ReferenceError: Cannot access '...' before initialization`, hÃ£y tÃ¬m biáº¿n Ä‘Ã³ vÃ  kiá»ƒm tra **báº¥t ká»³ code nÃ o cháº¡y trÆ°á»›c dÃ²ng khai bÃ¡o** â€” bao gá»“m closures, callbacks, vÃ  Ä‘áº·c biá»‡t lÃ  **import order** trong module system.

### 4. Re-declaration (Khai BÃ¡o Láº¡i)

Viá»‡c `var` cho phÃ©p **khai bÃ¡o láº¡i cÃ¹ng má»™t biáº¿n** trong cÃ¹ng scope mÃ  khÃ´ng lá»—i nghe cÃ³ váº» vÃ´ háº¡i, nhÆ°ng Ä‘Ã¢y thá»±c sá»± lÃ  nguá»“n gá»‘c cá»§a nhiá»u bugs nghiÃªm trá»ng trong codebase lá»›n. TÆ°á»Ÿng tÆ°á»£ng báº¡n cÃ³ file 500 dÃ²ng, á»Ÿ dÃ²ng 50 khai bÃ¡o `var config = getConfig()`, rá»“i á»Ÿ dÃ²ng 400 quÃªn máº¥t vÃ  khai bÃ¡o `var config = {}` â€” chÆ°Æ¡ng trÃ¬nh cháº¡y bÃ¬nh thÆ°á»ng, khÃ´ng error, nhÆ°ng config gá»‘c bá»‹ **ghi Ä‘Ã¨ Ã¢m tháº§m**. Bug kiá»ƒu nÃ y cÃ³ thá»ƒ máº¥t hÃ ng giá» Ä‘á»ƒ debug.

`let`/`const` ngÄƒn cháº·n Ä‘iá»u nÃ y báº±ng `SyntaxError` táº¡i **compile time** â€” nghÄ©a lÃ  báº¡n biáº¿t lá»—i ngay khi viáº¿t code, trÆ°á»›c khi chÆ°Æ¡ng trÃ¬nh cháº¡y. Tuy nhiÃªn, Ä‘iá»u quan trá»ng lÃ  re-declaration bá»‹ cáº¥m **trong cÃ¹ng scope** â€” náº¿u á»Ÿ scope khÃ¡c (nested blocks), báº¡n hoÃ n toÃ n cÃ³ thá»ƒ khai bÃ¡o cÃ¹ng tÃªn, vÃ  biáº¿n má»›i sáº½ **shadow** (che khuáº¥t) biáº¿n bÃªn ngoÃ i.

```javascript
// â”€â”€ var: Cho phÃ©p khai bÃ¡o láº¡i cÃ¹ng biáº¿n trong cÃ¹ng scope â”€â”€
var x = 1;
var x = 2; // âœ… OK, khÃ´ng lá»—i
console.log(x); // 2

// â”€â”€ let/const: KHÃ”NG cho phÃ©p khai bÃ¡o láº¡i trong cÃ¹ng scope â”€â”€
let y = 1;
// let y = 2;     // âŒ SyntaxError: Identifier 'y' has already been declared

const z = 1;
// const z = 2;   // âŒ SyntaxError: Identifier 'z' has already been declared

// NhÆ°ng KHÃC scope thÃ¬ OK:
let a = 1;
{
  let a = 2; // âœ… OK â€” khÃ¡c block scope
  console.log(a); // 2
}
console.log(a); // 1
```

### 5. Global Object Mapping

ÄÃ¢y lÃ  má»™t behavior "ngáº¡c nhiÃªn" cá»§a `var` mÃ  Ã­t developer Ä‘á»ƒ Ã½: khi báº¡n khai bÃ¡o `var` á»Ÿ **global scope** (ngoÃ i má»i function), biáº¿n Ä‘Ã³ tá»± Ä‘á»™ng trá»Ÿ thÃ nh **property cá»§a `window` object** (browser) hoáº·c `global` (Node.js). Äiá»u nÃ y táº¡o ra **namespace pollution** â€” báº¥t ká»³ script nÃ o trÃªn page Ä‘á»u cÃ³ thá»ƒ Ä‘á»c/ghi Ä‘Ã¨ biáº¿n cá»§a báº¡n, vÃ  ngÆ°á»£c láº¡i.

`let`/`const` á»Ÿ global scope thÃ¬ náº±m trong má»™t **Script scope** riÃªng biá»‡t â€” khÃ´ng pháº£i property cá»§a `window`. ÄÃ¢y lÃ  lÃ½ do táº¡i sao trong V8 engine, global scope thá»±c sá»± cÃ³ **hai environment records**: (1) **Object Environment Record** chá»©a `var` declarations vÃ  function declarations (mapped to global object), (2) **Declarative Environment Record** chá»©a `let`/`const` declarations (isolated). Thiáº¿t káº¿ nÃ y giÃºp `let`/`const` vá»«a lÃ  global variable vá»«a **khÃ´ng gÃ¢y xung Ä‘á»™t** vá»›i cÃ¡c scripts khÃ¡c.

```javascript
// â”€â”€ var: Táº¡o mapping vá»›i global object (window) â”€â”€
var globalVar = "hello";
console.log(window.globalVar); // "hello" âœ… (mapped to window)

// â”€â”€ let/const: KHÃ”NG táº¡o mapping vá»›i global object â”€â”€
let globalLet = "world";
console.log(window.globalLet); // undefined âŒ (khÃ´ng cÃ³ trÃªn window)

const globalConst = "!";
console.log(window.globalConst); // undefined âŒ (khÃ´ng cÃ³ trÃªn window)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GLOBAL SCOPE BEHAVIOR                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  var x = 1;       â†’  window.x = 1       â† Creates property     â”‚
â”‚  let y = 2;       â†’  window.y = undefined â† NO property        â”‚
â”‚  const z = 3;     â†’  window.z = undefined â† NO property        â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ let/const biáº¿n toÃ n cá»¥c náº±m trong Script scope              â”‚
â”‚     (chá»© khÃ´ng náº±m trÃªn Global Object window)                   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚     Global Object (window)       â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                           â”‚
â”‚  â”‚  â”‚ var x = 1    âœ… mapped     â”‚  â”‚                           â”‚
â”‚  â”‚  â”‚ function f() âœ… mapped     â”‚  â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚     Script Scope (separate)      â”‚                           â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                           â”‚
â”‚  â”‚  â”‚ let y = 2    âœ… here       â”‚  â”‚                           â”‚
â”‚  â”‚  â”‚ const z = 3  âœ… here       â”‚  â”‚                           â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. Block Scope â€” Thá»±c HÃ nh: Loop Event Binding

ÄÃ¢y lÃ  **bÃ i test kinh Ä‘iá»ƒn nháº¥t** trong má»i cuá»™c phá»ng váº¥n JavaScript â€” vÃ  cÅ©ng lÃ  vÃ­ dá»¥ thá»±c táº¿ nháº¥t cho tháº¥y táº¡i sao `let` thay Ä‘á»•i cuá»™c chÆ¡i. Bug `var` trong loop + `setTimeout` Ä‘Ã£ tá»“n táº¡i suá»‘t **18 nÄƒm** vÃ  sinh ra cáº£ má»™t pattern (IIFE) chá»‰ Ä‘á»ƒ workaround nÃ³.

Báº£n cháº¥t cá»§a bug: `var` lÃ  function-scoped, nÃªn toÃ n bá»™ iterations cá»§a loop **chia sáº» cÃ¹ng má»™t biáº¿n `i`**. Khi `setTimeout` callbacks cháº¡y (asynchronous, sau khi loop káº¿t thÃºc), táº¥t cáº£ Ä‘á»u "nhÃ¬n" vÃ o cÃ¹ng má»™t `i` â€” giÃ¡ trá»‹ cuá»‘i cÃ¹ng. `let` fix báº±ng cÃ¡ch táº¡o **block scope má»›i cho má»—i iteration** â€” má»—i callback "capture" báº£n sao riÃªng cá»§a `i`. Trong V8, má»—i iteration táº¡o má»™t **LexicalEnvironment má»›i** vá»›i binding riÃªng, thay vÃ¬ chia sáº» VariableEnvironment.

```javascript
// âŒ Classic bug vá»›i var trong loop
for (var i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i); // 5, 5, 5, 5, 5  â† Táº¥t cáº£ Ä‘á»u lÃ  5!
  }, 100);
}
// Giáº£i thÃ­ch: var i lÃ  function-scoped
// Khi setTimeout callback cháº¡y, loop Ä‘Ã£ káº¿t thÃºc, i = 5
// Táº¥t cáº£ 5 callbacks Ä‘á»u refer Ä‘áº¿n CÃ™NG Má»˜T biáº¿n i

// âŒ Workaround cÅ©: DÃ¹ng IIFE (closure) Ä‘á»ƒ capture giÃ¡ trá»‹
for (var i = 0; i < 5; i++) {
  (function (j) {
    setTimeout(() => {
      console.log(j); // 0, 1, 2, 3, 4  âœ…
    }, 100);
  })(i); // Pass i vÃ o closure
}

// âœ… Modern: DÃ¹ng let (block scope tá»± táº¡o closure cho má»—i iteration)
for (let i = 0; i < 5; i++) {
  setTimeout(() => {
    console.log(i); // 0, 1, 2, 3, 4  âœ…
  }, 100);
}
// Giáº£i thÃ­ch: let táº¡o block scope Má»šI cho má»—i iteration
// Má»—i callback cÃ³ báº£n copy riÃªng cá»§a i
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WHY let FIXES THE LOOP PROBLEM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  for (var i = 0; i < 3; i++) {                                  â”‚
â”‚    // Chá»‰ cÃ³ 1 biáº¿n i cho toÃ n bá»™ loop                          â”‚
â”‚    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚    // â”‚ i = 0 â†’ i = 1 â†’ i = 2 â†’ i = 3 (káº¿t thÃºc)              â”‚
â”‚    // â”‚ Táº¥t cáº£ callbacks tháº¥y i = 3                             â”‚
â”‚    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚  }                                                               â”‚
â”‚                                                                 â”‚
â”‚  for (let i = 0; i < 3; i++) {                                  â”‚
â”‚    // Má»—i iteration táº¡o block scope Má»šI                         â”‚
â”‚    // â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    // â”‚ scope 1      â”‚  â”‚ scope 2      â”‚  â”‚ scope 3      â”‚    â”‚
â”‚    // â”‚ let i = 0    â”‚  â”‚ let i = 1    â”‚  â”‚ let i = 2    â”‚    â”‚
â”‚    // â”‚ callback â†’ 0 â”‚  â”‚ callback â†’ 1 â”‚  â”‚ callback â†’ 2 â”‚    â”‚
â”‚    // â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  }                                                               â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ let, const, function coi má»—i {} (trá»« function body)         â”‚
â”‚     lÃ  má»™t block context HOÃ€N TOÃ€N Má»šI                           â”‚
â”‚     â†’ DÃ¹ng cÆ¡ cháº¿ nÃ y, khÃ´ng cáº§n xÃ¢y closure thá»§ cÃ´ng           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Deep Dive: Closures Trong React â€” Khi Block Scope Gáº·p Component Lifecycle

Bug `var` trong loop khÃ´ng chá»‰ lÃ  bÃ i test lÃ½ thuyáº¿t â€” nÃ³ pháº£n Ã¡nh má»™t **class of bugs** xuáº¥t hiá»‡n hÃ ng ngÃ y trong React: **stale closures**. Khi báº¡n hiá»ƒu báº£n cháº¥t scope/closure, báº¡n sáº½ hiá»ƒu táº¡i sao `useEffect` cáº§n dependency array, táº¡i sao `useCallback` tá»“n táº¡i, vÃ  táº¡i sao `useRef` Ä‘Ã´i khi lÃ  "escape hatch" cáº§n thiáº¿t.

Trong React, má»—i render táº¡o **má»™t snapshot** cá»§a táº¥t cáº£ variables. Khi báº¡n viáº¿t:

```javascript
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      console.log(count); // âš ï¸ LuÃ´n log giÃ¡ trá»‹ cÅ©!
    }, 1000);
    return () => clearInterval(id);
  }, []); // deps rá»—ng = effect chá»‰ cháº¡y 1 láº§n

  return <button onClick={() => setCount((c) => c + 1)}>{count}</button>;
}
```

ÄÃ¢y chÃ­nh xÃ¡c lÃ  **cÃ¹ng váº¥n Ä‘á»** nhÆ° `var` trong loop! Effect closure "capture" `count = 0` táº¡i render Ä‘áº§u tiÃªn. Khi `count` thay Ä‘á»•i (re-render má»›i), effect cÅ© váº«n giá»¯ reference Ä‘áº¿n **snapshot cÅ©** â€” y há»‡t nhÆ° `setTimeout` callback giá»¯ reference Ä‘áº¿n `var i` cuá»‘i cÃ¹ng.

Fix giá»‘ng nhau vá» báº£n cháº¥t â€” táº¡o **binding má»›i** cho má»—i "iteration" (má»—i render):

```javascript
// Fix 1: ThÃªm count vÃ o deps (tÆ°Æ¡ng tá»± dÃ¹ng let trong loop)
useEffect(() => {
  const id = setInterval(() => console.log(count), 1000);
  return () => clearInterval(id);
}, [count]); // â† Má»—i khi count thay Ä‘á»•i, táº¡o effect Má»šI

// Fix 2: DÃ¹ng useRef (tÆ°Æ¡ng tá»± dÃ¹ng external variable)
const countRef = useRef(count);
countRef.current = count; // LuÃ´n update ref
useEffect(() => {
  const id = setInterval(() => console.log(countRef.current), 1000);
  return () => clearInterval(id);
}, []); // deps rá»—ng OK â€” ref.current luÃ´n lÃ  giÃ¡ trá»‹ má»›i nháº¥t

// Fix 3: DÃ¹ng functional update (tÆ°Æ¡ng tá»± dÃ¹ng callback pattern)
useEffect(() => {
  const id = setInterval(() => {
    setCount((prev) => {
      console.log(prev); // prev luÃ´n lÃ  giÃ¡ trá»‹ má»›i nháº¥t
      return prev;
    });
  }, 1000);
  return () => clearInterval(id);
}, []);
```

Pattern nÃ y láº·p Ä‘i láº·p láº¡i trong React ecosystem:

- **`useMemo`/`useCallback`** = memoized closure, cáº§n deps Ä‘Ãºng Ä‘á»ƒ trÃ¡nh stale values
- **`useRef`** = mutable box, bypass closure capture hoÃ n toÃ n
- **Event handlers** = táº¡o má»›i má»—i render (náº¿u khÃ´ng memoize), nÃªn luÃ´n cÃ³ giÃ¡ trá»‹ má»›i nháº¥t

Hiá»ƒu ráº±ng `var` loop bug vÃ  React stale closure lÃ  **cÃ¹ng má»™t váº¥n Ä‘á»** dÆ°á»›i gÃ³c nhÃ¬n scope/closure sáº½ giÃºp báº¡n debug React nhanh hÆ¡n gáº¥p nhiá»u láº§n â€” vÃ  cÅ©ng lÃ  cÃ¢u tráº£ lá»i "wow" cho interviewer khi há» há»i vá» closures.

### 7. Best Practices

Sau khi hiá»ƒu sÃ¢u má»i khÃ­a cáº¡nh ká»¹ thuáº­t, best practice thá»±c ra **cá»±c ká»³ Ä‘Æ¡n giáº£n**: `const` by default, `let` khi cáº§n reassign, `var` never. Quy táº¯c nÃ y khÃ´ng chá»‰ lÃ  convention â€” nÃ³ táº­n dá»¥ng **static analysis** cá»§a engine: khi V8 tháº¥y `const`, nÃ³ biáº¿t binding nÃ y **khÃ´ng bao giá» thay Ä‘á»•i** â†’ cÃ³ thá»ƒ optimize máº¡nh hÆ¡n (inline giÃ¡ trá»‹, eliminate dead code). `let` cho phÃ©p reassign nÃªn engine pháº£i "giá»¯ slot" cho biáº¿n â†’ Ã­t optimize hÆ¡n.

Trong React ecosystem, `const` cÃ²n quan trá»ng hÆ¡n: má»i component, hook, callback Ä‘á»u nÃªn lÃ  `const` â€” vÃ¬ **referential stability** áº£nh hÆ°á»Ÿng Ä‘áº¿n re-render performance. Náº¿u báº¡n dÃ¹ng `let` cho má»™t callback vÃ  reassign nÃ³, má»i component nháº­n callback Ä‘Ã³ sáº½ re-render khÃ´ng cáº§n thiáº¿t.

```javascript
// âœ… BEST PRACTICES:

// 1. Máº·c Ä‘á»‹nh dÃ¹ng const
const API_URL = "https://api.example.com";
const MAX_RETRIES = 3;
const config = { debug: false }; // Object reference báº¥t biáº¿n

// 2. DÃ¹ng let khi cáº§n reassign
let count = 0;
count++;

let currentUser = null;
currentUser = getUser();

// 3. KHÃ”NG BAO GIá»œ dÃ¹ng var trong code má»›i
// var chá»‰ tá»“n táº¡i vÃ¬ backward compatibility

// 4. Khai bÃ¡o biáº¿n á»Ÿ nÆ¡i sá»­ dá»¥ng (closest scope)
function processItems(items) {
  // âœ… Khai bÃ¡o gáº§n nÆ¡i sá»­ dá»¥ng
  for (const item of items) {
    const processed = transform(item);
    console.log(processed);
  }
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DECISION FLOWCHART: var vs let vs const                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                     Khai bÃ¡o biáº¿n?                               â”‚
â”‚                         â”‚                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚                     â”‚                            â”‚
â”‚              â–¼                     â–¼                            â”‚
â”‚       Cáº§n reassign?          KhÃ´ng reassign                     â”‚
â”‚              â”‚                     â”‚                            â”‚
â”‚              â–¼                     â–¼                            â”‚
â”‚           let âœ…               const âœ…                          â”‚
â”‚                                                                 â”‚
â”‚       âš ï¸ KHÃ”NG BAO GIá»œ dÃ¹ng var trong code má»›i                 â”‚
â”‚                                                                 â”‚
â”‚  Tá»· lá»‡ thá»±c táº¿ trong production code:                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  const: ~80%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚                    â”‚
â”‚  â”‚  let:   ~20%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    â”‚                    â”‚
â”‚  â”‚  var:    ~0%                            â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deep Dive: Tá»« var Äáº¿n const â€” HÃ nh TrÃ¬nh Migration Trong Production

Chuyá»ƒn tá»« `var` sang `let`/`const` nghe cÃ³ váº» Ä‘Æ¡n giáº£n: tÃ¬m vÃ  thay tháº¿. NhÆ°ng trong production codebase vá»›i hÃ ng trÄƒm nghÃ¬n dÃ²ng code, Ä‘Ã¢y lÃ  quÃ¡ trÃ¬nh cáº§n **chiáº¿n lÆ°á»£c cáº©n tháº­n**. DÆ°á»›i Ä‘Ã¢y lÃ  nhá»¯ng bÃ i há»c tá»« cÃ¡c Ä‘á»™i engineering lá»›n (Google, Airbnb, Facebook) khi thá»±c hiá»‡n migration.

**Phase 1: Audit** â€” Cháº¡y ESLint vá»›i `no-var` rule á»Ÿ mode "warn" (khÃ´ng "error") Ä‘á»ƒ Ä‘áº¿m sá»‘ lÆ°á»£ng `var` declarations. Äá»™i Airbnb phÃ¡t hiá»‡n **hÆ¡n 35,000 `var` declarations** trong codebase cá»§a há» khi báº¯t Ä‘áº§u migration nÄƒm 2016.

**Phase 2: Automated codemods** â€” DÃ¹ng tools nhÆ° `jscodeshift` hoáº·c `lebab` Ä‘á»ƒ tá»± Ä‘á»™ng chuyá»ƒn `var â†’ const` (khi khÃ´ng reassign) hoáº·c `var â†’ let` (khi cÃ³ reassign). Tuy nhiÃªn, automated tools **khÃ´ng thá»ƒ xá»­ lÃ½** má»™t sá»‘ edge cases:

```javascript
// Edge case 1: var hoisting across blocks
function processOrders(orders) {
  for (var i = 0; i < orders.length; i++) {
    // ... process ...
  }
  console.log(`Processed ${i} orders`); // âœ… vá»›i var (i = orders.length)
  // âŒ vá»›i let: ReferenceError (i chá»‰ tá»“n táº¡i trong for block)
}

// Edge case 2: var trong switch/case
function getLabel(type) {
  switch (type) {
    case "A":
      var label = "Alpha"; // var hoisted ra khá»i switch
      break;
    case "B":
      label = "Beta"; // DÃ¹ng láº¡i var tá»« case 'A'
      break;
  }
  return label; // âœ… vá»›i var, âŒ vá»›i let
}

// Edge case 3: Multiple var declarations cÃ¹ng tÃªn
var config = getDefaultConfig();
if (isProduction) {
  var config = getProductionConfig(); // var cho phÃ©p re-declare
}
// let sáº½ throw SyntaxError â€” pháº£i rewrite logic
```

**Phase 3: Manual review** â€” Má»—i automated change cáº§n code review. CÃ¡c bugs phá»• biáº¿n sau migration:

- **Scope narrowing**: biáº¿n khÃ´ng cÃ²n accessible á»Ÿ nÆ¡i cÅ© â†’ runtime errors
- **TDZ violations**: code phá»¥ thuá»™c vÃ o hoisting behavior â†’ ReferenceError
- **Test failures**: tests mock/spy vÃ o global vars (`window.someVar`) khÃ´ng cÃ²n hoáº¡t Ä‘á»™ng

**Phase 4: Gradual rollout** â€” Ãp dá»¥ng `no-var` rule per-directory, báº¯t Ä‘áº§u tá»« leaf modules (Ã­t dependencies) rá»“i tiáº¿n dáº§n Ä‘áº¿n core modules.

BÃ i há»c lá»›n nháº¥t: migration khÃ´ng pháº£i chá»‰ lÃ  **syntax change** â€” nÃ³ lÃ  **semantic change**. `var â†’ let` thay Ä‘á»•i scope. `var â†’ const` thay Ä‘á»•i mutability contract. Má»—i thay Ä‘á»•i cáº§n hiá»ƒu **impact** lÃªn toÃ n bá»™ call graph. ÄÃ¢y lÃ  lÃ½ do táº¡i sao automated tools cÃ³ tá»· lá»‡ thÃ nh cÃ´ng khoáº£ng 85-90% â€” 10-15% cÃ²n láº¡i cáº§n human review.

### PhÃ¢n TÃ­ch SÃ¢u â€” 6 Patterns TÆ° Duy Ãp Dá»¥ng Cho var/let/const

#### Pattern 1: 5 Whys â€” Táº¡i Sao var Váº«n Tá»“n Táº¡i?

ÄÃ¢y lÃ  cÃ¢u há»i mÃ  **má»i JavaScript developer** Ä‘á»u tá»«ng tháº¯c máº¯c: náº¿u `let`/`const` tá»‘t hÆ¡n `var` á»Ÿ má»i máº·t â€” safer, more predictable, better scoped â€” thÃ¬ táº¡i sao TC39 (committee thiáº¿t káº¿ JavaScript) khÃ´ng **loáº¡i bá»** `var` khá»i ngÃ´n ngá»¯? Táº¡i sao khÃ´ng lÃ m nhÆ° Python Ä‘Ã£ lÃ m vá»›i `print` statement â€” deprecated rá»“i xÃ³a luÃ´n?

CÃ¢u tráº£ lá»i **khÃ´ng Ä‘Æ¡n giáº£n** chá»‰ lÃ  "backward compatibility". NÃ³ liÃªn quan Ä‘áº¿n báº£n cháº¥t cá»§a web platform, kiáº¿n trÃºc cá»§a browsers, triáº¿t lÃ½ thiáº¿t káº¿ ngÃ´n ngá»¯, vÃ  tháº­m chÃ­ cáº£ chÃ­nh trá»‹ giá»¯a cÃ¡c browser vendors. HÃ£y Ä‘Ã o sÃ¢u tá»«ng lá»›p báº±ng phÆ°Æ¡ng phÃ¡p **5 Whys** â€” ká»¹ thuáº­t root cause analysis ná»•i tiáº¿ng tá»« Toyota Production System.

```
WHY 1: Táº¡i sao khÃ´ng xÃ³a var?
  â†’ Backward compatibility â€” tá»· lá»‡ websites dÃ¹ng var ~ 99%
WHY 2: Táº¡i sao backward compatibility quan trá»ng?
  â†’ "Don't break the web" â€” web platform pháº£i cháº¡y code tá»« 1995
WHY 3: Táº¡i sao web platform khÃ¡c vá»›i native apps?
  â†’ Users khÃ´ng "update" websites â€” browser pháº£i cháº¡y Má»ŒI code
WHY 4: Táº¡i sao khÃ´ng deprecate dáº§n?
  â†’ KhÃ´ng cÃ³ cÆ¡ cháº¿ "version" cho JavaScript trÃªn web
WHY 5: Váº­y giáº£i phÃ¡p lÃ  gÃ¬?
  â†’ ThÃªm let/const Má»šI, giá»¯ var CÅ¨, dÃ¹ng tooling (ESLint) Ä‘á»ƒ enforce
```

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Giáº£i thÃ­ch Cá»°C Ká»² chi tiáº¿t tá»«ng WHY:**

---

**WHY 1: Táº¡i sao khÃ´ng xÃ³a `var`? â€” Quy MÃ´ Thá»±c Sá»± Cá»§a Váº¥n Äá»**

HÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n lÃ  thÃ nh viÃªn TC39 â€” committee gá»“m ~30 engineers tá»« Google (V8), Mozilla (SpiderMonkey), Apple (JavaScriptCore), Microsoft (Chakra/V8), vÃ  cÃ¡c tá»• chá»©c khÃ¡c. Báº¡n Ä‘á»©ng dáº­y trong cuá»™c há»p vÃ  Ä‘á» xuáº¥t: "ChÃºng ta nÃªn xÃ³a `var` khá»i JavaScript". Äiá»u gÃ¬ sáº½ xáº£y ra?

CÃ¢u tráº£ lá»i: **hÃ ng tá»· websites sáº½ ngá»«ng hoáº¡t Ä‘á»™ng ngay láº­p tá»©c**.

HÃ£y phÃ¢n tÃ­ch quy mÃ´ báº±ng sá»‘ liá»‡u cá»¥ thá»ƒ. Theo thá»‘ng kÃª tá»« HTTP Archive (dá»± Ã¡n crawl vÃ  scan toÃ n bá»™ web), tÃ­nh Ä‘áº¿n 2024:

- Khoáº£ng **97-99% websites** cÃ³ Ã­t nháº¥t má»™t dÃ²ng code sá»­ dá»¥ng `var`
- RiÃªng jQuery â€” má»™t thÆ° viá»‡n duy nháº¥t â€” Ä‘Æ°á»£c **77% trong top 10 triá»‡u websites** sá»­ dá»¥ng, vÃ  jQuery source code chá»©a hÃ ng nghÃ¬n `var` declarations
- Lodash, Bootstrap JS, Backbone, Underscore â€” táº¥t cáº£ cÃ¡c thÆ° viá»‡n legacy phá»• biáº¿n â€” Ä‘á»u Ä‘Æ°á»£c distribute vá»›i `var` trong source code Ä‘Ã£ minified
- Google Analytics snippet (gtag.js) â€” inject vÃ o **~55 triá»‡u websites** â€” sá»­ dá»¥ng `var` trong nhiá»u versions

Khi browser loáº¡i bá» `var`, má»i `<script>` tag chá»©a `var` sáº½ throw `SyntaxError`. NhÆ°ng váº¥n Ä‘á» **nghiÃªm trá»ng hÆ¡n** báº¡n nghÄ© â€” khÃ´ng chá»‰ script chá»©a `var` bá»‹ lá»—i, mÃ  **toÃ n bá»™ script Ä‘Ã³** ngá»«ng execute. JavaScript parsing lÃ  **all-or-nothing**: náº¿u parser gáº·p syntax error á»Ÿ dÃ²ng 5, nÃ³ khÃ´ng cháº¡y dÃ²ng 1-4 rá»“i bá» qua dÃ²ng 5. NÃ³ **throw error vÃ  dá»«ng toÃ n bá»™ script**. NghÄ©a lÃ  má»™t file `bundle.js` 500KB chá»©a 10,000 dÃ²ng code â€” chá»‰ cáº§n 1 dÃ²ng dÃ¹ng `var` â€” toÃ n bá»™ 10,000 dÃ²ng khÃ´ng cháº¡y. Website **cháº¿t tráº¯ng**.

```javascript
// HÃ£y tÆ°á»Ÿng tÆ°á»£ng browser loáº¡i bá» 'var'...
// File: legacy-app.js (500KB, 10,000 lines)

var config = { api: "/v1" }; // â† SyntaxError táº¡i dÃ²ng 1!
// ... 9,999 dÃ²ng code khÃ¡c KHÃ”NG BAO GIá»œ ÄÆ¯á»¢C CHáº Y ...
// ToÃ n bá»™ app cháº¿t. User tháº¥y trang tráº¯ng.
```

**Case study thá»±c táº¿ â€” document.all:**

ÄÃ¢y khÃ´ng pháº£i lÃ½ thuyáº¿t. Má»™t vÃ­ dá»¥ ná»•i tiáº¿ng: `document.all` â€” API tá»« Internet Explorer 4 (1997), khÃ´ng theo chuáº©n W3C, nhÆ°ng Ä‘Æ°á»£c hÃ ng triá»‡u websites sá»­ dá»¥ng Ä‘á»ƒ detect IE. Khi cÃ¡c browser khÃ¡c cá»‘ **loáº¡i bá»** `document.all`, hÃ ng triá»‡u websites break â€” bao gá»“m websites ngÃ¢n hÃ ng táº¡i Nháº­t Báº£n, há»‡ thá»‘ng chÃ­nh phá»§ táº¡i HÃ n Quá»‘c, vÃ  portals ná»™i bá»™ doanh nghiá»‡p táº¡i Äá»©c. Browsers pháº£i revert.

Giáº£i phÃ¡p cuá»‘i cÃ¹ng? TC39 táº¡o ra má»™t spec Ä‘áº·c biá»‡t: `document.all` trá»Ÿ thÃ nh **"falsy object"** duy nháº¥t trong JavaScript â€” `typeof document.all === "undefined"` nhÆ°ng `document.all` váº«n tá»“n táº¡i. ÄÃ¢y lÃ  hack cá»±c ká»³ ká»³ láº¡, nhÆ°ng cáº§n thiáº¿t Ä‘á»ƒ duy trÃ¬ backward compatibility. Spec gá»i nÃ³ lÃ  **[[IsHTMLDDA]]** internal slot â€” tá»“n táº¡i **chá»‰ vÃ¬** khÃ´ng thá»ƒ xÃ³a `document.all`.

```javascript
// document.all â€” "falsy object" duy nháº¥t trong JavaScript
typeof document.all; // â†’ "undefined" (!!!)
document.all; // â†’ HTMLAllCollection (váº«n tá»“n táº¡i)
if (document.all) {
  /* KHÃ”NG cháº¡y vÃ o Ä‘Ã¢y */
} // falsy!
Boolean(document.all); // â†’ false

// Táº¡i sao? VÃ¬ code cÅ© viáº¿t:
// if (document.all) { /* IE-specific code */ }
// Code nÃ y PHáº¢I tiáº¿p tá»¥c "skip" IE-specific code trÃªn non-IE browsers
// NÃªn document.all pháº£i lÃ  falsy, nhÆ°ng váº«n tá»“n táº¡i Ä‘á»ƒ .all[0] khÃ´ng throw
```

**Case study thá»±c táº¿ â€” SmooshGate (2018):**

Má»™t vÃ­ dá»¥ khÃ¡c cÃ²n ná»•i tiáº¿ng hÆ¡n: **SmooshGate**. TC39 muá»‘n thÃªm method `Array.prototype.flatten()` vÃ o JavaScript. Váº¥n Ä‘á»? ThÆ° viá»‡n MooTools (phá»• biáº¿n nÄƒm 2006-2012) Ä‘Ã£ **monkey-patch** `Array.prototype.flatten` vá»›i behavior khÃ¡c. Náº¿u TC39 thÃªm `flatten()` native, má»i website dÃ¹ng MooTools sáº½ break vÃ¬ native method **override** monkey-patched method, vÃ  behavior khÃ¡c nhau.

Giáº£i phÃ¡p? TC39 **Ä‘á»•i tÃªn** method tá»« `flatten` thÃ nh `flat`. ÄÃºng váº­y â€” TC39 **thay Ä‘á»•i tÃªn** cá»§a má»™t standard method chá»‰ vÃ¬ má»™t thÆ° viá»‡n cÅ© mÃ  háº§u nhÆ° khÃ´ng ai dÃ¹ng ná»¯a. ÄÃ¢y lÃ  má»©c Ä‘á»™ nghiÃªm tÃºc cá»§a "Don't Break the Web":

```javascript
// TC39 muá»‘n:
[1, [2, 3]].flatten(); // â†’ [1, 2, 3]

// NhÆ°ng MooTools Ä‘Ã£ Ä‘á»‹nh nghÄ©a:
Array.prototype.flatten = function () {
  /* behavior KHÃC */
}[
  // Káº¿t quáº£: TC39 pháº£i Ä‘á»•i tÃªn thÃ nh .flat()
  (1, [2, 3])
].flat(); // â†’ [1, 2, 3]  â† Ä‘Ã¢y lÃ  tÃªn chÃ­nh thá»©c

// Má»™t thÆ° viá»‡n cÅ© Ä‘Ã£ Ã©p TC39 Ä‘á»•i tÃªn má»™t standard method.
// ÄÃ³ lÃ  sá»©c máº¡nh (vÃ  gÃ¡nh náº·ng) cá»§a backward compatibility.
```

Náº¿u TC39 khÃ´ng dÃ¡m Ä‘á»•i tÃªn Má»˜T method vÃ¬ sá»£ break websites, báº¡n nghÄ© há» cÃ³ dÃ¡m **xÃ³a toÃ n bá»™ `var` keyword** khÃ´ng? CÃ¢u tráº£ lá»i rÃµ rÃ ng: **KHÃ”NG BAO GIá»œ**.

**Káº¿t luáº­n WHY 1**: XÃ³a `var` = phÃ¡ vá»¡ ~99% websites. JavaScript fundamentally khÃ´ng thá»ƒ xÃ³a báº¥t ká»³ feature nÃ o â€” ngay cáº£ `document.all` (API tá»« 1997) váº«n tá»“n táº¡i. Tháº­m chÃ­ Ä‘á»•i **tÃªn** method cÅ©ng gÃ¢y ra cáº£ vá»¥ drama (SmooshGate). `var` sáº½ tá»“n táº¡i **mÃ£i mÃ£i** trong JavaScript.

---

**WHY 2: Táº¡i sao backward compatibility quan trá»ng Ä‘áº¿n váº­y? â€” "Don't Break the Web" Contract**

VÃ¬ web platform cÃ³ má»™t **social contract** ngáº§m: **"Don't Break the Web"**. Contract nÃ y khÃ´ng há» Ä‘Æ°á»£c viáº¿t ra trÃªn giáº¥y tá» phÃ¡p lÃ½ nÃ o, nhÆ°ng nÃ³ máº¡nh hÆ¡n báº¥t ká»³ há»£p Ä‘á»“ng nÃ o â€” vÃ¬ má»i browser vendor Ä‘á»u tuÃ¢n thá»§ **tuyá»‡t Ä‘á»‘i**. Vi pháº¡m nÃ³ = máº¥t users = máº¥t thá»‹ pháº§n = máº¥t doanh thu.

NÃ³ cÃ³ nghÄ©a cá»¥ thá»ƒ: **báº¥t ká»³ website nÃ o tá»«ng hoáº¡t Ä‘á»™ng trÃªn browser, pháº£i tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng trÃªn má»i phiÃªn báº£n browser trong tÆ°Æ¡ng lai, vÄ©nh viá»…n**. Chrome 130 pháº£i cháº¡y code viáº¿t cho Netscape Navigator 2.0 (1995). ÄÃ¢y khÃ´ng pháº£i phÃ³ng Ä‘áº¡i â€” `alert("hello")`, `var x = 1`, `document.write()` â€” táº¥t cáº£ váº«n hoáº¡t Ä‘á»™ng trÃªn Chrome 2025 y há»‡t nhÆ° trÃªn Netscape 1995.

**Táº¡i sao contract nÃ y tá»“n táº¡i?**

VÃ¬ web lÃ  **platform duy nháº¥t** mÃ  users khÃ´ng cÃ³ quyá»n chá»n version runtime. HÃ£y tÆ°á»Ÿng tÆ°á»£ng 3 scenarios:

**Scenario 1 â€” iOS app**: Báº¡n viáº¿t app Swift cho iOS 18. Apple deprecate má»™t API trong iOS 19. Báº¡n update code, publish version 2.0. Users update app trÃªn App Store. Náº¿u users khÃ´ng update, app 1.0 váº«n cháº¡y trÃªn iOS 18. Developer **kiá»ƒm soÃ¡t** version nÃ o users cháº¡y.

**Scenario 2 â€” Python server**: Team báº¡n dÃ¹ng Python 3.9. Python 3.12 xÃ³a `asyncio.coroutine`. DevOps update server lÃªn Python 3.12, team fix code. **Team kiá»ƒm soÃ¡t** runtime environment.

**Scenario 3 â€” Website**: Báº¡n viáº¿t website nÄƒm 2010 dÃ¹ng jQuery + `var` everywhere. BÃ¢y giá» lÃ  2025. Báº¡n Ä‘Ã£ nghá»‰ viá»‡c khá»i cÃ´ng ty Ä‘Ã³. CÃ´ng ty Ä‘Ã£ phÃ¡ sáº£n. Domain háº¿t háº¡n, nhÆ°ng ai Ä‘Ã³ mua láº¡i domain vÃ  host files cÅ©. Users visit website â†’ browser **PHáº¢I** cháº¡y code tá»« 2010. KhÃ´ng ai maintain code. KhÃ´ng ai sáº½ "update" code. Náº¿u Chrome 2025 khÃ´ng hiá»ƒu `var`, website cháº¿t. VÃ  khÃ´ng ai fix Ä‘Æ°á»£c.

ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t fundamental: web code Ä‘Æ°á»£c **deploy má»™t láº§n vÃ  cháº¡y mÃ£i mÃ£i**. KhÃ´ng cÃ³ cÆ¡ cháº¿ recall, khÃ´ng cÃ³ forced update, khÃ´ng cÃ³ deprecation notice mÃ  ai Ä‘Ã³ sáº½ Ä‘á»c.

**Báº±ng chá»©ng lá»‹ch sá»­ â€” Python 2 â†’ 3 Migration:**

So sÃ¡nh thá»±c táº¿ Ä‘á»ƒ tháº¥y háº­u quáº£ khi phÃ¡ vá»¡ backward compatibility:

- **2008**: Python 3.0 release, phÃ¡ vá»¡ backward compatibility hoÃ n toÃ n
- `print "hello"` â†’ `print("hello")` (statement thÃ nh function)
- `5 / 2` â†’ tá»« `2` (integer division) thÃ nh `2.5` (true division)
- `str` vs `bytes` vs `unicode` â€” **thay Ä‘á»•i lá»›n nháº¥t**, string handling khÃ¡c hoÃ n toÃ n
- `dict.keys()` tráº£ view thay vÃ¬ list
- `range()` trá»Ÿ thÃ nh lazy (Python 2 `xrange()` behavior)
- **2010**: Python 2.7 release â€” "phiÃªn báº£n cuá»‘i cÃ¹ng" cá»§a Python 2, nhÆ°ng khÃ´ng ai migrate
- **2015**: Chá»‰ ~30% packages trÃªn PyPI support Python 3
- **2018**: Nhiá»u tá»• chá»©c lá»›n (Instagram, Pinterest, Dropbox) má»›i báº¯t Ä‘áº§u migrate nghiÃªm tÃºc
- **2020**: Python 2 chÃ­nh thá»©c "sunset" â€” 12 nÄƒm sau Python 3 release!
- **2025**: Nhiá»u legacy systems táº¡i ngÃ¢n hÃ ng, viá»‡n nghiÃªn cá»©u, chÃ­nh phá»§ **VáºªN** cháº¡y Python 2 vÃ¬:
  - Chi phÃ­ migration quÃ¡ lá»›n (hÃ ng triá»‡u dÃ²ng code)
  - KhÃ´ng Ä‘á»§ nhÃ¢n lá»±c (developers Python 2 khÃ´ng muá»‘n quay láº¡i)
  - Rá»§i ro quÃ¡ cao (code Ä‘ang cháº¡y á»•n, Ä‘á»•i = cÃ³ thá»ƒ break)

```
TIMELINE â€” Python 2 â†’ 3 Migration:

2008: Python 3 release â”€â”€â”€â”€â”€â”
     Backward compatibility  â”‚
     PHÃ Vá»  hoÃ n toÃ n        â”‚
                              â”‚  12 NÄ‚M migration
2015: ~30% packages support 3â”‚  (vÃ  váº«n chÆ°a xong hoÃ n toÃ n)
                              â”‚
2020: Python 2 sunset â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     NhÆ°ng legacy systems váº«n cháº¡y Python 2...

BÃ i há»c: Náº¿u Má»˜T ngÃ´n ngá»¯ phÃ¡ vá»¡ compat â†’ 12+ nÄƒm Ä‘au thÆ°Æ¡ng.
         Náº¿u WEB phÃ¡ vá»¡ compat â†’ KHÃ”NG CÃ“ migration path.
         Websites khÃ´ng cÃ³ maintainer. KhÃ´ng ai fix code.
```

**Báº±ng chá»©ng lá»‹ch sá»­ â€” Perl 5 â†’ 6 Split:**

Perl tháº­m chÃ­ tá»‡ hÆ¡n Python. VÃ o nÄƒm 2000, Larry Wall (tÃ¡c giáº£ Perl) cÃ´ng bá»‘ Perl 6 â€” redesign **tá»« Ä‘áº§u** vá»›i syntax hoÃ n toÃ n má»›i. Perl 6 phÃ¡ vá»¡ backward compatibility 100% â€” khÃ´ng cÃ³ dÃ²ng code Perl 5 nÃ o cháº¡y trÃªn Perl 6 mÃ  khÃ´ng cáº§n sá»­a.

Káº¿t quáº£ sau 19 nÄƒm phÃ¡t triá»ƒn:

- Cá»™ng Ä‘á»“ng **split** thÃ nh hai phe: Perl 5 vÃ  Perl 6
- Perl 5 tiáº¿p tá»¥c Ä‘Æ°á»£c maintain, phÃ¡t triá»ƒn, dÃ¹ng trong production
- Perl 6 **ráº¥t Ã­t ngÆ°á»i dÃ¹ng** dÃ¹ nhiá»u tÃ­nh nÄƒng Æ°u viá»‡t hÆ¡n
- NÄƒm 2019, Perl 6 **Ä‘á»•i tÃªn thÃ nh Raku** vÃ¬ cá»™ng Ä‘á»“ng Perl 5 tá»« chá»‘i coi nÃ³ lÃ  "Perl"
- Perl 5 váº«n lÃ  "Perl" chÃ­nh thá»©c, Raku lÃ  ngÃ´n ngá»¯ riÃªng biá»‡t

ÄÃ¢y lÃ  bÃ i há»c kinh Ä‘iá»ƒn: **phÃ¡ vá»¡ backward compatibility khÃ´ng chá»‰ gÃ¢y Ä‘au ká»¹ thuáº­t â€” nÃ³ split cá»™ng Ä‘á»“ng, giáº¿t adoption, vÃ  cÃ³ thá»ƒ giáº¿t cáº£ ngÃ´n ngá»¯**. JavaScript há»c tá»« Perl: thay vÃ¬ táº¡o "JavaScript 2" incompatible, há» **thÃªm features má»›i vÃ o JavaScript hiá»‡n táº¡i**.

**Additive-only evolution:**

JavaScript rÃºt kinh nghiá»‡m tá»« táº¥t cáº£ nhá»¯ng tháº£m há»a nÃ y vÃ  chá»n con Ä‘Æ°á»ng **additive-only evolution** â€” ngÃ´n ngá»¯ chá»‰ lá»›n lÃªn (thÃªm features má»›i), khÃ´ng bao giá» co láº¡i (xÃ³a features cÅ©):

| Old Feature           | New Feature (thÃªm vÃ o)    | Old váº«n hoáº¡t Ä‘á»™ng? |
| --------------------- | ------------------------- | ------------------ |
| `var`                 | `let`, `const` (ES6)      | âœ… CÃ³              |
| `==`                  | `===` (luÃ´n tá»“n táº¡i)      | âœ… CÃ³              |
| `arguments`           | `...rest` params (ES6)    | âœ… CÃ³              |
| `function` expression | Arrow `=>` (ES6)          | âœ… CÃ³              |
| `for...in`            | `for...of` (ES6)          | âœ… CÃ³              |
| `callbacks`           | `Promise`, `async/await`  | âœ… CÃ³              |
| `Object.create()`     | `class` syntax (ES6)      | âœ… CÃ³              |
| `parseInt()`          | `Number.parseInt()` (ES6) | âœ… CÃ³              |

Má»—i dÃ²ng trong báº£ng trÃªn Ä‘á»u cÃ³ **2 cÃ¡ch lÃ m cÃ¹ng má»™t viá»‡c**. ÄÃ¢y lÃ  "cÃ¡i giÃ¡" cá»§a backward compatibility: ngÃ´n ngá»¯ **phÃ¬nh ra** theo thá»i gian. NhÆ°ng Ä‘Ã¢y cÅ©ng lÃ  **sá»©c máº¡nh**: code báº¡n viáº¿t hÃ´m nay sáº½ váº«n cháº¡y sau 20 nÄƒm.

**Káº¿t luáº­n WHY 2**: "Don't Break the Web" khÃ´ng pháº£i kháº©u hiá»‡u â€” nÃ³ lÃ  survival mechanism. PhÃ¡ vá»¡ backward compatibility giáº¿t Python 2 (12 nÄƒm migrate) vÃ  split Perl (Ä‘á»•i tÃªn thÃ nh Raku). JavaScript chá»n **additive-only evolution** â€” thÃªm `let`/`const` mÃ  khÃ´ng xÃ³a `var` â€” vÃ¬ Ä‘Ã³ lÃ  cÃ¡ch duy nháº¥t an toÃ n trÃªn web platform.

---

**WHY 3: Táº¡i sao web platform fundamentally khÃ¡c vá»›i native apps? â€” Kiáº¿n TrÃºc PhÃ¢n TÃ¡n KhÃ´ng Kiá»ƒm SoÃ¡t**

ÄÃ¢y lÃ  Ä‘iá»ƒm máº¥u chá»‘t mÃ  háº§u háº¿t developers khÃ´ng nháº­n ra, vÃ  nÃ³ giáº£i thÃ­ch **má»i thá»©** vá» táº¡i sao JavaScript evolution khÃ¡c biá»‡t. HÃ£y so sÃ¡nh 3 platform chi tiáº¿t:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NATIVE APP (iOS/Android)              â”‚
â”‚                                                         â”‚
â”‚  Developer â”€â”€publishâ”€â”€â†’ App Store â”€â”€downloadâ”€â”€â†’ User    â”‚
â”‚                                                         â”‚
â”‚  Developer kiá»ƒm soÃ¡t:                                   â”‚
â”‚    âœ… Code version (v1.0, v2.0, v3.0)                   â”‚
â”‚    âœ… Minimum OS version (iOS 16+)                      â”‚
â”‚    âœ… API availability (check OS version)               â”‚
â”‚    âœ… Forced update (block old versions)                â”‚
â”‚                                                         â”‚
â”‚  â†’ CÃ“ THá»‚ xÃ³a features cÅ© khi update version           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER-SIDE (Python/Java)             â”‚
â”‚                                                         â”‚
â”‚  DevOps â”€â”€deployâ”€â”€â†’ Server â”€â”€serveâ”€â”€â†’ Users             â”‚
â”‚                                                         â”‚
â”‚  Team kiá»ƒm soÃ¡t:                                        â”‚
â”‚    âœ… Runtime version (Python 3.12, Java 21)            â”‚
â”‚    âœ… Dependencies (pip install, maven)                 â”‚
â”‚    âœ… Deploy schedule (deploy khi ready)                â”‚
â”‚    âœ… Rollback (revert náº¿u lá»—i)                        â”‚
â”‚                                                         â”‚
â”‚  â†’ CÃ“ THá»‚ upgrade runtime báº¥t ká»³ lÃºc nÃ o               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WEB (JavaScript)                      â”‚
â”‚                                                         â”‚
â”‚  Developer â”€â”€uploadâ”€â”€â†’ Server â”€â”€downloadâ”€â”€â†’ Browser     â”‚
â”‚                        (static)         (user's browser)â”‚
â”‚                                                         â”‚
â”‚  Developer KHÃ”NG kiá»ƒm soÃ¡t:                             â”‚
â”‚    âŒ Browser version (Chrome 90? Safari 15? IE 11?)    â”‚
â”‚    âŒ Engine version (V8? SpiderMonkey? JavaScriptCore?)â”‚
â”‚    âŒ User behavior (cÃ³ update browser khÃ´ng?)          â”‚
â”‚    âŒ Code execution (CDN cache? Service Worker?)       â”‚
â”‚                                                         â”‚
â”‚  â†’ KHÃ”NG THá»‚ xÃ³a features vÃ¬ khÃ´ng kiá»ƒm soÃ¡t runtime   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Äiá»ƒm khÃ¡c biá»‡t cá»‘t lÃµi: khÃ´ng cÃ³ version mechanism cho JavaScript trÃªn web.**

NghÄ©a lÃ  gÃ¬? Khi báº¡n viáº¿t Python, báº¡n cÃ³ `#!/usr/bin/env python3`. Khi báº¡n viáº¿t Java, báº¡n cÃ³ `javac --release 17`. Khi báº¡n viáº¿t Rust, báº¡n cÃ³ `edition = "2021"` trong `Cargo.toml`. Nhá»¯ng version declarations nÃ y cho compiler/interpreter biáº¿t: "tÃ´i viáº¿t cho version nÃ y, hÃ£y parse theo rules cá»§a version nÃ y".

JavaScript trÃªn web **KHÃ”NG CÃ“** cÆ¡ cháº¿ tÆ°Æ¡ng Ä‘Æ°Æ¡ng. KhÃ´ng cÃ³:

```html
<!-- KHÃ”NG Tá»’N Táº I â€” Ä‘Ã¢y chá»‰ lÃ  vÃ­ dá»¥ tÆ°á»Ÿng tÆ°á»£ng -->
<script version="ES6">
  let x = 1; // parse theo ES6 rules
</script>

<script version="ES3">
  var y = 2; // parse theo ES3 rules
</script>

<!-- Thá»±c táº¿: Má»ŒI script Ä‘á»u parse báº±ng latest engine -->
<script>
  // Engine pháº£i hiá»ƒu Cáº¢ var (ES3) LáºªN let (ES6) LáºªN ?? (ES2020)
  // Trong CÃ™NG Má»˜T context, khÃ´ng phÃ¢n biá»‡t version
</script>
```

Táº¡i sao khÃ´ng thÃªm version mechanism? VÃ¬ nÃ³ táº¡o ra **exponential complexity**. Náº¿u browser pháº£i support ES3, ES5, ES6, ES2017, ES2020, ES2025 â€” Ä‘Ã³ lÃ  6 "modes" khÃ¡c nhau. Má»—i mode cÃ³ rules khÃ¡c nhau. Interactions giá»¯a scripts khÃ¡c modes lÃ  gÃ¬? Náº¿u ES3 script gá»i function tá»« ES6 module, behavior lÃ  gÃ¬? Testing matrix **bÃ¹ng ná»•**. Browser vendors tá»« chá»‘i vÃ¬ chi phÃ­ maintain quÃ¡ lá»›n.

**`"use strict"` â€” Gáº§n nháº¥t vá»›i version mechanism nhÆ°ng khÃ´ng pháº£i:**

Báº¡n cÃ³ thá»ƒ há»i: "NhÆ°ng `\"use strict\"` khÃ´ng pháº£i lÃ  version mechanism sao?". ÄÃ³ lÃ  cÃ¢u há»i ráº¥t hay. `"use strict"` trÃ´ng GIá»NG version mechanism nhÆ°ng nÃ³ **khÃ´ng pháº£i**.

`"use strict"` chá»‰ thay Ä‘á»•i **runtime behavior** (má»™t sá»‘ hÃ nh vi bá»‹ strict hÃ³a), nhÆ°ng **KHÃ”NG thay Ä‘á»•i syntax** (má»i syntax há»£p lá»‡ trong sloppy mode Ä‘á»u há»£p lá»‡ trong strict mode). `var` hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng trong strict mode. VÃ¬ `"use strict"` khÃ´ng thay Ä‘á»•i syntax, nÃ³ **khÃ´ng thá»ƒ** loáº¡i bá» `var`.

```javascript
// Strict mode KHÃ”NG áº£nh hÆ°á»Ÿng Ä‘áº¿n var
"use strict";
var x = 10; // âœ… HoÃ n toÃ n há»£p lá»‡
var x = 20; // âœ… Re-declare váº«n Ä‘Æ°á»£c (var-specific behavior)
console.log(x); // 20

// Strict mode chá»‰ thay Ä‘á»•i RUNTIME behavior:
("use strict");
x = 10; // âŒ ReferenceError (sloppy mode: táº¡o global)
delete Object.prototype; // âŒ TypeError (sloppy mode: fail silently)
var eval = 1; // âŒ SyntaxError (eval lÃ  reserved word in strict)
```

`"use strict"` Ä‘Æ°á»£c thiáº¿t káº¿ cá»±c ká»³ thÃ´ng minh cho backward compatibility: nÃ³ lÃ  má»™t **string literal** â€” engines cÅ© (trÆ°á»›c ES5) gáº·p `"use strict";` thÃ¬ coi nÃ³ lÃ  má»™t **no-op expression statement** (má»™t string expression khÃ´ng gÃ¡n cho biáº¿n nÃ o â†’ bá» qua). Engines má»›i hiá»ƒu nÃ³ lÃ  directive. **CÃ¹ng má»™t syntax, 2 meanings, zero breakage.**

**Káº¿t luáº­n WHY 3**: Web platform khÃ¡c vÃ¬ developer **khÃ´ng kiá»ƒm soÃ¡t runtime** (browser version), **khÃ´ng cÃ³ version mechanism** cho JavaScript, vÃ  `"use strict"` chá»‰ thay Ä‘á»•i behavior chá»© khÃ´ng thay Ä‘á»•i syntax. ÄÃ¢y lÃ  rÃ ng buá»™c kiáº¿n trÃºc â€” khÃ´ng pháº£i design choice.

---

**WHY 4: Táº¡i sao khÃ´ng deprecate `var` dáº§n dáº§n? â€” 3 RÃ o Cáº£n KhÃ´ng Thá»ƒ VÆ°á»£t Qua**

"Deprecate" trong software nghÄ©a lÃ : Ä‘Ã¡nh dáº¥u feature lÃ  "sáº½ bá»‹ xÃ³a", cho developers thá»i gian migrate, rá»“i xÃ³a trong phiÃªn báº£n tÆ°Æ¡ng lai. ÄÃ¢y lÃ  pattern cá»±c ká»³ phá»• biáº¿n:

- **Python**: `asyncio.coroutine` deprecated 3.8 â†’ removed 3.11 (3 versions = ~4.5 nÄƒm)
- **Java**: `Date.getYear()` deprecated tá»« JDK 1.1 (1997), váº«n tá»“n táº¡i nhÆ°ng compiler warning
- **React**: `componentWillMount` deprecated 16.3 â†’ removed 18.0 (2 major versions = ~3 nÄƒm)
- **Node.js**: `url.parse()` deprecated â†’ khuyáº¿n khÃ­ch `new URL()`

Pattern nÃ y hoáº¡t Ä‘á»™ng vÃ¬ cÃ³ 3 Ä‘iá»u kiá»‡n tiÃªn quyáº¿t. VÃ  JavaScript trÃªn web **thiáº¿u cáº£ 3**:

**RÃ o cáº£n 1 â€” KhÃ´ng cÃ³ version mechanism:**

Khi Python deprecate `asyncio.coroutine`, há» nÃ³i: "deprecated in 3.8, will be removed in 3.11". Developer biáº¿t: "tÃ´i cÃ³ 3 releases Ä‘á»ƒ migrate. Khi tÃ´i chuyá»ƒn server lÃªn Python 3.11, code cÅ© sáº½ break, nÃªn tÃ´i pháº£i fix trÆ°á»›c."

JavaScript trÃªn web **khÃ´ng thá»ƒ** nÃ³i: "`var` sáº½ bá»‹ xÃ³a trong ES2030". Táº¡i sao? VÃ¬ khi ES2030 spec Ä‘Æ°á»£c publish, **má»i browser** sáº½ implement nÃ³ vÃ  **má»i website** sáº½ bá»‹ áº£nh hÆ°á»Ÿng **ngay láº­p tá»©c**. KhÃ´ng cÃ³ concept "tÃ´i sáº½ upgrade browser version khi tÃ´i ready". Browser tá»± Ä‘á»™ng update. Má»™t ngÃ y browser update xÃ³a `var` â†’ ngÃ y hÃ´m Ä‘Ã³ hÃ ng tá»· websites break.

```
PYTHON DEPRECATION MODEL:
  Server A: Python 3.8 â”€â”€â†’ Python 3.9 â”€â”€â†’ Python 3.11 (feature removed)
  Server B: Python 3.8 â”€â”€â†’ stays on 3.8 (code cÅ© váº«n cháº¡y)

  âœ… Servers upgrade theo SCHEDULE riÃªng
  âœ… Developer cÃ³ TIME Ä‘á»ƒ migrate

JAVASCRIPT WEB MODEL:
  Chrome: update ALL users SIMULTANEOUSLY má»—i 4 tuáº§n
  Firefox: update ALL users SIMULTANEOUSLY má»—i 4 tuáº§n

  âŒ Náº¿u Chrome 130 xÃ³a var â†’ Táº¤T Cáº¢ Chrome users bá»‹ áº£nh hÆ°á»Ÿng CÃ™NG LÃšC
  âŒ Websites KHÃ”NG CÃ“ thá»i gian migrate
  âŒ Nhiá»u websites KHÃ”NG CÃ“ maintainer Ä‘á»ƒ migrate
```

**RÃ o cáº£n 2 â€” KhÃ´ng cÃ³ migration deadline:**

Khi React deprecate `componentWillMount`, developers biáº¿t: "React 18 sáº½ xÃ³a nÃ³. Khi team tÃ´i upgrade lÃªn React 18, tÃ´i pháº£i sá»­a code." Team **chá»n** khi nÃ o upgrade.

NhÆ°ng web JavaScript khÃ´ng cÃ³ moment "upgrade". Websites cháº¡y **liÃªn tá»¥c**. KhÃ´ng cÃ³ "phiÃªn báº£n tiáº¿p theo" mÃ  developer chá»n deploy. Nhiá»u websites:

- ÄÆ°á»£c viáº¿t bá»Ÿi freelancer Ä‘Ã£ máº¥t liÃªn láº¡c
- Thuá»™c cÃ´ng ty Ä‘Ã£ phÃ¡ sáº£n
- Cháº¡y trÃªn shared hosting mÃ  admin khÃ´ng biáº¿t code bÃªn trong lÃ  gÃ¬
- LÃ  internal tools cá»§a tá»• chá»©c mÃ  khÃ´ng ai cÃ²n nhá»› code á»Ÿ Ä‘Ã¢u
- LÃ  WordPress plugins tá»« 2012 mÃ  triá»‡u website váº«n dÃ¹ng

Ai sáº½ migrate `var` â†’ `let`/`const` cho **táº¥t cáº£** nhá»¯ng websites nÃ y? **KhÃ´ng ai**. VÃ  Ä‘Ã¢y chÃ­nh lÃ  váº¥n Ä‘á».

**RÃ o cáº£n 3 â€” KhÃ´ng cÃ³ warning mechanism hiá»‡u quáº£:**

Python hiá»ƒn thá»‹ `DeprecationWarning` trong console khi dÃ¹ng deprecated features. Developer cháº¡y tests â†’ tháº¥y warning â†’ fix code. Java compiler hiá»ƒn thá»‹ warning khi dÃ¹ng `@Deprecated` method. Developer tháº¥y warning khi compile â†’ fix code.

JavaScript trÃªn web **KHÃ”NG CÃ“** tÆ°Æ¡ng Ä‘Æ°Æ¡ng hiá»‡u quáº£:

```javascript
// Python:
import asyncio
asyncio.coroutine(gen)
// â†’ DeprecationWarning: "@coroutine" decorator is deprecated since 3.8
// Developer THáº¤Y warning, FIX code

// JavaScript:
var x = 1;
// â†’ ... im láº·ng. KhÃ´ng warning. KhÃ´ng ai biáº¿t "var" bá»‹ deprecated.
// Browser console KHÃ”NG hiá»ƒn thá»‹ "var is deprecated" vÃ¬:
// 1. var KHÃ”NG deprecated (chÃ­nh thá»©c)
// 2. Náº¿u hiá»‡n warning â†’ console cá»§a Má»ŒI website trÃªn tháº¿ giá»›i sáº½ flood
// 3. KhÃ´ng ai Ä‘á»c console trÃªn production
```

Báº¡n cÃ³ thá»ƒ nÃ³i: "NhÆ°ng browser console CÃ“ THá»‚ hiá»ƒn thá»‹ warning!". ÄÃºng, vá» máº·t ká»¹ thuáº­t. NhÆ°ng tÆ°á»Ÿng tÆ°á»£ng: console cá»§a **má»—i website** hiá»‡n 500 warnings "var is deprecated" â€” performance giáº£m, console khÃ´ng Ä‘á»c Ä‘Æ°á»£c, developers bá»±c bá»™i. VÃ  quan trá»ng hÆ¡n: **production users khÃ´ng má»Ÿ console**. Warning chá»‰ cÃ³ Ã½ nghÄ©a trong development environment, vÃ  JavaScript trÃªn web khÃ´ng cÃ³ raÄ‘ ranh giá»›i rÃµ rÃ ng giá»¯a dev vÃ  production.

**Giáº£i phÃ¡p thá»±c táº¿ â€” Tooling-level deprecation:**

Ecosystem JavaScript Ä‘Ã£ tÃ¬m ra cÃ¡ch "deprecate" `var` mÃ  **khÃ´ng cáº§n runtime changes**:

```
TOOLING-LEVEL DEPRECATION STACK:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Style Guides                           â”‚
â”‚   Airbnb: "Use const/let. Never use var."       â”‚
â”‚   Google: "Do not use var."                     â”‚
â”‚   StandardJS: "Use let/const instead of var."   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 3: Code Review / CI                       â”‚
â”‚   Pull Request checks: "no-var rule violation"  â”‚
â”‚   GitHub Actions: ESLint check blocks merge     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2: Linters & Compilers                    â”‚
â”‚   ESLint rule: no-var (error, not just warning) â”‚
â”‚   TypeScript: --noVar flag (proposed)           â”‚
â”‚   Prettier: auto-format khÃ´ng touch varâ†’let     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 1: Education & Tutorials                  â”‚
â”‚   MDN Web Docs: "prefer let/const"              â”‚
â”‚   FreeCodeCamp: teaches let/const first         â”‚
â”‚   Books: khÃ´ng dÃ¹ng var trong examples          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ Káº¿t quáº£: Code Má»šI khÃ´ng chá»©a var (enforced by tooling)
â†’ Code CÅ¨ váº«n cháº¡y perfectly (no runtime change)
â†’ "Deprecated" á»Ÿ HUMAN level, khÃ´ng pháº£i RUNTIME level
```

ÄÃ¢y lÃ  cÃ¡ch "deprecate" mÃ  khÃ´ng "break": developers má»›i há»c `let`/`const` tá»« Ä‘áº§u, code má»›i khÃ´ng chá»©a `var`, nhÆ°ng code cÅ© váº«n cháº¡y perfectly. **Tooling-level deprecation** lÃ  giáº£i phÃ¡p thá»±c dá»¥ng nháº¥t cho web platform.

**Káº¿t luáº­n WHY 4**: JavaScript khÃ´ng thá»ƒ deprecate `var` theo cÃ¡ch truyá»n thá»‘ng vÃ¬ thiáº¿u cáº£ 3 Ä‘iá»u kiá»‡n: version mechanism, migration deadline, vÃ  warning mechanism hiá»‡u quáº£. Giáº£i phÃ¡p thay tháº¿: **tooling-level deprecation** qua ESLint, style guides, vÃ  education â€” enforce á»Ÿ development time mÃ  khÃ´ng thay Ä‘á»•i runtime.

---

**WHY 5: Váº­y giáº£i phÃ¡p cuá»‘i cÃ¹ng lÃ  gÃ¬? â€” Additive Evolution vÃ  V8 Dual Environment**

TC39 chá»n cÃ¡ch tiáº¿p cáº­n Ä‘Æ°á»£c gá»i lÃ  **"additive evolution"** (hay informal gá»i lÃ  **"only add, never remove"**). Thay vÃ¬ xÃ³a `var`, há» **thÃªm** `let`/`const` vá»›i semantics tá»‘t hÆ¡n â€” vÃ  Ä‘á»ƒ `var` nguyÃªn váº¹n. Cá»¥ thá»ƒ:

| Váº¥n Ä‘á» cá»§a `var`              | `let`/`const` giáº£i quyáº¿t tháº¿ nÃ o   | `var` bá»‹ áº£nh hÆ°á»Ÿng?                 |
| ----------------------------- | ---------------------------------- | ----------------------------------- |
| Function scope quÃ¡ rá»™ng       | Block scope `{}`                   | âŒ KhÃ´ng â€” `var` váº«n function scope |
| Hoisting gÃ¢y confusion        | TDZ báº¯t lá»—i sá»›m                    | âŒ KhÃ´ng â€” `var` váº«n hoisting       |
| CÃ³ thá»ƒ re-assign const values | `const` ngÄƒn re-assignment         | âŒ KhÃ´ng â€” `var` váº«n re-assignable  |
| Táº¡o property trÃªn `window`    | KhÃ´ng táº¡o global property          | âŒ KhÃ´ng â€” `var` váº«n táº¡o            |
| Re-declare khÃ´ng bÃ¡o lá»—i      | `let`/`const` throw náº¿u re-declare | âŒ KhÃ´ng â€” `var` váº«n cho phÃ©p       |

VÃ  quan trá»ng nháº¥t: `let`/`const` **hoÃ n toÃ n tÆ°Æ¡ng thÃ­ch** vá»›i `var` code. Báº¡n cÃ³ thá»ƒ dÃ¹ng `var` á»Ÿ dÃ²ng 1 vÃ  `let` á»Ÿ dÃ²ng 2 â€” engine hiá»ƒu cáº£ hai. KhÃ´ng conflict, khÃ´ng special mode, khÃ´ng migration tool báº¯t buá»™c:

```javascript
// var vÃ  let/const CHUNG Sá»NG hÃ²a bÃ¬nh trong cÃ¹ng má»™t scope
function mixedDeclarations() {
  var oldWay = "from ES3";
  let newWay = "from ES6";
  const alsoNew = "from ES6";

  // Cáº£ 3 Ä‘á»u accessible
  console.log(oldWay); // "from ES3"
  console.log(newWay); // "from ES6"
  console.log(alsoNew); // "from ES6"

  // var hoists, let/const cÃ³ TDZ â€” behaviors KHÃC NHAU
  // nhÆ°ng khÃ´ng conflict vá»›i nhau
}

// Tháº­m chÃ­ CÃ™NG TÃŠN biáº¿n â€” var shadow bá»Ÿi let trong block
function shadowExample() {
  var x = "var";
  {
    let x = "let"; // Shadow var x trong block nÃ y
    console.log(x); // "let"
  }
  console.log(x); // "var" â€” var x khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng
}
```

**V8 Engine: Dual Environment Records**

Äá»ƒ support cáº£ `var` vÃ  `let`/`const` cÃ¹ng lÃºc, V8 engine duy trÃ¬ **hai loáº¡i environment records** song song:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Execution Context                    â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ VariableEnvironment   â”‚  â”‚ LexicalEnvironmentâ”‚  â”‚
â”‚  â”‚                        â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚ Chá»©a: var declarations â”‚  â”‚ Chá»©a: let/const  â”‚  â”‚
â”‚  â”‚                        â”‚  â”‚       class       â”‚  â”‚
â”‚  â”‚ Behavior:              â”‚  â”‚                   â”‚  â”‚
â”‚  â”‚ - Function scope       â”‚  â”‚ Behavior:         â”‚  â”‚
â”‚  â”‚ - Hoisted â†’ undefined  â”‚  â”‚ - Block scope     â”‚  â”‚
â”‚  â”‚ - No TDZ               â”‚  â”‚ - TDZ enforced    â”‚  â”‚
â”‚  â”‚ - Re-declare OK        â”‚  â”‚ - No re-declare   â”‚  â”‚
â”‚  â”‚ - Creates window prop  â”‚  â”‚ - No window prop  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  Hai environments tá»“n táº¡i SONG SONG                 â”‚
â”‚  trong CÃ™NG execution context.                      â”‚
â”‚  Zero conflict. Zero breakage.                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Khi V8 compile code, Ignition bytecode compiler táº¡o **different opcodes** cho `var` vs `let`/`const`:

```
// Source: var x = 1;
// V8 Bytecode:
  LdaSmi [1]              // Load small integer 1
  Star r0                 // â†’ VariableEnvironment (function scope)

// Source: let y = 2;
// V8 Bytecode:
  LdaSmi [2]              // Load small integer 2
  StaCurrentContextSlot [4]  // â†’ LexicalEnvironment (block scope)
  // + ThrowReferenceErrorIfHole (TDZ check)
```

Cost tráº£ thÃªm cho browser vendors: phá»©c táº¡p hÃ³a compiler (pháº£i handle 2 loáº¡i environment), tÄƒng memory overhead nhá» (2 records thay vÃ¬ 1), thÃªm opcodes cáº§n maintain. NhÆ°ng benefit cho ecosystem: **zero breakage, zero migration, zero downtime**.

**Triáº¿t lÃ½ Additive Evolution â€” Masterclass Trong Language Design:**

ÄÃ¢y thá»±c sá»± lÃ  **masterclass trong language design**. TC39 giáº£i quyáº¿t má»i váº¥n Ä‘á» cá»§a `var` mÃ  **khÃ´ng phÃ¡ vá»¡ báº¥t cá»© thá»© gÃ¬**:

1. **Developers má»›i** há»c `let`/`const` tá»« Ä‘áº§u â†’ viáº¿t code tá»‘t hÆ¡n
2. **Codebase cÅ©** váº«n cháº¡y perfectly â†’ zero breakage
3. **Migration dáº§n dáº§n** qua tooling (ESLint no-var) â†’ khÃ´ng Ã©p buá»™c
4. **Engine complexity** tÄƒng nhÆ°ng **user experience** khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng
5. **Ecosystem healthy**: old code vÃ  new code chung sá»‘ng hÃ²a bÃ¬nh

So sÃ¡nh vá»›i cÃ¡ch Python 3 vÃ  Perl 6 Ä‘Ã£ xá»­ lÃ½, JavaScript approach lÃ  **elegant hÆ¡n ráº¥t nhiá»u**. CÃ¡i giÃ¡ duy nháº¥t: ngÃ´n ngá»¯ cÃ³ **nhiá»u cÃ¡ch lÃ m cÃ¹ng má»™t viá»‡c** (3 cÃ¡ch khai bÃ¡o biáº¿n, 2 cÃ¡ch so sÃ¡nh, nhiá»u cÃ¡ch viáº¿t function). NhÆ°ng so vá»›i alternative (break internet) â€” Ä‘Ã¢y lÃ  cÃ¡i giÃ¡ **ráº¥t nhá»**.

**Káº¿t luáº­n WHY 5**: TC39 giáº£i quyáº¿t váº¥n Ä‘á» báº±ng additive evolution â€” thÃªm `let`/`const` (tá»‘t hÆ¡n) mÃ  khÃ´ng xÃ³a `var` (váº«n hoáº¡t Ä‘á»™ng). V8 implement báº±ng dual environment records (VariableEnvironment + LexicalEnvironment). Káº¿t quáº£: zero breakage, gradual migration, healthy ecosystem. ÄÃ¢y lÃ  masterclass trong language design cho web platform.

---

**Tá»•ng káº¿t 5 Whys â€” Tá»« Bá» Máº·t Äáº¿n Root Cause:**

```
Bá»€ Máº¶T: "Táº¡i sao var váº«n tá»“n táº¡i?"
  â”‚
  â”œâ”€â”€ WHY 1: 99% websites dÃ¹ng var, xÃ³a = phÃ¡ internet
  â”‚     â””â”€â”€ Báº±ng chá»©ng: SmooshGate, document.all
  â”‚
  â”œâ”€â”€ WHY 2: "Don't Break the Web" contract
  â”‚     â””â”€â”€ Báº±ng chá»©ng: Python 2â†’3 (12 nÄƒm), Perl 5â†’6 (Ä‘á»•i tÃªn)
  â”‚
  â”œâ”€â”€ WHY 3: Web = distributed, uncontrolled runtime
  â”‚     â””â”€â”€ KhÃ´ng version mechanism, khÃ´ng "use strict" cÅ©ng khÃ´ng Ä‘á»§
  â”‚
  â”œâ”€â”€ WHY 4: KhÃ´ng thá»ƒ deprecate theo cÃ¡ch truyá»n thá»‘ng
  â”‚     â””â”€â”€ Giáº£i phÃ¡p: Tooling-level deprecation (ESLint, style guides)
  â”‚
  â””â”€â”€ WHY 5: Additive evolution â€” thÃªm má»›i, giá»¯ cÅ©
        â””â”€â”€ V8 dual environment: VariableEnv + LexicalEnv
  â”‚
ROOT CAUSE: Báº£n cháº¥t kiáº¿n trÃºc cá»§a web platform â€” code Ä‘Æ°á»£c deploy
            má»™t láº§n vÃ  cháº¡y mÃ£i mÃ£i, trÃªn runtime mÃ  developer
            khÃ´ng kiá»ƒm soÃ¡t.
```

> **BÃ i há»c lá»›n**: CÃ¢u há»i "táº¡i sao `var` váº«n tá»“n táº¡i?" dáº«n Ä‘áº¿n root cause sÃ¢u hÆ¡n nhiá»u so vá»›i "backward compatibility". NÃ³ cháº¡m Ä‘áº¿n **báº£n cháº¥t kiáº¿n trÃºc phÃ¢n tÃ¡n cá»§a web platform** (code cháº¡y trÃªn mÃ¡y user, khÃ´ng pháº£i server developer), **social contract giá»¯a browser vendors** (Don't Break the Web), **triáº¿t lÃ½ additive-only evolution** (chá»‰ thÃªm, khÃ´ng xÃ³a), vÃ  **giáº£i phÃ¡p ká»¹ thuáº­t** (V8 dual environment records). Hiá»ƒu 5 lá»›p nÃ y, báº¡n hiá»ƒu **táº¡i sao JavaScript trÃ´ng "lá»™n xá»™n"** â€” nhÆ°ng sá»± "lá»™n xá»™n" Ä‘Ã³ lÃ  **cÃ¡i giÃ¡ cÃ³ chá»§ Ä‘Ã­ch, Ä‘Æ°á»£c tÃ­nh toÃ¡n ká»¹** Ä‘á»ƒ giá»¯ web platform hoáº¡t Ä‘á»™ng cho hÃ ng tá»· ngÆ°á»i trÃªn tháº¿ giá»›i.

> **Insight cho phá»ng váº¥n â€” CÃ¡ch tráº£ lá»i cÃ¢u "Táº¡i sao var váº«n tá»“n táº¡i?"**:
>
> **Junior answer** (30 giÃ¢y): "Backward compatibility."
>
> **Mid-level answer** (1 phÃºt): "Backward compatibility â€” hÃ ng tá»· websites dÃ¹ng `var`. JavaScript tuÃ¢n theo nguyÃªn táº¯c Don't Break the Web. TC39 thÃªm `let`/`const` thay vÃ¬ xÃ³a `var`."
>
> **Senior answer** (2 phÃºt): "JavaScript tuÃ¢n theo **additive-only evolution** vÃ¬ báº£n cháº¥t web platform: code cháº¡y trÃªn browser cá»§a user mÃ  developer khÃ´ng kiá»ƒm soÃ¡t â€” khÃ¡c vá»›i Python hay Java nÆ¡i team kiá»ƒm soÃ¡t runtime version. KhÃ´ng cÃ³ version mechanism cho JS trÃªn web (`\"use strict\"` chá»‰ thay Ä‘á»•i behavior, khÃ´ng syntax). Ecosystems khÃ¡c thá»­ phÃ¡ vá»¡ compat (Python 2â†’3 máº¥t 12 nÄƒm migrate, Perl 6 pháº£i Ä‘á»•i tÃªn thÃ nh Raku). TC39 chá»n cÃ¡ch thÃ´ng minh hÆ¡n: thÃªm `let`/`const` vá»›i semantics tá»‘t hÆ¡n (block scope, TDZ, no window pollution) mÃ  giá»¯ `var` nguyÃªn váº¹n. V8 implement báº±ng dual environment records. `var` sáº½ tá»“n táº¡i mÃ£i mÃ£i â€” vÃ  Ä‘Ã³ lÃ  design **cÃ³ chá»§ Ä‘Ã­ch**, khÃ´ng pháº£i oversight."

#### Pattern 2: First Principles â€” Scope LÃ  GÃ¬ Tá»« Gá»‘c?

Tá»« gÃ³c nhÃ¬n language theory, scope lÃ  má»™t **mapping** tá»« tÃªn biáº¿n â†’ giÃ¡ trá»‹, tá»“n táº¡i trong má»™t **vÃ¹ng code xÃ¡c Ä‘á»‹nh**. NgÃ´n ngá»¯ nÃ o cÅ©ng cáº§n scope â€” cÃ¢u há»i lÃ  **granularity**: function-level hay block-level? Háº§u háº¿t ngÃ´n ngá»¯ chá»n block-level (C, Java, Rust) vÃ¬ nÃ³ **tá»± nhiÃªn hÆ¡n** â€” con ngÆ°á»i nghÄ© theo blocks: "biáº¿n nÃ y chá»‰ dÃ¹ng trong if nÃ y". JavaScript chá»n function-level cho `var` vÃ¬ Brendan Eich muá»‘n **Ä‘Æ¡n giáº£n hÃ³a** cho non-programmers â€” nhÆ°ng Ä‘iá»u nÃ y hÃ³a ra lÃ  sai láº§m lá»›n.

```
FIRST PRINCIPLES:
  Scope = Name â†’ Value mapping trong má»™t vÃ¹ng code

  Block scope: má»—i {} = 1 scope â†’ granularity cao â†’ Ã­t surprise
  Function scope: má»—i function = 1 scope â†’ granularity tháº¥p â†’ nhiá»u surprise

  V8 Implementation:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ VariableEnvironment (var)                â”‚ â† 1 per function
  â”‚ LexicalEnvironment  (let/const)          â”‚ â† 1 per block
  â”‚ ScriptEnvironment   (global let/const)   â”‚ â† 1 per script
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Scope: Tá»« Lambda Calculus Äáº¿n V8 Bytecode:**

Scope lÃ  khÃ¡i niá»‡m **cá»• xÆ°a nháº¥t** trong computer science â€” nÃ³ xuáº¥t hiá»‡n tá»« Lambda Calculus cá»§a Alonzo Church (1930s), trÆ°á»›c cáº£ khi mÃ¡y tÃ­nh Ä‘iá»‡n tá»­ tá»“n táº¡i. Trong lambda calculus, má»—i biáº¿n cÃ³ pháº¡m vi **chÃ­nh xÃ¡c** trong biá»ƒu thá»©c chá»©a nÃ³ â€” Ä‘Ã¢y chÃ­nh lÃ  block scope. Khi John McCarthy táº¡o LISP (1958), Ã´ng implement **lexical scope** â€” scope Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi **vá»‹ trÃ­ trong source code**, khÃ´ng pháº£i runtime call stack.

JavaScript thá»«a hÆ°á»Ÿng lexical scope tá»« Scheme (má»™t dialect cá»§a LISP), nhÆ°ng Brendan Eich Ä‘Ã£ Ä‘Æ°a ra má»™t quyáº¿t Ä‘á»‹nh gÃ¢y tranh cÃ£i: scope granularity lÃ  **function**, khÃ´ng pháº£i **block**. Táº¡i sao? VÃ¬ nÄƒm 1995, JavaScript Ä‘Æ°á»£c thiáº¿t káº¿ cho **non-programmers** â€” nhá»¯ng designers muá»‘n thÃªm dropdown menu hay validate form. Function scope Ä‘Æ¡n giáº£n hÆ¡n: khai bÃ¡o biáº¿n á»Ÿ Ä‘Ã¢u trong function cÅ©ng Ä‘Æ°á»£c, khÃ´ng cáº§n lo vá» `{}`.

NhÆ°ng tá»« gÃ³c nhÃ¬n V8 engine, sá»± khÃ¡c biá»‡t nÃ y cÃ³ **cost thá»±c sá»±**. Khi V8 parse code, nÃ³ táº¡o ra **Environment Records** cho má»—i scope:

- **VariableEnvironment**: chá»©a `var` declarations vÃ  function declarations. ÄÆ°á»£c táº¡o **1 láº§n** cho má»—i function, tá»“n táº¡i suá»‘t lifetime cá»§a function. Má»i `var` trong function â€” dÃ¹ náº±m trong block nÃ o â€” Ä‘á»u thuá»™c cÃ¹ng VariableEnvironment.

- **LexicalEnvironment**: chá»©a `let`/`const` declarations. ÄÆ°á»£c táº¡o **má»›i** cho má»—i block `{}`. Khi execution rá»i block, LexicalEnvironment Ä‘Ã³ bá»‹ **destroy** vÃ  biáº¿n trá»Ÿ thÃ nh eligible for GC.

- **ScriptEnvironment**: dÃ nh cho `let`/`const` á»Ÿ global scope. ÄÃ¢y lÃ  environment **riÃªng biá»‡t** vá»›i `window` object â€” lÃ½ do `let x = 1` á»Ÿ global khÃ´ng táº¡o `window.x`.

Äiá»u thÃº vá»‹: trong V8's Ignition bytecode, `var` sá»­ dá»¥ng opcode `Ldar` (Load Accumulator Register) trá»±c tiáº¿p tá»« function's register file, trong khi `let`/`const` trong nested blocks sá»­ dá»¥ng `LdaCurrentContextSlot` â€” truy cáº­p thÃ´ng qua context chain. Vá» máº·t lÃ½ thuyáº¿t, `var` truy cáº­p nhanh hÆ¡n **0.5-1 nanosecond** â€” nhÆ°ng TurboFan optimizer loáº¡i bá» sá»± khÃ¡c biá»‡t nÃ y hoÃ n toÃ n khi code Ä‘Æ°á»£c JIT compiled.

> **Takeaway**: Scope khÃ´ng chá»‰ lÃ  "biáº¿n sá»‘ng á»Ÿ Ä‘Ã¢u" â€” nÃ³ lÃ  **quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ ngÃ´n ngá»¯** áº£nh hÆ°á»Ÿng Ä‘áº¿n memory management, performance, vÃ  developer experience. Block scope (let/const) Ä‘áº¯t hÆ¡n má»™t chÃºt vá» runtime overhead, nhÆ°ng **ráº» hÆ¡n ráº¥t nhiá»u** vá» cognitive overhead cho developer.

#### Pattern 3: Trade-off Analysis

| TiÃªu chÃ­            | `var`               | `let`                 | `const`                      |
| ------------------- | ------------------- | --------------------- | ---------------------------- |
| **Safety**          | âŒ Silent bugs      | âœ… TDZ catches errors | âœ… TDZ + no reassign         |
| **Performance**     | â‰ˆ Same              | â‰ˆ Same                | âœ… Slight edge (V8 optimize) |
| **Readability**     | âŒ Ambiguous intent | âœ… "Will change"      | âœ… "Won't change"            |
| **Refactoring**     | âŒ Scope leaks      | âœ… Predictable        | âœ… Most predictable          |
| **Legacy compat**   | âœ… Universal        | âŒ ES6+ only          | âŒ ES6+ only                 |
| **Tooling support** | âŒ ESLint warns     | âœ… Preferred          | âœ… Most preferred            |

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Framework Quyáº¿t Äá»‹nh: Khi NÃ o DÃ¹ng let, Khi NÃ o DÃ¹ng const?**

Báº£ng trade-off á»Ÿ trÃªn cho tháº¥y `const` tháº¯ng á»Ÿ háº§u háº¿t tiÃªu chÃ­, nhÆ°ng thá»±c táº¿ phá»©c táº¡p hÆ¡n nhiá»u. ÄÃ¢y lÃ  **decision framework** mÃ  cÃ¡c engineering teams táº¡i Google, Meta, vÃ  Microsoft sá»­ dá»¥ng:

**Rule 1: Default to `const`, switch to `let` khi cáº§n.** ÄÃ¢y lÃ  quy táº¯c vÃ ng. Khi báº¡n khai bÃ¡o biáº¿n, hÃ£y luÃ´n báº¯t Ä‘áº§u vá»›i `const`. Chá»‰ Ä‘á»•i sang `let` khi compiler/linter bÃ¡o lá»—i vÃ¬ báº¡n reassign nÃ³. LÃ½ do: `const` truyá»n Ä‘áº¡t **intent** â€” "giÃ¡ trá»‹ nÃ y khÃ´ng Ä‘á»•i" â€” giÃºp ngÆ°á»i Ä‘á»c code hiá»ƒu nhanh hÆ¡n.

**Rule 2: `let` cho loop counters vÃ  accumulators.** `for (let i = 0; i < n; i++)` lÃ  pattern standard. `let` trong `for` loop táº¡o **binding má»›i má»—i iteration** â€” Ä‘Ã¢y khÃ´ng chá»‰ lÃ  syntactic sugar, mÃ  lÃ  behavioral difference quan trá»ng cho closures.

**Rule 3: `const` cho objects vÃ  arrays KHÃ”NG cÃ³ nghÄ©a "immutable".** ÄÃ¢y lÃ  trap phá»• biáº¿n nháº¥t. `const obj = {}; obj.x = 1` hoÃ n toÃ n há»£p lá»‡. `const` chá»‰ ngÄƒn **reassign binding**, khÃ´ng ngÄƒn **mutate value**. Náº¿u cáº§n true immutability, dÃ¹ng `Object.freeze()` â€” nhÆ°ng hÃ£y nhá»› nÃ³ chá»‰ **shallow freeze**.

**Rule 4: KhÃ´ng bao giá» dÃ¹ng `var` trong code má»›i.** ÄÃ¢y khÃ´ng pháº£i opinion â€” Ä‘Ã¢y lÃ  **consensus** cá»§a toÃ n bá»™ JavaScript ecosystem. Airbnb, Google, StandardJS, vÃ  TypeScript compiler Ä‘á»u enforce `no-var`. LÃ½ do duy nháº¥t Ä‘á»ƒ viáº¿t `var` trong 2024+ lÃ  khi maintain legacy code vÃ  migration chÆ°a kháº£ thi.

**Rule 5: Trong team codebase, consistency > cÃ¡ nhÃ¢n.** Náº¿u team convention lÃ  dÃ¹ng `let` cho táº¥t cáº£ (dÃ¹ `const` tá»‘t hÆ¡n), hÃ£y follow convention. Code consistency giáº£m cognitive load cho **toÃ n team**, quan trá»ng hÆ¡n micro-optimization cÃ¡ nhÃ¢n.

Má»™t insight Ã­t ngÆ°á»i biáº¿t: táº¡i Meta (Facebook), khi migrate React codebase tá»« `var` â†’ `let`/`const`, há» phÃ¡t hiá»‡n ráº±ng **92% biáº¿n** cÃ³ thá»ƒ lÃ  `const`. Chá»‰ 8% thá»±c sá»± cáº§n `let`. Con sá»‘ nÃ y cho tháº¥y pháº§n lá»›n variables trong typical code **khÃ´ng bao giá» thay Ä‘á»•i** sau initialization â€” vÃ  `const` capture Ã½ Ä‘á»‹nh Ä‘Ã³ perfectly.

#### Pattern 4: Mental Mapping â€” Scope Chain Visualization

```
var a = 1;
let b = 2;

function outer() {
  var c = 3;
  let d = 4;

  if (true) {
    var e = 5;    // â†’ thuá»™c outer() scope
    let f = 6;    // â†’ thuá»™c if {} scope

    function inner() {
      var g = 7;
      let h = 8;
      // Scope chain: inner â†’ if-block â†’ outer â†’ global
      // Accessible: a, b, c, d, e, f, g, h
    }
  }
  // Accessible: a, b, c, d, e (var hoisted)
  // NOT accessible: f (block scope ended)
}
// Accessible: a, b
// NOT accessible: c, d, e, f, g, h
```

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” V8 Scope Chain: CÃ¡ch Engine TÃ¬m Biáº¿n Trong O(n) vs O(1):**

Khi báº¡n viáº¿t `console.log(a)` bÃªn trong `inner()`, V8 pháº£i **tÃ¬m biáº¿n `a`** trong scope chain. QuÃ¡ trÃ¬nh nÃ y gá»i lÃ  **identifier resolution** â€” vÃ  cÃ¡ch V8 implement nÃ³ phá»©c táº¡p hÆ¡n báº¡n nghÄ©.

Trong **non-optimized code** (Ignition interpreter), V8 duyá»‡t scope chain **tá»« trong ra ngoÃ i**: kiá»ƒm tra local scope â†’ parent scope â†’ grandparent scope â†’ ... â†’ global scope. ÄÃ¢y lÃ  O(n) vá»›i n = Ä‘á»™ sÃ¢u scope chain. Má»—i scope lookup tá»‘n khoáº£ng 3-5 nanoseconds â€” nghe Ã­t, nhÆ°ng trong hot loop cháº¡y triá»‡u láº§n, nÃ³ cá»™ng dá»“n.

Trong **optimized code** (TurboFan compiler), V8 thá»±c hiá»‡n **scope analysis at compile time** vÃ  biáº¿n scope chain lookup thÃ nh **direct memory access** â€” O(1). TurboFan biáº¿t chÃ­nh xÃ¡c biáº¿n `a` náº±m á»Ÿ offset nÃ o trong context chain, vÃ  emit machine code truy cáº­p trá»±c tiáº¿p memory address Ä‘Ã³.

Äiá»u thÃº vá»‹: `var` vÃ  `let`/`const` áº£nh hÆ°á»Ÿng Ä‘áº¿n optimization khÃ¡c nhau:

- **`var` trong closure**: V8 pháº£i táº¡o **Context object** (heap-allocated) Ä‘á»ƒ lÆ°u biáº¿n, vÃ¬ closure cÃ³ thá»ƒ sá»‘ng lÃ¢u hÆ¡n function. Má»—i Context object tá»‘n ~48 bytes minimum trÃªn 64-bit system.

- **`let` trong block (khÃ´ng closure)**: V8 cÃ³ thá»ƒ giá»¯ biáº¿n trÃªn **stack** â€” nhanh hÆ¡n vÃ  khÃ´ng cáº§n GC. Khi block káº¿t thÃºc, biáº¿n tá»± Ä‘á»™ng bá»‹ destroy. Zero overhead.

- **`const` primitive**: TurboFan cÃ³ thá»ƒ **inline giÃ¡ trá»‹** trá»±c tiáº¿p vÃ o machine code. `const PI = 3.14` cÃ³ thá»ƒ trá»Ÿ thÃ nh literal `3.14` trong assembly â€” khÃ´ng cáº§n memory access nÃ o cáº£.

Má»™t pattern quan trá»ng trong production: **scope depth áº£nh hÆ°á»Ÿng Ä‘áº¿n V8's ability to optimize**. Code vá»›i scope chain quÃ¡ sÃ¢u (10+ levels) cÃ³ thá»ƒ khiáº¿n TurboFan **bail out** vÃ  fall back to Ignition interpreter. Rule of thumb: giá»¯ scope nesting â‰¤ 4-5 levels báº±ng cÃ¡ch extract nested logic thÃ nh separate functions.

#### Pattern 5: Reverse Engineering â€” ESLint no-var Rule

Táº¡i sao ESLint cÃ³ rule `no-var`? VÃ¬ team Airbnb phÃ¢n tÃ­ch **hÃ ng triá»‡u dÃ²ng code** vÃ  phÃ¡t hiá»‡n ráº±ng **100%** bugs liÃªn quan Ä‘áº¿n scope Ä‘á»u Ä‘áº¿n tá»« `var`. Rule `prefer-const` cÃ²n Ä‘i xa hÆ¡n: nÃ³ enforce ráº±ng náº¿u biáº¿n khÃ´ng bao giá» reassign, pháº£i dÃ¹ng `const` â€” giÃºp developer **communicate intent** qua code.

```javascript
// ESLint: no-var + prefer-const
// BAD
var items = getItems(); // ESLint: no-var
let count = items.length; // ESLint: prefer-const (never reassigned)

// GOOD
const items = getItems(); // âœ… no-var + prefer-const
const count = items.length; // âœ… prefer-const
let accumulator = 0; // âœ… let OK â€” reassigned in loop
for (const item of items) {
  accumulator += item.value;
}
```

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” CÃ¢u Chuyá»‡n Airbnb Style Guide vÃ  CÃ¡ch NÃ³ Thay Äá»•i Cáº£ NgÃ nh:**

NÄƒm 2014, team engineering cá»§a Airbnb Ä‘á»‘i máº·t vá»›i váº¥n Ä‘á»: codebase cá»§a há» cÃ³ **hÃ ng nghÃ¬n files** JavaScript, viáº¿t bá»Ÿi **hÃ ng trÄƒm engineers** vá»›i coding style khÃ¡c nhau. Bugs xuáº¥t hiá»‡n liÃªn tá»¥c, code review tá»‘n nhiá»u thá»i gian, vÃ  onboarding engineer má»›i máº¥t hÃ ng tuáº§n chá»‰ Ä‘á»ƒ hiá»ƒu conventions.

Harrison Shoff vÃ  team quyáº¿t Ä‘á»‹nh táº¡o má»™t **comprehensive style guide** â€” khÃ´ng chá»‰ formatting rules, mÃ  lÃ  **engineering decisions Ä‘Æ°á»£c document hÃ³a**. Há» phÃ¢n tÃ­ch hÃ ng triá»‡u dÃ²ng code production vÃ  postmortem reports Ä‘á»ƒ tÃ¬m pattern: bugs nÃ o xuáº¥t hiá»‡n nhiá»u nháº¥t? Code nÃ o khÃ³ debug nháº¥t? Convention nÃ o giÃºp reduce errors?

Káº¿t quáº£ Ä‘Ã¡ng ngáº¡c nhiÃªn: **pháº§n lá»›n bugs liÃªn quan Ä‘áº¿n biáº¿n** Ä‘á»u truy vá» `var`. Cá»¥ thá»ƒ:

- **Hoisting bugs**: developer khai bÃ¡o `var` cuá»‘i function, nhÆ°ng sá»­ dá»¥ng á»Ÿ Ä‘áº§u â€” khÃ´ng error, nhÆ°ng giÃ¡ trá»‹ lÃ  `undefined` thay vÃ¬ expected value.
- **Loop closure bugs**: classic `var` in `setTimeout` váº¥n Ä‘á» â€” xuáº¥t hiá»‡n trong **háº§u háº¿t** async code patterns.
- **Re-declaration bugs**: hai developers cÃ¹ng khai bÃ¡o `var result` trong cÃ¹ng function á»Ÿ hai commits khÃ¡c nhau â€” merge conflict khÃ´ng báº¯t Ä‘Æ°á»£c, code cháº¡y sai.

Rule `no-var` ra Ä‘á»i tá»« data thá»±c táº¿ Ä‘Ã³. NhÆ°ng `prefer-const` má»›i lÃ  insight sÃ¢u hÆ¡n: team Airbnb nháº­n ra ráº±ng khi developer dÃ¹ng `const`, há» **tá»± nhiÃªn viáº¿t code tá»‘t hÆ¡n**. Táº¡i sao? VÃ¬ `const` forces báº¡n nghÄ©: "biáº¿n nÃ y sáº½ thay Ä‘á»•i khÃ´ng?". CÃ¢u há»i Ä‘Ã³ dáº«n Ä‘áº¿n code **declarative hÆ¡n**, **Ã­t side effects hÆ¡n**, vÃ  **dá»… test hÆ¡n**.

NgÃ y nay, Airbnb Style Guide cÃ³ **130,000+ GitHub stars** â€” lÃ  style guide phá»• biáº¿n nháº¥t tháº¿ giá»›i. VÃ  hai rules quan trá»ng nháº¥t â€” `no-var` + `prefer-const` â€” Ä‘Ã£ trá»Ÿ thÃ nh **industry standard**. Khi báº¡n cháº¡y `npx create-react-app` hay `npm init @eslint/config`, `no-var` Ä‘Æ°á»£c enable by default.

> **Fun fact**: Google's internal JavaScript style guide (gá»i lÃ  "gjslint", sau nÃ y lÃ  Closure Linter) cÅ©ng ban `var` tá»« 2016. NhÆ°ng Google Ä‘i xa hÆ¡n: há» require **JSDoc type annotations** cho má»—i `let`/`const` â€” Ä‘iá»u mÃ  TypeScript sau nÃ y giáº£i quyáº¿t elegantly hÆ¡n.

#### Pattern 6: Lá»‹ch Sá»­ â€” Evolution of Variable Declarations

```
TIMELINE:
1995 â”€â”€â”€ var ra Ä‘á»i (ES1) â”€â”€â”€ Brendan Eich, 10 ngÃ y
         â”‚ Function scope, hoisting, no TDZ
         â”‚ Thiáº¿t káº¿ cho "scripting Ä‘Æ¡n giáº£n"
         â”‚
2009 â”€â”€â”€ "use strict" (ES5) â”€â”€â”€ Cáº£i thiá»‡n safety
         â”‚ Cáº¥m undeclared variables
         â”‚ NhÆ°ng var váº«n function-scoped
         â”‚
2015 â”€â”€â”€ let/const ra Ä‘á»i (ES6) â”€â”€â”€ TC39 committee
         â”‚ Block scope, TDZ, no re-declaration
         â”‚ const: immutable binding
         â”‚ "The var killer" â€” nhÆ°ng var váº«n tá»“n táº¡i
         â”‚
2024+ â”€â”€ var gáº§n nhÆ° extinct trong code má»›i
         â”‚ ESLint no-var rule: ON by default
         â”‚ TypeScript: khuyáº¿n khÃ­ch const
         â”‚ React/Vue/Angular: 100% let/const
```

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” 30 NÄƒm JavaScript: BÃ i Há»c Vá» Thiáº¿t Káº¿ NgÃ´n Ngá»¯:**

Timeline á»Ÿ trÃªn khÃ´ng chá»‰ lÃ  "lá»‹ch sá»­" â€” nÃ³ pháº£n Ã¡nh **má»™t pattern lá»›n hÆ¡n** trong thiáº¿t káº¿ pháº§n má»m: tension giá»¯a **simplicity for beginners** vÃ  **safety for experts**.

NÄƒm 1995, Brendan Eich cÃ³ 10 ngÃ y Ä‘á»ƒ táº¡o JavaScript. Management táº¡i Netscape muá»‘n ngÃ´n ngá»¯ **dá»… dÃ¹ng** â€” dá»… hÆ¡n Java, dá»… hÆ¡n C. Target audience lÃ  **designers vÃ  content creators**, khÃ´ng pháº£i software engineers. Trong bá»‘i cáº£nh Ä‘Ã³, `var` lÃ  quyáº¿t Ä‘á»‹nh há»£p lÃ½: má»™t keyword, má»™t cÃ¡ch khai bÃ¡o, hoáº¡t Ä‘á»™ng á»Ÿ má»i nÆ¡i trong function.

NhÆ°ng cÃ³ má»™t quy luáº­t trong software engineering gá»i lÃ  **Blub Paradox** (Paul Graham, 2001): features mÃ  báº¡n thiáº¿u, báº¡n khÃ´ng nháº­n ra mÃ¬nh thiáº¿u cho Ä‘áº¿n khi báº¡n tháº¥y chÃºng. Developers JavaScript khÃ´ng biáº¿t mÃ¬nh cáº§n block scope â€” cho Ä‘áº¿n khi há» dÃ¹ng Java, C#, hay Python vÃ  nháº­n ra code cá»§a há» **an toÃ n hÆ¡n** vá»›i block scope.

QuÃ¡ trÃ¬nh tá»« `var` â†’ `let`/`const` máº¥t **20 nÄƒm** (1995 â†’ 2015). Táº¡i sao lÃ¢u váº­y? VÃ¬ TC39 pháº£i thá»a mÃ£n 3 rÃ ng buá»™c Ä‘á»“ng thá»i:

1. **Backward compatibility**: má»i code cÅ© pháº£i váº«n cháº¡y.
2. **Forward compatibility**: features má»›i pháº£i **"future-proof"** â€” khÃ´ng gÃ¢y conflict vá»›i potential future features.
3. **Cross-browser agreement**: má»i browser vendor (Google, Mozilla, Apple, Microsoft) pháº£i Ä‘á»“ng Ã½ implementation.

`let` keyword lÃ  vÃ­ dá»¥ perfect: ban Ä‘áº§u TC39 muá»‘n dÃ¹ng keyword khÃ¡c, nhÆ°ng báº¥t ká»³ keyword má»›i nÃ o cÅ©ng cÃ³ thá»ƒ **conflict vá»›i biáº¿n tÃªn Ä‘Ã³ trong existing code**. `let` Ä‘Æ°á»£c chá»n vÃ¬ nÃ³ Ã­t Ä‘Æ°á»£c dÃ¹ng lÃ m tÃªn biáº¿n (ai Ä‘áº·t `var let = 5`?), vÃ  trong `"use strict"` mode, `let` trá»Ÿ thÃ nh reserved word.

Äiá»u Ä‘Ã¡ng ngáº¡c nhiÃªn nháº¥t: `const` gáº§n nhÆ° bá»‹ loáº¡i khá»i ES6 spec. Má»™t nhÃ³m trong TC39 argue ráº±ng `const` misleading â€” developers sáº½ nghÄ© nÃ³ táº¡o **immutable values** (giá»‘ng `final` trong Java cho primitives). NhÃ³m khÃ¡c argue ráº±ng `const` valuable vÃ¬ nÃ³ communicate **binding immutability** â€” vÃ  Ä‘Ã¢y lÃ  signal quan trá»ng cho optimizing compilers. Cuá»‘i cÃ¹ng, `const` Ä‘Æ°á»£c giá»¯ láº¡i vá»›i semantic rÃµ rÃ ng: **immutable binding, mutable value**.

BÃ i há»c lá»›n nháº¥t tá»« 30 nÄƒm lá»‹ch sá»­ nÃ y: **ngÃ´n ngá»¯ pháº£n Ã¡nh cÃ¡ch chÃºng ta nghÄ© vá» pháº§n má»m**. `var` pháº£n Ã¡nh era "script nhá», move fast". `let`/`const` pháº£n Ã¡nh era "systems lá»›n, fail safely". VÃ  cÃ³ láº½ trong tÆ°Æ¡ng lai, chÃºng ta sáº½ cÃ³ thÃªm features má»›i pháº£n Ã¡nh era tiáº¿p theo â€” nhÆ°ng `var`, `let`, vÃ  `const` sáº½ váº«n á»Ÿ Ä‘Ã³, nhÆ° nhá»¯ng lá»›p Ä‘á»‹a cháº¥t ká»ƒ láº¡i cÃ¢u chuyá»‡n cá»§a ngÃ´n ngá»¯.

### Interview Cheat Sheet â€” Top 10 CÃ¢u Há»i var/let/const

**Q1: `var` vÃ  `let` khÃ¡c nhau nhÆ° tháº¿ nÃ o?**
â†’ **Senior answer**: 4 Ä‘iá»ƒm khÃ¡c biá»‡t: (1) Scope â€” `var` function-scoped, `let` block-scoped; (2) Hoisting â€” `var` initialized `undefined`, `let` uninitialized (TDZ); (3) Re-declaration â€” `var` cho phÃ©p, `let` khÃ´ng; (4) Global object â€” `var` creates `window` property, `let` khÃ´ng.

**Q2: Output cá»§a Ä‘oáº¡n code nÃ y?**

```javascript
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 0);
}
```

â†’ **Answer**: `3, 3, 3` â€” vÃ¬ `var i` lÃ  function-scoped, shared across iterations. Fix: dÃ¹ng `let` hoáº·c IIFE.

**Q3: TDZ lÃ  gÃ¬? Cho vÃ­ dá»¥ `typeof` trong TDZ.**
â†’ **Answer**: TDZ = khoáº£ng tá»« Ä‘áº§u block Ä‘áº¿n declaration. `typeof x` trÆ°á»›c `let x` â†’ `ReferenceError` (khÃ¡c vá»›i undeclared variable â†’ `"undefined"`).

**Q4: `const` cÃ³ pháº£i immutable khÃ´ng?**
â†’ **Answer**: `const` = **immutable binding**, NOT immutable value. `const obj = {}; obj.x = 1` â†’ OK. `const obj = {}; obj = {}` â†’ TypeError.

**Q5: Táº¡i sao dÃ¹ng `const` cho function declarations?**
â†’ **Answer**: `const fn = () => {}` prevents accidental reassignment. Function declarations (`function fn()`) are hoisted entirely â€” `const fn` chá»‰ cÃ³ binding, pháº£i call sau declaration.

**Q6: V8 optimize `const` khÃ¡c `let` khÃ´ng?**
â†’ **Answer**: Trong TurboFan (V8 optimizing compiler), `const` primitives cÃ³ thá»ƒ Ä‘Æ°á»£c **inlined directly** vÃ o machine code. `let` pháº£i giá»¯ slot vÃ¬ cÃ³ thá»ƒ reassign. Tuy nhiÃªn, difference cá»±c nhá» â€” Ä‘á»«ng optimize prematurately.

**Q7: `let` á»Ÿ global scope cÃ³ thá»ƒ access qua `window` khÃ´ng?**
â†’ **Answer**: KhÃ´ng. `let`/`const` global náº±m trong **Script scope** (Declarative Environment Record), khÃ´ng pháº£i **Object Environment Record** nhÆ° `var`. ÄÃ¢y lÃ  V8 spec compliance.

**Q8: Giáº£i thÃ­ch hoisting behavior cá»§a function declarations vs expressions.**
â†’ **Answer**: `function foo(){}` â†’ hoisted entirely (name + body). `var foo = function(){}` â†’ chá»‰ `var foo` hoisted (= `undefined`). `const foo = () => {}` â†’ TDZ, cannot call before declaration.

**Q9: CÃ³ nÃªn dÃ¹ng `var` trong closures/legacy code khÃ´ng?**
â†’ **Answer**: Trong new code â€” never. Trong legacy â€” chá»‰ khi maintain existing codebase. Migration strategy: enable ESLint `no-var`, fix file-by-file, test thoroughly.

**Q10: Block scope cÃ³ impact garbage collection khÃ´ng?**
â†’ **Answer**: CÃ³. `let`/`const` trong block â†’ eligible for GC khi block exits. `var` trong function â†’ pháº£i Ä‘á»£i function exits. Trong long-running functions, block scope giÃºp GC collect sá»›m hÆ¡n â†’ giáº£m memory footprint.

### Tá»•ng Káº¿t: var/let/const â€” KhÃ´ng Chá»‰ LÃ  Syntax, MÃ  LÃ  Triáº¿t LÃ½ Thiáº¿t Káº¿

Sau táº¥t cáº£ nhá»¯ng analysis á»Ÿ trÃªn, hÃ£y zoom out vÃ  nhÃ¬n **bá»©c tranh lá»›n**: cuá»™c chuyá»ƒn Ä‘á»•i tá»« `var` sang `let`/`const` pháº£n Ã¡nh sá»± trÆ°á»Ÿng thÃ nh cá»§a cáº£ má»™t ngÃ nh cÃ´ng nghiá»‡p pháº§n má»m.

NÄƒm 1995, Brendan Eich táº¡o JavaScript trong 10 ngÃ y vá»›i má»¥c tiÃªu: **lÃ m cho web dá»… láº­p trÃ¬nh hÆ¡n**. `var` Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘Æ¡n giáº£n: khai bÃ¡o biáº¿n, dÃ¹ng á»Ÿ Ä‘Ã¢u cÅ©ng Ä‘Æ°á»£c trong function. KhÃ´ng cáº§n nghÄ© nhiá»u vá» scope, khÃ´ng cáº§n lo TDZ. Äá»‘i vá»›i nhá»¯ng script nhá» (validate form, animate button), Ä‘iá»u nÃ y hoÃ n toÃ n há»£p lÃ½.

NhÆ°ng 20 nÄƒm sau, JavaScript khÃ´ng cÃ²n lÃ  "scripting language cho web". NÃ³ cháº¡y **server** (Node.js), **mobile** (React Native), **desktop** (Electron), **AI/ML** (TensorFlow.js), vÃ  **edge computing** (Cloudflare Workers). Codebases phÃ¡t triá»ƒn tá»« vÃ i trÄƒm dÃ²ng lÃªn hÃ ng triá»‡u dÃ²ng. Nhá»¯ng quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ há»£p lÃ½ cho script nhá» trá»Ÿ thÃ nh **gÃ¡nh náº·ng ká»¹ thuáº­t** cho há»‡ thá»‘ng lá»›n.

`let`/`const` Ä‘áº¡i diá»‡n cho ba nguyÃªn táº¯c thiáº¿t káº¿ cá»§a pháº§n má»m hiá»‡n Ä‘áº¡i:

1. **Principle of Least Surprise**: Block scope lÃ  nhá»¯ng gÃ¬ developer tá»« ngÃ´n ngá»¯ khÃ¡c **mong Ä‘á»£i**. Khi báº¡n viáº¿t `if (x) { let y = 1 }`, báº¡n expect `y` khÃ´ng tá»“n táº¡i ngoÃ i `if`. `let` lÃ m Ä‘Ãºng Ä‘iá»u Ä‘Ã³.

2. **Fail Fast, Fail Loud**: TDZ biáº¿n bugs "tháº§m láº·ng" (`undefined`) thÃ nh errors **rÃµ rÃ ng** (`ReferenceError`). Re-declaration ban biáº¿n bugs **Ã¢m tháº§m** (ghi Ä‘Ã¨ biáº¿n) thÃ nh compile-time errors. Developer biáº¿t lá»—i ngay, fix ngay â€” thay vÃ¬ Ä‘á»ƒ bug cháº¡y vÃ o production.

3. **Immutability by Default**: `const` khuyáº¿n khÃ­ch **khÃ´ng thay Ä‘á»•i state** khi khÃ´ng cáº§n thiáº¿t. ÄÃ¢y lÃ  ná»n táº£ng cá»§a functional programming, React state management, vÃ  concurrent-safe code. Khi 80% biáº¿n lÃ  `const`, báº¡n giáº£m **cognitive load** ráº¥t nhiá»u: Ä‘á»c code chá»‰ cáº§n chÃº Ã½ 20% biáº¿n cÃ³ `let`.

Cuá»‘i cÃ¹ng, hÃ£y nhá»› ráº±ng `var` khÃ´ng pháº£i "sai" â€” nÃ³ lÃ  **sáº£n pháº©m cá»§a thá»i Ä‘áº¡i**. Hiá»ƒu `var` lÃ  hiá»ƒu **lá»‹ch sá»­** cá»§a JavaScript. DÃ¹ng `let`/`const` lÃ  dÃ¹ng **hiá»‡n táº¡i vÃ  tÆ°Æ¡ng lai** cá»§a ngÃ´n ngá»¯. VÃ  khi báº¡n cÃ³ thá»ƒ giáº£i thÃ­ch **táº¡i sao** `let`/`const` ra Ä‘á»i, chá»© khÃ´ng chá»‰ **cÃ¡ch** dÃ¹ng chÃºng â€” báº¡n Ä‘Ã£ chuyá»ƒn tá»« **user** cá»§a ngÃ´n ngá»¯ thÃ nh **ngÆ°á»i hiá»ƒu** ngÃ´n ngá»¯.

---

## 9. Garbage Collection (GC) â€” CÆ¡ Cháº¿ Thu Gom RÃ¡c

### Táº¡i Sao Cáº§n Garbage Collection?

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Garbage Collection: Tá»« KhÃ¡i Niá»‡m Äáº¿n V8 Internals**

Garbage Collection (GC) lÃ  má»™t trong nhá»¯ng chá»§ Ä‘á» **quan trá»ng nháº¥t** nhÆ°ng **Ã­t Ä‘Æ°á»£c hiá»ƒu Ä‘Ãºng nháº¥t** trong JavaScript. Háº§u háº¿t developers biáº¿t ráº±ng "JavaScript tá»± Ä‘á»™ng quáº£n lÃ½ bá»™ nhá»›" â€” nhÆ°ng hiá»ƒu **cÃ¡ch** nÃ³ quáº£n lÃ½, **khi nÃ o** nÃ³ tháº¥t báº¡i, vÃ  **táº¡i sao** memory leaks xáº£y ra lÃ  Ä‘iá»u phÃ¢n biá»‡t senior engineer vá»›i junior developer.

**Memory â€” TÃ i NguyÃªn Há»¯u Háº¡n MÃ  Developers ThÆ°á»ng QuÃªn:**

Má»—i khi báº¡n viáº¿t `let x = {}` hoáº·c `const arr = [1, 2, 3]`, báº¡n Ä‘ang yÃªu cáº§u há»‡ Ä‘iá»u hÃ nh cáº¥p phÃ¡t má»™t vÃ¹ng nhá»› trÃªn **heap**. Heap khÃ´ng pháº£i vÃ´ háº¡n â€” má»—i tab Chrome Ä‘Æ°á»£c cáº¥p khoáº£ng **1.4GB-4GB** heap space (tÃ¹y há»‡ Ä‘iá»u hÃ nh vÃ  cáº¥u hÃ¬nh). Khi heap Ä‘áº§y, browser **crash tab** vá»›i thÃ´ng bÃ¡o "Aw, Snap!" (Chrome) hoáº·c "This page is using significant memory" (Safari).

Váº¥n Ä‘á» lÃ : JavaScript táº¡o objects **cá»±c ká»³ nhanh** nhÆ°ng hiáº¿m khi developers nghÄ© Ä‘áº¿n viá»‡c **giáº£i phÃ³ng** chÃºng. Má»—i React component render táº¡o hÃ ng chá»¥c objects má»›i (JSX elements, props objects, callback closures). Má»—i API call táº¡o Response objects, JSON parsed objects, state updates. Náº¿u khÃ´ng cÃ³ GC, má»™t SPA cháº¡y 30 phÃºt sáº½ **tiÃªu thá»¥ háº¿t memory** vÃ  crash.

**So SÃ¡nh Vá»›i CÃ¡c NgÃ´n Ngá»¯ KhÃ¡c â€” Táº¡i Sao JavaScript Cáº§n GC:**

Äá»ƒ hiá»ƒu táº¡i sao GC tá»“n táº¡i, hÃ£y so sÃ¡nh cÃ¡ch cÃ¡c ngÃ´n ngá»¯ khÃ¡c xá»­ lÃ½ memory:

- **C/C++ (Manual memory management)**: Developer tá»± gá»i `malloc()` Ä‘á»ƒ cáº¥p phÃ¡t vÃ  `free()` Ä‘á»ƒ giáº£i phÃ³ng. Æ¯u Ä‘iá»ƒm: kiá»ƒm soÃ¡t tuyá»‡t Ä‘á»‘i, performance tá»‘i Æ°u. NhÆ°á»£c Ä‘iá»ƒm: **cá»±c ká»³ dá»… bug** â€” quÃªn `free()` â†’ memory leak, `free()` hai láº§n â†’ crash (double-free), dÃ¹ng pointer sau `free()` â†’ undefined behavior (use-after-free). ÄÃ¢y lÃ  nguá»“n gá»‘c cá»§a **70% security vulnerabilities** trong C/C++ code (theo Microsoft Security Response Center, 2019).

- **Rust (Ownership system)**: Compiler tá»± tÃ­nh toÃ¡n **táº¡i compile time** khi nÃ o memory cáº§n giáº£i phÃ³ng, thÃ´ng qua ownership rules vÃ  borrow checker. KhÃ´ng cáº§n GC, khÃ´ng cáº§n manual free, zero runtime cost. NhÆ°ng learning curve **cá»±c cao** â€” developers pháº£i "chiáº¿n Ä‘áº¥u" vá»›i borrow checker liÃªn tá»¥c.

- **Java, C#, Go, Python (Garbage collected)**: Runtime tá»± Ä‘á»™ng detect objects khÃ´ng cÃ²n dÃ¹ng vÃ  giáº£i phÃ³ng. Developer **khÃ´ng cáº§n** (vÃ  **khÃ´ng thá»ƒ**) tá»± free memory. Tradeoff: cÃ³ **GC pause** â€” cÃ¡c khoáº£ng dá»«ng ngáº¯n khi GC cháº¡y, cÃ³ thá»ƒ gÃ¢y jank trong UI-sensitive applications.

- **JavaScript (Garbage collected â€” giá»‘ng Java/Go)**: V8 engine (Chrome, Node.js) tá»± Ä‘á»™ng GC. Developer chá»‰ cáº§n táº¡o objects â€” V8 lo pháº§n dá»n dáº¹p. NhÆ°ng GC **khÃ´ng pháº£i phÃ©p mÃ u** â€” nÃ³ chá»‰ cÃ³ thá»ƒ thu há»“i objects mÃ  **khÃ´ng ai reference Ä‘áº¿n ná»¯a**. Náº¿u code vÃ´ tÃ¬nh giá»¯ reference (closure, global variable, event listener) â†’ object **khÃ´ng bao giá» bá»‹ GC** â†’ memory leak.

**Analogie thá»±c táº¿ â€” GC giá»‘ng nhÆ° dá»‹ch vá»¥ dá»n phÃ²ng khÃ¡ch sáº¡n:**

TÆ°á»Ÿng tÆ°á»£ng báº¡n á»Ÿ khÃ¡ch sáº¡n. Housekeeper (GC) sáº½ dá»n cÃ¡c phÃ²ng **khÃ´ng cÃ³ khÃ¡ch** (unreachable objects). NhÆ°ng náº¿u báº¡n gá»­i chÃ¬a khÃ³a cho báº¡n bÃ¨ (táº¡o reference), housekeeper sáº½ **khÃ´ng dá»n phÃ²ng Ä‘Ã³** dÃ¹ báº¡n Ä‘Ã£ checkout (object out of scope nhÆ°ng váº«n reachable). VÃ  náº¿u báº¡n cá»© Ä‘áº·t phÃ²ng má»›i mÃ  khÃ´ng checkout (táº¡o objects má»›i mÃ  khÃ´ng release references) â€” cuá»‘i cÃ¹ng khÃ¡ch sáº¡n **háº¿t phÃ²ng** (out of memory).

**Memory Lifecycle â€” 3 Giai Äoáº¡n CÆ¡ Báº£n:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEMORY MANAGEMENT IN JAVASCRIPT                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Trong project, náº¿u cÃ³ lÆ°á»£ng lá»›n bá»™ nhá»› KHÃ”NG Ä‘Æ°á»£c giáº£i phÃ³ng   â”‚
â”‚  (heap/stack/context) â†’ page performance trá»Ÿ nÃªn CHáº¬M           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Memory Lifecycle:                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  1. Allocate    â†’  2. Use    â†’  3. Release                 â”‚ â”‚
â”‚  â”‚  (cáº¥p phÃ¡t)       (sá»­ dá»¥ng)    (giáº£i phÃ³ng)               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Step 1 & 2: Developer tá»± quáº£n lÃ½                      â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Step 3: GC tá»± Ä‘á»™ng xá»­ lÃ½ (nhÆ°ng khÃ´ng hoÃ n háº£o)       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Memory Leak = code KHÃ”NG giáº£i phÃ³ng bá»™ nhá»› Ä‘Ãºng cÃ¡ch          â”‚
â”‚  â†’ Trang web ngÃ y cÃ ng cháº­m, cÃ³ thá»ƒ crash                      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Háº¡n cháº¿ sá»­ dá»¥ng closures vÃ¬ chÃºng TIÃŠU THá»¤ bá»™ nhá»›         â”‚
â”‚     (biáº¿n bÃªn ngoÃ i bá»‹ giá»¯ trong memory, khÃ´ng Ä‘Æ°á»£c GC)         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

HÃ£y phÃ¢n tÃ­ch tá»«ng giai Ä‘oáº¡n chi tiáº¿t hÆ¡n:

**Giai Ä‘oáº¡n 1 â€” Allocation (Cáº¥p phÃ¡t):** Xáº£y ra tá»± Ä‘á»™ng khi báº¡n khai bÃ¡o biáº¿n, táº¡o object, gá»i function. V8 engine allocate memory trÃªn heap (cho objects) hoáº·c stack (cho primitives vÃ  execution context). Developer **khÃ´ng cáº§n gá»i** `new Memory()` hay `malloc()` â€” JavaScript lÃ m Ä‘iá»u nÃ y ngáº§m. VÃ­ dá»¥: `let obj = { name: "John" }` â†’ V8 allocate ~64 bytes trÃªn heap cho object, thÃªm ~24 bytes cho string "John", thÃªm pointer trÃªn stack cho biáº¿n `obj`.

**Giai Ä‘oáº¡n 2 â€” Use (Sá»­ dá»¥ng):** Developer Ä‘á»c/ghi values, gá»i methods, pass references. ÄÃ¢y lÃ  pháº§n developers hiá»ƒu rÃµ nháº¥t. NhÆ°ng cÃ³ má»™t Ä‘iá»ƒm subtle: **má»—i operation cÃ³ thá»ƒ táº¡o temporary objects**. VÃ­ dá»¥: `arr.map(x => x * 2)` táº¡o array Má»šI + N closure objects. `str.split(',').join('-')` táº¡o 2 arrays + N strings. Nhá»¯ng temporary objects nÃ y lÃ  "rÃ¡c" tiá»m nÄƒng.

**Giai Ä‘oáº¡n 3 â€” Release (Giáº£i phÃ³ng):** ÄÃ¢y lÃ  pháº§n GC xá»­ lÃ½. NhÆ°ng GC **khÃ´ng cháº¡y liÃªn tá»¥c** â€” nÃ³ chá»‰ cháº¡y khi V8 quyáº¿t Ä‘á»‹nh (thÆ°á»ng khi heap usage vÆ°á»£t ngÆ°á»¡ng, hoáº·c khi CPU idle). Giá»¯a cÃ¡c láº§n GC cháº¡y, memory **tÃ­ch lÅ©y**. ÄÃ¢y lÃ  lÃ½ do tab Chrome cÃ³ thá»ƒ dÃ¹ng 500MB+ dÃ¹ trang web nhÃ¬n Ä‘Æ¡n giáº£n â€” nhiá»u "rÃ¡c" chÆ°a Ä‘Æ°á»£c dá»n.

> **Interview insight**: Khi Ä‘Æ°á»£c há»i "JavaScript quáº£n lÃ½ memory tháº¿ nÃ o?", Ä‘á»«ng chá»‰ nÃ³i "tá»± Ä‘á»™ng". HÃ£y nÃ³i: "JavaScript dÃ¹ng **automatic garbage collection** â€” V8 engine theo dÃµi reachability cá»§a objects tá»« root (global scope, stack). Objects unreachable sáº½ bá»‹ collect. V8 dÃ¹ng **generational GC** â€” Young Generation (Scavenger, minor GC thÆ°á»ng xuyÃªn) vÃ  Old Generation (Mark-Sweep-Compact, major GC Ã­t hÆ¡n). Developer cÃ³ trÃ¡ch nhiá»‡m **trÃ¡nh vÃ´ tÃ¬nh giá»¯ references** â€” closures, globals, event listeners, timers."

### CÆ¡ Cháº¿ GC Cá»§a Browser

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Garbage Collection Trong Browser: KhÃ´ng Chá»‰ LÃ  "Tá»± Äá»™ng Dá»n RÃ¡c"**

JavaScript cÃ³ cÆ¡ cháº¿ **tá»± Ä‘á»™ng thu gom rÃ¡c** (GC: Garbage Collection). Garbage collector **Ä‘á»‹nh ká»³** tÃ¬m cÃ¡c biáº¿n khÃ´ng cÃ²n sá»­ dá»¥ng vÃ  giáº£i phÃ³ng bá»™ nhá»›. NhÆ°ng cÃ¢u nÃ³i ngáº¯n gá»n Ä‘Ã³ **che giáº¥u** má»™t há»‡ thá»‘ng cá»±c ká»³ phá»©c táº¡p bÃªn dÆ°á»›i â€” má»™t há»‡ thá»‘ng mÃ  náº¿u hiá»ƒu sÃ¢u, báº¡n sáº½ viáº¿t code **khÃ¡c hoÃ n toÃ n**.

**Táº¡i sao GC trong browser "Ä‘áº·c biá»‡t" hÆ¡n GC trong cÃ¡c mÃ´i trÆ°á»ng khÃ¡c?**

GC tá»“n táº¡i trong nhiá»u ngÃ´n ngá»¯ â€” Java, Go, C#, Python, Ruby Ä‘á»u cÃ³ GC. NhÆ°ng GC trong **browser JavaScript** Ä‘á»‘i máº·t vá»›i nhá»¯ng constraints mÃ  **khÃ´ng** ngÃ´n ngá»¯ khÃ¡c pháº£i chá»‹u:

1. **60fps constraint**: Browser pháº£i render á»Ÿ 60fps â†’ má»—i frame chá»‰ cÃ³ **16.6ms**. Náº¿u GC pause > 10ms â†’ frame bá»‹ skip â†’ user tháº¥y **jank** (giáº­t). Game server (Java) cÃ³ thá»ƒ cháº¥p nháº­n 50ms pause, browser thÃ¬ **khÃ´ng**.

2. **Shared main thread**: JavaScript, Layout, Paint, vÃ  GC Ä‘á»u cháº¡y trÃªn **cÃ¹ng main thread**. Khi GC cháº¡y, **má»i thá»© khÃ¡c dá»«ng** â€” khÃ´ng pháº£i chá»‰ JS, mÃ  cáº£ UI rendering. ÄÃ¢y lÃ  lÃ½ do GC pause trong browser gÃ¢y **Ä‘Ã³ng bÄƒng cáº£ trang web**, khÃ´ng chá»‰ cháº­m code.

3. **Untrusted code**: Browser cháº¡y code tá»« **nguá»“n khÃ´ng tin cáº­y** â€” ads, third-party scripts, tracking pixels. Náº¿u ad script leak memory, **user Ä‘á»• lá»—i cho trang web**, khÃ´ng pháº£i ad. GC pháº£i robust Ä‘á»§ Ä‘á»ƒ handle code tá»‡ tá»« báº¥t ká»³ nguá»“n nÃ o.

4. **Long-running sessions**: Server restarts má»—i deploy (giáº£i phÃ³ng má»i memory). Browser tab cÃ³ thá»ƒ **má»Ÿ suá»‘t nhiá»u ngÃ y** â€” Gmail, Slack, Notion. Memory leaks tÃ­ch lÅ©y trong context nÃ y trá»Ÿ nÃªn **nghiÃªm trá»ng** hÆ¡n ráº¥t nhiá»u so vá»›i server.

5. **DOM â€” Cross-boundary references**: Chá»‰ browser má»›i cÃ³ DOM. JavaScript objects reference DOM nodes, DOM nodes reference event handlers (JavaScript functions), táº¡o **cross-boundary reference chains** phá»©c táº¡p. GC pháº£i coordinate giá»¯a **JavaScript heap** vÃ  **DOM tree** â€” hai vÃ¹ng nhá»› quáº£n lÃ½ bá»Ÿi hai há»‡ thá»‘ng khÃ¡c nhau trong browser engine.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Táº I SAO BROWSER GC Äáº¶C BIá»†T?                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Server (Java/Go):              Browser (JavaScript):           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ GC cÃ³ dedicated  â”‚          â”‚ GC CHIA Sáºº main thread   â”‚    â”‚
â”‚  â”‚ thread riÃªng     â”‚          â”‚ vá»›i JS, Layout, Paint    â”‚    â”‚
â”‚  â”‚                  â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚ 50ms pause? OK   â”‚          â”‚ 10ms pause = JANK!       â”‚    â”‚
â”‚  â”‚                  â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚ App restart      â”‚          â”‚ Tab má»Ÿ nhiá»u ngÃ y        â”‚    â”‚
â”‚  â”‚ má»—i deploy       â”‚          â”‚ â†’ leak tÃ­ch lÅ©y          â”‚    â”‚
â”‚  â”‚                  â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚ Trusted code     â”‚          â”‚ Untrusted 3rd-party code â”‚    â”‚
â”‚  â”‚                  â”‚          â”‚                          â”‚    â”‚
â”‚  â”‚ KhÃ´ng cÃ³ DOM     â”‚          â”‚ JS â†” DOM cross-refs      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GC vÃ  Event Loop â€” Khi NÃ o GC Thá»±c Sá»± Cháº¡y?**

ÄÃ¢y lÃ  cÃ¢u há»i mÃ  háº§u háº¿t developers **khÃ´ng biáº¿t tráº£ lá»i**: GC cháº¡y **khi nÃ o** chÃ­nh xÃ¡c? KhÃ´ng pháº£i ngáº«u nhiÃªn, khÃ´ng pháº£i "Ä‘á»‹nh ká»³" Ä‘Æ¡n giáº£n. GC trong V8 Ä‘Æ°á»£c **schedule** thÃ´ng minh:

1. **Idle-time GC** (Æ°u tiÃªn cao nháº¥t): V8 hook vÃ o Chrome's **`requestIdleCallback`** internal. Khi main thread idle (khÃ´ng cÃ³ JS, Layout, hay Paint pending) â†’ V8 cháº¡y GC trong **idle time**. ÄÃ¢y lÃ  cÆ¡ cháº¿ lÃ½ tÆ°á»Ÿng â€” GC xáº£y ra **giá»¯a cÃ¡c frames**, user khÃ´ng cáº£m nháº­n.

2. **Allocation-triggered GC**: Khi allocation rate quÃ¡ cao (táº¡o quÃ¡ nhiá»u objects quÃ¡ nhanh, vÃ­ dá»¥ trong animation loop) â†’ heap Ä‘áº§y nhanh hÆ¡n idle intervals â†’ V8 **buá»™c pháº£i** cháº¡y GC **ngay láº­p tá»©c**, dÃ¹ Ä‘ang giá»¯a frame. ÄÃ¢y lÃ  nguyÃªn nhÃ¢n thÆ°á»ng gáº·p nháº¥t cá»§a GC jank.

3. **Memory pressure GC**: Khi OS bÃ¡o hiá»‡u **low memory** (trÃªn mobile phá»• biáº¿n) â†’ browser trigger **aggressive GC** trÃªn táº¥t cáº£ tabs. ÄÃ¢y lÃ  lÃ½ do apps trÃªn mobile hay bá»‹ "reload" khi chuyá»ƒn tab â€” OS kill tab Ä‘á»ƒ láº¥y memory.

```javascript
// Visualize GC timing trong má»™t frame:

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Frame budget: 16.6ms (60fps)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Scenario 1: Ideal â€” GC cháº¡y trong idle time
// |â†â”€â”€ Frame 1 â”€â”€â†’|â†idle â†’|â†â”€â”€ Frame 2 â”€â”€â†’|
// [JS 4ms][Layout 2ms][Paint 3ms][GC 5ms][JS 3ms][Layout 2ms]...
// âœ… User khÃ´ng tháº¥y jank vÃ¬ GC á»Ÿ giá»¯a frames

// Scenario 2: Bad â€” GC forced giá»¯a frame
// |â†â”€â”€ Frame 1 (quÃ¡ 16.6ms!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’|
// [JS 8ms][GC 12ms][Layout 2ms][Paint 3ms]
// âŒ Frame máº¥t 25ms â†’ dropped frame â†’ JANK!

// Scenario 3: Worst â€” Major GC trÃªn huge heap
// |â†â”€â”€ Frame 1 (freeze!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’|
// [JS 5ms][MAJOR GC 80ms][Layout 2ms][Paint 3ms]
// âŒâŒ 90ms = 5-6 dropped frames â†’ visible stutter
```

**So SÃ¡nh GC Engines Giá»¯a CÃ¡c Browsers:**

Má»—i browser engine cÃ³ GC implementation **khÃ¡c nhau** â€” performance vÃ  behavior khÃ´ng Ä‘á»“ng nháº¥t:

| Browser     | Engine               | GC Type                   | Key Technique                    | Pause Target |
| ----------- | -------------------- | ------------------------- | -------------------------------- | ------------ |
| **Chrome**  | V8                   | Generational, Concurrent  | Orinoco (parallel + incremental) | < 5ms        |
| **Firefox** | SpiderMonkey         | Generational, Incremental | Nursery + Tenured, Compacting    | < 10ms       |
| **Safari**  | JavaScriptCore (JSC) | Generational, Concurrent  | Riptide (concurrent copying)     | < 6ms        |
| **Edge**    | V8 (Chromium-based)  | Same as Chrome            | Same as Chrome                   | < 5ms        |

Äiá»ƒm Ä‘Ã¡ng chÃº Ã½:

- **V8 (Chrome)**: Máº¡nh nháº¥t vá» parallel GC â€” táº­n dá»¥ng multiple cores. Orinoco project (2018+) Ä‘áº¡t near-zero pause trÃªn desktop. NhÆ°á»£c Ä‘iá»ƒm: heap size lá»›n hÆ¡n JSC (~20-30% do semi-space overhead).

- **SpiderMonkey (Firefox)**: DÃ¹ng **Nursery** (tÆ°Æ¡ng Ä‘Æ°Æ¡ng Young Generation) + **Tenured** (tÆ°Æ¡ng Ä‘Æ°Æ¡ng Old Generation). CÃ³ unique feature: **Compacting GC** di chuyá»ƒn objects chá»‘ng fragmentation tÃ­ch cá»±c hÆ¡n V8. NhÆ°á»£c Ä‘iá»ƒm: incremental marking chÆ°a parallel báº±ng V8.

- **JavaScriptCore (Safari)**: DÃ¹ng **Riptide** â€” concurrent copying collector cá»±c ká»³ hiá»‡u quáº£ cho mobile (iPhone). JSC Æ°u tiÃªn **memory efficiency** hÆ¡n throughput â€” heap nhá» hÆ¡n V8 ~20-30%. PhÃ¹ há»£p iOS devices vá»›i RAM háº¡n cháº¿. NhÆ°á»£c Ä‘iá»ƒm: throughput tháº¥p hÆ¡n V8 trÃªn heavy workloads.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER GC ENGINE COMPARISON                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  V8 (Chrome):  Throughput champion ğŸ†                            â”‚
â”‚  â”œâ”€â”€ Orinoco: Parallel + Concurrent + Incremental               â”‚
â”‚  â”œâ”€â”€ Semi-space Scavenger cho Young Gen                         â”‚
â”‚  â”œâ”€â”€ Mark-Sweep-Compact cho Old Gen                             â”‚
â”‚  â””â”€â”€ Heap lá»›n nhÆ°ng pause cá»±c ngáº¯n (~1-5ms)                    â”‚
â”‚                                                                 â”‚
â”‚  SpiderMonkey (Firefox):  Balanced approach âš–ï¸                   â”‚
â”‚  â”œâ”€â”€ Nursery (copying collector) cho Young Gen                  â”‚
â”‚  â”œâ”€â”€ Tenured (mark-sweep) cho Old Gen                           â”‚
â”‚  â”œâ”€â”€ Compacting GC giáº£m fragmentation tá»‘t nháº¥t                  â”‚
â”‚  â””â”€â”€ Incremental marking, Ä‘ang cáº£i thiá»‡n parallelism            â”‚
â”‚                                                                 â”‚
â”‚  JavaScriptCore (Safari):  Memory efficiency champion ğŸ“±        â”‚
â”‚  â”œâ”€â”€ Riptide: Concurrent copying collector                      â”‚
â”‚  â”œâ”€â”€ Tá»‘i Æ°u cho iOS â€” Ã­t RAM, Ã­t cores                          â”‚
â”‚  â”œâ”€â”€ Heap nhá» nháº¥t trong 3 engines                              â”‚
â”‚  â””â”€â”€ Trade-off: throughput tháº¥p hÆ¡n V8 trÃªn desktop             â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Lesson: CÃ¹ng JavaScript code, GC behavior KHÃC NHAU         â”‚
â”‚     giá»¯a Chrome, Firefox, Safari â†’ test cross-browser!          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**GC-Safe Points â€” Táº¡i Sao GC KhÃ´ng Thá»ƒ Cháº¡y Báº¥t Ká»³ LÃºc NÃ o?**

GC **khÃ´ng thá»ƒ** interrupt JavaScript á»Ÿ báº¥t ká»³ instruction nÃ o. NÃ³ chá»‰ cÃ³ thá»ƒ cháº¡y táº¡i **safe points** â€” nhá»¯ng vá»‹ trÃ­ trong code mÃ  engine biáº¿t **tráº¡ng thÃ¡i heap consistent**. Safe points thÆ°á»ng á»Ÿ:

- **Function calls/returns** â€” stack frame boundaries
- **Loop back-edges** â€” cuá»‘i má»—i iteration trong loop (Ä‘Ã¢y lÃ  lÃ½ do `while(true) { x++ }` khÃ´ng block GC â€” cÃ³ safe point cuá»‘i má»—i vÃ²ng)
- **Allocation sites** â€” má»—i khi V8 allocate object má»›i, nÃ³ kiá»ƒm tra cÃ³ cáº§n GC khÃ´ng

Náº¿u JavaScript cháº¡y **tight loop** khÃ´ng cÃ³ allocation hay function call (hiáº¿m trong practice, nhÆ°ng kháº£ thi trong tÃ­nh toÃ¡n náº·ng), GC **khÃ´ng thá»ƒ interrupt** â†’ heap tiáº¿p tá»¥c grow â†’ potential OOM. ÄÃ¢y lÃ  edge case mÃ  V8 xá»­ lÃ½ báº±ng cÃ¡ch **inject** safe points vÃ o compiled code.

```javascript
// Safe points trong thá»±c táº¿:

function processLargeArray(arr) {
  let result = 0;

  for (let i = 0; i < arr.length; i++) {
    // â† V8 insert safe point á»Ÿ Ä‘áº§u má»—i iteration
    //    GC CÃ“ THá»‚ cháº¡y táº¡i Ä‘Ã¢y náº¿u cáº§n

    result += heavyComputation(arr[i]); // â† function call = safe point

    // â† V8 insert safe point á»Ÿ cuá»‘i má»—i iteration (back-edge)
  }

  return result;
}

// âš ï¸ Edge case: tight computation loop
function intenseMath() {
  let x = 0;
  for (let i = 0; i < 1_000_000_000; i++) {
    x += Math.sin(i) * Math.cos(i);
    // Math.sin/cos lÃ  native calls â†’ safe point
    // NhÆ°ng náº¿u chá»‰ x += i * i â†’ V8 váº«n inject safe point
    // vÃ¬ back-edge checking
  }
  return x;
}
```

**Performance Implications â€” áº¢nh HÆ°á»Ÿng Thá»±c Táº¿ Trong Production**

Hiá»ƒu GC browser khÃ´ng pháº£i chá»‰ Ä‘á»ƒ interview â€” nÃ³ áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n **UX** cá»§a á»©ng dá»¥ng:

**Allocation Pressure â€” Hidden Performance Killer:**

Má»—i object allocation tÄƒng **allocation pressure** trÃªn Young Generation. Khi allocation rate vÆ°á»£t quÃ¡ GC throughput â†’ **frequent Minor GCs** â†’ nhiá»u short pauses tÃ­ch lÅ©y â†’ app cáº£m tháº¥y **"sluggish"** dÃ¹ khÃ´ng cÃ³ single long pause. ÄÃ¢y lÃ  lÃ½ do React team obsess vá» avoiding unnecessary re-renders â€” má»—i render táº¡o hÃ ng chá»¥c temporary objects.

```javascript
// âŒ High allocation pressure â€” táº¡o garbage má»—i frame
function animate() {
  // Má»—i frame táº¡o object Má»šI â€” 60 objects/giÃ¢y!
  const position = { x: Math.random() * 100, y: Math.random() * 100 };
  const style = `translate(${position.x}px, ${position.y}px)`;
  element.style.transform = style;

  requestAnimationFrame(animate);
}
// 60fps Ã— {position, style} = 120 garbage objects/giÃ¢y
// GC pháº£i collect chÃºng liÃªn tá»¥c â†’ allocation pressure

// âœ… Low allocation pressure â€” reuse objects
const position = { x: 0, y: 0 }; // Allocate Má»˜T Láº¦N

function animate() {
  position.x = Math.random() * 100; // Mutate, khÃ´ng táº¡o má»›i
  position.y = Math.random() * 100;
  element.style.transform = `translate(${position.x}px, ${position.y}px)`;

  requestAnimationFrame(animate);
}
// Chá»‰ táº¡o 1 template literal string/frame â†’ Ã­t pressure hÆ¡n ráº¥t nhiá»u
```

**Object Pooling â€” Pattern Giáº£m GC Pressure Cho Animation/Game:**

Trong game development vÃ  heavy animation, **object pooling** lÃ  pattern phá»• biáº¿n: pre-allocate má»™t pool objects, **reuse** chÃºng thay vÃ¬ allocate/GC liÃªn tá»¥c. V8 GC trá»Ÿ nÃªn gáº§n nhÆ° invisible khi khÃ´ng cÃ³ objects má»›i cáº§n collect.

```javascript
// Object Pool pattern â€” zero garbage in hot path
class ParticlePool {
  constructor(size) {
    this.pool = Array.from({ length: size }, () => ({
      x: 0,
      y: 0,
      vx: 0,
      vy: 0,
      active: false,
    }));
    this.activeCount = 0;
  }

  acquire() {
    // Reuse existing object â€” NO allocation!
    for (const p of this.pool) {
      if (!p.active) {
        p.active = true;
        this.activeCount++;
        return p;
      }
    }
    return null; // Pool exhausted
  }

  release(particle) {
    particle.active = false;
    particle.x = particle.y = particle.vx = particle.vy = 0;
    this.activeCount--;
    // Object stays in pool â€” NO garbage created!
  }
}

const pool = new ParticlePool(1000); // Allocate 1000 particles UPFRONT

// In animation loop:
function update() {
  const p = pool.acquire(); // Reuse, khÃ´ng new
  p.x = 100;
  p.y = 200;
  // ... animate ...
  pool.release(p); // Return, khÃ´ng delete
  requestAnimationFrame(update);
}
// GC cÃ³ Ráº¤T ÃT viá»‡c pháº£i lÃ m â†’ smooth 60fps âœ…
```

> **Interview insight**: Khi Ä‘Æ°á»£c há»i "LÃ m sao tá»‘i Æ°u GC performance trong browser?", hÃ£y nÃ³i: "3 strategies chÃ­nh: (1) **Giáº£m allocation rate** â€” reuse objects, trÃ¡nh táº¡o temporaries trong hot paths. (2) **Break large data operations** â€” dÃ¹ng `requestIdleCallback` hoáº·c Web Worker Ä‘á»ƒ V8 cÃ³ idle time cháº¡y GC. (3) **Monitor GC** â€” dÃ¹ng `performance.measureUserAgentSpecificMemory()` (Chrome 89+) hoáº·c DevTools Performance panel Ä‘á»ƒ detect GC pauses vÃ  allocation spikes."

---

**KhÃ¡i niá»‡m cá»‘t lÃµi â€” Reachability (Kháº£ nÄƒng truy cáº­p):**

ÄÃ¢y lÃ  concept quan trá»ng nháº¥t Ä‘á»ƒ hiá»ƒu má»i GC algorithm. Má»™t object Ä‘Æ°á»£c gá»i lÃ  **reachable** (cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c) náº¿u tá»“n táº¡i **Ã­t nháº¥t má»™t Ä‘Æ°á»ng Ä‘i** (chain of references) tá»« má»™t **root** Ä‘áº¿n object Ä‘Ã³. Roots trong JavaScript bao gá»“m:

- **Global object** (`window` trong browser, `global` trong Node.js)
- **Call stack** â€” táº¥t cáº£ local variables vÃ  parameters cá»§a cÃ¡c functions Ä‘ang execute
- **Microtask/Macrotask queues** â€” callbacks Ä‘ang chá» execute
- **Internal references** â€” DOM elements hiá»ƒn thá»‹ trÃªn page, active event listeners, vv.

Má»i object mÃ  **KHÃ”NG reachable tá»« báº¥t ká»³ root nÃ o** Ä‘Æ°á»£c coi lÃ  "rÃ¡c" (garbage) â€” GC cÃ³ quyá»n thu há»“i memory cá»§a nÃ³. ÄÃ¢y lÃ  lÃ½ do `let obj = {}; obj = null;` cho phÃ©p GC thu há»“i: sau khi gÃ¡n `null`, object `{}` khÃ´ng cÃ²n reachable tá»« báº¥t ká»³ root nÃ o.

**Reachability Trong Thá»±c Táº¿ â€” Nhá»¯ng TrÆ°á»ng Há»£p KhÃ´ng RÃµ RÃ ng:**

KhÃ¡i niá»‡m reachability nghe Ä‘Æ¡n giáº£n, nhÆ°ng trong production code, **ranh giá»›i giá»¯a reachable vÃ  unreachable** thÆ°á»ng má» nháº¡t. Nhiá»u objects mÃ  developer "nghÄ©" Ä‘Ã£ unreachable thá»±c táº¿ **váº«n reachable** qua nhá»¯ng Ä‘Æ°á»ng dáº«n báº¥t ngá»:

```javascript
// TrÆ°á»ng há»£p 1: Console giá»¯ reference!
function createHeavy() {
  const heavy = new Array(1_000_000).fill("data"); // 8MB
  console.log(heavy); // â† DevTools Console GIá»® reference Ä‘áº¿n heavy!
  return null;
}
createHeavy();
// NghÄ© heavy sáº½ bá»‹ GC? SAI!
// Khi DevTools má»Ÿ, console.log giá»¯ reference Ä‘á»ƒ user cÃ³ thá»ƒ inspect
// â†’ heavy KHÃ”NG bá»‹ GC cho Ä‘áº¿n khi clear console
// â†’ ÄÃ¢y lÃ  lÃ½ do memory profiling nÃªn cháº¡y vá»›i DevTools Ä‘Ã³ng

// TrÆ°á»ng há»£p 2: Closure capture nhiá»u hÆ¡n báº¡n nghÄ©
function setup() {
  const config = { api: "...", key: "..." }; // Nhá» - OK
  const cache = new Map(); // Lá»›n - chá»©a 10000 entries

  return function handler() {
    // handler chá»‰ dÃ¹ng config, KHÃ”NG dÃ¹ng cache
    return fetch(config.api);
  };
  // NhÆ°ng V8 CÃ“ THá»‚ capture cáº£ cache trong closure scope!
  // (TÃ¹y optimization level - unoptimized code capture toÃ n bá»™ scope)
  // â†’ cache bá»‹ giá»¯ alive bá»Ÿi handler â†’ LEAK!

  // âœ… FIX: Explicit scope
  // const { api } = config;
  // return function handler() { return fetch(api); }
}

// TrÆ°á»ng há»£p 3: Prototype chain giá»¯ objects alive
class Component {
  constructor() {
    this.data = loadHeavyData(); // 50MB
  }
}
const instance = new Component();
const reference = Object.getPrototypeOf(instance);
instance = null; // instance bá»‹ GC...
// NhÆ°ng náº¿u cÃ³ code khÃ¡c giá»¯ reference Ä‘áº¿n prototype
// â†’ prototype chain váº«n alive â†’ KHÃ”NG áº£nh hÆ°á»Ÿng GC
// (prototype lÃ  shared, khÃ´ng pháº£i per-instance)
```

**Weak References â€” Khi Báº¡n Muá»‘n "Biáº¿t" Object Tá»“n Táº¡i MÃ  KhÃ´ng NgÄƒn GC:**

ES2021 giá»›i thiá»‡u `WeakRef` vÃ  `FinalizationRegistry` â€” **game changer** cho memory management. ChÃºng cho phÃ©p báº¡n giá»¯ "weak" reference Ä‘áº¿n object â€” reference **khÃ´ng ngÄƒn GC** thu há»“i object Ä‘Ã³:

```javascript
// WeakRef â€” Reference "yáº¿u" khÃ´ng ngÄƒn GC
let heavyObject = { data: new Array(1_000_000).fill("x") };
const weakRef = new WeakRef(heavyObject);

// Truy cáº­p qua weak reference
console.log(weakRef.deref()?.data.length); // 1000000 âœ…

// Giáº£i phÃ³ng strong reference
heavyObject = null;

// Sau GC cycle...
// weakRef.deref() === undefined
// â†’ Object Ä‘Ã£ bá»‹ GC dÃ¹ weakRef váº«n tá»“n táº¡i!

// FinalizationRegistry â€” Callback khi object bá»‹ GC
const registry = new FinalizationRegistry((heldValue) => {
  console.log(`Object "${heldValue}" Ä‘Ã£ bá»‹ GC!`);
  // Cleanup: Ä‘Ã³ng file handles, cancel network requests, v.v.
});

let resource = createExpensiveResource();
registry.register(resource, "my-resource"); // ÄÄƒng kÃ½ cleanup

resource = null; // Khi GC collect â†’ log: "Object "my-resource" Ä‘Ã£ bá»‹ GC!"

// âš ï¸ Cáº¢NH BÃO: FinalizationRegistry callback timing KHÃ”NG deterministic
// Callback cÃ³ thá»ƒ cháº¡y ngay hoáº·c sau vÃ i phÃºt â€” KHÃ”NG rely on it
// cho critical logic. Chá»‰ dÃ¹ng cho cleanup/monitoring.
```

**WeakMap & WeakSet â€” Production-Ready Weak References:**

Trong thá»±c táº¿, `WeakRef` Ã­t Ä‘Æ°á»£c dÃ¹ng trá»±c tiáº¿p (vÃ¬ `deref()` API cá»“ng ká»nh). **`WeakMap`** vÃ  **`WeakSet`** lÃ  weak reference primitives phá»• biáº¿n hÆ¡n â€” vÃ  chÃºng cÃ³ tá»« **ES2015** (khÃ´ng pháº£i ES2021):

```javascript
// WeakMap â€” Cache object metadata mÃ  khÃ´ng ngÄƒn GC
const domMetadata = new WeakMap();

function trackElement(element) {
  domMetadata.set(element, {
    clickCount: 0,
    lastInteraction: Date.now(),
    customData: computeExpensiveMetadata(element),
  });
}

// Khi element bá»‹ remove khá»i DOM vÃ  khÃ´ng cÃ²n reference:
// â†’ WeakMap entry Tá»° Äá»˜NG bá»‹ xÃ³a bá»Ÿi GC
// â†’ Metadata Ä‘Æ°á»£c giáº£i phÃ³ng â€” NO LEAK!

// So sÃ¡nh vá»›i Map (strong reference):
const leakyCache = new Map();
function trackElementLeaky(element) {
  leakyCache.set(element, {
    /* metadata */
  });
}
// element bá»‹ remove khá»i DOM NHÆ¯NG leakyCache váº«n giá»¯ reference
// â†’ element KHÃ”NG bá»‹ GC â†’ metadata KHÃ”NG bá»‹ GC â†’ LEAK!
```

---

**Lá»‹ch sá»­ phÃ¡t triá»ƒn GC algorithms:**

GC khÃ´ng pháº£i concept má»›i â€” nÃ³ Ä‘Æ°á»£c phÃ¡t minh bá»Ÿi **John McCarthy** nÄƒm 1959 cho ngÃ´n ngá»¯ **Lisp**, trÆ°á»›c cáº£ khi C ra Ä‘á»i (1972). Trong 60+ nÄƒm qua, nhiá»u GC algorithms Ä‘Ã£ Ä‘Æ°á»£c phÃ¡t triá»ƒn, má»—i cÃ¡i cÃ³ tradeoffs khÃ¡c nhau. JavaScript browsers Ä‘Ã£ sá»­ dá»¥ng 3 approaches chÃ­nh qua cÃ¡c thá»i ká»³:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GC ALGORITHMS COMPARISON                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Algorithm        â”‚  Used By         â”‚  Mechanism           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Mark-and-Sweep   â”‚ Most browsers    â”‚ Mark reachable â†’     â”‚ â”‚
â”‚  â”‚                  â”‚ (standard)       â”‚ sweep unmarked       â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Reference Lookup â”‚ Chrome (V8)      â”‚ Periodically check   â”‚ â”‚
â”‚  â”‚                  â”‚                  â”‚ if memory has refs   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Reference Count  â”‚ IE (legacy)      â”‚ Count refs to each   â”‚ â”‚
â”‚  â”‚                  â”‚                  â”‚ object, GC when = 0  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

HÃ£y Ä‘Ã o sÃ¢u tá»«ng algorithm â€” khÃ´ng chá»‰ **cÃ¡ch hoáº¡t Ä‘á»™ng**, mÃ  cáº£ **táº¡i sao** nÃ³ Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° váº­y, **Æ°u nhÆ°á»£c Ä‘iá»ƒm**, vÃ  **khi nÃ o** nÃ³ tháº¥t báº¡i.

### 1. Mark-and-Sweep (ÄÃ¡nh Dáº¥u & QuÃ©t) â€” Phá»• Biáº¿n Nháº¥t

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Mark-and-Sweep: Algorithm Ná»n Táº£ng Cá»§a Má»i Modern GC**

Mark-and-Sweep lÃ  algorithm GC **cá»• Ä‘iá»ƒn nháº¥t** vÃ  váº«n lÃ  **ná»n táº£ng** cho má»i modern GC implementation (bao gá»“m V8). ÄÆ°á»£c John McCarthy mÃ´ táº£ tá»« 1960, Ã½ tÆ°á»Ÿng cá»±c ká»³ Ä‘Æ¡n giáº£n nhÆ°ng elegant:

- **Phase 1 â€” Mark**: Báº¯t Ä‘áº§u tá»« táº¥t cáº£ roots (global, call stack, ...), Ä‘i theo má»i reference chains vÃ  "Ä‘Ã¡nh dáº¥u" (mark) táº¥t cáº£ objects mÃ  báº¡n gáº·p. Objects Ä‘Æ°á»£c mark = **"Ä‘ang sá»‘ng"** (alive).
- **Phase 2 â€” Sweep**: QuÃ©t qua **toÃ n bá»™ heap**. Má»i object **KHÃ”NG** Ä‘Æ°á»£c mark = **"rÃ¡c"** â†’ giáº£i phÃ³ng memory.

Äiá»ƒm brilliant cá»§a algorithm nÃ y: nÃ³ **tá»± Ä‘á»™ng xá»­ lÃ½ circular references**. DÃ¹ object A trá» Ä‘áº¿n B vÃ  B trá» Ä‘áº¿n A (circular reference), náº¿u khÃ´ng cÃ³ root nÃ o trá» Ä‘áº¿n A hoáº·c B â†’ cáº£ hai **Ä‘á»u khÃ´ng Ä‘Æ°á»£c mark** â†’ cáº£ hai bá»‹ sweep. ÄÃ¢y lÃ  Æ°u Ä‘iá»ƒm quyáº¿t Ä‘á»‹nh so vá»›i Reference Counting (sáº½ phÃ¢n tÃ­ch á»Ÿ pháº§n sau).

**Tri-color Marking â€” CÃ¡ch Modern Engines Thá»±c Sá»± Implement:**

Trong thá»±c táº¿, modern engines (V8, SpiderMonkey) khÃ´ng dÃ¹ng binary mark (marked/unmarked) mÃ  dÃ¹ng **tri-color marking** â€” má»—i object á»Ÿ 1 trong 3 tráº¡ng thÃ¡i:

- âšª **White (tráº¯ng)**: chÆ°a Ä‘Æ°á»£c visit â†’ potentially garbage
- ğŸ”˜ **Grey (xÃ¡m)**: Ä‘Ã£ Ä‘Æ°á»£c discover nhÆ°ng chÆ°a scan háº¿t references â†’ Ä‘ang xá»­ lÃ½
- âš« **Black (Ä‘en)**: Ä‘Ã£ visit vÃ  scan háº¿t táº¥t cáº£ references â†’ confirmed alive

Algorithm báº¯t Ä‘áº§u: má»i object = white. Roots Ä‘Æ°á»£c Ä‘Ã¡nh grey. Sau Ä‘Ã³ láº·p: láº¥y má»™t grey object, scan má»i references cá»§a nÃ³ (Ä‘Ã¡nh grey cho white children), rá»“i Ä‘Ã¡nh black cho nÃ³. Khi **khÃ´ng cÃ²n grey objects** â†’ má»i white objects = garbage â†’ sweep.

Tri-color cho phÃ©p **incremental marking** â€” GC cÃ³ thá»ƒ pause giá»¯a chá»«ng, quay láº¡i execute JavaScript, rá»“i resume marking mÃ  khÃ´ng máº¥t state. ÄÃ¢y lÃ  cÃ¡ch V8 trÃ¡nh **"stop-the-world" pauses** dÃ i â€” critical cho smooth 60fps UI.

**NhÆ°á»£c Ä‘iá»ƒm cá»§a Mark-and-Sweep:**

1. **Stop-the-world**: DÃ¹ vá»›i incremental marking, váº«n cÃ³ short pauses khi GC cháº¡y. Trong applications cáº§n real-time (games, audio processing), ngay cáº£ 1ms pause cÅ©ng gÃ¢y noticeable jank.
2. **Memory fragmentation**: Sau khi sweep, heap cÃ³ "holes" (vÃ¹ng nhá»› trá»‘ng) giá»¯a cÃ¡c live objects. Allocating objects lá»›n cÃ³ thá»ƒ fail dÃ¹ tá»•ng free memory Ä‘á»§ â€” giá»‘ng nhÆ° bÃ£i Ä‘á»— xe cÃ³ nhiá»u Ã´ trá»‘ng ráº£i rÃ¡c nhÆ°ng khÃ´ng xe bus nÃ o Ä‘á»— vá»«a.
3. **Scan toÃ n bá»™ heap**: Sweep phase pháº£i scan **má»i object** trÃªn heap, ká»ƒ cáº£ alive objects. Heap cÃ ng lá»›n, sweep cÃ ng cháº­m.

CÃ¡c váº¥n Ä‘á» nÃ y dáº«n Ä‘áº¿n sá»± ra Ä‘á»i cá»§a **Mark-Compact** (giáº£i quyáº¿t fragmentation) vÃ  **Generational GC** (giáº£i quyáº¿t scan toÃ n bá»™ heap) â€” sáº½ phÃ¢n tÃ­ch á»Ÿ pháº§n V8 Engine.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MARK-AND-SWEEP ALGORITHM                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi biáº¿n VÃ€O execution environment â†’ Ä‘Ã¡nh dáº¥u "entering"     â”‚
â”‚  Khi biáº¿n Rá»œI execution environment â†’ Ä‘Ã¡nh dáº¥u "leaving"       â”‚
â”‚  GC Há»¦Y cÃ¡c giÃ¡ trá»‹ Ä‘Ã£ Ä‘Ã¡nh dáº¥u "leaving" & thu há»“i bá»™ nhá»›    â”‚
â”‚                                                                 â”‚
â”‚  PHASE 1: MARK (ÄÃ¡nh dáº¥u)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Root (window/global)                                    â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â”œâ”€â”€â†’ var a = {} â”€â”€â”€â†’ âœ… REACHABLE (marked)         â”‚   â”‚
â”‚  â”‚       â”‚         â”‚                                        â”‚   â”‚
â”‚  â”‚       â”‚         â””â”€â”€â†’ { x: 1 } â”€â”€â”€â†’ âœ… REACHABLE          â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â”œâ”€â”€â†’ var b = [] â”€â”€â”€â†’ âœ… REACHABLE (marked)         â”‚   â”‚
â”‚  â”‚       â”‚                                                  â”‚   â”‚
â”‚  â”‚       â””â”€â”€â†’ (no ref) â”€â”€â†’ { orphan: true }                â”‚   â”‚
â”‚  â”‚                              âŒ UNREACHABLE               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  PHASE 2: SWEEP (QuÃ©t)                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ… Marked objects â†’ KEEP                                 â”‚   â”‚
â”‚  â”‚  âŒ Unmarked objects â†’ DELETE & free memory               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// Mark-and-Sweep example

function processData() {
  let localObj = { data: "hello" }; // Allocate â†’ marked "entering"
  let temp = [1, 2, 3]; // Allocate â†’ marked "entering"

  // ... sá»­ dá»¥ng localObj vÃ  temp ...

  return localObj.data;
}
// Khi function káº¿t thÃºc:
// localObj â†’ marked "leaving" â†’ GC sáº½ thu há»“i
// temp     â†’ marked "leaving" â†’ GC sáº½ thu há»“i
// Cáº£ hai khÃ´ng cÃ²n reachable tá»« root

// âš ï¸ NhÆ°ng náº¿u return reference ra ngoÃ i:
function createObj() {
  let obj = { data: "persist" };
  return obj; // reference escape ra ngoÃ i!
}

let kept = createObj();
// obj váº«n REACHABLE qua biáº¿n `kept` â†’ KHÃ”NG bá»‹ GC
// Pháº£i set kept = null Ä‘á»ƒ GC thu há»“i
```

### 2. Reference Counting (Äáº¿m Tham Chiáº¿u) â€” IE Legacy

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Reference Counting: Algorithm ÄÆ¡n Giáº£n NhÆ°ng Cháº¿t NgÆ°á»i**

Reference Counting (RC) lÃ  GC algorithm **Ä‘Æ¡n giáº£n nháº¥t** vá» máº·t concept: má»—i object cÃ³ má»™t counter Ä‘áº¿m **sá»‘ references** trá» Ä‘áº¿n nÃ³. Khi counter vá» **0** â†’ khÃ´ng ai dÃ¹ng ná»¯a â†’ GC ngay láº­p tá»©c.

**Æ¯u Ä‘iá»ƒm lÃ½ thuyáº¿t:**

- **Reclaim tá»©c thÃ¬**: Object bá»‹ GC ngay khi háº¿t references, khÃ´ng pháº£i Ä‘á»£i GC cycle. Memory freed ngay = Ã­t waste.
- **KhÃ´ng cáº§n scan toÃ n bá»™ heap**: KhÃ´ng cÃ³ sweep phase â€” chá»‰ cáº§n decrement counter khi reference bá»‹ xÃ³a.
- **Deterministic**: Developer biáº¿t chÃ­nh xÃ¡c **khi nÃ o** object bá»‹ GC (khi counter = 0).

**NhÆ°ng táº¡i sao nÃ³ tháº¥t báº¡i? â€” Circular Reference Problem:**

ÄÃ¢y lÃ  **fatal flaw** khiáº¿n RC bá»‹ loáº¡i bá» khá»i má»i modern browser. Khi hai objects reference **láº«n nhau** (circular reference), counter cá»§a cáº£ hai **khÃ´ng bao giá»** vá» 0 â€” dÃ¹ khÃ´ng cÃ³ root nÃ o trá» Ä‘áº¿n chÃºng. Memory bá»‹ leak **vÄ©nh viá»…n**.

ÄÃ¢y khÃ´ng pháº£i edge case â€” circular references **cá»±c ká»³ phá»• biáº¿n** trong real-world JavaScript:

- DOM node cÃ³ event listener â†’ listener closure reference node â†’ **circular**
- Parent object chá»©a child, child cÃ³ reference ngÆ°á»£c parent â†’ **circular**
- Observer pattern: subject references observer, observer references subject â†’ **circular**

**Case study lá»‹ch sá»­ â€” Internet Explorer 6-7 Memory Leaks:**

IE 6 vÃ  7 sá»­ dá»¥ng Reference Counting cho **COM objects** (bao gá»“m DOM elements), trong khi JavaScript engine (JScript) dÃ¹ng Mark-and-Sweep. Váº¥n Ä‘á»: khi JavaScript object reference DOM element (COM) vÃ  DOM element reference JavaScript object (qua event handler) â†’ **cross-boundary circular reference**. JScript's Mark-and-Sweep khÃ´ng thá»ƒ scan COM objects, vÃ  COM's Reference Counting khÃ´ng thá»ƒ detect circular. Káº¿t quáº£: **massive memory leak** má»—i khi attach event listener vÃ o DOM element.

ÄÃ¢y lÃ  lÃ½ do táº¡i sao jQuery pattern `$(element).on('click', handler)` vÃ  Ä‘áº·c biá»‡t cleanup trong `$(element).off()` / `.remove()` trá»Ÿ thÃ nh **critical practice** thá»i IE6. VÃ  táº¡i sao web developers tháº¿ há»‡ 2005-2010 há»c thuá»™c nguyÃªn táº¯c "always remove event listeners".

IE8 chuyá»ƒn sang Mark-and-Sweep cho cáº£ COM, giáº£i quyáº¿t váº¥n Ä‘á» hoÃ n toÃ n. NgÃ y nay, **khÃ´ng browser nÃ o** cÃ²n dÃ¹ng pure Reference Counting.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REFERENCE COUNTING (Internet Explorer)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Má»—i láº§n bá»™ nhá»› bá»‹ chiáº¿m dá»¥ng â†’ count +1                       â”‚
â”‚  Má»—i láº§n bá»‹ loáº¡i bá» khá»i bá»™ nhá»› â†’ count -1                     â”‚
â”‚  Khi count = 0 â†’ browser thu há»“i bá»™ nhá»›                        â”‚
â”‚                                                                 â”‚
â”‚  let obj = { a: 1 };    // { a: 1 } refCount = 1               â”‚
â”‚  let ref = obj;          // { a: 1 } refCount = 2               â”‚
â”‚  obj = null;             // { a: 1 } refCount = 1               â”‚
â”‚  ref = null;             // { a: 1 } refCount = 0 â†’ ğŸ—‘ï¸ GC!     â”‚
â”‚                                                                 â”‚
â”‚  âŒ FATAL FLAW: Circular Reference (tham chiáº¿u vÃ²ng)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  let a = {};          // a refCount = 1                   â”‚   â”‚
â”‚  â”‚  let b = {};          // b refCount = 1                   â”‚   â”‚
â”‚  â”‚  a.ref = b;           // b refCount = 2                   â”‚   â”‚
â”‚  â”‚  b.ref = a;           // a refCount = 2                   â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  a = null;            // a refCount = 1 (b.ref váº«n trá»)  â”‚   â”‚
â”‚  â”‚  b = null;            // b refCount = 1 (a.ref váº«n trá»)  â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  âš ï¸ refCount KHÃ”NG BAO GIá»œ vá» 0 â†’ MEMORY LEAK!           â”‚   â”‚
â”‚  â”‚  âš ï¸ Mark-and-Sweep KHÃ”NG cÃ³ váº¥n Ä‘á» nÃ y                    â”‚   â”‚
â”‚  â”‚     (cáº£ hai unreachable tá»« root â†’ sáº½ bá»‹ GC)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. V8 Engine (Chrome) â€” Generational GC

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Generational GC: Kiáº¿n TrÃºc GC Thá»±c Sá»± Cá»§a Chrome**

Mark-and-Sweep lÃ  ná»n táº£ng lÃ½ thuyáº¿t, nhÆ°ng V8 engine **khÃ´ng dÃ¹ng** Mark-and-Sweep Ä‘Æ¡n thuáº§n. V8 implement má»™t há»‡ thá»‘ng GC phá»©c táº¡p hÆ¡n ráº¥t nhiá»u gá»i lÃ  **Generational Garbage Collection** â€” dá»±a trÃªn má»™t observation quan trá»ng tá»« nghiÃªn cá»©u nÄƒm 1984 cá»§a **David Ungar**:

> **"Generational Hypothesis"** (Giáº£ thuyáº¿t tháº¿ há»‡): Háº§u háº¿t objects **cháº¿t tráº»** (die young). Pháº§n lá»›n objects Ä‘Æ°á»£c táº¡o ra, dÃ¹ng trong thá»i gian ráº¥t ngáº¯n, rá»“i trá»Ÿ thÃ nh garbage. Chá»‰ má»™t tá»· lá»‡ nhá» objects sá»‘ng lÃ¢u.

Äiá»u nÃ y Ä‘áº·c biá»‡t Ä‘Ãºng trong JavaScript/React applications. NghÄ© vá» má»—i láº§n React render: hÃ ng chá»¥c JSX element objects, props objects, callback closures, intermediate arrays tá»« `.map()` â€” táº¥t cáº£ Ä‘á»u **tá»“n táº¡i trong vÃ i milliseconds** rá»“i trá»Ÿ thÃ nh rÃ¡c. Trong khi Ä‘Ã³, Redux store, route configuration, cached API responses â€” nhá»¯ng objects nÃ y tá»“n táº¡i **suá»‘t Ä‘á»i** app.

Dá»±a trÃªn observation nÃ y, V8 chia heap thÃ nh 2 vÃ¹ng (generations) vá»›i **GC strategies hoÃ n toÃ n khÃ¡c nhau** â€” tá»‘i Æ°u cho tá»«ng loáº¡i object lifecycle:

**Young Generation â€” Scavenger (Minor GC):**

ÄÃ¢y lÃ  nÆ¡i **má»i object má»›i** Ä‘Æ°á»£c allocate. VÃ¹ng nÃ y nhá» (thÆ°á»ng 1-8MB) nhÆ°ng GC **cá»±c nhanh** â€” chá»‰ ~1-2ms. Scavenger dÃ¹ng **semi-space copying** algorithm:

1. Young Generation chia thÃ nh 2 semi-spaces báº±ng nhau: **From-space** (active) vÃ  **To-space** (empty)
2. Objects má»›i allocate trong From-space
3. Khi From-space Ä‘áº§y â†’ Scavenger cháº¡y:
   - Scan roots â†’ tÃ¬m alive objects trong From-space
   - **Copy** alive objects sang To-space (compacted, no fragmentation)
   - **Swap** From vÃ  To (To trá»Ÿ thÃ nh From, From cÅ© bá»‹ wipe sáº¡ch)
4. Object sá»‘ng sÃ³t **2 láº§n** Scavenger â†’ **promote** sang Old Generation

Táº¡i sao copy-based? VÃ¬ theo Generational Hypothesis, **Ä‘a sá»‘ objects cháº¿t** â†’ chá»‰ cáº§n copy **Ã­t objects sá»‘ng** (thÆ°á»ng <20%). Nhanh hÆ¡n ráº¥t nhiá»u so vá»›i scan toÃ n bá»™ heap.

**Old Generation â€” Mark-Sweep-Compact (Major GC):**

Objects survive 2 Scavenger cycles â†’ promoted sang Old Generation (hÃ ng trÄƒm MB). GC á»Ÿ Ä‘Ã¢y dÃ¹ng **Mark-Sweep** (Ä‘Ã£ giáº£i thÃ­ch á»Ÿ trÃªn) káº¿t há»£p **Mark-Compact**:

- **Mark-Sweep**: ÄÃ¡nh dáº¥u reachable â†’ xÃ³a unreachable. Nhanh nhÆ°ng táº¡o fragmentation.
- **Mark-Compact**: Sau sweep, **dá»“n** (compact) live objects láº¡i gáº§n nhau â†’ loáº¡i bá» fragmentation. Cháº­m hÆ¡n nhÆ°ng cáº£i thiá»‡n memory utilization vÃ  allocation speed.

V8 quyáº¿t Ä‘á»‹nh dÃ¹ng Sweep hay Compact **tÃ¹y má»©c fragmentation** â€” adaptive strategy.

**Orinoco â€” V8's State-of-the-Art GC Architecture:**

Tá»« 2018, V8 team giá»›i thiá»‡u **Orinoco** â€” project nÃ¢ng cáº¥p GC vá»›i 3 techniques quan trá»ng:

1. **Parallel GC**: Sá»­ dá»¥ng **nhiá»u helper threads** Ä‘á»ƒ mark objects song song. Major GC trÃªn heap 100MB+ giáº£m tá»« ~100ms xuá»‘ng ~10ms.
2. **Concurrent GC**: GC **cháº¡y song song** vá»›i JavaScript execution. Marking xáº£y ra trÃªn background thread trong khi main thread váº«n execute JS. Write barriers Ä‘áº£m báº£o consistency.
3. **Incremental GC**: Chia marking thÃ nh **nhiá»u bÆ°á»›c nhá»** xen káº½ JS execution. Má»—i bÆ°á»›c ~1ms. User khÃ´ng cáº£m nháº­n pause.

Káº¿t há»£p cáº£ 3, V8's GC pause trÃªn typical web app giáº£m tá»« **hÃ ng trÄƒm ms** (2015) xuá»‘ng **dÆ°á»›i 5ms** (2024) â€” gáº§n nhÆ° imperceptible. ÄÃ¢y lÃ  lÃ½ do Chrome ngÃ y nay hiáº¿m khi bá»‹ "jank" do GC.

> **Interview insight**: Khi Ä‘Æ°á»£c há»i "V8 GC hoáº¡t Ä‘á»™ng tháº¿ nÃ o?", Ä‘á»«ng chá»‰ nÃ³i "Mark-and-Sweep". HÃ£y nÃ³i: "V8 dÃ¹ng **Generational GC** dá»±a trÃªn Generational Hypothesis â€” háº§u háº¿t objects cháº¿t tráº». **Young Generation** dÃ¹ng Scavenger (semi-space copying, ~1ms), **Old Generation** dÃ¹ng Mark-Sweep-Compact (~5-10ms). Orinoco project cáº£i thiá»‡n thÃªm vá»›i parallel, concurrent, vÃ  incremental techniques Ä‘á»ƒ giáº£m pause time xuá»‘ng dÆ°á»›i 5ms."

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  V8 GENERATIONAL GARBAGE COLLECTION                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  V8 chia heap thÃ nh 2 vÃ¹ng (generations):                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  YOUNG GENERATION (1-8 MB)                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚   Semi-Space A       â”‚   Semi-Space B        â”‚           â”‚ â”‚
â”‚  â”‚  â”‚   (active/From)      â”‚   (inactive/To)       â”‚           â”‚ â”‚
â”‚  â”‚  â”‚                      â”‚                       â”‚           â”‚ â”‚
â”‚  â”‚  â”‚   New objects here   â”‚   Empty (swap later)  â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Scavenger (Minor GC): Nhanh, thÆ°á»ng xuyÃªn              â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Copy surviving objects tá»« A â†’ B, rá»“i swap              â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Object sá»‘ng sÃ³t 2 láº§n â†’ promote sang Old Gen           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OLD GENERATION (hundreds of MBs)                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Mark-Sweep & Mark-Compact (Major GC)                   â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Ãt thÆ°á»ng xuyÃªn hÆ¡n, cháº­m hÆ¡n                          â”‚ â”‚
â”‚  â”‚  ğŸ“Œ Long-lived objects, closures, global variables          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Mark-Sweep: ÄÃ¡nh dáº¥u reachable â†’ xÃ³a unreachable         â”‚ â”‚
â”‚  â”‚  Mark-Compact: Sau sweep, dá»“n objects láº¡i â†’ giáº£m fragment  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  INCREMENTAL MARKING                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Thay vÃ¬ pause toÃ n bá»™ (stop-the-world), V8 chia marking  â”‚ â”‚
â”‚  â”‚  thÃ nh nhiá»u bÆ°á»›c nhá» xen káº½ vá»›i JS execution              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  [JS][Mark][JS][Mark][JS][Sweep]  â† Ã­t jank hÆ¡n           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Tá»‘i Æ¯u Bá»™ Nhá»› â€” Giáº£i PhÃ³ng Thá»§ CÃ´ng

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Táº¡i Sao "Tá»± Äá»™ng" Váº«n Cáº§n "Thá»§ CÃ´ng"?**

ÄÃ¢y lÃ  paradox mÃ  nhiá»u junior developers khÃ´ng hiá»ƒu: náº¿u JavaScript cÃ³ **Automatic Garbage Collection**, táº¡i sao developers váº«n pháº£i **thá»§ cÃ´ng** giáº£i phÃ³ng bá»™ nhá»›? Táº¡i sao váº«n cáº§n viáº¿t `obj = null` hay `removeEventListener()`?

CÃ¢u tráº£ lá»i: GC chá»‰ cÃ³ thá»ƒ thu há»“i objects mÃ  **KHÃ”NG AI REFERENCE**. Váº¥n Ä‘á» lÃ  code cá»§a báº¡n cÃ³ thá»ƒ **vÃ´ tÃ¬nh giá»¯ references** mÃ  báº¡n khÃ´ng nháº­n ra â€” closures capture outer variables, event listeners giá»¯ callback references, global variables sá»‘ng mÃ£i mÃ£i. Trong nhá»¯ng trÆ°á»ng há»£p nÃ y, GC **khÃ´ng thá»ƒ** giÃºp báº¡n â€” objects váº«n reachable tá»« root, dÃ¹ báº¡n khÃ´ng dÃ¹ng chÃºng ná»¯a.

NghÄ© theo analogy khÃ¡ch sáº¡n: housekeeper (GC) dá»n phÃ²ng trá»‘ng, nhÆ°ng náº¿u báº¡n váº«n giá»¯ chÃ¬a khÃ³a (reference) dÃ¹ Ä‘Ã£ checkout (khÃ´ng dÃ¹ng ná»¯a) â€” phÃ²ng **khÃ´ng bao giá» Ä‘Æ°á»£c dá»n**. Developer pháº£i **tráº£ chÃ¬a khÃ³a** (set reference = null, remove listener) Ä‘á»ƒ housekeeper lÃ m viá»‡c.

DÆ°á»›i Ä‘Ã¢y lÃ  4 patterns thÆ°á»ng gáº·p nháº¥t mÃ  developers cáº§n thá»§ cÃ´ng giáº£i phÃ³ng bá»™ nhá»›:

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃCH Tá»I Æ¯U: Giáº£i phÃ³ng bá»™ nhá»› thá»§ cÃ´ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// (1) HEAP MEMORY: GÃ¡n = null (null pointer object)
let heavyObject = { data: new Array(1000000).fill("x") };
// ... sá»­ dá»¥ng xong ...
heavyObject = null; // âœ… Giáº£i phÃ³ng heap memory â†’ GC sáº½ thu há»“i

let callback = function () {
  /* ... */
};
callback = null; // âœ… Giáº£i phÃ³ng function reference

// (2) STACK MEMORY: Há»§y bá» heap memory mÃ  context bÃªn ngoÃ i chiáº¿m giá»¯
function outer() {
  let bigData = loadHeavyData();

  return function inner() {
    // Closure giá»¯ reference Ä‘áº¿n bigData â†’ KHÃ”NG Ä‘Æ°á»£c GC!
    console.log(bigData.length);
  };
}

let fn = outer();
fn();
fn = null; // âœ… Giáº£i phÃ³ng closure â†’ bigData cÃ³ thá»ƒ Ä‘Æ°á»£c GC

// (3) EVENT LISTENERS: Remove khi khÃ´ng cáº§n
const handler = () => console.log("click");
element.addEventListener("click", handler);
// ... khi component unmount hoáº·c khÃ´ng cáº§n ná»¯a ...
element.removeEventListener("click", handler); // âœ… Giáº£i phÃ³ng

// (4) TIMERS: Clear khi khÃ´ng cáº§n
const intervalId = setInterval(() => {
  // polling logic...
}, 1000);
// ... khi khÃ´ng cáº§n ná»¯a ...
clearInterval(intervalId); // âœ… Giáº£i phÃ³ng timer reference
```

### 5. Memory Leaks â€” 4 Loáº¡i ChÃ­nh

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Memory Leaks: Káº» Giáº¿t NgÆ°á»i Tháº§m Láº·ng Trong Production**

Memory leak lÃ  má»™t trong nhá»¯ng bugs **khÃ³ detect nháº¥t** trong JavaScript. KhÃ¡c vá»›i crash (lá»—i hiá»ƒn thá»‹ ngay), memory leak **Ã¢m tháº§m** tÃ­ch lÅ©y â€” trang web cháº¡y bÃ¬nh thÆ°á»ng 5 phÃºt Ä‘áº§u, cháº­m dáº§n sau 30 phÃºt, crash sau 2 giá». Users nghÄ© "mÃ¡y tÃ´i cháº­m" hoáº·c "Chrome tá»‘n RAM quÃ¡" â€” nhÆ°ng thá»±c táº¿ lÃ  code Ä‘ang leak memory.

**Táº¡i sao memory leak nguy hiá»ƒm:**

1. **KhÃ³ reproduce**: Leak chá»‰ manifest sau thá»i gian dÃ i sá»­ dá»¥ng. QA test 5 phÃºt, tháº¥y OK, approve. Users dÃ¹ng 8 tiáº¿ng liÃªn tá»¥c â†’ crash.
2. **KhÃ³ diagnose**: KhÃ´ng cÃ³ error message, khÃ´ng cÃ³ stack trace. Tab chá»‰ ngÃ y cÃ ng cháº­m.
3. **TÃ­ch lÅ©y**: Má»—i láº§n navigate, má»—i láº§n interact táº¡o thÃªm leaked objects. Heap **chá»‰ tÄƒng, khÃ´ng bao giá» giáº£m**.
4. **Impact business**: Users rá»i bá» trang web "cháº­m" mÃ  khÃ´ng report bug. Bounce rate tÄƒng, conversion giáº£m, vÃ  team khÃ´ng biáº¿t táº¡i sao.

**Case study thá»±c táº¿**: Má»™t SPA e-commerce leak 2MB má»—i láº§n user navigate giá»¯a cÃ¡c pages (do khÃ´ng cleanup event listeners). Sau 50 navigations (session trung bÃ¬nh) â†’ 100MB leaked. TrÃªn mobile devices vá»›i RAM háº¡n cháº¿ â†’ tab crash â†’ user máº¥t giá» hÃ ng â†’ máº¥t revenue.

**4 loáº¡i memory leak phá»• biáº¿n nháº¥t â€” vÃ  cÃ¡ch phÃ²ng trÃ¡nh:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4 MAIN TYPES OF MEMORY LEAKS IN JAVASCRIPT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£  Global Variables (Biáº¿n toÃ n cá»¥c)                            â”‚
â”‚  2ï¸âƒ£  Closures (Bao Ä‘Ã³ng)                                        â”‚
â”‚  3ï¸âƒ£  DOM References (Tham chiáº¿u DOM Ä‘Ã£ bá»‹ xÃ³a)                  â”‚
â”‚  4ï¸âƒ£  Timers & Event Listeners (Timer & sá»± kiá»‡n)                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Leak 1: Global Variables

```javascript
// âŒ BUG: Biáº¿n toÃ n cá»¥c vÃ´ tÃ¬nh â€” KHÃ”NG BAO GIá»œ bá»‹ GC

function processUser() {
  // QuÃªn khai bÃ¡o let/const â†’ tá»± Ä‘á»™ng trá»Ÿ thÃ nh global (sloppy mode)
  username = "John"; // âš ï¸ window.username = "John"
  this.userProfile = fetchProfile(); // âš ï¸ window.userProfile (náº¿u gá»i bÃ¬nh thÆ°á»ng)
}

// âœ… FIX: LuÃ´n dÃ¹ng let/const + "use strict"
("use strict");
function processUser() {
  const username = "John"; // âœ… Block scoped
  const userProfile = fetchProfile(); // âœ… Block scoped
}
```

#### Leak 2: Closures

```javascript
// âŒ BUG: Closure giá»¯ reference Ä‘áº¿n toÃ n bá»™ outer scope

function createProcessor() {
  const hugeCache = new Array(1_000_000).fill("data"); // 8MB+

  // Closure giá»¯ reference Ä‘áº¿n hugeCache MÃƒI MÃƒI
  return function process(item) {
    return hugeCache.includes(item);
  };
}

const processor = createProcessor();
// hugeCache KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c GC vÃ¬ processor váº«n tham chiáº¿u Ä‘áº¿n nÃ³

// âœ… FIX: Giá»›i háº¡n scope hoáº·c null hÃ³a sau khi dÃ¹ng
function createProcessor() {
  let hugeCache = new Array(1_000_000).fill("data");
  const result = new Set(hugeCache); // Chuyá»ƒn sang structure nhá» hÆ¡n
  hugeCache = null; // âœ… Release ngay sau khi xá»­ lÃ½

  return function process(item) {
    return result.has(item); // Chá»‰ giá»¯ Set, khÃ´ng giá»¯ Array
  };
}
```

#### Leak 3: DOM References

```javascript
// âŒ BUG: Giá»¯ reference Ä‘áº¿n DOM element Ä‘Ã£ bá»‹ xÃ³a khá»i document

const elements = {
  button: document.getElementById("myButton"),
  image: document.getElementById("myImage"),
};

// XÃ³a button khá»i DOM...
document.body.removeChild(document.getElementById("myButton"));

// NhÆ°ng elements.button VáºªN GIá»® reference â†’ element KHÃ”NG Ä‘Æ°á»£c GC!
console.log(elements.button); // Váº«n tá»“n táº¡i trong memory

// âœ… FIX: XÃ³a reference khi xÃ³a DOM element
document.body.removeChild(elements.button);
elements.button = null; // âœ… Release reference

// âœ… BETTER: DÃ¹ng WeakRef hoáº·c WeakMap (khÃ´ng ngÄƒn GC)
const weakElements = new WeakMap();
const btn = document.getElementById("myButton");
weakElements.set(btn, { clicks: 0 });
// Khi btn bá»‹ remove khá»i DOM vÃ  khÃ´ng cÃ²n ref nÃ o khÃ¡c
// â†’ WeakMap entry tá»± Ä‘á»™ng bá»‹ xÃ³a bá»Ÿi GC
```

#### Leak 4: Timers & Event Listeners

```javascript
// âŒ BUG: Timer reference giá»¯ callback + closure FOREVER

function startPolling() {
  const heavyData = loadData(); // Náº·ng!

  setInterval(() => {
    // Closure giá»¯ heavyData + khÃ´ng clearInterval
    // â†’ Memory leak VÄ¨NH VIá»„N
    updateUI(heavyData);
  }, 5000);
}
startPolling();
// KhÃ´ng cÃ³ cÃ¡ch nÃ o clear interval â†’ leak!

// âœ… FIX: LÆ°u intervalId vÃ  clear khi khÃ´ng cáº§n
function startPolling() {
  const heavyData = loadData();

  const intervalId = setInterval(() => {
    updateUI(heavyData);
  }, 5000);

  // Tráº£ vá» cleanup function
  return () => {
    clearInterval(intervalId); // âœ… Clear timer
    // heavyData sáº½ Ä‘Æ°á»£c GC sau khi closure bá»‹ release
  };
}

const stopPolling = startPolling();
// ... khi muá»‘n dá»«ng:
stopPolling(); // âœ… Giáº£i phÃ³ng táº¥t cáº£

// âŒ BUG: Event listener khÃ´ng remove â€” React component
class MyComponent {
  componentDidMount() {
    window.addEventListener("resize", this.handleResize);
    // Náº¿u quÃªn remove â†’ má»—i láº§n mount láº¡i = thÃªm 1 listener!
  }

  // âœ… FIX: LuÃ´n remove trong cleanup
  componentWillUnmount() {
    window.removeEventListener("resize", this.handleResize);
  }
}
```

### 6. Memory Leak Detection

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” PhÃ¡t Hiá»‡n Memory Leaks: Tá»« Cáº£m TÃ­nh Äáº¿n Khoa Há»c**

Háº§u háº¿t developers detect memory leak báº±ng **cáº£m tÃ­nh**: "trang web hÃ¬nh nhÆ° cháº­m hÆ¡n lÃºc nÃ£y". ÄÃ¢y lÃ  cÃ¡ch **tá»‡ nháº¥t** â€” vÃ¬ khi báº¡n "cáº£m nháº­n" Ä‘Æ°á»£c, leak Ä‘Ã£ **ráº¥t nghiÃªm trá»ng** (hÃ ng trÄƒm MB). Senior engineers detect leaks báº±ng **cÃ´ng cá»¥ khoa há»c** â€” quantitative measurements, heap snapshots, allocation timelines.

**Quy trÃ¬nh chuáº©n Ä‘á»ƒ detect memory leak:**

1. **Táº¡o baseline**: Má»Ÿ app fresh, force GC (Chrome DevTools â†’ Performance â†’ Collect garbage â˜ ï¸), snapshot heap.
2. **Thá»±c hiá»‡n action nghi ngá»**: Navigate, open/close modals, scroll lists â€” repeatedly (10-20 láº§n).
3. **Force GC láº¡i**, snapshot heap láº§n 2.
4. **So sÃ¡nh**: Náº¿u heap **tÄƒng Ä‘Ã¡ng ká»ƒ** sau force GC â†’ **leak confirmed**. Náº¿u heap trá»Ÿ vá» baseline â†’ **khÃ´ng leak** (GC Ä‘ang hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng).

LÆ°u Ã½: heap **táº¡m tÄƒng** giá»¯a cÃ¡c GC cycles lÃ  **bÃ¬nh thÆ°á»ng** â€” Ä‘Ã³ lÃ  objects chÆ°a Ä‘Æ°á»£c collect. Chá»‰ khi heap **khÃ´ng giáº£m sau force GC** má»›i lÃ  leak.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOOLS & TECHNIQUES Äá»‚ PHÃT HIá»†N MEMORY LEAKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Chrome DevTools â†’ Memory tab
//    â†’ Take heap snapshot â†’ Compare snapshots
//    â†’ TÃ¬m objects cÃ³ size tÄƒng giá»¯a cÃ¡c snapshot

// 2. Performance Monitor
//    â†’ Chrome DevTools â†’ Performance â†’ Record
//    â†’ Quan sÃ¡t JS Heap size theo thá»i gian
//    â†’ Náº¿u heap liÃªn tá»¥c TÄ‚NG mÃ  khÃ´ng giáº£m â†’ LEAK!

// 3. performance.memory (Chrome only)
console.log(performance.memory);
// {
//   jsHeapSizeLimit: 4294705152,        // Max heap size
//   totalJSHeapSize: 28_000_000,        // Total allocated
//   usedJSHeapSize: 24_000_000          // Actually used
// }
// âš ï¸ Náº¿u usedJSHeapSize liÃªn tá»¥c tÄƒng â†’ cÃ³ leak

// 4. WeakRef Ä‘á»ƒ debug (ES2021)
let debugRef = new WeakRef(someObject);
// Sau khi someObject SHOULD be GC'd:
setTimeout(() => {
  console.log(debugRef.deref()); // undefined = Ä‘Ã£ GC âœ…
  // object = LEAK! âŒ
}, 10000);
```

### Best Practices Tá»•ng Há»£p

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Tá»•ng Káº¿t: Memory Management Mindset Cho Senior Developer**

Memory management trong JavaScript khÃ´ng pháº£i vá» viá»‡c nhá»› thuá»™c lÃ²ng "gÃ¡n null khi xong". ÄÃ³ lÃ  vá» **mental model** â€” hiá»ƒu ráº±ng má»—i object báº¡n táº¡o ra Ä‘á»u **chiáº¿m space** trÃªn heap, vÃ  GC chá»‰ giáº£i phÃ³ng objects mÃ  **khÃ´ng ai reference**. Senior developer luÃ´n tá»± há»i: "reference nÃ y sá»‘ng bao lÃ¢u?" vÃ  "ai giá»¯ reference nÃ y?".

DÆ°á»›i Ä‘Ã¢y lÃ  tá»•ng há»£p best practices, chia thÃ nh **DO** (nÃªn lÃ m) vÃ  **DON'T** (khÃ´ng nÃªn lÃ m):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEMORY MANAGEMENT BEST PRACTICES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… DO:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. DÃ¹ng "use strict" â€” trÃ¡nh global variables vÃ´ tÃ¬nh     â”‚ â”‚
â”‚  â”‚  2. GÃ¡n = null khi object/function khÃ´ng cáº§n ná»¯a           â”‚ â”‚
â”‚  â”‚  3. clearTimeout/clearInterval khi component unmount       â”‚ â”‚
â”‚  â”‚  4. removeEventListener khi khÃ´ng cáº§n láº¯ng nghe ná»¯a       â”‚ â”‚
â”‚  â”‚  5. DÃ¹ng WeakMap/WeakSet cho cache â€” cho phÃ©p GC tá»± Ä‘á»™ng  â”‚ â”‚
â”‚  â”‚  6. Giá»›i háº¡n closure scope â€” chá»‰ capture biáº¿n thá»±c sá»± cáº§n â”‚ â”‚
â”‚  â”‚  7. XÃ³a DOM reference khi element bá»‹ remove               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âŒ DON'T:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Táº¡o global variables khÃ´ng cáº§n thiáº¿t                   â”‚ â”‚
â”‚  â”‚  2. DÃ¹ng closure khi khÃ´ng cáº§n (tá»‘n memory)                â”‚ â”‚
â”‚  â”‚  3. QuÃªn clear timers (setInterval Ä‘áº·c biá»‡t nguy hiá»ƒm)    â”‚ â”‚
â”‚  â”‚  4. Giá»¯ reference Ä‘áº¿n DOM Ä‘Ã£ xÃ³a                          â”‚ â”‚
â”‚  â”‚  5. Táº¡o event listener má»›i má»—i render (React)             â”‚ â”‚
â”‚  â”‚  6. Store large data trong closures                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ§  Deep Analysis Patterns â€” PhÃ¢n TÃ­ch GC Theo 6 GÃ³c NhÃ¬n ChuyÃªn SÃ¢u

Pháº§n trÃªn Ä‘Ã£ giáº£i thÃ­ch GC **lÃ  gÃ¬** vÃ  **hoáº¡t Ä‘á»™ng tháº¿ nÃ o**. Pháº§n dÆ°á»›i Ä‘Ã¢y sáº½ phÃ¢n tÃ­ch GC tá»« **6 gÃ³c nhÃ¬n tÆ° duy khÃ¡c nhau** â€” giÃºp báº¡n khÃ´ng chá»‰ hiá»ƒu kiáº¿n thá»©c, mÃ  cÃ²n hiá»ƒu **cÃ¡ch tÆ° duy** Ä‘á»ƒ phÃ¢n tÃ­ch báº¥t ká»³ technology nÃ o.

---

#### Pattern 1: Äá»‡ Quy "Táº¡i Sao" (5 Whys) â€” Truy Váº¿t Tá»« Hiá»‡n TÆ°á»£ng Äáº¿n NguyÃªn LÃ½

**Ká»¹ thuáº­t 5 Whys** cÃ³ nguá»“n gá»‘c tá»« Toyota Production System â€” khi gáº·p váº¥n Ä‘á», há»i "Táº¡i sao?" Ã­t nháº¥t 5 láº§n Ä‘á»ƒ cháº¡m Ä‘áº¿n **root cause**. Ãp dá»¥ng vÃ o GC:

---

**WHY 1: Táº¡i sao JavaScript cáº§n Garbage Collection?**

VÃ¬ JavaScript engine pháº£i **tá»± Ä‘á»™ng quáº£n lÃ½ memory** â€” developer khÃ´ng cÃ³ `malloc()` / `free()` nhÆ° C. Má»—i khi báº¡n viáº¿t `let obj = {}`, V8 pháº£i allocate memory trÃªn heap. NhÆ°ng heap **cÃ³ giá»›i háº¡n** â€” náº¿u chá»‰ allocate mÃ  khÃ´ng giáº£i phÃ³ng, app sáº½ crash sau vÃ i phÃºt.

```javascript
// Má»—i dÃ²ng code táº¡o objects trÃªn heap â€” KHÃ”NG tá»± biáº¿n máº¥t
function processRequest(data) {
  const parsed = JSON.parse(data); // Object má»›i trÃªn heap
  const filtered = parsed.filter((x) => x.active); // Array má»›i trÃªn heap
  const mapped = filtered.map((x) => x.name); // Array má»›i ná»¯a trÃªn heap
  return mapped;
  // parsed, filtered â†’ ai dá»n? â†’ GC!
}
```

**WHY 2: Táº¡i sao khÃ´ng Ä‘á»ƒ developer tá»± quáº£n lÃ½ (nhÆ° C/C++)?**

VÃ¬ **manual memory management** cá»±c ká»³ khÃ³ vÃ  **nguy hiá»ƒm**. Lá»‹ch sá»­ software engineering chá»©ng minh: ~70% security vulnerabilities trong C/C++ lÃ  **memory safety bugs** (theo Microsoft Security Response Center, 2019). 3 lá»—i phá»• biáº¿n nháº¥t:

1. **Use-after-free**: Truy cáº­p memory Ä‘Ã£ giáº£i phÃ³ng â†’ crash hoáº·c **security exploit** (RCE â€” Remote Code Execution)
2. **Double-free**: Giáº£i phÃ³ng cÃ¹ng memory 2 láº§n â†’ heap corruption â†’ **unpredictable behavior**
3. **Memory leak**: QuÃªn giáº£i phÃ³ng â†’ app ngÃ y cÃ ng cháº­m â†’ crash

JavaScript sinh ra cho **web browser** â€” nÆ¡i **hÃ ng triá»‡u developers** vá»›i Ä‘á»§ trÃ¬nh Ä‘á»™ viáº¿t code. Náº¿u Ä‘á»ƒ manual memory management, web sáº½ trÃ n ngáº­p crashes, exploits, vÃ  leaks. **GC lÃ  trade-off: Ä‘Ã¡nh Ä‘á»•i performance nhá» Ä‘á»ƒ Ä‘á»•i láº¥y safety lá»›n.**

```c
// C â€” Manual memory management: nguy hiá»ƒm
char* buffer = malloc(100);
free(buffer);
// ... 1000 dÃ²ng code sau ...
printf("%s", buffer);   // âŒ USE-AFTER-FREE â€” crash hoáº·c security exploit!
free(buffer);           // âŒ DOUBLE-FREE â€” heap corruption!

// JavaScript â€” KHÃ”NG THá»‚ xáº£y ra lá»—i nÃ y
let buffer = new Array(100);
buffer = null;
// GC tá»± xá»­ lÃ½. KhÃ´ng use-after-free. KhÃ´ng double-free.
```

**WHY 3: Táº¡i sao GC pháº£i "stop-the-world" (dá»«ng execution)?**

VÃ¬ GC cáº§n **tráº¡ng thÃ¡i heap consistent** khi scan. TÆ°á»Ÿng tÆ°á»£ng GC Ä‘ang scan object A, phÃ¡t hiá»‡n A trá» Ä‘áº¿n B. GC chuáº©n bá»‹ scan B. NhÆ°ng **Ä‘Ãºng lÃºc Ä‘Ã³**, JavaScript code cháº¡y `A.ref = C` (A khÃ´ng cÃ²n trá» B, B trá»Ÿ thÃ nh garbage) vÃ  `D.ref = B` (B láº¡i cÃ³ reference má»›i). Náº¿u GC khÃ´ng biáº¿t â€” nÃ³ sáº½ **xÃ³a nháº§m B** (live object) hoáº·c **giá»¯ nháº§m** old reference.

ÄÃ¢y lÃ  bÃ i toÃ¡n **concurrent modification** â€” giá»‘ng database cáº§n transactions. GC giáº£i quyáº¿t báº±ng:

- **Stop-the-world** (Ä‘Æ¡n giáº£n nháº¥t): Dá»«ng JS, scan xong má»›i cháº¡y tiáº¿p. An toÃ n 100% nhÆ°ng gÃ¢y **jank**.
- **Write barriers** (V8 hiá»‡n táº¡i): Cho phÃ©p JS cháº¡y song song, nhÆ°ng má»—i khi JS **thay Ä‘á»•i reference** (write), engine cÃ i "barrier" ghi nháº­n thay Ä‘á»•i. GC Ä‘á»c barrier log Ä‘á»ƒ cáº­p nháº­t. **Phá»©c táº¡p** nhÆ°ng giáº£m pause time.

```
Stop-the-world (cÅ©):
[â”€â”€â”€â”€JSâ”€â”€â”€â”€â”€][â–ˆâ–ˆGC PAUSEâ–ˆâ–ˆ][â”€â”€â”€â”€JSâ”€â”€â”€â”€â”€]
                 50-200ms pause â†’ jank!

Incremental + concurrent (V8 hiá»‡n táº¡i):
[â”€â”€JSâ”€â”€][GC][JS][GC][JS][GC][â”€â”€JSâ”€â”€]
          ~1ms  ~1ms  ~1ms â†’ smooth!
```

**WHY 4: Táº¡i sao V8 chia heap thÃ nh generations thay vÃ¬ scan toÃ n bá»™?**

VÃ¬ scan **toÃ n bá»™ heap** cá»±c ká»³ cháº­m. Heap cá»§a má»™t web app cÃ³ thá»ƒ lÃªn **hÃ ng trÄƒm MB** â€” scan qua má»i object máº¥t hÃ ng trÄƒm milliseconds. NhÆ°ng theo **Generational Hypothesis**, ~80-90% objects cháº¿t trong vÃ i milliseconds. Scan objects "giÃ " (Ä‘Ã£ survive nhiá»u GC cycles) lÃ  **lÃ£ng phÃ­** â€” chÃºng háº§u nhÆ° luÃ´n alive.

Chia heap thÃ nh generations cho phÃ©p V8 táº­p trung scan **vÃ¹ng nhiá»u rÃ¡c nháº¥t** (Young Generation, ~1-8MB) vá»›i táº§n suáº¥t cao vÃ  chi phÃ­ tháº¥p (~1-2ms). VÃ¹ng "giÃ " (Old Generation, ~100-500MB) chá»‰ scan **khi thá»±c sá»± cáº§n** (khi gáº§n Ä‘áº§y). ÄÃ¢y lÃ  optimization **O(young) thay vÃ¬ O(total heap)** â€” giáº£m 10-100x thá»i gian GC.

```
KhÃ´ng cÃ³ Generational GC:
  Scan: [====== TOÃ€N Bá»˜ 500MB HEAP ======] â†’ 100ms+ pause
  Frequency: Má»—i 5-10s (vÃ¬ cháº­m, khÃ´ng scan thÆ°á»ng xuyÃªn)

Vá»›i Generational GC:
  Minor GC: [== Young 4MB ==] â†’ 1ms pause, má»—i 100ms
  Major GC: [====== Old 500MB ======] â†’ 10ms pause, má»—i 30s
  â†’ Smooth hÆ¡n nhiá»u!
```

**WHY 5: Táº¡i sao Mark-and-Sweep tháº¯ng Reference Counting? â€” Giá»›i háº¡n toÃ¡n há»c**

ÄÃ¢y lÃ  root cause â€” cháº¡m Ä‘áº¿n **giá»›i háº¡n toÃ¡n há»c** cá»§a Reference Counting. RC tháº¥t báº¡i vÃ¬ **graph theory**: trong directed graph (object references), náº¿u 2 nodes trá» vÃ o nhau táº¡o **cycle** â€” khÃ´ng cÃ³ node nÃ o trong cycle cÃ³ in-degree = 0, dÃ¹ cáº£ cycle **unreachable tá»« root**.

Mark-and-Sweep giáº£i quyáº¿t vÃ¬ nÃ³ tiáº¿p cáº­n tá»« **roots** â€” traversal from root. Má»i node unreachable tá»« root (ká»ƒ cáº£ cycles) Ä‘á»u bá»‹ thu gom. ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t fundamental:

- **Reference Counting**: local information (má»—i node chá»‰ biáº¿t mÃ¬nh cÃ³ bao nhiÃªu refs) â†’ **khÃ´ng detect global unreachability**
- **Mark-and-Sweep**: global information (traverse tá»« roots) â†’ **detect má»i unreachable nodes**, ká»ƒ cáº£ cycles

```
Reference Counting â€” tháº¥t báº¡i vá»›i cycles:

  Root â”€âœ•â”€â†’ [A] â†â”€â”€â”€â”€ [B]        Root khÃ´ng trá» Ä‘áº¿n A hay B
             â”‚          â†‘         A.refCount = 1 (B trá» vÃ o)
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         B.refCount = 1 (A trá» vÃ o)
                                  Cáº£ hai refCount > 0 â†’ KHÃ”NG GC
                                  NhÆ°ng cáº£ hai UNREACHABLE! â†’ LEAK!

  Mark-and-Sweep â€” thÃ nh cÃ´ng:

  Root â”€âœ•â”€â†’ [A] â†â”€â”€â”€â”€ [B]        Scan tá»« Root â†’ A, B khÃ´ng reached
             â”‚          â†‘         â†’ Cáº£ hai UNMARKED â†’ cáº£ hai bá»‹ SWEEP
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â†’ ÄÃºng! VÃ¬ chÃºng unreachable âœ…
```

> **Interview insight â€” 5 Whys Summary**: Khi Ä‘Æ°á»£c há»i vá» GC, Ä‘á»«ng chá»‰ liá»‡t kÃª algorithms. HÃ£y cho tháº¥y báº¡n hiá»ƒu **chuá»—i nguyÃªn nhÃ¢n**: JS cáº§n GC vÃ¬ **safety** (WHY 1-2) â†’ GC cáº§n pause vÃ¬ **consistency** (WHY 3) â†’ Generational vÃ¬ **performance** (WHY 4) â†’ Mark-and-Sweep vÃ¬ **mathematical correctness** (WHY 5). Má»—i decision dáº«n Ä‘áº¿n decision tiáº¿p theo.

---

#### Pattern 2: First Principles Thinking â€” PhÃ¢n RÃ£ GC Vá» Data Structures & Algorithms

Thay vÃ¬ nghÄ© "V8 GC tá»‘t hÆ¡n IE GC", hÃ£y phÃ¢n rÃ£ vá» **sá»± tháº­t cÆ¡ báº£n**: GC thá»±c cháº¥t lÃ  sá»± káº¿t há»£p cá»§a graph algorithms, memory layout strategies, vÃ  hardware utilization.

---

**Data Structures â€” GC "nhÃ¬n" heap nhÆ° graph:**

GC **khÃ´ng tháº¥y** objects dÆ°á»›i dáº¡ng `{name: "John", age: 30}`. NÃ³ tháº¥y heap nhÆ° má»™t **directed graph**:

- **Nodes** = memory blocks (objects, arrays, functions, strings)
- **Edges** = references (pointers) giá»¯a cÃ¡c objects
- **Root set** = entry points (global object, call stack, registers)

BÃ i toÃ¡n GC = **Graph Reachability Problem**: tÃ¬m táº¥t cáº£ nodes reachable tá»« root set, giáº£i phÃ³ng pháº§n cÃ²n láº¡i.

```
Heap dÆ°á»›i dáº¡ng Directed Graph:

  [Root Set]
     â”‚
     â”œâ”€â”€â†’ [Global Object]
     â”‚         â”œâ”€â”€â†’ [Array A]â”€â”€â†’[String "hello"]
     â”‚         â””â”€â”€â†’ [Function F]â”€â”€â†’[Closure Scope]
     â”‚
     â””â”€â”€â†’ [Stack Frame]
               â””â”€â”€â†’ [Object X]â”€â”€â†’[Object Y]

  Unreachable (garbage):
     [Object P]â†â†’[Object Q]    â† cycle, khÃ´ng ai trá» Ä‘áº¿n
     [Object Z]                  â† orphan, khÃ´ng ai trá» Ä‘áº¿n
```

**Algorithms â€” Complexity analysis:**

| Algorithm                 | Time Complexity                      | Space Overhead                | Pause Pattern              |
| ------------------------- | ------------------------------------ | ----------------------------- | -------------------------- |
| **Reference Counting**    | O(1) per ref change                  | O(n) â€” counter per object     | No pause (incremental)     |
| **Mark-Sweep**            | O(live objects) mark + O(heap) sweep | O(n) â€” mark bits              | Stop-the-world             |
| **Semi-space Copying**    | O(live objects)                      | O(n) â€” 2x memory              | Stop-the-world             |
| **Mark-Compact**          | O(live objects) + O(n) compaction    | O(n) â€” forwarding addresses   | Stop-the-world             |
| **Tri-color Incremental** | O(live objects)                      | O(n) + write barrier overhead | Incremental (short pauses) |

Nháº­n xÃ©t quan trá»ng:

- **Mark phase** luÃ´n tá»· lá»‡ vá»›i **live objects** (khÃ´ng pháº£i garbage) â€” vÃ¬ GC traverse tá»« roots. Heap nhiá»u rÃ¡c = mark nhanh hÆ¡n (Ã­t nodes cáº§n visit).
- **Sweep phase** tá»· lá»‡ vá»›i **total heap** â€” pháº£i scan má»i object Ä‘á»ƒ tÃ¬m unmarked. ÄÃ¢y lÃ  bottleneck.
- **Semi-space copying** tá»· lá»‡ chá»‰ vá»›i **live objects** (copy sá»‘ng, bá» cháº¿t) â€” **nhanh nháº¥t** khi Ä‘a sá»‘ objects cháº¿t. ÄÃ¢y lÃ  lÃ½ do V8 dÃ¹ng cho Young Generation.

```javascript
// Táº¡i sao semi-space copying nhanh cho Young Gen?
// VÃ­ dá»¥: Young Gen 4MB, 90% objects Ä‘Ã£ cháº¿t (typical React render)

// Mark-Sweep approach:
//   Mark: scan ~400KB live objects â†’ 0.1ms
//   Sweep: scan TOÃ€N Bá»˜ 4MB heap â†’ 1ms
//   Total: ~1.1ms

// Semi-space copying approach:
//   Copy: copy ~400KB live objects tá»« From â†’ To â†’ 0.1ms
//   Swap: O(1) pointer swap â†’ 0.001ms
//   Total: ~0.1ms  â† 10x nhanh hÆ¡n!
//   Bonus: no fragmentation (objects compacted tá»± nhiÃªn)
```

**Hardware-level â€” Táº¡i sao GC "cháº­m" trÃªn mobile?**

GC performance phá»¥ thuá»™c náº·ng vÃ o **hardware**:

1. **CPU cache**: Objects trÃªn heap ráº£i rÃ¡c (fragmented) â†’ **cache misses** khi scan. Mark-Compact giáº£i quyáº¿t báº±ng compaction â†’ objects liá»n ká» â†’ cache-friendly.
2. **Memory bandwidth**: Scavenger (semi-space copying) cáº§n **Ä‘á»c + ghi** má»—i live object â†’ bandwidth-intensive. Mobile devices (bandwidth ~10GB/s) cháº­m hÆ¡n desktop (~50GB/s) â†’ Scavenger cháº­m hÆ¡n ~5x trÃªn mobile.
3. **Number of cores**: Orinoco's parallel GC dÃ¹ng **helper threads** â€” desktop cÃ³ 8-16 cores, mobile cÃ³ 2-4 cores â†’ parallel speedup tháº¥p hÆ¡n trÃªn mobile.

> **Interview insight**: Khi nÃ³i vá» GC performance, náº¿u báº¡n mention hardware constraints (cache, bandwidth, cores) â€” interviewer biáº¿t báº¡n hiá»ƒu Ä‘áº¿n **táº§ng váº­t lÃ½**, khÃ´ng chá»‰ surface-level algorithms.

---

#### Pattern 3: Trade-off Analysis â€” Má»—i GC Decision LÃ  Má»™t ÄÃ¡nh Äá»•i

Trong software engineering, **khÃ´ng cÃ³ giáº£i phÃ¡p hoÃ n háº£o** â€” chá»‰ cÃ³ Ä‘Ã¡nh Ä‘á»•i (trade-offs) phÃ¹ há»£p vá»›i context. GC lÃ  vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh:

---

**Trade-off 1: Throughput vs. Latency**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  THROUGHPUT vs LATENCY TRADE-OFF                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Throughput GC (Java G1, Go GC):                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ Æ¯u:  Nhiá»u time cho app code (Ã­t GC overhead)               â”‚
â”‚  â”‚ NhÆ°á»£c: Pause dÃ i hÆ¡n khi GC cháº¡y                            â”‚
â”‚  â”‚ PhÃ¹ há»£p: Server-side, batch processing                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                 â”‚
â”‚  Low-latency GC (V8 Orinoco):                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚ Æ¯u:  Pause cá»±c ngáº¯n (~1-5ms)                                â”‚
â”‚  â”‚ NhÆ°á»£c: Tá»•ng thá»i gian GC nhiá»u hÆ¡n (overhead write barriers)â”‚
â”‚  â”‚ PhÃ¹ há»£p: UI applications, real-time rendering               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                 â”‚
â”‚  V8 chá»n low-latency vÃ¬ JavaScript CHáº Y TRÃŠN BROWSER           â”‚
â”‚  â†’ 60fps = 16.6ms per frame â†’ GC pause > 16ms = jank!          â”‚
â”‚  â†’ ÄÃ¡nh Ä‘á»•i throughput Ä‘á»ƒ Ä‘áº£m báº£o smooth UI                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Trade-off 2: Memory Usage vs. GC Speed**

Semi-space copying (Young Gen) cáº§n **2x memory** â€” luÃ´n cÃ³ má»™t semi-space trá»‘ng (To-space). Náº¿u Young Gen = 4MB â†’ thá»±c táº¿ cáº§n 8MB. ÄÃ¢y lÃ  Ä‘Ã¡nh Ä‘á»•i: **dÃ¹ng nhiá»u memory hÆ¡n Ä‘á»ƒ GC nhanh hÆ¡n**.

| Strategy        | Memory overhead        | GC Speed       | Fragmentation |
| --------------- | ---------------------- | -------------- | ------------- |
| Mark-Sweep      | Tháº¥p (chá»‰ mark bits)   | Cháº­m hÆ¡n       | CÃ³ (holes)    |
| Mark-Compact    | Tháº¥p + compaction cost | Cháº­m nháº¥t      | KhÃ´ng         |
| Semi-space Copy | **2x memory**          | **Nhanh nháº¥t** | KhÃ´ng         |

V8's choice: dÃ¹ng semi-space **chá»‰ cho Young Gen** (nhá», 1-8MB â†’ overhead 2x cháº¥p nháº­n Ä‘Æ°á»£c). Old Gen dÃ¹ng Mark-Sweep-Compact (lá»›n, 100-500MB â†’ khÃ´ng thá»ƒ dÃ¹ng 2x memory = 200MB-1GB wasted).

**Trade-off 3: Safety vs. Control â€” So sÃ¡nh GC Systems**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAFETY vs CONTROL SPECTRUM                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  More Control â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º More Safety      â”‚
â”‚                                                                 â”‚
â”‚  C/C++        Rust         Go/Java        JavaScript            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚Manualâ”‚    â”‚Owner â”‚    â”‚GC +  â”‚        â”‚GC +      â”‚          â”‚
â”‚  â”‚mallocâ”‚    â”‚+Borrow    â”‚Some  â”‚        â”‚Zero      â”‚          â”‚
â”‚  â”‚/free â”‚    â”‚Check â”‚    â”‚Tuningâ”‚        â”‚Config    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  Dev controls   Compiler    Dev can tune    Dev has NO          â”‚
â”‚  everything     enforces    GC params       control over GC     â”‚
â”‚                 safety      (-Xmx, GOGC)   (V8 decides all)    â”‚
â”‚                                                                 â”‚
â”‚  âŒ Use-after-  âœ… Zero-    âš ï¸ Tuning      âœ… Zero memory      â”‚
â”‚     free bugs      cost       requires       bugs (almost)     â”‚
â”‚  âŒ Memory         safety     expertise   âŒ Can't optimize     â”‚
â”‚     leaks       âŒ Steep    âœ… Good         for specific        â”‚
â”‚  âœ… Max perf       learning   default        workloads          â”‚
â”‚                    curve      behavior                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

JavaScript náº±m **cá»±c há»¯u** â€” developer cÃ³ **Ã­t quyá»n kiá»ƒm soÃ¡t nháº¥t** nhÆ°ng cÅ©ng **an toÃ n nháº¥t**. Báº¡n khÃ´ng thá»ƒ tune GC parameters, khÃ´ng thá»ƒ force GC (trá»« DevTools), khÃ´ng thá»ƒ chá»n GC algorithm. V8 quyáº¿t Ä‘á»‹nh **táº¥t cáº£**. ÄÃ¢y lÃ  design intentional cho web platform â€” nÆ¡i code Ä‘áº¿n tá»« **nguá»“n khÃ´ng tin cáº­y** (third-party scripts, ads, widgets).

**Trade-off 4: Ká»‹ch báº£n tháº¥t báº¡i â€” Khi nÃ o GC hoÃ n toÃ n khÃ´ng giÃºp Ä‘Æ°á»£c?**

GC **tháº¥t báº¡i hoÃ n toÃ n** khi:

1. **Logical leaks**: Objects váº«n reachable (trong Map/Set/Array global) nhÆ°ng developer "quÃªn" chÃºng. GC tháº¥y chÃºng alive â†’ khÃ´ng thu há»“i. ÄÃ¢y lÃ  loáº¡i leak **phá»• biáº¿n nháº¥t** trong SPA.

2. **High allocation rate**: App allocate objects **nhanh hÆ¡n** GC cÃ³ thá»ƒ thu há»“i. GC chÆ°a ká»‹p scan xong â†’ heap Ä‘áº§y â†’ allocation fails. ThÆ°á»ng xáº£y ra trong game loop hoáº·c heavy data processing.

3. **Huge live set**: Náº¿u app giá»¯ **hÃ ng trÄƒm MB** live data (large in-memory caches, huge Redux stores) â†’ Major GC cháº­m vÃ¬ pháº£i mark táº¥t cáº£. Giáº£i phÃ¡p: move data sang IndexedDB/Web Worker.

```javascript
// Ká»‹ch báº£n GC tháº¥t báº¡i: Logical leak trong React
const cache = new Map(); // Module-level â†’ never GC'd

function UserProfile({ userId }) {
  useEffect(() => {
    const data = fetchUser(userId);
    cache.set(userId, data); // â† Má»—i user thÃªm entry vÃ o cache
    // KHÃ”NG BAO GIá»œ xÃ³a entry cÅ©!
    // Navigate qua 1000 users â†’ 1000 entries â†’ leak!
  }, [userId]);
}

// âœ… FIX: DÃ¹ng WeakMap hoáº·c LRU cache cÃ³ giá»›i háº¡n size
const cache = new WeakMap(); // Keys lÃ  objects â†’ auto-GC khi key unreachable
// hoáº·c:
const cache = new LRUCache({ max: 100 }); // Giá»¯ tá»‘i Ä‘a 100 entries
```

> **Interview insight**: Khi interviewer há»i "GC cÃ³ nhÆ°á»£c Ä‘iá»ƒm gÃ¬?", Ä‘á»«ng chá»‰ nÃ³i "gÃ¢y pause". HÃ£y phÃ¢n tÃ­ch trade-offs: **throughput vs latency**, **memory vs speed**, **safety vs control**. VÃ  nÃªu ká»‹ch báº£n tháº¥t báº¡i cá»¥ thá»ƒ: logical leaks, high allocation rate, huge live set.

---

#### Pattern 4: Mental Mapping â€” GC Trong Báº£n Äá»“ Kiáº¿n TrÃºc Tá»•ng Thá»ƒ

Äá»ƒ hiá»ƒu GC thá»±c sá»± sÃ¢u, báº¡n cáº§n biáº¿t **vá»‹ trÃ­ cá»§a nÃ³** trong toÃ n bá»™ stack â€” tá»« code báº¡n viáº¿t Ä‘áº¿n hardware bÃªn dÆ°á»›i. Má»—i dÃ²ng `let obj = {}` trigger má»™t chuá»—i operations xuyÃªn suá»‘t nhiá»u táº§ng:

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MENTAL MAP: Má»˜T DÃ’NG CODE â†’ TÃC Äá»˜NG Äáº¾N Tá»ªNG Táº¦NG           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  let obj = { name: "John" };  // Báº¡n viáº¿t dÃ²ng nÃ y              â”‚
â”‚  â†“                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Táº¦ng 1: JavaScript Engine (V8)                            â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. Parser: Parse AST â†’ detect object literal              â”‚   â”‚
â”‚  â”‚ 2. Ignition: Generate bytecode CreateObjectLiteral        â”‚   â”‚
â”‚  â”‚ 3. Allocator: Request memory tá»« heap                      â”‚   â”‚
â”‚  â”‚ 4. Hidden Class: Táº¡o/tÃ¬m hidden class cho shape {name: *}â”‚   â”‚
â”‚  â”‚ 5. Inline Cache: Cache property access pattern            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Táº¦NG 2: Heap Memory Manager (V8 Heap)                     â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. Young Gen: Allocate trong From-space (bump pointer)    â”‚   â”‚
â”‚  â”‚ 2. Write barrier: Ghi nháº­n inter-generational references  â”‚   â”‚
â”‚  â”‚ 3. GC trigger: Kiá»ƒm tra allocation budget cÃ²n khÃ´ng       â”‚   â”‚
â”‚  â”‚ 4. Scavenger: Náº¿u From-space Ä‘áº§y â†’ copy live objects      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Táº¦NG 3: Operating System                                  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. Virtual Memory: Cáº¥p page (4KB) cho V8 heap             â”‚   â”‚
â”‚  â”‚ 2. Page Table: Map virtual â†’ physical address             â”‚   â”‚
â”‚  â”‚ 3. Memory Protection: Prevent buffer overflow/access      â”‚   â”‚
â”‚  â”‚ 4. OOM Killer: Náº¿u total memory quÃ¡ cao â†’ kill process   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Táº¦NG 4: Hardware                                          â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. L1/L2/L3 Cache: Cache hot objects (recently allocated)â”‚   â”‚
â”‚  â”‚ 2. RAM: Store actual bytes                                â”‚   â”‚
â”‚  â”‚ 3. Memory Controller: Manage DRAM access patterns         â”‚   â”‚
â”‚  â”‚ 4. TLB: Cache page table entries for fast address lookup  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Má»™t dÃ²ng `let obj = {}` â†’ V8 allocate ~56 bytes trÃªn heap  â”‚
â”‚     â†’ OS cáº¥p virtual page â†’ CPU cache object â†’ 4+ táº§ng hoáº¡t   â”‚
â”‚     Ä‘á»™ng chá»‰ cho 1 dÃ²ng code!                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Káº¿t ná»‘i GC vá»›i cÃ¡c khÃ¡i niá»‡m khÃ¡c trong JavaScript:**

GC khÃ´ng tá»“n táº¡i **cÃ´ láº­p** â€” nÃ³ liÃªn káº¿t cháº·t cháº½ vá»›i nhiá»u concepts khÃ¡c. Hiá»ƒu nhá»¯ng connections nÃ y giÃºp báº¡n tháº¥y "bá»©c tranh lá»›n":

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GC CONNECTION MAP â€” GC LiÃªn Káº¿t Vá»›i Má»i Thá»©                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”‚ Closures â”‚â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                            â”‚
â”‚              â”‚ Closure giá»¯ scope    â”‚ Scope chain                â”‚
â”‚              â”‚ chain â†’ prevent GC   â”‚ = reference chain          â”‚
â”‚              â†“                      â†“                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Memory Leaks â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Scope Chain â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                           â†‘                            â”‚
â”‚         â”‚ Leaked objects            â”‚ Scope determines           â”‚
â”‚         â”‚ = GC can't collect        â”‚ variable lifetime          â”‚
â”‚         â†“                           â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚      GC      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Event Loop  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                           â†‘                            â”‚
â”‚         â”‚ GC runs during            â”‚ Callbacks keep             â”‚
â”‚         â”‚ idle time                 â”‚ references alive           â”‚
â”‚         â†“                           â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  V8 Heap     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ WeakRef/     â”‚                   â”‚
â”‚  â”‚  (Stack/Heap)â”‚            â”‚ WeakMap      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ GC = trung tÃ¢m cá»§a memory management                        â”‚
â”‚     Má»i decision about scope, closures, event listeners         â”‚
â”‚     Ä‘á»u áº£nh hÆ°á»Ÿng Ä‘áº¿n GC behavior                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Interview insight**: Náº¿u interviewer há»i "GC liÃªn quan gÃ¬ Ä‘áº¿n closures?", hÃ£y váº½ connection: closure giá»¯ scope chain reference â†’ scope chain giá»¯ outer variables alive â†’ GC khÃ´ng thá»ƒ thu há»“i outer variables cho Ä‘áº¿n khi closure bá»‹ release. ÄÃ¢y lÃ  **lÃ½ do #1** táº¡o memory leaks trong JavaScript.

---

#### Pattern 5: Reverse Engineering â€” Tá»± Tay Code Má»™t Mini GC

> _"What I cannot create, I do not understand."_ â€” Richard Feynman

CÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ hiá»ƒu GC lÃ  **tá»± implement** má»™t phiÃªn báº£n Ä‘Æ¡n giáº£n. DÆ°á»›i Ä‘Ã¢y lÃ  Mini GC engine báº±ng JavaScript â€” implement cáº£ **Mark-and-Sweep** vÃ  **Reference Counting** Ä‘á»ƒ báº¡n tháº¥y rÃµ sá»± khÃ¡c biá»‡t:

---

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MINI GC ENGINE â€” Tá»± implement Ä‘á»ƒ hiá»ƒu sÃ¢u
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Pháº§n 1: Simulated Heap & Object â”€â”€
class HeapObject {
  constructor(id, size = 1) {
    this.id = id;
    this.size = size; // Simulated memory size (KB)
    this.references = []; // Outgoing references (edges trong graph)
    this.marked = false; // Cho Mark-and-Sweep
    this.refCount = 0; // Cho Reference Counting
  }

  addReference(obj) {
    this.references.push(obj);
    obj.refCount++; // RC: tÄƒng counter
  }

  removeReference(obj) {
    const idx = this.references.indexOf(obj);
    if (idx !== -1) {
      this.references.splice(idx, 1);
      obj.refCount--; // RC: giáº£m counter
    }
  }
}

// â”€â”€ Pháº§n 2: Mark-and-Sweep GC â”€â”€
class MarkAndSweepGC {
  constructor() {
    this.heap = []; // Táº¥t cáº£ objects trÃªn heap
    this.roots = []; // Root set (global, stack)
  }

  allocate(id, size = 1) {
    const obj = new HeapObject(id, size);
    this.heap.push(obj);
    return obj;
  }

  // Phase 1: MARK â€” traverse tá»« roots, Ä‘Ã¡nh dáº¥u reachable
  mark() {
    // Reset all marks
    this.heap.forEach((obj) => (obj.marked = false));

    // BFS/DFS tá»« roots
    const stack = [...this.roots];
    while (stack.length > 0) {
      const obj = stack.pop();
      if (obj.marked) continue; // ÄÃ£ visit â†’ skip (trÃ¡nh infinite loop vá»›i cycles!)

      obj.marked = true; // âœ… Reachable

      // Visit táº¥t cáº£ references
      for (const ref of obj.references) {
        if (!ref.marked) {
          stack.push(ref);
        }
      }
    }
  }

  // Phase 2: SWEEP â€” xÃ³a táº¥t cáº£ unmarked objects
  sweep() {
    const alive = [];
    const garbage = [];

    for (const obj of this.heap) {
      if (obj.marked) {
        alive.push(obj);
      } else {
        garbage.push(obj);
      }
    }

    this.heap = alive;

    const freedMemory = garbage.reduce((sum, obj) => sum + obj.size, 0);
    console.log(
      `[Mark-Sweep] Freed ${garbage.length} objects (${freedMemory}KB)`,
    );
    console.log(`  Garbage: [${garbage.map((o) => o.id).join(", ")}]`);
    console.log(`  Alive:   [${alive.map((o) => o.id).join(", ")}]`);

    return garbage;
  }

  // Full GC cycle
  collect() {
    console.log("\nğŸ”„ Mark-and-Sweep GC cycle:");
    this.mark();
    return this.sweep();
  }
}

// â”€â”€ Pháº§n 3: Reference Counting GC â”€â”€
class ReferenceCountingGC {
  constructor() {
    this.heap = [];
  }

  allocate(id, size = 1) {
    const obj = new HeapObject(id, size);
    obj.refCount = 1; // CÃ³ Ã­t nháº¥t 1 reference (variable gÃ¡n vÃ o)
    this.heap.push(obj);
    return obj;
  }

  // Giáº£m refCount khi variable khÃ´ng cÃ²n trá» Ä‘áº¿n
  release(obj) {
    obj.refCount--;
    if (obj.refCount === 0) {
      console.log(`[RefCount] Freed: ${obj.id} (${obj.size}KB)`);

      // Cascading release: giáº£m refCount cá»§a táº¥t cáº£ references
      for (const ref of obj.references) {
        this.release(ref);
      }

      // Remove from heap
      this.heap = this.heap.filter((o) => o !== obj);
    }
  }

  status() {
    console.log("\nğŸ“Š Heap status:");
    for (const obj of this.heap) {
      console.log(
        `  ${obj.id}: refCount=${obj.refCount}, refs=[${obj.references.map((r) => r.id).join(",")}]`,
      );
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO: Chá»©ng minh RC tháº¥t báº¡i vá»›i circular references
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("====== TEST 1: Mark-and-Sweep handles cycles ======");
const ms = new MarkAndSweepGC();

const root = ms.allocate("root", 1);
const objA = ms.allocate("A", 10);
const objB = ms.allocate("B", 20);
const objC = ms.allocate("C", 5);

// root â†’ A, A â†’ B â†’ C (linear chain)
root.addReference(objA);
objA.addReference(objB);
objB.addReference(objC);

// Táº¡o circular: B â†” C
objC.addReference(objB); // C â†’ B â†’ táº¡o cycle B â†” C!

// Set root
ms.roots = [root];

// Remove reference root â†’ A (simulate: root.a = null)
root.removeReference(objA);

// GC â€” Mark-and-Sweep sáº½ tÃ¬m tháº¥y A, B, C unreachable
ms.collect();
// Output: Freed 3 objects (35KB) â€” A, B, C Ä‘á»u bá»‹ sweep
// âœ… Cycle B â†” C KHÃ”NG cáº£n GC!

console.log("\n====== TEST 2: Reference Counting FAILS with cycles ======");
const rc = new ReferenceCountingGC();

const rcA = rc.allocate("A", 10);
const rcB = rc.allocate("B", 20);

// Táº¡o circular: A â†” B
rcA.addReference(rcB); // B.refCount = 2
rcB.addReference(rcA); // A.refCount = 2

// Simulate: A = null, B = null (xÃ³a variable references)
rc.release(rcA); // A.refCount = 2 â†’ 1 (váº«n > 0!)
rc.release(rcB); // B.refCount = 2 â†’ 1 (váº«n > 0!)

rc.status();
// Output: A: refCount=1, B: refCount=1
// âŒ Cáº¢ HAI VáºªN TRÃŠN HEAP! â†’ MEMORY LEAK!
// Circular reference khiáº¿n refCount KHÃ”NG BAO GIá»œ vá» 0
```

**BÃ i táº­p má»Ÿ rá»™ng** (cho báº¡n tá»± thá»±c hÃ nh):

1. **Implement Tri-color marking**: Thay `marked: boolean` báº±ng `color: 'white' | 'grey' | 'black'`. Implement incremental marking â€” má»—i step xá»­ lÃ½ 1 grey object.
2. **Implement Semi-space copying**: Táº¡o 2 arrays (From, To). Allocate vÃ o From. Khi Ä‘áº§y, copy live objects sang To, swap.
3. **Implement Generational GC**: Káº¿t há»£p Semi-space cho "Young" objects (age â‰¤ 2) vÃ  Mark-Sweep cho "Old" objects (age > 2).

> **Interview insight**: Náº¿u báº¡n cÃ³ thá»ƒ **váº½ code** implement Mark-and-Sweep trÃªn whiteboard trong interview, interviewer sáº½ cá»±c ká»³ áº¥n tÆ°á»£ng. Key steps: (1) traverse from roots báº±ng DFS/BFS, (2) mark visited nodes, (3) sweep unmarked nodes. Chá»‰ ~30 dÃ²ng code.

---

#### Pattern 6: Lá»‹ch Sá»­ & Sá»± Tiáº¿n HÃ³a â€” Táº¡i Sao GC Tá»“n Táº¡i NhÆ° NgÃ y Nay

Má»i cÃ´ng nghá»‡ sinh ra Ä‘á»ƒ **giáº£i quyáº¿t váº¥n Ä‘á»** cá»§a cÃ´ng nghá»‡ tiá»n nhiá»‡m. GC cÃ³ lá»‹ch sá»­ 65+ nÄƒm, vÃ  má»—i bÆ°á»›c tiáº¿n hÃ³a Ä‘á»u giáº£i quyáº¿t má»™t pain point cá»¥ thá»ƒ:

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TIMELINE â€” 65 NÄ‚M TIáº¾N HÃ“A Cá»¦A GARBAGE COLLECTION             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1959  John McCarthy phÃ¡t minh GC cho Lisp                      â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Lisp dÃ¹ng linked lists kháº¯p nÆ¡i              â”‚
â”‚   â”‚       â†’ manual free quÃ¡ khÃ³ â†’ cáº§n automatic                 â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: Mark-and-Sweep Ä‘áº§u tiÃªn                   â”‚
â”‚   â”‚                                                             â”‚
â”‚  1960  George Collins phÃ¡t minh Reference Counting              â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Mark-and-Sweep dá»«ng toÃ n bá»™ program quÃ¡ lÃ¢u  â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: Äáº¿m refs, free ngay khi count=0. Nhanh!   â”‚
â”‚   â”‚    â””â”€ NhÆ°ng: KHÃ”NG detect cycles â†’ memory leaks             â”‚
â”‚   â”‚                                                             â”‚
â”‚  1969  Fenichel & Yochelson phÃ¡t minh Semi-space Copying GC     â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Mark-Sweep gÃ¢y fragmentation                 â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: Copy live objects â†’ compact tá»± nhiÃªn       â”‚
â”‚   â”‚    â””â”€ Trade-off: Cáº§n 2x memory                              â”‚
â”‚   â”‚                                                             â”‚
â”‚  1984  David Ungar: "Generation Scavenging"                     â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: GC scan toÃ n bá»™ heap quÃ¡ cháº­m                â”‚
â”‚   â”‚    â””â”€ Insight: "Most objects die young" (Generational       â”‚
â”‚   â”‚       Hypothesis) â€” scan young objects thÆ°á»ng xuyÃªn,         â”‚
â”‚   â”‚       old objects hiáº¿m khi                                   â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: Generational GC â€” Ná»€N Táº¢NG cho V8 GC      â”‚
â”‚   â”‚                                                             â”‚
â”‚  1995  JavaScript ra Ä‘á»i (Brendan Eich, 10 ngÃ y)                â”‚
â”‚   â”‚    â””â”€ GC Ä‘Æ¡n giáº£n: Mark-and-Sweep cÆ¡ báº£n                   â”‚
â”‚   â”‚    â””â”€ Web lÃºc Ä‘Ã³ Ä‘Æ¡n giáº£n â†’ khÃ´ng cáº§n GC phá»©c táº¡p          â”‚
â”‚   â”‚                                                             â”‚
â”‚  1998  IE 4-6: Reference Counting cho COM/DOM                   â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Circular refs giá»¯a JS â†” DOM â†’ memory leaks  â”‚
â”‚   â”‚    â””â”€ ÄÃ¢y lÃ  ká»· nguyÃªn "memory leak hell" cá»§a web dev      â”‚
â”‚   â”‚    â””â”€ jQuery ra Ä‘á»i pháº§n lá»›n Ä‘á»ƒ workaround IE memory issues â”‚
â”‚   â”‚                                                             â”‚
â”‚  2008  V8 Engine ra Ä‘á»i cÃ¹ng Chrome                             â”‚
â”‚   â”‚    â””â”€ Generational GC (Scavenger + Mark-Compact)            â”‚
â”‚   â”‚    â””â”€ JavaScript tá»« "ngÃ´n ngá»¯ cháº­m" â†’ nhanh Ä‘Ã¡ng kinh ngáº¡c â”‚
â”‚   â”‚                                                             â”‚
â”‚  2011  V8 Incremental Marking                                   â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Websites ngÃ y cÃ ng phá»©c táº¡p (SPAs)           â”‚
â”‚   â”‚    â””â”€ Major GC pause gÃ¢y jank trÃªn heavy pages              â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: Chia marking thÃ nh nhiá»u bÆ°á»›c nhá»          â”‚
â”‚   â”‚                                                             â”‚
â”‚  2018  V8 Orinoco â€” Concurrent & Parallel GC                   â”‚
â”‚   â”‚    â””â”€ Váº¥n Ä‘á»: Mobile devices cháº­m, web apps náº·ng hÆ¡n       â”‚
â”‚   â”‚    â””â”€ Giáº£i phÃ¡p: GC cháº¡y trÃªn background threads            â”‚
â”‚   â”‚    â””â”€ Káº¿t quáº£: Pause time < 5ms â€” gáº§n nhÆ° invisible         â”‚
â”‚   â”‚                                                             â”‚
â”‚  2021  WeakRef & FinalizationRegistry (ES2021)                  â”‚
â”‚   â”‚    â””â”€ Cho phÃ©p developers "cooperative" vá»›i GC              â”‚
â”‚   â”‚    â””â”€ WeakRef: Reference khÃ´ng ngÄƒn GC. FinalizationRegistryâ”‚
â”‚   â”‚       : callback khi object bá»‹ GC                           â”‚
â”‚   â”‚                                                             â”‚
â”‚  2024+ WebAssembly GC proposal                                  â”‚
â”‚        â””â”€ Váº¥n Ä‘á»: Wasm modules cáº§n share objects vá»›i JS         â”‚
â”‚        â””â”€ Giáº£i phÃ¡p: Unified GC cho cáº£ JS vÃ  Wasm              â”‚
â”‚        â””â”€ TÆ°Æ¡ng lai: GC-managed objects trong Wasm              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**TrÆ°á»›c khi cÃ³ GC, developers lÃ m gÃ¬?**

```c
// C (1972) â€” TrÆ°á»›c GC phá»• biáº¿n: Manual memory management
// Developer pháº£i Tá»° TAY allocate vÃ  free Tá»ªNG byte

typedef struct Node {
    int data;
    struct Node* next;
} Node;

Node* createList() {
    // Allocate 1000 nodes
    Node* head = (Node*)malloc(sizeof(Node));
    Node* current = head;
    for (int i = 0; i < 999; i++) {
        current->next = (Node*)malloc(sizeof(Node));
        current->data = i;
        current = current->next;
    }
    return head;
}

void freeList(Node* head) {
    // Pháº£i FREE Tá»ªNG NODE â€” quÃªn 1 node = leak!
    Node* current = head;
    while (current != NULL) {
        Node* next = current->next;
        free(current);  // Free from Ä‘áº§u...
        current = next;
    }
    // Náº¿u bug trong logic â†’ use-after-free, double-free, hoáº·c leak
    // Coder C thá»i 80-90s dÃ nh ~30% thá»i gian debug memory issues
}
```

```javascript
// JavaScript (1995+) â€” GC tá»± lo táº¥t cáº£
function createList() {
  const list = [];
  for (let i = 0; i < 1000; i++) {
    list.push({ data: i, next: null });
  }
  // Link nodes
  for (let i = 0; i < 999; i++) {
    list[i].next = list[i + 1];
  }
  return list[0]; // head
}

let list = createList();
// ... sá»­ dá»¥ng xong ...
list = null;
// GC sáº½ tá»± traverse vÃ  free TOÃ€N Bá»˜ 1000 nodes
// Developer khÃ´ng cáº§n nghÄ© gÃ¬ â€” ZERO memory bugs

// â†’ ÄÃ¢y lÃ  lÃ½ do JavaScript phá»• biáº¿n: lowered barrier to entry
// â†’ VÃ  lÃ½ do C/C++ váº«n dÃ¹ng cho systems programming: max performance
```

**Táº¡i sao Rust chá»n con Ä‘Æ°á»ng thá»© 3?**

Rust (2010) nhÃ¬n 50 nÄƒm lá»‹ch sá»­ vÃ  há»i: "CÃ³ cÃ¡ch nÃ o cÃ³ **safety** nhÆ° GC mÃ  **performance** nhÆ° manual?". Giáº£i phÃ¡p: **Ownership + Borrow Checker** â€” compiler tá»± xÃ¡c Ä‘á»‹nh **khi nÃ o** memory Ä‘Æ°á»£c free, táº¡i compile time, khÃ´ng cáº§n runtime GC.

```rust
// Rust â€” Ownership system: no GC, no manual free, no bugs
fn main() {
    let s1 = String::from("hello");  // s1 owns the String
    let s2 = s1;                     // Ownership MOVE sang s2
    // println!("{}", s1);           // âŒ COMPILE ERROR! s1 Ä‘Ã£ bá»‹ move
    println!("{}", s2);              // âœ… OK
}   // s2 goes out of scope â†’ Rust auto-drops táº¡i Ä‘Ã¢y
    // KhÃ´ng cáº§n GC. KhÃ´ng cáº§n free(). Compiler tá»± biáº¿t.
```

NhÆ°ng trade-off: Rust's borrow checker **cá»±c ká»³ strict** â€” code há»£p lá»‡ vá» logic váº«n bá»‹ reject náº¿u vi pháº¡m ownership rules. Learning curve dá»‘c. ÄÃ¢y lÃ  lÃ½ do JavaScript (GC) váº«n phá»• biáº¿n cho web: **ease of use** quan trá»ng hÆ¡n **max performance** trong web development.

> **Interview insight â€” Historical Perspective**: Náº¿u interviewer há»i "táº¡i sao JavaScript dÃ¹ng GC?", Ä‘á»«ng chá»‰ nÃ³i "vÃ¬ tá»± Ä‘á»™ng quáº£n lÃ½ memory". HÃ£y ká»ƒ cÃ¢u chuyá»‡n: GC phÃ¡t minh 1959 cho Lisp â†’ JavaScript (1995) adopt vÃ¬ web cáº§n **safety cho untrusted code** â†’ IE dÃ¹ng Reference Counting â†’ fail vá»›i circular refs â†’ modern browsers chuyá»ƒn sang Mark-and-Sweep â†’ V8 nÃ¢ng cáº¥p thÃ nh Generational GC â†’ Orinoco concurrent GC â†’ pause < 5ms. **Hiá»ƒu lá»‹ch sá»­ = hiá»ƒu táº¡i sao má»i thá»© Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° hiá»‡n táº¡i.**

---

## 10. Scope vÃ  Scope Chain

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Scope: Ná»n Táº£ng VÃ´ HÃ¬nh Chi Phá»‘i Má»i DÃ²ng Code JavaScript**

Náº¿u cÃ³ má»™t khÃ¡i niá»‡m mÃ  **má»i** JavaScript developer sá»­ dá»¥ng hÃ ng ngÃ y nhÆ°ng ráº¥t Ã­t ngÆ°á»i thá»±c sá»± hiá»ƒu sÃ¢u, Ä‘Ã³ chÃ­nh lÃ  **Scope**. Má»—i khi báº¡n khai bÃ¡o biáº¿n, gá»i function, hay viáº¿t má»™t callback â€” scope Ä‘ang hoáº¡t Ä‘á»™ng Ã¢m tháº§m phÃ­a sau, quyáº¿t Ä‘á»‹nh biáº¿n nÃ o báº¡n cÃ³ thá»ƒ truy cáº­p, biáº¿n nÃ o bá»‹ áº©n, vÃ  biáº¿n nÃ o sáº½ sá»‘ng hay cháº¿t.

Scope khÃ´ng pháº£i "chá»‰ lÃ  pháº¡m vi biáº¿n" â€” nÃ³ lÃ  **há»‡ thá»‘ng báº£o máº­t** cá»§a JavaScript. Giá»‘ng nhÆ° má»™t tÃ²a nhÃ  vÄƒn phÃ²ng: báº¡n cÃ³ tháº» nhÃ¢n viÃªn cho phÃ©p vÃ o táº§ng cá»§a mÃ¬nh (function scope), vÃ o phÃ²ng cá»§a mÃ¬nh (block scope), nhÆ°ng khÃ´ng vÃ o Ä‘Æ°á»£c phÃ²ng server hay phÃ²ng giÃ¡m Ä‘á»‘c (outer scope restrictions). Tháº» quáº£n lÃ½ cáº¥p cao hÆ¡n cho phÃ©p vÃ o nhiá»u phÃ²ng hÆ¡n â€” Ä‘Ã³ lÃ  scope chain: **quyá»n truy cáº­p tÄƒng dáº§n tá»« trong ra ngoÃ i**.

Hiá»ƒu scope sÃ¢u sáº½ giáº£i Ä‘Ã¡p **ráº¥t nhiá»u** cÃ¢u há»i khiáº¿n developers bá»‘i rá»‘i:

- Táº¡i sao `var` trong loop gÃ¢y bug nhÆ°ng `let` thÃ¬ khÃ´ng?
- Táº¡i sao closure "nhá»›" Ä‘Æ°á»£c biáº¿n cá»§a function Ä‘Ã£ return?
- Táº¡i sao biáº¿n khai bÃ¡o trong `if {}` khÃ´ng tháº¥y bÃªn ngoÃ i?
- Táº¡i sao `this` hoáº¡t Ä‘á»™ng khÃ¡c trong arrow function?
- Táº¡i sao module pattern dÃ¹ng IIFE?

Táº¥t cáº£ Ä‘á»u lÃ  **há»‡ quáº£ trá»±c tiáº¿p** cá»§a scope system. HÃ£y Ä‘i tá»« cÆ¡ báº£n Ä‘áº¿n chuyÃªn sÃ¢u.

### Scope LÃ  GÃ¬?

**BÃ i viáº¿t â€” Scope: "Luáº­t ChÆ¡i" Cá»§a Biáº¿n Trong JavaScript**

á» má»©c Ä‘Æ¡n giáº£n nháº¥t, Scope lÃ  **luáº­t chÆ¡i** xÃ¡c Ä‘á»‹nh "biáº¿n nÃ o cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p á»Ÿ Ä‘Ã¢u". NhÆ°ng Ä‘á»ƒ thá»±c sá»± hiá»ƒu, cáº§n phÃ¢n biá»‡t 3 khÃ­a cáº¡nh:

1. **Scope as Visibility** â€” Scope quyáº¿t Ä‘á»‹nh biáº¿n nÃ o "nhÃ¬n tháº¥y" tá»« vá»‹ trÃ­ hiá»‡n táº¡i. Khai bÃ¡o `let x = 10` trong function `foo()` â†’ `x` chá»‰ "visible" bÃªn trong `foo()`. Code bÃªn ngoÃ i nhÃ¬n vÃ o tháº¥y `x` **khÃ´ng tá»“n táº¡i** â€” nhÆ° thá»ƒ nÃ³ chÆ°a bao giá» Ä‘Æ°á»£c khai bÃ¡o.

2. **Scope as Lifetime** â€” Scope quyáº¿t Ä‘á»‹nh biáº¿n **sá»‘ng bao lÃ¢u**. Khi execution rá»i khá»i scope â†’ biáº¿n bÃªn trong eligible for GC. Block scope (`let` trong `{}`) cho phÃ©p biáº¿n cháº¿t **ngay khi block káº¿t thÃºc** â€” sá»›m hÆ¡n function scope.

3. **Scope as Protection** â€” Scope **báº£o vá»‡** biáº¿n khá»i bá»‹ overwrite bá»Ÿi code khÃ¡c. ÄÃ¢y lÃ  lÃ½ do fundamental táº¡i sao scope tá»“n táº¡i: **isolation**. Trong tháº¿ giá»›i khÃ´ng cÃ³ scope, má»i biáº¿n lÃ  global â†’ má»i script trÃªn trang cÃ³ thá»ƒ Ä‘á»c/ghi báº¥t ká»³ biáº¿n nÃ o â†’ **chaos**.

> **Analogy**: HÃ£y nghÄ© scope nhÆ° **phÃ²ng** trong nhÃ . Má»—i phÃ²ng cÃ³ Ä‘á»“ riÃªng (biáº¿n). Báº¡n Ä‘á»©ng trong phÃ²ng ngá»§ (inner scope) â†’ tháº¥y Ä‘á»“ phÃ²ng ngá»§ + nhÃ¬n ra hÃ nh lang (outer scope) + tháº¥y Ä‘á»“ dÃ¹ng chung (global). NhÆ°ng tá»« hÃ nh lang, báº¡n **khÃ´ng nhÃ¬n vÃ o** Ä‘Æ°á»£c phÃ²ng ngá»§ Ä‘Ã£ Ä‘Ã³ng cá»­a.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE â€” PHáº M VI TRUY Cáº¬P BIáº¾N                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Scope = Pháº¡m vi trong Ä‘Ã³ biáº¿n vÃ  function cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Scope Ä‘Æ°á»£c táº¡o bá»Ÿi: MÃ”I TRÆ¯á»œNG HIá»†N Táº I (current context)  â”‚
â”‚     + chuá»—i cÃ¡c VARIABLE OBJECTS tá»« táº§ng trÃªn                   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Má»¥c Ä‘Ã­ch lá»›n nháº¥t: CÃCH LY BIáº¾N                             â”‚
â”‚     â†’ Biáº¿n cÃ¹ng tÃªn á»Ÿ scope khÃ¡c nhau KHÃ”NG xung Ä‘á»™t            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  3 LOáº I SCOPE:                                             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  1ï¸âƒ£  Global Scope   â†’ Truy cáº­p má»i nÆ¡i trong chÆ°Æ¡ng trÃ¬nh â”‚ â”‚
â”‚  â”‚  2ï¸âƒ£  Function Scope â†’ Chá»‰ truy cáº­p bÃªn trong function     â”‚ â”‚
â”‚  â”‚  3ï¸âƒ£  Block Scope    â†’ Chá»‰ truy cáº­p bÃªn trong {} (ES6)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3 Loáº¡i Scope Chi Tiáº¿t

**BÃ i viáº¿t â€” Ba Loáº¡i Scope: HÃ nh TrÃ¬nh Tá»« Há»—n Loáº¡n Äáº¿n Tráº­t Tá»±**

JavaScript cÃ³ **3 loáº¡i scope**, nhÆ°ng chÃºng khÃ´ng ra Ä‘á»i cÃ¹ng lÃºc. ÄÃ¢y lÃ  cÃ¢u chuyá»‡n **tiáº¿n hÃ³a 20 nÄƒm**:

**Global Scope** lÃ  scope "nguyÃªn thá»§y" â€” tá»“n táº¡i tá»« ngÃ y Ä‘áº§u. Má»i biáº¿n khai bÃ¡o ngoÃ i function Ä‘á»u thuá»™c global scope, vÃ  báº¥t ká»³ code nÃ o trÃªn page Ä‘á»u truy cáº­p Ä‘Æ°á»£c. Trong browser, global scope gáº¯n vá»›i `window` object â€” `var x = 1` tÆ°Æ¡ng Ä‘Æ°Æ¡ng `window.x = 1`. ÄÃ¢y vá»«a lÃ  **tiá»‡n lá»£i** (shared state) vá»«a lÃ  **nguá»“n bug** lá»›n nháº¥t (namespace pollution). CÃ¡c framework lá»›n nhÆ° jQuery (`$`), Lodash (`_`), Angular (`angular`) Ä‘á»u chiáº¿m 1 slot trÃªn global scope â€” vÃ  developers pháº£i cáº§u nguyá»‡n khÃ´ng ai dÃ¹ng trÃ¹ng tÃªn.

**Function Scope** lÃ  "nÃ¢ng cáº¥p" Ä‘áº§u tiÃªn â€” cho phÃ©p **Ä‘Ã³ng gÃ³i** biáº¿n bÃªn trong function. ÄÃ¢y lÃ  cÆ¡ cháº¿ duy nháº¥t JavaScript cÃ³ trong 20 nÄƒm Ä‘áº§u (1995-2015). Má»i design pattern cá»• Ä‘iá»ƒn â€” Module Pattern, Revealing Module, IIFE â€” Ä‘á»u exploit function scope Ä‘á»ƒ táº¡o "private variables". NhÆ°á»£c Ä‘iá»ƒm: `var` chá»‰ respect function boundaries, **khÃ´ng respect** block boundaries (`if`, `for`, `while`) â†’ source of countless bugs.

**Block Scope** (ES6, 2015) lÃ  cuá»™c cÃ¡ch máº¡ng. `let` vÃ  `const` táº¡o scope cho **má»i** `{}` block â€” `if`, `for`, `while`, tháº­m chÃ­ bare `{}`. Cuá»‘i cÃ¹ng JavaScript cÅ©ng cÃ³ scope granularity ngang hÃ ng C/Java/Python. Block scope giáº£i quyáº¿t bug kinh Ä‘iá»ƒn "closure in loop" vÃ  cho phÃ©p **fine-grained memory management** â€” biáº¿n cháº¿t ngay khi block káº¿t thÃºc, khÃ´ng pháº£i Ä‘á»£i cáº£ function return.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1ï¸âƒ£ GLOBAL SCOPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Code cÃ³ thá»ƒ truy cáº­p tá»« báº¥t ká»³ Ä‘Ã¢u trong chÆ°Æ¡ng trÃ¬nh
// Built-in properties cá»§a window object cÃ³ global scope

var globalVar = "I'm global"; // âœ… Global scope
function globalFn() {
  /* ... */
} // âœ… Global scope
// window.globalVar, window.globalFn Ä‘á»u accessible

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2ï¸âƒ£ FUNCTION SCOPE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chá»‰ truy cáº­p Ä‘Æ°á»£c bÃªn trong function

function myFunction() {
  var localVar = "I'm local"; // Function scope
  let anotherLocal = "Also local"; // Function scope (+ block)

  console.log(localVar); // âœ… Accessible
  console.log(globalVar); // âœ… CÃ³ thá»ƒ truy cáº­p scope cha (global)
}

// console.log(localVar);    // âŒ ReferenceError â€” ngoÃ i function scope

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3ï¸âƒ£ BLOCK SCOPE (ES6 â€” let, const)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chá»‰ truy cáº­p bÃªn trong {} (if, for, while, v.v.)

if (true) {
  let blockVar = "I'm block-scoped";
  const blockConst = "Me too";
  var notBlocked = "I escape!"; // âš ï¸ var KHÃ”NG bá»‹ block scope

  console.log(blockVar); // âœ…
}

// console.log(blockVar);   // âŒ ReferenceError
// console.log(blockConst); // âŒ ReferenceError
console.log(notBlocked); // âœ… "I escape!" (var = function scope)
```

### Execution Context vÃ  [[scope]]

**BÃ i viáº¿t â€” Execution Context: "Backstage Pass" Hiá»ƒu Scope Hoáº¡t Äá»™ng BÃªn Trong Engine**

Äá»ƒ thá»±c sá»± hiá»ƒu scope, báº¡n cáº§n hiá»ƒu **Execution Context (EC)** â€” cÆ¡ cháº¿ mÃ  V8 engine dÃ¹ng Ä‘á»ƒ implement scope á»Ÿ runtime level.

Khi JavaScript engine cháº¡y code, nÃ³ táº¡o má»™t **Execution Context** cho má»—i "unit of execution": 1 EC cho global code, 1 EC cho **má»—i láº§n** function Ä‘Æ°á»£c gá»i. EC lÃ  "mÃ´i trÆ°á»ng" chá»©a:

- **Variable Environment**: nÆ¡i lÆ°u trá»¯ táº¥t cáº£ biáº¿n, function declarations, parameters
- **Lexical Environment**: reference Ä‘áº¿n outer scope (parent EC)
- **`this` binding**: giÃ¡ trá»‹ `this` trong context Ä‘Ã³

Äiá»ƒm quan trá»ng nháº¥t: khi function **Ä‘Æ°á»£c táº¡o** (khÃ´ng pháº£i khi gá»i!), engine lÆ°u reference Ä‘áº¿n **current Execution Context** vÃ o property áº©n `[[scope]]` cá»§a function. Property nÃ y KHÃ”NG thá»ƒ truy cáº­p tá»« JavaScript code â€” nÃ³ lÃ  **internal slot** chá»‰ engine biáº¿t. Khi function Ä‘Æ°á»£c **gá»i**, engine táº¡o EC má»›i vÃ  chain nÃ³ vá»›i `[[scope]]` â†’ Ä‘Ã¢y chÃ­nh lÃ  **scope chain** Ä‘Æ°á»£c hÃ¬nh thÃ nh.

Äiá»u nÃ y giáº£i thÃ­ch táº¡i sao scope lÃ  **lexical** (static): `[[scope]]` Ä‘Æ°á»£c set táº¡i thá»i Ä‘iá»ƒm function **definition**, based on WHERE trong source code function Ä‘Æ°á»£c viáº¿t â€” khÃ´ng phá»¥ thuá»™c WHERE function Ä‘Æ°á»£c gá»i lÃºc runtime.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXECUTION CONTEXT & [[scope]]                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi má»™t FUNCTION Ä‘Æ°á»£c Táº O, scope cá»§a nÃ³ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi      â”‚
â”‚  context nÆ¡i function Ä‘Æ°á»£c táº¡o ra (LEXICAL SCOPE)               â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Náº¿u function táº¡o á»Ÿ global:                                  â”‚
â”‚     fn.[[scope]] = EC(G)  (Execution Context Global)            â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Khi function Ä‘Æ°á»£c Gá»ŒI, má»™t private context Má»šI Ä‘Æ°á»£c táº¡o:    â”‚
â”‚     EC(FN) â†’ push vÃ o Call Stack Ä‘á»ƒ thá»±c thi code               â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  CALL STACK                                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚ â”‚
â”‚  â”‚  â”‚ EC(inner)                â”‚ â† Top (Ä‘ang cháº¡y)           â”‚ â”‚
â”‚  â”‚  â”‚   Variables: z = 30      â”‚                              â”‚ â”‚
â”‚  â”‚  â”‚   [[scope]] â†’ EC(outer)  â”‚                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚ â”‚
â”‚  â”‚  â”‚ EC(outer)                â”‚                              â”‚ â”‚
â”‚  â”‚  â”‚   Variables: y = 20      â”‚                              â”‚ â”‚
â”‚  â”‚  â”‚   [[scope]] â†’ EC(G)      â”‚                              â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚ â”‚
â”‚  â”‚  â”‚ EC(G) â€” Global Context   â”‚ â† Bottom                    â”‚ â”‚
â”‚  â”‚  â”‚   Variables: x = 10      â”‚                              â”‚ â”‚
â”‚  â”‚  â”‚   [[scope]] â†’ null       â”‚                              â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// Execution Context example

var x = 10; // EC(G): x = 10

function outer() {
  // outer.[[scope]] = EC(G)
  var y = 20; // EC(outer): y = 20

  function inner() {
    // inner.[[scope]] = EC(outer)
    var z = 30; // EC(inner): z = 30

    console.log(x); // 10 â†’ tÃ¬m trong EC(inner) âŒ â†’ EC(outer) âŒ â†’ EC(G) âœ…
    console.log(y); // 20 â†’ tÃ¬m trong EC(inner) âŒ â†’ EC(outer) âœ…
    console.log(z); // 30 â†’ tÃ¬m trong EC(inner) âœ…
  }

  inner(); // Táº¡o EC(inner) â†’ push vÃ o Call Stack
}

outer(); // Táº¡o EC(outer) â†’ push vÃ o Call Stack
```

### Scope Chain â€” Chuá»—i Pháº¡m Vi

**BÃ i viáº¿t â€” Scope Chain: Há»‡ Thá»‘ng "GPS" TÃ¬m Biáº¿n Cá»§a JavaScript**

Scope Chain lÃ  má»™t trong nhá»¯ng concept bá»‹ **hiá»ƒu nháº§m nhiá»u nháº¥t**. Nhiá»u developers nghÄ© nÃ³ lÃ  "danh sÃ¡ch cÃ¡c scope" â€” nhÆ°ng thá»±c cháº¥t nÃ³ lÃ  **linked list** of Lexical Environments, Ä‘Æ°á»£c V8 engine xÃ¢y dá»±ng tá»± Ä‘á»™ng má»—i khi function executed.

HÃ£y nghÄ© vá» Scope Chain nhÆ° há»‡ thá»‘ng GPS tÃ¬m Ä‘Æ°á»ng: khi engine gáº·p biáº¿n `x`, nÃ³ báº¯t Ä‘áº§u tÃ¬m tá»« "vá»‹ trÃ­ hiá»‡n táº¡i" (current scope), náº¿u khÃ´ng tháº¥y â†’ Ä‘i lÃªn "Ä‘Æ°á»ng chÃ­nh" (parent scope), rá»“i "Ä‘Æ°á»ng cao tá»‘c" (grandparent scope), cho Ä‘áº¿n "trung tÃ¢m thÃ nh phá»‘" (global scope). Náº¿u Ä‘áº¿n global váº«n khÃ´ng tháº¥y â†’ **"Ä‘á»‹a chá»‰ khÃ´ng tá»“n táº¡i"** â†’ `ReferenceError`.

Hai quy táº¯c cá»‘t lÃµi cá»§a Scope Chain:

1. **HÆ°á»›ng duy nháº¥t: TRONG â†’ NGOÃ€I** â€” Inner scope luÃ´n nhÃ¬n tháº¥y outer scope, nhÆ°ng outer scope **KHÃ”NG BAO GIá»œ** nhÃ¬n tháº¥y inner scope. ÄÃ¢y lÃ  one-way street.

2. **Scope Chain = Lexical, NOT Dynamic** â€” Chain Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi **nÆ¡i function Ä‘Æ°á»£c VIáº¾T** (lexical position), khÃ´ng pháº£i nÆ¡i nÃ³ Ä‘Æ°á»£c gá»i. ÄÃ¢y lÃ  Ä‘iá»ƒm khÃ¡c biá»‡t fundamental giá»¯a JavaScript vÃ  má»™t sá»‘ ngÃ´n ngá»¯ cá»• (Bash, Perl4 dÃ¹ng dynamic scope).

Hiá»ƒu rÃµ Scope Chain sáº½ giÃºp báº¡n predict chÃ­nh xÃ¡c output cá»§a **báº¥t ká»³** Ä‘oáº¡n code nÃ o liÃªn quan Ä‘áº¿n nested functions, closures, vÃ  variable shadowing.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE CHAIN â€” CÆ  CHáº¾ TÃŒM KIáº¾M BIáº¾N                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi truy cáº­p má»™t biáº¿n, JS engine tÃ¬m kiáº¿m theo thá»© tá»±:        â”‚
â”‚                                                                 â”‚
â”‚  Current Scope â†’ Parent Scope â†’ ... â†’ Global Scope              â”‚
â”‚                                                                 â”‚
â”‚  Chuá»—i tÃ¬m kiáº¿m nÃ y gá»i lÃ  SCOPE CHAIN                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  inner scope                                               â”‚ â”‚
â”‚  â”‚    â”‚ TÃ¬m biáº¿n 'x'                                         â”‚ â”‚
â”‚  â”‚    â”‚ âŒ KhÃ´ng cÃ³ â†’ tÃ¬m lÃªn trÃªn                            â”‚ â”‚
â”‚  â”‚    â–¼                                                       â”‚ â”‚
â”‚  â”‚  outer scope                                               â”‚ â”‚
â”‚  â”‚    â”‚ âŒ KhÃ´ng cÃ³ â†’ tÃ¬m lÃªn trÃªn                            â”‚ â”‚
â”‚  â”‚    â–¼                                                       â”‚ â”‚
â”‚  â”‚  global scope                                              â”‚ â”‚
â”‚  â”‚    â”‚ âœ… TÃ¬m tháº¥y x = 10 â†’ Dá»ªNG                            â”‚ â”‚
â”‚  â”‚    â”‚                                                       â”‚ â”‚
â”‚  â”‚    â”‚ (Náº¿u khÃ´ng tÃ¬m tháº¥y á»Ÿ global â†’ ReferenceError)       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ QUAN TRá»ŒNG:                                                 â”‚
â”‚  Scope chain Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi NÆ I FUNCTION ÄÆ¯á»¢C Táº O            â”‚
â”‚  (Lexical/Static Scope) â€” KHÃ”NG PHáº¢I nÆ¡i function Ä‘Æ°á»£c gá»i      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCOPE CHAIN LOOKUP â€” tÃ¬m biáº¿n tá»« scope táº¡o ra function
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var name = "global";

function outer() {
  var name = "outer";

  function inner() {
    // inner khÃ´ng cÃ³ biáº¿n name
    // â†’ tÃ¬m lÃªn scope CHA (nÆ¡i inner Ä‘Æ°á»£c Táº O = outer)
    console.log(name); // "outer" âœ… (khÃ´ng pháº£i "global")
  }

  inner();
}

outer();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LEXICAL SCOPE: Scope xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm Táº O, khÃ´ng pháº£i Gá»ŒI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var value = 1;

function foo() {
  console.log(value); // scope chain: foo â†’ global
}

function bar() {
  var value = 2;
  foo(); // Gá»i foo() Tá»ª bar, nhÆ°ng scope chain cá»§a foo KHÃ”NG Ä‘á»•i!
}

bar();
// Output: 1 â† foo tÃ¬m value á»Ÿ global (nÆ¡i foo Ä‘Æ°á»£c Táº O)
//            â† KHÃ”NG TÃŒM trong bar (nÆ¡i foo Ä‘Æ°á»£c Gá»ŒI)
```

### Variable Isolation â€” CÃ¡ch Ly Biáº¿n

**BÃ i viáº¿t â€” Variable Isolation: LÃ½ Do Scope Tá»“n Táº¡i**

Náº¿u ai há»i "Scope dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?", cÃ¢u tráº£ lá»i **sÃ¢u nháº¥t** lÃ : **Variable Isolation** (cÃ¡ch ly biáº¿n). Má»i thá»© khÃ¡c â€” closures, modules, encapsulation â€” Ä‘á»u lÃ  **há»‡ quáº£** cá»§a isolation.

Táº¡i sao isolation quan trá»ng? HÃ£y tÆ°á»Ÿng tÆ°á»£ng dá»± Ã¡n e-commerce cÃ³ 50 script files, 20 thÆ° viá»‡n third-party, 10 ad trackers â€” táº¥t cáº£ cháº¡y trÃªn cÃ¹ng page. Náº¿u khÃ´ng cÃ³ isolation, má»i biáº¿n tá»« má»i script chia sáº» cÃ¹ng namespace. Biáº¿n `user` tá»« auth script, biáº¿n `user` tá»« analytics, biáº¿n `user` tá»« ad tracker â†’ **clash**. á»¨ng dá»¥ng crash ngáº«u nhiÃªn, data bá»‹ corrupt, vÃ  **khÃ´ng ai biáº¿t lá»—i tá»« Ä‘Ã¢u**.

Scope giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch táº¡o **"hÃ ng rÃ o vÃ´ hÃ¬nh"** quanh má»—i function/block. Biáº¿n bÃªn trong hÃ ng rÃ o **khÃ´ng nhÃ¬n tháº¥y** tá»« bÃªn ngoÃ i. Hai functions cÃ³ thá»ƒ dÃ¹ng cÃ¹ng tÃªn biáº¿n `count`, `data`, `result` mÃ  **hoÃ n toÃ n khÃ´ng áº£nh hÆ°á»Ÿng nhau** â€” nhÆ° hai phÃ²ng khÃ¡ch sáº¡n cÃ¹ng cÃ³ TV nhÆ°ng remote phÃ²ng nÃ y khÃ´ng Ä‘iá»u khiá»ƒn TV phÃ²ng kia.

Trong practice, Variable Isolation cho phÃ©p:

- **Modular code**: Má»—i module cÃ³ private state, expose API qua exports
- **Parallel development**: Developers lÃ m viá»‡c trÃªn functions khÃ¡c nhau mÃ  khÃ´ng sá»£ conflict tÃªn biáº¿n
- **Testability**: Test tá»«ng function independently â€” biáº¿n khÃ´ng leak giá»¯a tests
- **Security**: Sensitive data (API keys, tokens) chá»‰ accessible trong scope cáº§n thiáº¿t

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Scope cÃ¡ch ly biáº¿n â€” biáº¿n cÃ¹ng tÃªn, khÃ¡c scope, KHÃ”NG xung Ä‘á»™t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function moduleA() {
  var count = 0;
  return {
    increment: () => ++count,
    getCount: () => count,
  };
}

function moduleB() {
  var count = 100; // CÃ¹ng tÃªn "count" nhÆ°ng KHÃC scope â†’ OK!
  return {
    increment: () => ++count,
    getCount: () => count,
  };
}

const a = moduleA();
const b = moduleB();

a.increment(); // 1
b.increment(); // 101
a.getCount(); // 1  â† khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi moduleB
b.getCount(); // 101 â† khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi moduleA
```

### Scope Chain vÃ  Closures

**BÃ i viáº¿t â€” Scope Chain + Closures: "Bá»™ Nhá»› DÃ i Háº¡n" Cá»§a JavaScript Functions**

ÄÃ¢y lÃ  nÆ¡i scope chain trá»Ÿ nÃªn **thá»±c sá»± thÃº vá»‹** â€” vÃ  cÅ©ng lÃ  nÆ¡i gÃ¢y **confusing nháº¥t** cho beginners. BÃ¬nh thÆ°á»ng, khi function return, Execution Context bá»‹ pop khá»i call stack â†’ biáº¿n local bá»‹ destroy â†’ memory freed. ÄÃ¢y lÃ  behavior bÃ¬nh thÆ°á»ng vÃ  expected.

NhÆ°ng **closures** phÃ¡ vá»¡ quy táº¯c Ä‘Ã³. Khi inner function **escaped** ra bÃªn ngoÃ i (returned, passed as callback, stored in variable) â†’ scope chain **bá»‹ giá»¯ alive**. Engine KHÃ”NG ÄÆ¯á»¢C destroy outer EC vÃ¬ inner function váº«n cÃ³ thá»ƒ **truy cáº­p** biáº¿n á»Ÿ outer scope thÃ´ng qua scope chain. ÄÃ¢y lÃ  lÃ½ do:

- Closure function **"nhá»›"** biáº¿n tá»« environment nÆ¡i nÃ³ sinh ra â€” dÃ¹ environment Ä‘Ã³ Ä‘Ã£ "káº¿t thÃºc" tá»« gÃ³c nhÃ¬n call stack
- Biáº¿n outer function **khÃ´ng bá»‹ GC** â€” vÃ¬ scope chain reference váº«n tá»“n táº¡i
- Má»—i closure call táº¡o **independent** scope chain instance â€” gá»i `createCounter()` 3 láº§n â†’ 3 biáº¿n `count` riÃªng biá»‡t

ÄÃ¢y chÃ­nh lÃ  cÆ¡ cháº¿ cho phÃ©p JavaScript implement **private variables** (trÆ°á»›c khi cÃ³ `#private` fields), **memoization**, **factory functions**, **event handlers with state**, vÃ  háº§u háº¿t **React hooks** (`useState`, `useEffect` Ä‘á»u dá»±a trÃªn closures Ä‘á»ƒ "nhá»›" state giá»¯a cÃ¡c re-renders).

NhÆ°ng Ä‘Ã¢y cÅ©ng lÃ  **nguá»“n memory leak phá»• biáº¿n nháº¥t**: closure giá»¯ scope chain alive â†’ táº¥t cáº£ biáº¿n trong scope Ä‘Ã³ sá»‘ng mÃ£i â†’ náº¿u closure tá»“n táº¡i lÃ¢u (event listener khÃ´ng cleanup, timer khÃ´ng clear), memory **tÃ­ch lÅ©y** dáº§n theo thá»i gian.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Closure = function GIá»® Láº I scope chain cá»§a nÆ¡i nÃ³ Ä‘Æ°á»£c táº¡o
// Ngay cáº£ khi execution context cha Ä‘Ã£ bá»‹ pop khá»i call stack
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createCounter() {
  let count = 0; // EC(createCounter): count = 0

  return function () {
    // closure.[[scope]] = EC(createCounter)
    count++;
    return count;
  };
}

const counter = createCounter();
// EC(createCounter) Ä‘Ã£ POP khá»i call stack
// NhÆ°ng closure VáºªN GIá»® reference Ä‘áº¿n scope chain â†’ count váº«n sá»‘ng!

counter(); // 1
counter(); // 2
counter(); // 3

// âš ï¸ ÄÃ¢y chÃ­nh lÃ  lÃ½ do closure TIÃŠU THá»¤ MEMORY
// count KHÃ”NG Ä‘Æ°á»£c GC vÃ¬ closure váº«n reference Ä‘áº¿n nÃ³
// â†’ Pháº£i set counter = null khi khÃ´ng dÃ¹ng ná»¯a
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE CHAIN vs PROTOTYPE CHAIN â€” Äá»ªNG NHáº¦M LáºªN!                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  SCOPE CHAIN:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“Œ TÃ¬m kiáº¿m BIáº¾N (variables)                              â”‚ â”‚
â”‚  â”‚  ğŸ“Œ HÆ°á»›ng: inner scope â†’ outer scope â†’ global scope        â”‚ â”‚
â”‚  â”‚  ğŸ“Œ XÃ¡c Ä‘á»‹nh táº¡i COMPILE TIME (lexical/static)             â”‚ â”‚
â”‚  â”‚  ğŸ“Œ ReferenceError náº¿u khÃ´ng tÃ¬m tháº¥y                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  PROTOTYPE CHAIN:                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“Œ TÃ¬m kiáº¿m PROPERTY cá»§a object                           â”‚ â”‚
â”‚  â”‚  ğŸ“Œ HÆ°á»›ng: obj â†’ obj.__proto__ â†’ ... â†’ null                â”‚ â”‚
â”‚  â”‚  ğŸ“Œ XÃ¡c Ä‘á»‹nh táº¡i RUNTIME                                   â”‚ â”‚
â”‚  â”‚  ğŸ“Œ undefined náº¿u khÃ´ng tÃ¬m tháº¥y                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tá»•ng Há»£p: Scope Rules

**BÃ i viáº¿t â€” 7 Quy Táº¯c Scope: "Hiáº¿n PhÃ¡p" Cá»§a JavaScript Variables**

Sau khi hiá»ƒu chi tiáº¿t tá»«ng khÃ­a cáº¡nh, hÃ£y Ä‘Ãºc káº¿t thÃ nh **7 quy táº¯c** cá»‘t lÃµi. ÄÃ¢y lÃ  bá»™ quy táº¯c mÃ  náº¿u báº¡n thuá»™c náº±m lÃ²ng, báº¡n cÃ³ thá»ƒ predict output cá»§a **báº¥t ká»³** Ä‘oáº¡n code scope-related trong interview hay production debugging.

NghÄ© vá» 7 quy táº¯c nÃ y nhÆ° "Hiáº¿n PhÃ¡p" â€” má»i behavior khÃ¡c (closures, hoisting, TDZ, module scope) Ä‘á»u lÃ  **há»‡ quáº£** derive tá»« 7 quy táº¯c nÃ y. Khi gáº·p code confusing, quay láº¡i Ä‘Ã¢y vÃ  apply tá»«ng quy táº¯c má»™t â€” báº¡n sáº½ luÃ´n ra Ä‘Ãºng Ä‘Ã¡p Ã¡n.

> **Interview insight**: Náº¿u interviewer Ä‘Æ°a Ä‘oáº¡n code phá»©c táº¡p vá»›i nested functions vÃ  há»i output, Ä‘á»«ng **Ä‘oÃ¡n**. HÃ£y **apply** 7 rules nÃ y step-by-step: (1) XÃ¡c Ä‘á»‹nh scope má»—i biáº¿n, (2) Trace scope chain tá»« vá»‹ trÃ­ access, (3) TÃ¬m biáº¿n matching Ä‘áº§u tiÃªn trÃªn chain. Systematic approach sáº½ impress interviewer hÆ¡n lÃ  tráº£ lá»i vá»™i.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE RULES SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Scope Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm function ÄÆ¯á»¢C Táº O         â”‚
â”‚     (Lexical Scope / Static Scope)                               â”‚
â”‚                                                                 â”‚
â”‚  2. Má»—i function call táº¡o má»™t Execution Context Má»šI             â”‚
â”‚     vá»›i private scope riÃªng                                     â”‚
â”‚                                                                 â”‚
â”‚  3. Biáº¿n Ä‘Æ°á»£c tÃ¬m tá»« current scope â†’ parent â†’ ... â†’ global     â”‚
â”‚     (Scope Chain)                                                â”‚
â”‚                                                                 â”‚
â”‚  4. Inner function CÃ“ THá»‚ truy cáº­p biáº¿n outer function          â”‚
â”‚     Outer function KHÃ”NG THá»‚ truy cáº­p biáº¿n inner function       â”‚
â”‚                                                                 â”‚
â”‚  5. var = function scope | let/const = block scope              â”‚
â”‚                                                                 â”‚
â”‚  6. Closure = scope chain Ä‘Æ°á»£c Báº¢O Tá»’N sau khi                  â”‚
â”‚     parent execution context Ä‘Ã£ bá»‹ pop khá»i call stack          â”‚
â”‚                                                                 â”‚
â”‚  7. Scope cÃ¡ch ly biáº¿n â†’ biáº¿n cÃ¹ng tÃªn á»Ÿ scope khÃ¡c nhau        â”‚
â”‚     KHÃ”NG xung Ä‘á»™t (variable isolation)                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ§  Deep Analysis Patterns â€” PhÃ¢n TÃ­ch Scope Theo 6 GÃ³c NhÃ¬n ChuyÃªn SÃ¢u

Pháº§n trÃªn Ä‘Ã£ giáº£i thÃ­ch Scope **lÃ  gÃ¬** vÃ  **hoáº¡t Ä‘á»™ng tháº¿ nÃ o**. Pháº§n dÆ°á»›i Ä‘Ã¢y sáº½ phÃ¢n tÃ­ch Scope tá»« **6 gÃ³c nhÃ¬n tÆ° duy khÃ¡c nhau** â€” giÃºp báº¡n khÃ´ng chá»‰ hiá»ƒu kiáº¿n thá»©c, mÃ  cÃ²n hiá»ƒu **táº¡i sao JavaScript scope Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° váº­y** vÃ  nÃ³ áº£nh hÆ°á»Ÿng Ä‘áº¿n má»i dÃ²ng code báº¡n viáº¿t.

---

#### Pattern 1: Äá»‡ Quy "Táº¡i Sao" (5 Whys) â€” Truy Váº¿t Scope Tá»« Hiá»‡n TÆ°á»£ng Äáº¿n Báº£n Cháº¥t

---

**WHY 1: Táº¡i sao JavaScript cáº§n Scope?**

VÃ¬ náº¿u **khÃ´ng cÃ³ scope**, má»i biáº¿n sáº½ lÃ  **global** â€” táº¥t cáº£ functions, libraries, scripts chia sáº» cÃ¹ng má»™t namespace. TÆ°á»Ÿng tÆ°á»£ng: báº¡n khai bÃ¡o `let count = 0` trong component A, thÆ° viá»‡n jQuery cÅ©ng dÃ¹ng `count` internally, thÆ° viá»‡n analytics cÅ©ng dÃ¹ng `count` â†’ **táº¥t cáº£ Ä‘Ã¨ lÃªn nhau**. App crash ngáº«u nhiÃªn, bugs khÃ´ng thá»ƒ reproduce, developers khÃ´ng dÃ¡m Ä‘áº·t tÃªn biáº¿n.

ÄÃ¢y khÃ´ng pháº£i hypothetical â€” Ä‘Ã¢y lÃ  **thá»±c táº¿** cá»§a JavaScript trÆ°á»›c ES6 modules. Khi má»i `<script>` tag chia sáº» global scope, tÃªn biáº¿n phá»• biáº¿n (`data`, `result`, `temp`, `i`) liÃªn tá»¥c conflict. ÄÃ¢y lÃ  lÃ½ do jQuery dÃ¹ng `$`, Lodash dÃ¹ng `_` â€” **single-character names** Ä‘á»ƒ giáº£m collision chance.

```javascript
// Tháº¿ giá»›i KHÃ”NG cÃ³ scope â€” má»i biáº¿n lÃ  global
// Script 1 (your code):
var count = 0;
function increment() {
  count++;
}

// Script 2 (analytics library â€” load sau):
var count = 1000; // â† ÄÃˆ Máº¤T count cá»§a báº¡n!
function track() {
  count++;
}

// Script 3 (ad script):
var count = -1; // â† ÄÃˆ TIáº¾P!

increment();
console.log(count); // -1?? 1001?? AI BIáº¾T???
// â†’ ÄÃ¢y lÃ  CHAOS thá»±c sá»± xáº£y ra trÆ°á»›c khi cÃ³ modules

// Scope giáº£i quyáº¿t:
function myApp() {
  let count = 0; // Chá»‰ tá»“n táº¡i trong myApp
  function increment() {
    count++;
  } // Chá»‰ truy cáº­p count cá»§a myApp
}
// analytics, ads KHÃ”NG THá»‚ cháº¡m vÃ o count â†’ SAFE
```

**WHY 2: Táº¡i sao scope Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm Táº O (lexical), khÃ´ng pháº£i táº¡i thá»i Ä‘iá»ƒm Gá»ŒI (dynamic)?**

ÄÃ¢y lÃ  quyáº¿t Ä‘á»‹nh design **quan trá»ng nháº¥t** trong scope system. JavaScript chá»n **Lexical Scope** (static scope) â€” scope cá»§a function Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi **nÆ¡i function Ä‘Æ°á»£c viáº¿t trong source code**, KHÃ”NG PHáº¢I nÆ¡i nÃ³ Ä‘Æ°á»£c gá»i.

Táº¡i sao? VÃ¬ **predictability**. Vá»›i lexical scope, developer nhÃ¬n vÃ o code lÃ  biáº¿t **chÃ­nh xÃ¡c** function sáº½ truy cáº­p biáº¿n nÃ o â€” khÃ´ng cáº§n cháº¡y program, khÃ´ng cáº§n biáº¿t ai sáº½ gá»i function. Vá»›i dynamic scope, cÃ¹ng má»™t function cÃ³ thá»ƒ truy cáº­p **biáº¿n khÃ¡c nhau** tÃ¹y thuá»™c vÃ o call context â†’ **impossible to reason about** code statically.

```javascript
// Lexical Scope â€” JavaScript's choice:
let x = "global";

function foo() {
  console.log(x); // LUÃ”N LÃ€ "global" â€” báº¥t ká»ƒ ai gá»i foo()
}

function bar() {
  let x = "bar-local";
  foo(); // Output: "global" â† foo nhÃ¬n lÃªn NÆ I NÃ“ ÄÆ¯á»¢C VIáº¾T, khÃ´ng pháº£i nÆ¡i gá»i
}

bar(); // "global"

// Náº¿u JavaScript dÃ¹ng Dynamic Scope (nhÆ° Bash, Perl4):
// foo() sáº½ print "bar-local" vÃ¬ tÃ¬m x trong CALL STACK
// â†’ CÃ¹ng foo() cho káº¿t quáº£ KHÃC NHAU tÃ¹y ai gá»i
// â†’ Code trá»Ÿ nÃªn UNPREDICTABLE
// â†’ ÄÃ¢y lÃ  lÃ½ do dynamic scope bá»‹ loáº¡i bá» trong háº§u háº¿t modern languages
```

**WHY 3: Táº¡i sao `var` chá»‰ cÃ³ function scope, nhÆ°ng `let`/`const` cÃ³ block scope?**

VÃ¬ `var` Ä‘Æ°á»£c thiáº¿t káº¿ nÄƒm **1995** khi Brendan Eich táº¡o JavaScript trong **10 ngÃ y**. LÃºc Ä‘Ã³, JavaScript copy scope model tá»« **Java** (function-scoped) nhÆ°ng Ä‘Æ¡n giáº£n hÃ³a quÃ¡ má»©c â€” `var` **khÃ´ng respect** block boundaries `{}` (chá»‰ respect function boundaries). Káº¿t quáº£: hÃ ng ngÃ n bugs trong 20 nÄƒm tiáº¿p theo.

Bug kinh Ä‘iá»ƒn nháº¥t: **closure in loop** â€” developers máº¥t hÃ ng triá»‡u giá» debug váº¥n Ä‘á» nÃ y trÆ°á»›c ES6:

```javascript
// Bug kinh Ä‘iá»ƒn trÆ°á»›c ES6 â€” var trong loop
for (var i = 0; i < 5; i++) {
  setTimeout(function () {
    console.log(i); // Mong Ä‘á»£i: 0, 1, 2, 3, 4
  }, 100);
}
// Output thá»±c táº¿: 5, 5, 5, 5, 5
// Táº¡i sao? var i lÃ  FUNCTION-scoped â†’ chá»‰ cÃ³ 1 biáº¿n i
// Sau loop, i = 5 â†’ táº¥t cáº£ closures trá» Ä‘áº¿n CÃ™NG i = 5

// ES6 fix â€” let cÃ³ block scope:
for (let i = 0; i < 5; i++) {
  setTimeout(function () {
    console.log(i); // âœ… 0, 1, 2, 3, 4
  }, 100);
}
// let i táº¡o BIáº¾N Má»šI má»—i iteration (block scope riÃªng)
// Má»—i closure capture báº£n copy riÃªng cá»§a i

// TrÆ°á»›c ES6, developers pháº£i viáº¿t "IIFE hack":
for (var i = 0; i < 5; i++) {
  (function (j) {
    // IIFE táº¡o function scope má»›i, j lÃ  copy cá»§a i
    setTimeout(function () {
      console.log(j); // âœ… 0, 1, 2, 3, 4
    }, 100);
  })(i);
}
```

**WHY 4: Táº¡i sao scope chain tÃ¬m kiáº¿m "tá»« trong ra ngoÃ i" mÃ  khÃ´ng pháº£i "tá»« ngoÃ i vÃ o trong"?**

VÃ¬ nguyÃªn táº¯c **encapsulation** â€” inner functions cáº§n **truy cáº­p context** cá»§a outer functions (Ä‘á»c configuration, reuse data), nhÆ°ng outer functions **khÃ´ng nÃªn biáº¿t** chi tiáº¿t implementation cá»§a inner functions. ÄÃ¢y lÃ  tÆ°Æ¡ng tá»± nguyÃªn táº¯c OOP: child class káº¿ thá»«a parent class, nhÆ°ng parent class khÃ´ng biáº¿t vá» child.

Náº¿u Ä‘áº£o ngÆ°á»£c (outer truy cáº­p inner) â†’ **variable lifetime** trá»Ÿ nÃªn impossible. Khi nÃ o inner function táº¡o biáº¿n? Khi nÃ o nÃ³ bá»‹ destroy? Outer function khÃ´ng biáº¿t â€” biáº¿n chÆ°a tá»“n táº¡i hoáº·c Ä‘Ã£ bá»‹ GC â†’ **dangling reference**. HÆ°á»›ng "trong ra ngoÃ i" Ä‘áº£m báº£o: **biáº¿n outer luÃ´n tá»“n táº¡i trÆ°á»›c khi inner Ä‘Æ°á»£c táº¡o** â†’ always safe to access.

```javascript
// Scope chain: TRONG â†’ NGOÃ€I (natural hierarchy)
function app() {
  const config = { theme: "dark" }; // Tá»“n táº¡i trÆ°á»›c inner

  function render() {
    // render BIáº¾T config tá»“n táº¡i â†’ safe to access
    console.log(config.theme); // âœ… "dark"

    const localState = { count: 0 };
    // localState lÃ  CHI TIáº¾T internal cá»§a render
  }

  // app KHÃ”NG BIáº¾T vÃ  KHÃ”NG Cáº¦N BIáº¾T localState
  // console.log(localState); // âŒ ReferenceError
  // â†’ Encapsulation Ä‘Ãºng! Chi tiáº¿t implementation bá»‹ hide

  render();
}
```

**WHY 5: Táº¡i sao JavaScript chá»n scope-based variable resolution thay vÃ¬ lookup table?**

ÄÃ¢y cháº¡m Ä‘áº¿n **compiler implementation** level. Scope chain resolution lÃ  **O(depth)** â€” má»—i variable lookup traverse tá»« current scope lÃªn parent, rá»“i grandparent... Táº¡i sao khÃ´ng dÃ¹ng **flat lookup table** (hash map) cho O(1)?

CÃ¢u tráº£ lá»i: vÃ¬ **memory efficiency** vÃ  **dynamic nature** of JavaScript. Flat lookup table cáº§n clone toÃ n bá»™ outer variables vÃ o má»—i function call â†’ **O(total variables)** memory per function. Scope chain trá» Ä‘áº¿n **shared** outer scope objects â†’ **O(1)** memory per function (chá»‰ cáº§n 1 pointer). Vá»›i JavaScript nÆ¡i functions **nested nhiá»u táº§ng** vÃ  closures phá»• biáº¿n, scope chain approach tiáº¿t kiá»‡m memory **Ä‘Ã¡ng ká»ƒ**.

ThÃªm vÃ o Ä‘Ã³, V8 optimize: variables Ä‘Æ°á»£c truy cáº­p thÆ°á»ng xuyÃªn sáº½ Ä‘Æ°á»£c **inline cached** â€” runtime complexity gáº§n O(1) cho hot paths. Scope chain chá»‰ thá»±c sá»± traverse khi biáº¿n á»Ÿ táº§ng sÃ¢u vÃ  chÆ°a Ä‘Æ°á»£c cache.

```
Scope Chain approach (JavaScript chá»n):
  Memory: O(1) per function (pointer Ä‘áº¿n parent scope)
  Lookup: O(depth) worst case, O(1) vá»›i inline cache
  Closures: FREE â€” chá»‰ cáº§n giá»¯ pointer, khÃ´ng clone

Flat lookup table approach (alternative):
  Memory: O(variables) per function (clone all outer vars)
  Lookup: O(1) always
  Closures: EXPENSIVE â€” pháº£i clone toÃ n bá»™ table

  â†’ Scope chain tháº¯ng vÃ¬ JavaScript = closure-heavy language
```

> **Interview insight â€” 5 Whys Summary**: Scope tá»“n táº¡i vÃ¬ **isolation** (WHY 1) â†’ Lexical vÃ¬ **predictability** (WHY 2) â†’ Block scope vÃ¬ **var bugs** sá»­a qua 20 nÄƒm (WHY 3) â†’ Trong-ra-ngoÃ i vÃ¬ **encapsulation** (WHY 4) â†’ Chain vÃ¬ **memory efficiency** cho closures (WHY 5). Má»—i decision dáº«n Ä‘áº¿n decision tiáº¿p theo.

---

#### Pattern 2: First Principles Thinking â€” Scope DÆ°á»›i GÃ³c NhÃ¬n Data Structures & Algorithms

---

**Data Structure â€” Scope Chain thá»±c cháº¥t lÃ  Linked List:**

Khi V8 compile JavaScript, má»—i function scope Ä‘Æ°á»£c represent bá»Ÿi má»™t **Context object** (hoáº·c **ScopeInfo** trong V8 internals). Scope chain lÃ  **singly linked list** cá»§a cÃ¡c Context objects:

```
Scope Chain = Linked List of Context Objects:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Context(inner)   â”‚â”€â”€â”€â”€â†’â”‚ Context(outer)   â”‚â”€â”€â”€â”€â†’â”‚ Context(G)   â”‚â”€â”€â†’ null
  â”‚                  â”‚     â”‚                  â”‚     â”‚              â”‚
  â”‚ local vars:      â”‚     â”‚ local vars:      â”‚     â”‚ global vars: â”‚
  â”‚   z = 30         â”‚     â”‚   y = 20         â”‚     â”‚   x = 10     â”‚
  â”‚   temp = "hi"    â”‚     â”‚   config = {...} â”‚     â”‚   Math, JSON â”‚
  â”‚                  â”‚     â”‚                  â”‚     â”‚   window     â”‚
  â”‚ [[outer]] â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ [[outer]] â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ [[outer]] â”€â”€â†’ null
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Algorithm â€” Variable Lookup = Linear Search on Linked List:**

Khi JavaScript engine cáº§n resolve biáº¿n `x`, nÃ³ traverse linked list:

```javascript
// Pseudocode cá»§a scope chain lookup:
function resolveVariable(name, currentScope) {
  let scope = currentScope;

  while (scope !== null) {
    if (scope.hasBinding(name)) {
      return scope.getBinding(name); // Found!
    }
    scope = scope.outer; // Traverse lÃªn parent
  }

  throw new ReferenceError(`${name} is not defined`);
}

// Complexity Analysis:
// Time:  O(d) where d = scope depth
// Space: O(1) â€” chá»‰ cáº§n 1 pointer
// Best case: O(1) â€” biáº¿n á»Ÿ current scope
// Worst case: O(d) â€” biáº¿n á»Ÿ global scope (top of chain)
```

| Operation              | Time Complexity | Giáº£i thÃ­ch                          |
| ---------------------- | --------------- | ----------------------------------- |
| Local variable access  | O(1)            | TÃ¬m ngay trong current Context      |
| Parent variable access | O(2)            | Traverse 1 link                     |
| Global variable access | O(d)            | d = depth, traverse toÃ n bá»™ chain   |
| Undeclared variable    | O(d) + throw    | Traverse háº¿t chain â†’ ReferenceError |

**V8 Optimization â€” Inline Caching biáº¿n Scope Chain thÃ nh O(1):**

V8 **khÃ´ng** traverse chain má»—i láº§n access biáº¿n. NÃ³ dÃ¹ng **Context Slot Indexing** â€” táº¡i compile time, V8 biáº¿t má»—i biáº¿n á»Ÿ **scope nÃ o** (depth) vÃ  **slot nÃ o** (offset). Variable access trá»Ÿ thÃ nh:

```javascript
// Source code:
function outer() {
  let x = 10;
  function inner() {
    console.log(x); // x á»Ÿ depth 1, slot 0
  }
}

// V8 compiled bytecode (simplified):
// LdaContextSlot [1], [0]        â† depth = 1, slot = 0
// CallRuntime [console.log]

// â†’ O(1) access! KhÃ´ng cáº§n traverse chain
// V8 biáº¿t táº¡i compile time: "x á»Ÿ parent scope, slot 0"
// â†’ Single memory access: context.outer.slots[0]
```

**Hardware Level â€” Scope vÃ  CPU Cache:**

Variables trong **current scope** Ä‘Æ°á»£c access thÆ°á»ng xuyÃªn â†’ náº±m trong **L1/L2 cache** â†’ ~1-4ns. Variables á»Ÿ outer scope Ã­t access hÆ¡n â†’ cÃ³ thá»ƒ bá»‹ evict khá»i cache â†’ pháº£i láº¥y tá»« **RAM** â†’ ~100ns. ÄÃ¢y lÃ  lÃ½ do **minimize scope depth** cáº£i thiá»‡n performance:

```javascript
// âŒ Deep scope â€” outer variables may miss cache
function level1() {
  const config = loadConfig();
  function level2() {
    function level3() {
      function level4() {
        function level5() {
          // Access config: traverse 4 levels
          // config cÃ³ thá»ƒ khÃ´ng cÃ²n trong L1 cache
          return config.apiUrl; // ~100ns náº¿u cache miss
        }
      }
    }
  }
}

// âœ… Shallow scope â€” local copy for hot path
function process() {
  const config = loadConfig();
  const apiUrl = config.apiUrl; // Copy vÃ o local scope

  function makeRequest() {
    return fetch(apiUrl); // Access local â†’ L1 cache â†’ ~1ns
  }
}
```

> **Interview insight**: Khi Ä‘Æ°á»£c há»i "Scope chain implement tháº¿ nÃ o?", nÃ³i: "Scope chain lÃ  **linked list** of Context objects. Lookup lÃ  **O(depth)** worst case. NhÆ°ng V8 optimize báº±ng **Context Slot Indexing** â€” táº¡i compile time, biáº¿t exact depth vÃ  offset â†’ O(1) memory access. Close-over variables Ä‘Æ°á»£c store trong Context objects trÃªn **heap** (khÃ´ng pháº£i stack) Ä‘á»ƒ survive function return."

---

#### Pattern 3: Trade-off Analysis â€” Má»—i Scope Decision LÃ  Má»™t ÄÃ¡nh Äá»•i

---

**Trade-off 1: Lexical Scope vs. Dynamic Scope**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LEXICAL vs DYNAMIC SCOPE â€” THE FUNDAMENTAL TRADE-OFF            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Lexical Scope (JavaScript, Python, Java, C):                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… Predictable: Äá»c code = biáº¿t káº¿t quáº£                   â”‚   â”‚
â”‚  â”‚ âœ… Static analysis: Linters, IDEs hiá»ƒu scope â†’ autocomp  â”‚   â”‚
â”‚  â”‚ âœ… Optimizable: Compiler biáº¿t scope â†’ optimize variable   â”‚   â”‚
â”‚  â”‚    access táº¡i compile time                                â”‚   â”‚
â”‚  â”‚ âœ… Closures work naturally                                 â”‚   â”‚
â”‚  â”‚ âŒ Less flexible: KhÃ´ng thá»ƒ thay Ä‘á»•i behavior táº¡i runtimeâ”‚   â”‚
â”‚  â”‚ âŒ Boilerplate: Pháº£i pass data explicitly qua parameters  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Dynamic Scope (Bash, Emacs Lisp, Perl4):                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âœ… Flexible: Function behavior thay Ä‘á»•i theo call context â”‚   â”‚
â”‚  â”‚ âœ… Less parameter passing: Inner auto-sees caller's vars  â”‚   â”‚
â”‚  â”‚ âŒ Unpredictable: CÃ¹ng code, khÃ¡c caller = khÃ¡c káº¿t quáº£  â”‚   â”‚
â”‚  â”‚ âŒ No static analysis: IDE/linter khÃ´ng thá»ƒ help          â”‚   â”‚
â”‚  â”‚ âŒ Hard to optimize: Compiler khÃ´ng biáº¿t scope at compile â”‚   â”‚
â”‚  â”‚ âŒ Closures broken: Captured vars change unpredictably    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ JavaScript chá»n Lexical vÃ¬ web = nhiá»u developers, nhiá»u    â”‚
â”‚     scripts. Predictability > Flexibility trong context Ä‘Ã³.     â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ NhÆ°ng JavaScript CÃ“ dynamic scope qua `this`:               â”‚
â”‚     this.method() â†’ this phá»¥ thuá»™c vÃ o CALLER, khÃ´ng pháº£i       â”‚
â”‚     nÆ¡i method Ä‘Æ°á»£c viáº¿t â†’ source of endless confusion!         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Trade-off 2: Block Scope (let/const) vs. Function Scope (var)**

| Aspect              | `var` (Function Scope)                     | `let`/`const` (Block Scope)                                |
| ------------------- | ------------------------------------------ | ---------------------------------------------------------- |
| **Hoisting**        | Hoisted + initialized `undefined`          | Hoisted nhÆ°ng **TDZ** (Temporal Dead Zone)                 |
| **Granularity**     | Coarse â€” chá»‰ function boundaries           | Fine â€” má»i `{}` block                                      |
| **Memory**          | Biáº¿n sá»‘ng **toÃ n bá»™** function execution   | Biáº¿n sá»‘ng **chá»‰ trong** block â†’ GC sá»›m hÆ¡n                 |
| **Re-declaration**  | Cho phÃ©p `var x; var x;` â†’ silent override | **Error** `let x; let x;` â†’ enforce uniqueness             |
| **Loop behavior**   | 1 biáº¿n shared across iterations            | **Biáº¿n má»›i** má»—i iteration (critical for closures)         |
| **Global behavior** | `var x` á»Ÿ top-level â†’ `window.x`           | `let x` á»Ÿ top-level â†’ **KHÃ”NG** thÃªm vÃ o window            |
| **Khi nÃ o dÃ¹ng**    | **KHÃ”NG BAO GIá»œ** (legacy only)            | **LUÃ”N LUÃ”N** dÃ¹ng `const` default, `let` khi cáº§n reassign |

```javascript
// Temporal Dead Zone â€” trade-off cá»§a block scope
console.log(a); // undefined â€” var hoisted + initialized
console.log(b); // âŒ ReferenceError â€” let hoisted nhÆ°ng TDZ!

var a = 1;
let b = 2;

// TDZ = biáº¿n EXISTS (hoisted) nhÆ°ng CANNOT BE ACCESSED
// cho Ä‘áº¿n declaration line
// â†’ Trade-off: stricter (catch bugs) nhÆ°ng less forgiving

// Memory trade-off:
function process() {
  // Block scope â†’ bá»™ nhá»› freed sá»›m
  {
    const largeData = fetchHugeDataset(); // 100MB
    transform(largeData);
  } // â† largeData eligible for GC Táº I ÄÃ‚Y âœ…

  // ... tiáº¿p tá»¥c xá»­ lÃ½ khÃ¡c â€” largeData Ä‘Ã£ freed
  doMoreWork(); // 100MB Ä‘Ã£ Ä‘Æ°á»£c giáº£i phÃ³ng

  // Vá»›i var: largeData sá»‘ng cáº£ function â†’ 100MB bá»‹ giá»¯ Ä‘áº¿n return
}
```

**Trade-off 3: Ká»‹ch báº£n Scope tháº¥t báº¡i â€” Khi nÃ o scope gÃ¢y váº¥n Ä‘á»?**

1. **Closure memory leak**: Scope chain giá»¯ outer variables alive â†’ náº¿u closure sá»‘ng lÃ¢u (event listener, timer), outer variables **KHÃ”NG BAO GIá»œ** Ä‘Æ°á»£c GC.

2. **Variable shadowing confusion**: Inner scope redefines biáº¿n cÃ¹ng tÃªn vá»›i outer â†’ developer nháº§m láº«n Ä‘ang access biáº¿n nÃ o.

3. **Module scope pollution**: TrÆ°á»›c ES modules, scripts share global scope â†’ namespace collisions â†’ pattern IIFE ra Ä‘á»i (Immediately Invoked Function Expression).

```javascript
// Shadowing â€” scope che khuáº¥t biáº¿n
const name = "global";

function greet() {
  const name = "local"; // SHADOWS global name
  console.log(name); // "local" â€” cÃ³ thá»ƒ gÃ¢y nháº§m láº«n!

  function inner() {
    // Developer nghÄ© access global name
    console.log(name); // "local" â€” SHADOWED!
  }
}

// âš ï¸ ESLint rule "no-shadow" detect váº¥n Ä‘á» nÃ y
// âœ… Best practice: Ä‘áº·t tÃªn khÃ¡c nhau cho biáº¿n á»Ÿ scope khÃ¡c nhau
```

---

#### Pattern 4: Mental Mapping â€” Scope Trong Báº£n Äá»“ Kiáº¿n TrÃºc Tá»•ng Thá»ƒ

---

**Scope trong lifecycle cá»§a code execution:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE TRONG JAVASCRIPT ENGINE PIPELINE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Source Code                                                     â”‚
â”‚  â†“                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 1: PARSING (Compile Time)                           â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. Lexer: Tokenize source code                           â”‚   â”‚
â”‚  â”‚ 2. Parser: Build AST (Abstract Syntax Tree)              â”‚   â”‚
â”‚  â”‚ 3. â˜… SCOPE ANALYSIS: XÃ¡c Ä‘á»‹nh scope cho Má»ŒI variable    â”‚   â”‚
â”‚  â”‚    â†’ Táº¡o ScopeInfo objects                                â”‚   â”‚
â”‚  â”‚    â†’ Determine: local vs closure vs global                â”‚   â”‚
â”‚  â”‚    â†’ Assign Context Slots (depth, offset)                 â”‚   â”‚
â”‚  â”‚ 4. Bytecode generation (Ignition)                        â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ ğŸ’¡ Scope HOÃ€N TOÃ€N xÃ¡c Ä‘á»‹nh á»Ÿ phase nÃ y!                 â”‚   â”‚
â”‚  â”‚    Runtime KHÃ”NG thay Ä‘á»•i scope (trá»« eval/with)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PHASE 2: EXECUTION (Runtime)                              â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ 1. Táº¡o Execution Context â†’ push Call Stack                â”‚   â”‚
â”‚  â”‚ 2. Táº¡o Context object (náº¿u cÃ³ closures/nested functions) â”‚   â”‚
â”‚  â”‚ 3. Initialize variables (hoisting):                       â”‚   â”‚
â”‚  â”‚    â†’ var: undefined                                       â”‚   â”‚
â”‚  â”‚    â†’ let/const: TDZ (uninitialized)                       â”‚   â”‚
â”‚  â”‚    â†’ function: hoisted entirely                           â”‚   â”‚
â”‚  â”‚ 4. Execute code line by line                              â”‚   â”‚
â”‚  â”‚ 5. Variable lookup: Context Slot â†’ parent Context â†’ ...  â”‚   â”‚
â”‚  â”‚ 6. Pop Execution Context khi function return              â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚ ğŸ’¡ Context object persists náº¿u closure tá»“n táº¡i            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Scope káº¿t ná»‘i vá»›i má»i khÃ¡i niá»‡m JS khÃ¡c:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SCOPE CONNECTION MAP â€” Scope LÃ  Trung TÃ¢m Cá»§a Má»i Thá»©          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”‚   Hoisting   â”‚â”€â”€â”€â”€â”                               â”‚
â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                â”‚
â”‚         â”‚ var hoisted to         â”‚ let/const create               â”‚
â”‚         â”‚ function scope         â”‚ TDZ in block scope             â”‚
â”‚         â†“                        â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚  var/let/   â”‚          â”‚ Temporal     â”‚                       â”‚
â”‚  â”‚  const      â”‚          â”‚ Dead Zone    â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚ Variable declaration                                   â”‚
â”‚         â”‚ determines scope type                                  â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    defines    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   SCOPE     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Scope Chain  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                             â”‚                          â”‚
â”‚         â”‚ Scope preserves             â”‚ Chain enables            â”‚
â”‚         â”‚ variables alive             â”‚ variable lookup          â”‚
â”‚         â†“                             â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Closures   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Execution    â”‚                  â”‚
â”‚  â”‚             â”‚  EC creates    â”‚ Context      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  scope chain  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                             â”‚                          â”‚
â”‚         â”‚ Closures hold               â”‚ EC pushed to             â”‚
â”‚         â”‚ scope references            â”‚ Call Stack               â”‚
â”‚         â†“                             â†“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Memory /    â”‚              â”‚ Call Stack   â”‚                   â”‚
â”‚  â”‚ GC Impact   â”‚              â”‚              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Scope = trung tÃ¢m káº¿t ná»‘i: hoisting, closures, GC,          â”‚
â”‚     execution context, call stack. Hiá»ƒu scope sÃ¢u = hiá»ƒu        â”‚
â”‚     TOÃ€N Bá»˜ JavaScript execution model.                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Interview insight**: Náº¿u interviewer há»i "Scope liÃªn quan gÃ¬ Ä‘áº¿n closures vÃ  GC?", váº½ triangle: **Scope** defines variable lifetime â†’ **Closures** extend scope lifetime beyond function return â†’ scope **prevents GC** from collecting closed-over variables â†’ **Memory leaks**. Ba concepts nÃ y **inseparable**.

---

#### Pattern 5: Reverse Engineering â€” Tá»± Tay Code Má»™t Mini Scope Engine

> _"What I cannot create, I do not understand."_ â€” Richard Feynman

---

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MINI SCOPE ENGINE â€” Tá»± implement Ä‘á»ƒ hiá»ƒu sÃ¢u
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€ Pháº§n 1: Scope Object â”€â”€
class Scope {
  constructor(name, parent = null) {
    this.name = name; // "global", "function:foo", "block:if"
    this.parent = parent; // Parent scope (linked list)
    this.bindings = new Map(); // Variable name â†’ value
    this.type = parent ? "local" : "global";
  }

  // Declare variable trong current scope
  declare(name, kind = "let") {
    if (kind === "let" || kind === "const") {
      // Block-scoped: khÃ´ng cho redeclare trong cÃ¹ng scope
      if (this.bindings.has(name)) {
        throw new SyntaxError(
          `Identifier '${name}' has already been declared in ${this.name}`,
        );
      }
    }
    // var cho phÃ©p redeclare (silent)
    this.bindings.set(name, { value: undefined, kind });
    console.log(`  [${this.name}] Declared: ${kind} ${name}`);
  }

  // Assign value â€” tÃ¬m biáº¿n trong scope chain
  assign(name, value) {
    const scope = this._resolve(name);
    if (!scope) {
      throw new ReferenceError(`${name} is not defined`);
    }

    const binding = scope.bindings.get(name);
    if (binding.kind === "const" && binding.value !== undefined) {
      throw new TypeError("Assignment to constant variable");
    }

    binding.value = value;
    console.log(
      `  [${scope.name}] Assigned: ${name} = ${JSON.stringify(value)}`,
    );
  }

  // Lookup variable â€” SCOPE CHAIN TRAVERSAL (core algorithm!)
  lookup(name) {
    const scope = this._resolve(name);
    if (!scope) {
      throw new ReferenceError(`${name} is not defined`);
    }

    const value = scope.bindings.get(name).value;
    console.log(
      `  [Lookup] ${name} â†’ found in [${scope.name}] = ${JSON.stringify(value)}`,
    );
    return value;
  }

  // â˜… Core: Traverse scope chain (linked list walk)
  _resolve(name) {
    let current = this;
    const path = [];

    while (current !== null) {
      path.push(current.name);
      if (current.bindings.has(name)) {
        console.log(`    Chain: ${path.join(" â†’ ")} âœ…`);
        return current;
      }
      current = current.parent; // â† Linked list traversal!
    }

    console.log(`    Chain: ${path.join(" â†’ ")} â†’ âŒ not found`);
    return null;
  }

  // Create child scope
  createChild(name) {
    return new Scope(name, this);
  }

  // Debug: print scope chain
  printChain() {
    let current = this;
    const chain = [];
    while (current) {
      const vars = [...current.bindings.entries()]
        .map(([k, v]) => `${v.kind} ${k}=${JSON.stringify(v.value)}`)
        .join(", ");
      chain.push(`[${current.name}: ${vars || "(empty)"}]`);
      current = current.parent;
    }
    console.log(`  Scope Chain: ${chain.join(" â†’ ")}`);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO: Simulate JavaScript scope behavior
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("====== DEMO 1: Scope Chain Lookup ======");
const globalScope = new Scope("global");
globalScope.declare("x", "var");
globalScope.assign("x", 10);

const outerScope = globalScope.createChild("function:outer");
outerScope.declare("y", "let");
outerScope.assign("y", 20);

const innerScope = outerScope.createChild("function:inner");
innerScope.declare("z", "const");
innerScope.assign("z", 30);

console.log("\nLookup from innerScope:");
innerScope.lookup("z"); // Found in inner (depth 0)
innerScope.lookup("y"); // Found in outer (depth 1)
innerScope.lookup("x"); // Found in global (depth 2)

console.log("\nScope chain visualization:");
innerScope.printChain();
// [function:inner: const z=30] â†’ [function:outer: let y=20] â†’ [global: var x=10]

console.log("\n====== DEMO 2: Variable Shadowing ======");
const shadowOuter = globalScope.createChild("function:shadowOuter");
shadowOuter.declare("name", "let");
shadowOuter.assign("name", "outer-value");

const shadowInner = shadowOuter.createChild("function:shadowInner");
shadowInner.declare("name", "let"); // Shadow outer's name!
shadowInner.assign("name", "inner-value");

shadowInner.lookup("name"); // "inner-value" â† shadows outer!
shadowOuter.lookup("name"); // "outer-value" â† unaffected

console.log("\n====== DEMO 3: Block Scope vs Function Scope ======");
const fnScope = globalScope.createChild("function:example");
fnScope.declare("varVariable", "var"); // Function-scoped
fnScope.assign("varVariable", "I live in function");

const blockScope = fnScope.createChild("block:if");
blockScope.declare("letVariable", "let"); // Block-scoped
blockScope.assign("letVariable", "I live in block");

// var accessible from block (function-scoped)
blockScope.lookup("varVariable"); // âœ… Found in function:example

// let NOT accessible from function (block-scoped)
try {
  fnScope.lookup("letVariable"); // âŒ ReferenceError!
} catch (e) {
  console.log(`  âŒ ${e.message}`);
}

console.log("\n====== DEMO 4: Const reassignment ======");
const constScope = globalScope.createChild("function:constTest");
constScope.declare("API_URL", "const");
constScope.assign("API_URL", "https://api.example.com");
try {
  constScope.assign("API_URL", "https://new-url.com"); // âŒ TypeError!
} catch (e) {
  console.log(`  âŒ ${e.message}`);
}
```

**BÃ i táº­p má»Ÿ rá»™ng** (cho báº¡n tá»± thá»±c hÃ nh):

1. **Implement hoisting**: Khi táº¡o function scope, tá»± Ä‘á»™ng hoist táº¥t cáº£ `var` declarations lÃªn Ä‘áº§u scope (assign `undefined`). `let`/`const` táº¡o Temporal Dead Zone.
2. **Implement closures**: Khi function return inner function, giá»¯ reference Ä‘áº¿n parent scope (prevent garbage collection).
3. **Implement `eval()` scope**: `eval()` cÃ³ thá»ƒ inject variables vÃ o current scope â€” implement dynamic scope injection.
4. **Implement `with` statement**: `with(obj)` táº¡m thÃªm object's properties vÃ o scope chain Ä‘áº§u â€” implement scope augmentation.

---

#### Pattern 6: Lá»‹ch Sá»­ & Sá»± Tiáº¿n HÃ³a â€” Scope Tá»« 1960 Äáº¿n ES2024

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TIMELINE â€” Sá»° TIáº¾N HÃ“A Cá»¦A SCOPE TRONG PROGRAMMING            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1960  ALGOL 60: PhÃ¡t minh Lexical Scope                        â”‚
â”‚   â”‚    â””â”€ Block scope Ä‘áº§u tiÃªn: begin...end blocks               â”‚
â”‚   â”‚    â””â”€ Nested functions: inner truy cáº­p outer variables      â”‚
â”‚   â”‚    â””â”€ Lexical = "determined by TEXT, not execution"         â”‚
â”‚   â”‚    â””â”€ Influenceed: Pascal, C, vÃ  má»i language sau nÃ y       â”‚
â”‚   â”‚                                                             â”‚
â”‚  1964  Lisp 1.5: Dynamic Scope by default                       â”‚
â”‚   â”‚    â””â”€ Variables resolved theo CALL STACK, khÃ´ng theo TEXT    â”‚
â”‚   â”‚    â””â”€ Flexible nhÆ°ng UNPREDICTABLE                          â”‚
â”‚   â”‚    â””â”€ Scheme (1975) sá»­a láº¡i â†’ Lexical Scope cho Lisp       â”‚
â”‚   â”‚                                                             â”‚
â”‚  1972  C: Function Scope + File Scope                           â”‚
â”‚   â”‚    â””â”€ Variables scoped to function body                     â”‚
â”‚   â”‚    â””â”€ static = file scope (internal linkage)                â”‚
â”‚   â”‚    â””â”€ KHÃ”NG cÃ³ block scope cho variables (chá»‰ cÃ³ sau C99)   â”‚
â”‚   â”‚                                                             â”‚
â”‚  1989  Bash: Dynamic Scope (váº«n dÃ¹ng Ä‘áº¿n nay!)                  â”‚
â”‚   â”‚    â””â”€ function variables visible to callees                 â”‚
â”‚   â”‚    â””â”€ local keyword Ä‘á»ƒ opt-in function scope                â”‚
â”‚   â”‚    â””â”€ Source of many scripting bugs                         â”‚
â”‚   â”‚                                                             â”‚
â”‚  1995  JavaScript: Function Scope + Global Scope                â”‚
â”‚   â”‚    â””â”€ Brendan Eich copy C's function scope model            â”‚
â”‚   â”‚    â””â”€ var = function-scoped (NO block scope)                â”‚
â”‚   â”‚    â””â”€ Hoisting = var declarations moved to top              â”‚
â”‚   â”‚    â””â”€ Global variables = properties of window               â”‚
â”‚   â”‚    â””â”€ ğŸ’¥ 20 nÄƒm bugs do thiáº¿u block scope                   â”‚
â”‚   â”‚                                                             â”‚
â”‚  2009  Node.js: Module Scope (CommonJS)                         â”‚
â”‚   â”‚    â””â”€ Má»—i file = 1 module scope (wrapper function)          â”‚
â”‚   â”‚    â””â”€ require() = access exports of other modules           â”‚
â”‚   â”‚    â””â”€ Giáº£i quyáº¿t global pollution trÃªn server               â”‚
â”‚   â”‚                                                             â”‚
â”‚  2011  ES5 "use strict"                                         â”‚
â”‚   â”‚    â””â”€ Cáº¥m implicit global (assignment to undeclared var)    â”‚
â”‚   â”‚    â””â”€ KhÃ´ng sá»­a scope model, chá»‰ thÃªm safety net           â”‚
â”‚   â”‚                                                             â”‚
â”‚  2015  ES6 (ES2015): Block Scope REVOLUTION ğŸ‰                  â”‚
â”‚   â”‚    â””â”€ let/const = block-scoped declarations                 â”‚
â”‚   â”‚    â””â”€ Temporal Dead Zone (TDZ) = stricter hoisting          â”‚
â”‚   â”‚    â””â”€ for (let i = ...) = NEW variable per iteration        â”‚
â”‚   â”‚    â””â”€ Arrow functions = lexical this (scope-based)          â”‚
â”‚   â”‚    â””â”€ ES Modules = static module scope (import/export)      â”‚
â”‚   â”‚    â””â”€ ğŸ’¡ 20 nÄƒm bugs cá»§a var CHÃNH THá»¨C Ä‘Æ°á»£c sá»­a            â”‚
â”‚   â”‚                                                             â”‚
â”‚  2020  Top-level await (ES2022)                                 â”‚
â”‚   â”‚    â””â”€ Module scope má»Ÿ rá»™ng: await á»Ÿ top level               â”‚
â”‚   â”‚                                                             â”‚
â”‚  2024+ TC39 Proposals                                           â”‚
â”‚        â””â”€ using/Symbol.dispose: Resource-scoped cleanup         â”‚
â”‚        â””â”€ Pattern matching: New destructuring scope rules       â”‚
â”‚        â””â”€ Records & Tuples: Immutable primitives (scope impact) â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**TrÆ°á»›c Block Scope (ES5 era) â€” Developers sá»‘ng tháº¿ nÃ o?**

TrÆ°á»›c ES6, JavaScript developers pháº£i dÃ¹ng **hacks** Ä‘á»ƒ simulate block scope. IIFE (Immediately Invoked Function Expression) lÃ  pattern **phá»• biáº¿n nháº¥t** â€” táº¡o function scope táº¡m Ä‘á»ƒ cÃ¡ch ly biáº¿n:

```javascript
// Pre-ES6: IIFE â€” "nghÃ¨o" nÃªn pháº£i tá»± táº¡o scope
// jQuery, Lodash, Angular 1.x Ä‘á»u dÃ¹ng pattern nÃ y

// Module Pattern â€” IIFE táº¡o private scope
var MyModule = (function () {
  // Táº¥t cáº£ biáº¿n á»Ÿ Ä‘Ã¢y = PRIVATE (function scope)
  var privateCount = 0;
  var privateConfig = { maxRetries: 3 };

  function privateHelper() {
    return privateCount++;
  }

  // Chá»‰ return public API
  return {
    increment: function () {
      return privateHelper();
    },
    getCount: function () {
      return privateCount;
    },
  };
})();
// privateCount, privateConfig, privateHelper KHÃ”NG accessible tá»« ngoÃ i
// MyModule.increment() â€” public API
// MyModule.privateCount â€” undefined (truly private!)

// ES6+ equivalent â€” clean hÆ¡n ráº¥t nhiá»u:
// privacy.js
let privateCount = 0; // Module scope = private
const privateConfig = { maxRetries: 3 }; // Module scope = private

function privateHelper() {
  return privateCount++;
}

export function increment() {
  return privateHelper();
}
export function getCount() {
  return privateCount;
}
// No IIFE needed! Module scope = natural encapsulation
```

**Táº¡i sao Arrow Functions ra Ä‘á»i? â€” Scope problem vá»›i `this`:**

Arrow functions (ES6) ra Ä‘á»i Ä‘á»ƒ giáº£i quyáº¿t **scope/this mismatch** â€” váº¥n Ä‘á» #1 confusing cho JavaScript developers:

```javascript
// Pre-ES6: `this` KHÃ”NG follow lexical scope
function Timer() {
  this.seconds = 0;

  setInterval(function () {
    this.seconds++; // âŒ BUG! `this` á»Ÿ Ä‘Ã¢y = window/undefined
    // VÃ¬ function() {} cÃ³ `this` riÃªng (dynamic binding)
    // KHÃ”NG inherit tá»« outer scope
  }, 1000);
}

// Pre-ES6 hacks:
function Timer() {
  this.seconds = 0;
  var self = this; // Hack 1: save this vÃ o var

  setInterval(function () {
    self.seconds++; // âœ… self = lexical variable, follows scope chain
  }, 1000);
}

// Hoáº·c:
function Timer() {
  this.seconds = 0;

  setInterval(
    function () {
      this.seconds++; // âœ… bind() fix this
    }.bind(this),
    1000,
  ); // Hack 2: explicit bind
}

// ES6: Arrow function â€” this follows LEXICAL SCOPE
function Timer() {
  this.seconds = 0;

  setInterval(() => {
    this.seconds++; // âœ… Arrow function KHÃ”NG cÃ³ this riÃªng
    // this = lexical this = Timer instance
    // â†’ Scope rules apply consistently!
  }, 1000);
}
// Arrow function = "scope-consistent function"
// ÄÃ¢y lÃ  lÃ½ do React hooks dÃ¹ng arrow functions exclusively
```

**VÃ¬ sao `eval()` vÃ  `with` bá»‹ "deprecated"?**

`eval()` vÃ  `with` lÃ  hai features **phÃ¡ vá»¡** lexical scope â€” chÃºng inject variables vÃ o scope **táº¡i runtime**, khiáº¿n static analysis impossible:

```javascript
// eval() â€” inject variable vÃ o current scope
function dangerous() {
  eval("var x = 42"); // Táº¡o var x táº¡i RUNTIME
  console.log(x); // 42 â€” biáº¿n Ä‘Æ°á»£c inject vÃ o function scope!
  // V8 KHÃ”NG THá»‚ optimize function nÃ y
  // vÃ¬ khÃ´ng biáº¿t eval sáº½ táº¡o biáº¿n gÃ¬ táº¡i compile time
}

// with â€” táº¡m thá»i thÃªm object properties vÃ o scope chain
var obj = { a: 1, b: 2 };
with (obj) {
  console.log(a); // 1 â€” tÃ¬m a trong obj â†’ found!
  console.log(b); // 2 â€” tÃ¬m b trong obj â†’ found!
  // NhÆ°ng: scope chain bá»‹ biáº¿n Ä‘á»•i RUNTIME
  // V8 KHÃ”NG THá»‚ optimize variable lookups
}

// Strict mode Cáº¤M cáº£ hai:
("use strict");
eval("var x = 42"); // x KHÃ”NG leak vÃ o current scope
// with (obj) { ... }  // âŒ SyntaxError!

// â†’ Lesson: Predictable scope = optimizable code
// eval/with phÃ¡ vá»¡ predictability â†’ killed performance
// â†’ ÄÃ¢y lÃ  driver chÃ­nh cho "use strict" ra Ä‘á»i
```

> **Interview insight â€” Historical Perspective**: Náº¿u interviewer há»i "Táº¡i sao JavaScript cÃ³ cáº£ var, let, vÃ  const?", ká»ƒ cÃ¢u chuyá»‡n: JS (1995) chá»‰ cÃ³ `var` (function scope, copy tá»« C). **20 nÄƒm bugs** â€” closure-in-loop, implicit globals, hoisting confusion. ES6 (2015) thÃªm `let`/`const` vá»›i **block scope** vÃ  **TDZ** Ä‘á»ƒ sá»­a nhá»¯ng bug nÃ y. `var` váº«n tá»“n táº¡i cho **backward compatibility** â€” khÃ´ng thá»ƒ xÃ³a vÃ¬ sáº½ break billions of websites. **ÄÃ¢y lÃ  lesson vá» technical debt á»Ÿ quy mÃ´ toÃ n cáº§u.**

---

## 11. Closures (Bao ÄÃ³ng) â€” Báº£o Vá»‡ & LÆ°u Giá»¯

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” Closures: CÆ¡ Cháº¿ "SiÃªu NÄƒng Lá»±c" Khiáº¿n JavaScript Trá»Ÿ NÃªn Máº¡nh Máº½**

Náº¿u scope lÃ  "luáº­t chÆ¡i" cá»§a biáº¿n, thÃ¬ **closures** lÃ  "lá»— há»•ng" â€” hay Ä‘Ãºng hÆ¡n lÃ  **tÃ­nh nÄƒng cÃ³ chá»§ Ä‘Ã­ch** â€” cho phÃ©p functions **phÃ¡ vá»¡** quy táº¯c bÃ¬nh thÆ°á»ng vá» vÃ²ng Ä‘á»i biáº¿n. ThÃ´ng thÆ°á»ng, biáº¿n local cháº¿t khi function return. Closures giá»¯ biáº¿n **sá»‘ng mÃ£i** â€” miá»…n lÃ  cÃ³ function nÃ o Ä‘Ã³ cÃ²n "nhá»›" Ä‘áº¿n chÃºng.

Closures khÃ´ng pháº£i "advanced feature" â€” nÃ³ lÃ  **fundamental mechanism** mÃ  báº¡n sá»­ dá»¥ng **má»—i ngÃ y** mÃ  cÃ³ thá»ƒ khÃ´ng nháº­n ra:

- Viáº¿t `addEventListener` callback? â†’ **Closure**
- DÃ¹ng `useState` trong React? â†’ **Closure** bÃªn dÆ°á»›i
- Viáº¿t `debounce` function? â†’ **Closure** giá»¯ `timerId`
- Import module? â†’ **Closure** báº£o vá»‡ private state
- DÃ¹ng `.then()` callback? â†’ **Closure** nhá»› context

MDN Ä‘á»‹nh nghÄ©a: _"A closure is the combination of a function bundled together with references to its surrounding state (the lexical environment)."_ NhÆ°ng Ä‘á»‹nh nghÄ©a nÃ y quÃ¡ ngáº¯n gá»n. Äá»ƒ thá»±c sá»± hiá»ƒu, cáº§n phÃ¢n tÃ­ch closure tá»« **3 gÃ³c nhÃ¬n**:

1. **Closure as Memory** â€” Function "nhá»›" environment nÆ¡i nÃ³ sinh ra, dÃ¹ environment Ä‘Ã³ Ä‘Ã£ "cháº¿t" tá»« gÃ³c nhÃ¬n call stack
2. **Closure as Privacy** â€” CÆ¡ cháº¿ táº¡o private variables trong ngÃ´n ngá»¯ mÃ  má»i thá»© máº·c Ä‘á»‹nh lÃ  public
3. **Closure as Power** â€” Ná»n táº£ng cho functional programming patterns: currying, memoization, factory functions

HÃ£y Ä‘i sÃ¢u vÃ o tá»«ng khÃ­a cáº¡nh.

### KhÃ¡i Niá»‡m Closure

**BÃ i viáº¿t â€” Closure LÃ  GÃ¬? KhÃ´ng Chá»‰ LÃ  "Function Trong Function"**

Sai láº§m phá»• biáº¿n nháº¥t: "closure lÃ  function Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a bÃªn trong function khÃ¡c." Äiá»u nÃ y **sai** â€” hoáº·c Ã­t nháº¥t lÃ  **thiáº¿u**. Nested function **chá»‰ lÃ  Ä‘iá»u kiá»‡n cáº§n**, khÃ´ng pháº£i Ä‘á»§.

Closure chá»‰ hÃ¬nh thÃ nh khi inner function **reference** (tham chiáº¿u) biáº¿n tá»« outer function scope. Náº¿u inner function khÃ´ng sá»­ dá»¥ng báº¥t ká»³ biáº¿n nÃ o tá»« outer scope â†’ **khÃ´ng cÃ³ closure** â€” vÃ¬ engine khÃ´ng cáº§n giá»¯ outer EC alive.

Khi closure tá»“n táº¡i, Ä‘iá»u gÃ¬ thá»±c sá»± xáº£y ra bÃªn trong V8 engine?

1. Outer function cháº¡y xong â†’ EC(outer) Láº¼ RA bá»‹ pop khá»i call stack vÃ  GC thu há»“i memory
2. NhÆ°ng inner function Ä‘Ã£ escape ra ngoÃ i (returned/stored/passed) â†’ inner function cÃ²n sá»‘ng
3. Inner function mang theo `[[scope]]` reference â†’ trá» ngÆ°á»£c vá» EC(outer)
4. GC tháº¥y EC(outer) **váº«n cÃ³ reference** (tá»« inner function) â†’ **KHÃ”NG thu há»“i**
5. Káº¿t quáº£: cÃ¡c biáº¿n trong EC(outer) **sá»‘ng lÃ¢u hÆ¡n** outer function â†’ Ä‘Ã¢y lÃ  closure!

Äiá»u quan trá»ng cáº§n nhá»›: closure KHÃ”NG copy giÃ¡ trá»‹ biáº¿n â€” nÃ³ giá»¯ **reference** Ä‘áº¿n biáº¿n tháº­t. Náº¿u outer function thay Ä‘á»•i biáº¿n sau khi táº¡o closure â†’ closure sáº½ tháº¥y giÃ¡ trá»‹ má»›i. ÄÃ¢y lÃ  nguá»“n gá»‘c cá»§a bug kinh Ä‘iá»ƒn "stale closure" trong React.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURE â€” KHÃI NIá»†M Cá»T LÃ•I                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“– Äá»‹nh nghÄ©a (JavaScript: The Definitive Guide):              â”‚
â”‚  "A closure is a function that has access to variables          â”‚
â”‚   in the scope of another function."                            â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ Khi function Ä‘Æ°á»£c thá»±c thi:                                  â”‚
â”‚  â†’ Private context EC(FN) Ä‘Æ°á»£c táº¡o ra                           â”‚
â”‚  â†’ BÃ¬nh thÆ°á»ng: sau khi code cháº¡y xong â†’ EC pop khá»i stack     â”‚
â”‚  â†’ Äáº¶C BIá»†T: náº¿u cÃ³ thá»© bÃªn TRONG context bá»‹ thá»© bÃªn NGOÃ€I   â”‚
â”‚    chiáº¿m giá»¯ â†’ context KHÃ”NG bá»‹ pop â†’ táº¡o ra context           â”‚
â”‚    KHÃ”NG Há»¦Y ÄÆ¯á»¢C (non-destroyable context)                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  function outer() {                                        â”‚ â”‚
â”‚  â”‚    let secret = "hidden";    // private variable            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    return function inner() { // â† inner bá»‹ return ra ngoÃ i â”‚ â”‚
â”‚  â”‚      return secret;          // â† truy cáº­p biáº¿n outer      â”‚ â”‚
â”‚  â”‚    };                                                      â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  const getClosed = outer();                                 â”‚ â”‚
â”‚  â”‚  // EC(outer) KHÃ”NG bá»‹ pop vÃ¬ inner váº«n reference secret   â”‚ â”‚
â”‚  â”‚  // â†’ secret Ä‘Æ°á»£c Báº¢O Tá»’N trong memory                     â”‚ â”‚
â”‚  â”‚  getClosed(); // "hidden" âœ…                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ Giáº£i thÃ­ch toÃ n diá»‡n:                                        â”‚
â”‚  Trong JS, scope cá»§a biáº¿n thuá»™c vá» function scope. Sau khi      â”‚
â”‚  function cháº¡y xong, scope bá»‹ dá»n dáº¹p, memory Ä‘Æ°á»£c thu há»“i.    â”‚
â”‚  NHÆ¯NG closure (child function bÃªn trong) cÃ³ thá»ƒ truy cáº­p       â”‚
â”‚  parent scope. DÃ¹ parent function Ä‘Ã£ cháº¡y xong, parent scope   â”‚
â”‚  KHÃ”NG bá»‹ há»§y â†’ child function váº«n cÃ³ quyá»n truy cáº­p biáº¿n      â”‚
â”‚  cá»§a parent, vÃ  giÃ¡ trá»‹ khÃ´ng bá»‹ há»§y.                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Hai Chá»©c NÄƒng ChÃ­nh: Báº¢O Vá»† & LÆ¯U GIá»®

**BÃ i viáº¿t â€” Protection & Preservation: Hai Máº·t Cá»§a CÃ¹ng Má»™t Äá»“ng Xu**

Closure phá»¥c vá»¥ hai má»¥c Ä‘Ã­ch cá»‘t lÃµi â€” vÃ  hiá»ƒu rÃµ hai má»¥c Ä‘Ã­ch nÃ y sáº½ giÃºp báº¡n quyáº¿t Ä‘á»‹nh **khi nÃ o nÃªn** vÃ  **khi nÃ o khÃ´ng nÃªn** dÃ¹ng closure.

**Báº¢O Vá»† (Protection)** â€” Closure táº¡o ra "vá» bá»c" (encapsulation) quanh biáº¿n private. Trong JavaScript, trÆ°á»›c khi cÃ³ `#private` fields (ES2022), closure lÃ  cÃ¡ch **duy nháº¥t** táº¡o truly private variables. KhÃ¡c vá»›i convention dÃ¹ng `_underscore` (váº«n truy cáº­p Ä‘Æ°á»£c tá»« ngoÃ i), closure **thá»±c sá»± ngÄƒn cháº·n** truy cáº­p: biáº¿n khÃ´ng tá»“n táº¡i trong báº¥t ká»³ namespace nÃ o accessible â€” nÃ³ chá»‰ sá»‘ng trong scope chain cá»§a closure.

HÃ£y nghÄ© nhÆ° **kÃ©t sáº¯t**: báº¡n Ä‘áº·t tiá»n vÃ o kÃ©t (private vars), chá»‰ báº¡n cÃ³ chÃ¬a khÃ³a (closure functions). KhÃ´ng ai khÃ¡c â€” dÃ¹ lÃ  admin, devtools hay báº¥t ká»³ script nÃ o â€” cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p tiá»n trong kÃ©t. Há» chá»‰ cÃ³ thá»ƒ gá»i báº¡n (API methods) Ä‘á»ƒ rÃºt/náº¡p.

**LÆ¯U GIá»® (Preservation)** â€” Closure kÃ©o dÃ i vÃ²ng Ä‘á»i biáº¿n **vÆ°á»£t ra ngoÃ i** lifetime bÃ¬nh thÆ°á»ng. Biáº¿n local láº½ ra cháº¿t khi function return, nhÆ°ng closure giá»¯ chÃºng sá»‘ng â€” miá»…n lÃ  closure function cÃ²n tá»“n táº¡i. Äiá»u nÃ y cho phÃ©p **stateful functions** â€” functions "nhá»›" tráº¡ng thÃ¡i giá»¯a cÃ¡c láº§n gá»i.

Hai chá»©c nÄƒng nÃ y thÆ°á»ng Ä‘i Ä‘Ã´i: báº¡n muá»‘n **lÆ°u giá»¯** state (counter, cache) VÃ€ **báº£o vá»‡** nÃ³ khá»i bá»‹ modify trá»±c tiáº¿p (chá»‰ modify qua API methods). NhÆ°ng Ä‘Ã´i khi báº¡n chá»‰ cáº§n má»™t: IIFE chá»‰ cáº§n Protection (táº¡o scope rá»“i bá»), cÃ²n memoization cache chá»‰ cáº§n Preservation (giá»¯ cache giá»¯a cÃ¡c calls).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TWO CORE FUNCTIONS OF CLOSURES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1ï¸âƒ£  Báº¢O Vá»† (Protection)                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  PhÃ¢n chia vÃ¹ng thá»±c thi code Äá»˜C Láº¬P                     â”‚ â”‚
â”‚  â”‚  â†’ BÃªn trong cÃ³ khÃ´ng gian LÆ¯U TRá»® biáº¿n riÃªng tÆ°          â”‚ â”‚
â”‚  â”‚  â†’ Báº¢O Vá»† biáº¿n private khá»i can thiá»‡p tá»« bÃªn ngoÃ i        â”‚ â”‚
â”‚  â”‚  â†’ Thao tÃ¡c trÃªn biáº¿n private KHÃ”NG áº£nh hÆ°á»Ÿng bÃªn ngoÃ i   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Global Scope                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  var x = 10;                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€ Private Scope (Protected) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  var x = 100;  // â† KHÃ”NG áº£nh hÆ°á»Ÿng x ngoÃ iâ”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  var secret = "hidden"; // â† KHÃ”NG thá»ƒ      â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                         //   truy cáº­p tá»«    â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                         //   bÃªn ngoÃ i      â”‚    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  console.log(x); // 10 â† khÃ´ng bá»‹ thay Ä‘á»•i          â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  2ï¸âƒ£  LÆ¯U GIá»® (Saving/Preservation)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Náº¿u context hiá»‡n táº¡i KHÃ”NG bá»‹ release                     â”‚ â”‚
â”‚  â”‚  (cÃ³ thá»© bÃªn trong bá»‹ bÃªn ngoÃ i chiáº¿m giá»¯)                â”‚ â”‚
â”‚  â”‚  â†’ Biáº¿n private cÅ©ng KHÃ”NG bá»‹ release                     â”‚ â”‚
â”‚  â”‚  â†’ CÃ³ thá»ƒ truy xuáº¥t & sá»­ dá»¥ng á»Ÿ context cáº¥p dÆ°á»›i          â”‚ â”‚
â”‚  â”‚  â†’ TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i LÆ¯U GIá»® giÃ¡ trá»‹                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  function counter() {                                      â”‚ â”‚
â”‚  â”‚    let count = 0;        // â† saved (khÃ´ng bá»‹ GC)         â”‚ â”‚
â”‚  â”‚    return () => ++count; // â† bÃªn ngoÃ i chiáº¿m giá»¯         â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚  const inc = counter();                                    â”‚ â”‚
â”‚  â”‚  inc(); // 1 â† count Ä‘Æ°á»£c LÆ¯U GIá»®                         â”‚ â”‚
â”‚  â”‚  inc(); // 2 â† count váº«n sá»‘ng                             â”‚ â”‚
â”‚  â”‚  inc(); // 3 â† tiáº¿p tá»¥c tÄƒng                              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”‘ CÆ¡ cháº¿ hÃ¬nh thÃ nh private context khi function thá»±c thi     â”‚
â”‚     Ä‘á»ƒ Báº¢O Vá»† vÃ  LÆ¯U GIá»® biáº¿n â†’ gá»i lÃ  CLOSURE                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Äáº·c Äiá»ƒm Cá»§a Closure

**BÃ i viáº¿t â€” 3 Äáº·c Äiá»ƒm Cá»‘t LÃµi: Hiá»ƒu SÃ¢u HÆ¡n Äá»‹nh NghÄ©a**

Closures cÃ³ 3 Ä‘áº·c Ä‘iá»ƒm ká»¹ thuáº­t quan trá»ng mÃ  developer cáº§n náº¯m:

**Äáº·c Ä‘iá»ƒm 1: Truy cáº­p toÃ n bá»™ outer scope** â€” Inner function khÃ´ng chá»‰ tháº¥y biáº¿n cá»§a **trá»±c tiáº¿p** outer function mÃ  cÃ²n tháº¥y **táº¥t cáº£** ancestors trÃªn scope chain (function cha, function Ã´ng, global). NÃ³ cÅ©ng truy cáº­p **parameters** cá»§a outer function â€” parameters cÅ©ng chá»‰ lÃ  biáº¿n local, nÃªn cÅ©ng bá»‹ giá»¯ alive bá»Ÿi closure.

**Äáº·c Ä‘iá»ƒm 2: Functions lá»“ng nhiá»u táº§ng** â€” JavaScript cho phÃ©p closures lá»“ng khÃ´ng giá»›i háº¡n: `level1 â†’ level2 â†’ level3 â†’ ...`. Má»—i táº§ng giá»¯ reference Ä‘áº¿n táº¥t cáº£ táº§ng trÃªn. Tuy powerful nhÆ°ng cáº§n cáº©n tháº­n: má»—i táº§ng closure lÃ  memory overhead thÃªm.

**Äáº·c Ä‘iá»ƒm 3: Káº¿t ná»‘i trong-ngoÃ i** â€” Closure táº¡o "cáº§u ná»‘i" cho phÃ©p code bÃªn ngoÃ i **giÃ¡n tiáº¿p** Ä‘á»c/ghi biáº¿n bÃªn trong function Ä‘Ã£ return. ÄÃ¢y chÃ­nh lÃ  cÆ¡ cháº¿ cá»§a `useState` trong React: component render â†’ táº¡o closure â†’ closure giá»¯ state â†’ re-render váº«n tháº¥y state cÅ© thÃ´ng qua closure reference.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äáº¶C ÄIá»‚M 1: Inner function truy cáº­p biáº¿n & params cá»§a outer
// (thÃ´ng qua scope chain, giÃ¡ trá»‹ lÆ°u trong memory thay vÃ¬ bá»‹ há»§y)
// â†’ Thiáº¿t káº¿ private methods/variables, trÃ¡nh Ã´ nhiá»…m global
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createAPI(baseUrl) {
  // params vÃ  variables cá»§a outer â†’ accessible bá»Ÿi inner
  const token = "secret-token-123";

  function get(endpoint) {
    // Truy cáº­p baseUrl (param) vÃ  token (variable) cá»§a outer
    return fetch(`${baseUrl}${endpoint}`, {
      headers: { Authorization: token },
    });
  }

  function post(endpoint, data) {
    return fetch(`${baseUrl}${endpoint}`, {
      method: "POST",
      headers: { Authorization: token },
      body: JSON.stringify(data),
    });
  }

  // Private: token khÃ´ng bá»‹ lá»™ ra ngoÃ i
  // Public: chá»‰ expose get & post
  return { get, post };
}

const api = createAPI("https://api.example.com");
api.get("/users"); // âœ… DÃ¹ng baseUrl + token bÃªn trong
// api.token            // âŒ undefined â€” Báº¢O Vá»† thÃ nh cÃ´ng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äáº¶C ÄIá»‚M 2: Functions lá»“ng nhau (Nested Functions)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function level1() {
  let a = 1;
  function level2() {
    let b = 2;
    function level3() {
      let c = 3;
      console.log(a, b, c); // 1, 2, 3 â€” truy cáº­p táº¥t cáº£ táº§ng trÃªn
    }
    return level3;
  }
  return level2;
}

level1()()(); // 1 2 3

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äáº¶C ÄIá»‚M 3: Káº¿t ná»‘i bÃªn trong & bÃªn ngoÃ i function
// Cho phÃ©p truy cáº­p biáº¿n bÃªn trong tá»« bÃªn ngoÃ i
// Äáº£m báº£o giÃ¡ trá»‹ LUÃ”N LÆ¯U trong memory, khÃ´ng bá»‹ auto-clear
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createState(initial) {
  let state = initial;

  return {
    get: () => state, // Truy cáº­p tá»« bÃªn ngoÃ i
    set: (val) => {
      state = val;
    }, // Thay Ä‘á»•i tá»« bÃªn ngoÃ i
  };
}

const myState = createState("hello");
myState.get(); // "hello"
myState.set("world");
myState.get(); // "world" â€” state váº«n sá»‘ng trong memory
```

### Äiá»u Kiá»‡n HÃ¬nh ThÃ nh Closure

**BÃ i viáº¿t â€” Khi NÃ o Closure HÃ¬nh ThÃ nh? VÃ  Khi NÃ o KHÃ”NG?**

ÄÃ¢y lÃ  cÃ¢u há»i interview **cá»±c ká»³ phá»• biáº¿n**. Nhiá»u á»©ng viÃªn sai á»Ÿ Ä‘Ã¢y vÃ¬ há» nghÄ© "má»i nested function Ä‘á»u lÃ  closure" â€” sai!

Closure cáº§n **Ä‘á»“ng thá»i 2 Ä‘iá»u kiá»‡n**: (1) Functions lá»“ng nhau, VÃ€ (2) inner function **thá»±c sá»± tham chiáº¿u** biáº¿n local cá»§a outer function. Náº¿u thiáº¿u Ä‘iá»u kiá»‡n (2), V8 engine **optimize** báº±ng cÃ¡ch KHÃ”NG giá»¯ outer EC alive â†’ khÃ´ng táº¡o closure â†’ tiáº¿t kiá»‡m memory.

Thá»±c táº¿, V8 cÅ©ng thÃ´ng minh hÆ¡n: ngay cáº£ khi cÃ³ closure, V8 chá»‰ giá»¯ **nhá»¯ng biáº¿n Ä‘Æ°á»£c reference**, khÃ´ng pháº£i toÃ n bá»™ outer EC. Náº¿u function outer cÃ³ 10 biáº¿n nhÆ°ng closure chá»‰ dÃ¹ng 1 â†’ V8 chá»‰ giá»¯ 1 biáº¿n Ä‘Ã³ (optimization gá»i lÃ  "context specialization"). Trá»« khi code dÃ¹ng `eval()` â€” khi Ä‘Ã³ V8 báº¯t buá»™c giá»¯ toÃ n bá»™ vÃ¬ `eval` cÃ³ thá»ƒ reference báº¥t ká»³ biáº¿n nÃ o.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURE FORMATION CONDITIONS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Cáº§n Ä‘á»“ng thá»i 2 Ä‘iá»u kiá»‡n:                                    â”‚
â”‚                                                                 â”‚
â”‚  â‘  Functions lá»“ng nhau (Nested Functions)                       â”‚
â”‚                                                                 â”‚
â”‚  â‘¡ Inner function THAM CHIáº¾U biáº¿n local cá»§a outer function      â”‚
â”‚     â†’ KÃ©o dÃ i vÃ²ng Ä‘á»i (lifetime) cá»§a biáº¿n outer                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  function outer() {                                        â”‚ â”‚
â”‚  â”‚    let x = 10;                  // â‘  biáº¿n local            â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    function inner() {           // â‘  nested function       â”‚ â”‚
â”‚  â”‚      console.log(x);           // â‘¡ reference biáº¿n outer  â”‚ â”‚
â”‚  â”‚    }                                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    return inner;                // inner escape ra ngoÃ i   â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âœ… CLOSURE! inner + biáº¿n x = closure                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  function notClosure() {                                   â”‚ â”‚
â”‚  â”‚    let x = 10;                                             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    function inner() {                                      â”‚ â”‚
â”‚  â”‚      let y = 20;               // âŒ KHÃ”NG reference x     â”‚ â”‚
â”‚  â”‚      console.log(y);                                       â”‚ â”‚
â”‚  â”‚    }                                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    return inner;                                           â”‚ â”‚
â”‚  â”‚  }                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âŒ NOT a closure â€” inner khÃ´ng reference biáº¿n outer        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### á»¨ng Dá»¥ng Cá»§a Closure

**BÃ i viáº¿t â€” 4 Use Cases Kinh Äiá»ƒn: Táº¡i Sao JavaScript KhÃ´ng Thá»ƒ Sá»‘ng Thiáº¿u Closure**

Closure khÃ´ng pháº£i "giáº£i phÃ¡p tÃ¬m bÃ i toÃ¡n" â€” nÃ³ lÃ  **giáº£i phÃ¡p tá»± nhiÃªn** cho nhá»¯ng bÃ i toÃ¡n JavaScript gáº·p hÃ ng ngÃ y. TrÆ°á»›c ES6, nÃ³ lÃ  cÃ¡ch duy nháº¥t táº¡o block scope (IIFE). TrÆ°á»›c ES2022, nÃ³ lÃ  cÃ¡ch duy nháº¥t táº¡o private variables. VÃ  cho Ä‘áº¿n hÃ´m nay, nÃ³ váº«n lÃ  backbone cá»§a Module Pattern â€” pattern mÃ  má»i bundler (Webpack, Rollup, esbuild) Ä‘á»u dÃ¹ng khi wrap má»—i module trong IIFE.

- **IIFE** (Use Case 1): Táº¡o scope riÃªng biá»‡t ngay láº­p tá»©c â†’ dÃ¹ng khi cáº§n isolate code ngay, vÃ­ dá»¥ polyfills, third-party scripts, initialization code
- **Module Pattern** (Use Case 2): Táº¡o "class-like" structure vá»›i private/public separation â†’ backbone cá»§a jQuery, Lodash, vÃ  cÃ¡ch browsers bundle modules
- **Private Variables** (Use Case 3): Truly encapsulated state â†’ dÃ¹ng khi cáº§n validation trÆ°á»›c khi modify (chá»‰ tÄƒng tuá»•i qua `birthday()`, khÃ´ng cho set trá»±c tiáº¿p)
- **Module Creation** (Use Case 4): EventBus, State Manager, Logger â€” táº¥t cáº£ dÃ¹ng closure Ä‘á»ƒ giá»¯ internal state isolated

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 1: MÃ´ phá»ng Block Scope (trÆ°á»›c ES6)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// IIFE (Immediately Invoked Function Expression)
(function () {
  var privateVar = "I'm private";
  // Code bÃªn trong cÃ³ scope riÃªng, khÃ´ng Ã´ nhiá»…m global
})();
// privateVar khÃ´ng tá»“n táº¡i á»Ÿ Ä‘Ã¢y

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 2: Báº£o vá»‡ biáº¿n (Module Pattern)
// â†’ Truy cáº­p lexical scope nÆ¡i function Ä‘Æ°á»£c define
// â†’ NgÄƒn biáº¿n bá»‹ garbage collected
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const UserModule = (function () {
  // Private â€” Báº¢O Vá»† khá»i bÃªn ngoÃ i
  let users = [];
  let idCounter = 0;

  // Public API â€” káº¿t ná»‘i bÃªn trong & bÃªn ngoÃ i
  return {
    addUser(name) {
      users.push({ id: ++idCounter, name });
    },
    getUsers() {
      return [...users]; // Return copy, Báº¢O Vá»† original
    },
    count() {
      return users.length;
    },
  };
})();

UserModule.addUser("Alice");
UserModule.addUser("Bob");
UserModule.count(); // 2
// UserModule.users        // âŒ undefined â€” Báº¢O Vá»† thÃ nh cÃ´ng
// UserModule.idCounter    // âŒ undefined â€” Báº¢O Vá»† thÃ nh cÃ´ng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 3: Encapsulate Private Variables
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createPerson(name) {
  let _age = 0; // Convention: _ = private

  return {
    getName: () => name,
    getAge: () => _age,
    birthday: () => {
      _age++;
    },
    // KhÃ´ng cÃ³ setAge â†’ KHÃ”NG thá»ƒ set age trá»±c tiáº¿p tá»« bÃªn ngoÃ i
  };
}

const person = createPerson("Alice");
person.birthday();
person.getAge(); // 1
// person._age       // âŒ undefined â€” truly private

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// USE CASE 4: Create Module (Creating isolated modules)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const EventBus = (function () {
  const listeners = {}; // Private â€” LÆ¯U GIá»® toÃ n bá»™ listeners

  return {
    on(event, callback) {
      if (!listeners[event]) listeners[event] = [];
      listeners[event].push(callback);
    },
    emit(event, data) {
      (listeners[event] || []).forEach((cb) => cb(data));
    },
    off(event, callback) {
      if (!listeners[event]) return;
      listeners[event] = listeners[event].filter((cb) => cb !== callback);
    },
  };
})();

// listeners object Ä‘Æ°á»£c Báº¢O Vá»† & LÆ¯U GIá»® bá»Ÿi closure
```

### Closure Trong Thá»±c Táº¿ â€” á» Kháº¯p Má»i NÆ¡i

**BÃ i viáº¿t â€” Closures Trong Production: 6 Patterns Báº¡n DÃ¹ng HÃ ng NgÃ y**

CÃ³ má»™t thá»±c táº¿ thÃº vá»‹: **pháº§n lá»›n JavaScript code báº¡n viáº¿t hÃ ng ngÃ y Ä‘á»u dÃ¹ng closures** mÃ  báº¡n cÃ³ thá»ƒ khÃ´ng Ã½ thá»©c Ä‘Æ°á»£c. JavaScript lÃ  ngÃ´n ngá»¯ **event-driven** â€” gáº§n nhÆ° má»i interaction (click, fetch, timer) Ä‘á»u dÃ¹ng callbacks, vÃ  má»i callback trong context Ä‘á»u lÃ  closure.

6 patterns phá»• biáº¿n nháº¥t:

1. **Event Handlers** â€” `addEventListener` callback "nhá»›" biáº¿n tá»« outer scope (message, DOM element references, configuration)
2. **AJAX/Fetch Callbacks** â€” `.then()` callback "nhá»›" request parameters, timestamps, retry counts
3. **setTimeout/setInterval** â€” Delayed execution mÃ  váº«n access biáº¿n tá»« thá»i Ä‘iá»ƒm setup
4. **Higher-Order Functions** â€” `multiplier(2)` tráº£ vá» function "nhá»›" factor=2 mÃ£i mÃ£i
5. **Debounce/Throttle** â€” Closure giá»¯ `timerId` alive giá»¯a cÃ¡c láº§n gá»i â†’ core pattern trong má»i UI framework
6. **React Hooks** â€” `useState`, `useCallback`, `useEffect` â€” táº¥t cáº£ dá»±a trÃªn closures Ä‘á»ƒ "nhá»›" state giá»¯a re-renders. Bug "stale closure" trong React xáº£y ra chÃ­nh vÃ¬ closure mechanism.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Pháº§n lá»›n JS front-end code lÃ  "event-driven"
// â†’ Closures xuáº¥t hiá»‡n á» KHáº®P Má»ŒI NÆ I
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ğŸ“Œ 1. Event Handlers (callback bound to events)
function setupButton(buttonId, message) {
  const button = document.getElementById(buttonId);
  button.addEventListener("click", function () {
    // Closure! Truy cáº­p `message` tá»« outer scope
    alert(message);
  });
}

// ğŸ“Œ 2. AJAX Callbacks (success/failure)
function fetchUser(userId) {
  const requestTime = Date.now();

  fetch(`/api/users/${userId}`)
    .then((response) => response.json())
    .then((data) => {
      // Closure! Truy cáº­p userId vÃ  requestTime
      console.log(`User ${userId} loaded in ${Date.now() - requestTime}ms`);
    });
}

// ğŸ“Œ 3. setTimeout / setInterval (delayed callbacks)
function delayedGreeting(name, delay) {
  setTimeout(function () {
    // Closure! Truy cáº­p `name` sau delay milliseconds
    console.log(`Hello, ${name}!`);
  }, delay);
}

// ğŸ“Œ 4. Function returning another function
function multiplier(factor) {
  return function (number) {
    // Closure! Truy cáº­p `factor`
    return number * factor;
  };
}

const double = multiplier(2);
const triple = multiplier(3);
double(5); // 10
triple(5); // 15

// ğŸ“Œ 5. Debounce / Throttle (ráº¥t phá»• biáº¿n!)
function debounce(fn, delay) {
  let timerId = null; // LÆ¯U GIá»® bá»Ÿi closure

  return function (...args) {
    clearTimeout(timerId);
    timerId = setTimeout(() => {
      // Báº¢O Vá»† timerId khá»i bÃªn ngoÃ i
      fn.apply(this, args);
    }, delay);
  };
}

const debouncedSearch = debounce(search, 300);
// timerId Ä‘Æ°á»£c LÆ¯U GIá»® giá»¯a cÃ¡c láº§n gá»i
// timerId Ä‘Æ°á»£c Báº¢O Vá»† â€” khÃ´ng ai ngoÃ i closure cÃ³ thá»ƒ truy cáº­p

// ğŸ“Œ 6. React Hooks (closures everywhere!)
function useCounter(initial = 0) {
  const [count, setCount] = useState(initial);

  // Má»—i callback lÃ  má»™t closure
  const increment = useCallback(() => {
    setCount((prev) => prev + 1); // Closure truy cáº­p setCount
  }, []);

  return { count, increment };
}
```

### Æ¯u Äiá»ƒm & NhÆ°á»£c Äiá»ƒm

**BÃ i viáº¿t â€” Trade-offs Tháº­t Sá»±: Closure KhÃ´ng Miá»…n PhÃ­**

Má»i power Ä‘á»u cÃ³ giÃ¡. Closure giá»¯ biáº¿n alive â†’ biáº¿n Ä‘Ã³ **chiáº¿m memory** cho Ä‘áº¿n khi closure bá»‹ destroy. ÄÃ¢y khÃ´ng pháº£i "bug" â€” Ä‘Ã¢y lÃ  **design trade-off** cÃ³ chá»§ Ä‘Ã­ch. Váº¥n Ä‘á» chá»‰ xáº£y ra khi developer **khÃ´ng aware** trade-off nÃ y.

Má»™t closure Ä‘Æ¡n láº» giá»¯ vÃ i biáº¿n primitive â†’ negligible. NhÆ°ng 10,000 closures giá»¯ DOM references trong SPA cháº¡y 8 tiáº¿ng? â†’ **memory leak** nghiÃªm trá»ng. Hoáº·c closure trong `setInterval` khÃ´ng bao giá» Ä‘Æ°á»£c `clearInterval`? â†’ Biáº¿n sá»‘ng **mÃ£i mÃ£i** cho Ä‘áº¿n khi page refresh.

Rule of thumb: **closure nÃªn ngáº¯n háº¡n** (callback cháº¡y rá»“i GC) hoáº·c **cÃ³ chá»§ Ä‘Ã­ch** (module state, cache). Avoid long-lived closures giá»¯ large objects â€” dÃ¹ng WeakRef hoáº·c WeakMap náº¿u cáº§n giá»¯ reference mÃ  váº«n cho phÃ©p GC.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURE: ADVANTAGES & DISADVANTAGES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âœ… Æ¯U ÄIá»‚M:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. KÃ‰O DÃ€I vÃ²ng Ä‘á»i biáº¿n local (biáº¿n sá»‘ng ngoÃ i function)â”‚ â”‚
â”‚  â”‚  2. Báº¢O Vá»† biáº¿n private â€” trÃ¡nh Ã´ nhiá»…m global scope      â”‚ â”‚
â”‚  â”‚  3. Táº¡o data encapsulation & module pattern                â”‚ â”‚
â”‚  â”‚  4. Cho phÃ©p function factories & currying                 â”‚ â”‚
â”‚  â”‚  5. Enable event-driven & callback patterns                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âŒ NHÆ¯á»¢C ÄIá»‚M:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. Biáº¿n LUÃ”N LÆ¯U trong memory â†’ khÃ´ng bá»‹ auto-clear      â”‚ â”‚
â”‚  â”‚  2. QuÃ¡ nhiá»u closures â†’ MEMORY LEAK                       â”‚ â”‚
â”‚  â”‚  3. KhÃ³ debug (biáº¿n áº©n trong scope chain)                  â”‚ â”‚
â”‚  â”‚  4. Performance overhead (scope chain lookup)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ NGUYÃŠN Táº®C Sá»¬ Dá»¤NG:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  1. DÃ¹ng closure cÃ³ Má»¤C ÄÃCH rÃµ rÃ ng                       â”‚ â”‚
â”‚  â”‚  2. Giáº£i phÃ³ng closure khi khÃ´ng cáº§n (fn = null)           â”‚ â”‚
â”‚  â”‚  3. TrÃ¡nh closure trong loop náº¿u khÃ´ng cáº§n thiáº¿t           â”‚ â”‚
â”‚  â”‚  4. DÃ¹ng WeakMap thay vÃ¬ closure cho cache lá»›n             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Closure: TÃ³m Táº¯t

**BÃ i viáº¿t â€” One-Page Cheatsheet: Má»i Thá»© Cáº§n Biáº¿t Vá» Closures**

Sau táº¥t cáº£ phÃ¢n tÃ­ch chuyÃªn sÃ¢u, Ä‘Ã¢y lÃ  báº£n tÃ³m táº¯t **one-page** báº¡n cÃ³ thá»ƒ quay láº¡i báº¥t cá»© lÃºc nÃ o:

- **WHAT**: Closure = Function + Lexical Environment (references Ä‘áº¿n biáº¿n surrounding scope)
- **WHY**: Báº¢O Vá»† private state + LÆ¯U GIá»® state vÆ°á»£t qua function lifetime
- **WHEN**: Khi inner function reference biáº¿n outer function VÃ€ inner function escapes (returned, stored, passed)
- **WHERE**: Event handlers, AJAX, setTimeout, module pattern, currying, debounce/throttle, React hooks
- **COST**: Memory overhead â€” má»i closure giá»¯ scope chain alive â†’ biáº¿n khÃ´ng bá»‹ GC
- **FIX**: Set reference = null khi xong, dÃ¹ng WeakRef cho large objects, cleanup event listeners

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURE SUMMARY                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  WHAT:  Function + reference Ä‘áº¿n biáº¿n outer scope               â”‚
â”‚  WHY:   Báº¢O Vá»† (protection) + LÆ¯U GIá»® (saving) private vars   â”‚
â”‚  WHEN:  Nested functions + inner references outer local vars    â”‚
â”‚  WHERE: Event handlers, AJAX, setTimeout, module pattern,       â”‚
â”‚         currying, debounce/throttle, React hooks                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ TRADE-OFF:                                                   â”‚
â”‚  KÃ©o dÃ i vÃ²ng Ä‘á»i biáº¿n (useful) â†” Tá»‘n memory (dangerous)       â”‚
â”‚  â†’ DÃ¹ng cÃ³ chá»§ Ä‘Ã­ch, giáº£i phÃ³ng khi xong                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ§  Deep Analysis Patterns â€” PhÃ¢n TÃ­ch Closures Theo 6 GÃ³c NhÃ¬n ChuyÃªn SÃ¢u

Pháº§n trÃªn Ä‘Ã£ giáº£i thÃ­ch Closures **lÃ  gÃ¬** vÃ  **dÃ¹ng á»Ÿ Ä‘Ã¢u**. Pháº§n dÆ°á»›i Ä‘Ã¢y phÃ¢n tÃ­ch tá»« **6 gÃ³c nhÃ¬n tÆ° duy** â€” giÃºp báº¡n hiá»ƒu táº¡i sao closures tá»“n táº¡i, engine implement nÃ³ nhÆ° tháº¿ nÃ o, vÃ  khi nÃ o nÃªn/khÃ´ng nÃªn dÃ¹ng.

---

#### Pattern 1: Äá»‡ Quy "Táº¡i Sao" (5 Whys) â€” Truy Váº¿t Closure Tá»« Hiá»‡n TÆ°á»£ng Äáº¿n Báº£n Cháº¥t

---

**WHY 1: Táº¡i sao JavaScript cáº§n Closures?**

VÃ¬ JavaScript cáº§n cÃ¡ch táº¡o **private state** trong functions. KhÃ¡c vá»›i Java/C++ cÃ³ `private` keyword, JavaScript (trÆ°á»›c ES2022) khÃ´ng cÃ³ access modifiers. Closures lÃ  cÆ¡ cháº¿ **ngÃ´n ngá»¯** duy nháº¥t Ä‘á»ƒ áº©n biáº¿n khá»i external access.

**WHY 2: Táº¡i sao cáº§n private state?**

VÃ¬ JavaScript cháº¡y trong **mÃ´i trÆ°á»ng untrusted** â€” browser. HÃ ng chá»¥c scripts tá»« nhiá»u nguá»“n (your code, ads, analytics, third-party libraries) cÃ¹ng share global namespace. Náº¿u táº¥t cáº£ state Ä‘á»u public, báº¥t ká»³ script nÃ o cÅ©ng cÃ³ thá»ƒ Ä‘á»c/ghi state cá»§a script khÃ¡c â†’ **security nightmare** + **accidental bugs**.

**WHY 3: Táº¡i sao khÃ´ng dÃ¹ng `private` keyword tá»« Ä‘áº§u?**

VÃ¬ Brendan Eich táº¡o JavaScript trong **10 ngÃ y** (1995) nhÆ° scripting language Ä‘Æ¡n giáº£n. NgÃ´n ngá»¯ ban Ä‘áº§u khÃ´ng cÃ³ class, khÃ´ng cÃ³ module system â€” chá»‰ cÃ³ functions. Closures lÃ  **side effect tá»± nhiÃªn** cá»§a lexical scoping + first-class functions â€” khÃ´ng cáº§n thÃªm syntax má»›i.

**WHY 4: Táº¡i sao lexical scoping tá»± nhiÃªn táº¡o ra closures?**

VÃ¬ lexical scoping quy Ä‘á»‹nh function luÃ´n truy cáº­p scope nÆ¡i nÃ³ **Ä‘Æ°á»£c viáº¿t**. Khi JavaScript cho phÃ©p functions lÃ  **first-class values** (cÃ³ thá»ƒ return, store, pass) â†’ function cÃ³ thá»ƒ tá»“n táº¡i **lÃ¢u hÆ¡n** surrounding scope â†’ scope pháº£i Ä‘Æ°á»£c giá»¯ alive â†’ closure hÃ¬nh thÃ nh. ÄÃ¢y lÃ  há»‡ quáº£ logic **khÃ´ng thá»ƒ trÃ¡nh** khi káº¿t há»£p lexical scope + first-class functions.

**WHY 5: Táº¡i sao giá»¯ scope chain alive thay vÃ¬ copy giÃ¡ trá»‹?**

VÃ¬ closure cáº§n **shared mutable state**. Náº¿u copy giÃ¡ trá»‹ táº¡i thá»i Ä‘iá»ƒm táº¡o closure, counter `count++` sáº½ khÃ´ng hoáº¡t Ä‘á»™ng â€” má»—i láº§n gá»i sáº½ tháº¥y giÃ¡ trá»‹ ban Ä‘áº§u. Giá»¯ reference Ä‘áº£m báº£o closure luÃ´n tháº¥y **giÃ¡ trá»‹ hiá»‡n táº¡i** cá»§a biáº¿n. Trade-off: reference means memory retention â€” Ä‘Ã¢y lÃ  nguá»“n gá»‘c memory leaks.

```
5 WHYS â€” CLOSURE TRACE:

Closure tá»“n táº¡i
  â””â”€ WHY? â†’ Cáº§n private state (JS khÃ´ng cÃ³ private keyword ban Ä‘áº§u)
      â””â”€ WHY? â†’ Untrusted environment (browser, multi-script)
          â””â”€ WHY? â†’ JS táº¡o trong 10 ngÃ y, khÃ´ng cÃ³ access modifiers
              â””â”€ WHY? â†’ Side effect tá»± nhiÃªn: lexical scope + first-class functions
                  â””â”€ WHY? â†’ Giá»¯ reference (not copy) cho shared mutable state
                      â””â”€ TRADE-OFF: Memory retention vs Functional power
```

---

#### Pattern 2: First Principles â€” Closure á» Má»©c Data Structure & Algorithm

---

**Data Structure: Closure = Function Object + Environment Record**

á» má»©c engine (V8), closure khÃ´ng pháº£i magic â€” nÃ³ lÃ  má»™t **ordinary object** vá»›i 2 thÃ nh pháº§n:

```
Closure Object (V8 Internal):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [[Code]]    â†’ pointer to compiled bytecode  â”‚
â”‚  [[Scope]]   â†’ pointer to Context object     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Context Object (giá»¯ captured variables):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  slot[0]  â†’ previous Context (scope chain)   â”‚
â”‚  slot[1]  â†’ variable 'count' = 0             â”‚
â”‚  slot[2]  â†’ variable 'name' = "hello"        â”‚
â”‚  ...                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Algorithm: Variable Lookup = O(chain depth)**

Khi closure access biáº¿n, V8 traverses Context chain:

```
Lookup 'count':
  Current Context â†’ has 'count'? â†’ YES â†’ return slot[1]  â† O(1)

Lookup 'globalVar':
  Current Context â†’ has 'globalVar'? â†’ NO
  â†’ Parent Context â†’ has 'globalVar'? â†’ NO
  â†’ Global Context â†’ has 'globalVar'? â†’ YES â†’ return   â† O(3)
```

Worst case: `O(n)` where n = nesting depth. NhÆ°ng V8 optimize báº±ng **Context Slot Indexing**: táº¡i compile time, V8 tÃ­nh trÆ°á»›c biáº¿n náº±m á»Ÿ Context nÃ o, slot nÃ o â†’ lookup thá»±c táº¿ lÃ  `O(1)` vá»›i 2 pointer dereferences.

**Memory Impact:**

| Scenario                          | Memory                             | GC Behavior                  |
| --------------------------------- | ---------------------------------- | ---------------------------- |
| Function return, no closure       | Variable freed                     | GC ngay khi EC pop           |
| Closure giá»¯ 1 primitive           | ~32 bytes (Context + slot)         | GC khi closure = null        |
| Closure giá»¯ large object          | Object size + Context overhead     | GC chá»‰ khi closure destroyed |
| 10,000 closures trong loop        | 10,000 Ã— (Context + captured vars) | âš ï¸ Memory spike              |
| Closure capture `this` (arrow fn) | Extra slot for `this` reference    | GC khi arrow fn = null       |

**V8 Optimization â€” "Context Specialization":**

V8 KHÃ”NG giá»¯ toÃ n bá»™ outer scope â€” chá»‰ giá»¯ **biáº¿n thá»±c sá»± Ä‘Æ°á»£c reference**. VÃ­ dá»¥:

```javascript
function outer() {
  let used = 1; // â† captured bá»Ÿi closure
  let unused = 2; // â† KHÃ”NG captured â†’ eligible for GC
  let huge = new Array(1000000); // â† KHÃ”NG captured â†’ GC ngay

  return () => used; // V8 chá»‰ giá»¯ 'used' trong Context
}
// unused vÃ  huge Ä‘Æ°á»£c GC dÃ¹ outer EC "alive" qua closure
// âš ï¸ EXCEPTION: náº¿u closure chá»©a eval() â†’ V8 giá»¯ Táº¤T Cáº¢ biáº¿n
```

---

#### Pattern 3: PhÃ¢n TÃ­ch ÄÃ¡nh Äá»•i â€” Closure: Power vs Cost

---

**Closure táº¡o ra 4 Ä‘Ã¡nh Ä‘á»•i cá»‘t lÃµi:**

| Benefit                                     | Trade-off                          | Khi nÃ o cháº¥p nháº­n                 | Khi nÃ o trÃ¡nh                         |
| ------------------------------------------- | ---------------------------------- | --------------------------------- | ------------------------------------- |
| **Private state** (encapsulation)           | Memory retention                   | Module pattern, factory functions | Hot loops táº¡o 10K+ closures           |
| **Stateful functions** (counter, cache)     | GC bá»‹ block                        | Debounce, memoization             | Long-lived closures giá»¯ large objects |
| **Callback flexibility**                    | Stale closure bugs                 | Event handlers, promises          | React effects khÃ´ng cleanup           |
| **Functional composition** (curry, partial) | Stack depth + debugging difficulty | Utility libraries, middleware     | Performance-critical paths            |

**Ká»‹ch báº£n Closure tháº¥t báº¡i hoÃ n toÃ n:**

**1. Stale Closure trong React:**

```javascript
function Counter() {
  const [count, setCount] = useState(0);

  useEffect(() => {
    const id = setInterval(() => {
      // âŒ STALE CLOSURE!
      // Closure capture count = 0 táº¡i thá»i Ä‘iá»ƒm táº¡o
      // Má»i láº§n cháº¡y Ä‘á»u tháº¥y count = 0
      console.log(count); // luÃ´n in 0!
      setCount(count + 1); // luÃ´n set 1!
    }, 1000);
    return () => clearInterval(id);
  }, []); // [] = closure táº¡o 1 láº§n, khÃ´ng update
}

// âœ… FIX: dÃ¹ng functional updater
setCount((prev) => prev + 1); // khÃ´ng dÃ¹ng closure value
```

**2. Closure Memory Leak â€” Classic Example:**

```javascript
function setupHandlers() {
  const hugeData = new Array(1000000).fill("x"); // 1MB

  document.getElementById("btn").addEventListener("click", () => {
    // Closure giá»¯ hugeData alive MÃƒI MÃƒI
    // DÃ¹ click handler chá»‰ dÃ¹ng hugeData.length
    console.log(hugeData.length);
  });
  // âŒ hugeData 1MB KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c GC
  // VÃ¬ event listener tá»“n táº¡i suá»‘t page lifetime

  // âœ… FIX: extract giÃ¡ trá»‹ cáº§n, khÃ´ng giá»¯ reference
  const len = hugeData.length;
  document.getElementById("btn").addEventListener("click", () => {
    console.log(len); // Chá»‰ giá»¯ number, khÃ´ng giá»¯ array
  });
}
```

**3. Closure trong Loop â€” Bug cá»• Ä‘iá»ƒn nháº¥t JavaScript:**

```javascript
// âŒ BUG: táº¥t cáº£ Ä‘á»u in 5
for (var i = 0; i < 5; i++) {
  setTimeout(() => console.log(i), 100);
} // Output: 5 5 5 5 5 (var = function scope, shared)

// âœ… FIX 1: dÃ¹ng let (block scope)
for (let i = 0; i < 5; i++) {
  setTimeout(() => console.log(i), 100);
} // Output: 0 1 2 3 4 (let = block scope, má»—i iteration cÃ³ i riÃªng)

// âœ… FIX 2: IIFE táº¡o closure riÃªng cho má»—i iteration
for (var i = 0; i < 5; i++) {
  (function (j) {
    setTimeout(() => console.log(j), 100);
  })(i);
} // Output: 0 1 2 3 4
```

**Closure vs Alternatives â€” So sÃ¡nh:**

| Approach              | Private State    | Memory         | Performance              | Readability     |
| --------------------- | ---------------- | -------------- | ------------------------ | --------------- |
| **Closure**           | âœ… Truly private | âš ï¸ Retained    | Good (V8 optimized)      | âš ï¸ Hidden state |
| **ES2022 `#private`** | âœ… Truly private | âœ… Normal GC   | âœ… Best (no scope chain) | âœ… Clear syntax |
| **`_convention`**     | âŒ Not enforced  | âœ… Normal GC   | âœ… Best                  | âœ… Clear        |
| **WeakMap**           | âœ… Truly private | âœ… GC-friendly | âš ï¸ Map lookup overhead   | âš ï¸ Verbose      |
| **Symbol**            | âš ï¸ Discoverable  | âœ… Normal GC   | âœ… Good                  | âš ï¸ Non-obvious  |

---

#### Pattern 4: Mental Mapping â€” Closure Trong Báº£n Äá»“ JavaScript

---

Closures khÃ´ng tá»“n táº¡i cÃ´ láº­p â€” chÃºng káº¿t ná»‘i **má»i thá»©** trong JavaScript. ÄÃ¢y lÃ  báº£n Ä‘á»“:

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚         MODULE SYSTEM             â”‚
                    â”‚  CommonJS, ES Modules, Webpack    â”‚
                    â”‚  All wrap code in closures        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ wraps with
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚           CLOSURES                â”‚
                    â”‚  Function + Lexical Environment   â”‚
                    â””â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚    â”‚    â”‚    â”‚    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                 â–¼    â”‚    â–¼                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ SCOPE CHAIN â”‚  â”‚EXECUTION â”‚ â”‚ â”‚  GARBAGE   â”‚  â”‚   REACT      â”‚
   â”‚ Lexical     â”‚  â”‚ CONTEXT  â”‚ â”‚ â”‚ COLLECTION â”‚  â”‚   HOOKS      â”‚
   â”‚ lookup path â”‚  â”‚ EC + [[  â”‚ â”‚ â”‚ GC blocked â”‚  â”‚  useState    â”‚
   â”‚ for vars    â”‚  â”‚ scope]]  â”‚ â”‚ â”‚ by closure â”‚  â”‚  useEffect   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ references â”‚  â”‚  useCallback â”‚
                                 â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”Œâ”€â”€â”€â”€â”€â”€â”˜
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚   HOISTING  â”‚
                   â”‚ var hoisted â”‚
                   â”‚ let in TDZ  â”‚
                   â”‚ affects     â”‚
                   â”‚ closure     â”‚
                   â”‚ behavior    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Closure trong V8 Engine Pipeline:**

```
Source Code          Parse           Scope Analysis      Bytecode
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â–º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â–º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â–º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"function    "    AST nodes        Identify which       CreateClosure
outer()..."       with scope       vars are captured    bytecode
                  annotations      â†’ mark as "context   instruction
                                   allocated" (heap)
                                   vs "stack allocated"

  â”Œâ”€â”€â”€ NON-CAPTURED var â”€â”€â”€ stack slot â”€â”€â”€â”€ fast, dies with EC
  â”‚
  â””â”€â”€â”€ CAPTURED var â”€â”€â”€â”€â”€â”€â”€â”€ Context object â”€â”€ heap, lives with closure
```

Äiá»ƒm quan trá»ng: V8 quyáº¿t Ä‘á»‹nh **táº¡i compile time** biáº¿n nÃ o cáº§n heap-allocate (captured) vs stack-allocate (non-captured). ÄÃ¢y lÃ  lÃ½ do `eval()` phÃ¡ há»ng optimization â€” V8 khÃ´ng biáº¿t `eval` sáº½ reference biáº¿n nÃ o â†’ buá»™c pháº£i heap-allocate táº¥t cáº£.

---

#### Pattern 5: Reverse Engineering â€” Tá»± Tay XÃ¢y Closure Engine

---

_"What I cannot create, I do not understand."_ â€” Richard Feynman

HÃ£y xÃ¢y dá»±ng má»™t **closure engine Ä‘Æ¡n giáº£n** báº±ng JavaScript thuáº§n Ä‘á»ƒ hiá»ƒu chÃ­nh xÃ¡c engine lÃ m gÃ¬:

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOSURE ENGINE â€” MÃ´ phá»ng cÃ¡ch V8 implement closures
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Environment {
  constructor(parent = null) {
    this.vars = new Map(); // Variable storage
    this.parent = parent; // Scope chain link
  }

  // Khai bÃ¡o biáº¿n trong current environment
  define(name, value) {
    this.vars.set(name, value);
    return value;
  }

  // TÃ¬m biáº¿n theo scope chain (closure lookup!)
  lookup(name) {
    if (this.vars.has(name)) {
      return this.vars.get(name);
    }
    if (this.parent) {
      return this.parent.lookup(name); // â† scope chain traversal!
    }
    throw new ReferenceError(`${name} is not defined`);
  }

  // Cáº­p nháº­t biáº¿n (tÃ¬m theo scope chain, update in-place)
  update(name, value) {
    if (this.vars.has(name)) {
      this.vars.set(name, value);
      return value;
    }
    if (this.parent) {
      return this.parent.update(name, value);
    }
    throw new ReferenceError(`${name} is not defined`);
  }
}

class ClosureFunction {
  constructor(name, params, body, capturedEnv) {
    this.name = name;
    this.params = params;
    this.body = body;
    // â† THIS IS THE CLOSURE: giá»¯ reference Ä‘áº¿n environment!
    this.capturedEnv = capturedEnv; // [[Scope]] internal slot
  }

  // Gá»i closure function
  call(...args) {
    // 1. Táº¡o NEW environment, chain vÃ o capturedEnv (NOT caller env!)
    //    ÄÃ¢y lÃ  lexical scope, khÃ´ng pháº£i dynamic scope!
    const localEnv = new Environment(this.capturedEnv);

    // 2. Bind parameters
    this.params.forEach((param, i) => {
      localEnv.define(param, args[i]);
    });

    // 3. Execute body trong local environment
    return this.body(localEnv);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEMO: MÃ´ phá»ng createCounter closure
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Global environment
const globalEnv = new Environment();

// function createCounter() { let count = 0; return () => ++count; }
const createCounter = new ClosureFunction(
  "createCounter",
  [], // no params
  (env) => {
    // let count = 0
    env.define("count", 0);

    // return () => ++count
    // Inner function CAPTURES env (which contains count)
    return new ClosureFunction(
      "increment",
      [],
      (innerEnv) => {
        // ++count â†’ lookup 'count' theo scope chain
        // innerEnv â†’ khÃ´ng cÃ³ count
        // innerEnv.parent (env) â†’ CÃ“ count! â†’ update
        const current = innerEnv.lookup("count");
        innerEnv.update("count", current + 1);
        return innerEnv.lookup("count");
      },
      env, // â† CLOSURE: inner function captures outer environment!
    );
  },
  globalEnv,
);

// const counter1 = createCounter();
const counter1 = createCounter.call();

// const counter2 = createCounter();
const counter2 = createCounter.call();

console.log(counter1.call()); // 1 â€” counter1 has its OWN count
console.log(counter1.call()); // 2
console.log(counter2.call()); // 1 â€” counter2 has SEPARATE count!
console.log(counter1.call()); // 3 â€” counter1 continues from 2

// âœ… Má»—i createCounter.call() táº¡o Environment Má»šI
// âœ… Má»—i returned increment closure captures Environment RIÃŠNG
// âœ… CÃ¡c closures KHÃ”NG share biáº¿n count!
```

**Quan sÃ¡t quan trá»ng tá»« engine simulation:**

1. **Closure = Function + Captured Environment** â€” ClosureFunction lÆ°u `capturedEnv` reference, khÃ´ng copy
2. **Lexical, not Dynamic** â€” `call()` táº¡o new Environment chain vÃ o `capturedEnv` (nÆ¡i function **defined**), khÃ´ng chain vÃ o caller's environment
3. **Independent instances** â€” Má»—i láº§n gá»i `createCounter()` táº¡o **Environment object má»›i** â†’ má»—i counter cÃ³ `count` riÃªng
4. **GC connection** â€” Environment object sá»‘ng miá»…n lÃ  ClosureFunction cÃ²n reference nÃ³. Set `counter1 = null` â†’ Environment eligible for GC

**BÃ i táº­p má»Ÿ rá»™ng:**

- [ ] ThÃªm `delete(name)` Ä‘á»ƒ simulate giáº£i phÃ³ng closure variable
- [ ] ThÃªm `inspect()` Ä‘á»ƒ in toÃ n bá»™ scope chain (giá»‘ng DevTools Scope panel)
- [ ] Implement `eval()` support â€” táº¡i sao nÃ³ phÃ¡ há»ng optimization?
- [ ] ThÃªm `WeakRef` support cho Environment â†’ simulate V8 context specialization

---

#### Pattern 6: Lá»‹ch Sá»­ & Sá»± Tiáº¿n HÃ³a â€” Closures: Tá»« Lambda Calculus Äáº¿n React Hooks

---

Closures khÃ´ng pháº£i phÃ¡t minh cá»§a JavaScript. ChÃºng cÃ³ lá»‹ch sá»­ **60+ nÄƒm** â€” vÃ  hiá»ƒu lá»‹ch sá»­ giáº£i thÃ­ch táº¡i sao closures thiáº¿t káº¿ nhÆ° váº­y.

**Timeline:**

```
1936 â”€â”€ Lambda Calculus (Alonzo Church)
â”‚        Ná»n táº£ng toÃ¡n há»c: functions as values, variable binding
â”‚        Concept "free variables" â†’ seed of closures
â”‚
1958 â”€â”€ Lisp (John McCarthy)
â”‚        First language with first-class functions
â”‚        DÃ¹ng DYNAMIC scope â†’ closures behave differently!
â”‚        Bug: function tráº£ vá» function â†’ biáº¿n resolve sai context
â”‚
1964 â”€â”€ Peter Landin coins "CLOSURE"
â”‚        Paper: "The Mechanical Evaluation of Expressions"
â”‚        Äá»‹nh nghÄ©a formal: closure = Î»-expression + environment
â”‚        Giáº£i quyáº¿t "funarg problem" (upward/downward)
â”‚
1970 â”€â”€ Scheme (Steele & Sussman)
â”‚        First language with LEXICAL closures
â”‚        Chá»©ng minh closures + lexical scope = powerful foundation
â”‚        áº¢nh hÆ°á»Ÿng trá»±c tiáº¿p lÃªn JavaScript 25 nÄƒm sau
â”‚
1995 â”€â”€ JavaScript (Brendan Eich)
â”‚        Eich láº¥y cáº£m há»©ng tá»« Scheme â†’ closures built-in
â”‚        JS = C syntax + Scheme semantics + Self prototypes
â”‚        Closures = cÃ¡ch DUY NHáº¤T táº¡o private vars
â”‚
2009 â”€â”€ Node.js
â”‚        Closures trá»Ÿ thÃ nh CORE pattern cho async programming
â”‚        Callback hell = closures lá»“ng quÃ¡ nhiá»u táº§ng
â”‚        â†’ Promises (2012) â†’ async/await (2017) giáº£m closure nesting
â”‚
2015 â”€â”€ ES6 let/const + Modules
â”‚        Block scope giáº£m nhu cáº§u IIFE closures
â”‚        Native modules giáº£m nhu cáº§u Module Pattern closures
â”‚        NhÆ°ng closures váº«n essential cho callbacks & state
â”‚
2019 â”€â”€ React Hooks
â”‚        useState, useEffect, useCallback = closures everywhere
â”‚        "Stale closure" trá»Ÿ thÃ nh bug PHá»” BIáº¾N NHáº¤T React
â”‚        Cáº§n hiá»ƒu closure sÃ¢u Ä‘á»ƒ debug React hooks
â”‚
2022 â”€â”€ ES2022 #private fields
â”‚        Class private fields: class { #secret = 42; }
â”‚        Láº§n Ä‘áº§u tiÃªn JS cÃ³ "true private" KHÃ”NG Cáº¦N closure
â”‚        Closures váº«n cáº§n cho functional patterns, hooks, callbacks
â”‚
2024+ â”€â”€ Signals, Fine-grained Reactivity
         Solid.js, Angular Signals, Vue Composition API
         Closures váº«n lÃ  ná»n táº£ng state management
         NhÆ°ng reactive primitives giáº£m stale closure bugs
```

**"Funarg Problem" â€” BÃ i ToÃ¡n Gá»‘c MÃ  Closures Giáº£i Quyáº¿t:**

TrÆ°á»›c closures, ngÃ´n ngá»¯ láº­p trÃ¬nh gáº·p "funarg problem" (functional argument problem):

- **Downward funarg**: Truyá»n function lÃ m argument â†’ function cáº§n access biáº¿n cá»§a caller. Dynamic scope giáº£i quyáº¿t Ä‘Æ°á»£c nhÆ°ng **unpredictable**.
- **Upward funarg**: Return function ra ngoÃ i â†’ function cáº§n access biáº¿n cá»§a **creator Ä‘Ã£ káº¿t thÃºc**. Dynamic scope **KHÃ”NG giáº£i quyáº¿t Ä‘Æ°á»£c** â€” biáº¿n Ä‘Ã£ bá»‹ destroy!

Closures vá»›i lexical scope giáº£i quyáº¿t **cáº£ hai** báº±ng cÃ¡ch giá»¯ environment alive. ÄÃ¢y lÃ  breakthrough lÃ½ thuyáº¿t tá»« Peter Landin (1964) mÃ  áº£nh hÆ°á»Ÿng má»i ngÃ´n ngá»¯ hiá»‡n Ä‘áº¡i.

**Táº¡i sao React Hooks re-introduce closure problems?**

Irony: closures Ä‘Æ°á»£c phÃ¡t minh Ä‘á»ƒ **giáº£i quyáº¿t** bugs (funarg problem), nhÆ°ng 55 nÄƒm sau, React Hooks dÃ¹ng closures theo cÃ¡ch **táº¡o ra** bugs má»›i (stale closures). NguyÃªn nhÃ¢n: React re-render = táº¡o closures má»›i má»—i render cycle, nhÆ°ng `useEffect` dependencies array quyáº¿t Ä‘á»‹nh closure NÃ€O Ä‘Æ°á»£c update. Miss dependency â†’ stale closure â†’ bug.

```javascript
// Sá»± tiáº¿n hÃ³a cá»§a "private state" trong JavaScript:

// 1995-2015: Closure (cÃ¡ch duy nháº¥t)
const counter1 = (() => {
  let count = 0;
  return { inc: () => ++count, get: () => count };
})();

// 2015+: WeakMap (alternative)
const _state = new WeakMap();
class Counter2 {
  constructor() {
    _state.set(this, { count: 0 });
  }
  inc() {
    _state.get(this).count++;
  }
  get() {
    return _state.get(this).count;
  }
}

// 2022+: Private fields (native)
class Counter3 {
  #count = 0;
  inc() {
    this.#count++;
  }
  get() {
    return this.#count;
  }
}

// Closures váº«n KHÃ”NG THá»‚ thay tháº¿ cho:
// - Functional patterns (curry, partial, compose)
// - Callback-based APIs (event handlers, promises)
// - React Hooks (useState IS a closure)
```

---

### ğŸ”¬ Advanced Closure Patterns â€” á»¨ng Dá»¥ng NÃ¢ng Cao Trong Production

**BÃ i viáº¿t â€” 6 Patterns NÃ¢ng Cao: Tá»« Junior Code Äáº¿n Senior Architecture**

Closures khÃ´ng chá»‰ dÃ¹ng cho private variables vÃ  event handlers. á» level senior, closures lÃ  building block cho **thiáº¿t káº¿ kiáº¿n trÃºc** â€” tá»« function composition Ä‘áº¿n state machines. DÆ°á»›i Ä‘Ã¢y lÃ  6 patterns mÃ  senior engineers sá»­ dá»¥ng hÃ ng ngÃ y.

---

#### Pattern A: Currying â€” Biáº¿n Multi-Argument ThÃ nh Chuá»—i Single-Argument

**BÃ i viáº¿t â€” Currying: Táº¡i Sao Lodash, Ramda, vÃ  Functional Libraries Äá»u DÃ¹ng?**

Currying lÃ  ká»¹ thuáº­t biáº¿n `f(a, b, c)` thÃ nh `f(a)(b)(c)`. á» bá» máº·t, nÃ³ trÃ´ng vÃ´ nghÄ©a â€” táº¡i sao gá»i 3 láº§n thay vÃ¬ 1? NhÆ°ng power tháº­t sá»± náº±m á»Ÿ **partial application**: báº¡n cÃ³ thá»ƒ "fix" má»™t sá»‘ arguments trÆ°á»›c, táº¡o ra specialized functions mÃ  khÃ´ng cáº§n viáº¿t code má»›i.

Currying = closures chá»“ng lÃªn nhau: má»—i láº§n gá»i táº¡o má»™t closure má»›i, "nhá»›" argument vá»«a nháº­n, tráº£ vá» function chá» argument tiáº¿p theo.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CURRYING â€” Closure táº¡o chuá»—i specialized functions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Manual currying
function curry_add(a) {
  return function (b) {
    // Closure 1: "nhá»›" a
    return function (c) {
      // Closure 2: "nhá»›" a VÃ€ b
      return a + b + c; // Access cáº£ 3 qua scope chain
    };
  };
}

curry_add(1)(2)(3); // 6
const add5 = curry_add(2)(3); // Partial application: "nhá»›" a=2, b=3
add5(10); // 15 â€” chá»‰ cáº§n cung cáº¥p c

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Generic curry helper (production-grade)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function curry(fn) {
  return function curried(...args) {
    if (args.length >= fn.length) {
      return fn.apply(this, args);
    }
    // Closure "nhá»›" args hiá»‡n táº¡i, chá» args tiáº¿p theo
    return function (...nextArgs) {
      return curried.apply(this, [...args, ...nextArgs]);
    };
  };
}

// Use case: API request builder
const request = curry((method, url, data) =>
  fetch(url, { method, body: JSON.stringify(data) }),
);

const post = request("POST"); // Closure: method = 'POST'
const postToAPI = post("/api/users"); // Closure: method + url fixed
postToAPI({ name: "Alice" }); // Chá»‰ cáº§n data

// Use case: Logger vá»›i context
const log = curry((level, module, message) =>
  console.log(`[${level}] [${module}] ${message}`),
);

const errorLog = log("ERROR"); // Closure: level fixed
const authError = errorLog("Auth"); // Closure: level + module fixed
authError("Invalid token"); // [ERROR] [Auth] Invalid token
authError("Session expired"); // [ERROR] [Auth] Session expired
```

```
CURRYING â€” CLOSURE CHAIN:

curry_add(1)         â†’ Closure { a: 1, return fn(b) }
curry_add(1)(2)      â†’ Closure { a: 1, b: 2, return fn(c) }
curry_add(1)(2)(3)   â†’ Evaluate: 1 + 2 + 3 = 6

Memory: má»—i partial application = 1 closure object
        N arguments = N-1 closure objects chá»“ng nhau
        GC: khi final function hoáº·c partial function = null
```

---

#### Pattern B: Memoization â€” Closure LÃ m Cache Engine

**BÃ i viáº¿t â€” Memoization: Cache Káº¿t Quáº£ Expensive Computations**

Memoization dÃ¹ng closure Ä‘á»ƒ "nhá»›" káº¿t quáº£ Ä‘Ã£ tÃ­nh trÆ°á»›c Ä‘Ã³. Thay vÃ¬ tÃ­nh láº¡i má»—i láº§n gá»i, function kiá»ƒm tra cache (lÆ°u trong closure) trÆ°á»›c â€” náº¿u Ä‘Ã£ tÃ­nh rá»“i thÃ¬ tráº£ vá» ngay. Pattern nÃ y biáº¿n `O(2^n)` recursive Fibonacci thÃ nh `O(n)`, vÃ  Ä‘Æ°á»£c React dÃ¹ng trong `useMemo` vÃ  `React.memo`.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEMOIZATION â€” Closure giá»¯ cache giá»¯a cÃ¡c láº§n gá»i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Basic memoize
function memoize(fn) {
  const cache = new Map(); // â† Closure giá»¯ cache ALIVE mÃ£i mÃ£i

  return function (...args) {
    const key = JSON.stringify(args);

    if (cache.has(key)) {
      console.log("Cache HIT:", key);
      return cache.get(key); // O(1) lookup
    }

    console.log("Cache MISS:", key);
    const result = fn.apply(this, args);
    cache.set(key, result); // Store trong closure cache
    return result;
  };
}

// Fibonacci: O(2^n) â†’ O(n) nhá» memoization
const fib = memoize(function (n) {
  if (n <= 1) return n;
  return fib(n - 1) + fib(n - 2);
});

fib(50); // TÃ­nh tá»©c thÃ¬ thay vÃ¬ hÃ ng tá»· nÄƒm!

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Production memoize vá»›i LRU cache (giá»›i háº¡n memory)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function memoizeWithLimit(fn, maxSize = 100) {
  const cache = new Map(); // Closure: LRU cache

  return function (...args) {
    const key = JSON.stringify(args);

    if (cache.has(key)) {
      // LRU: move to end (most recently used)
      const value = cache.get(key);
      cache.delete(key);
      cache.set(key, value);
      return value;
    }

    const result = fn.apply(this, args);
    cache.set(key, result);

    // Evict oldest entry if over limit
    if (cache.size > maxSize) {
      const oldestKey = cache.keys().next().value;
      cache.delete(oldestKey); // â† Giáº£i phÃ³ng memory
    }

    return result;
  };
}

// React's useMemo: closure-based memoization
// function useMemo(factory, deps) {
//   const [prevDeps, prevValue] = useRef([]);  // Closure giá»¯ prev
//   if (!shallowEqual(deps, prevDeps)) {
//     prevValue = factory();  // Re-compute
//     prevDeps = deps;
//   }
//   return prevValue;  // Return cached
// }
```

```
MEMOIZE â€” CLOSURE AS CACHE:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  memoize(expensiveFn) returns:              â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Closure:                              â”‚ â”‚
â”‚  â”‚    cache = Map {                       â”‚ â”‚
â”‚  â”‚      "[1,2]" â†’ 3,                     â”‚ â”‚
â”‚  â”‚      "[5,10]" â†’ 15,                   â”‚ â”‚
â”‚  â”‚      "[100]" â†’ 5050                   â”‚ â”‚
â”‚  â”‚    }                                   â”‚ â”‚
â”‚  â”‚    fn = reference to expensiveFn       â”‚ â”‚
â”‚  â”‚                                        â”‚ â”‚
â”‚  â”‚  On call: check cache â†’ hit? return    â”‚ â”‚
â”‚  â”‚           miss? compute â†’ store â†’ ret  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                             â”‚
â”‚  âš ï¸ Memory: cache grows forever without     â”‚
â”‚     LRU limit! Use memoizeWithLimit         â”‚
â”‚     or WeakMap for object keys              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### Pattern C: Compose & Pipe â€” Closure XÃ¢y Dá»±ng Data Pipeline

**BÃ i viáº¿t â€” Function Composition: Lego Blocks Cho Logic**

Compose/Pipe cho phÃ©p ghÃ©p nhiá»u functions nhá» thÃ nh má»™t pipeline â€” má»—i function nháº­n output cá»§a function trÆ°á»›c lÃ m input. Pattern nÃ y lÃ  foundation cá»§a Redux middleware, Express middleware, vÃ  RxJS operators.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPOSE â€” Right-to-left function composition
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function compose(...fns) {
  // Closure "nhá»›" danh sÃ¡ch functions
  return function (x) {
    // Cháº¡y tá»« pháº£i sang trÃ¡i: f(g(h(x)))
    return fns.reduceRight((acc, fn) => fn(acc), x);
  };
}

// PIPE â€” Left-to-right (Ä‘á»c tá»± nhiÃªn hÆ¡n)
function pipe(...fns) {
  // Closure "nhá»›" danh sÃ¡ch functions
  return function (x) {
    // Cháº¡y tá»« trÃ¡i sang pháº£i: h(g(f(x)))
    return fns.reduce((acc, fn) => fn(acc), x);
  };
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Use case: Data transformation pipeline
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const trim = (s) => s.trim();
const toLowerCase = (s) => s.toLowerCase();
const replaceSpaces = (s) => s.replace(/\s+/g, "-");
const addPrefix = (prefix) => (s) => `${prefix}${s}`; // Curried closure!

// Compose: read right-to-left
const createSlug_v1 = compose(
  addPrefix("/blog/"), // 4. ThÃªm prefix â†’ Closure giá»¯ prefix
  replaceSpaces, // 3. Thay spaces
  toLowerCase, // 2. Lowercase
  trim, // 1. Trim (cháº¡y Ä‘áº§u tiÃªn)
);

// Pipe: read left-to-right  (thÆ°á»ng dÃ¹ng hÆ¡n)
const createSlug = pipe(
  trim, // 1. Trim
  toLowerCase, // 2. Lowercase
  replaceSpaces, // 3. Thay spaces
  addPrefix("/blog/"), // 4. ThÃªm prefix
);

createSlug("  Hello World  "); // "/blog/hello-world"

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Use case: Redux middleware IS compose + closure
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Redux applyMiddleware â€” simplified
function applyMiddleware(...middlewares) {
  return (createStore) => (reducer) => {
    const store = createStore(reducer);

    // Má»—i middleware lÃ  closure truy cáº­p store
    const chain = middlewares.map((mw) =>
      mw({
        getState: store.getState,
        dispatch: store.dispatch,
      }),
    );

    // compose: middleware1(middleware2(middleware3(dispatch)))
    const dispatch = compose(...chain)(store.dispatch);

    return { ...store, dispatch };
  };
}
```

---

#### Pattern D: Partial Application â€” "Cáº¥u HÃ¬nh TrÆ°á»›c" Functions

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PARTIAL APPLICATION â€” Fix má»™t sá»‘ args, chá» cÃ²n láº¡i
// KhÃ¡c currying: partial cho phÃ©p fix NHIá»€U args cÃ¹ng lÃºc
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function partial(fn, ...presetArgs) {
  // Closure "nhá»›" preset arguments
  return function (...laterArgs) {
    return fn(...presetArgs, ...laterArgs);
  };
}

// Use case: Configurated loggers
function logMessage(level, timestamp, module, message) {
  console.log(`[${timestamp}] [${level}] [${module}] ${message}`);
}

const errorLog = partial(logMessage, "ERROR");
const errorNow = partial(logMessage, "ERROR", new Date().toISOString());
const authErrorNow = partial(
  logMessage,
  "ERROR",
  new Date().toISOString(),
  "Auth",
);

authErrorNow("Invalid token");
// [2024-01-15T10:30:00.000Z] [ERROR] [Auth] Invalid token

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Use case: Event handler factories
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function handleClick(analyticsId, element, event) {
  analytics.track(analyticsId);
  element.classList.toggle("active");
}

// Partial: fix analyticsId cho má»—i button
document.querySelectorAll(".btn").forEach((btn) => {
  const handler = partial(handleClick, btn.dataset.trackId, btn);
  // Closure giá»¯ analyticsId + element reference
  btn.addEventListener("click", handler);
});
```

---

#### Pattern E: State Machines â€” Closure Quáº£n LÃ½ Tráº¡ng ThÃ¡i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE MACHINE â€” Closure giá»¯ current state + transitions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createStateMachine(config) {
  let currentState = config.initial; // â† Closure giá»¯ state
  const states = config.states; // â† Closure giá»¯ config
  const listeners = []; // â† Closure giá»¯ subscribers

  return {
    getState() {
      return currentState;
    },

    send(event) {
      const stateConfig = states[currentState];
      if (!stateConfig || !stateConfig.on || !stateConfig.on[event]) {
        console.warn(`No transition for "${event}" in state "${currentState}"`);
        return currentState;
      }

      const prevState = currentState;
      currentState = stateConfig.on[event];

      // Notify listeners (closure giá»¯ listeners array alive)
      listeners.forEach((fn) =>
        fn({ from: prevState, to: currentState, event }),
      );

      return currentState;
    },

    subscribe(fn) {
      listeners.push(fn);
      // Return unsubscribe closure
      return () => {
        const idx = listeners.indexOf(fn);
        if (idx > -1) listeners.splice(idx, 1);
      };
    },
  };
}

// Use case: Form submission flow
const formMachine = createStateMachine({
  initial: "idle",
  states: {
    idle: { on: { SUBMIT: "validating" } },
    validating: { on: { VALID: "submitting", INVALID: "error" } },
    submitting: { on: { SUCCESS: "success", FAILURE: "error" } },
    success: { on: { RESET: "idle" } },
    error: { on: { RETRY: "validating", RESET: "idle" } },
  },
});

// Closure giá»¯ subscription alive
const unsub = formMachine.subscribe(({ from, to, event }) => {
  console.log(`${from} --[${event}]--> ${to}`);
});

formMachine.send("SUBMIT"); // idle --[SUBMIT]--> validating
formMachine.send("VALID"); // validating --[VALID]--> submitting
formMachine.send("SUCCESS"); // submitting --[SUCCESS]--> success

unsub(); // Cleanup: giáº£i phÃ³ng closure reference
```

---

#### Pattern F: Lazy Evaluation â€” Closure TrÃ¬ HoÃ£n TÃ­nh ToÃ¡n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LAZY EVALUATION â€” Closure giá»¯ computation chÆ°a cháº¡y
// Chá»‰ tÃ­nh khi thá»±c sá»± cáº§n giÃ¡ trá»‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function lazy(fn) {
  let computed = false; // â† Closure: Ä‘Ã£ tÃ­nh chÆ°a?
  let result; // â† Closure: káº¿t quáº£ cached

  return function () {
    if (!computed) {
      result = fn(); // TÃ­nh toÃ¡n láº§n Ä‘áº§u
      computed = true;
      fn = null; // â† Giáº£i phÃ³ng reference Ä‘áº¿n fn gá»‘c!
    }
    return result;
  };
}

// Use case: Expensive initialization
const getConfig = lazy(() => {
  console.log("Loading config..."); // Chá»‰ cháº¡y 1 láº§n
  return {
    apiUrl: process.env.API_URL,
    features: JSON.parse(fs.readFileSync("features.json")),
    i18n: loadTranslations(),
  };
});

// Config chÆ°a load â€” zero cost
// ...nhiá»u code khÃ¡c...
// Khi thá»±c sá»± cáº§n:
const config = getConfig(); // "Loading config..." (láº§n Ä‘áº§u)
const config2 = getConfig(); // Tráº£ vá» cached, khÃ´ng log

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Lazy vá»›i reset (closure + closure)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function lazyWithReset(fn) {
  let computed = false;
  let result;

  const getValue = () => {
    if (!computed) {
      result = fn();
      computed = true;
    }
    return result;
  };

  getValue.reset = () => {
    computed = false;
    result = undefined;
  };

  return getValue;
}
```

---

### ğŸ¯ Interview Deep-Dive â€” 10 CÃ¢u Há»i Closure Hay Gáº·p Nháº¥t

**BÃ i viáº¿t â€” Closure Trong Phá»ng Váº¥n: Tá»« Junior Äáº¿n Senior Level**

Closures xuáº¥t hiá»‡n trong **má»i cuá»™c phá»ng váº¥n JavaScript** â€” tá»« intern Ä‘áº¿n principal engineer. DÆ°á»›i Ä‘Ã¢y lÃ  10 cÃ¢u há»i phá»• biáº¿n nháº¥t, xáº¿p theo Ä‘á»™ khÃ³, vá»›i phÃ¢n tÃ­ch chi tiáº¿t.

---

**Q1 (Junior): Output lÃ  gÃ¬? Táº¡i sao?**

```javascript
function outer() {
  let count = 0;
  return function () {
    return ++count;
  };
}

const fn1 = outer();
const fn2 = outer();

console.log(fn1()); // ??
console.log(fn1()); // ??
console.log(fn2()); // ??
```

> **Answer**: `1, 2, 1`
>
> `fn1` vÃ  `fn2` Ä‘Æ°á»£c táº¡o tá»« 2 láº§n gá»i `outer()` khÃ¡c nhau â†’ má»—i láº§n táº¡o **Environment object riÃªng** vá»›i `count` riÃªng. `fn1` tÄƒng count cá»§a nÃ³ (1â†’2), `fn2` tÄƒng count cá»§a nÃ³ (0â†’1). Hai closures **KHÃ”NG share** biáº¿n.

---

**Q2 (Junior): Classic loop bug â€” output lÃ  gÃ¬?**

```javascript
for (var i = 0; i < 3; i++) {
  setTimeout(() => console.log(i), 100);
}
```

> **Answer**: `3, 3, 3`
>
> `var` = function scope â†’ chá»‰ cÃ³ **1 biáº¿n `i`** shared bá»Ÿi cáº£ 3 closures. Khi setTimeout cháº¡y, loop Ä‘Ã£ káº¿t thÃºc â†’ `i = 3`. Closure "nhá»›" **reference** Ä‘áº¿n `i`, khÃ´ng pháº£i giÃ¡ trá»‹ táº¡i thá»i Ä‘iá»ƒm táº¡o.
>
> **Fix**: `let i` (block scope â†’ má»—i iteration cÃ³ `i` riÃªng) hoáº·c IIFE closure.

---

**Q3 (Mid): Closure cÃ³ táº¡o khÃ´ng?**

```javascript
function foo() {
  let x = 10;
  function bar() {
    console.log("hello"); // KhÃ´ng dÃ¹ng x!
  }
  return bar;
}
```

> **Answer**: **Technically NO** â€” `bar` khÃ´ng reference biáº¿n nÃ o tá»« `foo`. V8 sáº½ **khÃ´ng** giá»¯ `x` alive â†’ khÃ´ng táº¡o closure context. Tuy nhiÃªn, spec nÃ³i má»i function Ä‘á»u cÃ³ `[[Environment]]` â€” nÃªn "má»i function Ä‘á»u lÃ  closure" theo nghÄ©a rá»™ng. Trong interview, há»i rÃµ: "Closure theo nghÄ©a practical (captured variables) hay spec (lexical environment reference)?"

---

**Q4 (Mid): Output? Module pattern + closure interaction**

```javascript
const counter = (function () {
  let count = 0;
  return {
    increment() {
      count++;
    },
    decrement() {
      count--;
    },
    getCount() {
      return count;
    },
  };
})();

counter.increment();
counter.increment();
counter.decrement();
console.log(counter.getCount()); // ??
console.log(counter.count); // ??
```

> **Answer**: `1`, `undefined`
>
> `increment`, `decrement`, `getCount` â€” cáº£ 3 functions share **CÃ™NG Má»˜T** closure environment (cÃ¹ng táº¡o tá»« 1 IIFE call). ChÃºng access cÃ¹ng biáº¿n `count`. NhÆ°ng `counter.count` = `undefined` vÃ¬ `count` lÃ  local variable trong IIFE, khÃ´ng pháº£i property cá»§a returned object.

---

**Q5 (Mid-Senior): setTimeout + closure + async**

```javascript
function createFunctions() {
  const result = [];
  for (let i = 0; i < 3; i++) {
    result.push(function () {
      return i;
    });
  }
  return result;
}

const fns = createFunctions();
console.log(fns[0]()); // ??
console.log(fns[1]()); // ??
console.log(fns[2]()); // ??
```

> **Answer**: `0, 1, 2` â€” VÃ¬ dÃ¹ng `let` (block scope)! Má»—i iteration táº¡o **binding `i` riÃªng** â†’ má»—i closure capture `i` riÃªng. Náº¿u Ä‘á»•i thÃ nh `var` â†’ output thÃ nh `3, 3, 3`.

---

**Q6 (Senior): Closure + `this` interaction**

```javascript
const obj = {
  value: 42,
  getValue: function () {
    return () => this.value; // Arrow function
  },
  getValueRegular: function () {
    return function () {
      return this.value;
    }; // Regular function
  },
};

const arrowFn = obj.getValue();
const regularFn = obj.getValueRegular();

console.log(arrowFn()); // ??
console.log(regularFn()); // ??
```

> **Answer**: `42`, `undefined`
>
> Arrow function **captures `this`** tá»« lexical scope (do closure) â†’ `this` = `obj` mÃ£i mÃ£i. Regular function cÃ³ `this` = caller context â†’ gá»i `regularFn()` standalone â†’ `this` = `undefined` (strict) hoáº·c `window` (sloppy) â†’ `this.value` = `undefined`.

---

**Q7 (Senior): Memory leak detection**

```javascript
function createHandler() {
  const hugeArray = new Array(1_000_000).fill("x");
  const smallValue = hugeArray.length;

  return {
    getLength() {
      return smallValue;
    },
    // Developer quÃªn: getData váº«n giá»¯ hugeArray alive!
    getData() {
      return hugeArray;
    },
  };
}

const handler = createHandler();
// Q: hugeArray cÃ³ bá»‹ GC khÃ´ng?
// Q: Náº¿u chá»‰ cáº§n getLength, lÃ m sao tá»‘i Æ°u memory?
```

> **Answer**: `hugeArray` **KHÃ”NG bá»‹ GC** vÃ¬ `getData` closure váº«n reference nÃ³. DÃ¹ báº¡n chá»‰ dÃ¹ng `getLength`, closure environment giá»¯ **táº¥t cáº£** captured variables alive.
>
> **Fix 1**: XÃ³a `getData` náº¿u khÃ´ng cáº§n. **Fix 2**: TÃ¡ch thÃ nh 2 closures riÃªng. **Fix 3**: Set `handler.getData = null` sau khi dÃ¹ng xong.

---

**Q8 (Senior): Closure + Generator interaction**

```javascript
function* idGenerator() {
  let id = 0;
  while (true) {
    yield ++id; // Closure? hay Generator mechanism?
  }
}

const gen = idGenerator();
console.log(gen.next().value); // ??
console.log(gen.next().value); // ??
```

> **Answer**: `1, 2` â€” NhÆ°ng Ä‘Ã¢y **KHÃ”NG pháº£i closure** theo nghÄ©a truyá»n thá»‘ng! Generator giá»¯ state báº±ng **suspended execution context** â€” nÃ³ "Ä‘Ã³ng bÄƒng" EC thay vÃ¬ pop nÃ³. KhÃ¡c closure (EC pop nhÆ°ng variables sá»‘ng qua reference), generator giá»¯ **nguyÃªn EC** trÃªn stack. Káº¿t quáº£ tÆ°Æ¡ng tá»± nhÆ°ng mechanism hoÃ n toÃ n khÃ¡c.

---

**Q9 (Senior): React stale closure â€” debug**

```javascript
function SearchComponent() {
  const [query, setQuery] = useState("");
  const [results, setResults] = useState([]);

  useEffect(() => {
    if (!query) return;

    // fetch sau 500ms debounce
    const timeoutId = setTimeout(async () => {
      const data = await fetchResults(query);
      setResults(data);
    }, 500);

    return () => clearTimeout(timeoutId);
  }, [query]); // â† deps array quan trá»ng!

  // Q: Náº¿u user gÃµ "abc" rá»“i xÃ³a thÃ nh "ab" trong 500ms,
  //    chuyá»‡n gÃ¬ xáº£y ra? CÃ³ race condition khÃ´ng?
}
```

> **Answer**: KhÃ´ng cÃ³ race condition nhá» closure + cleanup! Khi `query` thay Ä‘á»•i "abc" â†’ "ab": (1) useEffect cleanup cháº¡y `clearTimeout(timeoutId)` cho query="abc", (2) useEffect cháº¡y láº¡i vá»›i query="ab", táº¡o setTimeout Má»šI. **Closure cÅ©** (query="abc") bá»‹ destroy, **closure má»›i** (query="ab") Ä‘Æ°á»£c táº¡o. ÄÃ¢y lÃ  pattern Ä‘Ãºng cho debounced search.

---

**Q10 (Principal): Implement `once()` â€” function chá»‰ cháº¡y 1 láº§n**

```javascript
function once(fn) {
  let called = false; // Closure: flag
  let result; // Closure: cached result

  return function (...args) {
    if (called) return result;
    called = true;
    result = fn.apply(this, args);
    fn = null; // â† Giáº£i phÃ³ng reference! GC cÃ³ thá»ƒ thu há»“i fn
    return result;
  };
}

const initialize = once(() => {
  console.log("Initializing...");
  return { ready: true };
});

initialize(); // "Initializing..." â†’ { ready: true }
initialize(); // KhÃ´ng log, tráº£ vá» cÃ¹ng object
initialize(); // KhÃ´ng log, tráº£ vá» cÃ¹ng object

// Follow-up: Táº¡i sao set `fn = null`?
// â†’ Náº¿u fn giá»¯ reference Ä‘áº¿n large objects,
//   set null cho phÃ©p GC thu há»“i fn + captured vars cá»§a fn
//   ÄÃ¢y lÃ  best practice cho production closures
```

---

### ğŸ”§ Chrome DevTools â€” Debug Closures Trong Practice

**BÃ i viáº¿t â€” Xem Closure Variables Trá»±c Tiáº¿p Trong DevTools**

Khi debug, nhiá»u developers khÃ´ng biáº¿t Chrome DevTools hiá»ƒn thá»‹ closure variables ráº¥t trá»±c quan. ÄÃ¢y lÃ  cÃ¡ch sá»­ dá»¥ng:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHROME DEVTOOLS â€” CLOSURE INSPECTION                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“Œ CÃ¡ch 1: Sources Panel â†’ Breakpoint trong closure function   â”‚
â”‚                                                                 â”‚
â”‚  function createCounter() {                                     â”‚
â”‚    let count = 0;                                               â”‚
â”‚    return function increment() {                                â”‚
â”‚      debugger; // â† Äáº·t breakpoint á»Ÿ Ä‘Ã¢y                       â”‚
â”‚      return ++count;                                            â”‚
â”‚    };                                                           â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  Khi dá»«ng táº¡i debugger, xem panel "Scope":                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Scope:                                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ Local:        (biáº¿n trong increment)                 â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€ this: Window                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ Closure (createCounter):   â† âœ… CLOSURE HIá»‚N THá»Š!    â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€ count: 0                                         â”‚   â”‚
â”‚  â”‚  â””â”€ Global:       (window, document, ...)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ CÃ¡ch 2: Console â†’ Inspect function object                   â”‚
â”‚                                                                 â”‚
â”‚  const inc = createCounter();                                    â”‚
â”‚  console.dir(inc);                                               â”‚
â”‚  // Output:                                                      â”‚
â”‚  // Æ’ increment()                                                â”‚
â”‚  //   [[Scopes]]:                                                â”‚
â”‚  //     0: Closure (createCounter) { count: 0 }  â† âœ…           â”‚
â”‚  //     1: Global { ... }                                        â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ CÃ¡ch 3: Memory Panel â†’ Detect closure memory leaks          â”‚
â”‚                                                                 â”‚
â”‚  1. Chrome â†’ Memory tab â†’ Take Heap Snapshot                    â”‚
â”‚  2. Filter: "(closure)" hoáº·c tÃªn function                       â”‚
â”‚  3. Xem "Retained Size" â†’ náº¿u lá»›n báº¥t thÆ°á»ng â†’ potential leak  â”‚
â”‚  4. Click vÃ o closure â†’ tháº¥y captured variables + sizes          â”‚
â”‚  5. So sÃ¡nh 2 snapshots: náº¿u closures chá»‰ tÄƒng â†’ LEAK!         â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ CÃ¡ch 4: Performance Panel â†’ Detect closure trong hot path   â”‚
â”‚                                                                 â”‚
â”‚  1. Record performance profile                                  â”‚
â”‚  2. Xem Flame Chart â†’ náº¿u tháº¥y "(anonymous)" nhiá»u              â”‚
â”‚  3. ÄÃ¢y thÆ°á»ng lÃ  closures táº¡o inline â†’ cÃ¢n nháº¯c extract        â”‚
â”‚  4. Name closures Ä‘á»ƒ dá»… debug: return function myName() {...}   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRO TIP: Named closures cho debugging
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Bad: anonymous closure â€” khÃ³ debug
const handler = () => {
  const data = processData();
  return () => renderData(data);
};

// âœ… Good: named closure â€” hiá»‡n tÃªn trong DevTools
const handler = () => {
  const data = processData();
  return function renderClosure() {
    // â† TÃªn hiá»‡n trong stack trace!
    return renderData(data);
  };
};

// âœ… Good: named function expression
const debounce = (fn, delay) => {
  let timer;
  return function debouncedFn(...args) {
    // â† "debouncedFn" hiá»‡n trong DevTools
    clearTimeout(timer);
    timer = setTimeout(() => fn.apply(this, args), delay);
  };
};
```

---

### ğŸ“š Real-World Case Study â€” React Hooks Internals: Closures Táº¡o NÃªn useState

**BÃ i viáº¿t â€” BÃªn Trong useState: Closure Pattern MÃ  10 Triá»‡u Developers DÃ¹ng Má»—i NgÃ y**

React Hooks lÃ  vÃ­ dá»¥ **thá»±c táº¿ nháº¥t** vÃ  **phá»©c táº¡p nháº¥t** vá» closures trong production. Hiá»ƒu cÃ¡ch `useState` hoáº¡t Ä‘á»™ng bÃªn trong sáº½ giÃºp báº¡n hiá»ƒu táº¡i sao "stale closure" xáº£y ra â€” vÃ  cÃ¡ch trÃ¡nh.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMPLIFIED useState IMPLEMENTATION
// CÃ¡ch React Hooks dÃ¹ng Closures bÃªn dÆ°á»›i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// React lÆ°u state trong má»™t "fiber" object, ngoÃ i component
// Closure cho phÃ©p component truy cáº­p state mÃ  khÃ´ng cáº§n class

const React = (function () {
  let hooks = []; // â† Closure: array chá»©a Táº¤T Cáº¢ hooks
  let hookIndex = 0; // â† Closure: index hiá»‡n táº¡i

  function useState(initialValue) {
    const currentIndex = hookIndex; // â† Capture index táº¡i thá»i Ä‘iá»ƒm gá»i!

    // Láº§n Ä‘áº§u: khá»Ÿi táº¡o state
    if (hooks[currentIndex] === undefined) {
      hooks[currentIndex] = initialValue;
    }

    // setState closure: "nhá»›" currentIndex MÃƒI MÃƒI
    const setState = (newValue) => {
      if (typeof newValue === "function") {
        // Functional updater: trÃ¡nh stale closure!
        hooks[currentIndex] = newValue(hooks[currentIndex]);
      } else {
        hooks[currentIndex] = newValue;
      }
      render(); // Trigger re-render
    };

    hookIndex++; // Move Ä‘áº¿n hook tiáº¿p theo
    return [hooks[currentIndex], setState];
  }

  function useEffect(callback, deps) {
    const currentIndex = hookIndex;
    const prevDeps = hooks[currentIndex];

    let hasChanged = true;
    if (prevDeps) {
      // So sÃ¡nh deps cÅ© vs má»›i â€” Ä‘Ã¢y lÃ  lÃ½ do deps array quan trá»ng!
      hasChanged = deps.some((dep, i) => !Object.is(dep, prevDeps[i]));
    }

    if (hasChanged) {
      // Closure "nhá»›" callback + deps
      hooks[currentIndex] = deps;
      // Trong React tháº­t: schedule effect cho sau paint
      setTimeout(callback, 0); // Simplified
    }

    hookIndex++;
  }

  function render() {
    hookIndex = 0; // â† RESET index má»—i render!
    // ÄÃ¢y lÃ  lÃ½ do hooks PHáº¢I gá»i theo thá»© tá»± cá»‘ Ä‘á»‹nh
    // Náº¿u gá»i useState trong if/else â†’ index lá»‡ch â†’ bug!
    Component();
  }

  return { useState, useEffect, render };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº I SAO STALE CLOSURE Xáº¢Y RA:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
Render 1: count = 0
  â†’ onClick closure captures count = 0 (tá»« hooks[0])
  â†’ Closure A: () => setCount(count + 1) 
  â†’ count trong Closure A = 0 MÃƒI MÃƒI (closure captures VALUE at render time)

Render 2: count = 1  
  â†’ onClick closure captures count = 1
  â†’ Closure B: () => setCount(count + 1) â€” closure Má»šI, count Má»šI
  
Váº¥n Ä‘á»: náº¿u setTimeout/setInterval giá»¯ Closure A
  â†’ NÃ³ váº«n tháº¥y count = 0 â†’ "stale closure"!

Fix: dÃ¹ng functional updater
  setCount(prev => prev + 1) 
  â†’ KhÃ´ng dÃ¹ng closure value, dÃ¹ng latest value tá»« hooks array
*/
```

```
REACT HOOKS â€” CLOSURE LIFECYCLE:

Render 1: hookIndex = 0
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  hooks = [0, undefined, ...]                         â”‚
â”‚  useState(0) â†’ hookIndex=0 â†’ state=0, setState_v1   â”‚
â”‚  useEffect(cb) â†’ hookIndex=1 â†’ schedule cb          â”‚
â”‚  â€¢ setState_v1 closure: { currentIndex: 0 }          â”‚
â”‚  â€¢ cb closure: { query: '', results: [] }            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks button â†’ setState_v1(count + 1)
  â†’ hooks[0] = 0 + 1 = 1
  â†’ render() called â†’ hookIndex RESET to 0

Render 2: hookIndex = 0
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  hooks = [1, [...deps...], ...]                      â”‚
â”‚  useState(0) â†’ hookIndex=0 â†’ state=1, setState_v2   â”‚
â”‚  â€¢ setState_v1 is now STALE â€” still has count=0      â”‚
â”‚  â€¢ setState_v2 is FRESH â€” has count=1                â”‚
â”‚  â€¢ Náº¿u setInterval giá»¯ setState_v1 â†’ BUG!            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ RULE: Closures trong React = recreated EVERY render
   â†’ Má»i giÃ¡ trá»‹ bÃªn trong lÃ  SNAPSHOT táº¡i render time
   â†’ useRef giá»¯ MUTABLE reference xuyÃªn suá»‘t renders
```

---

### ğŸ—ï¸ Case Study 2: Express/Koa Middleware â€” Closure NhÆ° Kiáº¿n TrÃºc

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXPRESS MIDDLEWARE â€” Closure táº¡o middleware pipeline
// Má»—i middleware lÃ  closure truy cáº­p config riÃªng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Middleware factory: closure giá»¯ config
function rateLimiter(options = {}) {
  const { maxRequests = 100, windowMs = 60000 } = options;
  const clients = new Map(); // â† Closure: request tracking

  // Cleanup cÅ© má»—i phÃºt
  setInterval(() => clients.clear(), windowMs);

  // Return middleware function (closure!)
  return function rateLimiterMiddleware(req, res, next) {
    const clientIP = req.ip;
    const count = (clients.get(clientIP) || 0) + 1;
    clients.set(clientIP, count);

    if (count > maxRequests) {
      return res.status(429).json({
        error: "Too many requests",
        retryAfter: Math.ceil(windowMs / 1000),
      });
    }

    next(); // Pass to next middleware
  };
}

// Middleware factory: closure giá»¯ secret key
function authMiddleware(secretKey) {
  // secretKey Ä‘Æ°á»£c Báº¢O Vá»† bá»Ÿi closure
  // KhÃ´ng bao giá» lá»™ ra qua req/res
  return function authCheck(req, res, next) {
    const token = req.headers.authorization;
    try {
      req.user = jwt.verify(token, secretKey); // Closure access secretKey
      next();
    } catch (err) {
      res.status(401).json({ error: "Unauthorized" });
    }
  };
}

// Usage: má»—i middleware call táº¡o closure riÃªng
app.use(rateLimiter({ maxRequests: 50, windowMs: 30000 }));
app.use(authMiddleware(process.env.JWT_SECRET));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CLOSURE PIPELINE VISUALIZATION:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
Request â†’ rateLimiter closure (clients Map + config)
        â†’ authMiddleware closure (secretKey)
        â†’ routeHandler closure (db connection, services)
        â†’ Response

Má»—i táº§ng lÃ  closure truy cáº­p:
  - Config riÃªng (maxRequests, secretKey)
  - Shared state riÃªng (clients Map)
  - KHÃ”NG truy cáº­p Ä‘Æ°á»£c state cá»§a middleware khÃ¡c
  
â†’ PERFECT ISOLATION nhá» closure!
*/
```

---

## 12. this Keyword â€” 5 TrÆ°á»ng Há»£p XÃ¡c Äá»‹nh

**BÃ i viáº¿t chuyÃªn sÃ¢u â€” this: Tá»« KhÃ³a GÃ¢y "Sang Cháº¥n TÃ¢m LÃ½" Cho JavaScript Developers**

Náº¿u closures lÃ  "siÃªu nÄƒng lá»±c" thÃ¬ `this` lÃ  "siÃªu ráº¯c rá»‘i" â€” keyword gÃ¢y ra nhiá»u bugs, confusion, vÃ  cÃ¢u há»i phá»ng váº¥n nháº¥t trong JavaScript. KhÃ´ng ngÃ´n ngá»¯ nÃ o khÃ¡c cÃ³ `this` ká»³ láº¡ nhÆ° JavaScript: trong Python, `self` luÃ´n tÆ°á»ng minh; trong Java, `this` luÃ´n trá» vá» instance. NhÆ°ng JavaScript? `this` thay Ä‘á»•i **tÃ¹y vÃ o cÃ¡ch gá»i function**, khÃ´ng pháº£i nÆ¡i viáº¿t code.

Táº¡i sao láº¡i phá»©c táº¡p tháº¿? VÃ¬ JavaScript sinh ra trong **10 ngÃ y** (1995) vá»›i tham vá»ng "trÃ´ng giá»‘ng Java" Ä‘á»ƒ marketing â€” Brendan Eich thÃªm `this` vÃ o functions Ä‘á»ƒ functions cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng nhÆ° methods, nhÆ°ng KHÃ”NG báº¯t buá»™c pháº£i gá»i qua object. Káº¿t quáº£: má»™t keyword vá»›i 5 hÃ nh vi khÃ¡c nhau, phá»¥ thuá»™c **100% vÃ o runtime context**.

> **Quy táº¯c vÃ ng**: `this` khÃ´ng pháº£i "tÃ´i lÃ  ai" â€” mÃ  lÃ  "ai Ä‘ang gá»i tÃ´i lÃºc nÃ y?" Ngoáº¡i trá»« arrow functions, vá»‘n há»i "tÃ´i sinh ra á»Ÿ Ä‘Ã¢u?"

ÄÃ¢y lÃ  section mÃ  báº¡n **PHáº¢I** thuá»™c náº±m lÃ²ng cho interview. Má»i cÃ¢u há»i `this` Ä‘á»u quy vá» 5 cases + 1 priority rule.

**So sÃ¡nh `this` qua cÃ¡c ngÃ´n ngá»¯ â€” Táº¡i sao JavaScript láº¡i "ká»³ láº¡"?**

Äá»ƒ hiá»ƒu táº¡i sao `this` trong JavaScript gÃ¢y khÃ³ hiá»ƒu, hÃ£y so sÃ¡nh vá»›i cÃ¡ch cÃ¡c ngÃ´n ngá»¯ khÃ¡c xá»­ lÃ½ cÃ¹ng khÃ¡i niá»‡m:

Trong **Python**, `self` lÃ  tham sá»‘ **tÆ°á»ng minh** â€” báº¡n pháº£i khai bÃ¡o nÃ³ lÃ  argument Ä‘áº§u tiÃªn cá»§a má»i method. `def greet(self): print(self.name)`. KhÃ´ng cÃ³ magic, khÃ´ng cÃ³ ambiguity. Báº¡n nhÃ¬n vÃ o function signature lÃ  biáº¿t ngay: "Ã , `self` lÃ  parameter thá»© nháº¥t, nÃ³ sáº½ nháº­n object khi gá»i." Python makes it **explicit and visible**.

Trong **Java/C++/C#**, `this` lÃ  **implicit nhÆ°ng static** â€” nÃ³ luÃ´n trá» vá» instance hiá»‡n táº¡i cá»§a class, vÃ  **KHÃ”NG BAO GIá»œ** thay Ä‘á»•i. Náº¿u báº¡n viáº¿t `this.name` trong má»™t method, báº¡n biáº¿t cháº¯c 100% nÃ³ lÃ  property cá»§a instance mÃ  method Ä‘Ã³ thuá»™c vá». KhÃ´ng cÃ³ chuyá»‡n `this` trá» vá» `window` hay `undefined`. Java makes it **predictable and safe**.

Trong **Rust**, khÃ´ng cÃ³ `this` â€” thay vÃ o Ä‘Ã³, Rust dÃ¹ng `&self` (immutable reference) hoáº·c `&mut self` (mutable reference) lÃ m parameter tÆ°á»ng minh. Há»‡ thá»‘ng ownership vÃ  borrowing Ä‘áº£m báº£o táº¡i compile time ráº±ng báº¡n khÃ´ng bao giá» máº¥t "context." Rust makes it **compile-time guaranteed**.

CÃ²n **JavaScript**? `this` vá»«a **implicit** (tá»± Ä‘á»™ng gÃ¡n, khÃ´ng khai bÃ¡o), vá»«a **dynamic** (thay Ä‘á»•i tÃ¹y cÃ¡ch gá»i), vá»«a **context-dependent** (cÃ¹ng má»™t function, gá»i khÃ¡c nhau = `this` khÃ¡c nhau). ÄÃ¢y lÃ  tá»• há»£p **tá»‡ nháº¥t** tá»« gÃ³c Ä‘á»™ predictability: báº¡n khÃ´ng nhÃ¬n tháº¥y nÃ³ trong signature, báº¡n khÃ´ng Ä‘oÃ¡n Ä‘Æ°á»£c nÃ³ tá»« code, vÃ  nÃ³ thay Ä‘á»•i tÃ¹y thuá»™c vÃ o runtime â€” thá»© mÃ  báº¡n khÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c khi viáº¿t code.

Táº¡i sao Brendan Eich láº¡i thiáº¿t káº¿ nhÆ° váº­y? CÃ³ **3 lÃ½ do lá»‹ch sá»­**:

1. **Marketing requirement**: Netscape yÃªu cáº§u JavaScript "trÃ´ng giá»‘ng Java" â†’ pháº£i cÃ³ `this` keyword. NhÆ°ng JS functions lÃ  first-class values (khÃ¡c Java methods), nÃªn `this` pháº£i flexible hÆ¡n.

2. **Function reusability**: JavaScript ban Ä‘áº§u khÃ´ng cÃ³ class, khÃ´ng cÃ³ module. CÃ¹ng má»™t function cáº§n pháº£i hoáº¡t Ä‘á»™ng vá»›i **nhiá»u objects khÃ¡c nhau** â€” dynamic `this` cho phÃ©p "method borrowing" (`Array.prototype.slice.call(arguments)`), pattern cá»±c ká»³ máº¡nh mÃ  Java khÃ´ng thá»ƒ lÃ m.

3. **Event-driven architecture**: Browser cáº§n event handlers â€” functions Ä‘Æ°á»£c gáº¯n vÃ o DOM elements, vÃ  khi event xáº£y ra, `this` pháº£i trá» vá» element Ä‘Ã£ trigger event. Dynamic binding lÃ  cÃ¡ch tá»± nhiÃªn nháº¥t Ä‘á»ƒ implement Ä‘iá»u nÃ y mÃ  khÃ´ng cáº§n thÃªm syntax má»›i.

Káº¿t quáº£: JavaScript cÃ³ `this` **linh hoáº¡t nháº¥t** trong táº¥t cáº£ ngÃ´n ngá»¯ phá»• biáº¿n, nhÆ°ng cÅ©ng **khÃ³ Ä‘oÃ¡n nháº¥t**. ES6 arrow functions (2015) ra Ä‘á»i chÃ­nh lÃ  Ä‘á»ƒ "sá»­a" 80% váº¥n Ä‘á» â€” nhÆ°ng 20 nÄƒm legacy code váº«n dÃ¹ng regular functions, vÃ  interview váº«n há»i vá» dynamic `this`.

**5 Sai láº§m tÆ° duy phá»• biáº¿n vá» `this` (Mental Model Traps)**

TrÆ°á»›c khi Ä‘i vÃ o chi tiáº¿t, hÃ£y dáº¹p bá» 5 misconceptions mÃ  Ä‘a sá»‘ developers cÃ³:

**Trap #1: "this trá» vá» function"** â€” SAI. `this` khÃ´ng bao giá» trá» vá» function chá»©a nÃ³ (trá»« khi function Ä‘Æ°á»£c gáº¯n vÃ o chÃ­nh nÃ³ qua property). `this` trá» vá» **object táº¡i call-site**, khÃ´ng pháº£i function object.

**Trap #2: "this phá»¥ thuá»™c vÃ o nÆ¡i viáº¿t code"** â€” SAI. `this` phá»¥ thuá»™c vÃ o **cÃ¡ch gá»i**, khÃ´ng pháº£i nÆ¡i viáº¿t. CÃ¹ng má»™t function, gá»i 3 cÃ¡ch = 3 giÃ¡ trá»‹ `this` khÃ¡c nhau. Ngoáº¡i lá»‡ duy nháº¥t: arrow function.

**Trap #3: "this trong nested function káº¿ thá»«a tá»« outer function"** â€” SAI. Regular function táº¡o `this` binding Má»šI, hoÃ n toÃ n Ä‘á»™c láº­p. `this` KHÃ”NG "cháº£y xuá»‘ng" qua scope chain nhÆ° biáº¿n. Chá»‰ arrow function má»›i káº¿ thá»«a `this`.

**Trap #4: "call/apply/bind thay Ä‘á»•i this cá»§a arrow function"** â€” SAI. Arrow function cá»©ng cá»i hoÃ n toÃ n â€” `this` Ä‘Æ°á»£c "Ä‘Ã³ng bÄƒng" táº¡i thá»i Ä‘iá»ƒm Ä‘á»‹nh nghÄ©a. `call`, `apply`, `bind` **hoÃ n toÃ n vÃ´ tÃ¡c dá»¥ng** vá»›i arrow function.

**Trap #5: "strict mode thay Ä‘á»•i this thÃ nh null"** â€” KHÃ”NG CHÃNH XÃC. Strict mode thay Ä‘á»•i **default binding** tá»« `globalThis` (window) thÃ nh `undefined`. CÃ¡c binding rules khÃ¡c (implicit, explicit, new) **KHÃ”NG bá»‹ áº£nh hÆ°á»Ÿng** bá»Ÿi strict mode.

### Tá»•ng Quan: this LÃ  GÃ¬?

**BÃ i viáº¿t â€” this: KhÃ´ng Pháº£i Biáº¿n, KhÃ´ng Pháº£i Property â€” MÃ  LÃ  "Ngá»¯ Cáº£nh Äá»™ng"**

Äiá»u Ä‘áº§u tiÃªn cáº§n hiá»ƒu: `this` **KHÃ”NG PHáº¢I** má»™t biáº¿n thÃ´ng thÆ°á»ng. Báº¡n khÃ´ng thá»ƒ `let this = something`. NÃ³ cÅ©ng **KHÃ”NG PHáº¢I** property cá»§a function. NÃ³ lÃ  má»™t **keyword Ä‘áº·c biá»‡t** mÃ  JavaScript engine tá»± Ä‘á»™ng gÃ¡n giÃ¡ trá»‹ má»—i khi Execution Context Ä‘Æ°á»£c táº¡o.

Má»—i Execution Context cÃ³ 3 thÃ nh pháº§n: Variable Environment, Lexical Environment, vÃ  **this Binding**. Khi function cháº¡y, engine quyáº¿t Ä‘á»‹nh `this` dá»±a trÃªn **cÃ¡ch function Ä‘Æ°á»£c gá»i (call-site)** â€” Ä‘Ã¢y gá»i lÃ  "this resolution algorithm."

Äiá»ƒm khÃ¡c biá»‡t then chá»‘t so vá»›i scope: Scope Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh khi code **viáº¿t** (lexical/static). `this` Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh khi code **cháº¡y** (dynamic). Arrow function lÃ  ngoáº¡i lá»‡ duy nháº¥t â€” nÃ³ káº¿ thá»«a `this` tá»« lexical scope, biáº¿n `this` tá»« dynamic thÃ nh static.

**PhÃ¢n biá»‡t `this` vá»›i Scope Chain â€” Hai Há»‡ Thá»‘ng Song Song**

ÄÃ¢y lÃ  Ä‘iá»ƒm mÃ  nhiá»u developer nháº§m láº«n nháº¥t: `this` vÃ  scope chain lÃ  **hai há»‡ thá»‘ng hoÃ n toÃ n tÃ¡ch biá»‡t**, hoáº¡t Ä‘á»™ng theo luáº­t riÃªng. Scope chain theo **lexical scoping** â€” nÆ¡i code Ä‘Æ°á»£c viáº¿t quyáº¿t Ä‘á»‹nh biáº¿n nÃ o visible. `this` theo **dynamic binding** â€” cÃ¡ch code Ä‘Æ°á»£c gá»i quyáº¿t Ä‘á»‹nh object nÃ o gáº¯n vÃ o `this`.

VÃ­ dá»¥ minh há»a: khi báº¡n viáº¿t `function greet() { console.log(this.name); }` bÃªn trong module A, scope chain xÃ¡c Ä‘á»‹nh `greet` cÃ³ thá»ƒ access biáº¿n `console` (tá»« global scope). NhÆ°ng scope chain **KHÃ”NG** quyáº¿t Ä‘á»‹nh `this.name` lÃ  gÃ¬ â€” Ä‘iá»u Ä‘Ã³ phá»¥ thuá»™c vÃ o ai gá»i `greet()` táº¡i runtime.

Chá»‰ khi arrow function xuáº¥t hiá»‡n (ES6), hai há»‡ thá»‘ng má»›i "há»™i tá»¥" â€” arrow function dÃ¹ng scope chain Ä‘á»ƒ resolve `this`, biáº¿n `this` tá»« runtime concept thÃ nh compile-time concept. ÄÃ¢y lÃ  lÃ½ do mÃ  nhiá»u ngÆ°á»i gá»i arrow function lÃ  "lexical this" â€” vÃ¬ `this` bÃ¢y giá» hoáº¡t Ä‘á»™ng giá»‘ng biáº¿n closed-over trong closure.

**Call-site â€” "Hiá»‡n trÆ°á»ng vá»¥ Ã¡n" quyáº¿t Ä‘á»‹nh sá»‘ pháº­n this**

KhÃ¡i niá»‡m quan trá»ng nháº¥t khi Ä‘á»c section nÃ y: **call-site** (nÆ¡i gá»i function). KhÃ´ng pháº£i nÆ¡i function Ä‘Æ°á»£c **viáº¿t**, khÃ´ng pháº£i nÆ¡i function Ä‘Æ°á»£c **import**, mÃ  lÃ  cÃ¢u lá»‡nh cá»¥ thá»ƒ nÆ¡i function Ä‘Æ°á»£c **invoke**. NghÄ© vá» call-site nhÆ° "hiá»‡n trÆ°á»ng vá»¥ Ã¡n" â€” muá»‘n biáº¿t `this` trá» Ä‘áº¿n ai, báº¡n pháº£i quay láº¡i call-site vÃ  kiá»ƒm tra "ai Ä‘Ã£ gá»i function nÃ y, vÃ  gá»i báº±ng cÃ¡ch nÃ o."

CÃ³ **4 loáº¡i call-site** (Ã¡nh xáº¡ trá»±c tiáº¿p sang 4 binding rules cho regular function):

- `fn()` â€” Standalone invocation â†’ Default binding
- `obj.fn()` â€” Method invocation â†’ Implicit binding
- `fn.call(obj)` / `fn.apply(obj)` / `fn.bind(obj)()` â€” Forced invocation â†’ Explicit binding
- `new fn()` â€” Constructor invocation â†’ New binding

Má»—i loáº¡i call-site trigger má»™t binding rule khÃ¡c nhau. VÃ  khi cÃ³ conflict (function vá»«a Ä‘Æ°á»£c bind, vá»«a dÃ¹ng `new`), priority rules dÆ°á»›i Ä‘Ã¢y sáº½ phÃ¡n quyáº¿t ai tháº¯ng.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  this â€” DYNAMIC CONTEXT REFERENCE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“Œ this KHÃ”NG xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm viáº¿t code                 â”‚
â”‚     this Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm Gá»ŒI function               â”‚
â”‚     (trá»« arrow function â€” xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm DEFINE)        â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“Œ GiÃ¡ trá»‹ cá»§a this phá»¥ thuá»™c vÃ o CÃCH function Ä‘Æ°á»£c gá»i       â”‚
â”‚     chá»© khÃ´ng pháº£i NÆ I function Ä‘Æ°á»£c viáº¿t                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  5 TRÆ¯á»œNG Há»¢P XÃC Äá»ŠNH this:                               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  1ï¸âƒ£  Regular Function   â†’ window (global object)           â”‚ â”‚
â”‚  â”‚  2ï¸âƒ£  Object Method      â†’ object gá»i method               â”‚ â”‚
â”‚  â”‚  3ï¸âƒ£  Constructor (new)  â†’ object má»›i Ä‘Æ°á»£c táº¡o              â”‚ â”‚
â”‚  â”‚  4ï¸âƒ£  Arrow Function     â†’ this cá»§a scope chá»©a nÃ³ (lexical) â”‚ â”‚
â”‚  â”‚  5ï¸âƒ£  apply/call/bind    â†’ object Ä‘Æ°á»£c truyá»n vÃ o           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1ï¸âƒ£ Regular Function â†’ window

**BÃ i viáº¿t â€” Default Binding: "Khi KhÃ´ng Ai Gá»i, this Trá» Vá» ToÃ n Cáº§u"**

Default binding lÃ  trÆ°á»ng há»£p "fallback" â€” khi function Ä‘Æ°á»£c gá»i **tháº³ng** (standalone invocation), khÃ´ng qua object, khÃ´ng qua `new`, khÃ´ng qua `call/apply/bind`. Engine nhÃ¬n call-site, khÃ´ng tháº¥y ai "sá»Ÿ há»¯u" function call â†’ gÃ¡n `this = globalThis` (window trong browser, global trong Node.js).

ÄÃ¢y lÃ  behavior gÃ¢y bugs nhiá»u nháº¥t, Ä‘áº·c biá»‡t khi callback bá»‹ abstract ra khá»i context gá»‘c. Strict mode (ES5+) Ä‘Ã£ fix: thay vÃ¬ silent fallback vá» window, `this = undefined` â†’ code sáº½ throw error ngay, dá»… phÃ¡t hiá»‡n hÆ¡n.

> **Interview insight**: Náº¿u interviewer há»i "Táº¡i sao strict mode set this = undefined thay vÃ¬ window?", tráº£ lá»i: "VÃ¬ window lÃ m default lÃ  **security risk** â€” accidental mutation trÃªn global object, vÃ  performance issue â€” má»—i property lookup pháº£i traverse prototype chain cá»§a window."

**Engine Ä‘Ã£ lÃ m gÃ¬ bÃªn trong khi resolve Default Binding?**

Khi V8 gáº·p `showThis()`, nÃ³ thá»±c hiá»‡n quy trÃ¬nh sau táº¡i bytecode level:

1. **TÃ¬m call-site**: NhÃ¬n instruction `CALL showThis` â€” khÃ´ng cÃ³ receiver (base object) trÆ°á»›c function reference.
2. **Check [[ThisMode]]**: Má»—i function object cÃ³ internal slot `[[ThisMode]]` â€” giÃ¡ trá»‹ lÃ  `"lexical"` (arrow), `"strict"`, hoáº·c `"global"` (non-strict regular function).
3. **Náº¿u [[ThisMode]] == "global"**: Engine gá»i abstract operation `OrdinaryCallBindThis(F, calleeContext, undefined)`, rá»“i `ToObject(undefined)` tráº£ vá» `globalThis`. ÄÃ¢y lÃ  spec operation `OrdinaryCallBindThis` trong ECMAScript spec Â§10.2.1.2.
4. **Náº¿u [[ThisMode]] == "strict"**: this = `undefined` (khÃ´ng gá»i `ToObject`).

Äiá»u thÃº vá»‹: ngay cáº£ khi báº¡n gá»i `showThis.call(undefined)` trong non-strict mode, `ToObject(undefined)` váº«n biáº¿n nÃ³ thÃ nh `globalThis`. ÄÃ¢y lÃ  hÃ nh vi "type coercion" cá»§a this â€” `null` vÃ  `undefined` bá»‹ coerce thÃ nh global object trong non-strict mode. Strict mode bá» qua conversion nÃ y, giá»¯ nguyÃªn `undefined`.

**`globalThis` â€” CÃ¢u chuyá»‡n thá»‘ng nháº¥t "global object" qua 3 mÃ´i trÆ°á»ng**

TrÆ°á»›c ES2020, má»—i mÃ´i trÆ°á»ng JavaScript cÃ³ tÃªn khÃ¡c nhau cho global object: `window` (browser), `self` (Web Worker), `global` (Node.js). Äiá»u nÃ y gÃ¢y ra vÃ´ sá»‘ headache cho cross-platform code. ES2020 giá»›i thiá»‡u `globalThis` â€” má»™t standard reference hoáº¡t Ä‘á»™ng á»Ÿ **má»i** mÃ´i trÆ°á»ng.

Táº¡i sao tÃªn lÃ  `globalThis` chá»© khÃ´ng pháº£i `globalObject`? VÃ¬ TC39 muá»‘n nháº¥n máº¡nh: Ä‘Ã¢y lÃ  giÃ¡ trá»‹ mÃ  `this` default tá»›i â€” tá»©c lÃ  nÃ³ liÃªn quan trá»±c tiáº¿p Ä‘áº¿n **this binding**, khÃ´ng chá»‰ lÃ  "cÃ¡i object global." Naming nÃ y giÃºp má»i ngÆ°á»i nhá»› má»‘i quan há»‡ giá»¯a default binding vÃ  global object.

**Bugs thá»±c táº¿ trong Production do Default Binding**

Trong codebase production, default binding gÃ¢y 3 loáº¡i bugs phá»• biáº¿n nháº¥t:

1. **Accidental global mutation**: `this.count++` trong standalone function â†’ táº¡o `window.count` property má»›i hoáº·c modify global state. Äáº·c biá»‡t nguy hiá»ƒm trong shared libraries.

2. **Node.js module context confusion**: Trong Node.js CJS modules, `this` á»Ÿ top-level **KHÃ”NG pháº£i** `global` â€” mÃ  lÃ  `module.exports`. NhÆ°ng bÃªn trong regular function, `this` láº¡i lÃ  `global` (non-strict) hoáº·c `undefined` (strict). Sá»± khÃ´ng nháº¥t quÃ¡n nÃ y gÃ¢y nhiá»u bugs:

   ```
   // Node.js CJS module
   console.log(this);        // {} (module.exports, NOT global!)
   function test() {
     console.log(this);      // global object (non-strict) â†’ Báº¤T NGá»œI
   }
   ```

3. **ES Modules tá»± Ä‘á»™ng strict**: Khi dÃ¹ng `<script type="module">` hoáº·c `.mjs` files, **strict mode Ä‘Æ°á»£c Báº¬T Máº¶C Äá»ŠNH**. Äiá»u nÃ y cÃ³ nghÄ©a: táº¥t cáº£ regular function calls trong ES modules sáº½ cÃ³ `this = undefined` â€” báº¡n **KHÃ”NG Cáº¦N** viáº¿t `"use strict"`. ÄÃ¢y lÃ  behavior mÃ  nhiá»u developers khÃ´ng biáº¿t, vÃ  lÃ  lÃ½ do code cÅ© (CJS) port sang ESM thÆ°á»ng bá»‹ crash.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»i function bÃ¬nh thÆ°á»ng â†’ this = window (global object)
// Trong strict mode â†’ this = undefined
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showThis() {
  console.log(this);
}

showThis(); // window (browser) | global (Node.js)

// --- Strict mode ---
("use strict");
function strictThis() {
  console.log(this);
}

strictThis(); // undefined â† strict mode ngÄƒn implicit binding

// âš ï¸ Gotcha: function bÃªn trong function
const obj = {
  name: "Alice",
  greet() {
    console.log(this); // obj âœ… (method call)

    function innerFn() {
      console.log(this); // window âŒ (regular function call!)
    }
    innerFn();
  },
};

obj.greet();
// innerFn() lÃ  regular function call â†’ this = window
// KHÃ”NG pháº£i obj, dÃ¹ innerFn náº±m trong obj.greet
```

### 2ï¸âƒ£ Object Method â†’ Object ÄÃ³

**BÃ i viáº¿t â€” Implicit Binding: "Ai Gá»i ThÃ¬ this Trá» Vá» NgÆ°á»i ÄÃ³"**

ÄÃ¢y lÃ  case trá»±c giÃ¡c nháº¥t: khi function Ä‘Æ°á»£c gá»i **qua** object (dot notation), `this` = object Ä‘á»©ng **ngay trÆ°á»›c** dáº¥u `.` cuá»‘i cÃ¹ng. Gá»i `user.greet()` â†’ `this = user`. Gá»i `a.b.c.greet()` â†’ `this = c` (KHÃ”NG pháº£i `a` hay `b`).

NhÆ°ng implicit binding cÃ³ Ä‘iá»ƒm yáº¿u chÃ­ máº¡ng: **"context loss"**. Ngay khi báº¡n tÃ¡ch method ra khá»i object (assignment, callback passing), nÃ³ máº¥t implicit binding vÃ  rÆ¡i vá» default binding. ÄÃ¢y lÃ  nguá»“n gá»‘c cá»§a vÃ´ sá»‘ bugs trong event handlers, setTimeout callbacks, vÃ  React class components.

> **Mental model**: NghÄ© `this` nhÆ° "ai Ä‘ang cáº§m Ä‘iá»‡n thoáº¡i gá»i". `user.introduce()` = user cáº§m Ä‘iá»‡n thoáº¡i â†’ `this = user`. NhÆ°ng `const fn = user.introduce; fn()` = báº¡n láº¥y sá»‘ Ä‘iá»‡n thoáº¡i ra, gá»i tá»« mÃ¡y khÃ¡c â†’ lost context.

**"Last Dot Rule" vÃ  Reference Type â€” CÆ¡ cháº¿ bÃªn trong ECMAScript Spec**

Táº¡i sao `obj.method()` khiáº¿n `this = obj`? VÃ¬ ECMAScript spec sá»­ dá»¥ng khÃ¡i niá»‡m **Reference Type** â€” má»™t internal type mÃ  báº¡n khÃ´ng bao giá» nhÃ¬n tháº¥y trong runtime, nhÆ°ng engine dÃ¹ng nÃ³ Ä‘á»ƒ track "ai sá»Ÿ há»¯u" property.

Khi engine evaluate `obj.method`, káº¿t quáº£ KHÃ”NG pháº£i má»™t function value thuáº§n tÃºy. Káº¿t quáº£ lÃ  má»™t **Reference Record** gá»“m 3 pháº§n: `{ [[Base]]: obj, [[ReferencedName]]: "method", [[Strict]]: false }`. Khi `()` Ä‘Æ°á»£c Ä‘áº·t sau, engine tháº¥y base = `obj` â†’ gÃ¡n `this = obj`.

NhÆ°ng khi báº¡n viáº¿t `const fn = obj.method`, JavaScript bá» qua Reference Record vÃ  chá»‰ láº¥y **value** (function object). `fn` bÃ¢y giá» chá»‰ lÃ  má»™t plain function, khÃ´ng cÃ²n biáº¿t nÃ³ tá»« `obj` â€” Reference bá»‹ "unwrap". Gá»i `fn()` = standalone call = default binding.

Hiá»ƒu Reference Type giáº£i thÃ­ch nhiá»u behavior "ká»³ láº¡":

- `(obj.method)()` â†’ `this = obj` (grouping operator KHÃ”NG unwrap Reference)
- `(obj.method = obj.method)()` â†’ `this = window` (assignment unwrap Reference, tráº£ vá» value)
- `(false || obj.method)()` â†’ `this = window` (logical OR unwrap Reference)
- `(obj.method, obj.method)()` â†’ `this = window` (comma operator unwrap Reference)

ÄÃ¢y lÃ  cÃ¢u há»i interview tricky: interviewer cho expression phá»©c táº¡p vÃ  há»i `this` lÃ  gÃ¬. Key: báº¥t ká»³ operation nÃ o **extract value** tá»« `obj.method` (assignment, logical, comma, ternary) Ä‘á»u **destroy Reference** â†’ `this` fallback.

**4 Ká»‹ch báº£n "Máº¥t Context" Cáº§n Ghi Nhá»›**

Context loss xáº£y ra á»Ÿ má»i level â€” tá»« vanilla JS Ä‘áº¿n React, Express, vÃ  event handlers:

**Ká»‹ch báº£n 1 â€” setTimeout/setInterval**: ÄÃ¢y lÃ  trap phá»• biáº¿n nháº¥t. `setTimeout(user.greet, 1000)` â†’ khi timer fire, `greet` Ä‘Æ°á»£c gá»i standalone â†’ `this = window`. Giáº£i phÃ¡p: `setTimeout(() => user.greet(), 1000)` hoáº·c `setTimeout(user.greet.bind(user), 1000)`.

**Ká»‹ch báº£n 2 â€” Event listeners**: `button.addEventListener('click', handler.handle)` â†’ khi click, `this` = button DOM element, KHÃ”NG pháº£i `handler`. Browser dÃ¹ng implicit binding vá»›i element. ÄÃ¢y lÃ  lÃ½ do React class components cáº§n `this.handleClick = this.handleClick.bind(this)` trong constructor.

**Ká»‹ch báº£n 3 â€” Higher-order functions**: `[1,2,3].forEach(counter.increment)` â†’ má»—i láº§n loop, `increment` Ä‘Æ°á»£c gá»i standalone. Giáº£i phÃ¡p: arrow function wrapper, `.bind()`, hoáº·c `thisArg` parameter (tham sá»‘ thá»© 2 cá»§a `forEach`, `map`, `filter`).

**Ká»‹ch báº£n 4 â€” Destructuring methods**: `const { method } = obj; method()` â†’ destructuring extract value, destroy Reference. ÄÃ¢y lÃ  case ráº¥t phá»• biáº¿n trong modern JS â€” nhiá»u developers destructure methods tá»« object mÃ  khÃ´ng nháº­n ra Ä‘ang máº¥t context. Äáº·c biá»‡t nguy hiá»ƒm khi destructure tá»« `this` trong class methods.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»i function nhÆ° method cá»§a object â†’ this = object Ä‘Ã³
// "Ai gá»i method thÃ¬ this trá» vá» ngÆ°á»i Ä‘Ã³"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const user = {
  name: "Alice",
  age: 25,
  introduce() {
    console.log(`I'm ${this.name}, ${this.age} years old`);
    //               this = user â† object Ä‘ang gá»i method
  },
};

user.introduce(); // "I'm Alice, 25 years old" âœ…

// âš ï¸ Gotcha: Method assignment â€” máº¥t context
const fn = user.introduce;
fn(); // "I'm undefined, undefined years old" âŒ
//      this = window (regular function call, khÃ´ng pháº£i method call)

// âš ï¸ Gotcha: Nested object
const company = {
  name: "TechCorp",
  department: {
    name: "Engineering",
    getName() {
      return this.name; // this = department (object trá»±c tiáº¿p gá»i)
    },
  },
};

company.department.getName(); // "Engineering" (khÃ´ng pháº£i "TechCorp")
// Rule: this = object NGAY TRÆ¯á»šC dáº¥u . cuá»‘i cÃ¹ng
```

### 3ï¸âƒ£ Constructor (new) â†’ Object Má»›i

**BÃ i viáº¿t â€” new Binding: "Táº¡o Váº­t Thá»ƒ Tá»« KhuÃ´n Máº«u"**

Khi gá»i function vá»›i keyword `new`, JavaScript thá»±c hiá»‡n **4 bÆ°á»›c ngáº§m** (constructor call):

1. **Táº¡o object rá»—ng**: `const obj = {}`
2. **Link prototype**: `Object.setPrototypeOf(obj, Fn.prototype)`
3. **Bind this**: Cháº¡y function vá»›i `this = obj`
4. **Return**: Náº¿u function return object â†’ dÃ¹ng object Ä‘Ã³. Return primitive hoáº·c khÃ´ng return â†’ dÃ¹ng `obj`.

ÄÃ¢y lÃ  cÆ¡ cháº¿ khiáº¿n JavaScript cÃ³ thá»ƒ "giáº£ láº­p" OOP mÃ  khÃ´ng cáº§n class (trÆ°á»›c ES6). Má»—i `new` táº¡o instance má»›i vá»›i `this` riÃªng â€” giá»‘ng constructor trong Java/C++ nhÆ°ng thá»±c cháº¥t chá»‰ lÃ  syntactic sugar trÃªn plain functions.

> **Gotcha hay gáº·p trong interview**: "Náº¿u constructor return má»™t object thÃ¬ sao?" â†’ Object Ä‘Ã³ **thay tháº¿** this. Return primitive â†’ bá»‹ ignore. ÄÃ¢y lÃ  Ä‘iá»u mÃ  ngay cáº£ senior developers cÅ©ng khÃ´ng biáº¿t.

**[[Construct]] Internal Method â€” Engine lÃ m gÃ¬ khi gáº·p `new`?**

Má»—i function trong JavaScript cÃ³ 2 internal methods: `[[Call]]` (gá»i bÃ¬nh thÆ°á»ng) vÃ  `[[Construct]]` (gá»i vá»›i `new`). Khi engine gáº·p `new Fn(args)`, nÃ³ thá»±c hiá»‡n `[[Construct]]` theo ECMAScript spec Â§10.2.2:

1. `newTarget = Fn` (hoáº·c giÃ¡ trá»‹ khÃ¡c náº¿u dÃ¹ng `Reflect.construct`)
2. `thisArgument = OrdinaryCreateFromConstructor(newTarget, "%Object.prototype%")` â€” táº¡o plain object vá»›i `[[Prototype]]` = `Fn.prototype`
3. Gá»i function body vá»›i `this = thisArgument`
4. Check return value: náº¿u return type = Object â†’ dÃ¹ng nÃ³; ngÆ°á»£c láº¡i â†’ dÃ¹ng `thisArgument`

Äiá»u thÃº vá»‹: `new.target` â€” má»™t meta-property Ä‘Æ°á»£c giá»›i thiá»‡u trong ES6, cho phÃ©p function **biáº¿t** nÃ³ Ä‘ang Ä‘Æ°á»£c gá»i báº±ng `new` hay khÃ´ng. Trong base class, `new.target = class Ä‘Ã³`; trong derived class (extends), `new.target = derived class`. ÄÃ¢y lÃ  cÆ¡ cháº¿ cho phÃ©p abstract class pattern trong JavaScript:

```
class Shape {
  constructor() {
    if (new.target === Shape) throw new Error('Shape is abstract!');
  }
}
```

**`Reflect.construct` vÃ  Meta-programming**

`Reflect.construct(Target, args, NewTarget)` cho phÃ©p tÃ¡ch biá»‡t constructor logic (Target) vÃ  prototype chain (NewTarget). á»¨ng dá»¥ng thá»±c táº¿: táº¡o custom Error classes tÆ°Æ¡ng thÃ­ch cross-browser, hoáº·c implement factory pattern mÃ  váº«n giá»¯ Ä‘Ãºng `instanceof` check.

**ES6 Class Constructor vs Function Constructor â€” KhÃ¡c biá»‡t quan trá»ng**

Máº·c dÃ¹ class lÃ  "syntactic sugar" trÃªn function, cÃ³ 3 khÃ¡c biá»‡t cá»‘t lÃµi:

1. **Class constructor PHáº¢I gá»i vá»›i `new`**: `Person()` throw TypeError. Function constructor thÃ¬ khÃ´ng â€” gá»i khÃ´ng `new` sáº½ cháº¡y bÃ¬nh thÆ°á»ng (vá»›i `this = window`).
2. **Derived class PHáº¢I gá»i `super()` trÆ°á»›c khi dÃ¹ng `this`**: Trong class extends, `this` chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o cho Ä‘áº¿n khi `super()` hoÃ n thÃ nh. Truy cáº­p `this` trÆ°á»›c `super()` â†’ ReferenceError ("temporal dead zone" cho `this`).
3. **Class methods khÃ´ng enumerable**: Methods defined trong class body cÃ³ `enumerable: false` â€” khÃ´ng xuáº¥t hiá»‡n trong `for...in` loop. Function constructor methods trÃªn prototype thÃ¬ `enumerable: true`.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»i function vá»›i `new` â†’ this = object Má»šI Ä‘Æ°á»£c táº¡o
// new táº¡o object rá»—ng {} â†’ gÃ¡n this = {} â†’ return this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Person(name, age) {
  // this = {} (object rá»—ng, táº¡o bá»Ÿi new)
  this.name = name;
  this.age = age;
  // implicit return this
}

const alice = new Person("Alice", 25);
console.log(alice.name); // "Alice"
console.log(alice.age); // 25

// âš ï¸ Náº¿u constructor RETURN má»™t object â†’ that object thay tháº¿ this
function Broken(name) {
  this.name = name;
  return { name: "Override!" }; // Return object â†’ override this
}

const broken = new Broken("Alice");
console.log(broken.name); // "Override!" (khÃ´ng pháº£i "Alice")

// âœ… Return primitive â†’ bá»‹ ignore, this váº«n Ä‘Æ°á»£c dÃ¹ng
function Safe(name) {
  this.name = name;
  return 42; // Primitive â†’ bá»‹ ignore
}

const safe = new Safe("Alice");
console.log(safe.name); // "Alice" âœ…

// ES6 Class â€” cÃ¹ng cÆ¡ cháº¿
class Animal {
  constructor(type) {
    this.type = type; // this = object má»›i
  }

  speak() {
    return `I'm a ${this.type}`; // this = instance
  }
}

const cat = new Animal("cat");
cat.speak(); // "I'm a cat"
```

### 4ï¸âƒ£ Arrow Function â†’ Lexical this (Scope Chá»©a NÃ³)

**BÃ i viáº¿t â€” Lexical Binding: "this Cá»§a TÃ´i LÃ  this Cá»§a Cha TÃ´i"**

Arrow functions (ES6) lÃ  giáº£i phÃ¡p **final** cho bÃ i toÃ¡n "this bá»‹ máº¥t context". KhÃ¡c hoÃ n toÃ n vá»›i 4 rules trÃªn, arrow function **KHÃ”NG CÃ“** `this` riÃªng â€” nÃ³ "mÆ°á»£n" `this` tá»« enclosing scope (scope chá»©a nÃ³), giá»‘ng cÃ¡ch closure capture biáº¿n. Äiá»u nÃ y gá»i lÃ  **lexical this** â€” `this` xÃ¡c Ä‘á»‹nh khi code viáº¿t, khÃ´ng pháº£i khi code cháº¡y.

Táº¡i sao thiáº¿t káº¿ nhÆ° váº­y? VÃ¬ trÆ°á»›c ES6, má»—i callback Ä‘á»u máº¥t `this`, buá»™c devs pháº£i dÃ¹ng cÃ¡c hack: `const self = this`, `.bind(this)`, hay `thisArg` parameter. Arrow function loáº¡i bá» Táº¤T Cáº¢ workarounds Ä‘Ã³ báº±ng 1 rule Ä‘Æ¡n giáº£n: "khÃ´ng cÃ³ `this` riÃªng, káº¿ thá»«a tá»« cha."

> **Há»‡ quáº£ quan trá»ng**: (1) `call`, `apply`, `bind` KHÃ”NG thay Ä‘á»•i Ä‘Æ°á»£c `this` cá»§a arrow function. (2) Arrow function KHÃ”NG thá»ƒ dÃ¹ng vá»›i `new` â€” vÃ¬ `new` cáº§n function cÃ³ `this` riÃªng Ä‘á»ƒ bind. (3) Arrow function KHÃ”NG nÃªn dÃ¹ng lÃ m method trÃªn object literal â€” vÃ¬ method cáº§n `this` = object, nhÆ°ng arrow function sáº½ láº¥y `this` tá»« scope bao ngoÃ i (thÆ°á»ng lÃ  `window`).

**V8 Capture Mechanism â€” Arrow Function "MÆ°á»£n" this NhÆ° Tháº¿ NÃ o?**

Khi V8 parse arrow function, nÃ³ KHÃ”NG táº¡o `[[ThisMode]]: "global"` hay `"strict"` â€” mÃ  set `[[ThisMode]]: "lexical"`. Äiá»u nÃ y cÃ³ nghÄ©a: trong internal slot, arrow function Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  "khÃ´ng cÃ³ this riÃªng, skip this binding."

Cá»¥ thá»ƒ, khi `OrdinaryCallBindThis` gáº·p `[[ThisMode]] == "lexical"`, nÃ³ **return ngay láº­p tá»©c** mÃ  khÃ´ng set this. Arrow function access `this` báº±ng cÃ¡ch Ä‘i lÃªn **scope chain** (Environment Record) â€” giá»‘ng há»‡t cÃ¡ch nÃ³ access biáº¿n closure khÃ¡c. Trong bá»™ nhá»›, `this` cá»§a arrow function náº±m trong **closure context** cÃ¹ng vá»›i cÃ¡c captured variables.

Äiá»u nÃ y giáº£i thÃ­ch behavior quan trá»ng: náº¿u enclosing scope cÅ©ng lÃ  arrow function, nÃ³ tiáº¿p tá»¥c leo lÃªn cho Ä‘áº¿n khi tÃ¬m tháº¥y scope cÃ³ `this` riÃªng (regular function hoáº·c global). Chuá»—i arrow functions lá»“ng nhau â†’ táº¥t cáº£ share cÃ¹ng má»™t `this`.

**7 Thá»© Arrow Function KHÃ”NG CÃ“**

Arrow function khÃ´ng chá»‰ thiáº¿u `this`. Äá»ƒ thá»±c sá»± hiá»ƒu nÃ³, cáº§n biáº¿t **7 thá»©** mÃ  arrow function khÃ´ng cÃ³ â€” Ä‘á»u lÃ  internal slots bá»‹ bá» qua:

| Thá»© thiáº¿u              | Há»‡ quáº£                                                |
| ---------------------- | ----------------------------------------------------- |
| `this`                 | Káº¿ thá»«a tá»« enclosing scope                            |
| `arguments`            | DÃ¹ng `...rest` syntax thay tháº¿                        |
| `super`                | Káº¿ thá»«a tá»« enclosing (method context)                 |
| `new.target`           | Káº¿ thá»«a tá»« enclosing                                  |
| `[[Construct]]`        | KhÃ´ng thá»ƒ gá»i vá»›i `new` â†’ TypeError                   |
| `prototype` property   | Arrow function khÃ´ng cÃ³ `.prototype`                  |
| `Generator capability` | KhÃ´ng thá»ƒ dÃ¹ng `yield` â†’ arrow khÃ´ng thá»ƒ lÃ  generator |

Trong V8, arrow function Ä‘Æ°á»£c implement gá»n hÆ¡n regular function vÃ¬ khÃ´ng cáº§n allocate cÃ¡c internal slots nÃ y â€” Ä‘Ã¢y lÃ  micro-optimization mÃ  engine táº­n dá»¥ng.

**Khi NÃ o Arrow Function LÃ  Anti-pattern?**

1. **Object literal methods**: `const obj = { name: 'A', greet: () => this.name }` â†’ `this` = enclosing scope (thÆ°á»ng lÃ  `window`), KHÃ”NG pháº£i `obj`. LuÃ´n dÃ¹ng shorthand method syntax: `{ greet() {} }`.

2. **Prototype methods**: `Person.prototype.greet = () => this.name` â†’ `this` = global. VÃ¬ prototype methods cáº§n dynamic this Ä‘á»ƒ hoáº¡t Ä‘á»™ng vá»›i má»i instance.

3. **DOM event handlers (khi cáº§n access element)**: `button.onclick = () => this.classList.add('active')` â†’ `this` = enclosing scope, KHÃ”NG pháº£i button element. Náº¿u cáº§n `this = element`, dÃ¹ng regular function hoáº·c `event.currentTarget`.

4. **Constructor functions**: Arrow function khÃ´ng cÃ³ `[[Construct]]` â†’ `new (() => {})` throw TypeError.

**Arrow Function trong React â€” Tá»« Anti-pattern ThÃ nh Best Practice**

Trong React class components, arrow function giáº£i quyáº¿t bÃ i toÃ¡n lá»›n nháº¥t: `this` trong event handlers. Thay vÃ¬ `this.handleClick = this.handleClick.bind(this)` trong constructor, dÃ¹ng class field arrow:

```
class Button extends React.Component {
  handleClick = () => { console.log(this.props); } // this luÃ´n = instance
}
```

NhÆ°ng trong React hooks (functional components), arrow function trá»Ÿ nÃªn **Ã­t quan trá»ng** hÆ¡n â€” vÃ¬ function components khÃ´ng dÃ¹ng `this` gÃ¬ cáº£. `this` trong hooks world gáº§n nhÆ° khÃ´ng tá»“n táº¡i â€” Ä‘Ã¢y lÃ  má»™t trong nhá»¯ng lÃ½ do hooks Ä‘Æ°á»£c thiáº¿t káº¿: loáº¡i bá» hoÃ n toÃ n sá»± phá»©c táº¡p cá»§a `this`.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Arrow function KHÃ”NG CÃ“ this riÃªng
// this = this cá»§a scope nÆ¡i arrow function Ä‘Æ°á»£c Äá»ŠNH NGHÄ¨A
// (Lexical this â€” giá»‘ng scope chain, theo nÆ¡i Táº O)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const person = {
  name: "Alice",
  greet() {
    // this = person (method call)

    const inner = () => {
      console.log(this.name); // this = person â† káº¿ thá»«a tá»« greet()
    };

    inner(); // "Alice" âœ… (arrow fn â†’ lexical this = person)
  },
};

person.greet();

// So sÃ¡nh vá»›i regular function:
const person2 = {
  name: "Bob",
  greet() {
    const regular = function () {
      console.log(this.name); // this = window âŒ (regular fn call)
    };

    const arrow = () => {
      console.log(this.name); // this = person2 âœ… (lexical this)
    };

    regular(); // undefined
    arrow(); // "Bob"
  },
};

// âš ï¸ Cáº¢NH BÃO: KHÃ”NG dÃ¹ng arrow function lÃ m method
const wrongObj = {
  name: "Alice",
  greet: () => {
    // Arrow func defined á»Ÿ GLOBAL scope
    // this = window (scope chá»©a wrongObj = global)
    console.log(this.name); // undefined âŒ
  },
};

wrongObj.greet(); // undefined â€” Arrow function KHÃ”NG cÃ³ this riÃªng

// âœ… Nested arrow functions â†’ this Ä‘i theo HÃ€M THÆ¯á»œNG Gáº¦N NHáº¤T
const app = {
  name: "MyApp",
  init() {
    // this = app (method call)

    const render = () => {
      // this = app (káº¿ thá»«a tá»« init)

      const handleClick = () => {
        // this = app (káº¿ thá»«a tá»« render â† káº¿ thá»«a tá»« init)
        console.log(this.name);
      };

      handleClick(); // "MyApp" âœ…
    };

    render();
  },
};

app.init();
```

### 5ï¸âƒ£ apply / call / bind â€” Explicit Binding

**BÃ i viáº¿t â€” Explicit Binding: "TÃ´i Quyáº¿t Äá»‹nh this LÃ  Ai"**

Khi default vÃ  implicit binding khÃ´ng Ä‘á»§, JavaScript cung cáº¥p 3 "vÅ© khÃ­" cho phÃ©p báº¡n **tÆ°á»ng minh** chá»‰ Ä‘á»‹nh `this`: `call()`, `apply()`, vÃ  `bind()`. Cáº£ 3 Ä‘á»u lÃ  methods trÃªn `Function.prototype` â€” nghÄ©a lÃ  má»i function trong JS Ä‘á»u cÃ³ sáºµn.

Sá»± khÃ¡c biá»‡t cá»‘t lÃµi:

- **call** = gá»i ngay + args rá»i: `fn.call(thisArg, a, b, c)`
- **apply** = gá»i ngay + args array: `fn.apply(thisArg, [a, b, c])`
- **bind** = KHÃ”NG gá»i ngay, tráº£ vá» function Má»šI vá»›i `this` Ä‘Ã£ cá»‘ Ä‘á»‹nh vÄ©nh viá»…n

`bind` Ä‘áº·c biá»‡t quan trá»ng vÃ¬ nÃ³ táº¡o closure ná»™i bá»™ â€” function Ä‘Æ°á»£c bind sáº½ giá»¯ reference Ä‘áº¿n `thisArg` qua closure, Ä‘áº£m báº£o `this` khÃ´ng bao giá» bá»‹ máº¥t dÃ¹ báº¡n truyá»n function Ä‘i Ä‘Ã¢u.

> **Mnemonic**: **C**all = **C**ommas (args separated by commas). **A**pply = **A**rray (args as array). **B**ind = **B**ackpack (carries `this` with it everywhere).

**Internal Mechanism â€” `call` vÃ  `apply` Hoáº¡t Äá»™ng NhÆ° Tháº¿ NÃ o BÃªn Trong?**

Khi engine gáº·p `fn.call(thisArg, ...args)`, nÃ³ thá»±c hiá»‡n theo ECMAScript spec Â§20.2.3.3:

1. Kiá»ƒm tra `fn` cÃ³ callable khÃ´ng â†’ náº¿u khÃ´ng, throw TypeError
2. **thisArg coercion**: Trong non-strict mode, `null` / `undefined` â†’ `globalThis`; primitive â†’ wrapper object (`Number`, `String`, etc.). Trong strict mode, `thisArg` Ä‘Æ°á»£c dÃ¹ng nguyÃªn â€” `null` váº«n lÃ  `null`.
3. Gá»i `fn.[[Call]](thisArg, args)`

Sá»± khÃ¡c biá»‡t giá»¯a `call` vÃ  `apply` CHá»ˆ náº±m á»Ÿ bÆ°á»›c 2 â€” cÃ¡ch arguments Ä‘Æ°á»£c parse: `call` nháº­n argList, `apply` nháº­n array-like object. Trong V8 hiá»‡n Ä‘áº¡i, `fn.call(ctx, ...args)` vÃ  `fn.apply(ctx, args)` cÃ³ performance gáº§n identical, nhÆ°ng lá»‹ch sá»­ thÃ¬ `apply` vá»›i array lá»›n tá»«ng cháº­m hÆ¡n Ä‘Ã¡ng ká»ƒ (pre-V8 TurboFan).

**`bind` â€” Exotic Function Object Äáº·c Biá»‡t**

`bind` tráº£ vá» má»™t **bound function exotic object** (khÃ´ng pháº£i plain function). Object nÃ y cÃ³ 3 internal slots Ä‘áº·c biá»‡t:

- `[[BoundTargetFunction]]`: function gá»‘c
- `[[BoundThis]]`: `thisArg` Ä‘Ã£ cá»‘ Ä‘á»‹nh
- `[[BoundArguments]]`: partial args (náº¿u cÃ³)

Khi bound function Ä‘Æ°á»£c gá»i, engine combine `[[BoundArguments]]` + new args, rá»“i gá»i `[[BoundTargetFunction]].[[Call]]([[BoundThis]], combinedArgs)`. Quan trá»ng: **bind KHÃ”NG modify function gá»‘c** â€” nÃ³ táº¡o wrapper. Gá»i `bind` nhiá»u láº§n táº¡o **chain of wrappers**: `fn.bind(a).bind(b)` â€” `this` luÃ´n = `a` (bind Ä‘áº§u tiÃªn tháº¯ng), `b` bá»‹ ignore vÃ¬ bound function Ä‘Ã£ "khÃ³a cá»©ng" this.

**Partial Application Pattern â€” bind KhÃ´ng Chá»‰ Vá» this**

`bind` cÃ³ superpower Ã­t ngÆ°á»i biáº¿t: **partial application**. Báº¡n cÃ³ thá»ƒ "pre-fill" arguments mÃ  KHÃ”NG cáº§n gá»i function.

VÃ­ dá»¥ thá»±c táº¿: `const double = multiply.bind(null, 2)` â†’ `double(5)` = `10`. ÄÃ¢y lÃ  functional programming pattern máº¡nh máº½ â€” táº¡o specialized functions tá»« general functions. Libraries nhÆ° Lodash dÃ¹ng pattern nÃ y extensively.

**Function Borrowing â€” á»¨ng Dá»¥ng Thá»±c Táº¿ Nháº¥t**

Use case phá»• biáº¿n nháº¥t cá»§a `call`/`apply` lÃ  **mÆ°á»£n method** tá»« object khÃ¡c. Classic example: `Array.prototype.slice.call(arguments)` â€” vÃ¬ `arguments` lÃ  array-like (cÃ³ `.length` vÃ  numeric indices) nhÆ°ng KHÃ”NG pháº£i real Array. Báº±ng cÃ¡ch "mÆ°á»£n" `slice` tá»« Array prototype, báº¡n convert nÃ³ thÃ nh true Array.

Trong modern JS, pattern nÃ y Ã­t cáº§n thiáº¿t hÆ¡n nhá» `Array.from()` vÃ  `...spread`, nhÆ°ng váº«n xuáº¥t hiá»‡n trong code legacy vÃ  polyfills. Má»™t pattern khÃ¡c: `Object.prototype.toString.call(value)` â€” cÃ¡ch chÃ­nh xÃ¡c nháº¥t Ä‘á»ƒ detect type (`"[object Array]"`, `"[object Null]"`, etc.).

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// apply, call, bind cho phÃ©p CHá»ˆ Äá»ŠNH this má»™t cÃ¡ch TÆ¯á»œNG MINH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function introduce(greeting, punctuation) {
  console.log(`${greeting}, I'm ${this.name}${punctuation}`);
}

const alice = { name: "Alice" };
const bob = { name: "Bob" };

// --- call: nháº­n DANH SÃCH tham sá»‘ ---
introduce.call(alice, "Hello", "!");
// "Hello, I'm Alice!"

introduce.call(bob, "Hi", ".");
// "Hi, I'm Bob."

// --- apply: nháº­n Máº¢NG tham sá»‘ ---
introduce.apply(alice, ["Hey", "!!"]);
// "Hey, I'm Alice!!"

// ğŸ’¡ Trick: Spread array â†’ dÃ¹ng apply
const args = ["Yo", "~~~"];
introduce.apply(bob, args);
// "Yo, Bob~~~"

// --- bind: Táº O FUNCTION Má»šI vá»›i this Ä‘Ã£ bind ---
const aliceIntro = introduce.bind(alice, "Greetings");
aliceIntro("!"); // "Greetings, I'm Alice!"
aliceIntro("?"); // "Greetings, I'm Alice?"

// bind tráº£ vá» function Má»šI, KHÃ”NG gá»i ngay
// this cá»§a function má»›i = alice (VÄ¨NH VIá»„N, trá»« khi new)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  apply vs call vs bind â€” SO SÃNH                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Method  â”‚  Params          â”‚  Invoke? â”‚  Return           â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  call    â”‚  Danh sÃ¡ch       â”‚  âœ… Ngay â”‚  Káº¿t quáº£ function â”‚ â”‚
â”‚  â”‚          â”‚  (a, b, c)       â”‚          â”‚                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  apply   â”‚  Máº£ng            â”‚  âœ… Ngay â”‚  Káº¿t quáº£ function â”‚ â”‚
â”‚  â”‚          â”‚  ([a, b, c])     â”‚          â”‚                   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  bind    â”‚  Danh sÃ¡ch       â”‚  âŒ KhÃ´ngâ”‚  Function Má»šI     â”‚ â”‚
â”‚  â”‚          â”‚  (cÃ³ thá»ƒ partial)â”‚  gá»i ngayâ”‚  (this Ä‘Ã£ bind)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Náº¿u truyá»n null/undefined â†’ this = window (non-strict)      â”‚
â”‚  âš ï¸ bind + new â†’ new THáº®NG, this = object má»›i (khÃ´ng pháº£i bind) â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// bind + new: new ALWAYS WINS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Foo(name) {
  this.name = name;
}

const bound = Foo.bind({ name: "BoundThis" });
const obj = new bound("NewThis");

console.log(obj.name); // "NewThis" â† new tháº¯ng bind!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// apply/call/bind KHÃ”NG hoáº¡t Ä‘á»™ng vá»›i Arrow Function
// Arrow function this LUÃ”N lÃ  lexical, KHÃ”NG THá»‚ thay Ä‘á»•i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const arrow = () => {
  console.log(this);
};

arrow.call({ name: "Alice" }); // window â† call KHÃ”NG cÃ³ tÃ¡c dá»¥ng
arrow.apply({ name: "Bob" }); // window â† apply KHÃ”NG cÃ³ tÃ¡c dá»¥ng

const boundArrow = arrow.bind({ name: "Charlie" });
boundArrow(); // window â† bind KHÃ”NG cÃ³ tÃ¡c dá»¥ng
```

### Thá»© Tá»± Æ¯u TiÃªn (Precedence)

**BÃ i viáº¿t â€” Priority Rule: Khi Nhiá»u Binding Xung Äá»™t, Ai Tháº¯ng?**

Trong thá»±c táº¿, má»™t function cÃ³ thá»ƒ bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi **nhiá»u binding rules cÃ¹ng lÃºc**. VÃ­ dá»¥: `new boundFn()` â€” Ä‘Ã¢y vá»«a lÃ  `new` binding vá»«a lÃ  `bind` (explicit), ai tháº¯ng? JavaScript cÃ³ má»™t hierarchy rÃµ rÃ ng:

`new` > `call/apply/bind` > `obj.method()` > standalone `fn()`

VÃ  arrow function **bypass táº¥t cáº£** â€” nÃ³ KHÃ”NG tham gia cuá»™c chÆ¡i nÃ y. Arrow function luÃ´n dÃ¹ng lexical `this`, báº¥t ká»ƒ báº¡n gá»i nÃ³ báº±ng cÃ¡ch nÃ o.

> **Interview tip**: Khi gáº·p cÃ¢u há»i "output lÃ  gÃ¬?", hÃ£y cháº¡y flowchart: (1) Arrow? â†’ lexical. (2) new? â†’ object má»›i. (3) call/apply/bind? â†’ explicit. (4) obj.method? â†’ obj. (5) Default â†’ window/undefined. Cháº¡y tá»« trÃªn xuá»‘ng, rule Ä‘áº§u tiÃªn match = answer.

**Táº¡i Sao `new` Tháº¯ng `bind`? â€” Báº±ng Chá»©ng Tá»« Spec**

ÄÃ¢y lÃ  cÃ¢u há»i interview "level chuyÃªn gia". Khi `new boundFn()` Ä‘Æ°á»£c gá»i, ECMAScript spec quy Ä‘á»‹nh: bound function's `[[Construct]]` sáº½ **ignore** `[[BoundThis]]` vÃ  táº¡o object má»›i. Logic: `new` Cáº¦N object má»›i Ä‘á»ƒ hoáº¡t Ä‘á»™ng; náº¿u `bind` override `this` thÃ¬ `new` trá»Ÿ nÃªn vÃ´ nghÄ©a. Spec Æ°u tiÃªn semantics cá»§a `new` vÃ¬ constructor pattern quan trá»ng hÆ¡n explicit binding.

ÄÃ¢y lÃ  lÃ½ do `bind` Ä‘Æ°á»£c implement Ä‘áº·c biá»‡t: bound function cÃ³ riÃªng `[[Construct]]` method biáº¿t cÃ¡ch "nhÆ°á»ng" cho `new`. Code demo:

```
function Foo(x) { this.x = x; }
const BoundFoo = Foo.bind({ ignored: true });
const obj = new BoundFoo(42);
// obj.x === 42 âœ… (new tháº¯ng)
// obj.ignored === undefined âœ… (bind's this bá»‹ bá» qua)
```

**Edge Case: `call`/`apply` Vá»›i `null` hoáº·c `undefined`**

Truyá»n `null`/`undefined` lÃ m `thisArg` cÃ³ behavior khÃ¡c nhau theo mode:

- **Non-strict**: coerce thÃ nh `globalThis` â†’ potential pollution/security risk
- **Strict**: giá»¯ nguyÃªn `null`/`undefined` â†’ access property trÃªn `this` sáº½ throw TypeError

Best practice: khi dÃ¹ng `apply`/`call` chá»‰ vÃ¬ spread args (khÃ´ng cáº§n `this`), truyá»n `Object.create(null)` thay vÃ¬ `null` â€” táº¡o "DMZ object" an toÃ n, trÃ¡nh global pollution.

**Structured Algorithm Cho Interview â€” 5 BÆ°á»›c Quyáº¿t Äá»‹nh**

1. **Check arrow**: `isArrowFunction(fn)` â†’ `this` = closure scope's `this` â†’ **STOP**
2. **Check `new`**: called with `new`? â†’ `this` = newly created object â†’ **STOP**
3. **Check explicit**: called with `call`/`apply` or is bound function? â†’ `this` = provided `thisArg` â†’ **STOP**
4. **Check dot notation**: called as `obj.method()`? â†’ `this` = `obj` â†’ **STOP**
5. **Default**: `this` = `globalThis` (non-strict) or `undefined` (strict)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  this BINDING PRECEDENCE (cao â†’ tháº¥p)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. new binding         â†’ this = object má»›i       (highest)     â”‚
â”‚  2. Explicit binding    â†’ apply / call / bind                   â”‚
â”‚  3. Implicit binding    â†’ object.method()                       â”‚
â”‚  4. Default binding     â†’ window / undefined      (lowest)     â”‚
â”‚                                                                 â”‚
â”‚  âš¡ Arrow function â†’ BYPASS táº¥t cáº£ rules trÃªn                   â”‚
â”‚     LuÃ´n dÃ¹ng lexical this (scope chá»©a nÃ³)                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  DECISION FLOWCHART:                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Arrow Function?                                           â”‚ â”‚
â”‚  â”‚     YES â†’ this = lexical (scope chá»©a nÃ³) â”€â”€â”€â”€ DONE        â”‚ â”‚
â”‚  â”‚     NO  â†“                                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  new?                                                      â”‚ â”‚
â”‚  â”‚     YES â†’ this = object má»›i â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DONE           â”‚ â”‚
â”‚  â”‚     NO  â†“                                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  call / apply / bind?                                      â”‚ â”‚
â”‚  â”‚     YES â†’ this = Ä‘á»‘i tÆ°á»£ng truyá»n vÃ o â”€â”€â”€â”€ DONE            â”‚ â”‚
â”‚  â”‚     NO  â†“                                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  obj.method()?                                             â”‚ â”‚
â”‚  â”‚     YES â†’ this = obj â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DONE             â”‚ â”‚
â”‚  â”‚     NO  â†“                                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Default:                                                  â”‚ â”‚
â”‚  â”‚     non-strict â†’ this = window                             â”‚ â”‚
â”‚  â”‚     strict     â†’ this = undefined                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common Gotchas & Fixes

**BÃ i viáº¿t â€” 3 CÃ¡i Báº«y Kinh Äiá»ƒn: Táº¡i Sao this LuÃ´n GÃ¢y Äau Äáº§u**

CÃ³ 3 scenarios mÃ  `this` gáº§n nhÆ° **cháº¯c cháº¯n** gÃ¢y bugs cho developers á»Ÿ má»i level:

1. **Callback máº¥t context**: Truyá»n method lÃ m callback cho `setTimeout`, `addEventListener`, `Promise.then()` â†’ method bá»‹ tÃ¡ch ra khá»i object â†’ `this` rÆ¡i vá» default binding
2. **Event handler máº¥t context**: React class components, DOM event listeners â†’ `this` trá» vá» DOM element hoáº·c `undefined` thay vÃ¬ component instance
3. **Array methods máº¥t context**: `forEach`, `map`, `filter` vá»›i regular function callback â†’ `this` = `undefined` (strict mode)

Cho má»—i gotcha, cÃ³ **4 fixes** theo thá»© tá»± Æ°u tiÃªn: (1) Arrow function âœ… (clean nháº¥t), (2) `.bind(this)` âœ… (explicit), (3) `thisArg` parameter náº¿u API há»— trá»£ âœ…, (4) `const self = this` âš ï¸ (legacy, trÃ¡nh dÃ¹ng).

**Táº¡i Sao Context Loss Xáº£y Ra? â€” Root Cause Analysis**

Root cause luÃ´n giá»‘ng nhau: khi báº¡n **extract** method ra khá»i object (assign vÃ o biáº¿n, truyá»n lÃ m argument), Reference Type bá»‹ máº¥t. Engine chá»‰ tháº¥y má»™t plain function call, khÃ´ng cÃ²n base object â†’ default binding.

Äiá»u nÃ y lÃ  BY DESIGN: JavaScript pass **function values**, khÃ´ng pass **function + context**. Khi báº¡n viáº¿t `const fn = obj.method`, biáº¿n `fn` chá»‰ hold reference Ä‘áº¿n function object â€” KHÃ”NG hold reference Ä‘áº¿n `obj`. ÄÃ¢y lÃ  first-class function semantics.

**Comparison: 4 Fix Patterns â€” Trade-offs**

| Pattern             | Timing                   | Memory                                               | GC Impact                | Readability   |
| ------------------- | ------------------------ | ---------------------------------------------------- | ------------------------ | ------------- |
| Arrow function      | Capture táº¡i define-time  | 1 closure per instance                               | Giá»¯ ref Ä‘áº¿n outer scope  | â­â­â­â­â­    |
| `.bind(this)`       | Create táº¡i bind-time     | 1 bound function per bind call                       | Giá»¯ ref Ä‘áº¿n thisArg      | â­â­â­â­      |
| Class field arrow   | Capture táº¡i construction | 1 function per instance (KHÃ”NG shared via prototype) | Giá»¯ ref Ä‘áº¿n instance     | â­â­â­â­â­    |
| `const self = this` | Capture táº¡i define-time  | 1 variable on stack/closure                          | Giá»¯ ref Ä‘áº¿n outer `this` | â­â­ (legacy) |

> **LÆ°u Ã½ quan trá»ng vá» Class Field Arrow**: `handleClick = () => {}` táº¡o function Má»šI cho Má»–I instance â€” function nÃ y KHÃ”NG náº±m trÃªn prototype. Náº¿u báº¡n táº¡o 1000 instances, báº¡n cÃ³ 1000 copies cá»§a function. Vá»›i prototype method + bind trong constructor, function chá»‰ tá»“n táº¡i 1 láº§n trÃªn prototype, nhÆ°ng báº¡n váº«n táº¡o 1000 bound wrappers. Memory footprint gáº§n nhÆ° tÆ°Æ¡ng Ä‘Æ°Æ¡ng, nhÆ°ng class field arrow readable hÆ¡n nhiá»u.

**Modern Solutions â€” Tá»« ES2022+**

ES2022 Class Fields vÃ  upcoming decorators Ä‘ang dáº§n giáº£i quyáº¿t triá»‡t Ä‘á»ƒ context loss:

1. **Public class fields** (ES2022): `handleClick = () => { this.setState(...) }` â€” arrow function tá»± Ä‘á»™ng captured trong constructor
2. **Private fields**: `#count = 0` â€” private báº±ng syntax, khÃ´ng cáº§n closure pattern
3. **Auto-bind decorators** (Stage 3 proposal): `@bound handleClick() {}` â€” tá»± Ä‘á»™ng bind mÃ  váº«n giá»¯ method trÃªn prototype

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: Callback máº¥t this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Timer {
  constructor() {
    this.seconds = 0;
  }

  start() {
    // âŒ Regular function â†’ this = window trong callback
    setInterval(function () {
      this.seconds++; // this = window â†’ NaN
    }, 1000);

    // âœ… FIX 1: Arrow function â†’ lexical this
    setInterval(() => {
      this.seconds++; // this = Timer instance âœ…
    }, 1000);

    // âœ… FIX 2: bind
    setInterval(
      function () {
        this.seconds++;
      }.bind(this),
      1000,
    );

    // âœ… FIX 3: self/that pattern
    const self = this;
    setInterval(function () {
      self.seconds++; // self = Timer instance âœ…
    }, 1000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: Event handler máº¥t this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Button {
  constructor(label) {
    this.label = label;
  }

  // âŒ Náº¿u truyá»n trá»±c tiáº¿p â†’ this = DOM element
  handleClick() {
    console.log(this.label); // this = <button> element, khÃ´ng pháº£i Button
  }

  // âœ… FIX: bind trong constructor hoáº·c dÃ¹ng arrow function
  init() {
    const btn = document.querySelector("button");

    // FIX 1: bind
    btn.addEventListener("click", this.handleClick.bind(this));

    // FIX 2: Arrow function wrapper
    btn.addEventListener("click", () => this.handleClick());

    // FIX 3: Arrow function as class field (modern syntax)
  }

  // âœ… FIX 4: Class field with arrow function
  handleClickArrow = () => {
    console.log(this.label); // this = Button instance â† LUÃ”N ÄÃšNG
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: this trong forEach/map/filter
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const processor = {
  prefix: ">>",
  process(items) {
    // âŒ Regular function â†’ this = undefined (strict) / window
    items.forEach(function (item) {
      console.log(this.prefix + item); // âŒ this.prefix = undefined
    });

    // âœ… FIX 1: Arrow function
    items.forEach((item) => {
      console.log(this.prefix + item); // âœ… this = processor
    });

    // âœ… FIX 2: thisArg (2nd param of forEach)
    items.forEach(function (item) {
      console.log(this.prefix + item); // âœ… this = processor
    }, this); // â† truyá»n this vÃ o
  },
};
```

### Tá»•ng Há»£p: 5 Cases of this

**BÃ i viáº¿t â€” Cheat Sheet: Náº¿u Chá»‰ Nhá»› 1 Thá»©, HÃ£y Nhá»› Báº£ng NÃ y**

Sau khi hiá»ƒu chi tiáº¿t tá»«ng case, Ä‘Ã¢y lÃ  báº£ng tÃ³m táº¯t báº¡n cÃ³ thá»ƒ dÃ¹ng nhÆ° **cheat sheet** trong interview. Khi gáº·p báº¥t ká»³ cÃ¢u há»i `this` nÃ o, cháº¡y qua báº£ng tá»« trÃªn xuá»‘ng dÆ°á»›i â€” rule Ä‘áº§u tiÃªn match lÃ  answer.

> **Pro tip cho interview**: Äá»«ng tráº£ lá»i ngay. NÃ³i vá»›i interviewer: "TÃ´i sáº½ xÃ¡c Ä‘á»‹nh call-site trÆ°á»›c, rá»“i Ã¡p dá»¥ng priority rules." Approach cÃ³ há»‡ thá»‘ng cho tháº¥y báº¡n hiá»ƒu sÃ¢u thay vÃ¬ Ä‘oÃ¡n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5 CASES OF this â€” SUMMARY TABLE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Case          â”‚  this =         â”‚  VÃ­ dá»¥                  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Regular fn()   â”‚ window          â”‚ fn()                    â”‚ â”‚
â”‚  â”‚                â”‚ (strict: undef) â”‚                         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ obj.method()   â”‚ obj             â”‚ user.greet()            â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ new Fn()       â”‚ object má»›i      â”‚ new Person("A")         â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Arrow fn       â”‚ lexical this    â”‚ () => this.name         â”‚ â”‚
â”‚  â”‚                â”‚ (scope chá»©a nÃ³) â”‚ (khÃ´ng thá»ƒ thay Ä‘á»•i)    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ call/apply/    â”‚ object truyá»n   â”‚ fn.call(obj)            â”‚ â”‚
â”‚  â”‚ bind           â”‚ vÃ o             â”‚ fn.bind(obj)()          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Priority: new > bind > implicit > default                    â”‚
â”‚  âš ï¸ Arrow fn BYPASS táº¥t cáº£, luÃ´n dÃ¹ng lexical this              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”¬ Deep Analysis: 6 Patterns PhÃ¢n TÃ­ch this Keyword

#### ğŸ” Pattern 1: Äá»‡ quy "Táº¡i sao" (5 Whys) â€” Táº¡i Sao this Láº¡i Dynamic?

**CÃ¢u há»i gá»‘c: "Táº¡i sao this thay Ä‘á»•i tÃ¹y cÃ¡ch gá»i function?"**

```
WHY #1: Táº¡i sao this trong JavaScript thay Ä‘á»•i tÃ¹y cÃ¡ch gá»i?
  â†’ VÃ¬ this Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh táº¡i CALL-SITE (nÆ¡i gá»i), khÃ´ng pháº£i definition-site
  â†’ ÄÃ¢y gá»i lÃ  DYNAMIC binding

WHY #2: Táº¡i sao JS láº¡i chá»n dynamic binding thay vÃ¬ static (nhÆ° Python self)?
  â†’ VÃ¬ JS functions lÃ  FIRST-CLASS values â€” chÃºng cÃ³ thá»ƒ Ä‘Æ°á»£c:
    - GÃ¡n vÃ o biáº¿n
    - Truyá»n lÃ m callback
    - Return tá»« function khÃ¡c
  â†’ Má»™t function cÃ³ thá»ƒ Ä‘Æ°á»£c nhiá»u object "mÆ°á»£n" â†’ this pháº£i flexible

WHY #3: Táº¡i sao functions cáº§n lÃ  first-class values?
  â†’ VÃ¬ JS ban Ä‘áº§u lÃ  SCRIPTING language cho browser
  â†’ Cáº§n event handlers, callbacks, closures â†’ functions PHáº¢I portable
  â†’ Náº¿u this cá»‘ Ä‘á»‹nh â†’ function khÃ´ng thá»ƒ reuse qua nhiá»u objects

WHY #4: Táº¡i sao khÃ´ng bind this VÄ¨NH VIá»„N vÃ o function khi táº¡o?
  â†’ VÃ¬ Ä‘iá»u Ä‘Ã³ sáº½ NGÄ‚N Cáº¢N pattern "method borrowing":
    Array.prototype.slice.call(arguments)
    â†’ ÄÃ¢y lÃ  cÃ¡ch DÃ™NG methods cá»§a kiá»ƒu khÃ¡c â†’ Cá»°C Ká»² máº¡nh
  â†’ Náº¿u this cá»‘ Ä‘á»‹nh, slice chá»‰ hoáº¡t Ä‘á»™ng vá»›i arrays, KHÃ”NG vá»›i arguments

WHY #5: Váº­y táº¡i sao ES6 láº¡i thÃªm Arrow Function (lexical this)?
  â†’ VÃ¬ THá»°C Táº¾ cho tháº¥y dynamic this gÃ¢y BUGS nhiá»u hÆ¡n lá»£i Ã­ch
  â†’ 90% trÆ°á»ng há»£p dÃ¹ng callback, devs MUá»N this = enclosing scope
  â†’ Arrow function giáº£i quyáº¿t 90% use-case, regular function giá»¯ cho 10% cÃ²n láº¡i

Káº¾T LUáº¬N:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dynamic this: Tá»‘i Æ°u cho METHOD BORROWING & POLYMORPHISM       â”‚
â”‚  Lexical this: Tá»‘i Æ°u cho CALLBACKS & CLOSURES                  â”‚
â”‚                                                                 â”‚
â”‚  â†’ JS cung cáº¥p Cáº¢ HAI, Ä‘á»ƒ developer chá»n Ä‘Ãºng tool              â”‚
â”‚  â†’ Regular function = dynamic this (flexible, nhÆ°ng dá»… bug)     â”‚
â”‚  â†’ Arrow function = lexical this (predictable, nhÆ°ng Ã­t flexible)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **á»¨ng dá»¥ng interview**: Náº¿u Ä‘Æ°á»£c há»i "Táº¡i sao JS cÃ³ 2 loáº¡i function?", báº¡n cÃ³ thá»ƒ trace cáº£ chuá»—i 5 Whys â€” cho tháº¥y má»—i loáº¡i sinh ra Ä‘á»ƒ giáº£i quyáº¿t use-case khÃ¡c nhau, khÃ´ng pháº£i "design flaw."

#### ğŸ§± Pattern 2: First Principles â€” this Hoáº¡t Äá»™ng NhÆ° Tháº¿ NÃ o BÃªn DÆ°á»›i?

**PhÃ¢n rÃ£ this thÃ nh cÃ¡c thÃ nh pháº§n cÆ¡ báº£n nháº¥t:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXECUTION CONTEXT â€” this Resolution tá»« Scratch                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi code cháº¡y, V8 táº¡o Execution Context cho má»—i function call:â”‚
â”‚                                                                 â”‚
â”‚  ExecutionContext = {                                            â”‚
â”‚    VariableEnvironment: { ... },     â† var, function declarationsâ”‚
â”‚    LexicalEnvironment: { ... },      â† let, const, block scope â”‚
â”‚    ThisBinding: ???                   â† XÃC Äá»ŠNH Táº I ÄÃ‚Y       â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  ThisBinding Ä‘Æ°á»£c set bá»Ÿi ECMAScript spec:                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                 â”‚
â”‚  1. OrdinaryCallBindThis(F, calleeContext, thisArgument):       â”‚
â”‚     â”€â”€ Náº¿u F.[[ThisMode]] === "lexical" (arrow fn):             â”‚
â”‚        â†’ KHÃ”NG set ThisBinding (káº¿ thá»«a outer)                  â”‚
â”‚     â”€â”€ Náº¿u F.[[ThisMode]] === "strict":                         â”‚
â”‚        â†’ ThisBinding = thisArgument (cÃ³ thá»ƒ undefined)          â”‚
â”‚     â”€â”€ Náº¿u F.[[ThisMode]] === "global" (non-strict):            â”‚
â”‚        â†’ Náº¿u thisArgument == null/undefined:                    â”‚
â”‚           â†’ ThisBinding = globalThis                            â”‚
â”‚        â†’ NgÆ°á»£c láº¡i: ThisBinding = ToObject(thisArgument)         â”‚
â”‚                                                                 â”‚
â”‚  2. thisArgument Ä‘áº¿n tá»« Ä‘Ã¢u?                                    â”‚
â”‚     â”€â”€ fn()          â†’ thisArgument = undefined                 â”‚
â”‚     â”€â”€ obj.fn()      â†’ thisArgument = obj (Reference.base)      â”‚
â”‚     â”€â”€ fn.call(x)    â†’ thisArgument = x                        â”‚
â”‚     â”€â”€ new fn()      â†’ thisArgument = newly created object      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Data Structures liÃªn quan:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reference Type â€” Cáº¥u trÃºc dá»¯ liá»‡u áº©N quyáº¿t Ä‘á»‹nh this          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi báº¡n viáº¿t obj.method, JS táº¡o Reference Type (ná»™i bá»™):       â”‚
â”‚                                                                 â”‚
â”‚  Reference = {                                                   â”‚
â”‚    base: obj,          â† object chá»©a property                   â”‚
â”‚    name: "method",     â† tÃªn property                           â”‚
â”‚    strict: false       â† strict mode?                           â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  Khi gá»i obj.method():                                          â”‚
â”‚    â†’ Engine láº¥y Reference.base = obj                            â”‚
â”‚    â†’ Truyá»n obj lÃ m thisArgument                                â”‚
â”‚    â†’ this = obj âœ…                                              â”‚
â”‚                                                                 â”‚
â”‚  Khi gÃ¡n: const fn = obj.method                                 â”‚
â”‚    â†’ getValue(Reference) tráº£ vá» function value                  â”‚
â”‚    â†’ Reference TYPE bá»‹ Máº¤T                                      â”‚
â”‚    â†’ Khi gá»i fn() â†’ khÃ´ng cÃ³ base â†’ thisArgument = undefined   â”‚
â”‚    â†’ this = window (non-strict) / undefined (strict) âŒ         â”‚
â”‚                                                                 â”‚
â”‚  â†’ ÄÃ‚Y lÃ  lÃ½ do "context loss" xáº£y ra khi extract method!      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **GiÃ¡ trá»‹ cá»§a First Principles**: Hiá»ƒu Reference Type giÃºp báº¡n giáº£i thÃ­ch **Má»ŒI** behavior ká»³ láº¡ cá»§a `this` â€” tá»« context loss, Ä‘áº¿n táº¡i sao `(obj.fn)()` hoáº¡t Ä‘á»™ng nhÆ°ng `(obj.fn = obj.fn)()` thÃ¬ khÃ´ng.

#### âš–ï¸ Pattern 3: Trade-off Analysis â€” Dynamic this vs Lexical this

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRADE-OFF MATRIX: Dynamic this vs Lexical this                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  TiÃªu chÃ­        â”‚ Dynamic (regular) â”‚ Lexical (arrow)     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Predictability   â”‚ âŒ Tháº¥p           â”‚ âœ… Cao              â”‚ â”‚
â”‚  â”‚ (Dá»… Ä‘oÃ¡n?)       â”‚ Phá»¥ thuá»™c runtime â”‚ XÃ¡c Ä‘á»‹nh khi viáº¿t   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Flexibility      â”‚ âœ… Cao            â”‚ âŒ Tháº¥p             â”‚ â”‚
â”‚  â”‚ (Linh hoáº¡t?)     â”‚ Method borrowing, â”‚ KhÃ´ng thá»ƒ thay Ä‘á»•i  â”‚ â”‚
â”‚  â”‚                  â”‚ call/apply/bind   â”‚ this báº±ng má»i cÃ¡ch  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Callback safety  â”‚ âŒ Dá»… máº¥t context â”‚ âœ… An toÃ n          â”‚ â”‚
â”‚  â”‚                  â”‚ setTmeout, event  â”‚ LuÃ´n Ä‘Ãºng context   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ OOP (method)     â”‚ âœ… PhÃ¹ há»£p       â”‚ âŒ KhÃ´ng phÃ¹ há»£p    â”‚ â”‚
â”‚  â”‚                  â”‚ this = instance   â”‚ this = outer scope  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Prototype chain  â”‚ âœ… Hoáº¡t Ä‘á»™ng      â”‚ âŒ KhÃ´ng hoáº¡t Ä‘á»™ng   â”‚ â”‚
â”‚  â”‚                  â”‚ new, constructor  â”‚ KhÃ´ng cÃ³ prototype   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Performance      â”‚ â‰ˆ TÆ°Æ¡ng Ä‘Æ°Æ¡ng     â”‚ â‰ˆ TÆ°Æ¡ng Ä‘Æ°Æ¡ng       â”‚ â”‚
â”‚  â”‚ (micro-bench)    â”‚ Thin wrapper      â”‚ No arguments object â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Debugging        â”‚ âš ï¸ KhÃ³ hÆ¡n       â”‚ âœ… Dá»… hÆ¡n           â”‚ â”‚
â”‚  â”‚                  â”‚ this thay Ä‘á»•i     â”‚ this cá»‘ Ä‘á»‹nh        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  GUIDELINES:                                                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•                                                    â”‚
â”‚  âœ… DÃ¹ng ARROW khi:                                              â”‚
â”‚    â†’ Callbacks (setTimeout, .map, .filter, event handlers)      â”‚
â”‚    â†’ Closures cáº§n giá»¯ context                                   â”‚
â”‚    â†’ React functional components & hooks                        â”‚
â”‚                                                                 â”‚
â”‚  âœ… DÃ¹ng REGULAR khi:                                            â”‚
â”‚    â†’ Object methods / class methods                              â”‚
â”‚    â†’ Prototype methods                                           â”‚
â”‚    â†’ Functions cáº§n dynamic this (method borrowing)              â”‚
â”‚    â†’ Constructors / generator functions                          â”‚
â”‚                                                                 â”‚
â”‚  âŒ TRÃNH khi:                                                   â”‚
â”‚    â†’ Arrow function lÃ m object method (this = window)           â”‚
â”‚    â†’ Arrow function lÃ m prototype method                        â”‚
â”‚    â†’ Regular function trong callback mÃ  cáº§n outer this          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ká»‹ch báº£n tháº¥t báº¡i (When it breaks):**

```javascript
// ğŸ“ Ká»‹ch báº£n 1: Arrow function lÃ m Vue method â†’ THáº¤T Báº I
export default {
  data: () => ({
    // âŒ Arrow â†’ this = undefined
    count: 0, // Vue gá»i data() vá»›i this = component instance
  }), // NhÆ°ng arrow function IGNORE implicit binding

  // âœ… FIX: Regular function
  data() {
    return { count: 0 }; // this = component instance âœ…
  },
};

// ğŸ“ Ká»‹ch báº£n 2: Dynamic method dispatch â†’ Arrow THáº¤T Báº I
const EventEmitter = {
  on: (event, handler) => {
    // this = window âŒ â€” khÃ´ng thá»ƒ access this._events
    this._events[event].push(handler);
  },
};
// Arrow function phÃ¹ há»£p cho CONSUMER (callback)
// Regular function phÃ¹ há»£p cho PROVIDER (method)
```

> **CÃ¢u há»i then chá»‘t cho interview**: "Khi nÃ o KHÃ”NG nÃªn dÃ¹ng arrow function?" â†’ Object/class methods, Vue options API, jQuery plugins, prototype methods, generator functions. Biáº¿t khi nÃ o KHÃ”NG dÃ¹ng quan trá»ng hÆ¡n biáº¿t khi nÃ o dÃ¹ng.

#### ğŸ—ºï¸ Pattern 4: Mental Mapping â€” Vá»‹ TrÃ­ cá»§a this Trong Báº£n Äá»“ JS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MENTAL MAP: this Trong Há»‡ Sinh ThÃ¡i JavaScript                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ Táº¦NG á»¨NG Dá»¤NG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  React Hooks: useCallback, useEffect                     â”‚   â”‚
â”‚  â”‚    â†’ Arrow functions â†’ KHÃ”NG Cáº¦N lo vá» this             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  React Class Components:                                  â”‚   â”‚
â”‚  â”‚    â†’ this = component instance                           â”‚   â”‚
â”‚  â”‚    â†’ bind trong constructor / arrow class fields          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Vue Options API:                                         â”‚   â”‚
â”‚  â”‚    â†’ this = component proxy (reactive)                   â”‚   â”‚
â”‚  â”‚    â†’ PHáº¢I dÃ¹ng regular function                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Node.js Express:                                         â”‚   â”‚
â”‚  â”‚    â†’ Middleware: this Ã­t quan trá»ng (req, res, next)      â”‚   â”‚
â”‚  â”‚    â†’ Class controllers: bind hoáº·c arrow methods          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â†• this xuyÃªn qua cÃ¡c táº§ng                                   â”‚
â”‚  â”Œâ”€â”€â”€ Táº¦NG NGÃ”N NGá»® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Execution Context Creation:                              â”‚   â”‚
â”‚  â”‚    â†’ Engine táº¡o context â†’ set ThisBinding                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Scope Chain vs this:                                     â”‚   â”‚
â”‚  â”‚    â†’ Scope: STATIC (lexical) â€” theo nÆ¡i VIáº¾T code        â”‚   â”‚
â”‚  â”‚    â†’ this: DYNAMIC â€” theo cÃ¡ch Gá»ŒI function              â”‚   â”‚
â”‚  â”‚    â†’ Arrow fn: this CÅ¨NG static (lexical)                â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Closure + this:                                          â”‚   â”‚
â”‚  â”‚    â†’ Closure capture BIáº¾N tá»« outer scope                 â”‚   â”‚
â”‚  â”‚    â†’ Closure KHÃ”NG capture this (trá»« arrow fn)           â”‚   â”‚
â”‚  â”‚    â†’ const self = this: biáº¿n this thÃ nh biáº¿n thÆ°á»ng      â”‚   â”‚
â”‚  â”‚      â†’ closure capture self thay vÃ¬ this                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚     â†•                                                           â”‚
â”‚  â”Œâ”€â”€â”€ Táº¦NG ENGINE (V8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Call Stack:                                              â”‚   â”‚
â”‚  â”‚    â†’ Má»—i frame = 1 Execution Context                     â”‚   â”‚
â”‚  â”‚    â†’ Má»—i context CÃ“ ThisBinding riÃªng                    â”‚   â”‚
â”‚  â”‚    â†’ this KHÃ”NG shared qua call stack                    â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Reference Type (internal):                               â”‚   â”‚
â”‚  â”‚    â†’ obj.fn â†’ Reference { base: obj, name: "fn" }       â”‚   â”‚
â”‚  â”‚    â†’ const f = obj.fn â†’ value (Reference bá»‹ máº¥t)        â”‚   â”‚
â”‚  â”‚    â†’ ÄÃ¢y lÃ  CÆ  CHáº¾ quyáº¿t Ä‘á»‹nh implicit binding          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  Hidden Classes / Shapes:                                 â”‚   â”‚
â”‚  â”‚    â†’ this.prop = value (trong constructor)               â”‚   â”‚
â”‚  â”‚    â†’ Engine táº¡o hidden class cho object                  â”‚   â”‚
â”‚  â”‚    â†’ Thá»© tá»± gÃ¡n property áº£nh hÆ°á»Ÿng optimization         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  KEY INSIGHT:                                                    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚  "this" lÃ  Cáº¦U Ná»I giá»¯a FUNCTION vÃ  OBJECT.                    â”‚
â”‚  NÃ³ cho phÃ©p 1 function phá»¥c vá»¥ nhiá»u objects                    â”‚
â”‚  â€” Ä‘Ã¢y chÃ­nh lÃ  ná»n táº£ng cá»§a POLYMORPHISM trong JS.             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Má»‘i liÃªn káº¿t**: Scope chain (Section 10) xÃ¡c Ä‘á»‹nh **biáº¿n nÃ o** function tháº¥y. `this` xÃ¡c Ä‘á»‹nh **object nÃ o** function phá»¥c vá»¥. Arrow function há»£p nháº¥t cáº£ hai: `this` cÅ©ng theo scope chain.

#### ğŸ”§ Pattern 5: Reverse Engineering â€” Tá»± Tay Implement call, apply, bind

**"What I cannot create, I do not understand" â€” Richard Feynman**

CÃ¡ch tá»‘t nháº¥t hiá»ƒu `call`, `apply`, `bind` lÃ  tá»± implement chÃºng:

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ 1. IMPLEMENT Function.prototype.myCall
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NguyÃªn lÃ½: GÃ¡n function táº¡m thá»i lÃ m method cá»§a context
//            â†’ gá»i qua context â†’ implicit binding â†’ this = context
//            â†’ xÃ³a method táº¡m

Function.prototype.myCall = function (context, ...args) {
  // 1. Handle edge: null/undefined â†’ globalThis
  context = context ?? globalThis;

  // 2. Äáº£m báº£o context lÃ  object (trÃ¡nh primitive)
  context = Object(context);

  // 3. Táº¡o unique key Ä‘á»ƒ khÃ´ng Ä‘Ã¨ property cÃ³ sáºµn
  const fnKey = Symbol("temp");

  // 4. GÃ¡n function (this) lÃ m method táº¡m cá»§a context
  //    LÃºc nÃ y "this" = function Ä‘ang gá»i myCall
  context[fnKey] = this;

  // 5. Gá»i qua context â†’ implicit binding â†’ this = context âœ…
  const result = context[fnKey](...args);

  // 6. Cleanup: xÃ³a method táº¡m
  delete context[fnKey];

  return result;
};

// TEST:
function greet(greeting) {
  return `${greeting}, I'm ${this.name}`;
}

greet.myCall({ name: "Alice" }, "Hello"); // "Hello, I'm Alice" âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ 2. IMPLEMENT Function.prototype.myApply
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Giá»‘ng call, nhÆ°ng nháº­n args lÃ  ARRAY

Function.prototype.myApply = function (context, argsArray = []) {
  context = context ?? globalThis;
  context = Object(context);

  const fnKey = Symbol("temp");
  context[fnKey] = this;

  // Spread array thÃ nh individual args
  const result = context[fnKey](...argsArray);

  delete context[fnKey];
  return result;
};

// TEST:
greet.myApply({ name: "Bob" }, ["Hey"]); // "Hey, I'm Bob" âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ 3. IMPLEMENT Function.prototype.myBind
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Phá»©c táº¡p nháº¥t: táº¡o CLOSURE giá»¯ context + partial args
// Pháº£i handle cáº£ trÆ°á»ng há»£p dÃ¹ng vá»›i `new`

Function.prototype.myBind = function (context, ...boundArgs) {
  const originalFn = this; // Giá»¯ reference qua closure

  // Tráº£ vá» function Má»šI
  const boundFn = function (...callArgs) {
    // Náº¿u gá»i vá»›i `new` â†’ this = instance má»›i (new tháº¯ng bind)
    const isNewCall = this instanceof boundFn;

    return originalFn.apply(
      isNewCall ? this : context, // new tháº¯ng bind
      [...boundArgs, ...callArgs], // merge partial + call args
    );
  };

  // Káº¿ thá»«a prototype cho trÆ°á»ng há»£p new
  if (originalFn.prototype) {
    boundFn.prototype = Object.create(originalFn.prototype);
  }

  return boundFn;
};

// TEST:
const aliceGreet = greet.myBind({ name: "Alice" }, "Hi");
aliceGreet(); // "Hi, I'm Alice" âœ…

// TEST vá»›i new:
function Person(name) {
  this.name = name;
}
const BoundPerson = Person.myBind({ name: "Ignored" });
const p = new BoundPerson("Charlie");
console.log(p.name); // "Charlie" âœ… (new tháº¯ng bind)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”‘ INSIGHT tá»« Reverse Engineering:                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. call/apply: Lá»£i dá»¥ng IMPLICIT BINDING                       â”‚
â”‚     â†’ GÃ¡n fn táº¡m lÃ m method â†’ gá»i qua object â†’ xÃ³a             â”‚
â”‚     â†’ Thá»±c cháº¥t lÃ  HACK implicit binding Ä‘á»ƒ set this            â”‚
â”‚                                                                 â”‚
â”‚  2. bind: Táº¡o CLOSURE giá»¯ context                               â”‚
â”‚     â†’ Return function má»›i â†’ closure capture originalFn + contextâ”‚
â”‚     â†’ ÄÃ¢y chÃ­nh lÃ  CLOSURE PATTERN tá»« Section 11!                â”‚
â”‚                                                                 â”‚
â”‚  3. new vs bind: new LUÃ”N THáº®NG                                 â”‚
â”‚     â†’ VÃ¬ new táº¡o object má»›i vÃ  gÃ¡n this = object Ä‘Ã³            â”‚
â”‚     â†’ bind chá»‰ "suggest" this, new "override" nÃ³               â”‚
â”‚                                                                 â”‚
â”‚  4. Symbol: TrÃ¡nh Ä‘Ã¨ property                                   â”‚
â”‚     â†’ DÃ¹ng Symbol() táº¡o key unique â†’ khÃ´ng conflict             â”‚
â”‚     â†’ ÄÃ¢y lÃ  lÃ½ do Symbol Ä‘Æ°á»£c thÃªm vÃ o ES6!                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **Interview gold**: Khi Ä‘Æ°á»£c há»i "implement bind", hÃ£y nhá»› 3 Ä‘iá»ƒm: (1) Closure giá»¯ context, (2) Merge partial args, (3) Handle `new` overriding bind. QuÃªn Ä‘iá»ƒm 3 = máº¥t senior level.

#### ğŸ“œ Pattern 6: Lá»‹ch sá»­ vÃ  Sá»± tiáº¿n hÃ³a â€” this Tá»« 1995 Äáº¿n Nay

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TIMELINE: Sá»± Tiáº¿n HÃ³a cá»§a this trong JavaScript                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1995 â€” JavaScript 1.0 (Netscape Navigator 2.0)                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Brendan Eich thÃªm `this` Ä‘á»ƒ functions hoáº¡t Ä‘á»™ng nhÆ° methods.   â”‚
â”‚  "TrÃ´ng giá»‘ng Java" lÃ  yÃªu cáº§u tá»« marketing (Sun Microsystems).â”‚
â”‚                                                                 â”‚
â”‚  Váº¥n Ä‘á»: JS functions lÃ  first-class values                     â”‚
â”‚  â†’ ChÃºng cÃ³ thá»ƒ tÃ¡ch ra khá»i object â†’ this bá»‹ "orphan"         â”‚
â”‚  â†’ ÄÃ¢y KHÃ”NG pháº£i bug, mÃ  lÃ  consequence cá»§a first-class fns   â”‚
â”‚                                                                 â”‚
â”‚  1999 â€” ECMAScript 3                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  call() vÃ  apply() chÃ­nh thá»©c vÃ o spec.                         â”‚
â”‚  â†’ Giáº£i phÃ¡p: cho phÃ©p developers CHá»ˆ Äá»ŠNH this má»™t cÃ¡ch       â”‚
â”‚    tÆ°á»ng minh khi cáº§n.                                          â”‚
â”‚  â†’ Tuy nhiÃªn, devs váº«n pháº£i nhá»› dÃ¹ng chÃºng má»—i láº§n.            â”‚
â”‚                                                                 â”‚
â”‚  2009 â€” ECMAScript 5                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  bind() ra Ä‘á»i â€” giáº£i quyáº¿t bÃ i toÃ¡n "bind má»™t láº§n, dÃ¹ng mÃ£i." â”‚
â”‚                                                                 â”‚
â”‚  Strict mode ra Ä‘á»i:                                            â”‚
â”‚  â†’ this = undefined (thay vÃ¬ window) khi default binding        â”‚
â”‚  â†’ Loáº¡i bá» "silent error" gÃ¢y security risk                    â”‚
â”‚                                                                 â”‚
â”‚  Pattern phá»• biáº¿n thá»i ká»³ nÃ y:                                  â”‚
â”‚    var self = this;  // LÆ°u this vÃ o biáº¿n trÆ°á»›c khi vÃ o callbackâ”‚
â”‚    var that = this;  // TÃªn khÃ¡c, cÃ¹ng pattern                  â”‚
â”‚                                                                 â”‚
â”‚  2015 â€” ECMAScript 6 (ES2015) â† BÆ¯á»šC NGOáº¶T                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Arrow functions: this = lexical (káº¿ thá»«a tá»« scope cha)         â”‚
â”‚                                                                 â”‚
â”‚  â†’ Giáº£i quyáº¿t TRIá»†T Äá»‚ bÃ i toÃ¡n callback máº¥t context           â”‚
â”‚  â†’ Loáº¡i bá» hoÃ n toÃ n pattern self/that                          â”‚
â”‚  â†’ NhÆ°ng táº¡o ra confusion Má»šI: "khi nÃ o dÃ¹ng arrow,            â”‚
â”‚    khi nÃ o dÃ¹ng regular?"                                       â”‚
â”‚                                                                 â”‚
â”‚  Class syntax cÅ©ng ra Ä‘á»i:                                      â”‚
â”‚  â†’ Syntactic sugar trÃªn prototype + constructor                 â”‚
â”‚  â†’ this trong class methods = instance (implicit binding)       â”‚
â”‚  â†’ NhÆ°ng class methods VáºªN máº¥t context khi extract              â”‚
â”‚                                                                 â”‚
â”‚  2022+ â€” Class Fields & Decorators                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Arrow function as class field:                                  â”‚
â”‚    class Foo {                                                   â”‚
â”‚      handleClick = () => { this.doSomething(); }                â”‚
â”‚    }                                                            â”‚
â”‚  â†’ this LUÃ”N = instance (lexical binding at definition)          â”‚
â”‚  â†’ Trade-off: Má»—i instance táº¡o Báº¢N SAO riÃªng cá»§a method        â”‚
â”‚    (khÃ´ng share qua prototype) â†’ tá»‘n memory hÆ¡n                â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€ Há»ŒC ÄÆ¯á»¢C GÃŒ Tá»ª Lá»ŠCH Sá»¬? â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                                                 â”‚
â”‚  1995: "this thay Ä‘á»•i" = DESIGN CHOICE (flexibility)            â”‚
â”‚  2009: "this gÃ¢y bug" â†’ thÃªm bind() + strict mode               â”‚
â”‚  2015: "this váº«n gÃ¢y bug" â†’ thÃªm arrow function (lexical)       â”‚
â”‚  2022: "context loss trong class" â†’ arrow class fields           â”‚
â”‚                                                                 â”‚
â”‚  â†’ Má»—i giáº£i phÃ¡p giáº£i quyáº¿t 1 váº¥n Ä‘á» nhÆ°ng táº¡o trade-off má»›i  â”‚
â”‚  â†’ Hiá»ƒu lá»‹ch sá»­ = hiá»ƒu Táº I SAO cÃ³ nhiá»u cÃ¡ch lÃ m cÃ¹ng 1 viá»‡c  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**So sÃ¡nh cÃ¡ch xá»­ lÃ½ this qua cÃ¡c thá»i ká»³:**

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVOLUTION: CÃ¹ng 1 bÃ i toÃ¡n, 4 giáº£i phÃ¡p qua 4 thá»i ká»³
// BÃ i toÃ¡n: Giá»¯ this trong setTimeout callback
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// --- 1999 (ES3): DÃ¹ng self/that ---
function Timer_ES3() {
  this.seconds = 0;
  var self = this; // â† Hack #1
  setInterval(function () {
    self.seconds++; // â† DÃ¹ng biáº¿n thÆ°á»ng thay this
  }, 1000);
}

// --- 2009 (ES5): DÃ¹ng bind ---
function Timer_ES5() {
  this.seconds = 0;
  setInterval(
    function () {
      this.seconds++;
    }.bind(this),
    1000,
  ); // â† Hack #2: bind cá»‘ Ä‘á»‹nh this
}

// --- 2015 (ES6): Arrow function ---
function Timer_ES6() {
  this.seconds = 0;
  setInterval(() => {
    this.seconds++; // â† Lexical this â€” CLEAN âœ…
  }, 1000);
}

// --- 2022+ (Class fields): Arrow as class field ---
class Timer_Modern {
  seconds = 0;

  start = () => {
    // â† Arrow field â€” this VÄ¨NH VIá»„N Ä‘Ãºng
    setInterval(() => {
      this.seconds++;
    }, 1000);
  };
}

// Má»—i thá»i ká»³ giáº£i quyáº¿t cÃ¹ng 1 váº¥n Ä‘á»,
// nhÆ°ng solution ngÃ y cÃ ng ELEGANT hÆ¡n.
// Hiá»ƒu evolution = hiá»ƒu táº¡i sao code cÅ© viáº¿t kiá»ƒu Ä‘Ã³.
```

> **Contextual insight**: Khi review legacy code mÃ  tháº¥y `var self = this`, Ä‘á»«ng vá»™i chÃª â€” Ä‘Ã³ lÃ  best practice cá»§a thá»i ES3. Hiá»ƒu bá»‘i cáº£nh giÃºp báº¡n refactor Ä‘Ãºng cÃ¡ch thay vÃ¬ blind-replace.

---

## 13. Prototype & Prototype Chain â€” Chuá»—i NguyÃªn Máº«u

### Tá»•ng Quan: Prototype LÃ  GÃ¬?

**BÃ i viáº¿t â€” Prototype: Linh Há»“n Cá»§a JavaScript MÃ  90% Developers ChÆ°a Hiá»ƒu ÄÃºng**

Náº¿u `this` keyword lÃ  "cÃ¢u há»i runtime" khÃ³ nháº¥t cá»§a JS, thÃ¬ **Prototype** lÃ  "khÃ¡i niá»‡m ná»n táº£ng" bá»‹ hiá»ƒu láº§m nhiá»u nháº¥t. Pháº§n lá»›n developers dÃ¹ng JavaScript hÃ ng ngÃ y nhÆ°ng chÆ°a bao giá» thá»±c sá»± hiá»ƒu prototype hoáº¡t Ä‘á»™ng ra sao â€” há» chá»‰ biáº¿t dÃ¹ng `class`, `extends`, nghÄ© ráº±ng JS cÃ³ "class-based inheritance" giá»‘ng Java/C#. **Sá»± tháº­t: JavaScript KHÃ”NG CÃ“ class tháº­t sá»±.**

ES6 `class` chá»‰ lÃ  **syntactic sugar** â€” lá»›p Ä‘Æ°á»ng cÃº phÃ¡p phá»§ lÃªn cÆ¡ cháº¿ prototype cá»• Ä‘iá»ƒn. Khi báº¡n viáº¿t `class Dog extends Animal {}`, JavaScript engine ná»™i bá»™ váº«n táº¡o prototype chain y há»‡t cÃ¡ch ES5 `Dog.prototype = Object.create(Animal.prototype)`. Hiá»ƒu prototype nghÄ©a lÃ  hiá»ƒu **how JavaScript really works**, khÃ´ng pháº£i "how JavaScript pretends to work".

**Prototype-Based vs Class-Based: Hai TrÆ°á»ng PhÃ¡i Triáº¿t Há»c OOP**

Trong tháº¿ giá»›i láº­p trÃ¬nh hÆ°á»›ng Ä‘á»‘i tÆ°á»£ng, cÃ³ hai trÆ°á»ng phÃ¡i lá»›n mÃ  Ã­t developer nháº­n ra:

- **Class-based OOP** (Java, C#, C++, Python): Báº¡n Ä‘á»‹nh nghÄ©a **class** â€” má»™t báº£n thiáº¿t káº¿ trá»«u tÆ°á»£ng (abstract blueprint). Object lÃ  **instance** Ä‘Æ°á»£c táº¡o ra tá»« class. Class KHÃ”NG pháº£i object â€” nÃ³ lÃ  "kiá»ƒu dá»¯ liá»‡u", tá»“n táº¡i á»Ÿ **compile time**. Káº¿ thá»«a = má»™t class má»›i káº¿ thá»«a tá»« class cÅ© thÃ´ng qua há»‡ thá»‘ng type hierarchy. Má»i thá»© Ä‘á»u Ä‘Æ°á»£c quyáº¿t Ä‘á»‹nh **trÆ°á»›c khi cháº¡y** (static).

- **Prototype-based OOP** (JavaScript, Self, Lua, Io): KhÃ´ng cÃ³ khÃ¡i niá»‡m "class" á»Ÿ má»©c language. Má»i thá»© Ä‘á»u lÃ  **object** tá»“n táº¡i á»Ÿ **runtime**. Káº¿ thá»«a = má»™t object **á»§y thÃ¡c (delegate)** sang object khÃ¡c thÃ´ng qua liÃªn káº¿t prototype. KhÃ´ng cÃ³ "báº£n thiáº¿t káº¿" â€” chá»‰ cÃ³ "object máº«u (exemplar)" mÃ  object khÃ¡c cÃ³ thá»ƒ tham chiáº¿u Ä‘áº¿n. Má»i thá»© Ä‘á»u **dynamic** vÃ  cÃ³ thá»ƒ thay Ä‘á»•i lÃºc runtime.

Sá»± khÃ¡c biá»‡t cá»‘t lÃµi náº±m á»Ÿ **delegation vs instantiation**. Trong class-based OOP, khi báº¡n táº¡o `new Dog()`, engine **copy** structure tá»« class blueprint sang instance má»›i. Trong prototype-based OOP, KHÃ”NG CÃ“ copy â€” instance chá»‰ giá»¯ má»™t **pointer** (liÃªn káº¿t `[[Prototype]]`) Ä‘áº¿n prototype object. Khi cáº§n property, instance **há»i** prototype: "NÃ y, tao khÃ´ng cÃ³ `bark`, mÃ y cÃ³ khÃ´ng?" â€” Ä‘Ã¢y chÃ­nh lÃ  **delegation pattern**.

**Tá»« Self Language Äáº¿n JavaScript: DÃ²ng DÃµi Prototype**

Ãt ai biáº¿t ráº±ng prototype-based OOP cÃ³ nguá»“n gá»‘c tá»« ngÃ´n ngá»¯ **Self** (1986), Ä‘Æ°á»£c phÃ¡t triá»ƒn bá»Ÿi David Ungar vÃ  Randall Smith táº¡i Xerox PARC â€” nÆ¡i sinh ra GUI, Ethernet, vÃ  Smalltalk. Ã tÆ°á»Ÿng cÃ¡ch máº¡ng cá»§a Self lÃ : "Náº¿u má»i thá»© Ä‘á»u lÃ  object, vÃ  object cÃ³ thá»ƒ clone tá»« object khÃ¡c, táº¡i sao cáº§n class?" Self chá»©ng minh ráº±ng prototype-based OOP **Ä‘Æ¡n giáº£n hÆ¡n** (Ã­t concepts) vÃ  **máº¡nh máº½ tÆ°Æ¡ng Ä‘Æ°Æ¡ng** class-based.

Brendan Eich â€” ngÆ°á»i táº¡o ra JavaScript nÄƒm 1995 táº¡i Netscape â€” Ä‘Ã£ láº¥y cáº£m há»©ng trá»±c tiáº¿p tá»« **Self** (prototype model) vÃ  **Scheme** (first-class functions, closures). Ban Ä‘áº§u Eich muá»‘n nhÃºng Scheme vÃ o browser, nhÆ°ng Netscape yÃªu cáº§u ngÃ´n ngá»¯ pháº£i "trÃ´ng giá»‘ng Java" (thá»a thuáº­n marketing vá»›i Sun Microsystems). Káº¿t quáº£: JS cÃ³ cÃº phÃ¡p `new`, `this`, `constructor` giá»‘ng Java, nhÆ°ng **cÆ¡ cháº¿ bÃªn dÆ°á»›i hoÃ n toÃ n prototype-based** nhÆ° Self. ÄÃ¢y lÃ  nguá»“n gá»‘c cá»§a má»i nháº§m láº«n: cÃº phÃ¡p nÃ³i "class", cÆ¡ cháº¿ nÃ³i "prototype".

**Delegation Pattern â€” TrÃ¡i Tim Cá»§a Prototype**

Äá»ƒ thá»±c sá»± hiá»ƒu prototype, báº¡n cáº§n hiá»ƒu **delegation (á»§y thÃ¡c)**. Trong class-based inheritance, child class **copy** methods tá»« parent class (Ã­t nháº¥t á»Ÿ má»©c conceptual). Trong prototype-based, child object KHÃ”NG copy gÃ¬ cáº£ â€” nÃ³ chá»‰ giá»¯ má»™t **liÃªn káº¿t (link)** Ä‘áº¿n prototype. Khi runtime cáº§n má»™t method, nÃ³ **á»§y thÃ¡c** request lÃªn prototype. Náº¿u prototype khÃ´ng cÃ³, request tiáº¿p tá»¥c Ä‘Æ°á»£c á»§y thÃ¡c lÃªn prototype cá»§a prototype â€” táº¡o thÃ nh **delegation chain** (prototype chain).

Delegation cÃ³ Æ°u Ä‘iá»ƒm lá»›n: **thay Ä‘á»•i trÃªn prototype ngay láº­p tá»©c áº£nh hÆ°á»Ÿng táº¥t cáº£ objects** Ä‘ang delegate Ä‘áº¿n nÃ³. Báº¡n thÃªm `Array.prototype.customMethod = ...` â†’ ngay láº­p tá»©c Má»ŒI array trong á»©ng dá»¥ng cÃ³ method má»›i mÃ  KHÃ”NG Cáº¦N táº¡o láº¡i. Trong class-based, báº¡n pháº£i recompile hoáº·c dÃ¹ng monkey-patching phá»©c táº¡p.

**3 KhÃ¡i Niá»‡m Then Chá»‘t Cáº§n Náº¯m Ngay:**

1. **`prototype`** (hiá»ƒn â€” visible property): Má»—i function cÃ³ property `.prototype` â€” Ä‘Ã¢y lÃ  object sáº½ trá»Ÿ thÃ nh "khuÃ´n máº«u" cho táº¥t cáº£ instances Ä‘Æ°á»£c táº¡o bá»Ÿi `new`
2. **`__proto__`** (áº©n â€” hidden link): Má»—i object cÃ³ internal slot `[[Prototype]]` (truy cáº­p qua `__proto__` hoáº·c `Object.getPrototypeOf()`) â€” Ä‘Ã¢y lÃ  con trá» Ä‘áº¿n prototype object mÃ  nÃ³ káº¿ thá»«a
3. **Prototype Chain**: Chuá»—i `__proto__` liÃªn tiáº¿p: `instance â†’ Constructor.prototype â†’ ... â†’ Object.prototype â†’ null`. Khi JS tÃ¬m property, nÃ³ duyá»‡t chain nÃ y tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i.

**Mental Model Thá»±c Táº¿ â€” NghÄ© Prototype NhÆ° Tháº¿ NÃ o?**

CÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ hÃ¬nh dung prototype: hÃ£y nghÄ© má»—i object trong JS nhÆ° má»™t **nhÃ¢n viÃªn trong tá»• chá»©c**. Khi nhÃ¢n viÃªn (instance) nháº­n Ä‘Æ°á»£c má»™t yÃªu cáº§u (property access), anh ta trÆ°á»›c tiÃªn kiá»ƒm tra **ká»¹ nÄƒng riÃªng** (own properties). Náº¿u khÃ´ng biáº¿t, anh ta há»i **ngÆ°á»i hÆ°á»›ng dáº«n** (prototype). Náº¿u ngÆ°á»i hÆ°á»›ng dáº«n cÅ©ng khÃ´ng biáº¿t, anh ta há»i **ngÆ°á»i hÆ°á»›ng dáº«n cá»§a ngÆ°á»i hÆ°á»›ng dáº«n** (prototype chain). Chuá»—i nÃ y tiáº¿p tá»¥c cho Ä‘áº¿n khi tá»›i **CEO** (`Object.prototype`) â€” náº¿u cáº£ CEO cÅ©ng khÃ´ng biáº¿t, káº¿t quáº£ lÃ  `undefined` (khÃ´ng ai biáº¿t).

Táº¡i sao model nÃ y há»¯u Ã­ch? VÃ¬ nÃ³ giáº£i thÃ­ch trá»±c giÃ¡c táº¡i sao:

- **Äá»c (read)** duyá»‡t chain lÃªn trÃªn: nhÃ¢n viÃªn há»i cáº¥p trÃªn
- **Ghi (write)** chá»‰ áº£nh hÆ°á»Ÿng nhÃ¢n viÃªn: nhÃ¢n viÃªn há»c ká»¹ nÄƒng má»›i, khÃ´ng thay Ä‘á»•i ngÆ°á»i hÆ°á»›ng dáº«n
- **Thay Ä‘á»•i prototype** áº£nh hÆ°á»Ÿng táº¥t cáº£: náº¿u ngÆ°á»i hÆ°á»›ng dáº«n há»c ká»¹ nÄƒng má»›i, táº¥t cáº£ nhÃ¢n viÃªn dÆ°á»›i quyá»n Ä‘á»u cÃ³ thá»ƒ "há»i" vÃ  sá»­ dá»¥ng ká»¹ nÄƒng Ä‘Ã³

> **Analogy â€” DNA vÃ  Di Truyá»n**: Prototype giá»‘ng nhÆ° DNA template. Má»—i instance "thá»«a káº¿" traits tá»« prototype, nhÆ°ng cÅ©ng cÃ³ thá»ƒ cÃ³ "mutations" (own properties) riÃªng. Khi kiá»ƒm tra má»™t trait, há»‡ thá»‘ng tÃ¬m trÃªn instance trÆ°á»›c, rá»“i ngÆ°á»£c lÃªn prototype chain â€” giá»‘ng cÃ¡ch di truyá»n há»c kiá»ƒm tra gene dominance.

> **Interview insight**: CÃ¢u há»i "Giáº£i thÃ­ch prototype chain" lÃ  cÃ¢u há»i **báº¯t buá»™c** trong má»i interview JS senior. KhÃ´ng hiá»ƒu prototype = khÃ´ng hiá»ƒu JavaScript. Khi tráº£ lá»i, hÃ£y báº¯t Ä‘áº§u tá»« "JavaScript dÃ¹ng prototype-based inheritance, KHÃ”NG pháº£i class-based" â€” cÃ¢u nÃ y ngay láº­p tá»©c cho interviewer biáº¿t báº¡n hiá»ƒu Ä‘Ãºng báº£n cháº¥t.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROTOTYPE â€” CÆ  CHáº¾ Káº¾ THá»ªA Cá»¦A JAVASCRIPT â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”‚
â”‚ ğŸ“Œ JavaScript KHÃ”NG cÃ³ class-based inheritance "tháº­t sá»±" â”‚
â”‚ JavaScript dÃ¹ng PROTOTYPE-BASED inheritance â”‚
â”‚ (ES6 class chá»‰ lÃ  syntactic sugar trÃªn prototype) â”‚
â”‚ â”‚
â”‚ ğŸ“Œ 3 Má»I QUAN Há»† Cá»T LÃ•I: â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. Má»—i Function cÃ³ property: prototype (hiá»ƒn) â”‚ â”‚
â”‚ â”‚ 2. Má»—i Object cÃ³ property: **proto** (áº©n) â”‚ â”‚
â”‚ â”‚ 3. instance.**proto** === Constructor.prototype â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Constructor Function â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ Person â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ .prototype â”€â”€â”€â”€â”€â”€â†’ Person.prototype â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ constructor â”€â”€â”€â”€â”€â†’ Person â”‚ â”‚
â”‚ â”‚ â”‚ sayHello() â”‚ â”‚ â”‚
â”‚ â”‚ new â”‚ **proto** â”€â”€â”€â”€â”€â”€â”€â†’ Object â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ .proto â”‚ â”‚
â”‚ â”‚ â–¼ â–² â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ instance â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ .name â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ .**proto** â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

````

### Prototype: NguyÃªn Máº«u Cá»§a Function

**BÃ i viáº¿t â€” `.prototype`: Báº£n Blueprint MÃ  Engine Tá»± Táº¡o Cho Má»—i Function**

ÄÃ¢y lÃ  sá»± tháº­t Ã­t ai biáº¿t: **má»—i khi báº¡n viáº¿t `function Foo() {}`**, JavaScript engine Láº¬P Tá»¨C táº¡o thÃªm má»™t object rá»—ng `{ constructor: Foo }` vÃ  gÃ¡n nÃ³ vÃ o `Foo.prototype`. Báº¡n KHÃ”NG yÃªu cáº§u engine lÃ m Ä‘iá»u nÃ y â€” nÃ³ xáº£y ra tá»± Ä‘á»™ng. Object nÃ y chÃ­nh lÃ  "báº£n blueprint" mÃ  táº¥t cáº£ instances táº¡o bá»Ÿi `new Foo()` sáº½ káº¿ thá»«a.

**CÆ¡ cháº¿ ná»™i bá»™**: Khi V8 parse `function Person(name) { ... }`, nÃ³ táº¡o function object vá»›i internal slot `[[Prototype]]` trá» Ä‘áº¿n `Function.prototype`, Ä‘á»“ng thá»i táº¡o property `Person.prototype` â€” má»™t plain object chá»©a duy nháº¥t property `constructor` trá» ngÆ°á»£c vá» `Person`. Má»‘i quan há»‡ hai chiá»u `Person â†” Person.prototype` hÃ¬nh thÃ nh cáº·p Ä‘Ã´i inseparable.

**Constructor Property â€” VÃ²ng Tham Chiáº¿u CÃ³ ChuyÃªn Ã**

Property `.constructor` trÃªn `Person.prototype` trá» ngÆ°á»£c vá» `Person` â€” táº¡o thÃ nh **circular reference** (vÃ²ng tham chiáº¿u). ÄÃ¢y KHÃ”NG pháº£i bug, mÃ  lÃ  design cÃ³ chá»§ Ä‘Ã­ch. Táº¡i sao?

1. **Táº¡o sibling instances**: Khi báº¡n cÃ³ `instance` nhÆ°ng khÃ´ng biáº¿t constructor name, báº¡n cÃ³ thá»ƒ dÃ¹ng `const clone = new instance.constructor(args)` Ä‘á»ƒ táº¡o object cÃ¹ng loáº¡i. ÄÃ¢y lÃ  pattern cá»±c ká»³ há»¯u Ã­ch trong generic programming.
2. **Type identification**: `instance.constructor.name` cho báº¡n tÃªn constructor â€” dÃ¹ng cho logging, debugging, serialization.
3. **Factory pattern**: Libraries nhÆ° Lodash dÃ¹ng `.constructor` Ä‘á»ƒ táº¡o wrapper objects Ä‘Ãºng type mÃ  khÃ´ng cáº§n hardcode constructor name.

NhÆ°ng `.constructor` cÃ³ **weakness lá»›n**: nÃ³ lÃ  property thÃ´ng thÆ°á»ng, cÃ³ thá»ƒ bá»‹ ghi Ä‘Ã¨ hoáº·c máº¥t. Khi báº¡n gÃ¡n `Foo.prototype = { ... }` (thay tháº¿ toÃ n bá»™ prototype), `.constructor` biáº¿n máº¥t â€” Ä‘Ã¢y lÃ  Gotcha #1 kinh Ä‘iá»ƒn.

**Táº¡i sao `.prototype` chá»‰ cÃ³ á»Ÿ function?** VÃ¬ chá»‰ function má»›i cÃ³ thá»ƒ Ä‘Ã³ng vai constructor (trá»« arrow function). Má»™t plain object nhÆ° `const obj = {}` KHÃ”NG cÃ³ `.prototype` property â€” nÃ³ chá»‰ cÃ³ `__proto__` (internal `[[Prototype]]`). ÄÃ¢y lÃ  nguá»“n nháº§m láº«n #1: **`.prototype` â‰  `__proto__`**.

Cá»¥ thá»ƒ hÆ¡n, KHÃ”NG PHáº¢I má»i function Ä‘á»u cÃ³ `.prototype`:

| Loáº¡i Function | CÃ³ `.prototype`? | DÃ¹ng `new`? | LÃ½ Do |
|---|---|---|---|
| `function foo() {}` (declaration) | âœ… CÃ³ | âœ… ÄÆ°á»£c | Constructor function truyá»n thá»‘ng |
| `const foo = function() {}` (expression) | âœ… CÃ³ | âœ… ÄÆ°á»£c | TÆ°Æ¡ng tá»± declaration |
| `const foo = () => {}` (arrow) | âŒ KHÃ”NG | âŒ KhÃ´ng | Arrow function khÃ´ng cÃ³ `this` riÃªng, khÃ´ng thá»ƒ lÃ m constructor |
| `{ foo() {} }` (method shorthand) | âœ… CÃ³ | âœ… ÄÆ°á»£c* | Technically cÃ³, nhÆ°ng dÃ¹ng `new` sáº½ throw trong strict mode |
| `class Foo {}` (class) | âœ… CÃ³ | âœ… ÄÆ°á»£c | Class báº¯t buá»™c dÃ¹ng `new` (throw náº¿u gá»i thÆ°á»ng) |
| `async function foo() {}` | âœ… CÃ³ | âŒ KhÃ´ng | Async function khÃ´ng thá»ƒ dÃ¹ng `new` |
| `function* foo() {}` (generator) | âœ… CÃ³ | âŒ KhÃ´ng | Generator protocol khÃ¡c vá»›i constructor protocol |

**Memory Model â€” Shared vs Own**: Khi báº¡n thÃªm method vÃ o `Person.prototype.greet = function() {}`, method nÃ y tá»“n táº¡i **DUY NHáº¤T Má»˜T Láº¦N** trong memory. 1000 instances Ä‘á»u pointer Ä‘áº¿n cÃ¹ng function object Ä‘Ã³. NgÆ°á»£c láº¡i, náº¿u gÃ¡n trong constructor `this.greet = function() {}`, báº¡n táº¡o **1000 copies riÃªng biá»‡t** â€” lÃ£ng phÃ­ memory. ÄÃ¢y lÃ  lÃ½ do prototype pattern tiáº¿t kiá»‡m memory hÆ¡n.

Äá»ƒ hiá»ƒu rÃµ hÆ¡n, hÃ£y xem V8 xá»­ lÃ½ memory tháº¿ nÃ o:

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  MEMORY LAYOUT: Prototype Methods vs Constructor Methods    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  ğŸŸ¢ Prototype Method (Person.prototype.greet):                â•‘
â•‘                                                               â•‘
â•‘  HEAP:  [Function: greet] â† CHá»ˆ 1 OBJECT TRONG MEMORY       â•‘
â•‘           â–²    â–²    â–²                                         â•‘
â•‘           â”‚    â”‚    â”‚                                         â•‘
â•‘  alice â”€â”€â”€â”˜    â”‚    â”‚    â† 1000 instances cÃ¹ng trá» Ä‘áº¿n       â•‘
â•‘  bob   â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       1 function object duy nháº¥t       â•‘
â•‘  charlie â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â•‘
â•‘                                                               â•‘
â•‘  Memory = 1 function + 1000 pointers â‰ˆ 1 function            â•‘
â•‘                                                               â•‘
â•‘  ğŸ”´ Constructor Method (this.greet = function() {}):          â•‘
â•‘                                                               â•‘
â•‘  HEAP:  [Function: greet#1]  â† alice.greet                    â•‘
â•‘         [Function: greet#2]  â† bob.greet                      â•‘
â•‘         [Function: greet#3]  â† charlie.greet                  â•‘
â•‘         ...                                                   â•‘
â•‘         [Function: greet#1000]                                 â•‘
â•‘                                                               â•‘
â•‘  Memory = 1000 function objects â‰ˆ 1000x memory usage!        â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**V8 Hidden Classes â€” Prototype GiÃºp Tá»‘i Æ¯u Tá»‘c Äá»™**

NgoÃ i memory, prototype cÃ²n giÃºp V8 tá»‘i Æ°u **tá»‘c Ä‘á»™ truy cáº­p**. V8 dÃ¹ng há»‡ thá»‘ng **Hidden Classes** (cÃ²n gá»i Maps/Shapes): khi nhiá»u objects cÃ³ cÃ¹ng "shape" (cÃ¹ng properties, cÃ¹ng thá»© tá»±), chÃºng share hidden class. Khi táº¥t cáº£ instances Ä‘á»u dÃ¹ng methods tá»« prototype (thay vÃ¬ má»—i instance cÃ³ own methods), chÃºng giá»¯ **cÃ¹ng shape** â†’ V8 cÃ³ thá»ƒ dÃ¹ng **Inline Cache** hiá»‡u quáº£: "Láº§n trÆ°á»›c `alice.greet` found á»Ÿ offset X trÃªn prototype, láº§n nÃ y skip chain traversal, Ä‘i tháº³ng Ä‘áº¿n offset X."

NgÆ°á»£c láº¡i, náº¿u má»—i instance cÃ³ own method `this.greet = function() {}`, má»—i instance váº«n cÃ¹ng shape nhÆ°ng **function reference khÃ¡c nhau** â€” IC váº«n hoáº¡t Ä‘á»™ng, nhÆ°ng báº¡n Ä‘Ã£ **lÃ£ng phÃ­ memory** cho 1000 copies khÃ´ng cáº§n thiáº¿t.

**Pre-ES6: Prototype NhÆ° Module Pattern**

TrÆ°á»›c ES6 modules, developers thÆ°á»ng dÃ¹ng prototype Ä‘á»ƒ tá»• chá»©c code theo module:

```javascript
// Module pattern via IIFE + Prototype (pre-ES6)
var EventEmitter = (function() {
  function EventEmitter() {
    this._events = {};
  }
  EventEmitter.prototype.on = function(event, fn) { /* ... */ };
  EventEmitter.prototype.emit = function(event, data) { /* ... */ };
  EventEmitter.prototype.off = function(event, fn) { /* ... */ };
  return EventEmitter;
})();
```

Pattern nÃ y káº¿t há»£p **IIFE** (táº¡o private scope) + **prototype** (shared methods) + **constructor** (instance state). NÃ³ lÃ  tiá»n thÃ¢n trá»±c tiáº¿p cá»§a ES6 `class` syntax â€” vÃ  náº¿u báº¡n nhÃ¬n transpiled output cá»§a Babel/TypeScript khi compile `class`, báº¡n sáº½ tháº¥y pattern gáº§n giá»‘ng há»‡t.

> **Interview tip**: Khi interviewer há»i "táº¡i sao nÃªn Ä‘áº·t method vÃ o prototype thay vÃ¬ constructor?", answer nÃªn cover 3 Ä‘iá»ƒm: (1) **Memory efficiency** â€” method SHARED thay vÃ¬ DUPLICATED, (2) **V8 optimization** â€” cÃ¹ng shape â†’ inline cache hiá»‡u quáº£, (3) **Live updates** â€” thÃªm method vÃ o prototype sau khi táº¡o instances, táº¥t cáº£ instances tá»± Ä‘á»™ng cÃ³ method má»›i.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Má»—i FUNCTION cÃ³ property .prototype (object)
// Prototype object chá»©a constructor trá» vá» chÃ­nh function
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Person(name) {
  this.name = name;
}

// Person.prototype lÃ  object Ä‘Æ°á»£c táº¡o Tá»° Äá»˜NG khi define function
console.log(Person.prototype);
// { constructor: Person }

// constructor trá» ngÆ°á»£c vá» function
console.log(Person.prototype.constructor === Person); // true âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ThÃªm method vÃ o prototype â†’ Táº¤T Cáº¢ instances Ä‘á»u káº¿ thá»«a
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Person.prototype.sayHello = function () {
  return `Hi, I'm ${this.name}`;
};

const alice = new Person("Alice");
const bob = new Person("Bob");

alice.sayHello(); // "Hi, I'm Alice"
bob.sayHello(); // "Hi, I'm Bob"

// Cáº£ alice vÃ  bob DÃ™NG CHUNG method trÃªn prototype
console.log(alice.sayHello === bob.sayHello); // true âœ…
// â†’ Tiáº¿t kiá»‡m memory! Method chá»‰ tá»“n táº¡i 1 láº§n trÃªn prototype
````

### \_\_proto\_\_: LiÃªn Káº¿t áº¨n Cá»§a Instance

**BÃ i viáº¿t â€” `[[Prototype]]` Internal Slot: Con Trá» BÃ­ Máº­t Quyáº¿t Äá»‹nh Báº£n Cháº¥t Má»i Object**

Náº¿u `.prototype` lÃ  property **hiá»ƒn** (visible) chá»‰ function má»›i cÃ³, thÃ¬ `[[Prototype]]` lÃ  slot **áº©n** (internal) mÃ  **Má»ŒI object** Ä‘á»u sá»Ÿ há»¯u â€” tá»« plain object `{}` Ä‘áº¿n array `[]`, function, regex, tháº­m chÃ­ cáº£ `Date`, `Map`, `WeakSet`. ÄÃ¢y lÃ  con trá» bÃ­ máº­t káº¿t ná»‘i má»—i object vÃ o prototype chain, vÃ  nÃ³ lÃ  **cÆ¡ cháº¿ duy nháº¥t** cho phÃ©p káº¿ thá»«a trong JavaScript hoáº¡t Ä‘á»™ng.

**Táº¡i Sao Gá»i LÃ  "Internal Slot"?**

Trong ECMAScript specification, `[[Prototype]]` Ä‘Æ°á»£c ghi báº±ng **double brackets** â€” kÃ½ hiá»‡u dÃ nh cho internal slots. Internal slots KHÃ”NG pháº£i properties â€” báº¡n khÃ´ng thá»ƒ `Object.keys()` tháº¥y chÃºng, khÃ´ng thá»ƒ `delete` chÃºng, khÃ´ng thá»ƒ dÃ¹ng `in` operator kiá»ƒm tra. ChÃºng tá»“n táº¡i á»Ÿ táº§ng **engine ná»™i bá»™**, ngoÃ i táº§m vá»›i cá»§a JavaScript code thÃ´ng thÆ°á»ng. CÃ¡c internal slots khÃ¡c báº¡n cÃ³ thá»ƒ Ä‘Ã£ gáº·p: `[[Call]]` (cho phÃ©p function Ä‘Æ°á»£c gá»i), `[[Construct]]` (cho phÃ©p dÃ¹ng `new`), `[[Value]]` (giÃ¡ trá»‹ tháº­t cá»§a wrapper objects).

Tuy nhiÃªn, vÃ¬ `[[Prototype]]` quÃ¡ quan trá»ng trong thá»±c táº¿, lá»‹ch sá»­ browser Ä‘Ã£ táº¡o ra "cá»­a háº­u" Ä‘á»ƒ truy cáº­p nÃ³: accessor `__proto__` (Ä‘á»c lÃ  "dunder proto" â€” viáº¿t táº¯t cá»§a "double underscore proto").

**Lá»‹ch Sá»­ Há»—n Loáº¡n Cá»§a `__proto__` â€” CÃ¢u Chuyá»‡n Standardization Ká»³ Láº¡ Nháº¥t:**

CÃ¢u chuyá»‡n `__proto__` lÃ  má»™t trong nhá»¯ng vÃ­ dá»¥ tá»‘t nháº¥t vá» "wild west" cá»§a web standards:

1. **1998 â€” SpiderMonkey (Firefox engine)**: Mozilla triá»ƒn khai `__proto__` nhÆ° **non-standard extension**, cho phÃ©p developers Ä‘á»c/ghi `[[Prototype]]` slot. KhÃ´ng cÃ³ spec nÃ o quy Ä‘á»‹nh Ä‘iá»u nÃ y â€” Mozilla tá»± quyáº¿t.
2. **2000s â€” De-facto adoption**: Chrome (V8), Safari (JSC), Opera láº§n lÆ°á»£t implement `__proto__` vÃ¬ web pages Ä‘Ã£ phá»¥ thuá»™c vÃ o nÃ³. KhÃ´ng implement = khÃ´ng compatible = máº¥t users.
3. **2011 â€” Cuá»™c tranh luáº­n ká»‹ch liá»‡t**: TC39 tranh cÃ£i gay gáº¯t: liá»‡u cÃ³ nÃªn chÃ­nh thá»©c hÃ³a `__proto__`? Phe pháº£n Ä‘á»‘i: "NÃ³ phÃ¡ vá»¡ encapsulation, cho phÃ©p mutate prototype chain tÃ¹y Ã½." Phe á»§ng há»™: "HÃ ng triá»‡u web pages phá»¥ thuá»™c vÃ o nÃ³, khÃ´ng thá»ƒ remove."
4. **2015 â€” ES2015 Compromise**: `__proto__` Ä‘Æ°á»£c Ä‘Æ°a vÃ o spec nhÆ°ng **chá»‰ á»Ÿ Annex B** â€” pháº§n dÃ nh cho "legacy features that implementors SHOULD support for web browser compatibility but SHOULD NOT use in new code." Äá»“ng thá»i, `Object.getPrototypeOf()` (ES5) vÃ  `Object.setPrototypeOf()` (ES2015) trá»Ÿ thÃ nh standard API chÃ­nh thá»©c.

**Best practice hiá»‡n Ä‘áº¡i:**

- **Äá»c prototype**: `Object.getPrototypeOf(obj)` âœ… â€” KHÃ”NG dÃ¹ng `obj.__proto__`
- **Ghi prototype**: `Object.setPrototypeOf(obj, newProto)` âœ… â€” KHÃ”NG dÃ¹ng `obj.__proto__ = newProto`
- **LÃ½ do**: `__proto__` lÃ  accessor property trÃªn `Object.prototype`. Náº¿u object khÃ´ng káº¿ thá»«a tá»« `Object.prototype` (vÃ­ dá»¥ `Object.create(null)`), `__proto__` khÃ´ng tá»“n táº¡i â†’ code bá»‹ lá»—i im láº·ng. `Object.getPrototypeOf()` luÃ´n hoáº¡t Ä‘á»™ng Ä‘Ãºng.

**`__proto__` Hoáº¡t Äá»™ng Tháº¿ NÃ o á» Má»©c Engine?**

ÄÃ¢y lÃ  Ä‘iá»u Ã­t developer biáº¿t: `__proto__` KHÃ”NG pháº£i own property trÃªn má»—i object. NÃ³ lÃ  **accessor property** (getter/setter) Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a **DUY NHáº¤T Má»˜T Láº¦N** trÃªn `Object.prototype`:

```javascript
// Chá»©ng minh __proto__ lÃ  accessor property trÃªn Object.prototype:
const descriptor = Object.getOwnPropertyDescriptor(
  Object.prototype,
  "__proto__",
);
console.log(descriptor);
// {
//   get: [Function: get __proto__],   â† getter
//   set: [Function: set __proto__],   â† setter
//   enumerable: false,
//   configurable: true
// }

// Khi báº¡n viáº¿t: obj.__proto__
// Engine thá»±c hiá»‡n: Object.prototype.__proto__(getter).call(obj)
// â†’ getter bÃªn trong Ä‘á»c obj.[[Prototype]] internal slot
```

Äiá»u nÃ y giáº£i thÃ­ch táº¡i sao `Object.create(null).__proto__` tráº£ vá» `undefined` â€” vÃ¬ object Ä‘Ã³ KHÃ”NG káº¿ thá»«a tá»« `Object.prototype`, nÃªn KHÃ”NG cÃ³ getter `__proto__`.

**Tam GiÃ¡c Quan Há»‡ â€” Trá»¥ Cá»™t Cá»§a Prototype System:**

```
Constructor â†â”€â”€ .constructor â”€â”€ Constructor.prototype
    â”‚                              â–²
    â”‚ new                          â”‚ __proto__
    â–¼                              â”‚
  Instance â”€â”€â”€ .__proto__ â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Ba Ä‘á»‰nh tam giÃ¡c nÃ y (Constructor, Prototype, Instance) táº¡o thÃ nh **ná»n táº£ng** cá»§a toÃ n bá»™ OOP trong JS. HÃ£y phÃ¢n tÃ­ch tá»«ng cáº¡nh:

- **Cáº¡nh 1**: `Constructor.prototype` â†’ Object chá»©a shared methods. Má»—i function táº¡o sáºµn object nÃ y.
- **Cáº¡nh 2**: `Instance.__proto__ === Constructor.prototype` â†’ Khi `new` táº¡o instance, engine gÃ¡n `[[Prototype]]` slot cá»§a instance trá» Ä‘áº¿n `Constructor.prototype`. ÄÃ¢y lÃ  **cáº¡nh káº¿ thá»«a** â€” lÃ½ do instance cÃ³ thá»ƒ dÃ¹ng methods trÃªn prototype.
- **Cáº¡nh 3**: `Constructor.prototype.constructor === Constructor` â†’ Prototype trá» ngÆ°á»£c vá» constructor function. ÄÃ¢y lÃ  **cáº¡nh nháº­n dáº¡ng** â€” cho phÃ©p tá»« instance tÃ¬m ra constructor (`instance.constructor`).

Táº¡i sao mÃ´ hÃ¬nh tam giÃ¡c nÃ y quan trá»ng Ä‘áº¿n váº­y? VÃ¬ **Má»ŒI interaction** vá»›i OOP trong JS Ä‘á»u xoay quanh 3 má»‘i quan há»‡ nÃ y. `instanceof` kiá»ƒm tra cáº¡nh 2 (chain). `new` táº¡o cáº¡nh 2. `extends` ná»‘i hai tam giÃ¡c chá»“ng lÃªn nhau. Khi debug prototype issues, luÃ´n quay láº¡i tam giÃ¡c: cáº¡nh nÃ o bá»‹ Ä‘á»©t?

**`Object.create(null)` â€” Khi Báº¡n Muá»‘n Object "NguyÃªn Thá»§y":**

`Object.create(null)` táº¡o object **hoÃ n toÃ n trá»‘ng** â€” khÃ´ng cÃ³ prototype, khÃ´ng cÃ³ `toString()`, `valueOf()`, hay báº¥t ká»³ method nÃ o. Táº¡i sao Ä‘iá»u nÃ y há»¯u Ã­ch?

1. **Pure dictionary/map**: Khi báº¡n dÃ¹ng object lÃ m dictionary, inherited properties tá»« `Object.prototype` cÃ³ thá»ƒ gÃ¢y xung Ä‘á»™t. `"toString" in normalObj` â†’ `true` (surprise!). `"toString" in Object.create(null)` â†’ `false` (clean).
2. **JSON-like objects**: Khi parse untrusted JSON, `Object.create(null)` ngÄƒn prototype pollution attacks.
3. **Performance**: V8 cÃ³ optimization Ä‘áº·c biá»‡t cho "dictionary mode" objects â€” `Object.create(null)` cÃ³ thá»ƒ nhanh hÆ¡n cho property lookup patterns kiá»ƒu dictionary.

ÄÃ¢y cÅ©ng lÃ  pattern Ä‘Æ°á»£c **vue-router**, **vuex**, vÃ  nhiá»u libraries sá»­ dá»¥ng ná»™i bá»™ Ä‘á»ƒ táº¡o hash maps sáº¡ch.

**Prototype Pollution â€” Má»‘i Nguy Báº£o Máº­t Thá»±c Táº¿:**

VÃ¬ `__proto__` cho phÃ©p **ghi** vÃ o prototype chain, nÃ³ má»Ÿ ra attack vector gá»i lÃ  **prototype pollution**:

```javascript
// Attacker gá»­i JSON: { "__proto__": { "isAdmin": true } }
const userInput = JSON.parse('{"__proto__": {"isAdmin": true}}');
// Náº¿u app merge userInput vÃ o object báº±ng cÃ¡ch khÃ´ng cáº©n tháº­n:
function merge(target, source) {
  for (let key in source) {
    target[key] = source[key]; // âš ï¸ key = "__proto__" â†’ pollute!
  }
}
// BÃ¢y giá» Má»ŒI object Ä‘á»u cÃ³ .isAdmin === true!
```

ÄÃ¢y khÃ´ng pháº£i lÃ½ thuyáº¿t â€” prototype pollution Ä‘Ã£ gÃ¢y ra CVEs thá»±c táº¿ trong **Lodash** (CVE-2019-10744), **jQuery** (CVE-2019-11358), **Handlebars**, **Express**. CÃ¡ch phÃ²ng chá»‘ng: (1) Validate keys, filter `__proto__`, `constructor`, `prototype`, (2) DÃ¹ng `Object.create(null)` cho dictionaries, (3) DÃ¹ng `Map` thay vÃ¬ plain objects cho dynamic key-value.

**Cáº£nh BÃ¡o Hiá»‡u Suáº¥t â€” `Object.setPrototypeOf()` LÃ  Operation Äáº¯t Äá»:**

Thay Ä‘á»•i prototype cá»§a object **SAU khi táº¡o** lÃ  operation cá»±c ká»³ tá»‘n kÃ©m. V8 (vÃ  cÃ¡c engines khÃ¡c) tá»‘i Æ°u dá»±a trÃªn giáº£ Ä‘á»‹nh ráº±ng **prototype chain khÃ´ng thay Ä‘á»•i**. Khi báº¡n gá»i `Object.setPrototypeOf()`, engine pháº£i:

1. Invalidate toÃ n bá»™ inline caches liÃªn quan Ä‘áº¿n object nÃ y
2. Thay Ä‘á»•i hidden class/shape cá»§a object
3. De-optimize báº¥t ká»³ JIT-compiled code nÃ o phá»¥ thuá»™c vÃ o shape ban Ä‘áº§u

MDN Web Docs Ä‘áº·t warning lá»›n: _"Changing the [[Prototype]] of an object is, by the nature of how modern JavaScript engines optimize property accesses, currently a very slow operation."_ Náº¿u cáº§n object vá»›i prototype cá»¥ thá»ƒ, **táº¡o Ä‘Ãºng ngay tá»« Ä‘áº§u** báº±ng `Object.create(proto)` thay vÃ¬ táº¡o rá»“i thay Ä‘á»•i prototype sau.

> **Gotcha ná»•i tiáº¿ng**: `__proto__` lÃ  accessor property trÃªn `Object.prototype`, KHÃ”NG pháº£i own property cá»§a má»—i object. Náº¿u báº¡n táº¡o `Object.create(null)` â€” object khÃ´ng cÃ³ prototype â€” thÃ¬ `.__proto__` sáº½ tráº£ vá» `undefined` thay vÃ¬ `null`. ThÃªm ná»¯a, báº¡n CÃ“ THá»‚ set `obj.__proto__ = null` Ä‘á»ƒ "cáº¯t Ä‘á»©t" prototype chain â€” lÃºc nÃ y object máº¥t toÃ n bá»™ inherited methods.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Má»—i OBJECT cÃ³ property áº©n __proto__
// __proto__ trá» Ä‘áº¿n PROTOTYPE cá»§a Constructor Ä‘Ã£ táº¡o ra nÃ³
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Animal(type) {
  this.type = type;
}

Animal.prototype.speak = function () {
  return `I'm a ${this.type}`;
};

const cat = new Animal("cat");

// ğŸ’¡ instance.__proto__ === Constructor.prototype
console.log(cat.__proto__ === Animal.prototype); // true âœ…

// ğŸ’¡ Constructor.prototype.constructor === Constructor
console.log(Animal.prototype.constructor === Animal); // true âœ…

// ğŸ’¡ Tam giÃ¡c quan há»‡:
//   Constructor â†â”€â”€ .constructor â”€â”€ Prototype
//       â”‚                              â–²
//       â”‚ new                          â”‚ __proto__
//       â–¼                              â”‚
//     Instance â”€â”€â”€ .__proto__ â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ __proto__ vs Object.getPrototypeOf()
// __proto__ lÃ  non-standard (deprecated), dÃ¹ng:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Object.getPrototypeOf(cat) === Animal.prototype; // true âœ… (recommended)
cat.__proto__ === Animal.prototype; // true âš ï¸ (legacy)
```

### Prototype Chain: Chuá»—i NguyÃªn Máº«u

**BÃ i viáº¿t â€” Property Lookup Algorithm: Cuá»™c Truy TÃ¬m Tá»« Instance Äáº¿n `null`**

Prototype Chain lÃ  **cÆ¡ cháº¿ trÃ¡i tim** cá»§a toÃ n bá»™ há»‡ thá»‘ng káº¿ thá»«a trong JS. Má»i property access trong JavaScript â€” tá»« `obj.name` Ä‘Æ¡n giáº£n Ä‘áº¿n `arr.map().filter()` phá»©c táº¡p â€” Ä‘á»u Ä‘i qua cÃ¹ng má»™t thuáº­t toÃ¡n: **OrdinaryGet**. Hiá»ƒu thuáº­t toÃ¡n nÃ y nghÄ©a lÃ  hiá»ƒu cÃ¡ch JavaScript "tÃ¬m kiáº¿m" má»i thá»©.

**Thuáº­t ToÃ¡n OrdinaryGet â€” TrÃ¡i Tim Cá»§a Property Lookup:**

Khi báº¡n truy cáº­p `obj.foo`, engine KHÃ”NG chá»‰ tÃ¬m trÃªn `obj`. ECMAScript specification Ä‘á»‹nh nghÄ©a thuáº­t toÃ¡n `[[Get]](P, Receiver)` (hay `OrdinaryGet` cho ordinary objects) nhÆ° sau:

1. TÃ¬m `foo` trÃªn chÃ­nh `obj` (own properties) â†’ náº¿u cÃ³ â†’ tráº£ vá» value
2. Náº¿u khÃ´ng â†’ láº¥y `parent = obj.[[Prototype]]`
3. Náº¿u `parent === null` â†’ return `undefined` (háº¿t chain)
4. Gá»i Ä‘á»‡ quy `parent.[[Get]](P, Receiver)` â€” láº·p láº¡i tá»« bÆ°á»›c 1 trÃªn parent

Thuáº­t toÃ¡n nÃ y **Ä‘á»‡ quy theo báº£n cháº¥t** â€” nÃ³ khÃ´ng pháº£i vÃ²ng láº·p Ä‘Æ¡n giáº£n mÃ  lÃ  recursive delegation. Tham sá»‘ `Receiver` giá»¯ nguyÃªn object gá»‘c (nÆ¡i property access báº¯t Ä‘áº§u) â€” Ä‘iá»u nÃ y quan trá»ng cho accessor properties (getters/setters) vÃ¬ `this` bÃªn trong getter pháº£i trá» Ä‘áº¿n receiver ban Ä‘áº§u, KHÃ”NG pháº£i object nÆ¡i getter Ä‘Æ°á»£c tÃ¬m tháº¥y.

**Prototype Chain NhÆ° Cáº¥u TrÃºc Dá»¯ Liá»‡u: Singly Linked List:**

Vá» máº·t cáº¥u trÃºc dá»¯ liá»‡u, prototype chain chÃ­nh xÃ¡c lÃ  má»™t **singly linked list**. Má»—i node (object) chá»©a data (own properties) vÃ  má»™t pointer (internal slot `[[Prototype]]`) Ä‘áº¿n node tiáº¿p theo. Traversal chá»‰ Ä‘i theo **má»™t hÆ°á»›ng** â€” tá»« instance lÃªn Object.prototype â†’ null. Báº¡n KHÃ”NG thá»ƒ Ä‘i ngÆ°á»£c láº¡i: tá»« `Object.prototype` khÃ´ng cÃ³ cÃ¡ch nÃ o tÃ¬m ra "ai Ä‘ang káº¿ thá»«a tÃ´i?" (khÃ´ng cÃ³ back-pointer).

Äáº·c tÃ­nh linked list áº£nh hÆ°á»Ÿng trá»±c tiáº¿p Ä‘áº¿n performance:

- **Lookup time = O(d)** trong worst case, vá»›i `d` lÃ  **depth** (Ä‘á»™ sÃ¢u) cá»§a property trong chain. Property trÃªn instance = O(1). Property trÃªn `Object.prototype` = O(d) vá»›i d = chiá»u dÃ i chain.
- **Insertion/deletion táº¡i Ä‘áº§u chain** (thÃªm own property) = O(1) â€” Ä‘Ã¢y lÃ  assignment bÃ¬nh thÆ°á»ng.
- **Search miss** (property khÃ´ng tá»“n táº¡i) = O(n) vá»›i n = chiá»u dÃ i chain â€” pháº£i duyá»‡t toÃ n bá»™ chain trÆ°á»›c khi káº¿t luáº­n `undefined`.

**Scope Chain vs Prototype Chain â€” So SÃ¡nh Chi Tiáº¿t:**

Hai cÆ¡ cháº¿ tÃ¬m kiáº¿m cá»‘t lÃµi trong JavaScript thÆ°á»ng bá»‹ nháº§m láº«n:

| Äáº·c Äiá»ƒm               | Scope Chain                            | Prototype Chain                                             |
| ---------------------- | -------------------------------------- | ----------------------------------------------------------- |
| **TÃ¬m gÃ¬?**            | Variables (identifiers)                | Properties (on objects)                                     |
| **Khi nÃ o kÃ­ch hoáº¡t?** | `variableName` â€” identifier resolution | `obj.propertyName` â€” member expression                      |
| **HÆ°á»›ng tÃ¬m**          | Inner scope â†’ outer scope â†’ global     | Instance â†’ prototype â†’ ... â†’ null                           |
| **Khi khÃ´ng tÃ¬m tháº¥y** | âš ï¸ `ReferenceError` (crash!)           | ğŸ˜ `undefined` (silent fail)                                |
| **Thá»i Ä‘iá»ƒm táº¡o**      | **Compile time** (lexical scoping)     | **Runtime** (dynamic via `new`, `Object.create`)            |
| **CÃ³ thá»ƒ thay Ä‘á»•i?**   | âŒ Cá»‘ Ä‘á»‹nh (closures capture scope)    | âœ… Dynamic (`Object.setPrototypeOf()`)                      |
| **Length**             | ThÆ°á»ng 2-5 levels (function nesting)   | ThÆ°á»ng 2-3 levels (instance â†’ prototype â†’ Object.prototype) |

KhÃ¡c biá»‡t quan trá»ng nháº¥t: scope chain throw `ReferenceError` khi miss, prototype chain tráº£ vá» `undefined`. ÄÃ¢y lÃ  reason vÃ¬ sao `obj.nonExistent` khÃ´ng crash nhÆ°ng `nonExistentVar` crash. Implication thá»±c táº¿: báº¡n cÃ³ thá»ƒ safely check `if (obj.foo)` nhÆ°ng KHÃ”NG thá»ƒ `if (foo)` náº¿u `foo` chÆ°a Ä‘Æ°á»£c khai bÃ¡o (pháº£i dÃ¹ng `typeof foo !== 'undefined'`).

CÃ³ má»™t edge case thÃº vá»‹ khi hai chain "giao nhau": `with` statement (deprecated nhÆ°ng váº«n trong spec) biáº¿n property lookup thÃ nh variable lookup â€” prototype chain "leo" vÃ o scope chain. ÄÃ¢y lÃ  lÃ½ do `with` bá»‹ cáº¥m trong strict mode.

**V8's Inline Cache â€” Táº¡i Sao Prototype Lookup Nhanh HÆ¡n Báº¡n NghÄ©:**

LÃ½ thuyáº¿t nÃ³i chain traversal lÃ  O(d), nhÆ°ng trong thá»±c táº¿ V8 vÃ  cÃ¡c modern engines **gáº§n nhÆ° O(1)** nhá» há»‡ thá»‘ng **Inline Cache (IC)**. IC hoáº¡t Ä‘á»™ng nhÆ° sau:

1. **Láº§n Ä‘áº§u** access `obj.toString()`: V8 traverses chain, tÃ¬m `toString` trÃªn `Object.prototype`. Chi phÃ­ = O(d).
2. **V8 ghi nhá»›**: "Object cÃ³ shape X thÃ¬ `toString` náº±m táº¡i slot Y trÃªn prototype Z, cache offset W."
3. **Láº§n sau** access `obj2.toString()` (cÃ¹ng shape): V8 **skip chain traversal**, Ä‘i tháº³ng Ä‘áº¿n offset W. Chi phÃ­ = O(1).

IC cÃ³ nhiá»u tráº¡ng thÃ¡i (states):

- **Uninitialized**: ChÆ°a bao giá» access â€” V8 chÆ°a biáº¿t gÃ¬.
- **Monomorphic**: Chá»‰ tháº¥y 1 shape â€” **tá»‘i Æ°u nháº¥t**. IC trá»Ÿ thÃ nh direct memory access.
- **Polymorphic**: Tháº¥y 2-4 shapes â€” V8 táº¡o **lookup table** nhá». Váº«n nhanh.
- **Megamorphic**: Tháº¥y >4 shapes â€” V8 **bá» cuá»™c**, fallback vá» hash lookup. Cháº­m nháº¥t.

Implication cho developer: **giá»¯ objects cÃ¹ng shape** (cÃ¹ng properties, cÃ¹ng thá»© tá»±) Ä‘á»ƒ IC duy trÃ¬ tráº¡ng thÃ¡i monomorphic. ThÃªm prototype methods thay vÃ¬ instance methods giÃºp táº¥t cáº£ instances share shape â†’ IC hiá»‡u quáº£.

**Chain Length â€” Bao NhiÃªu LÃ  QuÃ¡ DÃ i?**

Trong thá»±c táº¿, chain length thÆ°á»ng ráº¥t ngáº¯n:

- **Plain object `{}`**: chain = 1 (Object.prototype â†’ null)
- **Instance tá»« constructor**: chain = 2 (instance â†’ Constructor.prototype â†’ Object.prototype â†’ null)
- **ES6 class extends**: chain = 3 (instance â†’ Child.prototype â†’ Parent.prototype â†’ Object.prototype â†’ null)
- **Deep inheritance (3+ levels)**: chain â‰¥ 4 â€” hiáº¿m gáº·p vÃ  thÆ°á»ng lÃ  code smell

Framework/library chain cÃ³ thá»ƒ dÃ i hÆ¡n: React class component (pre-hooks) cÃ³ chain = 4 (instance â†’ Component.prototype â†’ ... â†’ Object.prototype). NhÆ°ng nhá» IC, chain length **háº§u nhÆ° khÃ´ng áº£nh hÆ°á»Ÿng performance** trong production code â€” ngoáº¡i trá»« **search miss** (property khÃ´ng tá»“n táº¡i trÃªn chain), vÃ¬ miss LUÃ”N pháº£i traverse toÃ n bá»™ chain.

**`Object.prototype` â€” Universal Ancestor vÃ  Method Inventory:**

`Object.prototype` lÃ  prototype cuá»‘i cÃ¹ng trÆ°á»›c `null` (chain terminus). NÃ³ chá»©a **baseline methods** mÃ  Má»ŒI object trong JavaScript Ä‘á»u káº¿ thá»«a:

| Method                      | MÃ´ Táº£                                      | Sá»­ Dá»¥ng Phá»• Biáº¿n                                   |
| --------------------------- | ------------------------------------------ | -------------------------------------------------- |
| `toString()`                | Tráº£ vá» `"[object Type]"`                   | Type checking: `Object.prototype.toString.call(x)` |
| `valueOf()`                 | Tráº£ vá» primitive value                     | Type coercion: `+obj` gá»i `valueOf()`              |
| `hasOwnProperty(key)`       | Check own property                         | Guard trong `for...in` loops                       |
| `isPrototypeOf(obj)`        | Check náº¿u `this` náº±m trong chain cá»§a `obj` | Alternative cho `instanceof`                       |
| `propertyIsEnumerable(key)` | Check náº¿u own + enumerable                 | Filtering properties                               |
| `toLocaleString()`          | Locale-specific string                     | Internationalization                               |
| `constructor`               | Trá» vá» constructor function                | Type identification                                |

Fun fact: `Object.prototype.toString.call(value)` lÃ  cÃ¡ch **chÃ­nh xÃ¡c nháº¥t** Ä‘á»ƒ detect type trong JavaScript â€” nÃ³ tráº£ vá» `"[object Array]"`, `"[object Date]"`, `"[object RegExp]"`, etc. ÄÃ¢y lÃ  ká»¹ thuáº­t mÃ  jQuery, Lodash, vÃ  háº§u háº¿t utility libraries sá»­ dá»¥ng ná»™i bá»™.

**Built-in Object Chains â€” "Gia Pháº£" Cá»§a JavaScript:**

Má»—i built-in type trong JavaScript cÃ³ chain riÃªng, nhÆ°ng táº¥t cáº£ Ä‘á»u káº¿t thÃºc táº¡i `Object.prototype`:

```
// Array chain:
[1,2,3] â†’ Array.prototype â†’ Object.prototype â†’ null
//         (map, filter, push)  (toString, valueOf)

// Function chain:
function foo(){} â†’ Function.prototype â†’ Object.prototype â†’ null
//                  (call, apply, bind)   (toString, valueOf)

// RegExp chain:
/abc/ â†’ RegExp.prototype â†’ Object.prototype â†’ null
//       (test, exec)        (toString, valueOf)

// Date chain:
new Date() â†’ Date.prototype â†’ Object.prototype â†’ null
//            (getTime, toISO)  (toString, valueOf)

// Error chain:
new Error() â†’ Error.prototype â†’ Object.prototype â†’ null
//             (message, stack)   (toString, valueOf)
```

Äiá»u thÃº vá»‹: `Function.prototype` **báº£n thÃ¢n nÃ³ lÃ  má»™t function** â€” Ä‘Ã¢y lÃ  trÆ°á»ng há»£p Ä‘áº·c biá»‡t duy nháº¥t. `typeof Function.prototype === 'function'` â†’ `true`. NÃ³ lÃ  function "trá»‘ng" luÃ´n return `undefined`. Táº¡i sao? VÃ¬ specification yÃªu cáº§u prototype cá»§a functions pháº£i "callable" â€” má»™t quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ gÃ¢y tranh cÃ£i tá»« nhá»¯ng ngÃ y Ä‘áº§u.

**Circular Prototype â€” Engine NgÄƒn Cháº·n Infinite Loop:**

Báº¡n cÃ³ thá»ƒ nghÄ©: "Náº¿u tÃ´i set `a.__proto__ = b` vÃ  `b.__proto__ = a` thÃ¬ sao?" CÃ¢u tráº£ lá»i: **engine KHÃ”NG cho phÃ©p**. ECMAScript specification yÃªu cáº§u `Object.setPrototypeOf()` pháº£i **detect circular references** vÃ  throw `TypeError`:

```javascript
const a = {},
  b = {};
Object.setPrototypeOf(a, b); // OK
Object.setPrototypeOf(b, a); // TypeError: Cyclic __proto__ value
```

Engine kiá»ƒm tra báº±ng cÃ¡ch traverse chain tá»« `b` lÃªn trÃªn â€” náº¿u gáº·p `a`, nghÄ©a lÃ  táº¡o cycle â†’ reject. Thuáº­t toÃ¡n nÃ y cÃ³ complexity O(n) vá»›i n = chain length, nhÆ°ng vÃ¬ chain thÆ°á»ng ráº¥t ngáº¯n nÃªn cost negligible.

**Property Shadowing Deep Dive â€” Write vs Read Asymmetry:**

Má»™t Ä‘áº·c tÃ­nh quan trá»ng cá»§a prototype chain: **read traverses chain, write NEVER does**. Khi báº¡n **Ä‘á»c** `obj.foo`, engine duyá»‡t chain lÃªn trÃªn. NhÆ°ng khi báº¡n **ghi** `obj.foo = value`, engine LUÃ”N táº¡o/update own property trÃªn `obj`, Báº¤T Ká»‚ `foo` cÃ³ tá»“n táº¡i trÃªn chain hay khÃ´ng. Prototype chain KHÃ”NG Bá»Š MODIFY khi ghi.

Ngoáº¡i lá»‡ duy nháº¥t: náº¿u prototype cÃ³ **setter** cho property Ä‘Ã³, setter sáº½ Ä‘Æ°á»£c gá»i thay vÃ¬ táº¡o own property. ÄÃ¢y lÃ  edge case Ã­t biáº¿t nhÆ°ng cÃ³ thá»ƒ gÃ¢y bug khÃ³ debug:

```javascript
const parent = {
  _value: 42,
  get value() {
    return this._value;
  },
  set value(v) {
    this._value = v;
  }, // Setter trÃªn prototype
};
const child = Object.create(parent);
child.value = 100; // Gá»i setter! KHÃ”NG táº¡o own property "value"
// child._value = 100 (own property)
// child.value â†’ getter return this._value â†’ 100
```

> **Äá»‰nh cá»§a chain**: `Object.prototype.__proto__ === null`. Má»i object (trá»« `Object.create(null)`) Ä‘á»u káº¿t thÃºc chain táº¡i Ä‘Ã¢y. `Object.prototype` lÃ  "Ã´ng tá»•" cá»§a táº¥t cáº£ â€” nÆ¡i chá»©a `toString()`, `valueOf()`, `hasOwnProperty()` mÃ  má»i object Ä‘á»u dÃ¹ng Ä‘Æ°á»£c.

> **Interview insight**: Khi interviewer há»i "giáº£i thÃ­ch prototype chain", hÃ£y váº½ chain diagram cá»¥ thá»ƒ (vÃ­ dá»¥ `alice â†’ Person.prototype â†’ Object.prototype â†’ null`), rá»“i giáº£i thÃ­ch **bá»‘n Ä‘iá»ƒm**: (1) lookup traverses chain, (2) write creates own property, (3) search miss returns `undefined` (khÃ´ng throw), (4) V8 optimizes via inline caching. Náº¿u add thÃªm sá»± khÃ¡c biá»‡t vá»›i scope chain, báº¡n sáº½ impress interviewer.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Prototype Chain = chuá»—i __proto__ liÃªn tiáº¿p
// Khi tÃ¬m property â†’ tÃ¬m tá»« instance â†’ prototype â†’ prototype's prototype â†’ ... â†’ null
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Person(name) {
  this.name = name;
}

Person.prototype.greet = function () {
  return `Hello, ${this.name}`;
};

const alice = new Person("Alice");

// Lookup chain khi gá»i alice.toString():
//
// 1. alice cÃ³ .toString() khÃ´ng?           â†’ âŒ KhÃ´ng
// 2. alice.__proto__ (Person.prototype)?    â†’ âŒ KhÃ´ng
// 3. Person.prototype.__proto__ (Object.prototype)? â†’ âœ… CÃ“!
// 4. DÃ¹ng Object.prototype.toString()

alice.toString(); // "[object Object]" â† tá»« Object.prototype
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROTOTYPE CHAIN â€” CHUá»–I TÃŒM KIáº¾M                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  alice (instance)                                                â”‚
â”‚    â”‚  .name = "Alice"                                            â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”‚ .__proto__                                                   â”‚
â”‚    â–¼                                                             â”‚
â”‚  Person.prototype                                                â”‚
â”‚    â”‚  .greet = function() {}                                     â”‚
â”‚    â”‚  .constructor = Person                                      â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”‚ .__proto__                                                   â”‚
â”‚    â–¼                                                             â”‚
â”‚  Object.prototype                                                â”‚
â”‚    â”‚  .toString()                                                â”‚
â”‚    â”‚  .hasOwnProperty()                                          â”‚
â”‚    â”‚  .valueOf()                                                 â”‚
â”‚    â”‚  .constructor = Object                                      â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”‚ .__proto__                                                   â”‚
â”‚    â–¼                                                             â”‚
â”‚  null  â† ğŸ”´ Äá»ˆNH Cá»¦A PROTOTYPE CHAIN                           â”‚
â”‚                                                                 â”‚
â”‚  âš¡ Object.prototype.__proto__ === null                           â”‚
â”‚     â†’ Má»i object Ä‘á»u káº¿ thá»«a tá»« Object.prototype                â”‚
â”‚     â†’ Object.prototype lÃ  "Ã´ng tá»•" cá»§a táº¥t cáº£ objects            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Káº¿ Thá»«a Qua Prototype Chain

**BÃ i viáº¿t â€” Tá»« ES5 Prototype Kludge Äáº¿n ES6 Class: Cuá»™c CÃ¡ch Máº¡ng CÃº PhÃ¡p**

Káº¿ thá»«a prototype-based trong ES5 lÃ  má»™t trong nhá»¯ng Ä‘oáº¡n code **xáº¥u nháº¥t** vÃ  **dá»… sai nháº¥t** cá»§a JavaScript. Trong khi Java developer chá»‰ cáº§n viáº¿t `class Dog extends Animal {}`, JavaScript developer (trÆ°á»›c ES6) pháº£i thá»±c hiá»‡n má»™t **"ritual" 3 bÆ°á»›c** thá»§ cÃ´ng â€” quÃªn báº¥t ká»³ bÆ°á»›c nÃ o = bug Ã¢m tháº§m mÃ  cÃ³ thá»ƒ máº¥t hÃ ng giá» Ä‘á»ƒ debug.

**Ritual 3 BÆ°á»›c â€” PhÃ¢n TÃ­ch Tá»«ng BÆ°á»›c:**

**BÆ°á»›c 1 â€” Constructor Stealing (`Parent.call(this, args)`):**

```javascript
function Dog(name, breed) {
  Animal.call(this, name); // "Ä‚n cáº¯p" constructor cha
  this.breed = breed;
}
```

`Animal.call(this, name)` thá»±c hiá»‡n gÃ¬? NÃ³ gá»i function `Animal` vá»›i `this` trá» Ä‘áº¿n instance Dog má»›i. BÃªn trong `Animal`, `this.name = name` â†’ gÃ¡n property trá»±c tiáº¿p lÃªn Dog instance. ÄÃ¢y gá»i lÃ  **constructor stealing** (parasitic inheritance) â€” child "mÆ°á»£n" constructor cha Ä‘á»ƒ khá»Ÿi táº¡o inherited properties.

Táº¡i sao dÃ¹ng `.call()` thay vÃ¬ `new Animal()`? VÃ¬ `new Animal()` táº¡o **instance má»›i** (object riÃªng) â€” báº¡n KHÃ”NG muá»‘n táº¡o Animal instance, báº¡n muá»‘n **cháº¡y Animal constructor** trÃªn Dog instance Ä‘ang táº¡o. `.call(this)` cho phÃ©p "inject" context Ä‘Ãºng.

**BÆ°á»›c 2 â€” Prototype Linkage (`Object.create(Parent.prototype)`):**

```javascript
Dog.prototype = Object.create(Animal.prototype);
```

ÄÃ¢y lÃ  bÆ°á»›c quan trá»ng nháº¥t vÃ  cÅ©ng dá»… sai nháº¥t. `Object.create(Animal.prototype)` táº¡o object má»›i cÃ³ `[[Prototype]]` trá» Ä‘áº¿n `Animal.prototype`, rá»“i gÃ¡n object nÃ y lÃ m `Dog.prototype`. Káº¿t quáº£: chain `dog instance â†’ Dog.prototype â†’ Animal.prototype â†’ Object.prototype â†’ null`.

**Anti-pattern kinh Ä‘iá»ƒn â€” `Dog.prototype = new Animal()`:** Ráº¥t nhiá»u tutorials cÅ© (vÃ  tháº­m chÃ­ sÃ¡ch) dáº¡y pattern sai: `Dog.prototype = new Animal()`. Táº¡i sao sai?

1. **Cháº¡y constructor cha khÃ´ng cáº§n thiáº¿t**: `new Animal()` gá»i `Animal()` constructor â€” cÃ³ thá»ƒ cÃ³ side effects (API calls, DOM manipulation, validation logic).
2. **Instance properties trÃªn prototype**: `new Animal("default")` táº¡o `name: "default"` trÃªn prototype â€” Táº¤T Cáº¢ Dog instances share property nÃ y (khi khÃ´ng bá»‹ shadow), gÃ¢y confusion.
3. **Wrong argument problem**: Báº¡n pháº£i pass arguments cho `Animal()` â€” nhÆ°ng á»Ÿ thá»i Ä‘iá»ƒm setup prototype, báº¡n chÆ°a biáº¿t arguments â†’ hardcode hoáº·c pass `undefined`.

`Object.create()` giáº£i quyáº¿t táº¥t cáº£: nÃ³ liÃªn káº¿t chain **mÃ  KHÃ”NG gá»i constructor**, mÃ  khÃ´ng táº¡o thá»«a properties.

**BÆ°á»›c 3 â€” Constructor Fix (`Child.prototype.constructor = Child`):**

```javascript
Dog.prototype.constructor = Dog;
```

Sau bÆ°á»›c 2, `Dog.prototype` lÃ  object hoÃ n toÃ n má»›i (khÃ´ng cÃ³ `.constructor`). Khi access `dog.constructor`, engine traverse chain â†’ tÃ¬m tháº¥y `Animal.prototype.constructor` â†’ tráº£ vá» `Animal`. Sai! Fix: explicitly set `.constructor = Dog` trÃªn prototype má»›i.

QuÃªn bÆ°á»›c nÃ y gÃ¢y ra bugs thá»±c táº¿: `new dog.constructor("Buddy")` táº¡o ra **Animal** instance thay vÃ¬ **Dog** instance. Libraries dÃ¹ng `.constructor` Ä‘á»ƒ clone objects sáº½ táº¡o wrong type.

**ES6 `class` = Syntactic Sugar, SAME Engine:**

Khi báº¡n viáº¿t `class Car extends Vehicle {}`, JS engine ná»™i bá»™ váº«n thá»±c hiá»‡n chÃ­nh xÃ¡c 3 bÆ°á»›c trÃªn. `extends` tá»± Ä‘á»™ng gá»i `Object.create()` vÃ  fix constructor. `super()` thay tháº¿ `Parent.call(this)`. NhÆ°ng bÃªn dÆ°á»›i váº«n lÃ  prototype â€” báº¡n cÃ³ thá»ƒ verify báº±ng `Car.prototype.__proto__ === Vehicle.prototype`.

Báº¡n muá»‘n báº±ng chá»©ng? ÄÃ¢y lÃ  output khi Babel transpile ES6 class:

```javascript
// ES6 source:
class Dog extends Animal {
  constructor(name, breed) {
    super(name);
    this.breed = breed;
  }
  bark() {
    return "Woof!";
  }
}

// Babel ES5 output (simplified):
function Dog(name, breed) {
  var _this = Animal.call(this, name) || this; // BÆ°á»›c 1
  _this.breed = breed;
  return _this;
}
Dog.prototype = Object.create(Animal.prototype); // BÆ°á»›c 2
Dog.prototype.constructor = Dog; // BÆ°á»›c 3
Dog.prototype.bark = function () {
  return "Woof!";
};
```

Gáº§n nhÆ° **identical** vá»›i manual ES5 inheritance! `class` chá»‰ automate ritual.

**Há»‡ Thá»‘ng Dual-Chain â€” Instance Chain vs Constructor Chain:**

ES6 `class extends` táº¡o **HAI** prototype chains song song â€” Ä‘iá»u mÃ  ES5 manual inheritance thÆ°á»ng quÃªn:

```
// Chain 1: Instance chain (inheritance instances)
dogInstance.__proto__ â†’ Dog.prototype â†’ Animal.prototype â†’ Object.prototype â†’ null

// Chain 2: Constructor chain (inheritance statics)
Dog.__proto__ â†’ Animal â†’ Function.prototype â†’ Object.prototype â†’ null
```

Chain 2 lÃ  lÃ½ do **static methods Ä‘Æ°á»£c káº¿ thá»«a** trong ES6 classes. Khi viáº¿t `Animal.create = function() {}`, ES6 `Dog` class tá»± Ä‘á»™ng káº¿ thá»«a: `Dog.create()` works! Trong ES5, báº¡n pháº£i manually set `Object.setPrototypeOf(Dog, Animal)` â€” vÃ  háº§u nhÆ° khÃ´ng ai lÃ m Ä‘iá»u nÃ y.

**`super` Keyword â€” KhÃ´ng Chá»‰ LÃ  `Parent.call(this)`:**

`super` trong ES6 phá»©c táº¡p hÆ¡n nhiá»u ngÆ°á»i nghÄ©:

- **`super()` trong constructor**: Gá»i parent constructor VÃ€ thiáº¿t láº­p `this` binding. Trong derived class (class dÃ¹ng `extends`), `this` **KHÃ”NG tá»“n táº¡i** cho Ä‘áº¿n khi `super()` Ä‘Æ°á»£c gá»i â€” access `this` trÆ°á»›c `super()` throw `ReferenceError`. ÄÃ¢y lÃ  constraint mÃ  ES5 KHÃ”NG cÃ³.
- **`super.method()` trong method**: Gá»i method trÃªn **parent prototype** (KHÃ”NG pháº£i trÃªn `this.__proto__`). `super` reference Ä‘Æ°á»£c **resolve statically** (táº¡i thá»i Ä‘iá»ƒm define, khÃ´ng pháº£i runtime) â€” khÃ¡c vá»›i `this` (dynamic). ÄÃ¢y lÃ  lÃ½ do `super` hoáº¡t Ä‘á»™ng Ä‘Ãºng ngay cáº£ khi method Ä‘Æ°á»£c reassign.
- **Limitation**: `super` chá»‰ hoáº¡t Ä‘á»™ng trong methods defined báº±ng **method shorthand** (`{ method() {} }`) hoáº·c trong `class`. KHÃ”NG hoáº¡t Ä‘á»™ng trong `{ method: function() {} }` hay arrow functions. LÃ½ do: `super` phá»¥ thuá»™c vÃ o internal slot `[[HomeObject]]` â€” chá»‰ method shorthand má»›i cÃ³ slot nÃ y.

**Mixins â€” Alternative Cho Deep Inheritance:**

Prototype chain chá»‰ há»— trá»£ **single inheritance** (linked list = 1 parent). NhÆ°ng real-world thÆ°á»ng cáº§n "káº¿ thá»«a" tá»« nhiá»u sources. Giáº£i phÃ¡p: **mixin pattern**:

```javascript
const Serializable = (Base) =>
  class extends Base {
    serialize() {
      return JSON.stringify(this);
    }
  };
const EventEmitter = (Base) =>
  class extends Base {
    on(event, fn) {
      /* ... */
    }
    emit(event) {
      /* ... */
    }
  };
// Compose:
class User extends Serializable(EventEmitter(Base)) {}
// Chain: User â†’ Serializable â†’ EventEmitter â†’ Base â†’ Object.prototype â†’ null
```

Mixin pattern "ná»‘i dÃ i" chain báº±ng cÃ¡ch táº¡o intermediate classes. NhÆ°ng nhÆ°á»£c Ä‘iá»ƒm: chain trá»Ÿ nÃªn dÃ i (áº£nh hÆ°á»Ÿng search miss performance) vÃ  `instanceof` check trá»Ÿ nÃªn meaningless (user `instanceof EventEmitter`? depends on how mixin was applied).

**Composition Over Inheritance â€” Xu HÆ°á»›ng Hiá»‡n Äáº¡i:**

Modern JavaScript (Ä‘áº·c biá»‡t React) di chuyá»ƒn tá»« inheritance sang **composition**: thay vÃ¬ "Dog IS-A Animal" (inheritance), dÃ¹ng "Dog HAS-A Movement" (composition). React hooks chÃ­nh lÃ  biá»ƒu hiá»‡n cá»§a xu hÆ°á»›ng nÃ y â€” `useState`, `useEffect` lÃ  "behaviors" Ä‘Æ°á»£c compose vÃ o component, khÃ´ng pháº£i inherited tá»« base class.

**`Object.create()` â€” Parameter Thá»© Hai Ãt Ai Biáº¿t:**

`Object.create(proto, propertyDescriptors)` nháº­n **hai** parameters. Parameter thá»© hai cho phÃ©p define properties vá»›i descriptors:

```javascript
const dog = Object.create(Animal.prototype, {
  breed: {
    value: "Golden",
    writable: true,
    enumerable: true,
    configurable: true,
  },
  speak: {
    value: function () {
      return "Woof!";
    },
    writable: true,
  },
});
```

Táº¡i sao Ã­t ngÆ°á»i dÃ¹ng? VÃ¬ syntax quÃ¡ verbose. NhÆ°ng nÃ³ há»¯u Ã­ch khi báº¡n cáº§n fine-grained control trÃªn property attributes (non-writable, non-enumerable properties) â€” Ä‘iá»u mÃ  constructor pattern khÃ´ng thá»ƒ lÃ m elegantly.

> **Táº¡i sao váº«n cáº§n hiá»ƒu ES5 inheritance?** VÃ¬: (1) Legacy codebases khá»•ng lá»“ váº«n tá»“n táº¡i â€” migration má»™t codebase 100k+ lines sang class syntax máº¥t months, (2) Library source code (React internal, Lodash, Backbone) váº«n dÃ¹ng ES5 patterns, (3) Interview question kinh Ä‘iá»ƒn â€” senior interviews gáº§n nhÆ° luÃ´n há»i manual prototype inheritance, (4) Hiá»ƒu `class` lÃ  sugar giÃºp debug prototype chain issues tá»‘t hÆ¡n â€” báº¡n biáº¿t **cáº¡nh nÃ o trong tam giÃ¡c bá»‹ Ä‘á»©t**.

> **Interview tip**: Khi interviewer yÃªu cáº§u "implement class inheritance without using `class` keyword", hÃ£y viáº¿t **Ä‘áº§y Ä‘á»§ 3 bÆ°á»›c** + thÃªm `Object.setPrototypeOf(Child, Parent)` cho static method inheritance. Bonus: giáº£i thÃ­ch táº¡i sao KHÃ”NG dÃ¹ng `Dog.prototype = new Animal()` vÃ  táº¡i sao cáº§n fix `.constructor`.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Prototype-based Inheritance (ES5 style)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Animal(name) {
  this.name = name;
}

Animal.prototype.eat = function () {
  return `${this.name} is eating`;
};

function Dog(name, breed) {
  Animal.call(this, name); // Gá»i constructor cha â†’ káº¿ thá»«a properties
  this.breed = breed;
}

// Táº¡o liÃªn káº¿t prototype chain: Dog â†’ Animal â†’ Object
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog; // Fix láº¡i constructor

Dog.prototype.bark = function () {
  return `${this.name} says Woof!`;
};

const buddy = new Dog("Buddy", "Golden");

buddy.bark(); // "Buddy says Woof!" â† Dog.prototype
buddy.eat(); // "Buddy is eating"  â† Animal.prototype (káº¿ thá»«a!)

// Prototype chain:
// buddy â†’ Dog.prototype â†’ Animal.prototype â†’ Object.prototype â†’ null

console.log(buddy instanceof Dog); // true âœ…
console.log(buddy instanceof Animal); // true âœ…
console.log(buddy instanceof Object); // true âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ES6 Class â€” Syntactic Sugar (cÃ¹ng cÆ¡ cháº¿ prototype)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Vehicle {
  constructor(brand) {
    this.brand = brand;
  }

  drive() {
    return `${this.brand} is driving`;
  }
}

class Car extends Vehicle {
  constructor(brand, model) {
    super(brand); // = Vehicle.call(this, brand)
    this.model = model;
  }

  info() {
    return `${this.brand} ${this.model}`;
  }
}

const tesla = new Car("Tesla", "Model 3");

tesla.info(); // "Tesla Model 3"   â† Car.prototype
tesla.drive(); // "Tesla is driving" â† Vehicle.prototype (káº¿ thá»«a)

// Under the hood: CHÃNH XÃC cÆ¡ cháº¿ prototype chain!
console.log(tesla.__proto__ === Car.prototype); // true
console.log(Car.prototype.__proto__ === Vehicle.prototype); // true
console.log(Vehicle.prototype.__proto__ === Object.prototype); // true
```

### Pass-by-Reference: Äáº·c TÃ­nh Quan Trá»ng

**BÃ i viáº¿t â€” Shared Prototype: "Khi Má»™t NgÆ°á»i Thay Äá»•i, Táº¥t Cáº£ Bá»‹ áº¢nh HÆ°á»Ÿng"**

**MÃ´ HÃ¬nh Bá»™ Nhá»› â€” Táº¡i Sao Prototype LÃ  "Shared"?**

HÃ£y hÃ¬nh dung memory layout cá»¥ thá»ƒ:

```
HEAP MEMORY:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user1       â”‚  â”‚   user2       â”‚  â”‚   user3       â”‚
â”‚ name: "Alice" â”‚  â”‚ name: "Bob"   â”‚  â”‚ name: "Carol" â”‚
â”‚ __proto__: â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”            â”‚  â”‚ __proto__: â”€â”€â”€â”¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  â”‚            â”‚         â”‚
                  â”‚  â–¼            â”‚         â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  â”‚            â”‚
                  â””â”€â”€â”¤  User.prototype  (1 object duy nháº¥t)
                     â”‚  greet: function() {...}
                     â”‚  __proto__: Object.prototype
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

Táº¥t cáº£ instances (`user1`, `user2`, `user3`) Ä‘á»u cÃ³ internal slot `[[Prototype]]` trá» Ä‘áº¿n **cÃ¹ng má»™t object** trong heap â€” `User.prototype`. ÄÃ¢y khÃ´ng pháº£i "copy" â€” Ä‘Ã¢y lÃ  **shared pointer**. Thay Ä‘á»•i 1 property trÃªn `User.prototype` = thay Ä‘á»•i cho **táº¥t cáº£ instances** Ä‘Ã£ táº¡o, Ä‘ang táº¡o, vÃ  Sáº¼ táº¡o trong tÆ°Æ¡ng lai.

Prototype lÃ  **shared reference** â€” táº¥t cáº£ instances trá» Ä‘áº¿n CÃ™NG Má»˜T prototype object. Äiá»u nÃ y cÃ³ 2 máº·t rÃµ rá»‡t:

**Máº·t tá»‘t â€” Dynamic Extension vÃ  Monkey-Patching:**

Tiáº¿t kiá»‡m memory (methods defined 1 láº§n, shared N láº§n), vÃ  kháº£ nÄƒng thÃªm method má»›i vÃ o prototype **AFTER** instances Ä‘Ã£ Ä‘Æ°á»£c táº¡o â€” táº¥t cáº£ instances tá»± Ä‘á»™ng cÃ³ method má»›i. ÄÃ¢y lÃ  cÆ¡ sá»Ÿ cá»§a **monkey-patching** â€” ká»¹ thuáº­t thÃªm/sá»­a methods trÃªn prototype cá»§a built-in objects.

Monkey-patching lÃ  ná»n táº£ng cá»§a **polyfills** â€” thÃªm modern API cho old browsers:

```javascript
// Polyfill Array.prototype.includes (ES2016) cho old browsers
if (!Array.prototype.includes) {
  Array.prototype.includes = function (searchElement, fromIndex) {
    // ... implementation
  };
}
```

NhÆ°ng monkey-patching cÅ©ng lÃ  **nguá»“n gá»‘c cá»§a drama** trong lá»‹ch sá»­ JavaScript. MooTools framework Ä‘Ã£ extend `Array.prototype` vá»›i method `.flatten()` â€” khi TC39 muá»‘n thÃªm `Array.prototype.flat()` (ban Ä‘áº§u tÃªn `.flatten()`), nÃ³ **conflict** vá»›i MooTools â†’ TC39 pháº£i Ä‘á»•i tÃªn thÃ nh `.flat()`. ÄÃ¢y gá»i lÃ  **"MooTools problem"** hay **"don't break the web"** â€” vÃ  lÃ  lÃ½ do monkey-patching built-in prototypes bá»‹ coi lÃ  **anti-pattern** trong production code.

**Máº·t nguy hiá»ƒm â€” Mutation Spreads Globally:**

Mutate prototype áº£nh hÆ°á»Ÿng táº¥t cáº£. `User.prototype.role = "admin"` = Má»ŒI user Ä‘á»u lÃ  admin. Äáº·c biá»‡t nguy hiá»ƒm khi prototype chá»©a **mutable reference types** (array, object):

```javascript
function User(name) {
  this.name = name;
}
User.prototype.permissions = []; // âš ï¸ SHARED ARRAY!

const alice = new User("Alice");
const bob = new User("Bob");

alice.permissions.push("admin");
console.log(bob.permissions); // ["admin"] â† Bob cÅ©ng lÃ  admin?!
```

Táº¡i sao? `alice.permissions` lookup â†’ khÃ´ng cÃ³ own property â†’ traverse chain â†’ tÃ¬m `User.prototype.permissions` â†’ **mutate DIRECTLY** (`.push()` mutate in-place, KHÃ”NG táº¡o own property). Giáº£i phÃ¡p: LUÃ”N khá»Ÿi táº¡o mutable values trong **constructor** (táº¡o own property cho má»—i instance): `this.permissions = []`.

**Property Shadowing â€” CÆ¡ Cháº¿ Báº£o Vá»‡ vÃ  CÃ¡c Edge Cases:**

Khi gÃ¡n `instance.prop = value`, JS táº¡o **own property** trÃªn instance, "che" (shadow) property cÃ¹ng tÃªn trÃªn prototype. Prototype KHÃ”NG bá»‹ thay Ä‘á»•i. CÃ¡c instances khÃ¡c váº«n tháº¥y giÃ¡ trá»‹ gá»‘c.

Mechanism nÃ y tÆ°Æ¡ng tá»± **variable shadowing** trong scope chain: biáº¿n local shadow biáº¿n global cÃ¹ng tÃªn. Prototype shadowing lÃ  "local property shadows prototype property".

NhÆ°ng shadowing cÃ³ **3 edge cases** mÃ  háº§u háº¿t developer khÃ´ng biáº¿t (theo Kyle Simpson â€” You Don't Know JS):

**Case 1 â€” Normal shadowing**: Property trÃªn prototype lÃ  `writable: true` (default). GÃ¡n `obj.prop = value` â†’ táº¡o own property â†’ shadow thÃ nh cÃ´ng. âœ… ÄÃ¢y lÃ  case bÃ¬nh thÆ°á»ng.

**Case 2 â€” `writable: false` trap**: Náº¿u property trÃªn prototype cÃ³ `writable: false`, thÃ¬ gÃ¡n `obj.prop = value` **THáº¤T Báº I TRONG STRICT MODE** (`TypeError`) vÃ  **Ã‚M THáº¦M Bá»Š IGNORE trong sloppy mode**! KHÃ”NG táº¡o own property, KHÃ”NG shadow. LÃ½ do: spec coi `writable: false` trÃªn prototype chain nhÆ° má»™t **read-only constraint** Ã¡p dá»¥ng cho táº¥t cáº£ descendants.

```javascript
const proto = Object.defineProperty({}, "x", { value: 42, writable: false });
const child = Object.create(proto);
child.x = 100; // Sloppy mode: silently fails! child.x váº«n lÃ  42
// Strict mode: TypeError: Cannot assign to read-only property
```

ÄÃ¢y lÃ  behavior **ráº¥t counter-intuitive**: báº¡n nghÄ© gÃ¡n property trÃªn **own object** thÃ¬ luÃ´n thÃ nh cÃ´ng â€” nhÆ°ng khÃ´ng, náº¿u prototype chain cÃ³ `writable: false` thÃ¬ inheritance "cháº·n" báº¡n láº¡i. Workaround: dÃ¹ng `Object.defineProperty(child, 'x', { value: 100 })` Ä‘á»ƒ bypass.

**Case 3 â€” Accessor (setter) trap**: Náº¿u property trÃªn prototype lÃ  **setter** (`set`), thÃ¬ gÃ¡n `obj.prop = value` sáº½ **gá»i setter** (KHÃ”NG táº¡o own property). Setter cháº¡y trÃªn context `this = obj`, nhÆ°ng property váº«n náº±m trÃªn prototype. ÄÃ¢y lÃ  design intentional: setters kiá»ƒm soÃ¡t assignment behavior.

**Object.freeze trÃªn Prototype â€” Nuclear Option:**

`Object.freeze(User.prototype)` ngÄƒn cháº·n má»i modification (thÃªm, xÃ³a, sá»­a properties). NhÆ°ng:

- Instances váº«n cÃ³ thá»ƒ bá»‹ modify (freeze chá»‰ Ã¡p dá»¥ng cho object Ä‘Æ°á»£c freeze).
- Shallow freeze: nested objects trong prototype váº«n mutable.
- KhÃ´ng thá»ƒ thÃªm methods vÃ o prototype sau khi freeze â€” polyfills/monkey-patching sáº½ fail silently.

> **Quy táº¯c vÃ ng**: (Ä‘á»c) property lookup duyá»‡t chain tá»« dÆ°á»›i lÃªn | (ghi) property assignment LUÃ”N táº¡o/update own property trÃªn instance, KHÃ”NG BAO GIá» Ä‘á»¥ng cháº¡m prototype â€” **NGOáº I TRá»ª** 2 edge cases: `writable: false` vÃ  setter trÃªn prototype chain.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JavaScript Objects truyá»n theo THAM CHIáº¾U (reference)
// Khi thay Ä‘á»•i prototype â†’ Táº¤T Cáº¢ instances Ä‘á»u bá»‹ áº£nh hÆ°á»Ÿng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  this.name = name;
}

const user1 = new User("Alice");
const user2 = new User("Bob");

// ThÃªm method vÃ o prototype SAU KHI táº¡o instances
User.prototype.greet = function () {
  return `Hi, I'm ${this.name}`;
};

// Táº¤T Cáº¢ instances Ä‘á»u cÃ³ method má»›i!
user1.greet(); // "Hi, I'm Alice" âœ…
user2.greet(); // "Hi, I'm Bob"   âœ…

// VÃ¬ instances KHÃ”NG CÃ“ báº£n copy riÃªng cá»§a prototype
// ChÃºng share CÃ™NG Má»˜T prototype object (tham chiáº¿u)

// âš ï¸ Nguy hiá»ƒm: Thay Ä‘á»•i prototype áº£nh hÆ°á»Ÿng Táº¤T Cáº¢
User.prototype.role = "admin"; // ThÃªm property

console.log(user1.role); // "admin" â† táº¥t cáº£ Ä‘á»u tháº¥y
console.log(user2.role); // "admin" â† ká»ƒ cáº£ instance táº¡o trÆ°á»›c

// âš ï¸ NHÆ¯NG: GÃ¡n property trá»±c tiáº¿p trÃªn instance â†’ SHADOW, khÃ´ng áº£nh hÆ°á»Ÿng
user1.role = "user"; // Táº¡o own property trÃªn user1

console.log(user1.role); // "user"  â† own property (shadows prototype)
console.log(user2.role); // "admin" â† váº«n tá»« prototype
```

### hasOwnProperty vs in â€” PhÃ¢n Biá»‡t Own vs Inherited

**BÃ i viáº¿t â€” CÃ¢u Há»i Triá»‡u ÄÃ´: "Property NÃ y Cá»§a Ai?"**

**Táº¡i Sao Cáº§n PhÃ¢n Biá»‡t Own vs Inherited?**

HÃ£y nhá»›: prototype chain táº¡o ra má»™t "áº£o giÃ¡c" â€” khi báº¡n truy cáº­p `obj.toString()`, báº¡n TÆ¯á»NG `toString` lÃ  property cá»§a `obj`, nhÆ°ng thá»±c táº¿ nÃ³ náº±m trÃªn `Object.prototype`, cÃ¡ch `obj` 2 links trong chain. Náº¿u báº¡n Ä‘ang serialize object (JSON, form data, API payload), báº¡n PHáº¢I biáº¿t Ä‘Ã¢u lÃ  "data thá»±c" (own properties) vÃ  Ä‘Ã¢u lÃ  "methods káº¿ thá»«a" (inherited). Serialization sai = gá»­i thá»«a data hoáº·c thiáº¿u data.

Khi debug hoáº·c iterate qua object, báº¡n thÆ°á»ng cáº§n biáº¿t: property `foo` thuá»™c vá» **chÃ­nh object** hay **káº¿ thá»«a tá»« prototype**? JavaScript cung cáº¥p nhiá»u cÃ¡ch kiá»ƒm tra, má»—i cÃ¡ch cÃ³ semantics riÃªng:

| CÃ¡ch kiá»ƒm tra                  | Own Property | Inherited Property | Non-enumerable   |
| ------------------------------ | ------------ | ------------------ | ---------------- |
| `obj.hasOwnProperty('x')`      | âœ… true      | âŒ false           | âœ… true          |
| `Object.hasOwn(obj, 'x')`      | âœ… true      | âŒ false           | âœ… true          |
| `'x' in obj`                   | âœ… true      | âœ… true            | âœ… true          |
| `Object.keys(obj)`             | âœ… yes       | âŒ no              | âŒ no            |
| `Object.getOwnPropertyNames()` | âœ… yes       | âŒ no              | âœ… yes           |
| `Reflect.ownKeys(obj)`         | âœ… yes       | âŒ no              | âœ… yes + Symbols |

**`for...in` â€” The Classic Trap:**

VÃ²ng láº·p `for...in` duyá»‡t **táº¥t cáº£ enumerable properties** trÃªn cáº£ own VÃ€ prototype chain. ÄÃ¢y lÃ  nguá»“n bug phá»• biáº¿n nháº¥t cá»§a JavaScript trÆ°á»›c ES6. Trong ES5, má»i `for...in` loop Ä‘á»u cáº§n guard:

```javascript
for (const key in obj) {
  if (obj.hasOwnProperty(key)) {
    // guard báº¯t buá»™c!
    // ... process only own properties
  }
}
```

ES6 giáº£i quyáº¿t báº±ng `Object.keys()` (chá»‰ own enumerable), `Object.values()`, `Object.entries()`, vÃ  `for...of` â€” khÃ´ng cáº§n guard. NhÆ°ng `for...in` váº«n tá»“n táº¡i trong codebase cÅ© vÃ  interview questions.

**Enumerable vs Non-enumerable â€” Táº¡i Sao `toString` KhÃ´ng Xuáº¥t Hiá»‡n?**

Báº¡n cÃ³ bao giá» tháº¯c máº¯c: náº¿u `for...in` duyá»‡t prototype chain, táº¡i sao `toString()`, `valueOf()`, `constructor` khÃ´ng xuáº¥t hiá»‡n? VÃ¬ chÃºng lÃ  **non-enumerable**. Property descriptor cÃ³ flag `enumerable: false`:

```javascript
Object.getOwnPropertyDescriptor(Object.prototype, "toString");
// { value: Æ’, writable: true, enumerable: false, configurable: true }
//                                ^^^^^^^^^^^^^^^^
```

JavaScript engine Ä‘áº·t built-in methods lÃ  non-enumerable Ä‘á»ƒ chÃºng "vÃ´ hÃ¬nh" trong `for...in` vÃ  `Object.keys()`. ÄÃ¢y lÃ  design decision tá»« ES3 â€” náº¿u khÃ´ng, má»i `for...in` loop sáº½ output hÃ ng chá»¥c inherited methods.

`propertyIsEnumerable()` kiá»ƒm tra **own + enumerable**: tráº£ `true` chá»‰ khi property Vá»ªA lÃ  own Vá»ªA lÃ  enumerable. Ãt khi dÃ¹ng trá»±c tiáº¿p nhÆ°ng xuáº¥t hiá»‡n trong specs vÃ  polyfills.

**`Reflect.ownKeys()` â€” Tool Máº¡nh Nháº¥t:**

`Reflect.ownKeys(obj)` tráº£ vá» **táº¥t cáº£ own keys** â€” bao gá»“m cáº£ non-enumerable VÃ€ Symbol keys â€” theo thá»© tá»±: integer indices (ascending) â†’ string keys (insertion order) â†’ Symbol keys (insertion order). ÄÃ¢y lÃ  tool duy nháº¥t cho báº¡n **toÃ n bá»™ own keys** mÃ  khÃ´ng bá» sÃ³t gÃ¬.

**`Object.hasOwn()` â€” ES2022 Replacement:**

`Object.hasOwn(obj, 'key')` â€” static method má»›i, thay tháº¿ `obj.hasOwnProperty('key')`. Táº¡i sao cáº§n thay tháº¿? 3 lÃ½ do:

1. **`Object.create(null)`**: Object khÃ´ng cÃ³ prototype â†’ khÃ´ng cÃ³ `hasOwnProperty` â†’ `obj.hasOwnProperty('x')` throws `TypeError`. `Object.hasOwn()` luÃ´n available vÃ¬ nÃ³ lÃ  static method trÃªn `Object`.
2. **Shadowed `hasOwnProperty`**: Ai Ä‘Ã³ cÃ³ thá»ƒ `obj.hasOwnProperty = () => true` â†’ má»i check Ä‘á»u tráº£ `true`. `Object.hasOwn()` khÃ´ng thá»ƒ bá»‹ shadow.
3. **ESLint rule**: `no-prototype-builtins` â€” lint rule phá»• biáº¿n cáº¥m gá»i methods trá»±c tiáº¿p tá»« prototype (`obj.hasOwnProperty()`). `Object.hasOwn()` bypass rule nÃ y.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// hasOwnProperty(): chá»‰ kiá»ƒm tra OWN property (trÃªn instance)
// in: kiá»ƒm tra cáº£ own + inherited (prototype chain)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Car(brand) {
  this.brand = brand; // own property
}

Car.prototype.wheels = 4; // inherited property

const tesla = new Car("Tesla");

// hasOwnProperty â€” chá»‰ own
tesla.hasOwnProperty("brand"); // true  â† own property
tesla.hasOwnProperty("wheels"); // false â† trÃªn prototype, khÃ´ng pháº£i own

// in â€” cáº£ own + inherited
"brand" in tesla; // true â† own
"wheels" in tesla; // true â† inherited tá»« prototype
"toString" in tesla; // true â† inherited tá»« Object.prototype

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Láº·p qua properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// for...in â†’ láº·p own + inherited (enumerable)
for (const key in tesla) {
  console.log(key);
  // "brand"  â† own
  // "wheels" â† inherited âš ï¸ (cÃ³ thá»ƒ khÃ´ng mong muá»‘n!)
}

// Object.keys() â†’ chá»‰ own enumerable
Object.keys(tesla); // ["brand"] â† chá»‰ own âœ…
```

### Common Gotchas

**BÃ i viáº¿t â€” 5 CÃ¡i Báº«y Kinh Äiá»ƒn (VÃ  CÃ¡ch Debug) Khi LÃ m Viá»‡c Vá»›i Prototype**

Prototype system tuy elegant nhÆ°ng Ä‘áº§y **landmines** áº©n. 5 gotcha dÆ°á»›i Ä‘Ã¢y xuáº¥t hiá»‡n trong **gáº§n nhÆ° má»i cuá»™c phá»ng váº¥n** vÃ  **gáº§n nhÆ° má»i production codebase** lá»›n. Hiá»ƒu chÃºng = survive interview VÃ€ trÃ¡nh production bugs, khÃ´ng hiá»ƒu = fail ngay. Má»—i gotcha Ä‘á»u Ä‘i kÃ¨m cÆ¡ cháº¿ engine-level, háº­u quáº£ thá»±c táº¿, vÃ  pattern fix.

**Gotcha 1 â€” Ghi Ä‘Ã¨ toÃ n bá»™ prototype (The Constructor Amnesia):**

Khi báº¡n viáº¿t `Foo.prototype = { bar() {} }`, báº¡n **thay tháº¿ hoÃ n toÃ n** prototype object cÅ© báº±ng object literal má»›i. Object literal Ä‘Æ°á»£c táº¡o bá»Ÿi `Object` constructor â†’ `.constructor` trá» vá» `Object`, KHÃ”NG vá» `Foo`. Háº­u quáº£ thá»±c táº¿:

- `new Foo().constructor !== Foo` â†’ **type identification sai**
- Libraries dÃ¹ng `.constructor` Ä‘á»ƒ clone (vÃ­ dá»¥: `new instance.constructor(...)`) táº¡o **wrong type**
- **Backbone.js** tá»«ng cÃ³ bug ná»•i tiáº¿ng liÃªn quan Ä‘áº¿n `.constructor` bá»‹ máº¥t khi extend models
- `instanceof` **VáºªN Ä‘Ãºng** vÃ¬ nÃ³ check chain (khÃ´ng dÃ¹ng `.constructor`) â€” Ä‘Ã¢y lÃ  lÃ½ do bug khÃ³ phÃ¡t hiá»‡n

**Táº¡i sao `instanceof` váº«n Ä‘Ãºng?** VÃ¬ `instanceof` chá»‰ kiá»ƒm tra: "liá»‡u `Constructor.prototype` cÃ³ náº±m trong `[[Prototype]]` chain cá»§a instance khÃ´ng?" Khi báº¡n gÃ¡n `Foo.prototype = { bar() {} }` VÃ€ táº¡o instance SAU Ä‘Ã³, instance's `[[Prototype]]` trá» Ä‘áº¿n object má»›i â†’ `instanceof Foo` váº«n `true`. NhÆ°ng náº¿u instance Ä‘Æ°á»£c táº¡o **TRÆ¯á»šC** khi ghi Ä‘Ã¨ prototype, `instanceof` tráº£ `false` â€” vÃ¬ instance cÅ© trá» Ä‘áº¿n prototype cÅ©, mÃ  `Foo.prototype` giá» lÃ  object khÃ¡c.

**V8 impact**: Ghi Ä‘Ã¨ prototype cÅ©ng **invalidate hidden classes** cá»§a táº¥t cáº£ instances liÃªn quan â†’ V8 pháº£i rebuild shape â†’ performance hit.

**Fix patterns**: (1) GÃ¡n tá»«ng method: `Foo.prototype.bar = function() {}`, (2) Náº¿u pháº£i ghi Ä‘Ã¨: luÃ´n fix constructor: `Foo.prototype = { constructor: Foo, bar() {} }`, (3) DÃ¹ng `Object.defineProperty` náº¿u cáº§n constructor non-enumerable: `Object.defineProperty(Foo.prototype, 'constructor', { value: Foo, enumerable: false })`.

**Gotcha 2 â€” Arrow function trÃªn prototype (The `this` Mirage):**

Arrow function KHÃ”NG CÃ“ own `this` binding â€” nÃ³ capture `this` tá»« **enclosing lexical scope** (closure). Khi gÃ¡n vÃ o prototype, `this` sáº½ trá» Ä‘áº¿n scope nÆ¡i arrow function Ä‘Æ°á»£c define, KHÃ”NG pháº£i instance gá»i method:

- Trong **module scope** (ESM): `this` = `undefined` (strict mode máº·c Ä‘á»‹nh)
- Trong **script scope** (browser): `this` = `window`
- Trong **Node.js CommonJS**: `this` = `module.exports` (object rá»—ng ban Ä‘áº§u)

ÄÃ¢y lÃ  reason táº¡i sao **class methods** dÃ¹ng regular function (method shorthand) chá»© khÃ´ng dÃ¹ng arrow function. Tuy nhiÃªn, arrow function **Há»®U ÃCH** khi gÃ¡n trong constructor: `this.handleClick = () => {}` â€” lÃºc nÃ y `this` capture Ä‘Ãºng instance (vÃ¬ constructor cháº¡y vá»›i `this` = instance má»›i).

**Real-world impact**: React class components dÃ¹ng pattern `this.handleClick = () => {}` trong constructor chÃ­nh lÃ  exploit Ä‘áº·c tÃ­nh nÃ y â€” arrow function auto-bind `this` Ä‘áº¿n instance, trÃ¡nh cáº§n `.bind(this)` trong `render()`. NhÆ°ng trade-off: má»—i instance cÃ³ **own copy** cá»§a handler function (khÃ´ng shared qua prototype) â†’ memory cost náº¿u cÃ³ nhiá»u instances.

**Gotcha 3 â€” `instanceof` vs prototype manipulation (The Identity Crisis):**

`instanceof` kiá»ƒm tra prototype chain â€” nhÆ°ng chain cÃ³ thá»ƒ bá»‹ manipulate. Ba scenarios nguy hiá»ƒm:

**3a.** `Object.create(null)` â†’ object khÃ´ng cÃ³ prototype â†’ `instanceof Object` tráº£ `false`. Object nÃ y cÅ©ng KHÃ”NG cÃ³ `toString()`, `valueOf()`, `hasOwnProperty()` â€” gá»i báº¥t ká»³ method nÃ o Ä‘á»u throw `TypeError`. ÄÃ¢y lÃ  "bare" object dÃ¹ng cho dictionaries.

**3b.** Cross-realm `instanceof`: Náº¿u `Array` Ä‘áº¿n tá»« iframe khÃ¡c, `myArray instanceof Array` cÃ³ thá»ƒ tráº£ `false` â€” vÃ¬ `Array` trong iframe A â‰  `Array` trong iframe B (khÃ¡c `prototype` object). ÄÃ¢y lÃ  lÃ½ do `Array.isArray()` tá»“n táº¡i â€” nÃ³ kiá»ƒm tra internal slot `[[Class]]` thay vÃ¬ prototype chain.

**3c.** Prototype swapping: Náº¿u báº¡n thay Ä‘á»•i `Constructor.prototype` SAU khi táº¡o instances, instances cÅ© trá»Ÿ nÃªn "má»“ cÃ´i" â€” `instanceof` tráº£ `false` dÃ¹ chÃºng váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng (methods váº«n trÃªn prototype cÅ©).

**Gotcha 4 â€” Shared mutable state trÃªn prototype (The Accidental Communism):**

ÄÃ¢y lÃ  gotcha **nguy hiá»ƒm nháº¥t** trong production vÃ¬ nÃ³ táº¡o bugs mÃ  háº§u nhÆ° khÃ´ng thá»ƒ detect báº±ng unit test Ä‘Æ¡n giáº£n. Khi prototype chá»©a **mutable reference types** (arrays, objects), táº¥t cáº£ instances **share cÃ¹ng reference**:

- `User.prototype.tags = []` â†’ `alice.tags.push('admin')` â†’ `bob.tags` = `['admin']` â†’ Má»ŒI user lÃ  admin
- Bug nÃ y Ä‘áº·c biá»‡t nguy hiá»ƒm vÃ¬: (1) `alice.tags` lookup traverse chain â†’ tÃ¬m array trÃªn prototype â†’ mutate IN-PLACE â†’ khÃ´ng táº¡o own property, (2) Unit test vá»›i single instance pass OK â€” bug chá»‰ xuáº¥t hiá»‡n khi cÃ³ **multiple instances**, (3) Bug Ã¢m tháº§m â€” khÃ´ng throw error, khÃ´ng cÃ³ warning

**Táº¡i sao `.push()` khÃ´ng táº¡o own property?** VÃ¬ `alice.tags.push('admin')` thá»±c cháº¥t lÃ : (1) `alice.tags` â†’ read operation â†’ traverse chain â†’ tÃ¬m array trÃªn prototype, (2) `.push('admin')` â†’ **method call trÃªn array object** â†’ mutate array in-place. KHÃ”NG cÃ³ assignment `alice.tags = ...` â†’ KHÃ”NG trigger property creation. So sÃ¡nh: `alice.tags = ['admin']` WOULD táº¡o own property (assignment = write = own property).

**Fix**: LUÃ”N khá»Ÿi táº¡o mutable values trong constructor: `this.tags = []`. Rule of thumb: **primitive values trÃªn prototype** á»•n (vÃ¬ assignment táº¡o own property), **reference values trÃªn prototype** = bug waiting to happen.

**Gotcha 5 â€” `for...in` duyá»‡t inherited properties (The Phantom Properties):**

`for...in` duyá»‡t **táº¥t cáº£ enumerable properties** trÃªn own object VÃ€ toÃ n bá»™ prototype chain. ÄÃ¢y lÃ  source of bugs #1 trong ES3/ES5 codebases:

- Third-party library extend `Object.prototype` (vÃ­ dá»¥: MooTools, Prototype.js thá»i 2000s) â†’ `for...in` trÃªn Má»ŒI object bá»—ng output thÃªm methods láº¡
- JSON serialization báº±ng manual `for...in` â†’ serialize cáº£ inherited properties â†’ API payload sai
- Object comparison báº±ng `for...in` â†’ false positives vÃ¬ inherited keys match

**Modern fix**: DÃ¹ng `Object.keys()`, `Object.values()`, `Object.entries()` (chá»‰ own enumerable). DÃ¹ng `for...of` vá»›i `Object.entries()`. Chá»‰ dÃ¹ng `for...in` khi **intentionally** muá»‘n duyá»‡t inherited properties (ráº¥t hiáº¿m).

> **Debugging tip**: Khi gáº·p prototype-related bug, dÃ¹ng `console.dir(obj)` (Chrome DevTools) Ä‘á»ƒ xem **full property list** bao gá»“m `[[Prototype]]` chain. Hoáº·c dÃ¹ng `Object.getOwnPropertyNames(obj)` Ä‘á»ƒ liá»‡t kÃª CHá»ˆ own properties (ká»ƒ cáº£ non-enumerable). `Reflect.ownKeys(obj)` cho báº¡n **má»i thá»©** ká»ƒ cáº£ Symbol keys.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: Ghi Ä‘Ã¨ toÃ n bá»™ prototype â†’ máº¥t constructor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Foo() {}

Foo.prototype = {
  // âŒ Ghi Ä‘Ã¨ â†’ máº¥t constructor reference!
  bar() {
    return "bar";
  },
};

const f = new Foo();
console.log(f.constructor === Foo); // false âŒ
console.log(f.constructor === Object); // true â† fallback

// âœ… FIX: Define láº¡i constructor
Foo.prototype = {
  constructor: Foo, // â† phá»¥c há»“i
  bar() {
    return "bar";
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: Arrow function trÃªn prototype â†’ this issue
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Widget(id) {
  this.id = id;
}

Widget.prototype.render = () => {
  return this.id; // âŒ Arrow fn â†’ lexical this = window/undefined
};

const w = new Widget(1);
w.render(); // undefined âŒ

// âœ… FIX: DÃ¹ng regular function
Widget.prototype.render = function () {
  return this.id; // âœ… this = instance
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: instanceof kiá»ƒm tra prototype chain
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log([] instanceof Array); // true
console.log([] instanceof Object); // true â† Array.prototype.__proto__ = Object.prototype

console.log({} instanceof Object); // true

// âš ï¸ Object.create(null) â†’ object KHÃ”NG CÃ“ prototype
const bare = Object.create(null);
console.log(bare instanceof Object); // false!
console.log(bare.__proto__); // undefined
// â†’ Object nÃ y khÃ´ng káº¿ thá»«a gÃ¬ cáº£, khÃ´ng cÃ³ toString(), etc.

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3b: Cross-realm instanceof
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Trong browser vá»›i iframe:
// const iframe = document.createElement('iframe');
// document.body.appendChild(iframe);
// const iframeArray = iframe.contentWindow.Array;
// const arr = new iframeArray(1, 2, 3);
// arr instanceof Array;        // false âŒ (khÃ¡c realm!)
// Array.isArray(arr);          // true  âœ… (check internal slot)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 4: Shared mutable state trÃªn prototype
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Team(name) {
  this.name = name;
  // âœ… Mutable values PHáº¢I khá»Ÿi táº¡o trong constructor
  // this.members = [];  â† ÄÃšNG CÃCH
}

// âŒ NGUY HIá»‚M: Array trÃªn prototype = shared giá»¯a Táº¤T Cáº¢ instances
Team.prototype.members = []; // â† BUG!

const alpha = new Team("Alpha");
const bravo = new Team("Bravo");

alpha.members.push("Alice");
console.log(bravo.members); // ["Alice"] âŒ â† Bravo cÅ©ng cÃ³ Alice!
// VÃ¬: alpha.members â†’ tra chain â†’ tÃ¬m [] trÃªn prototype â†’ push() mutate IN-PLACE
// â†’ KHÃ”NG táº¡o own property â†’ táº¥t cáº£ instances share cÃ¹ng array

// So sÃ¡nh: primitive trÃªn prototype â†’ AN TOÃ€N
Team.prototype.maxSize = 10;
alpha.maxSize = 5; // â† Táº¡o OWN property (assignment = write)
console.log(bravo.maxSize); // 10 â† Váº«n tá»« prototype, khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 5: for...in duyá»‡t inherited properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Product(name, price) {
  this.name = name;
  this.price = price;
}
Product.prototype.category = "general"; // enumerable inherited property

const item = new Product("Laptop", 999);

// âŒ for...in â†’ duyá»‡t Cáº¢ inherited
const data1 = {};
for (const key in item) {
  data1[key] = item[key];
}
console.log(data1); // { name: "Laptop", price: 999, category: "general" } â† category thá»«a!

// âœ… Object.keys() â†’ chá»‰ own enumerable
const data2 = {};
for (const key of Object.keys(item)) {
  data2[key] = item[key];
}
console.log(data2); // { name: "Laptop", price: 999 } â† chÃ­nh xÃ¡c!

// âœ… Modern: Object.fromEntries + Object.entries
const data3 = { ...item }; // Spread cÅ©ng chá»‰ copy own enumerable
console.log(data3); // { name: "Laptop", price: 999 } âœ…
```

### Tá»•ng Há»£p: Prototype Chain

**BÃ i viáº¿t â€” The Complete Picture: Prototype Trong Bá»©c Tranh Lá»›n**

Sau táº¥t cáº£ sections, subsections, vÃ  gotchas, hÃ£y zoom out vÃ  nhÃ¬n prototype system tá»« bird's-eye view. Prototype khÃ´ng chá»‰ lÃ  má»™t feature â€” nÃ³ lÃ  **DNA cá»§a JavaScript**, áº£nh hÆ°á»Ÿng Ä‘áº¿n Má»ŒI thá»© tá»« basic object creation Ä‘áº¿n framework architecture.

**6 KhÃ¡i Niá»‡m Cá»‘t LÃµi â€” The Irreducible Minimum:**

1. **`.prototype`** = property cá»§a function â†’ chá»©a shared methods. Má»i function (trá»« arrow) tá»± Ä‘á»™ng cÃ³. ÄÃ¢y lÃ  **blueprint** cho instances.
2. **`__proto__` / `[[Prototype]]`** = internal link cá»§a má»i object â†’ trá» lÃªn prototype. ÄÃ¢y lÃ  **mechanism** cho delegation. DÃ¹ng `Object.getPrototypeOf()` thay vÃ¬ `__proto__`.
3. **`.constructor`** = property trÃªn prototype â†’ trá» ngÆ°á»£c vá» constructor function. Dá»… bá»‹ máº¥t khi ghi Ä‘Ã¨ prototype. KhÃ´ng critical cho runtime, nhÆ°ng quan trá»ng cho type identification.
4. **Property lookup** = duyá»‡t chain `obj â†’ __proto__ â†’ __proto__ â†’ ... â†’ null`. Read operations traverse UP. Engines optimize báº±ng inline caches vÃ  hidden classes.
5. **Property write** = luÃ´n táº¡o/update own property trÃªn target object, KHÃ”NG bao giá» Ä‘á»¥ng chain (ngoáº¡i trá»« `writable: false` vÃ  setter trÃªn chain).
6. **ES6 class** = syntactic sugar â€” transpile thÃ nh prototype + constructor. `extends` = `Object.setPrototypeOf()`. `super()` = `Parent.call(this)`. BÃªn dÆ°á»›i váº«n lÃ  prototype chain.

**Prototype vs Scope Chain â€” Hai Há»‡ Thá»‘ng Lookup Song Song:**

JavaScript engine cháº¡y **hai há»‡ thá»‘ng tÃ¬m kiáº¿m Ä‘á»“ng thá»i** mÃ  developers thÆ°á»ng nháº§m láº«n. Scope chain tÃ¬m **biáº¿n** (variables) â€” traverse tá»« local scope lÃªn closure scopes lÃªn global, throw `ReferenceError` náº¿u khÃ´ng tÃ¬m tháº¥y. Prototype chain tÃ¬m **properties** (thuá»™c tÃ­nh trÃªn objects) â€” traverse tá»« instance lÃªn prototype chain, return `undefined` náº¿u khÃ´ng tÃ¬m tháº¥y. Hai há»‡ thá»‘ng nÃ y **hoÃ n toÃ n Ä‘á»™c láº­p** â€” scope chain dÃ¹ng khi báº¡n viáº¿t `x` (bare identifier), prototype chain dÃ¹ng khi báº¡n viáº¿t `obj.x` (property access). Nháº§m láº«n giá»¯a hai há»‡ thá»‘ng nÃ y lÃ  nguá»“n gá»‘c cá»§a hÃ ng ngÃ n bugs.

**Prototype Trong Modern JavaScript â€” Váº«n Quan Trá»ng HÆ¡n Báº¡n NghÄ©:**

DÃ¹ community Ä‘ang dá»‹ch chuyá»ƒn sang composition (React Hooks, functional patterns), prototype váº«n lÃ  **foundation** mÃ  má»i thá»© khÃ¡c xÃ¢y trÃªn:

- **Every object** báº¡n táº¡o Ä‘á»u cÃ³ prototype chain, ká»ƒ cáº£ object literals `{}`
- **Every array method** (`map`, `filter`, `reduce`) náº±m trÃªn `Array.prototype`
- **Every Promise** báº¡n dÃ¹ng káº¿ thá»«a tá»« `Promise.prototype`
- **DOM APIs** dá»±a 100% trÃªn prototype: `HTMLDivElement â†’ HTMLElement â†’ Element â†’ Node â†’ EventTarget â†’ Object.prototype`
- **Node.js streams** dá»±a trÃªn prototype inheritance: `ReadableStream â†’ Stream â†’ EventEmitter`
- **TypeScript classes** compile thÃ nh... prototype + constructor (ES5 target)

Hiá»ƒu prototype = hiá»ƒu **Má»ŒI THá»¨** trong JavaScript. KhÃ´ng hiá»ƒu = luÃ´n gáº·p bugs "khÃ´ng giáº£i thÃ­ch Ä‘Æ°á»£c".

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROTOTYPE CHAIN â€” SUMMARY                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Concept           â”‚  MÃ´ táº£                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  .prototype        â”‚  Property cá»§a FUNCTION               â”‚  â”‚
â”‚  â”‚                    â”‚  Object chá»©a methods shared          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  .__proto__        â”‚  Property áº©n cá»§a má»i OBJECT           â”‚  â”‚
â”‚  â”‚                    â”‚  Trá» Ä‘áº¿n prototype cá»§a Constructor   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  .constructor      â”‚  Trá» ngÆ°á»£c vá» Constructor function   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Prototype Chain   â”‚  __proto__ â†’ __proto__ â†’ ... â†’ null   â”‚  â”‚
â”‚  â”‚                    â”‚  Chuá»—i tÃ¬m kiáº¿m property             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Chain Terminus    â”‚  Object.prototype.__proto__ = null    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Pass-by-ref       â”‚  Thay Ä‘á»•i prototype â†’ áº£nh hÆ°á»Ÿng      â”‚  â”‚
â”‚  â”‚                    â”‚  Táº¤T Cáº¢ instances (shared reference) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ ES6 class lÃ  SYNTACTIC SUGAR â€” cÃ¹ng cÆ¡ cháº¿ prototype         â”‚
â”‚  âš ï¸ DÃ¹ng Object.getPrototypeOf() thay vÃ¬ __proto__ (deprecated) â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  SCOPE CHAIN vs PROTOTYPE CHAIN:                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Scope Chain     â†’ tÃ¬m BIáº¾N     (ReferenceError)           â”‚ â”‚
â”‚  â”‚  Prototype Chain â†’ tÃ¬m PROPERTY (undefined)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”¬ Deep Analysis Patterns â€” Prototype & Prototype Chain

#### Pattern 1: 5 Whys â€” Táº¡i Sao JavaScript DÃ¹ng Prototype?

**BÃ i viáº¿t â€” ÄÃ o SÃ¢u Gá»‘c Rá»…: 5 CÃ¢u Há»i "Táº¡i Sao" Dáº«n Äáº¿n Báº£n Cháº¥t Prototype**

PhÆ°Æ¡ng phÃ¡p "5 Whys" (gá»‘c tá»« Toyota Production System) buá»™c chÃºng ta Ä‘Ã o sÃ¢u qua tá»«ng lá»›p "táº¡i sao" cho Ä‘áº¿n khi cháº¡m Ä‘áº¿n **root cause** â€” lÃ½ do gá»‘c rá»…. Ãp dá»¥ng cho prototype system, má»—i "Why" bÃ³c tÃ¡ch má»™t lá»›p lá»‹ch sá»­, ká»¹ thuáº­t, vÃ  chiáº¿n lÆ°á»£c thiáº¿t káº¿ mÃ  háº§u háº¿t developers chÆ°a bao giá» biáº¿t.

**Why 1: Táº¡i sao JavaScript dÃ¹ng prototype-based inheritance thay vÃ¬ class-based?**

CÃ¢u tráº£ lá»i ngáº¯n: vÃ¬ Brendan Eich thiáº¿t káº¿ JS trong 10 ngÃ y (thÃ¡ng 5/1995) dá»±a trÃªn ngÃ´n ngá»¯ **Self** â€” prototype-based language ra Ä‘á»i táº¡i Xerox PARC nÄƒm 1986 bá»Ÿi David Ungar vÃ  Randall Smith. NhÆ°ng cÃ¢u tráº£ lá»i dÃ i thÃº vá»‹ hÆ¡n nhiá»u.

Self Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i triáº¿t lÃ½ **"everything is an object, and objects beget objects"** â€” loáº¡i bá» hoÃ n toÃ n sá»± phÃ¢n biá»‡t giá»¯a class vÃ  instance. Trong Self, báº¡n khÃ´ng "define class rá»“i instantiate" â€” báº¡n **clone** má»™t object cÃ³ sáºµn rá»“i modify. Eich bá»‹ áº£nh hÆ°á»Ÿng sÃ¢u sáº¯c bá»Ÿi triáº¿t lÃ½ nÃ y, nhÆ°ng cÃ²n cÃ³ lÃ½ do thá»±c dá»¥ng hÆ¡n: prototype-based **Ä‘Æ¡n giáº£n hÆ¡n** class-based á»Ÿ má»©c implementation. KhÃ´ng cáº§n metaclass (class-of-a-class), khÃ´ng cáº§n vtable (virtual method table), khÃ´ng cáº§n complex method resolution order (MRO) nhÆ° Python. Chá»‰ cáº§n: object â†’ pointer to another object â†’ traversal. Vá»›i deadline 10 ngÃ y, simplicity lÃ  survival strategy.

ThÃªm vÃ o Ä‘Ã³, Eich ban Ä‘áº§u muá»‘n Ä‘Æ°a **Scheme** (Lisp dialect) vÃ o browser â€” first-class functions, closures, dynamic typing. Netscape management can thiá»‡p: "NÃ³ pháº£i NHÃŒN GIá»NG Java!" (marketing agreement vá»›i Sun Microsystems). Káº¿t quáº£: JavaScript = **Scheme semantics** (functions, closures) + **Self object model** (prototypes) + **Java syntax** (curly braces, `new` keyword). Ba DNA strands quáº¥n vÃ o nhau â€” vÃ  prototype lÃ  strand quyáº¿t Ä‘á»‹nh há»‡ thá»‘ng káº¿ thá»«a.

So sÃ¡nh vá»›i class-based systems: Java cáº§n 4 concepts (class, interface, abstract class, final class) chá»‰ Ä‘á»ƒ setup inheritance hierarchy. JavaScript cáº§n 1: object + `[[Prototype]]` link. ÄÃ¢y lÃ  elegance-through-simplicity mÃ  class-based systems khÃ´ng cÃ³.

**Why 2: Táº¡i sao khÃ´ng thÃªm class system tháº­t ngay tá»« Ä‘áº§u?**

Bá»‘i cáº£nh nÄƒm 1995 ráº¥t quan trá»ng: JavaScript KHÃ”NG pháº£i ngÃ´n ngá»¯ cho "real programmers". Netscape Ä‘á»‹nh vá»‹ JS lÃ  **"scripting language cho web designers vÃ  amateurs"** â€” people who write `onClick="alert('Hello!')"`, khÃ´ng pháº£i people who design class hierarchies. Marc Andreessen (CEO Netscape) nÃ³i rÃµ: "We need a language that looks like Java but is easy enough for non-programmers."

Class system (vá»›i abstract classes, interfaces, access modifiers, type checking) quÃ¡ phá»©c táº¡p cho target audience. Prototype Ä‘Æ¡n giáº£n hÆ¡n: táº¡o object, gáº¯n methods, done. KhÃ´ng cáº§n `public`, `private`, `protected`, `implements`, `extends`, `abstract`. ThÃªm ná»¯a, Java Ä‘Ã£ tá»“n táº¡i cho "serious programming" â€” JavaScript chá»‰ cáº§n "glue scripting" trong browser.

Irony lá»›n nháº¥t: JavaScript cuá»‘i cÃ¹ng TRá» THÃ€NH ngÃ´n ngá»¯ cháº¡y hÃ ng triá»‡u á»©ng dá»¥ng phá»©c táº¡p â€” tá»« Gmail Ä‘áº¿n VS Code â€” vÃ  developers Java/C# liÃªn tá»¥c phÃ n nÃ n "táº¡i sao khÃ´ng cÃ³ class system?". 20 nÄƒm sau, ES6 thÃªm `class` keyword... nhÆ°ng dÆ°á»›i hood váº«n lÃ  prototype. History repeats itself.

LÆ°u Ã½ quan trá»ng: má»™t sá»‘ ngÃ´n ngá»¯ prototype-based KHÃC (nhÆ° Io, Lua) cÅ©ng chá»n khÃ´ng cÃ³ class keyword â€” vÃ  chÃºng hoáº¡t Ä‘á»™ng tá»‘t. Váº¥n Ä‘á» khÃ´ng pháº£i prototype "cáº§n" class, mÃ  lÃ  **developer familiarity** vá»›i OOP class-based paradigm quÃ¡ máº¡nh â€” Ä‘Ã¢y lÃ  hiá»‡u á»©ng "path dependence" trong software engineering.

**Why 3: Táº¡i sao prototype chain láº¡i lÃ  linked list (single inheritance)?**

JavaScript chá»n **delegation over copying** vÃ  **single chain over multiple chains**. HÃ£y phÃ¢n tÃ­ch táº¡i sao:

**Delegation pattern** hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o: khi object khÃ´ng cÃ³ property, thay vÃ¬ "tÃ´i copy property tá»« parent vÃ o mÃ¬nh" (copying â€” nhÆ° Lua mÃ¨che), JavaScript nÃ³i "tÃ´i há»i parent cá»§a tÃ´i" (delegation). Delegation cáº§n **pointer** (reference Ä‘áº¿n parent), khÃ´ng cáº§n **copy** (duplicate data). Má»™t pointer = O(1) memory per instance, báº¥t ká»ƒ parent cÃ³ bao nhiÃªu methods.

**Single chain** (linked list) thay vÃ¬ **multiple chains** (DAG â€” directed acyclic graph) trÃ¡nh **"diamond problem"**: náº¿u object káº¿ thá»«a tá»« hai parents cÃ¹ng define method `foo()`, gá»i `obj.foo()` dÃ¹ng version nÃ o? C++ giáº£i quyáº¿t báº±ng virtual inheritance (phá»©c táº¡p), Python dÃ¹ng MRO/C3 linearization (phá»©c táº¡p hÆ¡n), Java cáº¥m multiple inheritance of implementation (restrictive). JavaScript chá»n giáº£i phÃ¡p Ä‘Æ¡n giáº£n nháº¥t: **khÃ´ng cho phÃ©p** â€” chain lÃ  linked list, má»—i node chá»‰ cÃ³ 1 parent. Náº¿u cáº§n multiple behaviors, dÃ¹ng **mixin** hoáº·c **composition** (patterns á»Ÿ application level, khÃ´ng pháº£i language level).

Trade-off rÃµ rÃ ng: single inheritance Ä‘Æ¡n giáº£n hÆ¡n nhÆ°ng restrictive hÆ¡n. Trong practice, háº§u háº¿t real-world object hierarchies KHÃ”NG cáº§n multiple inheritance â€” "is-a" relationship hiáº¿m khi phÃ¢n nhÃ¡nh. VÃ  khi cáº§n, mixin pattern (ES6: `class Dog extends Serializable(EventEmitter(Animal)) {}`) "giáº£ láº­p" multiple inheritance báº±ng cÃ¡ch **ná»‘i dÃ i** chain thay vÃ¬ **phÃ¢n nhÃ¡nh** chain.

**Why 4: Táº¡i sao `Object.prototype` lÃ  Ä‘á»‰nh chain thay vÃ¬ null?**

Má»i object cáº§n **baseline methods** â€” nhá»¯ng utility functions mÃ  **báº¥t ká»³ object nÃ o** cÅ©ng cáº§n, báº¥t ká»ƒ type. `Object.prototype` Ä‘Ã³ng vai trÃ² **"universal ancestor"** chá»©a:

- `toString()` â€” chuyá»ƒn object thÃ nh string (quan trá»ng cho string concatenation, template literals, debugging)
- `valueOf()` â€” chuyá»ƒn object thÃ nh primitive (quan trá»ng cho arithmetic, comparison operators)
- `hasOwnProperty()` â€” kiá»ƒm tra own property (quan trá»ng cho `for...in` guards)
- `isPrototypeOf()` â€” kiá»ƒm tra prototype chain membership
- `propertyIsEnumerable()` â€” kiá»ƒm tra enumerability
- `toLocaleString()` â€” locale-specific string conversion

Náº¿u KHÃ”NG cÃ³ `Object.prototype` (chain káº¿t thÃºc táº¡i `null` ngay), thÃ¬ **má»i object** pháº£i tá»± define `toString()`, `valueOf()`, etc. â€” hoáº·c JS engine pháº£i hardcode nhá»¯ng behaviors nÃ y vÃ o runtime (ugly). `Object.prototype` lÃ  **abstraction layer** phÃ¢n tÃ¡ch "universal behavior" khá»i "type-specific behavior".

Thiáº¿t káº¿ nÃ y mirror **evolutionary biology**: má»i sinh váº­t (instances) Ä‘á»u cÃ³ tá»• tiÃªn chung (LUCA â€” Last Universal Common Ancestor â‰ˆ `Object.prototype`), chia sáº» "baseline traits" (DNA replication â‰ˆ `toString()`). Object.prototype â†’ null mirror "trÆ°á»›c LUCA lÃ  gÃ¬? KhÃ´ng cÃ³ gÃ¬."

Fun fact: `Object.prototype` báº£n thÃ¢n nÃ³ cÅ©ng lÃ  object, nhÆ°ng `Object.getPrototypeOf(Object.prototype) === null` â€” Ä‘Ã¢y lÃ  **terminus** (Ä‘iá»ƒm káº¿t). Specification báº¯t buá»™c Ä‘iá»u nÃ y Ä‘á»ƒ trÃ¡nh infinite loop trong property lookup.

**Why 5: Táº¡i sao ES6 thÃªm `class` keyword náº¿u prototype Ä‘Ã£ Ä‘á»§?**

VÃ¬ **developer experience** (DX) vÃ  **ecosystem growth**. Prototype mechanism Ä‘Ãºng vá» máº·t ká»¹ thuáº­t, nhÆ°ng syntax gÃ¢y ra 3 váº¥n Ä‘á» nghiÃªm trá»ng:

1. **Learning curve**: Millions of developers Ä‘áº¿n tá»« Java, C#, Python â€” há» nghÄ© báº±ng "class". Báº¯t há» nghÄ© báº±ng "prototype + constructor function + Object.create" = barrier to adoption. `class` keyword giáº£m cognitive load báº±ng cÃ¡ch cung cáº¥p familiar syntax.

2. **Boilerplate vÃ  bugs**: ES5 inheritance cáº§n "ritual 3 bÆ°á»›c" (constructor stealing + prototype linkage + constructor fix) â€” quÃªn báº¥t ká»³ bÆ°á»›c nÃ o = subtle bugs. `class extends` automate táº¥t cáº£ â†’ fewer bugs, faster development.

3. **Tooling**: Static analysis tools (TypeScript, ESLint, IDEs) hiá»ƒu `class` dá»… hÆ¡n prototype pattern. TypeScript's type system BUILT AROUND class hierarchy. IDE auto-completion cho class methods works out-of-the-box, nhÆ°ng prototype methods cáº§n extra hints.

NhÆ°ng `class` keyword gÃ¢y **controversy** lá»›n trong community. Douglas Crockford (tÃ¡c giáº£ "JavaScript: The Good Parts") pháº£n Ä‘á»‘i: "Adding classes to JavaScript is like adding training wheels to a motorcycle â€” it makes something simple look complex." Kyle Simpson (You Don't Know JS) gá»i class lÃ  "syntactic sugar that gives the wrong mental model â€” developers THINK they're using class-based inheritance, but they're NOT."

**Káº¿t luáº­n root cause**: JavaScript dÃ¹ng prototype vÃ¬ nÃ³ sinh ra tá»« **Self + Scheme + time pressure** â†’ single chain vÃ¬ **simplicity over flexibility** â†’ `Object.prototype` lÃ  root vÃ¬ **universal methods cáº§n common ancestor** â†’ ES6 `class` vÃ¬ **DX over purity**. Má»—i "Why" dáº«n Ä‘áº¿n trade-off cá»¥ thá»ƒ â€” hiá»ƒu trade-offs = hiá»ƒu táº¡i sao JavaScript lÃ  JavaScript.

---

#### Pattern 2: First Principles â€” Prototype Hoáº¡t Äá»™ng Tháº¿ NÃ o á» Má»©c Tháº¥p Nháº¥t?

**BÃ i viáº¿t â€” BÃ³c TÃ¡ch Engine: Tá»« Internal Slots Äáº¿n Hidden Classes**

First Principles thinking (tÆ° duy tá»« nguyÃªn lÃ½ gá»‘c) Ä‘Ã²i há»i chÃºng ta bá» qua abstraction layers vÃ  Ä‘i tháº³ng vÃ o **cÆ¡ cháº¿ cá»‘t lÃµi**. Khi nÃ³i "prototype", háº§u háº¿t developer nghÄ© báº±ng syntax (`__proto__`, `.prototype`). NhÆ°ng bÃªn dÆ°á»›i syntax lÃ  má»™t há»‡ thá»‘ng tinh vi mÃ  ECMAScript specification vÃ  JavaScript engines (V8, SpiderMonkey, JSC) triá»ƒn khai ráº¥t khÃ¡c nhau vá» máº·t optimization, dÃ¹ behavior bÃªn ngoÃ i pháº£i giá»‘ng há»‡t nhau.

**NguyÃªn lÃ½ 1 â€” Internal Slot `[[Prototype]]`: Pointer Táº§ng Tháº¥p**

Má»—i object trong JavaScript cÃ³ má»™t internal slot `[[Prototype]]` â€” **KHÃ”NG pháº£i property**, mÃ  lÃ  metadata á»Ÿ engine level. Internal slots Ä‘Æ°á»£c kÃ½ hiá»‡u báº±ng `[[ ]]` trong ECMAScript specification â€” báº¡n khÃ´ng thá»ƒ truy cáº­p trá»±c tiáº¿p báº±ng code (ngoáº¡i trá»« qua accessor `__proto__` hoáº·c API `Object.getPrototypeOf()`).

Slot nÃ y chá»©a **reference (pointer)** Ä‘áº¿n prototype object, hoáº·c `null`. Khi engine cáº§n resolve property, nÃ³ thá»±c hiá»‡n thuáº­t toÃ¡n `OrdinaryGet`:

```
OrdinaryGet(O, P, Receiver):
  1. Kiá»ƒm tra O cÃ³ own property P khÃ´ng (HasOwnProperty)
  2. Náº¿u tÃ¬m tháº¥y:
     a. Náº¿u P lÃ  data descriptor â†’ return value
     b. Náº¿u P lÃ  accessor descriptor â†’ gá»i getter vá»›i Receiver lÃ m this
  3. Náº¿u khÃ´ng tÃ¬m tháº¥y:
     a. parent = O.[[Prototype]]
     b. Náº¿u parent === null â†’ return undefined
     c. Return parent.[[Get]](P, Receiver)  // Ä‘á»‡ quy!
```

Äiá»ƒm tinh táº¿ mÃ  Ã­t developer biáº¿t: tham sá»‘ `Receiver` **luÃ´n giá»¯ nguyÃªn** object ban Ä‘áº§u (nÆ¡i property access báº¯t Ä‘áº§u) qua toÃ n bá»™ quÃ¡ trÃ¬nh Ä‘á»‡ quy. Äiá»u nÃ y quan trá»ng cho **accessor properties (getters/setters)**: khi getter náº±m trÃªn prototype nhÆ°ng `this` bÃªn trong getter pháº£i trá» Ä‘áº¿n **instance** (receiver), KHÃ”NG pháº£i prototype object nÆ¡i getter Ä‘Æ°á»£c define. ÄÃ¢y lÃ  lÃ½ do `this` trong inherited getters hoáº¡t Ä‘á»™ng "Ä‘Ãºng" â€” nhá» Receiver propagation.

Specification cÅ©ng define `OrdinarySet(O, P, V, Receiver)` cho property assignment â€” thuáº­t toÃ¡n phá»©c táº¡p hÆ¡n vÃ¬ pháº£i handle 3 cases: (1) own data property â†’ update, (2) inherited setter â†’ call setter, (3) inherited `writable: false` â†’ reject in strict mode. Má»—i case cÃ³ behavior khÃ¡c nhau â€” Ä‘Ã¢y lÃ  nguá»“n gá»‘c cá»§a "property shadowing edge cases" mÃ  YDKJS (You Don't Know JS) dÃ nh nhiá»u trang giáº£i thÃ­ch.

**NguyÃªn lÃ½ 2 â€” Hidden Class (V8 Shapes/Maps): Táº¡i Sao Prototype Fast?**

V8 KHÃ”NG lÆ°u prototype chain nhÆ° linked list Ä‘Æ¡n giáº£n trong production. Má»—i object cÃ³ **hidden class** (call "Map" internally, hoáº·c "Shape" trong SpiderMonkey) â€” metadata object chá»©a:

- **Property layout**: vá»‹ trÃ­ (offset) cÃ¡c properties trong memory buffer. VÃ­ dá»¥: `name` á»Ÿ offset 0, `age` á»Ÿ offset 8.
- **Prototype reference**: pointer Ä‘áº¿n prototype object.
- **Transition table**: khi thÃªm property má»›i, object chuyá»ƒn sang hidden class nÃ o? VÃ­ dá»¥: class `{name}` + add `age` â†’ transition to class `{name, age}`.

Khi 1000 objects Ä‘Æ°á»£c táº¡o bá»Ÿi cÃ¹ng constructor theo cÃ¹ng thá»© tá»± property assignment, chÃºng **share cÃ¹ng hidden class** â€” V8 chá»‰ cáº§n lÆ°u metadata 1 láº§n. ÄÃ¢y lÃ  lÃ½ do constructor functions nÃªn **luÃ´n khá»Ÿi táº¡o properties theo cÃ¹ng thá»© tá»±** â€” náº¿u `Person("Alice")` gÃ¡n `this.name` rá»“i `this.age`, nhÆ°ng `Person("Bob")` gÃ¡n `this.age` rá»“i `this.name`, chÃºng táº¡o **hai hidden classes khÃ¡c nhau** â†’ V8 máº¥t cÆ¡ há»™i optimization.

**Inline Cache (IC)** lÃ  optimization layer trÃªn hidden classes. Khi engine tháº¥y `obj.toString()` láº§n Ä‘áº§u, nÃ³ traverse chain, tÃ¬m `toString` trÃªn `Object.prototype` á»Ÿ offset X. IC ghi nhá»›: "Hidden class Y + property `toString` â†’ offset X trÃªn prototype Z." Láº§n sau gáº·p `obj2.toString()` vá»›i cÃ¹ng hidden class â†’ **skip chain traversal**, Ä‘i tháº³ng Ä‘áº¿n offset X. Tá»‘c Ä‘á»™: gáº§n báº±ng **direct memory access** (nanoseconds).

IC cÃ³ 4 tráº¡ng thÃ¡i (states) quan trá»ng:

- **Monomorphic**: 1 hidden class â†’ 1 cache entry. Tá»‘c Ä‘á»™ nhanh nháº¥t. Xáº£y ra khi cÃ¹ng type objects Ä‘i qua cÃ¹ng code path.
- **Polymorphic**: 2-4 hidden classes â†’ 2-4 cache entries. Váº«n nhanh. Xáº£y ra khi function nháº­n objects tá»« vÃ i constructors khÃ¡c nhau.
- **Megamorphic**: >4 hidden classes â†’ cache bá»‹ flush, fallback to generic lookup. Cháº­m. Xáº£y ra khi function nháº­n quÃ¡ nhiá»u object types khÃ¡c nhau.
- **Uninitialized**: chÆ°a cÃ³ data â†’ first access trigger chain traversal + cache population.

**Lesson thá»±c táº¿**: code truy cáº­p prototype methods thÆ°á»ng **monomorphic** (vÃ¬ objects tá»« cÃ¹ng constructor share hidden class) â†’ cá»±c ká»³ nhanh. NhÆ°ng náº¿u báº¡n viáº¿t generic function nháº­n objects tá»« 10+ constructors â†’ IC degrades to megamorphic â†’ má»—i property access lÃ  full chain traversal. ÄÃ¢y lÃ  hidden performance cliff mÃ  profilers hiáº¿m khi show rÃµ.

**NguyÃªn lÃ½ 3 â€” Property Descriptor: Metadata Quyáº¿t Äá»‹nh Má»i Behavior**

Má»—i property thá»±c cháº¥t lÃ  má»™t **descriptor** â€” metadata object quyáº¿t Ä‘á»‹nh behavior cá»§a property:

```javascript
// Khi báº¡n viáº¿t: obj.x = 42
// V8 ná»™i bá»™ táº¡o DATA descriptor:
{
  value: 42,
  writable: true,     // cÃ³ thá»ƒ ghi láº¡i? (obj.x = 100)
  enumerable: true,   // xuáº¥t hiá»‡n trong for...in / Object.keys()?
  configurable: true  // cÃ³ thá»ƒ delete / redefine descriptor?
}

// Prototype methods built-in luÃ´n lÃ :
{
  value: function() {},
  writable: true,
  enumerable: false,  // â† INVISIBLE trong for...in / Object.keys()
  configurable: true
}
// â†’ ÄÃ¢y lÃ  LÃ DO toString(), valueOf(), etc. KHÃ”NG xuáº¥t hiá»‡n
//   khi báº¡n for...in hoáº·c Object.keys() â€” intentional design!

// ACCESSOR descriptor (getter/setter) khÃ¡c hoÃ n toÃ n:
{
  get: function() { return this._x; },
  set: function(v) { this._x = v; },
  enumerable: true,
  configurable: true
  // KHÃ”NG cÃ³ value/writable â€” data vÃ  accessor mutually exclusive
}
```

**Invariant quan trá»ng**: náº¿u property `configurable: false` VÃ€ `writable: false`, thÃ¬ **giÃ¡ trá»‹ KHÃ”NG thá»ƒ thay Ä‘á»•i báº±ng báº¥t ká»³ cÃ¡ch nÃ o** â€” ká»ƒ cáº£ `Object.defineProperty()` sáº½ throw `TypeError`. Specification enforce "integrity level" nÃ y vÃ¬ nÃ³ cho phÃ©p engines **hardcode giÃ¡ trá»‹** Ä‘á»ƒ optimize. `Object.freeze()` Ä‘áº·t Táº¤T Cáº¢ properties thÃ nh `configurable: false, writable: false`, khiáº¿n object thá»±c sá»± immutable (á»Ÿ shallow level).

**NguyÃªn lÃ½ 4 â€” Shadowing vs Assignment: Read/Write Asymmetry**

ÄÃ¢y lÃ  nguyÃªn lÃ½ ÃT ÄÆ¯á»¢C HIá»‚U NHáº¤T nhÆ°ng **gÃ¢y nhiá»u bugs nháº¥t**. Rule core:

- **READ (`obj.x`)**: Traverse `[[Prototype]]` chain. TÃ¬m property á»Ÿ Ä‘Ã¢u thÃ¬ dÃ¹ng á»Ÿ Ä‘Ã³, vá»›i `this` = receiver (original object).
- **WRITE (`obj.x = value`)**: KHÃ”NG BAO GIá»œ traverse chain (ngoáº¡i trá»« 2 exceptions). LuÃ´n táº¡o/update **own property** trÃªn target object.

Hai exceptions Ä‘Ã¡ng sá»£:

**Exception 1 â€” `writable: false` trÃªn chain**: Náº¿u property `x` tá»“n táº¡i trÃªn prototype chain vá»›i `writable: false`, thÃ¬ gÃ¡n `obj.x = value` **THáº¤T Báº I Ã‚MTHáº¦M** (sloppy mode) hoáº·c throw `TypeError` (strict mode). KhÃ´ng táº¡o own property. Behavior nÃ y counter-intuitive vÃ¬ báº¡n Ä‘ang gÃ¡n trÃªn **own object** â€” nhÆ°ng prototype chain "cháº·n" báº¡n láº¡i. Spec rationale: `writable: false` trÃªn prototype = "read-only constraint cho táº¥t cáº£ descendants" â€” Ä‘áº£m báº£o **class invariants** khÃ´ng bá»‹ phÃ¡ vá»¡.

**Exception 2 â€” Setter trÃªn chain**: Náº¿u property `x` trÃªn prototype chain lÃ  **accessor** (cÃ³ setter), gÃ¡n `obj.x = value` sáº½ **gá»i setter** (KHÃ”NG táº¡o own property). Setter cháº¡y vá»›i `this = obj`, nhÆ°ng descriptor váº«n náº±m trÃªn prototype. ÄÃ¢y lÃ  design intentional: setters/getters kiá»ƒm soÃ¡t assignment behavior, cho phÃ©p validation, computation, side effects.

Workaround cho cáº£ hai exceptions: `Object.defineProperty(obj, 'x', { value: 42 })` â€” **LUÃ”N** táº¡o/update own property, bypass chain checks. ÄÃ¢y lÃ  lÃ½ do libraries phá»©c táº¡p (Ember.js, MobX) dÃ¹ng `defineProperty` thay vÃ¬ direct assignment khi cáº§n deterministic behavior.

> **Mental model tá»‘i giáº£n**: Read = "há»i lÃªn trÃªn" (delegation). Write = "ghi táº¡i chá»—" (ownership). Hai exceptions phÃ¡ vá»¡ rule "ghi táº¡i chá»—" â€” vÃ  chÃºng lÃ  nguá»“n gá»‘c cá»§a háº§u háº¿t prototype-related bugs khÃ³ debug nháº¥t.

---

#### Pattern 3: Trade-off Analysis â€” Prototype vs Class vs Composition

**BÃ i viáº¿t â€” Cuá»™c Chiáº¿n Ba Paradigm: Khi NÃ o DÃ¹ng GÃ¬ VÃ  Táº¡i Sao?**

Trade-off analysis lÃ  ká»¹ nÄƒng QUAN TRá»ŒNG NHáº¤T cá»§a senior engineer â€” khÃ´ng pháº£i biáº¿t "cÃ¡i nÃ o tá»‘t nháº¥t" (khÃ´ng cÃ³ "tá»‘t nháº¥t"), mÃ  biáº¿t **"cÃ¡i nÃ o tá»‘t nháº¥t CHO CONTEXT Cá»¤ THá»‚ NÃ€Y"**. Prototype, Class, vÃ  Composition lÃ  ba paradigm thiáº¿t káº¿ object trong JavaScript, má»—i paradigm optimize cho má»¥c tiÃªu khÃ¡c nhau.

**Báº£ng So SÃ¡nh Äa Chiá»u:**

| TiÃªu chÃ­          | Prototype (ES5)            | Class (ES6+)                 | Composition                   |
| ----------------- | -------------------------- | ---------------------------- | ----------------------------- |
| **Syntax**        | Verbose, dá»… sai            | Clean, familiar              | Flexible nhÆ°ng cáº§n pattern    |
| **Inheritance**   | `Object.create()` + manual | `extends` + `super()`        | KhÃ´ng cáº§n inheritance         |
| **Encapsulation** | Closure-based (convention) | `#private` fields            | Module scope                  |
| **Performance**   | Tá»‘t (inline cache)         | Tá»‘t (cÃ¹ng engine)            | Tá»‘t (no chain lookup)         |
| **Debugging**     | KhÃ³ (implicit chain)       | Dá»… (class hierarchy rÃµ rÃ ng) | Dá»… (flat structure)           |
| **Reusability**   | Mixin via `Object.assign`  | Mixin phá»©c táº¡p               | Excellent (compose functions) |
| **Testability**   | Trung bÃ¬nh (shared state)  | Trung bÃ¬nh (mock hierarchy)  | Excellent (pure functions)    |
| **Bundle size**   | Nhá» (no transpile)         | Cáº§n transpile cho IE11       | Nhá» (tree-shakeable)          |
| **Type safety**   | Yáº¿u (dynamic)              | Tá»‘t (TS integration)         | Tá»‘t (function signatures)     |

NhÆ°ng báº£ng nÃ y chá»‰ lÃ  snapshot â€” hÃ£y Ä‘i sÃ¢u vÃ o **WHY** Ä‘áº±ng sau tá»«ng trade-off.

**1. Prototype (ES5) â€” Maximum Flexibility, Maximum Footgun**

Prototype pattern cho phÃ©p báº¡n modify behavior **at runtime** â€” thÃªm/xÃ³a/thay methods trÃªn prototype báº¥t ká»³ lÃºc nÃ o, áº£nh hÆ°á»Ÿng Táº¤T Cáº¢ instances Ä‘Ã£ táº¡o. ÄÃ¢y lÃ  **superpower** cho library authors (polyfills, monkey-patching, dynamic adaptation) nhÆ°ng lÃ  **nightmare** cho application developers (unexpected behavior changes, hard-to-trace bugs, tight coupling).

Real-world example: jQuery sá»­ dá»¥ng `$.fn = jQuery.prototype` Ä‘á»ƒ cho phÃ©p plugins gáº¯n trá»±c tiáº¿p vÃ o prototype. Báº¥t ká»³ ai cÅ©ng cÃ³ thá»ƒ viáº¿t `$.fn.myPlugin = function() {}` â€” elegantly extensible. NhÆ°ng khi hai plugins cÃ¹ng define `$.fn.tooltip` â†’ **silent override** â†’ "which version am I running?" bugs. jQuery ecosystem cÃ³ HÃ€NG TRÄ‚M plugin conflicts chÃ­nh vÃ¬ pattern nÃ y.

Performance angle: khi objects share cÃ¹ng constructor â†’ V8 gÃ¡n chÃºng cÃ¹ng hidden class â†’ inline cache **monomorphic** â†’ property access cá»±c nhanh. NhÆ°ng náº¿u báº¡n modify prototype at runtime (thÃªm/xÃ³a methods), V8 pháº£i **invalidate ALL hidden classes** derived tá»« prototype Ä‘Ã³ â†’ táº¥t cáº£ inline caches liÃªn quan bá»‹ deoptimize â†’ performance cliff. ÄÃ¢y lÃ  lÃ½ do V8 team khuyáº¿n cÃ¡o: "set up prototype once, never modify it."

**2. Class (ES6+) â€” Developer Experience Meets Engine Optimization**

Class syntax khÃ´ng chá»‰ lÃ  syntactic sugar â€” nÃ³ gá»­i **"hints" rÃµ rÃ ng hÆ¡n cho engine**:

- `class` body automatic strict mode â†’ engine biáº¿t cáº§n enforce stricter checks.
- Methods defined trong class declaration automatic **non-enumerable** â†’ `for...in` safe by default.
- `constructor()` explicit â†’ engine biáº¿t chÃ­nh xÃ¡c initialization shape â†’ hidden class á»•n Ä‘á»‹nh hÆ¡n.
- `#private` fields (ES2022) â†’ engine cÃ³ thá»ƒ optimize access vÃ¬ fields guaranteed KHÃ”NG bao giá» bá»‹ truy cáº­p tá»« bÃªn ngoÃ i.

NhÆ°ng class cÃ³ trap lá»›n: **"gorilla-banana problem"** (term tá»« Joe Armstrong, creator of Erlang). Khi báº¡n cáº§n function `serialize()` tá»« class `Entity`, nhÆ°ng `Entity extends Model extends EventEmitter extends Base` â€” báº¡n muá»‘n quáº£ chuá»‘i (`serialize`) nhÆ°ng pháº£i mang theo cáº£ con gorilla (`Entity` + `Model` + `EventEmitter` + `Base`). Deep inheritance hierarchies táº¡o **tight coupling** â€” thay Ä‘á»•i `Base` cÃ³ thá»ƒ break `Entity` theo cÃ¡ch khÃ´ng ai predict Ä‘Æ°á»£c.

React evolution minh chá»©ng rÃµ nháº¥t: React 15 dá»±a 100% vÃ o class components (`class App extends React.Component`). Dan Abramov giáº£i thÃ­ch táº¡i sao React team chuyá»ƒn sang Hooks (composition): "Classes confuse both people and machines." 3 váº¥n Ä‘á» cá»¥ thá»ƒ: (1) `this` binding confusion (`onClick={this.handle}` máº¥t `this`), (2) logic reuse khÃ³ (HOC + render props + wrapper hell), (3) lifecycle methods Ã©p gom unrelated logic vÃ o cÃ¹ng chá»— (`componentDidMount` chá»©a cáº£ data fetching VÃ€ event listener setup).

**3. Composition â€” "Favor Composition Over Inheritance" Thá»±c Sá»± CÃ³ NghÄ©a GÃ¬?**

Gang of Four (GoF) viáº¿t "Favor composition over inheritance" nÄƒm 1994 trong _Design Patterns_. 30 nÄƒm sau, JavaScript ecosystem cuá»‘i cÃ¹ng Ä‘Ã£ embrace nÃ³ â€” nhÆ°ng nhiá»u developer hiá»ƒu sai.

Composition KHÃ”NG CHá»ˆ LÃ€ "khÃ´ng dÃ¹ng class". Composition cÃ³ nghÄ©a: **xÃ¢y dá»±ng complex objects báº±ng cÃ¡ch káº¿t há»£p simple, independent pieces** thay vÃ¬ káº¿ thá»«a tá»« ancestor chain. Má»—i piece (function, module, hook) encapsulate má»™t behavior duy nháº¥t VÃ€ cÃ³ thá»ƒ test/reuse **Ä‘á»™c láº­p**.

Pattern phá»• biáº¿n nháº¥t trong JavaScript: factory functions + closures:

```javascript
// Composition: má»—i behavior = 1 function, combine by calling
const withLogging = (obj) => ({
  ...obj,
  log(msg) {
    console.log(`[${obj.name}] ${msg}`);
  },
});

const withStorage = (obj) => ({
  ...obj,
  save() {
    localStorage.setItem(obj.id, JSON.stringify(obj));
  },
});

// Compose behaviors:
const user = withStorage(
  withLogging({
    id: "1",
    name: "Alice",
    role: "admin",
  }),
);
user.log("created"); // [Alice] created
user.save(); // saves to localStorage
```

KhÃ¡c biá»‡t then chá»‘t vá»›i prototype/class: **khÃ´ng cÃ³ shared mutable state**. Má»—i `withLogging()` call táº¡o fresh object â€” thay Ä‘á»•i 1 user KHÃ”NG áº£nh hÆ°á»Ÿng user khÃ¡c. ÄÃ¢y lÃ  lÃ½ do composition works tá»‘t hÆ¡n cho **concurrent/async** code â€” no race conditions trÃªn shared prototype.

React Hooks chÃ­nh lÃ  composition pattern á»Ÿ component level: `useState()`, `useEffect()`, `useContext()` lÃ  "behavior units" â€” combine chÃºng báº±ng cÃ¡ch gá»i trong component function. Custom hooks (`useAuth()`, `useFetch()`) lÃ  "composed behaviors" â€” reusable across components mÃ  KHÃ”NG cáº§n inheritance hierarchy.

Vue 3 Composition API cÅ©ng follow exact same philosophy: chuyá»ƒn tá»« Options API (OOP-style, tá»• chá»©c theo `data`, `methods`, `computed` â€” tÆ°Æ¡ng tá»± class fields) sang Composition API (organize by **logical concern**, má»—i concern = 1 composable function).

**4. Decision Matrix â€” Khi NÃ o DÃ¹ng GÃ¬?**

**DÃ¹ng Class (ES6+) khi:**

- Entity modeling rÃµ rÃ ng: `User`, `Order`, `Product` â€” clear "is-a" relationship
- Cáº§n `#private` fields cho encapsulation
- Team Ä‘áº¿n tá»« Java/C#/TypeScript background
- Hierarchy shallow (max 2-3 levels)
- Framework yÃªu cáº§u: Angular, NestJS, TypeORM

**DÃ¹ng Prototype trá»±c tiáº¿p khi:**

- Library/framework internals cáº§n dynamic extension
- Polyfills (add missing methods to built-in prototypes)
- Metaprogramming: dynamic method generation, proxy patterns
- Performance-critical: cáº§n explicit control over hidden class behavior
- Khi `class` syntax quÃ¡ restrictive (cáº§n bypass `new` keyword, etc.)

**DÃ¹ng Composition khi:**

- Behavior sharing ("has-a") thay vÃ¬ identity sharing ("is-a")
- Multiple independent behaviors cáº§n combine: serializable + observable + cacheable
- Functional programming style: pure functions, immutability
- React Hooks pattern, Vue Composition API
- Test-driven development: composition = easy to mock/stub individual behaviors
- Entity cÃ³ behaviors thay Ä‘á»•i at runtime: "role-based" features, feature flags

**Trade-off cá»‘t lÃµi:**

- Prototype/Class: **Share behavior qua chain** â†’ tiáº¿t kiá»‡m memory, nhÆ°ng coupling cao (thay Ä‘á»•i prototype áº£nh hÆ°á»Ÿng táº¥t cáº£ instances). Best for **stable, well-defined hierarchies**.
- Composition: **Copy behavior qua functions** â†’ isolation tá»‘t, nhÆ°ng má»—i instance cÃ³ báº£n copy riÃªng (memory trade-off nhá» vÃ¬ function objects lightweight). Best for **evolving, complex systems**.

> **Senior engineer takeaway**: Äá»«ng dogmatic "always composition" hay "always class". Codebase thá»±c táº¿ thÆ°á»ng MIX cáº£ ba. Angular app dÃ¹ng class cho services + composition cho RxJS pipes. React app dÃ¹ng hooks (composition) nhÆ°ng Error Boundaries pháº£i dÃ¹ng class. Node.js streams dÃ¹ng prototype inheritance nhÆ°ng middleware dÃ¹ng composition. **Context determines choice** â€” vÃ  kháº£ nÄƒng chá»n Ä‘Ãºng cho context = dáº¥u hiá»‡u cá»§a seniority.

---

#### Pattern 4: Mental Mapping â€” Prototype Trong ToÃ n Bá»™ Ecosystem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   JAVASCRIPT RUNTIME LAYER                    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Application Layer (React, Angular, Vue)                 â”‚  â”‚
â”‚  â”‚  â€¢ React: class Component â€” uses prototype + ES6 class   â”‚  â”‚
â”‚  â”‚  â€¢ React Hooks: replaces class â†’ composition pattern     â”‚  â”‚
â”‚  â”‚  â€¢ Angular: decorators + class â†’ prototype under hood    â”‚  â”‚
â”‚  â”‚  â€¢ Vue 2: Vue.prototype.$http â†’ shared plugins           â”‚  â”‚
â”‚  â”‚  â€¢ Vue 3: app.config.globalProperties (not prototype)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Language Layer (ECMAScript Spec)                        â”‚  â”‚
â”‚  â”‚  â€¢ [[Prototype]] internal slot trÃªn má»i object           â”‚  â”‚
â”‚  â”‚  â€¢ OrdinaryGet / OrdinarySet / OrdinaryHasProperty       â”‚  â”‚
â”‚  â”‚  â€¢ class = syntactic sugar â†’ prototype + constructor     â”‚  â”‚
â”‚  â”‚  â€¢ extends = Object.setPrototypeOf(Child.proto, Parent)  â”‚  â”‚
â”‚  â”‚  â€¢ super = explicit delegate call lÃªn prototype          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Engine Layer (V8 / SpiderMonkey / JSC)                  â”‚  â”‚
â”‚  â”‚  â€¢ Hidden Classes (Maps/Shapes) track property layout    â”‚  â”‚
â”‚  â”‚  â€¢ Inline Caches: "last time this.x was at offset 16"   â”‚  â”‚
â”‚  â”‚  â€¢ Prototype chain flattened trong IC sau nhiá»u láº§n gá»i  â”‚  â”‚
â”‚  â”‚  â€¢ Megamorphic fallback khi too many shapes              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                           â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Memory Layer (Heap)                                     â”‚  â”‚
â”‚  â”‚  â€¢ Object = {hidden_class_ptr, property_values[]}        â”‚  â”‚
â”‚  â”‚  â€¢ Prototype = shared object, ref-counted by instances   â”‚  â”‚
â”‚  â”‚  â€¢ GC traces prototype refs â†’ keeps prototype alive      â”‚  â”‚
â”‚  â”‚  â€¢ 1000 instances = 1 prototype object (memory efficient) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**LiÃªn há»‡ thá»±c táº¿:**

- **Node.js**: `require('stream').Readable.prototype` â†’ má»i readable stream share methods
- **DOM**: `HTMLElement.prototype â†’ Element.prototype â†’ Node.prototype â†’ EventTarget.prototype â†’ Object.prototype`
- **jQuery**: `$.fn = jQuery.prototype` â†’ táº¥t cáº£ `$()` objects share jQuery methods
- **Lodash**: `_.prototype` â†’ chain methods cho `_(array).map().filter().value()`

---

#### Pattern 5: Reverse Engineering â€” Tá»± Build Object.create() vÃ  instanceof

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Custom Object.create â€” hiá»ƒu báº£n cháº¥t prototype setup
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myObjectCreate(proto, propertiesObject) {
  // BÆ°á»›c 1: Validate â€” proto pháº£i lÃ  object hoáº·c null
  if (typeof proto !== "object" && typeof proto !== "function") {
    throw new TypeError("Object prototype may only be an Object or null");
  }

  // BÆ°á»›c 2: Táº¡o constructor táº¡m
  function TempConstructor() {}

  // BÆ°á»›c 3: GÃ¡n proto lÃ m prototype cho constructor táº¡m
  if (proto === null) {
    // Object.create(null) â†’ object khÃ´ng cÃ³ prototype
    TempConstructor.prototype = Object.create ? Object.create(null) : {}; // fallback
  } else {
    TempConstructor.prototype = proto;
  }

  // BÆ°á»›c 4: Táº¡o instance â†’ __proto__ trá» Ä‘áº¿n proto
  const obj = new TempConstructor();

  // BÆ°á»›c 5: Handle proto === null Ä‘áº·c biá»‡t
  if (proto === null) {
    // XÃ³a __proto__ link hoÃ n toÃ n
    // Trong polyfill thá»±c táº¿, Ä‘Ã¢y lÃ  implementation-dependent
    obj.__proto__ = null;
  }

  // BÆ°á»›c 6: Define additional properties náº¿u cÃ³
  if (propertiesObject !== undefined) {
    Object.defineProperties(obj, propertiesObject);
  }

  return obj;
}

// Test:
const parent = {
  greet() {
    return "Hello";
  },
};
const child = myObjectCreate(parent);
console.log(child.greet()); // "Hello"    âœ…
console.log(child.__proto__ === parent); // true      âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Custom instanceof â€” hiá»ƒu cÃ¡ch engine check chain
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myInstanceOf(instance, Constructor) {
  // BÆ°á»›c 1: Validate â€” Constructor pháº£i lÃ  function
  if (typeof Constructor !== "function") {
    throw new TypeError("Right-hand side of instanceof is not callable");
  }

  // BÆ°á»›c 2: Check Symbol.hasInstance náº¿u cÃ³ (ES6+)
  if (Constructor[Symbol.hasInstance]) {
    return !!Constructor[Symbol.hasInstance](instance);
  }

  // BÆ°á»›c 3: Primitive â†’ always false
  if (
    instance === null ||
    (typeof instance !== "object" && typeof instance !== "function")
  ) {
    return false;
  }

  // BÆ°á»›c 4: Láº¥y prototype target
  const prototype = Constructor.prototype;
  if (typeof prototype !== "object" && typeof prototype !== "function") {
    throw new TypeError("Function has non-object prototype");
  }

  // BÆ°á»›c 5: Duyá»‡t prototype chain
  let current = Object.getPrototypeOf(instance);
  while (current !== null) {
    if (current === prototype) {
      return true; // TÃ¬m tháº¥y trong chain!
    }
    current = Object.getPrototypeOf(current);
  }

  return false; // Duyá»‡t háº¿t chain, khÃ´ng tÃ¬m tháº¥y
}

// Test:
function Animal(name) {
  this.name = name;
}
function Dog(name) {
  Animal.call(this, name);
}
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.constructor = Dog;

const rex = new Dog("Rex");
console.log(myInstanceOf(rex, Dog)); // true  âœ…
console.log(myInstanceOf(rex, Animal)); // true  âœ…
console.log(myInstanceOf(rex, Array)); // false âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Custom Object.getPrototypeOf â€” unwrap [[Prototype]]
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myGetPrototypeOf(obj) {
  if (obj === null || obj === undefined) {
    throw new TypeError("Cannot convert undefined or null to object");
  }

  // Non-object â†’ coerce to wrapper object
  const O = Object(obj);

  // __proto__ accessor (non-standard nhÆ°ng widely supported)
  if (O.__proto__ !== undefined) {
    return O.__proto__;
  }

  // Fallback: check constructor.prototype
  if (typeof O.constructor === "function") {
    return O.constructor.prototype;
  }

  // Last resort: Object.prototype
  return Object.prototype;
}
```

**BÃ i há»c tá»« Reverse Engineering:**

1. `Object.create()` báº£n cháº¥t chá»‰ lÃ : táº¡o empty object + set `[[Prototype]]` link
2. `instanceof` báº£n cháº¥t chá»‰ lÃ : duyá»‡t `__proto__` chain tÃ¬m `Constructor.prototype`
3. Cáº£ hai Ä‘á»u dá»±a trÃªn **cÃ¹ng má»™t mechanism** â€” prototype chain traversal

---

#### Pattern 6: Contextual History â€” Prototype Qua CÃ¡c Thá»i Ká»³

**1995 â€” Birth (Brendan Eich / Netscape):**
JavaScript Ä‘Æ°á»£c táº¡o trong 10 ngÃ y, láº¥y cáº£m há»©ng tá»« **Self** (prototype-based) vÃ  **Scheme** (first-class functions). KhÃ´ng cÃ³ `class` keyword. Object káº¿ thá»«a qua `__proto__` (non-standard, nhÆ°ng má»i browser implement).

```javascript
// 1995 style â€” constructor function + prototype
function Dog(name) {
  this.name = name;
}
Dog.prototype.bark = function () {
  return "Woof!";
};
```

**1999 â€” ES3 Standardization:**
ECMAScript 3 formalize prototype chain nhÆ°ng KHÃ”NG standardize `__proto__`. `Object.prototype` Ä‘Æ°á»£c define rÃµ rÃ ng. `for...in` duyá»‡t cáº£ inherited properties â†’ source of bugs.

```javascript
// Cáº§n guard trong for...in
for (var key in obj) {
  if (obj.hasOwnProperty(key)) {
    /* safe */
  }
}
```

**2009 â€” ES5 (The Big Cleanup):**

- `Object.create(proto)` â€” táº¡o object vá»›i prototype chá»‰ Ä‘á»‹nh (thay vÃ¬ hack qua constructor)
- `Object.getPrototypeOf()` â€” standard access thay vÃ¬ `__proto__`
- `Object.defineProperty()` â€” control property descriptors (writable, enumerable, configurable)
- `Object.keys()` â€” chá»‰ own enumerable (fix for...in trap)

```javascript
// ES5 clean inheritance
var parent = {
  greet: function () {
    return "Hi";
  },
};
var child = Object.create(parent);
child.name = "Alice";
```

**2015 â€” ES6 (The Class Revolution):**

- `class` keyword â€” syntactic sugar cho prototype + constructor
- `extends` + `super()` â€” clean inheritance syntax
- `Symbol` â€” property keys khÃ´ng conflict vá»›i prototype
- `class` methods máº·c Ä‘á»‹nh **non-enumerable** (fix for...in issue)

```javascript
class Animal {
  constructor(name) {
    this.name = name;
  }
  speak() {
    return `${this.name} speaks`;
  }
}
class Dog extends Animal {
  bark() {
    return "Woof!";
  }
}
```

**2020â€“2022 â€” Modern (ES2020+):**

- `#private` fields â€” true encapsulation (khÃ´ng qua prototype)
- `Object.hasOwn()` â€” safe replacement cho `hasOwnProperty()`
- Static class blocks â€” initialization logic trong class definition
- Decorators (Stage 3) â€” metaprogramming cho class methods

**Xu hÆ°á»›ng hiá»‡n táº¡i:** JavaScript community Ä‘ang dá»‹ch chuyá»ƒn tá»« **class inheritance** sang **composition** (React Hooks, functional patterns). Prototype váº«n lÃ  foundation cá»§a language, nhÆ°ng API design hiá»‡n Ä‘áº¡i Æ°u tiÃªn composition over inheritance.

---

## 14. new Operator â€” CÆ¡ Cháº¿ Hoáº¡t Äá»™ng

### Tá»•ng Quan: new LÃ m GÃ¬?

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Trong JavaScript, tá»« khÃ³a `new` lÃ  cáº§u ná»‘i giá»¯a hai tháº¿ giá»›i: **functional programming** vÃ  **object-oriented programming**. TrÆ°á»›c ES6, JavaScript khÃ´ng cÃ³ keyword `class` â€” vÃ  ngay cáº£ bÃ¢y giá», `class` chá»‰ lÃ  syntactic sugar. Má»i thá»© váº«n Ä‘i qua `new`. Hiá»ƒu rÃµ cÆ¡ cháº¿ bÃªn trong cá»§a `new` khÃ´ng chá»‰ giÃºp báº¡n vÆ°á»£t qua cÃ¢u há»i phá»ng váº¥n, mÃ  cÃ²n giÃºp báº¡n náº¯m Ä‘Æ°á»£c báº£n cháº¥t sÃ¢u nháº¥t cá»§a há»‡ thá»‘ng object creation trong JavaScript.

**Bá»‘i cáº£nh lá»‹ch sá»­ â€” Táº¡i sao `new` tá»“n táº¡i?**

NÄƒm 1995, khi Brendan Eich thiáº¿t káº¿ JavaScript trong 10 ngÃ y, Ã´ng Ä‘á»©ng trÆ°á»›c má»™t quyáº¿t Ä‘á»‹nh then chá»‘t: JavaScript láº¥y cáº£m há»©ng tá»« **Self** (prototype-based, khÃ´ng cÃ³ `class`), nhÆ°ng Netscape yÃªu cáº§u ngÃ´n ngá»¯ pháº£i "trÃ´ng giá»‘ng Java" Ä‘á»ƒ dá»… marketing. Káº¿t quáº£: `new` keyword Ä‘Æ°á»£c thÃªm vÃ o JavaScript Ä‘á»ƒ _mÃ´ phá»ng_ syntax cá»§a Java, dÃ¹ bÃªn dÆ°á»›i nÃ³ hoáº¡t Ä‘á»™ng hoÃ n toÃ n khÃ¡c. Trong Java, `new` allocate memory trÃªn heap, gá»i constructor, vÃ  tráº£ vá» reference â€” cáº£ ba bÆ°á»›c Ä‘á»u liÃªn quan Ä‘áº¿n há»‡ thá»‘ng type system tÄ©nh. Trong JavaScript, `new` thá»±c hiá»‡n má»™t chuá»—i thao tÃ¡c dynamic hoÃ n toÃ n khÃ¡c, gáº¯n liá»n vá»›i prototype chain thay vÃ¬ class hierarchy. ÄÃ¢y lÃ  má»™t trong nhá»¯ng "identity crisis" lá»›n nháº¥t cá»§a JavaScript: syntax nÃ³i "tÃ´i lÃ  class-based", nhÆ°ng semantics nÃ³i "tÃ´i lÃ  prototype-based."

Douglas Crockford â€” tÃ¡c giáº£ cuá»‘n _JavaScript: The Good Parts_ â€” tá»«ng gá»i `new` lÃ  má»™t pháº§n "xáº¥u" cá»§a JavaScript, khuyÃªn developer dÃ¹ng factory functions thay tháº¿. NhÆ°ng thá»±c táº¿, `new` váº«n tá»“n táº¡i máº¡nh máº½ vÃ¬ nÃ³ cung cáº¥p hai thá»© mÃ  factory functions khÃ´ng dá»… dÃ ng thay tháº¿: **(1)** tá»± Ä‘á»™ng káº¿t ná»‘i instance vÃ o prototype chain (cho phÃ©p `instanceof` hoáº¡t Ä‘á»™ng), vÃ  **(2)** convention rÃµ rÃ ng ráº±ng function nÃ y lÃ  constructor (PascalCase naming). Trong codebase lá»›n, hai lá»£i Ã­ch nÃ y vÆ°á»£t xa báº¥t ká»³ sá»± "xáº¥u" nÃ o.

**Váº¥n Ä‘á» mÃ  `new` giáº£i quyáº¿t:**

HÃ£y tÆ°á»Ÿng tÆ°á»£ng báº¡n viáº¿t JavaScript mÃ  khÃ´ng cÃ³ `new`. Báº¡n sáº½ pháº£i tá»± tay thá»±c hiá»‡n má»i bÆ°á»›c: táº¡o object rá»—ng, gÃ¡n prototype, bind `this`, xá»­ lÃ½ return value. ÄÃ¢y chÃ­nh xÃ¡c lÃ  nhá»¯ng gÃ¬ cÃ¡c developer pháº£i lÃ m trong thá»i ká»³ Ä‘áº§u cá»§a JavaScript, vÃ  Ä‘Ã³ cÅ©ng lÃ  lÃ½ do táº¡i sao `new` Ä‘Æ°á»£c thiáº¿t káº¿ â€” nÃ³ **Ä‘Ã³ng gÃ³i** (encapsulate) toÃ n bá»™ quy trÃ¬nh táº¡o object vÃ o má»™t keyword duy nháº¥t.

HÃ£y so sÃ¡nh ba cÃ¡ch táº¡o object:

- **Literal**: `const obj = { name: "Alice" }` â€” Ä‘Æ¡n giáº£n nháº¥t, nhÆ°ng khÃ´ng cÃ³ constructor logic, khÃ´ng káº¿t ná»‘i vÃ o prototype chain tÃ¹y chá»‰nh, vÃ  khÃ´ng thá»ƒ tÃ¡i sá»­ dá»¥ng.
- **Factory function**: `function createUser(name) { return { name } }` â€” tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c, nhÆ°ng má»—i instance táº¡o methods má»›i (tá»‘n memory), `instanceof` khÃ´ng hoáº¡t Ä‘á»™ng, khÃ´ng cÃ³ prototype sharing.
- **Constructor + `new`**: `function User(name) { this.name = name }; new User("Alice")` â€” tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c, methods chia sáº» qua prototype (tiáº¿t kiá»‡m memory), `instanceof` hoáº¡t Ä‘á»™ng, engine cÃ³ thá»ƒ tá»‘i Æ°u Hidden Classes.

`new` báº£n cháº¥t lÃ  "syntactic sugar" cho má»™t pattern mÃ  developer láº·p Ä‘i láº·p láº¡i hÃ ng ngÃ n láº§n. Thay vÃ¬ viáº¿t 4 dÃ²ng code (táº¡o object, set prototype, call function, check return), báº¡n viáº¿t 1 dÃ²ng: `new Constructor(args)`.

**`[[Call]]` vs `[[Construct]]` â€” Hai khuÃ´n máº·t cá»§a function:**

á» má»©c specification, má»—i function object trong JavaScript cÃ³ thá»ƒ cÃ³ tá»‘i Ä‘a hai internal methods: `[[Call]]` vÃ  `[[Construct]]`. Khi báº¡n gá»i `fn()`, engine gá»i `[[Call]]`. Khi báº¡n gá»i `new fn()`, engine gá»i `[[Construct]]`. Hai methods nÃ y **Ä‘á»™c láº­p** â€” cÃ¹ng má»™t function body, nhÆ°ng hÃ nh vi hoÃ n toÃ n khÃ¡c:

| Aspect         | `[[Call]]` (`fn()`)           | `[[Construct]]` (`new fn()`)       |
| -------------- | ----------------------------- | ---------------------------------- |
| `this`         | Global / `undefined` (strict) | Object má»›i Ä‘Æ°á»£c táº¡o                |
| Return         | GiÃ¡ trá»‹ return                | Object má»›i (trá»« khi return object) |
| `new.target`   | `undefined`                   | Reference Ä‘áº¿n constructor          |
| Prototype link | KhÃ´ng                         | `obj.__proto__ = fn.prototype`     |

KhÃ´ng pháº£i má»i function Ä‘á»u cÃ³ `[[Construct]]`:

- **Regular functions** (`function` declarations/expressions): CÃ³ cáº£ `[[Call]]` vÃ  `[[Construct]]`.
- **Arrow functions**: CHá»ˆ cÃ³ `[[Call]]`. KhÃ´ng cÃ³ `[[Construct]]` â†’ `new` sáº½ throw `TypeError`.
- **Method shorthand** (`{ method() {} }`): CHá»ˆ cÃ³ `[[Call]]` (tá»« ES6). KhÃ´ng thá»ƒ dÃ¹ng vá»›i `new`.
- **Generator functions**: CÃ³ `[[Call]]` nhÆ°ng KHÃ”NG cÃ³ `[[Construct]]`.
- **Async functions**: CÃ³ `[[Call]]` nhÆ°ng KHÃ”NG cÃ³ `[[Construct]]` (tá»« ES2017).
- **ES6 `class`**: CHá»ˆ cÃ³ `[[Construct]]`. Gá»i bÃ¬nh thÆ°á»ng `Class()` sáº½ throw `TypeError`.

ÄÃ¢y lÃ  má»™t trong nhá»¯ng asymmetry thÃº vá»‹ nháº¥t: regular functions "Ä‘a nÄƒng" quÃ¡ má»©c â€” chÃºng vá»«a lÃ  function bÃ¬nh thÆ°á»ng, vá»«a lÃ  constructor, vá»«a cÃ³ thá»ƒ lÃ  method. ES6 giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch táº¡o cÃ¡c dáº¡ng function chuyÃªn biá»‡t: arrow functions cho callbacks, method shorthand cho methods, vÃ  `class` cho constructors. Má»—i dáº¡ng chá»‰ cÃ³ internal methods phÃ¹ há»£p vá»›i má»¥c Ä‘Ã­ch thiáº¿t káº¿.

**Bá»‘n bÆ°á»›c "ma thuáº­t":**

Khi báº¡n viáº¿t `const obj = new Constructor(args)`, JavaScript engine thá»±c hiá»‡n chÃ­nh xÃ¡c 4 bÆ°á»›c â€” khÃ´ng hÆ¡n, khÃ´ng kÃ©m. ÄÃ¢y lÃ  thuáº­t toÃ¡n `[[Construct]]` Ä‘Æ°á»£c quy Ä‘á»‹nh trong ECMAScript specification (Section 9.2.2). Äiá»u Ä‘áº·c biá»‡t lÃ  má»—i bÆ°á»›c Ä‘á»u liÃªn quan máº­t thiáº¿t Ä‘áº¿n má»™t concept khÃ¡c trong JavaScript: Step 1 liÃªn quan Ä‘áº¿n **object creation** (memory allocation trÃªn heap), Step 2 liÃªn quan Ä‘áº¿n **prototype chain** (Section 13), Step 3 liÃªn quan Ä‘áº¿n **this binding** (Section 7), vÃ  Step 4 liÃªn quan Ä‘áº¿n **type checking** (reference type vs value type). NÃ³i cÃ¡ch khÃ¡c, `new` lÃ  Ä‘iá»ƒm giao nhau cá»§a nhiá»u concept cá»‘t lÃµi â€” vÃ  Ä‘Ã¢y lÃ  lÃ½ do nÃ³ xuáº¥t hiá»‡n liÃªn tá»¥c trong phá»ng váº¥n: chá»‰ cáº§n há»i "giáº£i thÃ­ch `new`", interviewer cÃ³ thá»ƒ Ä‘Ã¡nh giÃ¡ kiáº¿n thá»©c cá»§a báº¡n vá» prototype, `this`, memory, vÃ  type system cÃ¹ng lÃºc.

**`new` trong má»‘i quan há»‡ vá»›i Constructor Function:**

Má»™t hÃ m (function) trong JavaScript cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i theo hai cÃ¡ch: **gá»i bÃ¬nh thÆ°á»ng** (`fn()`) hoáº·c **gá»i vá»›i `new`** (`new fn()`). Tá»« cÃ¹ng má»™t function definition, hai cÃ¡ch gá»i nÃ y táº¡o ra hai hÃ nh vi hoÃ n toÃ n khÃ¡c nhau. Khi gá»i bÃ¬nh thÆ°á»ng, `this` trá» Ä‘áº¿n global object (hoáº·c `undefined` trong strict mode). Khi gá»i vá»›i `new`, `this` trá» Ä‘áº¿n má»™t object hoÃ n toÃ n má»›i. ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t mang tÃ­nh **life-or-death** trong code â€” gá»i nháº§m cÃ¡ch cÃ³ thá»ƒ gÃ¢y bug nghiÃªm trá»ng, Ä‘áº·c biá»‡t lÃ  "pollution" vÃ o global scope.

Váº¥n Ä‘á» "quÃªn `new`" Ä‘Ã£ nghiÃªm trá»ng Ä‘áº¿n má»©c ES6 `class` syntax **báº¯t buá»™c** pháº£i gá»i vá»›i `new` â€” náº¿u báº¡n viáº¿t `MyClass()` thay vÃ¬ `new MyClass()`, JavaScript tá»± Ä‘á»™ng throw `TypeError`. ÄÃ¢y lÃ  má»™t trong nhá»¯ng cáº£i tiáº¿n DX (Developer Experience) quan trá»ng nháº¥t cá»§a ES6, loáº¡i bá» hoÃ n toÃ n má»™t lá»›p bug Ä‘Ã£ tá»“n táº¡i hÆ¡n 20 nÄƒm.

**Mental model â€” "new" nhÆ° má»™t nhÃ  mÃ¡y tá»± Ä‘á»™ng:**

TÆ°á»Ÿng tÆ°á»£ng `new` nhÆ° má»™t dÃ¢y chuyá»n sáº£n xuáº¥t trong nhÃ  mÃ¡y. BÆ°á»›c 1: nguyÃªn liá»‡u thÃ´ Ä‘Æ°á»£c Ä‘Æ°a vÃ o (object rá»—ng `{}`). BÆ°á»›c 2: object Ä‘Æ°á»£c "dÃ¡n nhÃ£n xuáº¥t xá»©" (prototype link â†’ biáº¿t mÃ¬nh thuá»™c "dÃ²ng" nÃ o). BÆ°á»›c 3: object Ä‘i qua khÃ¢u "láº¯p rÃ¡p" (constructor function gÃ¡n properties). BÆ°á»›c 4: kiá»ƒm tra cháº¥t lÆ°á»£ng cuá»‘i cÃ¹ng â€” náº¿u constructor tráº£ vá» sáº£n pháº©m khÃ¡c (return object), dÃ¹ng sáº£n pháº©m Ä‘Ã³; náº¿u khÃ´ng, dÃ¹ng sáº£n pháº©m ban Ä‘áº§u. Factory function giá»‘ng nhÆ° lÃ m thá»§ cÃ´ng â€” báº¡n pháº£i tá»± thá»±c hiá»‡n tá»«ng bÆ°á»›c. `new` lÃ  dÃ¢y chuyá»n tá»± Ä‘á»™ng â€” engine lÃ m háº¿t cho báº¡n.

**Thuáº­t ngá»¯ quan trá»ng:**

- **Constructor function**: Báº¥t ká»³ function nÃ o Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ gá»i vá»›i `new`. Theo convention, tÃªn function báº¯t Ä‘áº§u báº±ng chá»¯ hoa (PascalCase). Convention nÃ y khÃ´ng pháº£i syntax requirement â€” engine khÃ´ng Ã©p buá»™c â€” nhÆ°ng nÃ³ lÃ  **social contract** quan trá»ng nháº¥t trong JavaScript community.
- **`[[Construct]]` internal method**: PhÆ°Æ¡ng thá»©c ná»™i bá»™ mÃ  engine thá»±c thi khi má»™t function Ä‘Æ°á»£c gá»i vá»›i `new`. KhÃ´ng pháº£i má»i function Ä‘á»u cÃ³ method nÃ y â€” arrow functions, generators, async functions, vÃ  method shorthand khÃ´ng cÃ³ `[[Construct]]`. Trong V8 source code, `[[Construct]]` map Ä‘áº¿n function `Builtin_JSConstructStubGeneric`.
- **`new.target`**: Meta-property (ES6) cho phÃ©p function biáº¿t nÃ³ cÃ³ Ä‘ang Ä‘Æ°á»£c gá»i vá»›i `new` hay khÃ´ng. Trong regular call, `new.target` lÃ  `undefined`. Trong `new` call, `new.target` lÃ  reference Ä‘áº¿n constructor function. Trong inheritance chain, `new.target` chá»‰ Ä‘áº¿n **derived constructor** (constructor thá»±c sá»± Ä‘Æ°á»£c gá»i vá»›i `new`), khÃ´ng pháº£i base constructor â€” Ä‘iá»u nÃ y quan trá»ng cho pattern Abstract Base Class trong ES6.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  new OPERATOR â€” 4 BÆ¯á»šC THá»°C HIá»†N                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  const obj = new Constructor(args);                              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  STEP 1: Táº¡o object rá»—ng {}                                â”‚ â”‚
â”‚  â”‚          const obj = {};                                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  STEP 2: GÃ¡n prototype                                     â”‚ â”‚
â”‚  â”‚          obj.__proto__ = Constructor.prototype              â”‚ â”‚
â”‚  â”‚          (liÃªn káº¿t vÃ o prototype chain)                     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  STEP 3: Bind this + thá»±c thi constructor                   â”‚ â”‚
â”‚  â”‚          Constructor.call(obj, args)                        â”‚ â”‚
â”‚  â”‚          (this = obj má»›i, cháº¡y code trong constructor)     â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  STEP 4: Kiá»ƒm tra return                                   â”‚ â”‚
â”‚  â”‚          Return object?  â†’ dÃ¹ng object Ä‘Ã³ (override)       â”‚ â”‚
â”‚  â”‚          Return primitive / nothing? â†’ dÃ¹ng obj (step 1)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  [[Call]] vs [[Construct]]                                  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  fn()     â†’ engine gá»i [[Call]]                             â”‚ â”‚
â”‚  â”‚             this = global/undefined                         â”‚ â”‚
â”‚  â”‚             new.target = undefined                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  new fn() â†’ engine gá»i [[Construct]]                        â”‚ â”‚
â”‚  â”‚             this = {} (object má»›i)                          â”‚ â”‚
â”‚  â”‚             new.target = fn                                 â”‚ â”‚
â”‚  â”‚             __proto__ = fn.prototype                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4 BÆ°á»›c Chi Tiáº¿t

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

HÃ£y Ä‘i sÃ¢u vÃ o tá»«ng bÆ°á»›c cá»§a thuáº­t toÃ¡n `[[Construct]]` Ä‘á»ƒ hiá»ƒu chÃ­nh xÃ¡c Ä‘iá»u gÃ¬ xáº£y ra bÃªn trong engine khi báº¡n viáº¿t `new`. Bá»‘n bÆ°á»›c nÃ y Ä‘Æ°á»£c ECMAScript specification mÃ´ táº£ trong Section 10.2.2 ("[[Construct]]") vÃ  Section 10.2.1.1 ("OrdinaryCallEvaluateBody"), nhÆ°ng spec viáº¿t báº±ng ngÃ´n ngá»¯ ráº¥t trá»«u tÆ°á»£ng. DÆ°á»›i Ä‘Ã¢y lÃ  báº£n "dá»‹ch" sang ngÃ´n ngá»¯ thá»±c táº¿, káº¿t há»£p vá»›i hiá»ƒu biáº¿t vá» V8 internals.

**TrÆ°á»›c khi Ä‘i vÃ o tá»«ng bÆ°á»›c â€” OrdinaryCreateFromConstructor:**

Trong spec, trÆ°á»›c cáº£ Step 1, cÃ³ má»™t internal operation gá»i lÃ  **OrdinaryCreateFromConstructor(constructor, intrinsicDefaultProto)**. Operation nÃ y sáº½:

1. Láº¥y `prototype` property tá»« constructor function.
2. Náº¿u `prototype` khÃ´ng pháº£i object (vÃ­ dá»¥: ai Ä‘Ã³ Ä‘Ã£ ghi Ä‘Ã¨ `Constructor.prototype = 42`), fallback vá» `%Object.prototype%` â€” tá»©c `Object.prototype`.
3. Táº¡o object má»›i vá»›i `[[Prototype]]` trá» Ä‘áº¿n prototype vá»«a láº¥y.

Äiá»u nÃ y cÃ³ nghÄ©a lÃ  **Step 1 vÃ  Step 2 thá»±c táº¿ xáº£y ra "Ä‘á»“ng thá»i"** trong spec â€” engine táº¡o object Ä‘Ã£ cÃ³ prototype link ngay tá»« Ä‘áº§u, khÃ´ng pháº£i táº¡o rá»—ng rá»“i má»›i gÃ¡n prototype. Tuy nhiÃªn, Ä‘á»ƒ dá»… hiá»ƒu, chÃºng ta váº«n tÃ¡ch thÃ nh 4 bÆ°á»›c rá»i ráº¡c.

**Step 1: Táº¡o object rá»—ng â€” "BÆ°á»›c khai sinh"**

BÆ°á»›c Ä‘áº§u tiÃªn _vá» máº·t khÃ¡i niá»‡m_ Ä‘Æ¡n giáº£n: engine táº¡o má»™t plain object rá»—ng `{}`. NhÆ°ng bÃªn trong V8, Ä‘iá»u nÃ y bao gá»“m má»™t chuá»—i operations phá»©c táº¡p:

1. **Memory allocation trÃªn heap**: V8 sá»­ dá»¥ng GC-managed heap. Object má»›i Ä‘Æ°á»£c allocate trong "Young Generation" (new space) â€” vÃ¹ng nhá»› nhá» (~1-8MB) Ä‘Æ°á»£c garbage collect thÆ°á»ng xuyÃªn báº±ng Scavenge algorithm. ÄÃ¢y lÃ  lÃ½ do táº¡o nhiá»u short-lived objects ráº» vá» máº·t allocation nhÆ°ng tá»‘n GC pressure.

2. **Hidden Class (Map/Shape) initialization**: Ngay táº¡i bÆ°á»›c táº¡o object, V8 gÃ¡n cho nÃ³ má»™t Hidden Class (internal name: "Map" trong V8, "Shape" trong SpiderMonkey). Hidden Class ban Ä‘áº§u lÃ  "empty" â€” mÃ´ táº£ má»™t object khÃ´ng cÃ³ properties nÃ o. Má»—i láº§n constructor gÃ¡n `this.prop = value` (á»Ÿ Step 3), V8 sáº½ **transition** sang má»™t Hidden Class má»›i mÃ´ táº£ layout má»›i. ÄÃ¢y lÃ  cÆ¡ cháº¿ V8 "theo dÃµi" cáº¥u trÃºc object.

3. **Internal slots setup**: NgoÃ i properties visible cho JavaScript, object cÃ³ cÃ¡c internal slots: `[[Prototype]]` (sáº½ set á»Ÿ Step 2), `[[Extensible]]` (máº·c Ä‘á»‹nh `true`), vÃ  vá»›i ES6 class, cÃ³ thá»ƒ cÃ³ `[[PrivateFields]]` map.

Äiá»u Ä‘áº·c biá»‡t: V8 **tá»‘i Æ°u bÆ°á»›c nÃ y cho constructors quen thuá»™c**. Náº¿u V8 Ä‘Ã£ tháº¥y `new Person("Alice", 25)` nhiá»u láº§n, nÃ³ sáº½ "dá»± Ä‘oÃ¡n" Hidden Class cuá»‘i cÃ¹ng (sau khi constructor cháº¡y xong) ngay táº¡i bÆ°á»›c táº¡o object â€” **pre-allocating** property slots thay vÃ¬ resize dáº§n dáº§n. Optimization nÃ y gá»i lÃ  **initial map** caching vÃ  lÃ  lÃ½ do constructors vá»›i cÃ¹ng property layout táº¡o objects nhanh hÆ¡n Ä‘Ã¡ng ká»ƒ so vá»›i factory functions.

**Step 2: GÃ¡n prototype â€” "Thiáº¿t láº­p dÃ²ng dÃµi"**

ÄÃ¢y lÃ  bÆ°á»›c mÃ  `new` káº¿t ná»‘i object má»›i vÃ o prototype chain. BÃªn trong spec, Ä‘iá»u nÃ y xáº£y ra trong `OrdinaryCreateFromConstructor`: engine thá»±c hiá»‡n `obj.[[Prototype]] = Constructor.prototype` (internal slot assignment, khÃ´ng pháº£i property assignment).

**Chi tiáº¿t spec-level:**

1. Engine gá»i `GetPrototypeFromConstructor(Constructor, "%Object.prototype%")`.
2. Function nÃ y láº¥y `Constructor.prototype` property.
3. Náº¿u káº¿t quáº£ lÃ  object â†’ dÃ¹ng nÃ³ lÃ m `[[Prototype]]` cho object má»›i.
4. Náº¿u káº¿t quáº£ **khÃ´ng pháº£i object** (vÃ­ dá»¥: `Constructor.prototype = "hello"` hoáº·c `Constructor.prototype = null`; lÆ°u Ã½: `null` á»Ÿ Ä‘Ã¢y bá»‹ coi lÃ  "khÃ´ng pháº£i object" vÃ¬ spec dÃ¹ng check `Type(proto) !== Object`), engine dÃ¹ng **intrinsic default** â€” thÆ°á»ng lÃ  `%Object.prototype%`.

Äiá»u nÃ y táº¡o ra má»™t edge case thÃº vá»‹:

```javascript
function Weird() {}
Weird.prototype = 42; // Ghi Ä‘Ã¨ báº±ng primitive!

const w = new Weird();
console.log(Object.getPrototypeOf(w) === Object.prototype); // true!
// Engine fallback vá» Object.prototype vÃ¬ 42 khÃ´ng pháº£i object
```

**Táº¡i sao bÆ°á»›c nÃ y quan trá»ng Ä‘áº¿n váº­y?**

BÆ°á»›c 2 lÃ  cáº§u ná»‘i trá»±c tiáº¿p Ä‘áº¿n toÃ n bá»™ kiáº¿n thá»©c prototype chain (Section 13). Nhá» bÆ°á»›c nÃ y:

- Object má»›i cÃ³ thá»ƒ "thá»«a káº¿" táº¥t cáº£ methods trÃªn `Constructor.prototype`.
- `instanceof` hoáº¡t Ä‘á»™ng (vÃ¬ nÃ³ traverse `[[Prototype]]` chain tÃ¬m `Constructor.prototype`).
- `Object.getPrototypeOf(obj) === Constructor.prototype` tráº£ vá» `true`.

Náº¿u báº¡n bá» qua bÆ°á»›c nÃ y (nhÆ° khi viáº¿t factory function), object sáº½:

- KhÃ´ng cÃ³ káº¿t ná»‘i Ä‘áº¿n constructor â†’ `instanceof` fail.
- KhÃ´ng share prototype methods â†’ má»—i instance táº¡o methods riÃªng â†’ tá»‘n memory.
- V8 khÃ³ tá»‘i Æ°u â†’ factories thÆ°á»ng táº¡o objects vá»›i different Hidden Classes, gÃ¢y "megamorphic" inline caches.

**V8 optimization insight:** Khi `Constructor.prototype` khÃ´ng thay Ä‘á»•i giá»¯a cÃ¡c láº§n `new` (trÆ°á»ng há»£p phá»• biáº¿n nháº¥t), V8 cache "initial map" â€” map Ä‘Ã£ biáº¿t trÆ°á»›c ráº±ng `[[Prototype]]` trá» Ä‘áº¿n object nÃ o. Äiá»u nÃ y giÃºp Skip hoÃ n toÃ n bÆ°á»›c lookup `Constructor.prototype` trong cÃ¡c láº§n `new` tiáº¿p theo, táº¡o ra tá»‘c Ä‘á»™ táº¡o object gáº§n báº±ng C++ `malloc + constructor`.

**Step 3: Bind `this` vÃ  thá»±c thi constructor â€” "Cuá»™c gá»i Ä‘á»‹nh má»‡nh"**

Engine gá»i constructor function body vá»›i `this` Ä‘Æ°á»£c bind vÃ o object vá»«a táº¡o á»Ÿ Step 1. Trong spec, Ä‘iá»u nÃ y Ä‘Æ°á»£c mÃ´ táº£ lÃ : `OrdinaryCallBindThis(F, calleeContext, thisArgument)` theo sau bá»Ÿi execution body â€” tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i `Constructor.call(obj, ...args)`.

**CÃ¡c chi tiáº¿t áº©n trong Step 3:**

1. **Property addition order matters cho V8**: Khi constructor gÃ¡n `this.a = 1; this.b = 2; this.c = 3;`, V8 táº¡o **transition chain** cá»§a Hidden Classes: `C0(empty) â†’ C1{a} â†’ C2{a,b} â†’ C3{a,b,c}`. Náº¿u má»™t constructor khÃ¡c gÃ¡n theo thá»© tá»± khÃ¡c (`this.b = 2; this.a = 1; this.c = 3;`), V8 táº¡o Hidden Classes **hoÃ n toÃ n khÃ¡c** dÃ¹ káº¿t quáº£ cuá»‘i cÃ¹ng identical. ÄÃ¢y lÃ  lÃ½ do V8 team khuyÃªn: **luÃ´n gÃ¡n properties theo cÃ¹ng thá»© tá»± trong constructor**.

2. **`this` trong nested functions**: BÃªn trong constructor, náº¿u báº¡n gá»i helper function khÃ´ng dÃ¹ng arrow function, `this` trong helper Ä‘Ã³ sáº½ **khÃ´ng pháº£i** object má»›i:

```javascript
function User(name) {
  this.name = name;

  function setDefaults() {
    // this á»Ÿ Ä‘Ã¢y KHÃ”NG pháº£i object má»›i!
    // this = global (sloppy) hoáº·c undefined (strict)
    this.role = "user"; // BUG: gÃ¡n vÃ o global!
  }
  setDefaults(); // Regular call â†’ this â‰  object má»›i

  // Fix: dÃ¹ng arrow function (lexical this)
  const setDefaultsFixed = () => {
    this.role = "user"; // this = object má»›i âœ…
  };
  setDefaultsFixed();
}
```

3. **Async code trong constructor**: Code bÃªn trong constructor cháº¡y **synchronous**. Náº¿u constructor chá»©a `await`, nÃ³ sáº½ throw SyntaxError (regular functions khÃ´ng thá»ƒ `await`). Náº¿u constructor chá»©a Promises hoáº·c callbacks, chÃºng sáº½ resolve **sau khi** object Ä‘Ã£ Ä‘Æ°á»£c return. ÄÃ¢y lÃ  anti-pattern phá»• biáº¿n:

```javascript
function AsyncUser(id) {
  this.id = id;
  this.data = null; // ChÆ°a cÃ³ data!

  // fetch cháº¡y async â†’ object return trÆ°á»›c khi data arrive
  fetch(`/api/users/${id}`)
    .then((res) => res.json())
    .then((data) => {
      this.data = data;
    }); // GÃ¡n sau!
}

const user = new AsyncUser(1);
console.log(user.data); // null! ğŸ˜± (fetch chÆ°a resolve)
```

Modern fix: dÃ¹ng static async factory method:

```javascript
class User {
  constructor(data) {
    Object.assign(this, data);
  }

  static async create(id) {
    const res = await fetch(`/api/users/${id}`);
    const data = await res.json();
    return new User(data); // Object Ä‘áº§y Ä‘á»§ data
  }
}
const user = await User.create(1); // âœ…
```

4. **ES6 class constructor + `super()`**: Trong derived class (class con), `this` **khÃ´ng tá»“n táº¡i** cho Ä‘áº¿n khi `super()` Ä‘Æ°á»£c gá»i. Náº¿u báº¡n truy cáº­p `this` trÆ°á»›c `super()`, engine throw `ReferenceError: Must call super constructor in derived class before accessing 'this'`. ÄÃ¢y lÃ  vÃ¬ trong inheritance chain, base class constructor chá»‹u trÃ¡ch nhiá»‡m táº¡o object â€” derived class chá»‰ nháº­n object Ä‘Ã³ qua `super()`.

```javascript
class Animal {
  constructor(name) {
    this.name = name;
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    // console.log(this.name); // âŒ ReferenceError!
    super(name); // ğŸ”‘ this báº¯t Ä‘áº§u tá»“n táº¡i á»Ÿ Ä‘Ã¢y
    this.breed = breed; // âœ… BÃ¢y giá» this Ä‘Ã£ cÃ³
  }
}
```

**Step 4: Kiá»ƒm tra return value â€” "Luáº­t cuá»‘i cÃ¹ng"**

ÄÃ¢y lÃ  bÆ°á»›c mÃ  nhiá»u developer báº¥t ngá» nháº¥t, vÃ  cÅ©ng lÃ  bÆ°á»›c chá»©a nhiá»u edge cases phá»©c táº¡p nháº¥t. Constructor function CÃ“ THá»‚ return má»™t giÃ¡ trá»‹, vÃ  spec quy Ä‘á»‹nh rÃµ rÃ ng hÃ nh vi trong seciton "[[Construct]]":

**Quy táº¯c tá»•ng quÃ¡t:**

- **Return má»™t object** (Type(result) === Object): Object Ä‘Ã³ sáº½ **thay tháº¿** `this`, trá»Ÿ thÃ nh káº¿t quáº£ cá»§a biá»ƒu thá»©c `new`. Object Ä‘Æ°á»£c táº¡o á»Ÿ Step 1 bá»‹ **bá» rÆ¡i** (garbage collected).
- **Return má»™t primitive** (bao gá»“m undefined, null, number, string, boolean, symbol, bigint): GiÃ¡ trá»‹ return bá»‹ **hoÃ n toÃ n bá» qua**, `this` (object tá»« Step 1) Ä‘Æ°á»£c return.

**Taxonomy chi tiáº¿t â€” CÃ¡i gÃ¬ Ä‘Æ°á»£c coi lÃ  "object"?**

| Return value               | Káº¿t quáº£ `new`      | LÃ½ do                         |
| -------------------------- | ------------------ | ----------------------------- |
| `return { custom: true }`  | `{ custom: true }` | Plain object â†’ override       |
| `return [1, 2, 3]`         | `[1, 2, 3]`        | Array lÃ  object â†’ override    |
| `return function() {}`     | Function Ä‘Ã³        | Function lÃ  object â†’ override |
| `return new Date()`        | Date object        | Date lÃ  object â†’ override     |
| `return /regex/`           | RegExp object      | RegExp lÃ  object â†’ override   |
| `return new Proxy({}, {})` | Proxy object       | Proxy lÃ  object â†’ override    |
| `return 42`                | `this`             | Number lÃ  primitive â†’ ignore  |
| `return "hello"`           | `this`             | String lÃ  primitive â†’ ignore  |
| `return true`              | `this`             | Boolean lÃ  primitive â†’ ignore |
| `return null`              | `this`             | **null bá»‹ ignore!** ğŸ¯        |
| `return undefined`         | `this`             | undefined â†’ ignore            |
| `return Symbol()`          | `this`             | Symbol lÃ  primitive â†’ ignore  |
| `return 123n`              | `this`             | BigInt lÃ  primitive â†’ ignore  |
| khÃ´ng cÃ³ return            | `this`             | implicit `return undefined`   |

**TrÆ°á»ng há»£p `null` â€” quirk lá»‹ch sá»­:**

`typeof null === "object"` â€” Ä‘Ã¢y lÃ  bug tá»« implementation Ä‘áº§u tiÃªn cá»§a JavaScript (1995) khi type tag 0 Ä‘Æ°á»£c dÃ¹ng cho cáº£ null vÃ  objects. NhÆ°ng trong context cá»§a `[[Construct]]`, spec sá»­ dá»¥ng check `Type(result) is Object`, vÃ  theo spec Section 6.1, `null` cÃ³ type riÃªng lÃ  **Null** â€” khÃ´ng pháº£i Object. Do Ä‘Ã³, `return null` bá»‹ ignore, dÃ¹ `typeof` nÃ³i khÃ¡c.

**Use case thá»±c táº¿ cá»§a return override:**

Táº¡i sao láº¡i ai muá»‘n return object khÃ¡c tá»« constructor? CÃ³ ba pattern phá»• biáº¿n:

1. **Singleton pattern**: Constructor luÃ´n return cÃ¹ng má»™t instance.

```javascript
let instance = null;
function Singleton() {
  if (instance) return instance; // Return cached â†’ override!
  instance = this;
  this.timestamp = Date.now();
}
const a = new Singleton();
const b = new Singleton();
console.log(a === b); // true! CÃ¹ng má»™t object
```

2. **Object pool / Flyweight**: Constructor return object tá»« pool thay vÃ¬ táº¡o má»›i.

```javascript
const pool = new Map();
function PooledColor(hex) {
  if (pool.has(hex)) return pool.get(hex); // Re-use!
  this.hex = hex;
  pool.set(hex, this);
}
```

3. **Proxy-wrapped instance**: Constructor return Proxy bá»c quanh `this` (phá»• biáº¿n trong reactive frameworks nhÆ° Vue 3's Composition API internals).

```javascript
function Reactive(data) {
  Object.assign(this, data);
  return new Proxy(this, {
    set(target, key, value) {
      target[key] = value;
      console.log(`${key} changed to ${value}`); // Trigger reactivity
      return true;
    },
  });
}
```

**LÆ°u Ã½ ES6 class:** Trong derived class (extends), náº¿u constructor return má»™t object, object Ä‘Ã³ **khÃ´ng cáº§n** lÃ  instance cá»§a class Ä‘Ã³. NhÆ°ng náº¿u constructor return primitive (hoáº·c implicit undefined), engine sáº½ return `this` â€” nhÆ°ng `this` á»Ÿ Ä‘Ã¢y pháº£i Ä‘Ã£ Ä‘Æ°á»£c initialized bá»Ÿi `super()`. Náº¿u chÆ°a gá»i `super()` vÃ  constructor káº¿t thÃºc â†’ `ReferenceError`. ÄÃ¢y lÃ  constraint mÃ  ES6 class thÃªm vÃ o, constructor function thÃ´ng thÆ°á»ng khÃ´ng cÃ³.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 1: Táº¡o má»™t object rá»—ng {}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Person(name, age) {
  // Khi gá»i new Person("Alice", 25):
  // JS táº¡o: this = {} (object rá»—ng)

  // STEP 3: this trá» vÃ o object rá»—ng, thá»±c thi constructor
  this.name = name; // {} â†’ { name: "Alice" }
  this.age = age; // { name: "Alice" } â†’ { name: "Alice", age: 25 }

  // STEP 4: KhÃ´ng return gÃ¬ â†’ implicit return this
}

// STEP 2: obj.__proto__ = Person.prototype
const alice = new Person("Alice", 25);

console.log(alice); // { name: "Alice", age: 25 }
console.log(alice.__proto__ === Person.prototype); // true âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STEP 4: Quy táº¯c Return
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 4a. Return OBJECT â†’ override, dÃ¹ng object return
function ReturnObject(name) {
  this.name = name;
  return { custom: "I override this!" }; // Return reference type
}

const r1 = new ReturnObject("Alice");
console.log(r1.name); // undefined âŒ (bá»‹ override)
console.log(r1.custom); // "I override this!" âœ…

// 4b. Return PRIMITIVE â†’ bá»‹ ignore, dÃ¹ng this
function ReturnPrimitive(name) {
  this.name = name;
  return 42; // Return value type â†’ IGNORED
}

const r2 = new ReturnPrimitive("Alice");
console.log(r2.name); // "Alice" âœ… (primitive return bá»‹ bá» qua)

// 4c. Return null â†’ bá»‹ ignore (null lÃ  primitive trong context nÃ y)
function ReturnNull(name) {
  this.name = name;
  return null;
}

const r3 = new ReturnNull("Alice");
console.log(r3.name); // "Alice" âœ… (null bá»‹ bá» qua)
```

### Tá»± Implement: myNew()

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Tá»± viáº¿t láº¡i `new` operator lÃ  má»™t trong nhá»¯ng bÃ i táº­p phá»ng váº¥n kinh Ä‘iá»ƒn nháº¥t trong JavaScript. KhÃ´ng pháº£i vÃ¬ báº¡n sáº½ bao giá» cáº§n replace `new` trong production code, mÃ  vÃ¬ quÃ¡ trÃ¬nh implement nÃ³ buá»™c báº¡n pháº£i **hiá»ƒu tá»«ng chi tiáº¿t** cá»§a thuáº­t toÃ¡n `[[Construct]]`.

**Táº¡i sao cÃ¢u há»i nÃ y quan trá»ng trong phá»ng váº¥n?**

Khi interviewer yÃªu cáº§u báº¡n implement `myNew()`, há» Ä‘ang kiá»ƒm tra:

1. **Prototype chain understanding**: Báº¡n cÃ³ biáº¿t cÃ¡ch káº¿t ná»‘i object má»›i vÃ o prototype chain khÃ´ng?
2. **`this` binding mastery**: Báº¡n cÃ³ hiá»ƒu `call()`/`apply()` Ä‘á»§ sÃ¢u Ä‘á»ƒ bind `this` Ä‘Ãºng cÃ¡ch khÃ´ng?
3. **Edge case awareness**: Báº¡n cÃ³ xá»­ lÃ½ return value Ä‘Ãºng (object override, primitive ignore) khÃ´ng?
4. **API knowledge**: Báº¡n cÃ³ biáº¿t `Object.create()` vÃ  `Object.setPrototypeOf()` khÃ´ng?

**Hai phiÃªn báº£n implement:**

PhiÃªn báº£n Ä‘áº§u tiÃªn dÃ¹ng `Object.setPrototypeOf()` â€” rÃµ rÃ ng tá»«ng bÆ°á»›c, dá»… hiá»ƒu, map 1:1 vá»›i 4 bÆ°á»›c lÃ½ thuyáº¿t. PhiÃªn báº£n thá»© hai dÃ¹ng `Object.create()` â€” gá»n hÆ¡n vÃ¬ `Object.create()` gá»™p Step 1 (táº¡o object rá»—ng) vÃ  Step 2 (gÃ¡n prototype) thÃ nh má»™t operation duy nháº¥t.

Äiá»ƒm khÃ¡c biá»‡t tinh táº¿ giá»¯a hai phiÃªn báº£n náº±m á»Ÿ Step 4: phiÃªn báº£n 1 check `result !== null && typeof result === 'object'` â€” chÃ­nh xÃ¡c hÆ¡n. PhiÃªn báº£n 2 dÃ¹ng `result instanceof Object` â€” gá»n hÆ¡n nhÆ°ng cÃ³ thá»ƒ cho káº¿t quáº£ khÃ¡c trong cross-realm scenarios (vÃ­ dá»¥: object tá»« iframe khÃ¡c).

**LÆ°u Ã½ quan trá»ng:** Cáº£ hai phiÃªn báº£n Ä‘á»u khÃ´ng handle Ä‘Æ°á»£c má»™t sá»‘ edge cases cá»§a `new` tháº­t: constructor vá»›i `Symbol.species`, `Proxy` constructor, vÃ  `new.target` propagation trong `class extends`. NhÆ°ng cho má»¥c Ä‘Ã­ch phá»ng váº¥n, hai phiÃªn báº£n nÃ y lÃ  Ä‘á»§ hoÃ n chá»‰nh.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Polyfill: Tá»± viáº¿t new operator
// ÄÃ¢y lÃ  cÃ¢u há»i phá»ng váº¥n KINH ÄIá»‚N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myNew(Constructor, ...args) {
  // Step 1: Táº¡o object rá»—ng
  const obj = {};

  // Step 2: GÃ¡n prototype (liÃªn káº¿t prototype chain)
  Object.setPrototypeOf(obj, Constructor.prototype);
  // TÆ°Æ¡ng Ä‘Æ°Æ¡ng: obj.__proto__ = Constructor.prototype

  // Step 3: Bind this = obj, thá»±c thi constructor
  const result = Constructor.apply(obj, args);

  // Step 4: Kiá»ƒm tra return type
  // Náº¿u constructor return object (non-null) â†’ dÃ¹ng nÃ³
  // NgÆ°á»£c láº¡i â†’ dÃ¹ng obj Ä‘Ã£ táº¡o á»Ÿ step 1
  return (result !== null && typeof result === "object") ||
    typeof result === "function"
    ? result
    : obj;
}

// --- Test ---
function Car(brand, year) {
  this.brand = brand;
  this.year = year;
}

Car.prototype.info = function () {
  return `${this.brand} ${this.year}`;
};

const car1 = myNew(Car, "Tesla", 2024);
const car2 = new Car("Tesla", 2024);

console.log(car1.brand); // "Tesla" âœ…
console.log(car1.info()); // "Tesla 2024" âœ…
console.log(car1 instanceof Car); // true âœ…
console.log(car1.__proto__ === Car.prototype); // true âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PhiÃªn báº£n gá»n hÆ¡n dÃ¹ng Object.create()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myNew2(Constructor, ...args) {
  // Object.create gá»™p Step 1 + Step 2:
  // Táº¡o {} VÃ€ gÃ¡n __proto__ = Constructor.prototype
  const obj = Object.create(Constructor.prototype);

  const result = Constructor.apply(obj, args);

  return result instanceof Object ? result : obj;
}
```

### Edge Cases & Gotchas

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

`new` operator cÃ³ nhá»¯ng gotcha mÃ  ngay cáº£ developer kinh nghiá»‡m cÅ©ng máº¯c pháº£i. Hiá»ƒu cÃ¡c edge cases nÃ y khÃ´ng chá»‰ giÃºp báº¡n trÃ¡nh bug mÃ  cÃ²n cho tháº¥y báº¡n náº¯m vá»¯ng JavaScript á»Ÿ má»©c sÃ¢u.

**Gotcha 1: QuÃªn `new` â€” "The Silent Killer"**

ÄÃ¢y lÃ  bug nguy hiá»ƒm nháº¥t vÃ  cÅ©ng khÃ³ phÃ¡t hiá»‡n nháº¥t. Khi báº¡n gá»i constructor function mÃ  quÃªn `new`, `this` trá» Ä‘áº¿n global object (hoáº·c `undefined` trong strict mode). Káº¿t quáº£: thay vÃ¬ táº¡o object má»›i, báº¡n vÃ´ tÃ¬nh **gÃ¡n properties vÃ o global scope** â€” "Ã´ nhiá»…m" toÃ n bá»™ á»©ng dá»¥ng. Bug nÃ y Ä‘áº·c biá»‡t khÃ³ debug vÃ¬ nÃ³ khÃ´ng throw error â€” function cháº¡y bÃ¬nh thÆ°á»ng, chá»‰ lÃ  káº¿t quáº£ hoÃ n toÃ n sai.

TrÆ°á»›c ES6, giáº£i phÃ¡p phá»• biáº¿n lÃ  check `instanceof` trong constructor: `if (!(this instanceof Constructor)) return new Constructor(args)`. Tá»« ES6, cÃ³ hai fix tá»‘t hÆ¡n: `new.target` meta-property cho phÃ©p constructor biáº¿t nÃ³ cÃ³ Ä‘Æ°á»£c gá»i vá»›i `new` khÃ´ng, vÃ  ES6 `class` tá»± Ä‘á»™ng throw `TypeError` khi gá»i thiáº¿u `new`.

**Gotcha 2: Arrow Function khÃ´ng cÃ³ `[[Construct]]`**

Arrow functions Ä‘Æ°á»£c thiáº¿t káº¿ cho má»™t má»¥c Ä‘Ã­ch duy nháº¥t: lexical `this` binding. ChÃºng **khÃ´ng cÃ³** internal method `[[Construct]]`, khÃ´ng cÃ³ `.prototype` property, vÃ  do Ä‘Ã³ khÃ´ng thá»ƒ dÃ¹ng vá»›i `new`. Äiá»u nÃ y khÃ´ng pháº£i "thiáº¿u sÃ³t" â€” Ä‘Ã³ lÃ  **thiáº¿t káº¿ cÃ³ chá»§ Ä‘Ã­ch** cá»§a TC39. Arrow functions lÃ  "lightweight functions" khÃ´ng mang theo baggage cá»§a constructability.

**Gotcha 3: `new` vá»›i built-in constructors**

Má»™t sai láº§m phá»• biáº¿n lÃ  dÃ¹ng `new String()`, `new Number()`, `new Boolean()`. Káº¿t quáº£ lÃ  má»™t **wrapper object**, khÃ´ng pháº£i primitive. `typeof new String('hello')` tráº£ vá» `"object"`, khÃ´ng pháº£i `"string"`. Äiá»u nÃ y gÃ¢y ra vÃ´ sá»‘ bug khi so sÃ¡nh (`===` fail), khi check type, vÃ  khi serialize/deserialize. Rule of thumb: **khÃ´ng bao giá»** dÃ¹ng `new` vá»›i primitive constructors.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: QuÃªn new â†’ this = window (BUG NGUY HIá»‚M!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  this.name = name;
}

const u1 = new User("Alice"); // âœ… this = object má»›i
const u2 = User("Bob"); // âŒ this = window! (regular fn call)

console.log(u1.name); // "Alice" âœ…
console.log(u2); // undefined (no return)
console.log(window.name); // "Bob" ğŸ’€ GÃ¡n vÃ o global!

// âœ… FIX 1: new.target (ES6)
function SafeUser(name) {
  if (!new.target) {
    return new SafeUser(name); // Auto-fix: gá»i láº¡i vá»›i new
  }
  this.name = name;
}

SafeUser("Charlie").name; // "Charlie" âœ… (auto-fixed)

// âœ… FIX 2: ES6 class (tá»± throw náº¿u thiáº¿u new)
class SafeClass {
  constructor(name) {
    this.name = name;
  }
}

// SafeClass("Alice");  // TypeError: Cannot call a class as a function âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: Arrow function KHÃ”NG THá»‚ dÃ¹ng vá»›i new
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const ArrowFn = (name) => {
  this.name = name;
};

// new ArrowFn("Alice");
// TypeError: ArrowFn is not a constructor âŒ
// Arrow function khÃ´ng cÃ³ [[Construct]], khÃ´ng cÃ³ prototype

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: new vá»›i built-in constructors
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âš ï¸ Primitive wrappers â€” TRÃNH dÃ¹ng new
const str1 = "hello"; // primitive string âœ…
const str2 = new String("hello"); // String object âŒ

typeof str1; // "string"
typeof str2; // "object" ğŸ˜±

str1 === str2; // false! (khÃ¡c type)
```

### Tá»•ng Há»£p: new Operator

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

`new` operator lÃ  má»™t trong nhá»¯ng keyword nhá» nháº¥t nhÆ°ng cÃ³ táº§m áº£nh hÆ°á»Ÿng lá»›n nháº¥t trong JavaScript. Chá»‰ vá»›i 3 kÃ½ tá»±, nÃ³ encapsulate toÃ n bá»™ quÃ¡ trÃ¬nh object creation â€” tá»« allocation, prototype linking, `this` binding, Ä‘áº¿n return value handling.

**TÃ³m táº¯t kiáº¿n thá»©c cá»‘t lÃµi:**

1. **`new` thá»±c hiá»‡n chÃ­nh xÃ¡c 4 bÆ°á»›c** â€” táº¡o object, gÃ¡n prototype, bind this + exec, check return. ÄÃ¢y lÃ  thuáº­t toÃ¡n `[[Construct]]` trong ECMAScript spec.
2. **Return behavior** lÃ  edge case quan trá»ng nháº¥t: return object thÃ¬ override, return primitive thÃ¬ ignore.
3. **Arrow functions khÃ´ng thá»ƒ dÃ¹ng vá»›i `new`** â€” chÃºng khÃ´ng cÃ³ `[[Construct]]` internal method.
4. **QuÃªn `new` lÃ  bug nghiÃªm trá»ng** â€” dÃ¹ng `new.target` hoáº·c ES6 `class` Ä‘á»ƒ phÃ²ng trÃ¡nh.
5. **`new` lÃ  cáº§u ná»‘i** giá»¯a prototype chain (Section 13), `this` binding (Section 7), vÃ  object creation.

**LiÃªn há»‡ vá»›i há»‡ sinh thÃ¡i JavaScript hiá»‡n Ä‘áº¡i:**

Trong React trÆ°á»›c hooks, má»i component lÃ  `class extends React.Component` â€” má»—i `<Component />` ngáº§m gá»i `new`. Trong Node.js, `new EventEmitter()`, `new Buffer()`, `new Error()` xuáº¥t hiá»‡n kháº¯p nÆ¡i. Ngay cáº£ trong code functional-style hiá»‡n Ä‘áº¡i, `new` váº«n áº©n mÃ¬nh bÃªn trong framework internals â€” báº¡n cÃ³ thá»ƒ khÃ´ng viáº¿t `new`, nhÆ°ng framework Ä‘ang gá»i nÃ³ cho báº¡n.

**Lá»i khuyÃªn cho phá»ng váº¥n:**

- LuÃ´n giáº£i thÃ­ch Ä‘Æ°á»£c 4 bÆ°á»›c cá»§a `new` â€” Ä‘Ã¢y lÃ  cÃ¢u há»i warmup phá»• biáº¿n.
- Biáº¿t implement `myNew()` tá»« Ä‘áº§u â€” thá»ƒ hiá»‡n mastery over prototype + `this`.
- Hiá»ƒu táº¡i sao `class` syntax an toÃ n hÆ¡n constructor functions (tá»± throw khi thiáº¿u `new`).
- Náº¯m sá»± khÃ¡c biá»‡t giá»¯a `new Object()` vs `{}`, `new Array()` vs `[]` â€” vÃ  luÃ´n Æ°u tiÃªn literal syntax.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  new OPERATOR â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Step  â”‚  Action                                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  1     â”‚  Táº¡o object rá»—ng {}                              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  2     â”‚  obj.__proto__ = Constructor.prototype           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  3     â”‚  Constructor.call(obj, args) â€” bind this + exec  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  4     â”‚  Return object? â†’ dÃ¹ng nÃ³                        â”‚  â”‚
â”‚  â”‚        â”‚  Return primitive? â†’ dÃ¹ng obj (step 1)           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ QuÃªn new â†’ this = window (use new.target hoáº·c class)         â”‚
â”‚  âš ï¸ Arrow function KHÃ”NG THá»‚ dÃ¹ng vá»›i new                       â”‚
â”‚  âš ï¸ Return object override this, return primitive bá»‹ ignore      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”¬ Deep Analysis Patterns â€” new Operator

#### Pattern 1: 5 Whys â€” Táº¡i Sao `new` Tá»“n Táº¡i Trong JavaScript?

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

**Why 1: Táº¡i sao JavaScript cáº§n keyword `new`?**

CÃ¢u tráº£ lá»i náº±m á»Ÿ yÃªu cáº§u marketing cá»§a Netscape nÄƒm 1995. JavaScript Ä‘Æ°á»£c thiáº¿t káº¿ dá»±a trÃªn **Self** â€” ngÃ´n ngá»¯ prototype-based khÃ´ng cÃ³ `class` hay `new`. NhÆ°ng Netscape muá»‘n JavaScript pháº£i "trÃ´ng giá»‘ng Java" â€” ngÃ´n ngá»¯ OOP nÃ³ng nháº¥t thá»i Ä‘iá»ƒm Ä‘Ã³ â€” Ä‘á»ƒ thu hÃºt developer. Brendan Eich pháº£i thÃªm `new` keyword Ä‘á»ƒ syntax táº¡o object trong JavaScript nhÃ¬n quen thuá»™c vá»›i Java developers: `new MyClass()`. Thá»±c táº¿ bÃªn dÆ°á»›i, `new` trong JavaScript hoáº¡t Ä‘á»™ng hoÃ n toÃ n khÃ¡c Java â€” nÃ³ khÃ´ng liÃªn quan Ä‘áº¿n class hierarchy hay static type system, mÃ  thá»±c hiá»‡n prototype linking. ÄÃ¢y lÃ  **cosmetic similarity** â€” giá»‘ng vá» hÃ¬nh thá»©c, khÃ¡c vá» báº£n cháº¥t.

Náº¿u Brendan Eich khÃ´ng bá»‹ Ã©p thÃªm `new`, JavaScript cÃ³ thá»ƒ Ä‘Ã£ phÃ¡t triá»ƒn theo hÆ°á»›ng hoÃ n toÃ n prototype-based nhÆ° Self, sá»­ dá»¥ng `Object.create()`-style API tá»« Ä‘áº§u. Lá»‹ch sá»­ Ä‘Ã£ chá»©ng minh: cá»™ng Ä‘á»“ng máº¥t 14 nÄƒm (Ä‘áº¿n ES5 nÄƒm 2009) má»›i cÃ³ `Object.create()`, vÃ  20 nÄƒm (ES6 nÄƒm 2015) má»›i cÃ³ `class` â€” cáº£ hai Ä‘á»u lÃ  ná»— lá»±c "sá»­a chá»¯a" háº­u quáº£ cá»§a quyáº¿t Ä‘á»‹nh thiáº¿t káº¿ ban Ä‘áº§u.

**Why 2: Táº¡i sao khÃ´ng chá»‰ dÃ¹ng factory functions?**

Factory functions (hÃ m tráº£ vá» object literal) cÃ³ thá»ƒ thay tháº¿ `new` trong háº§u háº¿t trÆ°á»ng há»£p. Douglas Crockford â€” tÃ¡c giáº£ cuá»‘n _JavaScript: The Good Parts_ â€” tháº­m chÃ­ khuyÃªn trÃ¡nh `new` hoÃ n toÃ n. Váº­y táº¡i sao `new` váº«n tá»“n táº¡i?

Ba lÃ½ do ká»¹ thuáº­t mÃ  factory functions khÃ´ng dá»… thay tháº¿:

1. **`instanceof` operator**: `instanceof` dá»±a vÃ o prototype chain â€” factory function objects khÃ´ng káº¿t ná»‘i vÃ o constructor's prototype, nÃªn `instanceof` luÃ´n tráº£ vá» `false`. Trong codebase lá»›n, `instanceof` Ä‘Æ°á»£c dÃ¹ng cho type narrowing, error handling (`err instanceof CustomError`), vÃ  pattern matching.

2. **Memory efficiency**: Methods trÃªn prototype Ä‘Æ°á»£c share giá»¯a táº¥t cáº£ instances â€” 1 function object cho 10,000 instances. Factory function pháº£i táº¡o methods má»›i cho má»—i object (trá»« khi manually setup prototype, lÃºc Ä‘Ã³ báº¡n Ä‘ang tÃ¡i phÃ¡t minh `new`).

3. **Engine optimizations**: V8 tá»‘i Æ°u máº¡nh cho constructor pattern â€” Hidden Class caching, inline caches, initial map prediction. Factory functions táº¡o objects vá»›i shapes khÃ³ dá»± Ä‘oÃ¡n hÆ¡n, dáº«n Ä‘áº¿n megamorphic code cháº­m hÆ¡n.

**Why 3: Táº¡i sao `new` cáº§n 4 bÆ°á»›c riÃªng biá»‡t thay vÃ¬ 1 operation Ä‘Æ¡n giáº£n?**

Má»—i bÆ°á»›c giáº£i quyáº¿t má»™t concern khÃ¡c nhau, vÃ  tÃ¡ch riÃªng chÃºng cho phÃ©p linh hoáº¡t:

- **Step 1 (táº¡o object)**: TÃ¡ch riÃªng Ä‘á»ƒ cho phÃ©p custom allocation (vÃ­ dá»¥: `Reflect.construct` cÃ³ thá»ƒ specify `newTarget` khÃ¡c constructor).
- **Step 2 (gÃ¡n prototype)**: TÃ¡ch riÃªng Ä‘á»ƒ cho phÃ©p prototype override (gÃ¡n `Constructor.prototype = customProto`), vÃ  fallback khi prototype bá»‹ ghi Ä‘Ã¨ báº±ng non-object.
- **Step 3 (bind this + exec)**: Constructor body cÃ³ thá»ƒ thá»±c hiá»‡n báº¥t ká»³ logic nÃ o â€” validation, side effects, conditional initialization.
- **Step 4 (check return)**: Cho phÃ©p patterns nhÆ° Singleton, Proxy wrapping, vÃ  object pool mÃ  khÃ´ng cáº§n syntax Ä‘áº·c biá»‡t.

Náº¿u `new` chá»‰ lÃ  1 atomic operation, táº¥t cáº£ patterns trÃªn sáº½ khÃ´ng thá»ƒ implement Ä‘Æ°á»£c.

**Why 4: Táº¡i sao ES6 `class` váº«n dÃ¹ng `new` thay vÃ¬ thiáº¿t káº¿ API hoÃ n toÃ n má»›i?**

Backward compatibility. JavaScript cháº¡y trÃªn hÃ ng tá»· thiáº¿t bá»‹ â€” breaking change lÃ  khÃ´ng thá»ƒ cháº¥p nháº­n. ES6 `class` Ä‘Æ°á»£c thiáº¿t káº¿ nhÆ° **syntactic sugar** â€” nÃ³ biÃªn dá»‹ch xuá»‘ng chÃ­nh xÃ¡c pattern `new Constructor()` cÅ©. Äiá»u nÃ y Ä‘áº£m báº£o:

- Code ES6 class tÆ°Æ¡ng thÃ­ch vá»›i code ES5 constructor function.
- Libraries viáº¿t báº±ng ES5 cÃ³ thá»ƒ Ä‘Æ°á»£c extend báº±ng ES6 `class extends`.
- `instanceof` hoáº¡t Ä‘á»™ng xuyÃªn suá»‘t, khÃ´ng phÃ¢n biá»‡t ES5 hay ES6.

TC39 Ä‘Ã£ há»c bÃ i há»c tá»« Python 2â†’3 migration: breaking changes táº¡o schism trong community. JavaScript chá»n con Ä‘Æ°á»ng evolution over revolution.

**Why 5: Táº¡i sao hiá»ƒu `new` á»Ÿ má»©c sÃ¢u váº«n quan trá»ng trong thá»i Ä‘áº¡i React Hooks vÃ  functional programming?**

Ba lÃ½ do:

1. **Framework internals**: React, Vue, Angular Ä‘á»u sá»­ dá»¥ng `new` internally. Hiá»ƒu `new` giÃºp báº¡n debug framework bugs, Ä‘á»c source code, vÃ  Ä‘Ã³ng gÃ³p cho open source.

2. **Error classes vÃ  Web APIs**: `new Error()`, `new URL()`, `new FormData()`, `new WebSocket()`, `new IntersectionObserver()` â€” Web Platform APIs váº«n dÃ¹ng constructor pattern. Báº¡n khÃ´ng thá»ƒ escape `new` trong real-world JavaScript.

3. **Interview gate**: `new` lÃ  cÃ¢u há»i sÃ ng lá»c trong phá»ng váº¥n â€” nÃ³ kiá»ƒm tra Ä‘á»“ng thá»i prototype, `this`, memory model, vÃ  type system. KhÃ´ng tráº£ lá»i Ä‘Æ°á»£c = Ä‘Ã¡nh máº¥t cÆ¡ há»™i.

---

#### Pattern 2: First Principles â€” BÃªn Trong `[[Construct]]` á» Má»©c Specification

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Äá»ƒ thá»±c sá»± hiá»ƒu `new`, chÃºng ta cáº§n Ä‘á»c ECMAScript specification â€” nguá»“n chÃ¢n lÃ½ duy nháº¥t (single source of truth) cho má»i JavaScript behavior.

**Thuáº­t toÃ¡n `[[Construct]]` (Section 10.2.2 trong spec):**

Khi engine nháº­n lá»‡nh `new F(args)`, nÃ³ thá»±c hiá»‡n chuá»—i abstract operations sau:

```
1. Let callerContext = running execution context
2. Let kind = F.[[ConstructorKind]]                    // "base" hoáº·c "derived"
3. If kind is "base":
   a. Let thisArgument = OrdinaryCreateFromConstructor(newTarget, "%Object.prototype%")
4. Let calleeContext = PrepareForOrdinaryCall(F, newTarget)
5. If kind is "base":
   a. OrdinaryCallBindThis(F, calleeContext, thisArgument)
6. Let constructorEnv = calleeContext's LexicalEnvironment
7. Let result = OrdinaryCallEvaluateBody(F, argumentsList)
8. If result.[[Type]] is return:
   a. If Type(result.[[Value]]) is Object â†’ return result.[[Value]]
   b. If kind is "base" â†’ return thisArgument
   c. If result.[[Value]] is not undefined â†’ throw TypeError
9. Return thisArgument (from constructorEnv)
```

**PhÃ¢n tÃ­ch tá»«ng bÆ°á»›c spec:**

**`ConstructorKind` â€” phÃ¢n biá»‡t base vs derived:**

ÄÃ¢y lÃ  internal slot Ä‘Æ°á»£c thÃªm vÃ o ES6 Ä‘á»ƒ handle `class extends`. Khi báº¡n viáº¿t `class Child extends Parent`, `Child` cÃ³ `[[ConstructorKind]] = "derived"`. Derived constructors **khÃ´ng tá»± táº¡o `this`** â€” chÃºng pháº£i gá»i `super()` Ä‘á»ƒ base constructor táº¡o object. ÄÃ¢y lÃ  lÃ½ do truy cáº­p `this` trÆ°á»›c `super()` gÃ¢y `ReferenceError`.

Trong ES5 constructor functions, má»i function Ä‘á»u cÃ³ `[[ConstructorKind]] = "base"` â€” chÃºng luÃ´n tá»± táº¡o `this`. ÄÃ¢y lÃ  sá»± khÃ¡c biá»‡t fundamental giá»¯a ES5 constructor function vÃ  ES6 class constructor.

**`OrdinaryCreateFromConstructor` â€” step áº©n:**

Operation nÃ y khÃ´ng xuáº¥t hiá»‡n trong tutorial nÃ o, nhÆ°ng nÃ³ critical:

```
1. Let proto = GetPrototypeFromConstructor(constructor, intrinsicDefaultProto)
   a. Let proto = Get(constructor, "prototype")
   b. If Type(proto) is not Object:
      return intrinsicDefaultProto (usually %Object.prototype%)
   c. Return proto
2. Let obj = OrdinaryObjectCreate(proto)
3. Return obj
```

Implication quan trá»ng: náº¿u ai Ä‘Ã³ ghi Ä‘Ã¨ `Constructor.prototype = 42` (non-object), engine **khÃ´ng throw error** â€” nÃ³ Ã¢m tháº§m fallback vá» `Object.prototype`. ÄÃ¢y lÃ  defensive programming á»Ÿ má»©c specification.

**`newTarget` â€” khÃ¡i niá»‡m Ã­t ngÆ°á»i biáº¿t:**

`newTarget` khÃ´ng pháº£i luÃ´n lÃ  constructor function. Trong `Reflect.construct(Target, args, NewTarget)`, `newTarget` cÃ³ thá»ƒ lÃ  function khÃ¡c:

```javascript
function Animal(name) {
  this.name = name;
  console.log(new.target === Animal); // false!
  console.log(new.target === Dog); // true!
}

function Dog() {}
Dog.prototype = Object.create(Animal.prototype);

// new.target = Dog, nhÆ°ng Animal body thá»±c thi
const rex = Reflect.construct(Animal, ["Rex"], Dog);
console.log(rex instanceof Dog); // true âœ…
console.log(rex instanceof Animal); // true âœ…
```

`Reflect.construct` cho phÃ©p tÃ¡ch biá»‡t **constructor body** (`Animal`) khá»i **prototype source** (`Dog`) â€” má»™t tÃ­nh nÄƒng quan trá»ng cho meta-programming vÃ  framework internals.

**Property Descriptor impact trÃªn prototype:**

Khi `new` set up prototype link á»Ÿ Step 2, nÃ³ gÃ¡n `[[Prototype]]` internal slot â€” Ä‘Ã¢y lÃ  **internal slot**, khÃ´ng pháº£i property. NhÆ°ng khi Step 3 cháº¡y constructor body, má»—i `this.prop = value` táº¡o **own property** trÃªn instance thÃ´ng qua `[[Set]]` semantics. Äiá»u nÃ y cÃ³ nghÄ©a:

- Náº¿u prototype cÃ³ property vá»›i `writable: false`, constructor body gÃ¡n `this.prop = value` sáº½ **throw TypeError** trong strict mode (vÃ¬ shadowing cá»§a writable-false property bá»‹ cáº¥m qua `[[Set]]`).
- Náº¿u prototype cÃ³ setter cho property Ä‘Ã³, setter sáº½ cháº¡y thay vÃ¬ táº¡o own property.

ÄÃ¢y lÃ  edge case cá»±c ká»³ hiáº¿m gáº·p nhÆ°ng spec-compliant â€” vÃ  nÃ³ cho tháº¥y táº¡i sao náº¯m vá»¯ng spec matters.

---

#### Pattern 3: Trade-off Analysis â€” `new` Constructor vs Factory vs Class

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Ba paradigm táº¡o object trong JavaScript â€” constructor function + `new`, factory function, vÃ  ES6 `class` â€” Ä‘á»u cÃ³ strengths vÃ  weaknesses riÃªng. KhÃ´ng cÃ³ "cÃ¡ch tá»‘t nháº¥t" universal â€” chá»‰ cÃ³ "cÃ¡ch phÃ¹ há»£p nháº¥t" cho context cá»¥ thá»ƒ.

| TiÃªu chÃ­              | Constructor + `new`                      | Factory Function                        | ES6 `class`                                |
| --------------------- | ---------------------------------------- | --------------------------------------- | ------------------------------------------ |
| **Syntax**            | `function Fn() { this.x = 1 }; new Fn()` | `function create() { return { x: 1 } }` | `class C { constructor() { this.x = 1 } }` |
| **Prototype sharing** | âœ… Tá»± Ä‘á»™ng qua `.prototype`              | âŒ Pháº£i setup thá»§ cÃ´ng                  | âœ… Tá»± Ä‘á»™ng                                 |
| **`instanceof`**      | âœ… Hoáº¡t Ä‘á»™ng                             | âŒ KhÃ´ng hoáº¡t Ä‘á»™ng                      | âœ… Hoáº¡t Ä‘á»™ng                               |
| **Encapsulation**     | âŒ Chá»‰ cÃ³ convention (`_private`)        | âœ… Closures = true private              | âœ… `#private` fields (ES2022)              |
| **QuÃªn `new` safety** | âŒ Silent bug (global pollution)         | âœ… KhÃ´ng cáº§n `new`                      | âœ… Auto-throw `TypeError`                  |
| **Káº¿ thá»«a**           | âœ… Qua prototype chain (verbose)         | âš ï¸ Qua composition (manual)             | âœ… `extends` + `super()` (clean)           |
| **V8 optimization**   | âœ… Hidden Class caching, initial map     | âš ï¸ KhÃ³ tá»‘i Æ°u (varied shapes)           | âœ… Tá»‘i Æ°u tá»‘t nháº¥t                         |
| **Memory**            | âœ… Shared methods qua prototype          | âŒ Má»—i instance táº¡o methods má»›i         | âœ… Shared methods                          |
| **`this` binding**    | âš ï¸ Phá»¥ thuá»™c call-site                   | âœ… KhÃ´ng dÃ¹ng `this` (can avoid)        | âš ï¸ Phá»¥ thuá»™c call-site                     |
| **Testability**       | âš ï¸ Cáº§n mock constructor                  | âœ… Dá»… mock (pure function)              | âš ï¸ Cáº§n mock constructor                    |

**Khi nÃ o dÃ¹ng gÃ¬?**

**Constructor + `new`** (Legacy / Library code): DÃ¹ng khi báº¡n maintain codebase ES5, hoáº·c khi performance lÃ  priority tuyá»‡t Ä‘á»‘i vÃ  báº¡n cáº§n V8 optimizations. Pattern nÃ y Ä‘ang dáº§n bá»‹ thay tháº¿ bá»Ÿi ES6 `class`, nhÆ°ng váº«n xuáº¥t hiá»‡n phá»• biáº¿n trong Node.js core modules (`new Buffer()`, `new EventEmitter()`).

**Factory Function** (Composition-first): DÃ¹ng khi báº¡n Æ°u tiÃªn encapsulation, testability, vÃ  functional programming style. Factory functions tá»a sÃ¡ng trong code cÃ³ nhiá»u asynchronous initialization (async factory), conditional creation (A/B testing), vÃ  khi báº¡n muá»‘n trÃ¡nh hoÃ n toÃ n `this` complexity. React Hooks báº£n cháº¥t lÃ  factory pattern â€” `useState()` return state tuple, khÃ´ng dÃ¹ng `new` hay `this`.

**ES6 `class`** (Standard modern): DÃ¹ng cho háº§u háº¿t use cases má»›i. ES6 `class` káº¿t há»£p best of both worlds â€” prototype sharing efficiency vá»›i syntax clean, `extends`/`super` cho inheritance, `#private` fields cho encapsulation. TypeScript first-class support cho `class` cÅ©ng lÃ  lÃ½ do quan trá»ng.

**Pattern Ä‘áº·c biá»‡t â€” Hybrid approach:**

Má»™t sá»‘ libraries káº¿t há»£p factory + class: expose factory function nhÆ°ng return class instance bÃªn trong. VÃ­ dá»¥:

```javascript
// Axios style: factory function wrapping class
function createApp(config) {
  // Private setup logic
  const validated = validateConfig(config);

  // Return class instance (cÃ³ prototype sharing + instanceof)
  return new App(validated);
}

class App {
  #config;
  constructor(config) {
    this.#config = config;
  }
  run() {
    /* ... */
  }
}

// Consumer doesn't know/care about `new`
const app = createApp({ port: 3000 });
app.run();
app instanceof App; // true
```

Pattern nÃ y cho báº¡n best of all worlds: clean API (no `new` required), encapsulation (private config), prototype sharing (methods on class), `instanceof` support, vÃ  async initialization capability.

---

#### Pattern 4: Mental Mapping â€” `new` Trong Há»‡ Sinh ThÃ¡i JavaScript

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

`new` operator khÃ´ng tá»“n táº¡i isolated â€” nÃ³ lÃ  **trung tÃ¢m** káº¿t ná»‘i nhiá»u concept JavaScript. Hiá»ƒu vá»‹ trÃ­ cá»§a `new` trong toÃ n bá»™ ecosystem giÃºp báº¡n nhÃ¬n tháº¥y bá»©c tranh lá»›n hÆ¡n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            `new` OPERATOR â€” TRUNG TÃ‚M Káº¾T Ná»I                   â”‚
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚    â”‚ Prototype   â”‚â—„â”€â”€â”€â”€â”‚  Step 2: GÃ¡n       â”‚                    â”‚
â”‚    â”‚ Chain       â”‚     â”‚  [[Prototype]]      â”‚                    â”‚
â”‚    â”‚ (Section 13)â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                                â”‚
â”‚                           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚   new   â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ this Binding â”‚â—„â”€â”€â”€â”€â”€â”€â”‚ keyword â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Object       â”‚   â”‚
â”‚    â”‚ (Section 7)  â”‚        â”‚         â”‚        â”‚ Creation     â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚ & Memory     â”‚   â”‚
â”‚                                â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚    â”‚ Return Type â”‚â—„â”€â”€â”€â”€â”‚  Step 4: Check  â”‚                       â”‚
â”‚    â”‚ Coercion    â”‚     â”‚  return value   â”‚                       â”‚
â”‚    â”‚ (Ref vs Val)â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚  REAL-WORLD APPEARANCES OF `new`                        â”‚   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â”‚  DOM / Browser:                                         â”‚   â”‚
â”‚    â”‚  â€¢ new Event('click')                                   â”‚   â”‚
â”‚    â”‚  â€¢ new URL('https://example.com')                       â”‚   â”‚
â”‚    â”‚  â€¢ new FormData(form)                                   â”‚   â”‚
â”‚    â”‚  â€¢ new IntersectionObserver(callback)                   â”‚   â”‚
â”‚    â”‚  â€¢ new MutationObserver(callback)                       â”‚   â”‚
â”‚    â”‚  â€¢ new WebSocket('wss://...')                           â”‚   â”‚
â”‚    â”‚  â€¢ new Worker('worker.js')                              â”‚   â”‚
â”‚    â”‚  â€¢ new AbortController()                                â”‚   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â”‚  Node.js:                                               â”‚   â”‚
â”‚    â”‚  â€¢ new EventEmitter()                                   â”‚   â”‚
â”‚    â”‚  â€¢ new Buffer() (deprecated â†’ Buffer.from())           â”‚   â”‚
â”‚    â”‚  â€¢ new Error('message')                                 â”‚   â”‚
â”‚    â”‚  â€¢ new ReadableStream()                                 â”‚   â”‚
â”‚    â”‚  â€¢ new Proxy(target, handler)                           â”‚   â”‚
â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚    â”‚  Frameworks (internal usage):                           â”‚   â”‚
â”‚    â”‚  â€¢ React: new ComponentClass() (pre-hooks)              â”‚   â”‚
â”‚    â”‚  â€¢ Angular: new ComponentClass() (DI container)         â”‚   â”‚
â”‚    â”‚  â€¢ Vue: new Vue() (Vue 2), createApp() (Vue 3)          â”‚   â”‚
â”‚    â”‚  â€¢ Express: new express.Router()                        â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Xu hÆ°á»›ng trong ecosystem:**

JavaScript ecosystem Ä‘ang chuyá»ƒn dáº§n tá»« `new` sang **factory functions**:

- **Vue 2** â†’ `new Vue({...})` | **Vue 3** â†’ `createApp({...})` (factory)
- **Node.js Buffer** â†’ `new Buffer()` (deprecated) | `Buffer.from()` (factory)
- **React** â†’ `new Component()` (class) | `useState()` / `useEffect()` (hooks = factory)
- **Angular** â†’ váº«n dÃ¹ng `new` heavily qua DI container

NhÆ°ng Web Platform APIs váº«n tÃ­ch cá»±c dÃ¹ng `new`: `new URL()`, `new Request()`, `new Response()`, `new Headers()` â€” Fetch API, URL API, Streams API Ä‘á»u lÃ  constructor-based. ÄÃ¢y lÃ  vÃ¬ Web specs Ä‘Æ°á»£c viáº¿t báº±ng WebIDL â€” language mÃ  constructors lÃ  first-class concept, vÃ  browser engines implement chÃºng báº±ng C++ classes map trá»±c tiáº¿p sang JavaScript constructors.

**`new` áº©n mÃ¬nh â€” nhá»¯ng nÆ¡i báº¡n khÃ´ng ngá»:**

1. **Template literals**: `` `hello ${name}` `` gá»i `new String()` internally Ä‘á»ƒ xá»­ lÃ½ coercion.
2. **Destructuring vá»›i defaults**: `const { x = new Date() } = obj` â€” default value evaluation sá»­ dá»¥ng `new`.
3. **Class fields**: `class C { x = new Map() }` â€” field initializer cháº¡y trong constructor context, equivalent vá»›i `this.x = new Map()` trong constructor body.
4. **`for...of`**: `for (const item of iterable)` internally gá»i `new Iterator()` protocol.
5. **Spread operator**: `[...iterable]` cÅ©ng dÃ¹ng Iterator protocol, tÆ°Æ¡ng tá»± `for...of`.

---

#### Pattern 5: Reverse Engineering â€” Tá»± Build NÃ¢ng Cao

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

á» section trÆ°á»›c, chÃºng ta Ä‘Ã£ implement `myNew()` cÆ¡ báº£n. BÃ¢y giá», hÃ£y Ä‘i xa hÆ¡n â€” implement cÃ¡c khÃ­a cáº¡nh nÃ¢ng cao cá»§a `new` mÃ  thÆ°á»ng bá»‹ bá» qua.

**Advanced `myNew` â€” xá»­ lÃ½ cáº£ `new.target` vÃ  function validation:**

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Advanced myNew â€” gáº§n vá»›i spec hÆ¡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myNewAdvanced(Constructor, ...args) {
  // Validation: Constructor pháº£i lÃ  function
  if (typeof Constructor !== "function") {
    throw new TypeError(`${Constructor} is not a constructor`);
  }

  // Check: Arrow functions vÃ  generators khÃ´ng cÃ³ [[Construct]]
  // Heuristic: arrow functions khÃ´ng cÃ³ .prototype property
  if (!Constructor.prototype && Constructor.toString().includes("=>")) {
    throw new TypeError(
      `${Constructor.name || "Arrow function"} is not a constructor`,
    );
  }

  // Step 1+2: OrdinaryCreateFromConstructor
  // Láº¥y prototype â€” náº¿u khÃ´ng pháº£i object, fallback vá» Object.prototype
  const proto = Constructor.prototype;
  const obj = Object.create(
    (typeof proto === "object" || typeof proto === "function") && proto !== null
      ? proto
      : Object.prototype,
  );

  // Step 3: Bind this + execute
  const result = Constructor.apply(obj, args);

  // Step 4: Check return value (spec-compliant)
  // Object type includes: {}, [], function, Date, RegExp, etc.
  // Excludes: null (even though typeof null === "object")
  if (
    result !== null &&
    (typeof result === "object" || typeof result === "function")
  ) {
    return result;
  }

  return obj;
}

// Test edge cases:
function WeirdProto() {
  this.x = 1;
}
WeirdProto.prototype = 42; // Non-object prototype!
const w = myNewAdvanced(WeirdProto);
console.log(Object.getPrototypeOf(w) === Object.prototype); // true âœ… (fallback)
console.log(w.x); // 1 âœ…

function ReturnArray() {
  this.y = 2;
  return [1, 2, 3]; // Array is object â†’ override
}
const arr = myNewAdvanced(ReturnArray);
console.log(Array.isArray(arr)); // true âœ…
console.log(arr.y); // undefined âœ… (this bá»‹ bá» qua)
```

**Tá»± build `Reflect.construct` â€” tÃ¡ch constructor body khá»i prototype source:**

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Custom Reflect.construct â€” há»— trá»£ newTarget
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function myReflectConstruct(Target, args, NewTarget) {
  // NewTarget optional â€” default = Target
  NewTarget = NewTarget || Target;

  if (typeof Target !== "function") {
    throw new TypeError("Target must be a function");
  }
  if (typeof NewTarget !== "function") {
    throw new TypeError("NewTarget must be a function");
  }

  // Táº¡o object vá»›i prototype tá»« NewTarget (KHÃ”NG pháº£i Target!)
  const proto = NewTarget.prototype;
  const obj = Object.create(
    (typeof proto === "object" || typeof proto === "function") && proto !== null
      ? proto
      : Object.prototype,
  );

  // Thá»±c thi Target body vá»›i this = obj
  const result = Target.apply(obj, args);

  // Check return
  if (
    result !== null &&
    (typeof result === "object" || typeof result === "function")
  ) {
    return result;
  }

  return obj;
}

// Test: TÃ¡ch constructor body khá»i prototype source
function Shape(type) {
  this.type = type;
}

function Circle() {}
Circle.prototype.area = function (r) {
  return Math.PI * r * r;
};

// Cháº¡y Shape body, nhÆ°ng dÃ¹ng Circle prototype
const shape = myReflectConstruct(Shape, ["circle"], Circle);
console.log(shape.type); // "circle" âœ… (tá»« Shape body)
console.log(shape.area(5)); // 78.54... âœ… (tá»« Circle prototype)
console.log(shape instanceof Circle); // true âœ…
console.log(shape instanceof Shape); // false âœ… (prototype tá»« Circle)
```

**Tá»± build `new.target` detection pattern (pre-ES6):**

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Polyfill new.target cho ES5 environments
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function MyClass(name) {
  // ES6: if (!new.target) throw new TypeError(...)
  // ES5 polyfill: dÃ¹ng instanceof
  if (!(this instanceof MyClass)) {
    throw new TypeError("MyClass must be called with new");
  }
  this.name = name;
}

// Safer version â€” auto-correct thay vÃ¬ throw
function SafeConstructor(name) {
  if (!(this instanceof SafeConstructor)) {
    return new SafeConstructor(name); // Re-invoke with new
  }
  this.name = name;
}

// Test
try {
  MyClass("Alice"); // Throws TypeError âœ…
} catch (e) {
  console.log(e.message); // "MyClass must be called with new"
}

const safe = SafeConstructor("Bob"); // Auto-corrected
console.log(safe.name); // "Bob" âœ…
console.log(safe instanceof SafeConstructor); // true âœ…
```

**BÃ i há»c tá»« Reverse Engineering:**

1. `OrdinaryCreateFromConstructor` lÃ  bÆ°á»›c áº©n quan trá»ng nháº¥t â€” nÃ³ handle prototype fallback khi `.prototype` bá»‹ ghi Ä‘Ã¨ báº±ng non-object.
2. `Reflect.construct` tÃ¡ch biá»‡t constructor body khá»i prototype source â€” tÃ­nh nÄƒng quan trá»ng cho subclassing built-ins (`class MyArray extends Array`).
3. `new.target` detection cÃ³ thá»ƒ polyfill báº±ng `instanceof`, nhÆ°ng ES6 `new.target` chÃ­nh xÃ¡c hÆ¡n (hoáº¡t Ä‘á»™ng Ä‘Ãºng cáº£ khi prototype bá»‹ modify).
4. Return value check trong spec sá»­ dá»¥ng `Type()` abstract operation, phÃ¢n biá»‡t `null` (type Null) khá»i objects â€” giáº£i thÃ­ch táº¡i sao `return null` bá»‹ ignore dÃ¹ `typeof null === "object"`.

---

#### Pattern 6: Contextual History â€” Object Creation Qua CÃ¡c Thá»i Ká»³

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Lá»‹ch sá»­ object creation trong JavaScript pháº£n Ã¡nh sá»± trÆ°á»Ÿng thÃ nh cá»§a cáº£ ngÃ´n ngá»¯ láº«n community. Má»—i thá»i ká»³ giáº£i quyáº¿t váº¥n Ä‘á» cá»§a thá»i ká»³ trÆ°á»›c, nhÆ°ng cÅ©ng táº¡o ra váº¥n Ä‘á» má»›i.

**1995 â€” The Birth (Brendan Eich / Netscape):**

JavaScript ra Ä‘á»i vá»›i má»™t cÃ¡ch duy nháº¥t táº¡o objects "cÃ³ cáº¥u trÃºc": constructor function + `new`. Object literals `{}` tá»“n táº¡i nhÆ°ng khÃ´ng cÃ³ constructor logic. KhÃ´ng cÃ³ `class`, khÃ´ng cÃ³ `Object.create()`, khÃ´ng cÃ³ module system. Developer pháº£i tá»± quáº£n lÃ½ má»i thá»©.

```javascript
// 1995 â€” CÃ¡ch duy nháº¥t táº¡o "class"
function Dog(name) {
  this.name = name;
}
Dog.prototype.bark = function () {
  return "Woof!";
};
var rex = new Dog("Rex");
```

Váº¥n Ä‘á» lá»›n nháº¥t: **quÃªn `new`**. KhÃ´ng cÃ³ báº¥t ká»³ mechanism nÃ o phÃ¡t hiá»‡n hay ngÄƒn cháº·n lá»—i nÃ y. `Dog("Rex")` cháº¡y bÃ¬nh thÆ°á»ng, gÃ¡n `name` vÃ o global object, return `undefined`. Bug Ã¢m tháº§m, khÃ³ debug.

**1999 â€” ES3 (The First Standard):**

ES3 formalize `new` behavior nhÆ°ng khÃ´ng thÃªm báº¥t ká»³ safety net nÃ o. `instanceof` Ä‘Æ°á»£c standardize â€” nhÆ°ng nÃ³ dá»±a vÃ o prototype reference, nÃªn báº¥t ká»³ ai modify prototype Ä‘á»u cÃ³ thá»ƒ break `instanceof`. `for...in` duyá»‡t cáº£ inherited properties â€” gÃ¢y bugs khi iterate constructor-created objects.

Pattern phá»• biáº¿n thá»i nÃ y: **init method** thay vÃ¬ constructor logic, Ä‘á»ƒ trÃ¡nh váº¥n Ä‘á» quÃªn `new`:

```javascript
// ES3 era â€” safe construction pattern
function Widget() {
  if (!(this instanceof Widget)) {
    return new Widget();
  }
  this.init();
}
Widget.prototype.init = function () {
  this.element = document.createElement("div");
};
```

**2009 â€” ES5 (The Toolkit):**

ES5 thÃªm cÃ´ng cá»¥ máº¡nh nhÆ°ng KHÃ”NG thay Ä‘á»•i `new`:

- `Object.create(proto)` â€” táº¡o object vá»›i prototype chá»‰ Ä‘á»‹nh, **khÃ´ng cáº§n constructor**. ÄÃ¢y lÃ  alternative cho `new` mÃ  Self language developers mÆ¡ Æ°á»›c.
- `Object.defineProperty()` â€” kiá»ƒm soÃ¡t property attributes (writable, enumerable, configurable).
- `"use strict"` â€” `this` lÃ  `undefined` khi quÃªn `new` (thay vÃ¬ global), giÃºp phÃ¡t hiá»‡n bug sá»›m hÆ¡n.
- `Object.getPrototypeOf()` â€” standard way Ä‘á»c `[[Prototype]]`.

NhÆ°ng ES5 váº«n thiáº¿u: syntax káº¿ thá»«a váº«n verbose (3-4 dÃ²ng ritual), khÃ´ng cÃ³ `class` keyword, khÃ´ng cÃ³ `super()`.

```javascript
// ES5 inheritance â€” verbose ritual
function Animal(name) {
  this.name = name;
}
Animal.prototype.speak = function () {
  return this.name;
};

function Dog(name, breed) {
  Animal.call(this, name); // Steal constructor
  this.breed = breed;
}
Dog.prototype = Object.create(Animal.prototype); // Link prototype
Dog.prototype.constructor = Dog; // Fix constructor
```

**2015 â€” ES6 (The Revolution):**

ES6 thay Ä‘á»•i má»i thá»© cho `new`:

- **`class` keyword**: Syntactic sugar cho constructor + prototype, nhÆ°ng vá»›i safety net tá»± Ä‘á»™ng â€” gá»i `Class()` thiáº¿u `new` â†’ `TypeError`.
- **`extends` + `super()`**: Clean inheritance syntax, thay tháº¿ ES5 ritual.
- **`new.target`**: Meta-property cho phÃ©p function biáº¿t nÃ³ cÃ³ Ä‘ang Ä‘Æ°á»£c gá»i vá»›i `new` khÃ´ng.
- **Arrow functions**: KhÃ´ng cÃ³ `[[Construct]]` â€” rÃµ rÃ ng phÃ¢n biá»‡t "function" vÃ  "constructor".
- **`Reflect.construct()`**: API cho meta-programming, tÃ¡ch biá»‡t constructor body khá»i prototype source.

```javascript
// ES6 â€” clean, safe, expressive
class Animal {
  constructor(name) {
    this.name = name;
  }
  speak() {
    return this.name;
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    super(name); // Base class táº¡o object
    this.breed = breed;
  }
  bark() {
    return "Woof!";
  }
}
```

**2020â€“2024 â€” Modern Era:**

- **`#private` fields (ES2022)**: True encapsulation â€” properties khÃ´ng accessible tá»« bÃªn ngoÃ i, ká»ƒ cáº£ qua prototype.
- **`static {}` blocks (ES2022)**: Class static initialization â€” cho phÃ©p complex setup logic trong class definition.
- **Decorators (Stage 3)**: Meta-programming cho class methods vÃ  fields.
- **`using` keyword (ES2024)**: Explicit Resource Management â€” `Symbol.dispose` tÆ°Æ¡ng tÃ¡c vá»›i constructors Ä‘á»ƒ enable RAII pattern tá»« C++.

```javascript
// Modern â€” 2024 style
class DatabaseConnection {
  #connection;

  constructor(url) {
    this.#connection = connect(url);
  }

  [Symbol.dispose]() {
    this.#connection.close(); // Auto-cleanup
  }

  static async create(url) {
    const conn = new DatabaseConnection(url);
    await conn.#connection.ready();
    return conn;
  }
}

// using keyword ensures cleanup
using db = await DatabaseConnection.create("postgres://...");
// db.#connection auto-closed khi scope exit
```

**Xu hÆ°á»›ng tÆ°Æ¡ng lai:**

JavaScript Ä‘ang há»™i tá»¥ hai paradigm: **class-based construction** (cho structured code, framework integration, Web APIs) vÃ  **factory-based creation** (cho functional programming, composition, async initialization). `new` khÃ´ng biáº¿n máº¥t â€” nÃ³ evolve. `class` keyword Ä‘ang trá»Ÿ thÃ nh standard cho constructor-based objects, trong khi factory functions vÃ  hooks patterns dominate application-level code. Hiá»ƒu rÃµ cáº£ hai paradigm â€” vÃ  Ä‘áº·c biá»‡t hiá»ƒu `new` á»Ÿ má»©c spec â€” lÃ  ká»¹ nÄƒng báº¯t buá»™c cho JavaScript engineer hiá»‡n Ä‘áº¡i.

---

## 15. Event Loop â€” VÃ²ng Láº·p Sá»± Kiá»‡n

### Tá»•ng Quan: Táº¡i Sao Cáº§n Event Loop?

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Event Loop lÃ  má»™t trong nhá»¯ng khÃ¡i niá»‡m **quan trá»ng nháº¥t** vÃ  cÅ©ng **bá»‹ hiá»ƒu sai nhiá»u nháº¥t** trong JavaScript. NÃ³ khÃ´ng pháº£i lÃ  má»™t tÃ­nh nÄƒng cá»§a JavaScript language â€” nÃ³ lÃ  cÆ¡ cháº¿ cá»§a **runtime environment** (browser hoáº·c Node.js) cho phÃ©p JavaScript single-threaded xá»­ lÃ½ Ä‘Æ°á»£c cÃ¡c tÃ¡c vá»¥ báº¥t Ä‘á»“ng bá»™.

**Táº¡i sao JavaScript láº¡i single-threaded?**

Khi Brendan Eich thiáº¿t káº¿ JavaScript nÄƒm 1995, má»¥c tiÃªu lÃ  táº¡o má»™t ngÃ´n ngá»¯ Ä‘Æ¡n giáº£n cho web. Multi-threading Ä‘á»“ng nghÄ©a vá»›i shared memory, race conditions, deadlocks â€” quÃ¡ phá»©c táº¡p cho má»™t scripting language. HÆ¡n ná»¯a, JavaScript cáº§n thao tÃ¡c DOM, vÃ  náº¿u hai thread cÃ¹ng sá»­a DOM, káº¿t quáº£ sáº½ khÃ´ng thá»ƒ Ä‘oÃ¡n trÆ°á»›c. Single-threaded loáº¡i bá» hoÃ n toÃ n váº¥n Ä‘á» nÃ y.

NhÆ°ng single-threaded táº¡o ra má»™t váº¥n Ä‘á» lá»›n: **blocking**. Náº¿u má»™t network request máº¥t 3 giÃ¢y, toÃ n bá»™ UI sáº½ Ä‘Ã³ng bÄƒng 3 giÃ¢y. NgÆ°á»i dÃ¹ng khÃ´ng thá»ƒ scroll, click, hay gÃµ báº¥t cá»© gÃ¬. ÄÃ¢y lÃ  tráº£i nghiá»‡m khÃ´ng thá»ƒ cháº¥p nháº­n Ä‘Æ°á»£c.

**Event Loop lÃ  giáº£i phÃ¡p:**

Event Loop cho phÃ©p JavaScript "á»§y quyá»n" cÃ¡c tÃ¡c vá»¥ tá»‘n thá»i gian cho runtime environment (WebAPIs trong browser, libuv trong Node.js), vÃ  chá»‰ xá»­ lÃ½ káº¿t quáº£ khi call stack Ä‘Ã£ rá»—ng. MÃ´ hÃ¬nh nÃ y gá»i lÃ  **concurrency model** â€” khÃ´ng pháº£i parallelism (nhiá»u viá»‡c cÃ¹ng lÃºc), mÃ  lÃ  concurrency (quáº£n lÃ½ nhiá»u viá»‡c má»™t cÃ¡ch xen káº½).

Mental model Ä‘Æ¡n giáº£n: TÆ°á»Ÿng tÆ°á»£ng báº¡n lÃ  Ä‘áº§u báº¿p duy nháº¥t (single thread) trong nhÃ  hÃ ng. Báº¡n khÃ´ng Ä‘á»©ng chá» lÃ² nÆ°á»›ng (network request) â€” báº¡n Ä‘áº·t Ä‘á»“ vÃ o lÃ², set timer, rá»“i quay láº¡i chuáº©n bá»‹ nguyÃªn liá»‡u khÃ¡c. Khi timer kÃªu (callback), báº¡n quay láº¡i láº¥y Ä‘á»“ ra. Event Loop chÃ­nh lÃ  cÃ¡i Ä‘á»“ng há»“ háº¹n giá» Ä‘Ã³.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JAVASCRIPT LÃ€ SINGLE-THREADED                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JS chá»‰ cÃ³ Má»˜T thread thá»±c thi â†’ cháº¡y láº§n lÆ°á»£t tá»«ng task        â”‚
â”‚  Náº¿u task nÃ o cháº­m (network, timer) â†’ BLOCK toÃ n bá»™ code sau    â”‚
â”‚                                                                 â”‚
â”‚  âœ… Giáº£i phÃ¡p: ASYNCHRONOUS + EVENT LOOP                         â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Synchronous code  â†’ Call Stack (thá»±c thi ngay)            â”‚ â”‚
â”‚  â”‚  Asynchronous code â†’ Task Queue (chá» Ä‘áº¿n lÆ°á»£t)             â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  Task Queue chia thÃ nh:                                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Macro-task Queue: setTimeout, setInterval, I/O...   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  Micro-task Queue: Promise.then, MutationObserver... â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  âš¡ Micro-tasks LUÃ”N Ä‘Æ°á»£c Æ°u tiÃªn trÆ°á»›c Macro-tasks        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### MÃ´i TrÆ°á»ng Thá»±c Thi

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Má»™t hiá»ƒu láº§m phá»• biáº¿n lÃ  Event Loop náº±m trong V8 engine. **Sai.** V8 chá»‰ cÃ³ call stack vÃ  heap â€” nÃ³ khÃ´ng biáº¿t gÃ¬ vá» setTimeout, fetch, hay DOM events. Event Loop thuá»™c vá» **host environment**:

- **Browser**: Event Loop Ä‘Æ°á»£c implement bá»Ÿi browser engine (Blink trong Chrome, Gecko trong Firefox). Browser cung cáº¥p WebAPIs (setTimeout, fetch, DOM API) vÃ  quáº£n lÃ½ task queues.
- **Node.js**: Event Loop Ä‘Æ°á»£c implement bá»Ÿi **libuv** â€” má»™t thÆ° viá»‡n C++ cung cáº¥p I/O non-blocking, thread pool, vÃ  event loop cross-platform.

Äiá»ƒm khÃ¡c biá»‡t quan trá»ng: trong browser, cÃ³ **hai thread chÃ­nh** loáº¡i trá»« nhau â€” JS thread vÃ  Rendering thread. Khi JS Ä‘ang cháº¡y, rendering bá»‹ pause, vÃ  ngÆ°á»£c láº¡i. ÄÃ¢y lÃ  lÃ½ do JavaScript cháº¡y lÃ¢u gÃ¢y "jank" (giáº­t lag) trÃªn UI. Trong Node.js, khÃ´ng cÃ³ rendering thread â€” thay vÃ o Ä‘Ã³ cÃ³ libuv thread pool (máº·c Ä‘á»‹nh 4 threads) Ä‘á»ƒ xá»­ lÃ½ I/O operations náº·ng (file system, DNS, crypto).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER                          â”‚  NODE.JS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  JS Engine Thread (V8)            â”‚  JS Thread (V8)              â”‚
â”‚  Rendering Thread                 â”‚  libuv Thread Pool           â”‚
â”‚  (2 thread LOáº I TRá»ª nhau)        â”‚  (I/O non-blocking)          â”‚
â”‚                                   â”‚                              â”‚
â”‚  WebAPIs xá»­ lÃ½ async              â”‚  C++ APIs xá»­ lÃ½ async        â”‚
â”‚  (setTimeout, fetch, DOM...)      â”‚  (fs, net, crypto...)        â”‚
â”‚                                   â”‚                              â”‚
â”‚  Event Loop do BROWSER quáº£n lÃ½    â”‚  Event Loop do LIBUV quáº£n lÃ½ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Macro-tasks vs Micro-tasks

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Sá»± phÃ¢n biá»‡t macro-task vÃ  micro-task lÃ  **chÃ¬a khÃ³a** Ä‘á»ƒ giáº£i quyáº¿t má»i cÃ¢u há»i phá»ng váº¥n vá» Event Loop. Nhá»› nguyÃªn táº¯c cá»‘t lÃµi: **táº¥t cáº£ micro-tasks luÃ´n Ä‘Æ°á»£c clear háº¿t trÆ°á»›c khi báº¥t ká»³ macro-task nÃ o Ä‘Æ°á»£c xá»­ lÃ½**.

**Macro-tasks** (cÃ²n gá»i lÃ  "tasks" trong HTML spec) Ä‘áº¿n tá»« **host environment** â€” browser hoáº·c Node.js. Má»—i láº§n event loop quay, nÃ³ láº¥y **má»™t** macro-task tá»« queue. VÃ­ dá»¥: khi báº¡n gá»i `setTimeout(fn, 0)`, callback `fn` Ä‘Æ°á»£c Ä‘Æ°a vÃ o macro-task queue, vÃ  sáº½ chá»‰ cháº¡y khi call stack rá»—ng VÃ€ táº¥t cáº£ micro-tasks Ä‘Ã£ clear.

**Micro-tasks** Ä‘áº¿n tá»« **JavaScript language** â€” Promise callbacks, `queueMicrotask()`, `MutationObserver`. Sau khi má»—i task (bao gá»“m cáº£ macro-task) hoÃ n thÃ nh vÃ  call stack rá»—ng, engine sáº½ **drain toÃ n bá»™ micro-task queue** trÆ°á»›c khi lÃ m báº¥t ká»³ viá»‡c gÃ¬ khÃ¡c. Quan trá»ng: náº¿u má»™t micro-task táº¡o ra micro-task má»›i, micro-task má»›i Ä‘Ã³ cÅ©ng sáº½ Ä‘Æ°á»£c drain trong cÃ¹ng vÃ²ng â€” Ä‘Ã¢y lÃ  nguá»“n gá»‘c cá»§a **micro-task starvation** bug.

**process.nextTick** trong Node.js lÃ  trÆ°á»ng há»£p Ä‘áº·c biá»‡t: nÃ³ cÃ³ queue riÃªng, cháº¡y **trÆ°á»›c cáº£** Promise micro-tasks. ÄÃ¢y lÃ  lÃ½ do Node.js documentation khuyáº¿n cÃ¡o dÃ¹ng `queueMicrotask()` thay vÃ¬ `process.nextTick()` trong code má»›i.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHÃ‚N LOáº I TASKS                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MACRO-TASKS (TÃ¡c vá»¥ vÄ© mÃ´)                              â”‚   â”‚
â”‚  â”‚  Nguá»“n: HOST ENVIRONMENT (Browser / Node)                 â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â€¢ setTimeout / setInterval                               â”‚   â”‚
â”‚  â”‚  â€¢ setImmediate (Node.js / IE)                            â”‚   â”‚
â”‚  â”‚  â€¢ requestAnimationFrame (Browser)                        â”‚   â”‚
â”‚  â”‚  â€¢ I/O operations (AJAX, fetch, file read)                â”‚   â”‚
â”‚  â”‚  â€¢ UI rendering (Browser)                                 â”‚   â”‚
â”‚  â”‚  â€¢ MessageChannel                                         â”‚   â”‚
â”‚  â”‚  â€¢ Script (toÃ n bá»™ script tag)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MICRO-TASKS (TÃ¡c vá»¥ vi mÃ´)                               â”‚   â”‚
â”‚  â”‚  Nguá»“n: LANGUAGE (JS engine)                              â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â€¢ Promise.then / .catch / .finally                       â”‚   â”‚
â”‚  â”‚  â€¢ async/await (pháº§n sau await)                           â”‚   â”‚
â”‚  â”‚  â€¢ queueMicrotask()                                       â”‚   â”‚
â”‚  â”‚  â€¢ MutationObserver (Browser)                             â”‚   â”‚
â”‚  â”‚  â€¢ process.nextTick (Node.js â€” Æ°u tiÃªn CAO NHáº¤T)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  âš¡ Micro-tasks luÃ´n cháº¡y TRÆ¯á»šC macro-tasks trong cÃ¹ng vÃ²ng     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Browser Event Loop â€” 4 BÆ°á»›c

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Browser Event Loop tuÃ¢n theo HTML Living Standard (whatwg.org). Thuáº­t toÃ¡n chÃ­nh xÃ¡c phá»©c táº¡p, nhÆ°ng cÃ³ thá»ƒ Ä‘Æ¡n giáº£n hÃ³a thÃ nh 4 bÆ°á»›c láº·p Ä‘i láº·p láº¡i vÃ´ háº¡n.

**Step 1 â€” Execute Sync Code:** Táº¥t cáº£ synchronous code cháº¡y trÃªn call stack cho Ä‘áº¿n khi stack rá»—ng. Náº¿u gáº·p async APIs (setTimeout, fetch, Promise), chÃºng Ä‘Æ°á»£c á»§y quyá»n cho WebAPIs.

**Step 2 â€” WebAPIs Complete:** Khi async operation hoÃ n thÃ nh (timer expired, network response arrived), WebAPIs Ä‘áº©y callback vÃ o queue tÆ°Æ¡ng á»©ng â€” macro-task queue hoáº·c micro-task queue.

**Step 3 â€” Drain Micro-task Queue:** Khi call stack rá»—ng, Event Loop drain **toÃ n bá»™** micro-task queue. Má»—i micro-task cháº¡y xong cÃ³ thá»ƒ táº¡o ra micro-task má»›i â€” chÃºng cÅ©ng Ä‘Æ°á»£c drain trong cÃ¹ng vÃ²ng. Chá»‰ khi micro-task queue hoÃ n toÃ n trá»‘ng, Event Loop má»›i tiáº¿p tá»¥c.

**Step 4 â€” One Macro-task:** Event Loop láº¥y **má»™t** macro-task tá»« macro-task queue, Ä‘áº©y vÃ o call stack thá»±c thi. Sau khi macro-task hoÃ n thÃ nh, quay láº¡i Step 3 (drain micro-tasks). Rá»“i láº¥y macro-task tiáº¿p theo. Láº·p láº¡i.

Äiá»ƒm tinh táº¿: giá»¯a Step 3 vÃ  Step 4, browser cÃ³ thá»ƒ thá»±c hiá»‡n **rendering** (repaint, reflow). ÄÃ¢y lÃ  lÃ½ do `requestAnimationFrame` callback cháº¡y trÆ°á»›c rendering, cho phÃ©p báº¡n update DOM má»™t cÃ¡ch tá»‘i Æ°u.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER EVENT LOOP â€” 4 STEPS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Call      â”‚    â”‚ WebAPIs  â”‚    â”‚ Macro-task Queue           â”‚ â”‚
â”‚  â”‚ Stack     â”‚â”€â”€â”€â–¶â”‚ setTimeoutâ”‚â”€â”€â”€â–¶â”‚ callback1, cb2, ...       â”‚ â”‚
â”‚  â”‚           â”‚    â”‚ fetch    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ fn1()     â”‚    â”‚ DOM eventâ”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ fn2()     â”‚    â”‚ ...      â”‚â”€â”€â”€â–¶â”‚ Micro-task Queue           â”‚ â”‚
â”‚  â”‚ global()  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ promise.then, mutation... â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â–²                                      â”‚                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                    Event Loop                                    â”‚
â”‚                                                                 â”‚
â”‚  STEP 1: Thá»±c thi code trong Call Stack (synchronous)            â”‚
â”‚          Gáº·p async â†’ Ä‘áº©y cho WebAPIs xá»­ lÃ½                      â”‚
â”‚          Cháº¡y Ä‘áº¿n khi Stack Rá»–NG                                 â”‚
â”‚                                                                 â”‚
â”‚  STEP 2: WebAPIs hoÃ n thÃ nh â†’ Ä‘áº©y callback vÃ o Queue            â”‚
â”‚          Micro-task â†’ Micro-task Queue                           â”‚
â”‚          Macro-task â†’ Macro-task Queue                           â”‚
â”‚                                                                 â”‚
â”‚  STEP 3: Stack rá»—ng â†’ Event Loop CLEAR toÃ n bá»™ Micro-task Queue â”‚
â”‚          (cháº¡y Háº¾T micro-tasks, ká»ƒ cáº£ micro sinh ra micro)      â”‚
â”‚                                                                 â”‚
â”‚  STEP 4: Láº¥y 1 macro-task tá»« Queue â†’ Ä‘áº©y vÃ o Stack thá»±c thi     â”‚
â”‚          Sau khi xong â†’ quay láº¡i Step 3 (clear micro-tasks)      â”‚
â”‚          Láº·p Step 3-4 cho Ä‘áº¿n khi cáº£ 2 Queue Rá»–NG               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VÃ­ Dá»¥ Thá»±c Táº¿ â€” Browser

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Kháº£ nÄƒng Ä‘á»c code vÃ  dá»± Ä‘oÃ¡n chÃ­nh xÃ¡c thá»© tá»± output lÃ  ká»¹ nÄƒng báº¯t buá»™c trong phá»ng váº¥n JavaScript. Má»—i vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y minh há»a má»™t khÃ­a cáº¡nh cá»§a Event Loop â€” tá»« cÆ¡ báº£n Ä‘áº¿n phá»©c táº¡p.

**CÃ¡ch tiáº¿p cáº­n há»‡ thá»‘ng:** Khi gáº·p bÃ i toÃ¡n Event Loop, hÃ£y chia code thÃ nh 3 nhÃ³m: (1) Synchronous â€” cháº¡y ngay, (2) Micro-tasks â€” xáº¿p hÃ ng trong micro-queue, (3) Macro-tasks â€” xáº¿p hÃ ng trong macro-queue. Cháº¡y háº¿t sync â†’ drain háº¿t micro â†’ 1 macro â†’ drain háº¿t micro â†’ láº·p láº¡i.

VÃ­ dá»¥ 4 ("Phá»ng váº¥n kinh Ä‘iá»ƒn") lÃ  pattern thÆ°á»ng gáº·p nháº¥t: macro-task táº¡o micro-task, micro-task táº¡o macro-task. ChÃ¬a khÃ³a: má»—i láº§n event loop quay, báº¡n cáº§n **cáº­p nháº­t láº¡i tráº¡ng thÃ¡i** cá»§a cáº£ hai queue. Váº½ timeline trÃªn giáº¥y náº¿u cáº§n â€” Ä‘Ã¢y khÃ´ng pháº£i lÃºc Ä‘á»ƒ "Ä‘oÃ¡n" báº±ng trá»±c giÃ¡c.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ Dá»¤ 1: Thá»© tá»± thá»±c thi cÆ¡ báº£n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("1 - sync"); // â‘  Sync â†’ Stack

setTimeout(() => {
  console.log("2 - macro"); // â‘£ Macro-task
}, 0);

Promise.resolve().then(() => {
  console.log("3 - micro"); // â‘¢ Micro-task
});

console.log("4 - sync"); // â‘¡ Sync â†’ Stack

// Output: 1 - sync â†’ 4 - sync â†’ 3 - micro â†’ 2 - macro
//         â”€â”€syncâ”€â”€   â”€â”€syncâ”€â”€   â”€â”€microâ”€â”€    â”€â”€macroâ”€â”€

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ Dá»¤ 2: Micro-task sinh ra micro-task
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("start");

setTimeout(() => console.log("timeout"), 0); // Macro

Promise.resolve()
  .then(() => {
    console.log("promise 1"); // Micro 1
    return Promise.resolve();
  })
  .then(() => {
    console.log("promise 2"); // Micro 2
  });

console.log("end");

// Output: start â†’ end â†’ promise 1 â†’ promise 2 â†’ timeout
// Táº¥t cáº£ micro-tasks clear Háº¾T trÆ°á»›c khi cháº¡y macro-task

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ Dá»¤ 3: async/await (micro-task)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function asyncFn() {
  console.log("async start"); // â‘¡ Sync (trÆ°á»›c await)
  await Promise.resolve();
  console.log("async after await"); // â‘£ Micro-task (sau await)
}

console.log("script start"); // â‘  Sync
asyncFn();
console.log("script end"); // â‘¢ Sync

// Output: script start â†’ async start â†’ script end â†’ async after await
// await táº¡m dá»«ng function, pháº§n sau await = micro-task

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ Dá»¤ 4: Phá»ng váº¥n KINH ÄIá»‚N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("1");

setTimeout(() => {
  console.log("2");
  Promise.resolve().then(() => console.log("3"));
}, 0);

Promise.resolve().then(() => {
  console.log("4");
  setTimeout(() => console.log("5"), 0);
});

console.log("6");

// Output: 1 â†’ 6 â†’ 4 â†’ 2 â†’ 3 â†’ 5
// Giáº£i thÃ­ch:
// Round 0: Stack cháº¡y sync â†’ log 1, 6
// Round 0: Clear micro-tasks â†’ log 4 (+ schedule setTimeout "5")
// Round 1: 1 macro-task â†’ log 2 (+ schedule micro "3")
// Round 1: Clear micro-tasks â†’ log 3
// Round 2: 1 macro-task â†’ log 5
```

### Node.js Event Loop â€” 6 Phases

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Node.js Event Loop phá»©c táº¡p hÆ¡n browser Ä‘Ã¡ng ká»ƒ vÃ¬ nÃ³ pháº£i xá»­ lÃ½ I/O á»Ÿ má»©c há»‡ Ä‘iá»u hÃ nh. ÄÆ°á»£c implement bá»Ÿi **libuv** (viáº¿t báº±ng C), Event Loop trong Node.js chia thÃ nh **6 phases**, má»—i phase cÃ³ FIFO queue riÃªng.

**Phase 1 â€” timers:** Thá»±c thi callbacks cá»§a `setTimeout()` vÃ  `setInterval()` Ä‘Ã£ "expired". LÆ°u Ã½: timer khÃ´ng Ä‘áº£m báº£o thá»i gian chÃ­nh xÃ¡c â€” nÃ³ chá»‰ Ä‘áº£m báº£o callback **khÃ´ng cháº¡y TRÆ¯á»šC** thá»i gian Ä‘Ã£ set. Náº¿u poll phase Ä‘ang báº­n, timer cÃ³ thá»ƒ bá»‹ delay.

**Phase 2 â€” pending callbacks:** Thá»±c thi cÃ¡c I/O callbacks bá»‹ deferred tá»« vÃ²ng loop trÆ°á»›c. VÃ­ dá»¥: náº¿u TCP socket nháº­n lá»—i `ECONNREFUSED`, callback lá»—i sáº½ Ä‘Æ°á»£c queue á»Ÿ Ä‘Ã¢y.

**Phase 3 â€” idle, prepare:** Internal use only â€” libuv dÃ¹ng cho housekeeping. Developer khÃ´ng tÆ°Æ¡ng tÃ¡c trá»±c tiáº¿p.

**Phase 4 â€” poll:** ÄÃ¢y lÃ  phase **quan trá»ng nháº¥t**. NÃ³ thá»±c hiá»‡n 2 viá»‡c: (a) tÃ­nh toÃ¡n thá»i gian nÃªn block vÃ  poll cho I/O, (b) xá»­ lÃ½ events trong poll queue. Náº¿u poll queue trá»‘ng, Event Loop sáº½ kiá»ƒm tra xem cÃ³ `setImmediate()` callbacks khÃ´ng â€” náº¿u cÃ³, chuyá»ƒn sang check phase. Náº¿u khÃ´ng, nÃ³ sáº½ **wait** cho callbacks (tá»« incoming connections, data, v.v.).

**Phase 5 â€” check:** DÃ nh riÃªng cho `setImmediate()` callbacks. `setImmediate()` khÃ¡c `setTimeout(fn, 0)` á»Ÿ chá»— nÃ³ luÃ´n cháº¡y **sau** poll phase, báº¥t ká»ƒ timing.

**Phase 6 â€” close callbacks:** Xá»­ lÃ½ close events, vÃ­ dá»¥ `socket.on('close', ...)`. KhÃ´ng thÆ°á»ng xuyÃªn sá»­ dá»¥ng trá»±c tiáº¿p.

**Giá»¯a má»—i phase:** Node.js kiá»ƒm tra `process.nextTick()` queue vÃ  Promise micro-task queue. `nextTick` luÃ´n Æ°u tiÃªn hÆ¡n Promise. ÄÃ¢y lÃ  lÃ½ do `nextTick` cÃ³ thá»ƒ gÃ¢y starvation â€” náº¿u báº¡n Ä‘á»‡ quy gá»i `nextTick`, Event Loop sáº½ **khÃ´ng bao giá»** chuyá»ƒn sang phase tiáº¿p theo.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE.JS EVENT LOOP â€” 6 PHASES (libuv)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚   â”‚  1. timers                        â”‚                 â”‚    â”‚
â”‚  â”‚   â”‚  setTimeout / setInterval         â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â–¼                                         â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚   â”‚  2. pending callbacks             â”‚                 â”‚    â”‚
â”‚  â”‚   â”‚  I/O callbacks deferred           â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â–¼                                         â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚   â”‚  3. idle, prepare                 â”‚                 â”‚    â”‚
â”‚  â”‚   â”‚  Internal use only                â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â–¼                           incoming:     â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  connections,   â”‚    â”‚
â”‚  â”‚   â”‚  4. poll (è½®è¯¢)                    â”‚â—€â”€â”€ data, etc.  â”‚    â”‚
â”‚  â”‚   â”‚  Retrieve I/O events, exec I/O cb â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â–¼                                         â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚   â”‚  5. check                         â”‚                 â”‚    â”‚
â”‚  â”‚   â”‚  setImmediate callbacks           â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â–¼                                         â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚    â”‚
â”‚  â”‚   â”‚  6. close callbacks               â”‚                 â”‚    â”‚
â”‚  â”‚   â”‚  socket.on('close', ...)          â”‚                 â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚    â”‚
â”‚  â”‚               â”‚                                         â”‚    â”‚
â”‚  â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ loop â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”‚                                                              â”‚
â”‚  â”‚  âš¡ process.nextTick + Promise.then cháº¡y GIá»®A má»—i phase     â”‚
â”‚  â”‚     (nextTick Æ°u tiÃªn hÆ¡n Promise.then)                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Node.js: process.nextTick vs setImmediate
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setImmediate(() => console.log("setImmediate")); // check phase
setTimeout(() => console.log("setTimeout"), 0); // timers phase
process.nextTick(() => console.log("nextTick")); // giá»¯a phases
Promise.resolve().then(() => console.log("promise")); // giá»¯a phases

// Output (thÆ°á»ng): nextTick â†’ promise â†’ setTimeout â†’ setImmediate
// nextTick luÃ´n cháº¡y TRÆ¯á»šC promise.then
// setTimeout vs setImmediate thá»© tá»± cÃ³ thá»ƒ thay Ä‘á»•i tÃ¹y timing
```

### Browser vs Node.js â€” So SÃ¡nh

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Hiá»ƒu sá»± khÃ¡c biá»‡t giá»¯a Browser vÃ  Node.js Event Loop giÃºp báº¡n trÃ¡nh nhá»¯ng bug tinh vi khi code cháº¡y trÃªn cáº£ hai mÃ´i trÆ°á»ng (vÃ­ dá»¥: isomorphic/universal JavaScript).

**KhÃ¡c biá»‡t cá»‘t lÃµi â€” granularity:** Browser Event Loop Ä‘Æ¡n giáº£n hÆ¡n: sau **má»—i macro-task**, drain ALL micro-tasks, rá»“i cÃ³ thá»ƒ render. Node.js phá»©c táº¡p hÆ¡n: Event Loop chia thÃ nh 6 phases, vÃ  micro-tasks Ä‘Æ°á»£c drain **giá»¯a má»—i phase** (khÃ´ng pháº£i giá»¯a má»—i task).

**Há»‡ quáº£ thá»±c táº¿:** Trong Node.js 10 trá»Ÿ vá» trÆ°á»›c, náº¿u cÃ³ 3 `setTimeout` callbacks, chÃºng cÃ³ thá»ƒ cháº¡y liÃªn tiáº¿p **trÆ°á»›c khi** micro-tasks Ä‘Æ°á»£c drain. Tá»« Node.js 11+, hÃ nh vi Ä‘Ã£ Ä‘Æ°á»£c thá»‘ng nháº¥t vá»›i browser â€” micro-tasks Ä‘Æ°á»£c drain sau **má»—i** macro-task.

**APIs riÃªng biá»‡t:** `setImmediate` chá»‰ cÃ³ trong Node.js (vÃ  IE Ä‘Ã£ deprecated). `process.nextTick` chá»‰ cÃ³ trong Node.js. `requestAnimationFrame` chá»‰ cÃ³ trong browser. `queueMicrotask()` lÃ  API cross-platform duy nháº¥t cho micro-tasks (ES2020).

**setTimeout vs setImmediate trong Node.js:** Náº¿u gá»i cáº£ hai tá»« main module, thá»© tá»± **khÃ´ng xÃ¡c Ä‘á»‹nh** vÃ¬ phá»¥ thuá»™c vÃ o process performance. NhÆ°ng náº¿u gá»i trong I/O callback, `setImmediate` **luÃ´n** cháº¡y trÆ°á»›c `setTimeout` vÃ¬ check phase Ä‘áº¿n sau poll phase.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER vs NODE.JS EVENT LOOP                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Browser                      â”‚  Node.js                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 macro â†’ clear ALL micro    â”‚  Má»—i phase â†’ clear ALL micro    â”‚
â”‚  â†’ 1 macro â†’ clear ALL micro  â”‚  â†’ next phase â†’ clear ALL micro â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebAPIs quáº£n lÃ½ async        â”‚  libuv + C++ APIs quáº£n lÃ½ async  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  KhÃ´ng cÃ³ setImmediate        â”‚  setImmediate (check phase)      â”‚
â”‚  (chá»‰ IE há»— trá»£)             â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  KhÃ´ng cÃ³ process.nextTick    â”‚  process.nextTick (Æ°u tiÃªn nháº¥t) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  requestAnimationFrame        â”‚  KhÃ´ng cÃ³ rAF                    â”‚
â”‚  (trÆ°á»›c má»—i repaint)         â”‚                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Rendering giá»¯a cÃ¡c frame  â”‚  KhÃ´ng cÃ³ UI rendering           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common Gotchas

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Event Loop bugs thuá»™c loáº¡i khÃ³ debug nháº¥t vÃ¬ chÃºng liÃªn quan Ä‘áº¿n **timing** â€” code Ä‘Ãºng logic nhÆ°ng sai thá»© tá»±. DÆ°á»›i Ä‘Ã¢y lÃ  3 gotchas kinh Ä‘iá»ƒn mÃ  cáº£ developer kinh nghiá»‡m cÅ©ng máº¯c pháº£i.

**Gotcha 1 â€” `setTimeout(fn, 0)` khÃ´ng pháº£i "cháº¡y ngay":** ÄÃ¢y lÃ  hiá»ƒu láº§m #1. `setTimeout(fn, 0)` cÃ³ nghÄ©a "Ä‘Æ°a fn vÃ o macro-task queue ngay khi cÃ³ thá»ƒ" â€” nhÆ°ng fn chá»‰ cháº¡y **sau khi** (a) call stack rá»—ng VÃ€ (b) táº¥t cáº£ micro-tasks Ä‘Ã£ drain. HTML spec cÃ²n quy Ä‘á»‹nh minimum delay lÃ  4ms cho nested setTimeout (sau láº§n gá»i thá»© 5). Trong thá»±c táº¿, delay tá»‘i thiá»ƒu ~1ms (Node.js) Ä‘áº¿n ~4ms (browser).

**Gotcha 2 â€” Micro-task starvation:** Náº¿u micro-task táº¡o ra micro-task liÃªn tá»¥c (vÃ­ dá»¥: `Promise.resolve().then(recursiveFunction)`), Event Loop **khÃ´ng bao giá»** chuyá»ƒn sang macro-task. Há»‡ quáº£: `setTimeout` callbacks khÃ´ng fire, UI Ä‘Ã³ng bÄƒng, `setImmediate` (Node.js) bá»‹ block. TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i infinite loop á»Ÿ má»©c async. TÆ°Æ¡ng tá»± vá»›i `process.nextTick` trong Node.js â€” Node.js docs chÃ­nh thá»©c cáº£nh bÃ¡o vá» váº¥n Ä‘á» nÃ y.

**Gotcha 3 â€” `async/await` che giáº¥u micro-task boundaries:** Code sau `await` biáº¿n thÃ nh micro-task, nhÆ°ng vÃ¬ syntax giá»‘ng synchronous, developer dá»… quÃªn. Má»—i `await` táº¡o **má»™t** micro-task boundary â€” vá»›i nhiá»u `await` liÃªn tiáº¿p trong function, code bá»‹ "interleave" vá»›i code khÃ¡c giá»¯a cÃ¡c await. ÄÃ¢y lÃ  lÃ½ do output cÃ³ thá»ƒ khÃ¡c xa trá»±c giÃ¡c.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: setTimeout(fn, 0) KHÃ”NG pháº£i "cháº¡y ngay"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setTimeout(() => console.log("timeout"), 0);
console.log("sync");

// Output: sync â†’ timeout
// setTimeout(fn, 0) nghÄ©a lÃ : Ä‘Æ°a vÃ o macro-queue SAU KHI stack rá»—ng
// Minimum delay thá»±c táº¿: ~4ms (browser), ~1ms (Node.js)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: Micro-task starvation (vÃ²ng láº·p vÃ´ háº¡n micro)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âš ï¸ Äá»ªng lÃ m Ä‘iá»u nÃ y!
function infiniteMicro() {
  Promise.resolve().then(infiniteMicro); // Micro sinh micro LIÃŠN Tá»¤C
}
// infiniteMicro();
// â†’ Stack KHÃ”NG BAO GIá»œ rá»—ng â†’ Macro-tasks KHÃ”NG BAO GIá»œ cháº¡y
// â†’ UI Ä‘Ã³ng bÄƒng, setTimeout khÃ´ng bao giá» fire

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: async/await áº©n micro-task
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Má»—i `await` = 1 micro-task boundary
async function example() {
  console.log("A"); // sync
  await 1; // táº¡o micro-task
  console.log("B"); // micro-task 1
  await 2; // táº¡o micro-task
  console.log("C"); // micro-task 2
}
```

### Tá»•ng Há»£p: Event Loop

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**

Event Loop lÃ  cÆ¡ cháº¿ cho phÃ©p JavaScript â€” má»™t ngÃ´n ngá»¯ single-threaded â€” xá»­ lÃ½ concurrency. Hiá»ƒu Event Loop khÃ´ng chá»‰ giÃºp báº¡n vÆ°á»£t qua phá»ng váº¥n, mÃ  cÃ²n giÃºp viáº¿t code **performant** vÃ  **bug-free**.

**6 Ä‘iá»u cáº§n nhá»›:**

1. **Event Loop khÃ´ng pháº£i cá»§a JS:** NÃ³ thuá»™c vá» runtime (browser/libuv). V8 chá»‰ cÃ³ call stack + heap.
2. **Micro-tasks Æ°u tiÃªn hÆ¡n Macro-tasks:** Sau má»—i task, drain ALL micro trÆ°á»›c khi láº¥y macro tiáº¿p.
3. **`setTimeout(fn, 0)` â‰  cháº¡y ngay:** Minimum delay ~4ms browser, ~1ms Node.js.
4. **Micro-task starvation lÃ  cÃ³ tháº­t:** Äá»‡ quy micro â†’ block macro vÄ©nh viá»…n.
5. **Node.js phá»©c táº¡p hÆ¡n browser:** 6 phases + nextTick queue riÃªng.
6. **`async/await` = micro-tasks áº©n:** Má»—i `await` = 1 micro-task boundary.

**Khi nÃ o cáº§n quan tÃ¢m Event Loop:**

- Debug race conditions trong async code
- Tá»‘i Æ°u performance (trÃ¡nh long-running sync code block UI)
- Hiá»ƒu táº¡i sao `setTimeout` callback cháº¡y "muá»™n hÆ¡n" expected
- Thiáº¿t káº¿ batching strategy (vÃ­ dá»¥: Vue.js `nextTick`, React `setState` batching)
- Xá»­ lÃ½ real-time data (WebSocket, Server-Sent Events)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT LOOP â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JS = Single-threaded â†’ Event Loop giáº£i quyáº¿t async              â”‚
â”‚                                                                 â”‚
â”‚  Thá»© tá»±: Sync â†’ ALL Micro-tasks â†’ 1 Macro-task â†’ ALL Micro â†’ â†º â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Macro-tasks   â”‚  setTimeout, setInterval, I/O, rAF   â”‚      â”‚
â”‚  â”‚  (host env)    â”‚  setImmediate (Node), UI rendering    â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  Micro-tasks   â”‚  Promise.then, async/await, nextTick  â”‚      â”‚
â”‚  â”‚  (JS engine)   â”‚  queueMicrotask, MutationObserver     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Micro-tasks LUÃ”N clear háº¿t trÆ°á»›c khi cháº¡y macro tiáº¿p theo    â”‚
â”‚  âš ï¸ setTimeout(fn, 0) â‰  cháº¡y ngay (min ~4ms browser)            â”‚
â”‚  âš ï¸ Micro starvation: micro sinh micro â†’ block macro vÄ©nh viá»…n   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 16. setTimeout vs Promise vs Async/Await

### Tá»•ng Quan: 3 CÆ¡ Cháº¿ Báº¥t Äá»“ng Bá»™

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> Náº¿u Event Loop lÃ  "trÃ¡i tim" cá»§a JavaScript báº¥t Ä‘á»“ng bá»™, thÃ¬ `setTimeout`, `Promise`, vÃ  `async/await` chÃ­nh lÃ  ba "nhá»‹p Ä‘áº­p" khÃ¡c nhau mÃ  láº­p trÃ¬nh viÃªn cáº§n phÃ¢n biá»‡t rÃµ rÃ ng. Ba cÆ¡ cháº¿ nÃ y Ä‘á»u phá»¥c vá»¥ má»¥c tiÃªu xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™, nhÆ°ng chÃºng hoáº¡t Ä‘á»™ng á»Ÿ nhá»¯ng táº§ng khÃ¡c nhau trong há»‡ thá»‘ng task queue, dáº«n Ä‘áº¿n thá»© tá»± thá»±c thi hoÃ n toÃ n khÃ¡c biá»‡t â€” vÃ  Ä‘Ã¢y chÃ­nh lÃ  nguá»“n gá»‘c cá»§a vÃ´ sá»‘ bug khÃ³ hiá»ƒu cÅ©ng nhÆ° cÃ¢u há»i phá»ng váº¥n "kinh Ä‘iá»ƒn".
>
> **Táº¡i sao pháº£i phÃ¢n biá»‡t?** Trong má»™t á»©ng dá»¥ng thá»±c táº¿, báº¡n thÆ°á»ng káº¿t há»£p cáº£ ba cÆ¡ cháº¿: `setTimeout` Ä‘á»ƒ debounce/throttle, `Promise` Ä‘á»ƒ xá»­ lÃ½ API calls, vÃ  `async/await` Ä‘á»ƒ viáº¿t logic tuáº§n tá»± dá»… Ä‘á»c. Náº¿u khÃ´ng hiá»ƒu rÃµ thá»© tá»± Æ°u tiÃªn â€” **Sync > Micro-tasks (Promise/.then, await) > Macro-tasks (setTimeout)** â€” báº¡n sáº½ gáº·p race conditions, UI flickering, hoáº·c state inconsistency mÃ  ráº¥t khÃ³ debug.
>
> **Lá»‹ch sá»­ tiáº¿n hÃ³a:** JavaScript ban Ä‘áº§u chá»‰ cÃ³ callbacks (setTimeout, XMLHttpRequest). Khi á»©ng dá»¥ng web ngÃ y cÃ ng phá»©c táº¡p, "Callback Hell" trá»Ÿ thÃ nh váº¥n Ä‘á» nghiÃªm trá»ng â€” code lá»“ng nhau sÃ¢u, khÃ³ Ä‘á»c, khÃ³ xá»­ lÃ½ lá»—i. ES2015 giá»›i thiá»‡u `Promise` Ä‘á»ƒ chuáº©n hÃ³a async flow vá»›i `.then()` chaining vÃ  `.catch()` táº­p trung. ES2017 tiáº¿p tá»¥c cáº£i thiá»‡n developer experience vá»›i `async/await` â€” syntax sugar cho Promise giÃºp viáº¿t code async trÃ´ng giá»‘ng sync. Tuy nhiÃªn, dÃ¹ syntax khÃ¡c nhau, **báº£n cháº¥t queue priority khÃ´ng thay Ä‘á»•i**: Promise callbacks vÃ  `await` continuations Ä‘á»u vÃ o micro-task queue, trong khi `setTimeout` callbacks vÃ o macro-task queue. Hiá»ƒu rÃµ Ä‘iá»u nÃ y lÃ  chÃ¬a khÃ³a Ä‘á»ƒ master JavaScript báº¥t Ä‘á»“ng bá»™.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  setTimeout vs Promise vs async/await                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  CÆ¡ cháº¿        â”‚  Queue     â”‚  Äáº·c Ä‘iá»ƒm                    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  setTimeout    â”‚  MACRO     â”‚  Callback vÃ o macro-queue    â”‚ â”‚
â”‚  â”‚                â”‚            â”‚  Cháº¡y SAU micro-tasks        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  Promise       â”‚  MICRO     â”‚  Executor cháº¡y Äá»’NG Bá»˜      â”‚ â”‚
â”‚  â”‚                â”‚            â”‚  .then/.catch vÃ o micro-queueâ”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚  async/await   â”‚  MICRO     â”‚  Code trÆ°á»›c await = Äá»’NG Bá»˜ â”‚ â”‚
â”‚  â”‚                â”‚            â”‚  Code sau await = micro-task  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  Thá»© tá»± Æ°u tiÃªn: Sync > Micro (Promise/await) > Macro (setTimeout)â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. setTimeout â€” Macro-task

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> `setTimeout` lÃ  má»™t trong nhá»¯ng API báº¥t Ä‘á»“ng bá»™ lÃ¢u Ä‘á»i nháº¥t cá»§a JavaScript, cÃ³ máº·t tá»« nhá»¯ng ngÃ y Ä‘áº§u tiÃªn cá»§a Netscape Navigator. Vá» báº£n cháº¥t, khi báº¡n gá»i `setTimeout(callback, delay)`, báº¡n Ä‘ang yÃªu cáº§u Web API (hoáº·c libuv trong Node.js) Ä‘áº·t má»™t timer. Khi timer háº¿t háº¡n, callback **khÃ´ng Ä‘Æ°á»£c thá»±c thi ngay** mÃ  Ä‘Æ°á»£c Ä‘áº©y vÃ o **macro-task queue** (cÃ²n gá»i lÃ  task queue). Callback chá»‰ cháº¡y khi call stack rá»—ng VÃ€ táº¥t cáº£ micro-tasks Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ xong.
>
> **Hiá»ƒu láº§m phá»• biáº¿n nháº¥t:** `setTimeout(fn, 0)` **khÃ´ng cÃ³ nghÄ©a lÃ  cháº¡y ngay láº­p tá»©c**. NÃ³ chá»‰ cÃ³ nghÄ©a lÃ  "Ä‘áº·t vÃ o macro-task queue sá»›m nháº¥t cÃ³ thá»ƒ". Thá»±c táº¿, browsers Ã¡p Ä‘áº·t minimum delay khoáº£ng 4ms (HTML5 spec, Section 8.6), vÃ  náº¿u tab bá»‹ áº©n, delay cÃ³ thá»ƒ tÄƒng lÃªn 1000ms Ä‘á»ƒ tiáº¿t kiá»‡m tÃ i nguyÃªn. Trong Node.js, `setTimeout(fn, 0)` tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i `setTimeout(fn, 1)`. ÄÃ¢y lÃ  chi tiáº¿t nhá» nhÆ°ng áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n performance testing.
>
> **Use cases thá»±c táº¿:** `setTimeout(fn, 0)` thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ "defer" execution â€” cho phÃ©p browser hoÃ n thÃ nh rendering trÆ°á»›c khi cháº¡y heavy computation. CÃ¡c pattern phá»• biáº¿n bao gá»“m debouncing (search input), throttling (scroll events), vÃ  retry logic (exponential backoff). Tuy nhiÃªn, vá»›i sá»± xuáº¥t hiá»‡n cá»§a `requestAnimationFrame` (cho animation), `requestIdleCallback` (cho background work), vÃ  `queueMicrotask` (cho urgent async), `setTimeout` Ä‘ang dáº§n bá»‹ thay tháº¿ bá»Ÿi cÃ¡c API chuyÃªn biá»‡t hÆ¡n.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// setTimeout: callback Ä‘Æ°á»£c Ä‘áº·t vÃ o MACRO-TASK queue
// Chá»‰ thá»±c thi SAU KHI stack rá»—ng + micro-tasks clear
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("A");

setTimeout(() => {
  console.log("B - setTimeout"); // Macro-task â†’ cháº¡y cuá»‘i
}, 0);

console.log("C");

// Output: A â†’ C â†’ B - setTimeout
// DÃ¹ delay = 0, váº«n chá» sync code + micro-tasks cháº¡y xong
```

### 2. Promise â€” Sync Executor + Micro-task

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> `Promise` lÃ  má»™t trong nhá»¯ng bá»• sung quan trá»ng nháº¥t cá»§a ES2015, giáº£i quyáº¿t "Callback Hell" báº±ng cÃ¡ch cung cáº¥p má»™t abstraction chuáº©n hÃ³a cho async operations. Tuy nhiÃªn, Ä‘á»ƒ thá»±c sá»± hiá»ƒu Promise, báº¡n cáº§n náº¯m vá»¯ng má»™t Ä‘iá»ƒm mÃ  **háº§u háº¿t láº­p trÃ¬nh viÃªn bá» qua**: Promise constructor (`new Promise(executor)`) thá»±c thi executor function **Ä‘á»“ng bá»™, ngay láº­p tá»©c**. Chá»‰ cÃ³ `.then()`, `.catch()`, vÃ  `.finally()` callbacks má»›i Ä‘Æ°á»£c Ä‘áº·t vÃ o **micro-task queue**.
>
> **Táº¡i sao executor cháº¡y Ä‘á»“ng bá»™?** ÄÃ¢y lÃ  design decision cÃ³ chá»§ Ä‘Ã­ch. Executor lÃ  nÆ¡i báº¡n khá»Ÿi táº¡o async operation (gá»i API, Ä‘á»c file, etc.). Náº¿u executor cÅ©ng cháº¡y async, báº¡n sáº½ rÆ¡i vÃ o vÃ²ng láº·p vÃ´ táº­n â€” cáº§n async Ä‘á»ƒ khá»Ÿi táº¡o async. Báº±ng cÃ¡ch cháº¡y executor Ä‘á»“ng bá»™, Promise Ä‘áº£m báº£o ráº±ng async operation Ä‘Æ°á»£c khá»Ÿi táº¡o ngay khi Promise Ä‘Æ°á»£c táº¡o, vÃ  chá»‰ **káº¿t quáº£** má»›i Ä‘Æ°á»£c xá»­ lÃ½ báº¥t Ä‘á»“ng bá»™.
>
> **Micro-task priority:** Khi má»™t Promise Ä‘Æ°á»£c resolve/reject, cÃ¡c callbacks `.then()/.catch()` Ä‘Æ°á»£c Ä‘áº·t vÃ o micro-task queue â€” cÃ³ priority **cao hÆ¡n** macro-task queue. Äiá»u nÃ y cÃ³ nghÄ©a ráº±ng táº¥t cáº£ pending Promise callbacks sáº½ cháº¡y **trÆ°á»›c** báº¥t ká»³ setTimeout/setInterval callback nÃ o. ÄÃ¢y lÃ  Ä‘iá»ƒm khÃ¡c biá»‡t cá»‘t lÃµi giá»¯a Promise vÃ  setTimeout, vÃ  lÃ  nguá»“n gá»‘c cá»§a háº§u háº¿t cÃ¢u há»i phá»ng váº¥n vá» async.
>
> **resolve() khÃ´ng dá»«ng execution:** Má»™t "báº«y" phá»• biáº¿n khÃ¡c: gá»i `resolve()` hoáº·c `reject()` **khÃ´ng** giá»‘ng `return` â€” code sau `resolve()` váº«n tiáº¿p tá»¥c cháº¡y. Náº¿u báº¡n muá»‘n dá»«ng execution sau khi resolve, hÃ£y dÃ¹ng `return resolve(value)`. ÄÃ¢y lÃ  best practice Ä‘á»ƒ trÃ¡nh side effects khÃ´ng mong muá»‘n.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUAN TRá»ŒNG: Promise constructor cháº¡y Äá»’NG Bá»˜!
// Chá»‰ cÃ³ .then/.catch má»›i lÃ  micro-task (báº¥t Ä‘á»“ng bá»™)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log("script start");

let promise1 = new Promise(function (resolve) {
  console.log("promise1"); // â‘¡ SYNC â€” cháº¡y ngay trong constructor!
  resolve();
  console.log("promise1 end"); // â‘¢ SYNC â€” resolve() KHÃ”NG dá»«ng execution
}).then(function () {
  console.log("promise2"); // â‘¤ MICRO-TASK â€” chá» stack rá»—ng
});

setTimeout(function () {
  console.log("settimeout"); // â‘¥ MACRO-TASK â€” cháº¡y cuá»‘i
});

console.log("script end"); // â‘£ SYNC

// Output: script start â†’ promise1 â†’ promise1 end â†’ script end â†’ promise2 â†’ settimeout
//         â”€â”€â”€â”€ sync â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€microâ”€   â”€â”€macroâ”€â”€

// KEY INSIGHT:
// â€¢ new Promise(executor) â€” executor cháº¡y NGAY Láº¬P Tá»¨C (Ä‘á»“ng bá»™)
// â€¢ resolve() khÃ´ng dá»«ng function â€” code sau resolve() váº«n cháº¡y
// â€¢ .then() má»›i lÃ  pháº§n async â€” vÃ o micro-task queue
```

### 3. async/await â€” Micro-task (Syntax Sugar)

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> `async/await` Ä‘Æ°á»£c giá»›i thiá»‡u trong ES2017 (ES8) lÃ  má»™t bÆ°á»›c tiáº¿n lá»›n vá» developer experience. Vá» báº£n cháº¥t, `async/await` chá»‰ lÃ  **syntactic sugar** cho Promises â€” engine sáº½ transpile `async` functions thÃ nh Promise-based code. Tuy nhiÃªn, hiá»ƒu cÃ¡ch transpilation hoáº¡t Ä‘á»™ng lÃ  chÃ¬a khÃ³a Ä‘á»ƒ dá»± Ä‘oÃ¡n thá»© tá»± thá»±c thi.
>
> **TrÆ°á»›c await = Äá»“ng bá»™:** Khi báº¡n gá»i má»™t `async` function, **táº¥t cáº£ code trÆ°á»›c `await` Ä‘áº§u tiÃªn cháº¡y Ä‘á»“ng bá»™**, giá»‘ng há»‡t má»™t regular function. ÄÃ¢y lÃ  lÃ½ do táº¡i sao `async1 start` luÃ´n xuáº¥t hiá»‡n trÆ°á»›c `script end` trong cÃ¡c bÃ i phá»ng váº¥n. Nhiá»u láº­p trÃ¬nh viÃªn láº§m tÆ°á»Ÿng ráº±ng `async` function cháº¡y hoÃ n toÃ n báº¥t Ä‘á»“ng bá»™ â€” Ä‘iá»u nÃ y **sai**.
>
> **await = yield + micro-task:** Khi gáº·p `await`, hai Ä‘iá»u xáº£y ra: (1) expression bÃªn pháº£i `await` Ä‘Æ°á»£c evaluate Ä‘á»“ng bá»™ (náº¿u nÃ³ lÃ  function call, function Ä‘Ã³ cháº¡y ngay); (2) `async` function **yield** â€” tráº£ quyá»n Ä‘iá»u khiá»ƒn vá» cho caller, vÃ  pháº§n code sau `await` Ä‘Æ°á»£c wrap trong má»™t `.then()` callback Ä‘áº·t vÃ o micro-task queue. Cá»¥ thá»ƒ, `await x` tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i `Promise.resolve(x).then(result => { /* code sau await */ })`. Báº¡n cÃ³ thá»ƒ hÃ¬nh dung `await` nhÆ° má»™t "breakpoint" chia async function thÃ nh nhiá»u Ä‘oáº¡n Ä‘á»“ng bá»™, má»—i Ä‘oáº¡n cháº¡y trong má»™t micro-task riÃªng.
>
> **Implicit Promise wrapping:** `async` function luÃ´n tráº£ vá» má»™t Promise. Náº¿u báº¡n `return 42`, caller nháº­n Ä‘Æ°á»£c `Promise.resolve(42)`. Náº¿u báº¡n throw error, caller nháº­n `Promise.reject(error)`. Äiá»u nÃ y Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n â€” báº¡n luÃ´n cÃ³ thá»ƒ `.then()` hoáº·c `await` káº¿t quáº£ cá»§a `async` function.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// async/await = syntax sugar cho Promise
// Code TRÆ¯á»šC await = SYNC (cháº¡y ngay)
// Code SAU await = MICRO-TASK (chá» resolve)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function async1() {
  console.log("async1 start"); // â‘¡ SYNC â€” cháº¡y ngay khi gá»i
  await async2(); // Gáº·p await â†’ táº¡m dá»«ng async1
  console.log("async1 end"); // â‘£ MICRO-TASK â€” resume sau await
}

async function async2() {
  console.log("async2"); // â‘¢ SYNC â€” cháº¡y nhÆ° regular function
}

console.log("script start"); // â‘  SYNC
async1(); // Gá»i async function
console.log("script end"); // â‘£ SYNC (async1 Ä‘Ã£ yield)

// Output: script start â†’ async1 start â†’ async2 â†’ script end â†’ async1 end

// GIáº¢I THÃCH tá»«ng bÆ°á»›c:
// 1. "script start" â€” sync
// 2. Gá»i async1() â†’ "async1 start" â€” sync (trÆ°á»›c await)
// 3. await async2() â†’ gá»i async2() â†’ "async2" â€” sync
//    Sau Ä‘Ã³, async1 YIELD (tráº£ quyá»n) â†’ code sau await = micro-task
// 4. "script end" â€” sync (tiáº¿p tá»¥c main script)
// 5. Stack rá»—ng â†’ clear micro-tasks â†’ "async1 end"
```

### Káº¿t Há»£p Cáº£ 3 â€” BÃ i Phá»ng Váº¥n

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> BÃ i tá»•ng há»£p dÆ°á»›i Ä‘Ã¢y lÃ  dáº¡ng cÃ¢u há»i phá»ng váº¥n "kinh Ä‘iá»ƒn" táº¡i háº§u háº¿t cÃ¡c cÃ´ng ty cÃ´ng nghá»‡ lá»›n. á»¨ng viÃªn Ä‘Æ°á»£c yÃªu cáº§u dá»± Ä‘oÃ¡n output khi káº¿t há»£p cáº£ ba cÆ¡ cháº¿ báº¥t Ä‘á»“ng bá»™. Äá»ƒ giáº£i Ä‘Ãºng, báº¡n cáº§n Ã¡p dá»¥ng **quy táº¯c 3 phase**:
>
> **Phase 1 â€” Sync execution:** Cháº¡y táº¥t cáº£ code Ä‘á»“ng bá»™ theo thá»© tá»± xuáº¥t hiá»‡n. Bao gá»“m: `console.log` statements, `new Promise(executor)` (executor cháº¡y sync!), code trÆ°á»›c `await` Ä‘áº§u tiÃªn trong `async` function, vÃ  báº¥t ká»³ function call Ä‘á»“ng bá»™ nÃ o. Trong phase nÃ y, cÃ¡c callbacks Ä‘Æ°á»£c "Ä‘Äƒng kÃ½" vÃ o queue tÆ°Æ¡ng á»©ng nhÆ°ng chÆ°a cháº¡y.
>
> **Phase 2 â€” Micro-task drain:** Sau khi sync code hoÃ n táº¥t (call stack rá»—ng), engine **drain toÃ n bá»™ micro-task queue** â€” bao gá»“m `.then()` callbacks, `await` continuations, `queueMicrotask()` callbacks. **Quan trá»ng:** náº¿u má»™t micro-task táº¡o thÃªm micro-task má»›i, micro-task má»›i Ä‘Ã³ cÅ©ng Ä‘Æ°á»£c xá»­ lÃ½ trong cÃ¹ng phase, trÆ°á»›c khi chuyá»ƒn sang macro-tasks.
>
> **Phase 3 â€” Macro-task:** Láº¥y **má»™t** macro-task tá»« queue vÃ  thá»±c thi, rá»“i quay láº¡i Phase 2 (drain micro-tasks). Láº·p láº¡i cho Ä‘áº¿n khi háº¿t tasks.
>
> **Máº¹o phá»ng váº¥n:** Khi gáº·p bÃ i output ordering, hÃ£y váº½ má»™t báº£ng 3 cá»™t: Sync | Micro | Macro. Äi qua tá»«ng dÃ²ng code, phÃ¢n loáº¡i output vÃ o cá»™t tÆ°Æ¡ng á»©ng. Káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  ghÃ©p 3 cá»™t theo thá»© tá»± Sync â†’ Micro â†’ Macro.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Tá»”NG Há»¢P: setTimeout + Promise + async/await
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function async1() {
  console.log("async1 start"); // â‘¡ Sync
  await async2();
  console.log("async1 end"); // â‘¥ Micro
}

async function async2() {
  console.log("async2"); // â‘¢ Sync
}

console.log("script start"); // â‘  Sync

setTimeout(() => {
  console.log("setTimeout"); // â‘§ Macro
}, 0);

async1();

new Promise((resolve) => {
  console.log("promise1"); // â‘£ Sync (executor)
  resolve();
}).then(() => {
  console.log("promise2"); // â‘¦ Micro
});

console.log("script end"); // â‘¤ Sync

// Output:
// script start â†’ async1 start â†’ async2 â†’ promise1 â†’ script end
// â†’ async1 end â†’ promise2 â†’ setTimeout

// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚  Phase â”‚  Output                                  â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚  Sync  â”‚  script start, async1 start, async2,     â”‚
// â”‚        â”‚  promise1, script end                    â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚  Micro â”‚  async1 end, promise2                    â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚  Macro â”‚  setTimeout                              â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chuyá»ƒn Äá»•i: Promise â†” async/await

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> Má»™t trong nhá»¯ng ká»¹ nÄƒng quan trá»ng nháº¥t khi lÃ m viá»‡c vá»›i async JavaScript lÃ  kháº£ nÄƒng **chuyá»ƒn Ä‘á»•i tá»± do** giá»¯a Promise chain vÃ  async/await. Hai syntax nÃ y **hoÃ n toÃ n tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá» máº·t hÃ nh vi** â€” cÃ¹ng vÃ o micro-task queue, cÃ¹ng thá»© tá»± Æ°u tiÃªn, chá»‰ khÃ¡c vá» cÃ¡ch viáº¿t.
>
> **Khi nÃ o dÃ¹ng Promise chain?** Promise chain phÃ¹ há»£p khi báº¡n cáº§n: (1) cháº¡y nhiá»u async operations **song song** vá»›i `Promise.all()`, `Promise.allSettled()`, `Promise.race()`, hoáº·c `Promise.any()`; (2) transform data qua pipeline ngáº¯n (2-3 `.then()`); (3) táº¡o utility functions tráº£ vá» Promise mÃ  khÃ´ng cáº§n `async` keyword.
>
> **Khi nÃ o dÃ¹ng async/await?** async/await tá»a sÃ¡ng khi báº¡n cáº§n: (1) logic tuáº§n tá»± phá»©c táº¡p vá»›i nhiá»u bÆ°á»›c phá»¥ thuá»™c láº«n nhau; (2) error handling chi tiáº¿t vá»›i `try/catch` (dá»… Ä‘á»c hÆ¡n `.catch()`); (3) conditional branching dá»±a trÃªn káº¿t quáº£ async (dÃ¹ng `if/else` thay vÃ¬ nested `.then()`); (4) loops vá»›i async operations (`for...of` + `await`).
>
> **Hybrid pattern:** Trong thá»±c táº¿, code tá»‘t nháº¥t thÆ°á»ng káº¿t há»£p cáº£ hai. VÃ­ dá»¥: dÃ¹ng `Promise.all()` Ä‘á»ƒ fetch parallel data, sau Ä‘Ã³ `await` káº¿t quáº£ tá»•ng há»£p; hoáº·c `await` má»™t `Promise.race()` Ä‘á»ƒ implement timeout pattern. ÄÃ¢y lÃ  dáº¥u hiá»‡u cá»§a láº­p trÃ¬nh viÃªn senior â€” biáº¿t chá»n syntax phÃ¹ há»£p cho tá»«ng tÃ¬nh huá»‘ng.
>
> **Pitfall khi chuyá»ƒn Ä‘á»•i:** `return await promise` vs `return promise` â€” trong háº§u háº¿t trÆ°á»ng há»£p, káº¿t quáº£ giá»‘ng nhau, nhÆ°ng bÃªn trong `try/catch`, `return await` cho phÃ©p catch lá»—i cá»§a promise, cÃ²n `return` thÃ¬ khÃ´ng. ÄÃ¢y lÃ  má»™t trong nhá»¯ng sá»± khÃ¡c biá»‡t tinh táº¿ nháº¥t mÃ  nhiá»u láº­p trÃ¬nh viÃªn bá» qua.

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ™NG Má»˜T LOGIC â€” 2 cÃ¡ch viáº¿t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// --- Promise chain ---
function fetchData() {
  return fetch("/api/user")
    .then((res) => res.json())
    .then((user) => fetch(`/api/posts/${user.id}`))
    .then((res) => res.json())
    .catch((err) => console.error(err));
}

// --- async/await (dá»… Ä‘á»c hÆ¡n) ---
async function fetchData() {
  try {
    const res1 = await fetch("/api/user");
    const user = await res1.json();
    const res2 = await fetch(`/api/posts/${user.id}`);
    return await res2.json();
  } catch (err) {
    console.error(err);
  }
}

// async/await = syntactic sugar cho Promise
// CÃ¹ng vÃ o micro-task queue, cÃ¹ng thá»© tá»± Æ°u tiÃªn
```

### Tá»•ng Há»£p

> **BÃ i viáº¿t chuyÃªn sÃ¢u:**
>
> Äá»ƒ tá»•ng káº¿t Section 16, hÃ£y nhá»› ráº±ng `setTimeout`, `Promise`, vÃ  `async/await` **khÃ´ng chá»‰ lÃ  3 cÃ¡ch viáº¿t khÃ¡c nhau** â€” chÃºng Ä‘áº¡i diá»‡n cho 3 tháº¿ há»‡ async programming trong JavaScript, má»—i tháº¿ há»‡ giáº£i quyáº¿t nhá»¯ng váº¥n Ä‘á» khÃ¡c nhau:
>
> **setTimeout (ES1, 1997):** API gá»‘c cho deferred execution. Callback-based, vÃ o macro-task queue. PhÃ¹ há»£p cho timer-based operations nhÆ°ng dá»… dáº«n Ä‘áº¿n Callback Hell khi lá»“ng nhau. NgÃ y nay, vai trÃ² chÃ­nh lÃ  debounce/throttle/scheduling, khÃ´ng nÃªn dÃ¹ng cho async flow control.
>
> **Promise (ES2015):** BÆ°á»›c nháº£y vá»t â€” chuáº©n hÃ³a async flow vá»›i states (pending/fulfilled/rejected), chaining, vÃ  error propagation. Callbacks vÃ o micro-task queue (priority cao hÆ¡n setTimeout). Promise giáº£i quyáº¿t Callback Hell nhÆ°ng váº«n cÃ³ thá»ƒ táº¡o "Promise Hell" náº¿u láº¡m dá»¥ng nesting.
>
> **async/await (ES2017):** Äá»‰nh cao cá»§a developer experience â€” viáº¿t async code trÃ´ng giá»‘ng sync. Báº£n cháº¥t váº«n lÃ  Promise (micro-task), nhÆ°ng syntax rÃµ rÃ ng hÆ¡n nhiá»u. Error handling báº±ng `try/catch` thay vÃ¬ `.catch()`. ÄÃ¢y lÃ  recommended approach cho háº§u háº¿t use cases hiá»‡n Ä‘áº¡i.
>
> **Quy táº¯c vÃ ng cho phá»ng váº¥n:** Sync > Micro > Macro. Promise constructor cháº¡y sync. resolve() khÃ´ng dá»«ng executor. Code trÆ°á»›c await lÃ  sync. Náº¯m vá»¯ng 4 Ä‘iá»ƒm nÃ y, báº¡n giáº£i Ä‘Æ°á»£c 90% bÃ i output ordering.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  setTimeout vs Promise vs async/await â€” SUMMARY                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Feature     â”‚  Queue   â”‚  Key Point                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  setTimeout  â”‚  Macro   â”‚  Callback cháº¡y SAU micro-tasks  â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Promise     â”‚  Micro   â”‚  Constructor = SYNC             â”‚  â”‚
â”‚  â”‚              â”‚          â”‚  .then/.catch = MICRO-TASK       â”‚  â”‚
â”‚  â”‚              â”‚          â”‚  resolve() khÃ´ng dá»«ng executor   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  async/await â”‚  Micro   â”‚  TrÆ°á»›c await = SYNC             â”‚  â”‚
â”‚  â”‚              â”‚          â”‚  Sau await = MICRO-TASK (yield)  â”‚  â”‚
â”‚  â”‚              â”‚          â”‚  = syntactic sugar cho Promise   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš¡ Thá»© tá»±: SYNC â†’ MICRO (Promise/.then, await) â†’ MACRO (timer) â”‚
â”‚  âš ï¸ new Promise(fn) â€” fn cháº¡y SYNC, Ä‘Ã¢y lÃ  báº«y phá»ng váº¥n!       â”‚
â”‚  âš ï¸ resolve() KHÃ”NG dá»«ng code â€” statements sau váº«n cháº¡y          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 17. Promise Deep Dive â€” Xá»­ LÃ½ Báº¥t Äá»“ng Bá»™

### Tá»•ng Quan: Táº¡i Sao Cáº§n Promise?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALLBACK HELL â†’ PROMISE                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  âŒ Callback truyá»n thá»‘ng:                                       â”‚
â”‚  getFile("a.txt", function(err, data) {                          â”‚
â”‚    getFile("b.txt", function(err, data) {                        â”‚
â”‚      getFile("c.txt", function(err, data) {                      â”‚
â”‚        // Callback hell â€” kim tá»± thÃ¡p                            â”‚
â”‚      });                                                         â”‚
â”‚    });                                                           â”‚
â”‚  });                                                             â”‚
â”‚                                                                 â”‚
â”‚  âœ… Promise chuáº©n hÃ³a xá»­ lÃ½ async:                               â”‚
â”‚  getFile("a.txt")                                                â”‚
â”‚    .then(data => getFile("b.txt"))                               â”‚
â”‚    .then(data => getFile("c.txt"))                               â”‚
â”‚    .catch(err => console.error(err));                            â”‚
â”‚                                                                 â”‚
â”‚  Promise = Object Ä‘áº¡i diá»‡n cho giÃ¡ trá»‹ TÆ¯Æ NG LAI                 â”‚
â”‚  Chuáº©n hÃ³a interface cho async â†’ dá»… Ä‘á»c, dá»… xá»­ lÃ½ lá»—i          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3 Tráº¡ng ThÃ¡i Cá»§a Promise

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE STATES                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚             â”Œâ”€â”€â”€ resolve(value) â”€â”€â–¶ âœ… FULFILLED (thÃ nh cÃ´ng)    â”‚
â”‚             â”‚                       â†’ gá»i onFulfilled            â”‚
â”‚  â³ PENDING â”€â”¤                                                   â”‚
â”‚  (khá»Ÿi táº¡o) â”‚                                                    â”‚
â”‚             â””â”€â”€â”€ reject(reason) â”€â”€â–¶ âŒ REJECTED  (tháº¥t báº¡i)      â”‚
â”‚                                     â†’ gá»i onRejected             â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Má»™t khi Ä‘Ã£ chuyá»ƒn tráº¡ng thÃ¡i (settled) â†’ KHÃ”NG THá»‚ thay Ä‘á»•i â”‚
â”‚     Fulfilled â†’ Fulfilled âŒ                                      â”‚
â”‚     Fulfilled â†’ Rejected  âŒ                                      â”‚
â”‚     Rejected  â†’ Fulfilled âŒ                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Constructor & Instance Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. CONSTRUCTOR â€” táº¡o Promise
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const promise = new Promise(function (resolve, reject) {
  // Executor cháº¡y Äá»’NG Bá»˜ (ngay láº­p tá»©c)
  // ThÃ nh cÃ´ng â†’ gá»i resolve(value)
  // Tháº¥t báº¡i  â†’ gá»i reject(error)
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. .then(onFulfilled, onRejected) â€” xá»­ lÃ½ káº¿t quáº£
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

promise.then(
  (value) => {
    /* resolve â†’ cháº¡y onFulfilled */
  },
  (error) => {
    /* reject â†’ cháº¡y onRejected (optional) */
  },
);
// .then() LUÃ”N tráº£ vá» Promise má»›i â†’ cho phÃ©p chaining

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. .catch(onRejected) â€” xá»­ lÃ½ lá»—i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// .catch(fn) = .then(undefined, fn) â€” alias tiá»‡n lá»£i hÆ¡n
promise
  .then((value) => console.log(value))
  .catch((error) => console.error(error));
// Catch báº¯t lá»—i tá»« Báº¤T Ká»² .then() nÃ o phÃ­a trÃªn trong chain

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. .finally(onFinally) â€” cháº¡y DÃ™ thÃ nh cÃ´ng hay tháº¥t báº¡i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

promise
  .then((data) => processData(data))
  .catch((err) => logError(err))
  .finally(() => hideLoadingSpinner()); // LuÃ´n cháº¡y
```

### VÃ­ Dá»¥ Thá»±c Táº¿: Wrap XMLHttpRequest

```javascript
function getURL(URL) {
  return new Promise(function (resolve, reject) {
    const req = new XMLHttpRequest();
    req.open("GET", URL, true);

    req.onload = function () {
      if (req.status === 200) {
        resolve(req.responseText); // ThÃ nh cÃ´ng â†’ fulfilled
      } else {
        reject(new Error(req.statusText)); // HTTP error â†’ rejected
      }
    };

    req.onerror = function () {
      reject(new Error(req.statusText)); // Network error â†’ rejected
    };

    req.send();
  });
}

// Sá»­ dá»¥ng
getURL("https://api.example.com/data")
  .then((value) => console.log(value))
  .catch((error) => console.error(error));
```

### Promise Chaining

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Method Chain: taskA â†’ taskB â†’ taskC
// Má»—i .then() return Promise Má»šI â†’ cho phÃ©p chain tiáº¿p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Promise.resolve(1)
  .then((value) => {
    console.log(value); // 1
    return value + 1; // Return value â†’ wrap trong Promise.resolve(2)
  })
  .then((value) => {
    console.log(value); // 2
    return value + 1;
  })
  .then((value) => {
    console.log(value); // 3
  })
  .catch((error) => {
    console.error(error); // Báº¯t lá»—i tá»« Báº¤T Ká»² .then() nÃ o
  });

// Return Promise trong .then() â†’ chá» resolve
getURL("/api/user")
  .then((userJson) => {
    const user = JSON.parse(userJson);
    return getURL(`/api/posts/${user.id}`); // Return Promise â†’ chain chá»
  })
  .then((postsJson) => {
    console.log(postsJson); // Chá»‰ cháº¡y khi Promise trÃªn resolve
  })
  .catch((error) => {
    console.error(error); // Báº¯t lá»—i tá»« cáº£ 2 request
  });
```

### Static Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.all â€” CHá»œ Táº¤T Cáº¢ resolve, fail náº¿u 1 reject
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const [users, posts] = await Promise.all([
  fetch("/api/users").then((r) => r.json()),
  fetch("/api/posts").then((r) => r.json()),
]);
// Cháº¡y song song, káº¿t quáº£ ÄÃšNG THá»¨ Tá»°: [users, posts]
// âŒ Báº¥t ká»³ reject â†’ reject NGAY vá»›i lá»—i Ä‘áº§u tiÃªn

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.allSettled â€” CHá»œ Táº¤T Cáº¢, khÃ´ng bao giá» fail
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const results = await Promise.allSettled([
  fetch("/api/users"),
  fetch("/api/broken"),
]);
// [{ status: "fulfilled", value: Response },
//  { status: "rejected",  reason: Error }]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.race â€” AI SETTLED Äáº¦U TIÃŠN (resolve hoáº·c reject)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const result = await Promise.race([
  fetch("/api/data"),
  new Promise((_, reject) =>
    setTimeout(() => reject(new Error("Timeout!")), 5000),
  ),
]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.any â€” AI FULFILLED Äáº¦U TIÃŠN (chá»‰ reject náº¿u Táº¤T Cáº¢ fail)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const fastest = await Promise.any([
  fetch("https://cdn1.example.com/data"),
  fetch("https://cdn2.example.com/data"),
]);
// Chá»‰ reject náº¿u Táº¤T Cáº¢ reject â†’ AggregateError

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.resolve / Promise.reject â€” táº¡o nhanh
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const resolved = Promise.resolve(42); // Fulfilled ngay
const rejected = Promise.reject("error"); // Rejected ngay
```

### Error Handling â€” Gotchas

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: .then(onFulfilled, onRejected) vs .catch()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ onRejected trong .then KHÃ”NG báº¯t lá»—i tá»« onFulfilled cÃ¹ng level
promise.then(
  (value) => {
    throw new Error("oops!");
  },
  (error) => {
    /* KHÃ”NG báº¯t Ä‘Æ°á»£c lá»—i á»Ÿ trÃªn! */
  },
);

// âœ… .catch() báº¯t lá»—i tá»« Táº¤T Cáº¢ .then() phÃ­a trÆ°á»›c
promise
  .then((value) => {
    throw new Error("oops!");
  })
  .catch((error) => {
    /* Báº¯t Ä‘Æ°á»£c! */
  });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: Unhandled Promise Rejection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âš ï¸ Promise reject mÃ  KHÃ”NG cÃ³ .catch() â†’ warning!
Promise.reject("error"); // UnhandledPromiseRejectionWarning
// âœ… LUÃ”N thÃªm .catch() hoáº·c try/catch vá»›i async/await

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: resolve() khÃ´ng dá»«ng executor
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve) => {
  resolve("done");
  console.log("still runs!"); // â† VáºªN CHáº Y sau resolve!
});
// âœ… DÃ¹ng return resolve("done") Ä‘á»ƒ dá»«ng
```

### Tá»•ng Há»£p: Promise API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE API â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 States: Pending â†’ Fulfilled (resolve) / Rejected (reject)    â”‚
â”‚  Má»™t khi settled â†’ KHÃ”NG THá»‚ thay Ä‘á»•i                           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Instance        â”‚  MÃ´ táº£                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  .then(fn, fn?)  â”‚  Xá»­ lÃ½ fulfilled/rejected              â”‚  â”‚
â”‚  â”‚  .catch(fn)      â”‚  = .then(undefined, fn) â€” báº¯t lá»—i      â”‚  â”‚
â”‚  â”‚  .finally(fn)    â”‚  Cháº¡y dÃ¹ fulfilled hay rejected        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Static          â”‚  MÃ´ táº£                                 â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  .all()          â”‚  Chá» Táº¤T Cáº¢ â€” fail náº¿u 1 reject        â”‚  â”‚
â”‚  â”‚  .allSettled()   â”‚  Chá» Táº¤T Cáº¢ â€” khÃ´ng bao giá» fail       â”‚  â”‚
â”‚  â”‚  .race()         â”‚  Ai settled Äáº¦U TIÃŠN (resolve/reject)  â”‚  â”‚
â”‚  â”‚  .any()          â”‚  Ai fulfilled Äáº¦U TIÃŠN                 â”‚  â”‚
â”‚  â”‚  .resolve(v)     â”‚  Táº¡o fulfilled promise                 â”‚  â”‚
â”‚  â”‚  .reject(r)      â”‚  Táº¡o rejected promise                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Executor cháº¡y SYNC â€” .then/.catch má»›i lÃ  micro-task          â”‚
â”‚  âš ï¸ .catch() báº¯t lá»—i tá»« toÃ n chain â€” onRejected chá»‰ cÃ¹ng level  â”‚
â”‚  âš ï¸ LUÃ”N thÃªm .catch() Ä‘á»ƒ trÃ¡nh unhandled rejection              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 18. Async/Await Deep Dive â€” Viáº¿t Async Theo Kiá»ƒu Äá»“ng Bá»™

### Báº£n Cháº¥t: Generator + Promise = Async/Await

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASYNC/AWAIT = SELF-EXECUTING GENERATOR                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Generator function cÃ³ thá»ƒ Táº M Dá»ªNG (yield) vÃ  TIáº¾P Tá»¤C (next) â”‚
â”‚  â†’ Ã tÆ°á»Ÿng: yield Promise â†’ chá» resolve â†’ tiáº¿p tá»¥c vá»›i result   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Generator       â”‚     â”‚  Async/Await                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  function*       â”‚ â”€â”€â–¶ â”‚  async function                  â”‚  â”‚
â”‚  â”‚  yield           â”‚ â”€â”€â–¶ â”‚  await                           â”‚  â”‚
â”‚  â”‚  .next(value)    â”‚ â”€â”€â–¶ â”‚  Tá»± Ä‘á»™ng bá»Ÿi engine              â”‚  â”‚
â”‚  â”‚  Cáº§n executor    â”‚ â”€â”€â–¶ â”‚  Engine tá»± thá»±c thi              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  async/await = syntactic sugar cho generator + auto-executor     â”‚
â”‚  Code async NHÃŒN NHÆ¯ sync â†’ dá»… Ä‘á»c, dá»… debug                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Generator Function â€” Ná»n Táº£ng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Generator: function cÃ³ thá»ƒ Táº M Dá»ªNG vÃ  TIáº¾P Tá»¤C
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function* generatorFn() {
  console.log("Step 1");
  const a = yield "first yield"; // Táº¡m dá»«ng, tráº£ "first yield"

  console.log("Step 2, received:", a);
  const b = yield "second yield"; // Táº¡m dá»«ng, tráº£ "second yield"

  console.log("Step 3, received:", b);
  return "done";
}

const gen = generatorFn();

gen.next(); // { value: "first yield", done: false }  â†’ log "Step 1"
gen.next("hello"); // { value: "second yield", done: false } â†’ log "Step 2, received: hello"
gen.next("world"); // { value: "done", done: true }          â†’ log "Step 3, received: world"

// KEY: .next(value) â†’ truyá»n value VÃ€O generator lÃ m káº¿t quáº£ cá»§a yield
```

### Tá»« Generator â†’ Async/Await

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÆ¯á»šC 1: Generator + Promise (thá»§ cÃ´ng)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function* fetchUserPosts() {
  const user = yield fetch("/api/user").then((r) => r.json());
  const posts = yield fetch(`/api/posts/${user.id}`).then((r) => r.json());
  return posts;
}

// Cáº§n EXECUTOR Ä‘á»ƒ cháº¡y generator tá»± Ä‘á»™ng:
function run(generatorFn) {
  const gen = generatorFn();

  function step(value) {
    const result = gen.next(value); // Cháº¡y Ä‘áº¿n yield tiáº¿p theo
    if (result.done) return result.value; // Háº¿t â†’ tráº£ káº¿t quáº£
    // result.value lÃ  Promise â†’ chá» resolve â†’ gá»i step tiáº¿p
    return Promise.resolve(result.value).then(step);
  }

  return step();
}

run(fetchUserPosts).then((posts) => console.log(posts));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÆ¯á»šC 2: async/await (engine tá»± lÃ m táº¥t cáº£!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function fetchUserPosts() {
  const user = await fetch("/api/user").then((r) => r.json());
  const posts = await fetch(`/api/posts/${user.id}`).then((r) => r.json());
  return posts; // Tá»± wrap trong Promise.resolve(posts)
}

// KHÃ”NG Cáº¦N executor â€” engine JavaScript tá»± cháº¡y!
fetchUserPosts().then((posts) => console.log(posts));

// async/await = Generator + auto-executor + Promise
// Engine tá»± Ä‘á»™ng: gáº·p await â†’ táº¡m dá»«ng â†’ chá» resolve â†’ tiáº¿p tá»¥c
```

### So SÃ¡nh 3 CÃ¡ch Viáº¿t

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ™NG Má»˜T LOGIC â€” 3 phong cÃ¡ch
// Láº¥y user â†’ dÃ¹ng user.id láº¥y posts (sequential)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// --- 1. Callback ---
function getDataCallback(callback) {
  getUser((err, user) => {
    if (err) return callback(err);
    getPosts(user.id, (err, posts) => {
      if (err) return callback(err);
      callback(null, posts); // Callback hell!
    });
  });
}

// --- 2. Promise chain ---
function getDataPromise() {
  return getUser()
    .then((user) => getPosts(user.id))
    .then((posts) => posts)
    .catch((err) => console.error(err));
}

// --- 3. Async/Await (Ä‘á»c nhÆ° sync!) ---
async function getDataAsync() {
  try {
    const user = await getUser(); // Chá» user
    const posts = await getPosts(user.id); // Chá» posts
    return posts; // Äá»c nhÆ° sync!
  } catch (err) {
    console.error(err);
  }
}

// async/await = dá»… Ä‘á»c NHáº¤T, dá»… debug NHáº¤T
```

### Sequential vs Parallel

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ SEQUENTIAL (cháº­m) â€” má»—i await CHá»œ cÃ¡i trÆ°á»›c xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function sequential() {
  const users = await fetch("/api/users").then((r) => r.json()); // 2s
  const posts = await fetch("/api/posts").then((r) => r.json()); // 2s
  // Tá»•ng: 4s (chá» láº§n lÆ°á»£t)
  return { users, posts };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… PARALLEL (nhanh) â€” dÃ¹ng Promise.all
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function parallel() {
  const [users, posts] = await Promise.all([
    fetch("/api/users").then((r) => r.json()), // 2s â”€â”
    fetch("/api/posts").then((r) => r.json()), // 2s â”€â”¤ song song
  ]); //     â””â†’ Tá»•ng: 2s!
  return { users, posts };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… SEQUENTIAL KHI Cáº¦N â€” output trÆ°á»›c lÃ m input sau
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function dependent() {
  const user = await getUser(); // Cáº§n user trÆ°á»›c
  const posts = await getPosts(user.id); // DÃ¹ng user.id
  const comments = await getComments(posts[0].id); // DÃ¹ng posts[0].id
  return { user, posts, comments };
}
// Sequential Há»¢P LÃ vÃ¬ má»—i request PHá»¤ THUá»˜C káº¿t quáº£ trÆ°á»›c
```

### Error Handling

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. try/catch â€” phá»• biáº¿n nháº¥t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function fetchData() {
  try {
    const res = await fetch("/api/data");
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.json();
  } catch (err) {
    console.error("Fetch failed:", err);
    return null; // fallback value
  } finally {
    hideLoading(); // LuÃ´n cháº¡y
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. .catch() trÃªn tá»«ng await â€” granular error handling
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function fetchMultiple() {
  const user = await getUser().catch(() => null); // Fallback null
  const posts = await getPosts(user?.id).catch(() => []); // Fallback []
  return { user, posts };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. Helper wrapper â€” Go-style error handling
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function to(promise) {
  try {
    const data = await promise;
    return [null, data]; // [error, data]
  } catch (err) {
    return [err, null];
  }
}

// Sá»­ dá»¥ng:
const [err, user] = await to(getUser());
if (err) console.error("Failed:", err);
```

### Common Gotchas

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 1: await trong vÃ²ng láº·p â€” sequential khÃ´ng mong muá»‘n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Cháº­m â€” má»—i iteration chá» cÃ¡i trÆ°á»›c
async function slow() {
  const ids = [1, 2, 3, 4, 5];
  for (const id of ids) {
    await fetch(`/api/item/${id}`); // Sequential!
  }
}

// âœ… Nhanh â€” song song vá»›i Promise.all
async function fast() {
  const ids = [1, 2, 3, 4, 5];
  await Promise.all(ids.map((id) => fetch(`/api/item/${id}`)));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 2: forEach KHÃ”NG hoáº¡t Ä‘á»™ng vá»›i await
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ forEach khÃ´ng chá» await
[1, 2, 3].forEach(async (id) => {
  await fetch(`/api/${id}`); // Fire-and-forget!
});

// âœ… DÃ¹ng for...of cho sequential
for (const id of [1, 2, 3]) {
  await fetch(`/api/${id}`); // Sequential, Ä‘Ãºng thá»© tá»±
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHA 3: async function LUÃ”N tráº£ vá» Promise
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function getValue() {
  return 42; // = Promise.resolve(42)
}
getValue().then((v) => console.log(v)); // 42
// KHÃ”NG thá»ƒ láº¥y giÃ¡ trá»‹ sync tá»« async function
```

### Tá»•ng Há»£p

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASYNC/AWAIT â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Báº£n cháº¥t: Generator (yield/next) + Auto-executor + Promise      â”‚
â”‚  Engine tá»± Ä‘á»™ng: gáº·p await â†’ pause â†’ chá» resolve â†’ resume       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Rule              â”‚  Chi tiáº¿t                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  TrÆ°á»›c await       â”‚  Cháº¡y SYNC (Ä‘á»“ng bá»™)                 â”‚  â”‚
â”‚  â”‚  Sau await         â”‚  Micro-task (báº¥t Ä‘á»“ng bá»™)            â”‚  â”‚
â”‚  â”‚  Return value      â”‚  LuÃ´n wrap trong Promise              â”‚  â”‚
â”‚  â”‚  Error handling    â”‚  try/catch hoáº·c .catch()             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Sequential        â”‚  await a; await b; (phá»¥ thuá»™c nhau)  â”‚  â”‚
â”‚  â”‚  Parallel          â”‚  Promise.all([a, b]) (Ä‘á»™c láº­p)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ await trong loop â†’ sequential (dÃ¹ng Promise.all thay tháº¿)   â”‚
â”‚  âš ï¸ forEach + await = fire-and-forget (dÃ¹ng for...of)           â”‚
â”‚  âš ï¸ async fn luÃ´n return Promise â€” khÃ´ng láº¥y sync value Ä‘Æ°á»£c    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 19. Throttle & Debounce â€” Tá»‘i Æ¯u Hiá»‡u NÄƒng Sá»± Kiá»‡n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  THROTTLE (Tiáº¿t LÆ°u) vs DEBOUNCE (Chá»‘ng Rung)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  THROTTLE â€” Giá»›i háº¡n táº§n suáº¥t                             â”‚   â”‚
â”‚  â”‚  Gá»i Láº¦N Äáº¦U, rá»“i CHá»œ háº¿t delay má»›i cho gá»i tiáº¿p        â”‚   â”‚
â”‚  â”‚  â†’ Äáº£m báº£o fn cháº¡y Äá»€U Äáº¶N má»—i N ms                    â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Trigger: â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼ â–¼              â”‚   â”‚
â”‚  â”‚  Execute: âœ… Â· Â· Â· âœ… Â· Â· Â· âœ… Â· Â· Â· âœ… Â· Â· Â·              â”‚   â”‚
â”‚  â”‚           â†‘ delay  â†‘ delay  â†‘ delay  â†‘                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DEBOUNCE â€” Chá» ngá»«ng trigger                             â”‚   â”‚
â”‚  â”‚  Má»—i láº§n trigger â†’ RESET timer, chá»‰ cháº¡y khi NGá»ªNG       â”‚   â”‚
â”‚  â”‚  â†’ Fn chá»‰ cháº¡y 1 Láº¦N DUY NHáº¤T sau khi user dá»«ng         â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Trigger: â–¼ â–¼ â–¼ â–¼ â–¼ Â· Â· Â· Â· Â· â–¼ â–¼ â–¼ Â· Â· Â· Â·             â”‚   â”‚
â”‚  â”‚  Execute: Â· Â· Â· Â· Â· Â· Â· âœ…      Â· Â· Â· Â· Â· âœ…              â”‚   â”‚
â”‚  â”‚                     â† delay â†’          â† delay â†’          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  THROTTLE = cháº¡y Äá»€U má»—i N ms (giá»›i háº¡n táº§n suáº¥t)             â”‚
â”‚  DEBOUNCE = cháº¡y SAU KHI user NGá»ªNG (chá» á»•n Ä‘á»‹nh)              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Use Cases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KHI NÃ€O DÃ™NG GÃŒ?                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  THROTTLE                â”‚  DEBOUNCE                             â”‚
â”‚  (cáº§n pháº£n há»“i liÃªn tá»¥c) â”‚  (chá» user xong má»›i xá»­ lÃ½)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Scroll â†’ load more    â”‚  â€¢ Search input â†’ auto search         â”‚
â”‚  â€¢ Scroll â†’ navbar hide  â”‚  â€¢ Resize window â†’ re-render          â”‚
â”‚  â€¢ Mouse move â†’ tooltip  â”‚  â€¢ Email/phone â†’ validate             â”‚
â”‚  â€¢ Game â†’ key press      â”‚  â€¢ Form submit â†’ chá»‘ng click liÃªn tá»¥c â”‚
â”‚  â€¢ API rate limiting     â”‚  â€¢ Auto-save â†’ save sau khi ngá»«ng gÃµ  â”‚
â”‚  â€¢ Resize â†’ position     â”‚  â€¢ Autocomplete suggestions           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Throttle â€” Implementation

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THROTTLE CÆ  Báº¢N â€” dÃ¹ng timestamp
// Gá»i Láº¦N Äáº¦U ngay, rá»“i chá» delay má»›i cho gá»i tiáº¿p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function throttle(fn, delay) {
  let lastTime = 0;

  return function (...args) {
    const now = Date.now();
    if (now - lastTime > delay) {
      fn.apply(this, args); // Giá»¯ Ä‘Ãºng this context
      lastTime = now; // Cáº­p nháº­t thá»i Ä‘iá»ƒm cuá»‘i
    }
  };
}

// Sá»­ dá»¥ng:
document.addEventListener(
  "scroll",
  throttle(() => {
    console.log("Scroll!", Date.now());
  }, 200),
);
// DÃ¹ scroll liÃªn tá»¥c â†’ chá»‰ log má»—i 200ms

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THROTTLE NÃ‚NG CAO â€” leading + trailing
// Leading: cháº¡y ngay láº§n Ä‘áº§u
// Trailing: cháº¡y thÃªm láº§n cuá»‘i sau khi ngá»«ng trigger
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function throttleAdvanced(fn, delay, options = {}) {
  const { leading = true, trailing = true } = options;
  let lastTime = 0;
  let timer = null;

  return function (...args) {
    const now = Date.now();
    const remaining = delay - (now - lastTime);

    // Leading edge: cháº¡y ngay náº¿u Ä‘Ã£ qua delay
    if (remaining <= 0) {
      if (timer) {
        clearTimeout(timer);
        timer = null;
      }
      if (leading) {
        fn.apply(this, args);
      }
      lastTime = now;
    }
    // Trailing edge: Ä‘áº·t timer cho láº§n cuá»‘i
    else if (!timer && trailing) {
      timer = setTimeout(() => {
        fn.apply(this, args);
        lastTime = Date.now();
        timer = null;
      }, remaining);
    }
  };
}
```

### Debounce â€” Implementation

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEBOUNCE CÆ  Báº¢N â€” chá»‰ cháº¡y SAU KHI ngá»«ng trigger
// Má»—i láº§n trigger â†’ reset timer â†’ chá» delay â†’ cháº¡y
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function debounce(fn, delay) {
  let timer = null;

  return function (...args) {
    clearTimeout(timer); // Há»§y timer cÅ©
    timer = setTimeout(() => {
      fn.apply(this, args); // Cháº¡y sau delay ms khÃ´ng trigger
    }, delay);
  };
}

// Sá»­ dá»¥ng:
const searchInput = document.getElementById("search");
searchInput.addEventListener(
  "input",
  debounce((e) => {
    console.log("Search:", e.target.value);
    // Gá»i API search á»Ÿ Ä‘Ã¢y
  }, 500),
);
// Chá»‰ search sau khi user NGá»ªNG gÃµ 500ms

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DEBOUNCE NÃ‚NG CAO â€” immediate option (leading edge)
// immediate = true â†’ cháº¡y NGAY láº§n Ä‘áº§u, rá»“i chá» ngá»«ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function debounceAdvanced(fn, delay, immediate = false) {
  let timer = null;

  return function (...args) {
    const callNow = immediate && !timer; // Cháº¡y ngay náº¿u chÆ°a cÃ³ timer
    clearTimeout(timer);

    timer = setTimeout(() => {
      timer = null;
      if (!immediate) {
        fn.apply(this, args); // Trailing: cháº¡y sau delay
      }
    }, delay);

    if (callNow) {
      fn.apply(this, args); // Leading: cháº¡y ngay láº§n Ä‘áº§u
    }
  };
}

// VÃ­ dá»¥: chá»‘ng double-click submit form
submitBtn.addEventListener(
  "click",
  debounceAdvanced(() => submitForm(), 1000, true),
);
// Click láº§n 1 â†’ submit NGAY, spam click tiáº¿p â†’ bá» qua 1s
```

### So SÃ¡nh Tá»•ng Há»£p

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  THROTTLE vs DEBOUNCE â€” SUMMARY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              â”‚  THROTTLE          â”‚  DEBOUNCE              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  NguyÃªn lÃ½    â”‚  Cháº¡y Äá»€U má»—i Nms â”‚  Cháº¡y SAU KHI ngá»«ng    â”‚  â”‚
â”‚  â”‚  Láº§n nÃ o cháº¡y â”‚  Láº§n Äáº¦U trong chu ká»³â”‚ Láº§n CUá»I (trailing)  â”‚  â”‚
â”‚  â”‚  Ká»¹ thuáº­t     â”‚  So sÃ¡nh timestamp â”‚  clearTimeout + reset  â”‚  â”‚
â”‚  â”‚  Khi trigger  â”‚  Bá» qua náº¿u < delayâ”‚  Reset timer           â”‚  â”‚
â”‚  â”‚  Use case     â”‚  Scroll, mousemove â”‚  Search, resize, save  â”‚  â”‚
â”‚  â”‚  Cáº§n pháº£n há»“i â”‚  LiÃªn tá»¥c (Ä‘á»u Ä‘áº·n)â”‚  Sau khi á»•n Ä‘á»‹nh       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  Cáº£ hai Ä‘á»u lÃ  Higher-Order Function (HOF):                     â”‚
â”‚  Nháº­n fn â†’ tráº£ vá» fn má»›i vá»›i logic kiá»ƒm soÃ¡t táº§n suáº¥t           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ LUÃ”N dÃ¹ng .apply(this, args) Ä‘á»ƒ giá»¯ Ä‘Ãºng context + params   â”‚
â”‚  âš ï¸ Throttle: dÃ¹ng timestamp, Debounce: dÃ¹ng setTimeout         â”‚
â”‚  âš ï¸ Cáº£ hai lÃ  á»©ng dá»¥ng thá»±c táº¿ cá»§a Closure (lÆ°u timer/lastTime) â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 20. Element Size & Scrolling â€” KÃ­ch ThÆ°á»›c VÃ  Cuá»™n

### Tá»•ng Quan: Geometry Properties

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOM ELEMENT GEOMETRY â€” Báº£n Äá»“ Thuá»™c TÃ­nh                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  VÃ­ dá»¥: width: 300px, height: 200px,                            â”‚
â”‚         border: 25px, padding: 20px, scrollbar: 16px            â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€ offsetWidth: 390px â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ border:25                                    border:25 â”‚     â”‚
â”‚  â”‚ â”Œâ”€â”€â”€ clientWidth: 324px â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚     â”‚
â”‚  â”‚ â”‚ padding                          paddingâ”‚ scrollbar  â”‚     â”‚
â”‚  â”‚ â”‚  :20  â”Œâ”€â”€ content: 284px â”€â”€â”€â”€â”€â”€â”  :20   â”‚   :16     â”‚     â”‚
â”‚  â”‚ â”‚       â”‚                        â”‚         â”‚           â”‚     â”‚
â”‚  â”‚ â”‚       â”‚   CSS width: 300px     â”‚         â”‚           â”‚     â”‚
â”‚  â”‚ â”‚       â”‚   = content + scrollbarâ”‚         â”‚           â”‚     â”‚
â”‚  â”‚ â”‚       â”‚   = 284 + 16           â”‚         â”‚           â”‚     â”‚
â”‚  â”‚ â”‚       â”‚                        â”‚         â”‚           â”‚     â”‚
â”‚  â”‚ â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚     â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  offsetWidth  = border + padding + content + scrollbar + border â”‚
â”‚              = 25 + 20 + 284 + 16 + 20 + 25 = 390              â”‚
â”‚  clientWidth = padding + content + padding (KHÃ”NG scrollbar)    â”‚
â”‚              = 20 + 284 + 20 = 324                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### offsetParent, offsetLeft/Top

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  offsetParent, offsetLeft, offsetTop             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                 â”‚
  â”‚   <main> (position: relative) â† offsetParent   â”‚
  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚   â”‚                                         â”‚   â”‚
  â”‚   â”‚    offsetTop: 180px                     â”‚   â”‚
  â”‚   â”‚    â†“                                    â”‚   â”‚
  â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
  â”‚   â”‚  â† â”‚   #example       â”‚                 â”‚   â”‚
  â”‚   â”‚    â”‚   (pos: absolute) â”‚                 â”‚   â”‚
  â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
  â”‚   â”‚    â† offsetLeft: 180px â†’               â”‚   â”‚
  â”‚   â”‚                                         â”‚   â”‚
  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                 â”‚
  â”‚  offsetParent = ancestor gáº§n nháº¥t thá»a:         â”‚
  â”‚  â€¢ CSS-positioned (absolute/relative/fixed)     â”‚
  â”‚  â€¢ <td>, <th>, <table>                          â”‚
  â”‚  â€¢ <body>                                       â”‚
  â”‚                                                 â”‚
  â”‚  offsetParent = null khi:                       â”‚
  â”‚  â€¢ display: none / chÆ°a chÃ¨n DOM               â”‚
  â”‚  â€¢ <body>, <html>                               â”‚
  â”‚  â€¢ position: fixed                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// offsetParent â€” ancestor gáº§n nháº¥t dÃ¹ng Ä‘á»ƒ tÃ­nh tá»a Ä‘á»™
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// offsetParent lÃ  ancestor gáº§n nháº¥t thá»a 1 trong:
// â€¢ CSS-positioned (position: absolute/relative/fixed/sticky)
// â€¢ <td>, <th>, <table>
// â€¢ <body>

// offsetLeft/Top = tá»a Ä‘á»™ x/y TÆ¯Æ NG Äá»I vá»›i offsetParent
<main style="position: relative" id="main">
  <article>
    <div id="example" style="position: absolute; left: 180px; top: 180px"></div>
  </article>
</main>;

example.offsetParent === main; // true â€” main cÃ³ position: relative
example.offsetLeft; // 180 (number, khÃ´ng pháº£i "180px")
example.offsetTop; // 180

// offsetParent = null khi:
// â€¢ Element cÃ³ display: none
// â€¢ Element chÆ°a Ä‘Æ°á»£c chÃ¨n vÃ o DOM
// â€¢ <body> hoáº·c <html>
// â€¢ Element cÃ³ position: fixed
```

### offsetWidth/Height â€” KÃ­ch ThÆ°á»›c "NgoÃ i"

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  offsetWidth / offsetHeight                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ offsetWidth: 390px â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â†‘         â”‚
  â”‚  â”‚ border: 25px                             â”‚  â”‚         â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚         â”‚
  â”‚  â”‚  â”‚ padding: 20px                    â”‚    â”‚  â”‚         â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” scroll â”‚    â”‚  â”‚ offset  â”‚
  â”‚  â”‚  â”‚  â”‚                      â”‚  bar   â”‚    â”‚  â”‚ Height  â”‚
  â”‚  â”‚  â”‚  â”‚   content: 284px     â”‚  :16   â”‚    â”‚  â”‚ :290    â”‚
  â”‚  â”‚  â”‚  â”‚                      â”‚        â”‚    â”‚  â”‚         â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚  â”‚         â”‚
  â”‚  â”‚  â”‚ padding: 20px                    â”‚    â”‚  â”‚         â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚         â”‚
  â”‚  â”‚ border: 25px                             â”‚  â”‚         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â†“         â”‚
  â”‚                                                          â”‚
  â”‚  offsetWidth  = border + padding + content + bar + pad   â”‚
  â”‚                + border                                  â”‚
  â”‚              = 25 + 20 + 284 + 16 + 20 + 25 = 390       â”‚
  â”‚  offsetHeight = 25 + 20 + 200 + 20 + 25 = 290           â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// offsetWidth/Height = kÃ­ch thÆ°á»›c TOÃ€N Bá»˜ element
// Bao gá»“m: border + padding + content + scrollbar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥: width:300, height:200, border:25, padding:20
elem.offsetWidth; // 390 = 300 + 2Ã—20 + 2Ã—25
elem.offsetHeight; // 290 = 200 + 2Ã—20 + 2Ã—25

// âš ï¸ Geometry = 0 khi element bá»‹ áº©n
// DÃ¹ng Ä‘á»ƒ kiá»ƒm tra element cÃ³ hiá»ƒn thá»‹ khÃ´ng:
function isHidden(elem) {
  return !elem.offsetWidth && !elem.offsetHeight;
}
// âš ï¸ Tráº£ vá» true cáº£ khi element visible nhÆ°ng size = 0
```

### clientTop/Left â€” Border Width

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  clientTop / clientLeft                                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  LTR (máº·c Ä‘á»‹nh):                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ border                               â”‚                â”‚
  â”‚  â”‚ â†25â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚                â”‚
  â”‚  â”‚  â†‘   â”‚                        â”‚      â”‚                â”‚
  â”‚  â”‚  25  â”‚   client area          â”‚      â”‚                â”‚
  â”‚  â”‚  â†“   â”‚                        â”‚      â”‚                â”‚
  â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚  clientLeft = 25 (= border-left)                        â”‚
  â”‚  clientTop  = 25 (= border-top)                         â”‚
  â”‚                                                          â”‚
  â”‚  RTL (Arabic/Hebrew) â€” scrollbar náº±m bÃªn TRÃI:         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ border  scroll                       â”‚                â”‚
  â”‚  â”‚ â†25â†’â†16â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚                â”‚
  â”‚  â”‚          â”‚  client area     â”‚        â”‚                â”‚
  â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚                â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚  clientLeft = 25 + 16 = 41 (border + scrollbar)         â”‚
  â”‚  clientTop  = 25 (váº«n chá»‰ border-top)                   â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// clientTop/Left = khoáº£ng cÃ¡ch tá»« OUTER â†’ INNER edge
// ThÆ°á»ng = border width, NHÆ¯NG...
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.clientLeft; // 25 = left border width
elem.clientTop; // 25 = top border width

// âš ï¸ RTL (Arabic/Hebrew) â†’ scrollbar náº±m bÃªn TRÃI
// â†’ clientLeft = border + scrollbar = 25 + 16 = 41
// clientTop váº«n = 25 (border top)
```

### clientWidth/Height â€” KÃ­ch ThÆ°á»›c Content + Padding

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  clientWidth / clientHeight                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
  â”‚  â”‚ border (KHÃ”NG tÃ­nh)                      â”‚            â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€ clientWidth: 324px â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚
  â”‚  â”‚  â”‚ padding                   paddingâ”‚    â”‚  â†‘         â”‚
  â”‚  â”‚  â”‚  :20  â”Œâ”€â”€ content â”€â”€â”€â”€â”€â”€â”  :20   â”‚    â”‚  â”‚ client  â”‚
  â”‚  â”‚  â”‚       â”‚                  â”‚        â”‚    â”‚  â”‚ Height  â”‚
  â”‚  â”‚  â”‚       â”‚    284px         â”‚        â”‚ â–“â–“ â”‚  â”‚ :240    â”‚
  â”‚  â”‚  â”‚       â”‚                  â”‚        â”‚ â–“â–“ â”‚  â”‚         â”‚
  â”‚  â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â–“â–“ â”‚  â†“         â”‚
  â”‚  â”‚  â”‚ padding: 20               paddingâ”‚ sc â”‚            â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ bar â”‚            â”‚
  â”‚  â”‚ border                       (16, ko tÃ­nh)â”‚            â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
  â”‚                                                          â”‚
  â”‚  clientWidth  = padding + content + padding              â”‚
  â”‚              = 20 + 284 + 20 = 324                      â”‚
  â”‚  clientHeight = 20 + 200 + 20 = 240                     â”‚
  â”‚  âš ï¸ KHÃ”NG bao gá»“m border vÃ  scrollbar                   â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// clientWidth/Height = content + padding (KHÃ”NG scrollbar)
// ÄÃ¢y lÃ  vÃ¹ng Ná»˜I DUNG thá»±c sá»± hiá»ƒn thá»‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥: CSS width:300, padding:20, scrollbar:16
// Content thá»±c = 300 - 16 = 284

elem.clientWidth; // 324 = 284 + 20 + 20  (content + 2Ã—padding)
elem.clientHeight; // 240 = 200 + 20 + 20  (height + 2Ã—padding)

// KhÃ´ng padding â†’ clientWidth/Height = content area chÃ­nh xÃ¡c
// â†’ CÃ¡ch Tá»T NHáº¤T Ä‘á»ƒ láº¥y kÃ­ch thÆ°á»›c vÃ¹ng nhÃ¬n tháº¥y
```

### scrollWidth/Height â€” KÃ­ch ThÆ°á»›c ToÃ n Bá»™ Ná»™i Dung

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  scrollWidth / scrollHeight                              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
  â”‚  â”‚ padding                    â”‚  â†‘                       â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚                       â”‚
  â”‚  â”‚  â”‚  VÃ¹ng nhÃ¬n tháº¥y      â”‚  â”‚  â”‚ clientHeight          â”‚
  â”‚  â”‚  â”‚  (viewport)          â”‚  â”‚  â”‚ = 240px               â”‚
  â”‚  â”‚  â”‚                      â”‚  â”‚  â”‚                       â”‚
  â”‚  â”‚  â”œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤  â”‚  â†“                       â”‚
  â”‚  â”‚  â”‚                      â”‚  â”‚  â†‘                       â”‚
  â”‚  â”‚  â”‚  Pháº§n bá»‹ áº©n          â”‚  â”‚  â”‚ pháº§n overflow         â”‚
  â”‚  â”‚  â”‚  (overflow/scroll)   â”‚  â”‚  â”‚ = 483px               â”‚
  â”‚  â”‚  â”‚                      â”‚  â”‚  â”‚                       â”‚
  â”‚  â”‚  â”‚                      â”‚  â”‚  â”‚                       â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â†“                       â”‚
  â”‚  â”‚ padding                    â”‚                          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
  â”‚  â†â”€â”€ scrollWidth: 324px â”€â”€â†’    â†• scrollHeight: 723px    â”‚
  â”‚                                                          â”‚
  â”‚  KhÃ´ng scroll ngang â†’ scrollWidth = clientWidth          â”‚
  â”‚  CÃ³ scroll dá»c     â†’ scrollHeight > clientHeight         â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// scrollWidth/Height = clientWidth/Height + pháº§n Bá»Š áº¨N (scroll)
// = KÃ­ch thÆ°á»›c TOÃ€N Bá»˜ content (ká»ƒ cáº£ pháº§n overflow)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.scrollWidth; // 324 (khÃ´ng cÃ³ horizontal scroll = clientWidth)
elem.scrollHeight; // 723 (tá»•ng chiá»u cao ná»™i dung, ká»ƒ cáº£ áº©n)

// âœ… á»¨ng dá»¥ng: má»Ÿ rá»™ng element ra full content
element.style.height = `${element.scrollHeight}px`;
// Bá» scrollbar, hiá»ƒn thá»‹ toÃ n bá»™ ná»™i dung
```

### scrollLeft/scrollTop â€” Vá»‹ TrÃ­ Cuá»™n

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  scrollLeft / scrollTop                                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’  â”‚  â†‘                        â”‚
  â”‚  â”‚  â–’ Pháº§n Ä‘Ã£ cuá»™n qua  â–’  â”‚  â”‚ scrollTop               â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’  â”‚  â†“                        â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â†‘                        â”‚
  â”‚  â”‚  â”‚                    â”‚  â”‚  â”‚                        â”‚
  â”‚  â”‚  â”‚   Viewport         â”‚  â”‚  â”‚ clientHeight           â”‚
  â”‚  â”‚  â”‚   (nhÃ¬n tháº¥y)      â”‚  â”‚  â”‚                        â”‚
  â”‚  â”‚  â”‚                    â”‚  â”‚  â”‚                        â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â†“                        â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â†‘                        â”‚
  â”‚  â”‚  â–‘ Pháº§n chÆ°a cuá»™n    â–‘  â”‚  â”‚ scrollBottom            â”‚
  â”‚  â”‚  â–‘ (cÃ²n áº©n bÃªn dÆ°á»›i) â–‘  â”‚  â”‚ = scrollHeight          â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â”‚   - scrollTop           â”‚
  â”‚  â”‚                          â”‚  â”‚   - clientHeight        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â†“                        â”‚
  â”‚  â†• scrollHeight (toÃ n bá»™)                               â”‚
  â”‚                                                          â”‚
  â”‚  âš ï¸ scrollLeft/scrollTop = WRITABLE (duy nháº¥t!)         â”‚
  â”‚  âœ… scrollTop = 0   â†’ vá» Ä‘áº§u                            â”‚
  â”‚  âœ… scrollTop = 1e9 â†’ vá» cuá»‘i (tá»± clamp)                â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// scrollLeft/scrollTop = khoáº£ng Ä‘Ã£ cuá»™n (tá»« trÃªn/trÃ¡i)
// ÄÃ‚Y LÃ€ THUá»˜C TÃNH DUY NHáº¤T CÃ“ THá»‚ GHI (writable)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.scrollTop; // Sá»‘ px Ä‘Ã£ scroll tá»« trÃªn xuá»‘ng
elem.scrollLeft; // Sá»‘ px Ä‘Ã£ scroll tá»« trÃ¡i sang

// âœ… CÃ³ thá»ƒ SET Ä‘á»ƒ Ä‘iá»u khiá»ƒn scroll
elem.scrollTop = 0; // Scroll lÃªn Ä‘áº§u
elem.scrollTop = 1e9; // Scroll xuá»‘ng cuá»‘i (tá»± clamp)

// TÃ­nh scrollBottom (pháº§n chÆ°a cuá»™n á»Ÿ dÆ°á»›i):
let scrollBottom = elem.scrollHeight - elem.scrollTop - elem.clientHeight;
// (tá»•ng cao) - (Ä‘Ã£ cuá»™n) - (pháº§n nhÃ¬n tháº¥y) = pháº§n áº©n dÆ°á»›i
```

### Táº¡i Sao KHÃ”NG DÃ¹ng getComputedStyle?

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ KHÃ”NG dÃ¹ng getComputedStyle(elem).width/height
// âœ… DÃ™NG geometry properties (offset/client/scroll)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// LÃ DO 1: box-sizing thay Ä‘á»•i Ã½ nghÄ©a width/height
// CSS width cÃ³ thá»ƒ lÃ  content-box hoáº·c border-box â†’ khÃ´ng nháº¥t quÃ¡n

// LÃ DO 2: CSS width cÃ³ thá»ƒ lÃ  "auto" (inline elements)
const span = document.querySelector("span");
getComputedStyle(span).width; // "auto" â† khÃ´ng dÃ¹ng Ä‘Æ°á»£c!

// LÃ DO 3: Scrollbar handling KHÃC NHAU giá»¯a browsers
// Chrome: tráº£ vá» inner width (trá»« scrollbar)
// Firefox: tráº£ vá» CSS width (bao gá»“m scrollbar)
// â†’ clientWidth LUÃ”N nháº¥t quÃ¡n: trá»« scrollbar

// LÃ DO 4: getComputedStyle tráº£ vá» STRING ("300px")
// Geometry properties tráº£ vá» NUMBER â†’ dÃ¹ng tÃ­nh toÃ¡n ngay
```

### VÃ­ Dá»¥ Thá»±c Táº¿

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i toÃ¡n: TÃ­nh scrollbar width
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getScrollbarWidth() {
  const div = document.createElement("div");
  div.style.overflowY = "scroll";
  div.style.width = "50px";
  div.style.height = "50px";

  document.body.append(div);
  const scrollbarWidth = div.offsetWidth - div.clientWidth;
  div.remove();

  return scrollbarWidth; // ~16px on Windows, 0px on macOS overlay
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i toÃ¡n: Äáº·t ball vÃ o giá»¯a field
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function centerBall(field, ball) {
  // field.clientWidth/Height = kÃ­ch thÆ°á»›c vÃ¹ng chá»©a (trá»« border)
  // ball.offsetWidth/Height = kÃ­ch thÆ°á»›c ball (bao gá»“m border)
  ball.style.left =
    Math.round(field.clientWidth / 2 - ball.offsetWidth / 2) + "px";
  ball.style.top =
    Math.round(field.clientHeight / 2 - ball.offsetHeight / 2) + "px";
}
// âš ï¸ img chÆ°a load â†’ offsetWidth = 0 â†’ sai vá»‹ trÃ­
// âœ… Fix: set width/height cho <img> hoáº·c chá» onload

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i toÃ¡n: CSS width vs clientWidth â€” 4 khÃ¡c biá»‡t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. clientWidth = NUMBER, getComputedStyle().width = STRING "300px"
// 2. getComputedStyle cÃ³ thá»ƒ tráº£ "auto" (inline element)
// 3. clientWidth = content + padding, CSS width = chá»‰ content (content-box)
// 4. clientWidth luÃ´n trá»« scrollbar, CSS width khÃ¡c nhau giá»¯a browsers
```

### Tá»•ng Há»£p: Element Geometry

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ELEMENT GEOMETRY â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Property             â”‚  MÃ´ táº£                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  offsetParent          â”‚  Ancestor positioned gáº§n nháº¥t      â”‚  â”‚
â”‚  â”‚  offsetLeft/Top        â”‚  Tá»a Ä‘á»™ so vá»›i offsetParent        â”‚  â”‚
â”‚  â”‚  offsetWidth/Height    â”‚  border + padding + content + bar  â”‚  â”‚
â”‚  â”‚  clientLeft/Top        â”‚  Border width (+ bar náº¿u RTL)      â”‚  â”‚
â”‚  â”‚  clientWidth/Height    â”‚  padding + content (KHÃ”NG bar)     â”‚  â”‚
â”‚  â”‚  scrollWidth/Height    â”‚  ToÃ n bá»™ content (ká»ƒ cáº£ overflow)  â”‚  â”‚
â”‚  â”‚  scrollLeft/Top        â”‚  Khoáº£ng Ä‘Ã£ scroll (WRITABLE!)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  CÃ´ng thá»©c há»¯u Ã­ch:                                             â”‚
â”‚  scrollBottom = scrollHeight - scrollTop - clientHeight          â”‚
â”‚  scrollbarWidth = offsetWidth - clientWidth - 2 Ã— borderLeft     â”‚
â”‚  isHidden = !offsetWidth && !offsetHeight                        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Chá»‰ scrollLeft/scrollTop lÃ  writable, cÃ²n láº¡i READ-ONLY     â”‚
â”‚  âš ï¸ display:none â†’ táº¥t cáº£ geometry = 0, offsetParent = null     â”‚
â”‚  âš ï¸ KHÃ”NG dÃ¹ng getComputedStyle â†’ dÃ¹ng geometry properties      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 21. Window Sizes & Scrolling â€” KÃ­ch ThÆ°á»›c Cá»­a Sá»• VÃ  Cuá»™n Trang

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WINDOW & DOCUMENT GEOMETRY â€” Báº£n Äá»“ Thuá»™c TÃ­nh                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Má»¥c Ä‘Ã­ch              â”‚  API                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Window width/height   â”‚  documentElement.clientWidth/     â”‚  â”‚
â”‚  â”‚  (trá»« scrollbar)       â”‚  clientHeight                     â”‚  â”‚
â”‚  â”‚                        â”‚                                   â”‚  â”‚
â”‚  â”‚  Window width/height   â”‚  window.innerWidth/               â”‚  â”‚
â”‚  â”‚  (ká»ƒ cáº£ scrollbar)    â”‚  innerHeight                      â”‚  â”‚
â”‚  â”‚                        â”‚                                   â”‚  â”‚
â”‚  â”‚  Document full size    â”‚  Math.max(body+docEl scroll/      â”‚  â”‚
â”‚  â”‚                        â”‚  offset/client Width/Height)      â”‚  â”‚
â”‚  â”‚                        â”‚                                   â”‚  â”‚
â”‚  â”‚  Current scroll pos    â”‚  window.pageYOffset (=scrollY)    â”‚  â”‚
â”‚  â”‚                        â”‚  window.pageXOffset (=scrollX)    â”‚  â”‚
â”‚  â”‚                        â”‚                                   â”‚  â”‚
â”‚  â”‚  Scroll tuyá»‡t Ä‘á»‘i     â”‚  window.scrollTo(x, y)            â”‚  â”‚
â”‚  â”‚  Scroll tÆ°Æ¡ng Ä‘á»‘i     â”‚  window.scrollBy(x, y)            â”‚  â”‚
â”‚  â”‚  Scroll Ä‘áº¿n element   â”‚  elem.scrollIntoView(top)         â”‚  â”‚
â”‚  â”‚  Cáº¥m scroll           â”‚  body.style.overflow = "hidden"   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Width/Height Cá»§a Window

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Window Width / Height                                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€ window.innerWidth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”             â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â†‘          â”‚
  â”‚  â”‚  â†â”€ documentElement.clientWidth â”€â†’   â”‚â–“â–“â”‚  â”‚          â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚ window   â”‚
  â”‚  â”‚   VÃ¹ng ná»™i dung hiá»ƒn thá»‹             â”‚â–“â–“â”‚  â”‚ .inner   â”‚
  â”‚  â”‚   (content area)                     â”‚â–“â–“â”‚  â”‚ Height   â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚          â”‚
  â”‚  â”‚   documentElement                    â”‚â–“â–“â”‚  â”‚ =        â”‚
  â”‚  â”‚   .clientHeight                      â”‚â–“â–“â”‚  â”‚ docEl    â”‚
  â”‚  â”‚   = innerHeight - scrollbar          â”‚â–“â–“â”‚  â”‚ .client  â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚ Height   â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚ +        â”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚ scrollbarâ”‚
  â”‚  â”‚                                      â”‚â–“â–“â”‚  â”‚          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜  â†“          â”‚
  â”‚   â–“â–“ = scrollbar (if any)                                â”‚
  â”‚                                                          â”‚
  â”‚  âœ… DÃ¹ng documentElement.clientWidth/Height              â”‚
  â”‚     â†’ trá»« scrollbar, chÃ­nh xÃ¡c cho layout                â”‚
  â”‚  âŒ TrÃ¡nh window.innerWidth/Height                       â”‚
  â”‚     â†’ bao gá»“m scrollbar, gÃ¢y sai khi tÃ­nh layout        â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KÃ­ch thÆ°á»›c cá»­a sá»• â€” KHÃ”NG bao gá»“m scrollbar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… CÃCH ÄÃšNG â€” dÃ¹ng cho layout/positioning
document.documentElement.clientWidth; // vd: 1904
document.documentElement.clientHeight; // vd: 979

// âŒ CÃCH SAI â€” bao gá»“m scrollbar
window.innerWidth; // vd: 1920 (= 1904 + 16px scrollbar)
window.innerHeight; // vd: 979  (náº¿u khÃ´ng cÃ³ horizontal scrollbar)

// So sÃ¡nh:
alert(window.innerWidth); // full window
alert(document.documentElement.clientWidth); // trá»« scrollbar
// â†’ KhÃ¡c nhau khi cÃ³ scrollbar!

// âš ï¸ DOCTYPE quan trá»ng!
// Náº¿u thiáº¿u <!DOCTYPE HTML> â†’ geometry properties hoáº¡t Ä‘á»™ng sai
// LuÃ´n Ä‘áº£m báº£o cÃ³ DOCTYPE trong HTML hiá»‡n Ä‘áº¡i
```

### Width/Height Cá»§a Document (ToÃ n Bá»™ Trang)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Document Full Width / Height                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
  â”‚  â”‚                                â”‚  â†‘                   â”‚
  â”‚  â”‚   Viewport (nhÃ¬n tháº¥y)        â”‚  â”‚                   â”‚
  â”‚  â”‚   = documentElement            â”‚  â”‚ clientHeight      â”‚
  â”‚  â”‚     .clientHeight              â”‚  â”‚                   â”‚
  â”‚  â”‚                                â”‚  â†“                   â”‚
  â”‚  â”œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤                      â”‚
  â”‚  â”‚                                â”‚  â†‘                   â”‚
  â”‚  â”‚   Pháº§n bá»‹ áº©n                  â”‚  â”‚                   â”‚
  â”‚  â”‚   (scrolled out)              â”‚  â”‚ pháº§n overflow     â”‚
  â”‚  â”‚                                â”‚  â”‚                   â”‚
  â”‚  â”‚                                â”‚  â”‚                   â”‚
  â”‚  â”‚                                â”‚  â†“                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
  â”‚  â†• Full document height                                  â”‚
  â”‚  = Math.max(body.scrollH, docEl.scrollH,                 â”‚
  â”‚             body.offsetH, docEl.offsetH,                 â”‚
  â”‚             body.clientH, docEl.clientH)                 â”‚
  â”‚                                                          â”‚
  â”‚  âš ï¸ scrollHeight/scrollWidth trÃªn documentElement       â”‚
  â”‚     KHÃ”NG Ä‘Ã¡ng tin cáº­y â€” browsers tÃ­nh khÃ¡c nhau!       â”‚
  â”‚     â†’ Pháº£i dÃ¹ng Math.max() Ä‘á»ƒ Ä‘áº£m báº£o chÃ­nh xÃ¡c       â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KÃ­ch thÆ°á»›c TOÃ€N Bá»˜ document (ká»ƒ cáº£ pháº§n bá»‹ scroll)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âš ï¸ documentElement.scrollHeight KHÃ”NG Ä‘Ã¡ng tin!
// Chrome/Safari/Opera: náº¿u khÃ´ng scroll,
//   scrollHeight cÃ³ thá»ƒ < clientHeight (!)

// âœ… CÃCH ÄÃšNG â€” láº¥y max tá»« táº¥t cáº£ sources
let scrollHeight = Math.max(
  document.body.scrollHeight,
  document.documentElement.scrollHeight,
  document.body.offsetHeight,
  document.documentElement.offsetHeight,
  document.body.clientHeight,
  document.documentElement.clientHeight,
);

let scrollWidth = Math.max(
  document.body.scrollWidth,
  document.documentElement.scrollWidth,
  document.body.offsetWidth,
  document.documentElement.offsetWidth,
  document.body.clientWidth,
  document.documentElement.clientWidth,
);

alert("Full document height: " + scrollHeight);
// Nhá»¯ng inconsistencies nÃ y Ä‘áº¿n tá»« thá»i ká»³ Ä‘áº§u cá»§a web
```

### Äá»c Vá»‹ TrÃ­ Scroll Hiá»‡n Táº¡i

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Current Scroll Position                                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’  â”‚                      â”‚
  â”‚  â”‚  â–’  ÄÃ£ scroll qua (áº©n)    â–’  â”‚  â†‘ pageYOffset       â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’  â”‚  â†“ (= scrollY)      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                      â”‚
  â”‚  â”‚  â”‚                          â”‚  â”‚                      â”‚
  â”‚  â”‚  â”‚   Viewport hiá»‡n táº¡i     â”‚  â”‚                      â”‚
  â”‚  â”‚  â”‚                          â”‚  â”‚                      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚                      â”‚
  â”‚  â”‚  â–‘  ChÆ°a scroll tá»›i (áº©n)  â–‘  â”‚                      â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚                      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
  â”‚                                                          â”‚
  â”‚  pageXOffset â†â†’ scrollX   (alias, giá»‘ng nhau)           â”‚
  â”‚  pageYOffset â†â†’ scrollY   (alias, giá»‘ng nhau)           â”‚
  â”‚  Cáº£ 4 Ä‘á»u READ-ONLY                                     â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äá»c vá»‹ trÃ­ scroll hiá»‡n táº¡i cá»§a PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… CÃCH ÄÆ N GIáº¢N â€” dÃ¹ng window properties
window.pageYOffset; // Sá»‘ px Ä‘Ã£ scroll tá»« trÃªn (read-only)
window.pageXOffset; // Sá»‘ px Ä‘Ã£ scroll tá»« trÃ¡i (read-only)

// Alias (giá»‘ng há»‡t nhau, tá»“n táº¡i vÃ¬ lÃ½ do lá»‹ch sá»­):
window.scrollY; // === window.pageYOffset
window.scrollX; // === window.pageXOffset

// âš ï¸ KHÃ”NG nÃªn dÃ¹ng documentElement.scrollTop cho page scroll
// â†’ Hoáº¡t Ä‘á»™ng sai trÃªn WebKit cÅ© (Safari)
// â†’ TrÃªn Safari cÅ© pháº£i dÃ¹ng document.body.scrollTop
// â†’ window.pageYOffset hoáº¡t Ä‘á»™ng ÄÃšNG trÃªn má»i browser!

alert("Scroll from top: " + window.pageYOffset);
alert("Scroll from left: " + window.pageXOffset);
```

### Scrolling: scrollTo, scrollBy, scrollIntoView

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Scroll Methods                                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  1. scrollBy(x, y) â€” TÆ¯Æ NG Äá»I                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚    â”‚                    â”‚        â”‚
  â”‚  â”‚  â•‘  Viewport  â•‘    â”‚ â†’  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚        â”‚
  â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚    â”‚  â•‘  +10px â†“   â•‘    â”‚        â”‚
  â”‚  â”‚                    â”‚    â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚  scrollBy(0, 10) â†’ di chuyá»ƒn THÃŠM 10px xuá»‘ng           â”‚
  â”‚                                                          â”‚
  â”‚  2. scrollTo(x, y) â€” TUYá»†T Äá»I                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚                    â”‚    â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚        â”‚
  â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚ â†’  â”‚  â•‘ y=0 (top)  â•‘    â”‚        â”‚
  â”‚  â”‚  â•‘  anywhere  â•‘    â”‚    â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚        â”‚
  â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚    â”‚                    â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚  scrollTo(0, 0) â†’ vá» Ä‘áº§u trang (tá»a Ä‘á»™ tuyá»‡t Ä‘á»‘i)     â”‚
  â”‚                                                          â”‚
  â”‚  3. scrollIntoView(top) â€” ELEMENT-CENTRIC               â”‚
  â”‚  top=true (default):  elem â†‘ align vá»›i TOP window       â”‚
  â”‚  top=false:           elem â†“ align vá»›i BOTTOM window    â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äiá»u khiá»ƒn scroll cá»§a PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âš ï¸ QUAN TRá»ŒNG: DOM pháº£i Ä‘Ã£ build xong!
// Script trong <head> sáº½ KHÃ”NG scroll Ä‘Æ°á»£c

// --- scrollBy(x, y) â€” scroll TÆ¯Æ NG Äá»I ---
window.scrollBy(0, 10); // Scroll THÃŠM 10px xuá»‘ng
window.scrollBy(0, -10); // Scroll THÃŠM 10px lÃªn

// --- scrollTo(pageX, pageY) â€” scroll TUYá»†T Äá»I ---
window.scrollTo(0, 0); // Vá» Ä‘áº§u trang
window.scrollTo(0, 500); // Äáº¿n vá»‹ trÃ­ y=500 tá»« top

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i:
// document.documentElement.scrollTop = 0;  // Vá» Ä‘áº§u
// (nhÆ°ng Safari cáº§n document.body.scrollTop)

// --- scrollIntoView(top) â€” scroll Ä‘áº¿n element ---
elem.scrollIntoView(); // top=true (default)
// â†’ Scroll Ä‘á»ƒ elem náº±m á»Ÿ TOP cá»­a sá»•
// â†’ Cáº¡nh trÃªn element = cáº¡nh trÃªn window

elem.scrollIntoView(false);
// â†’ Scroll Ä‘á»ƒ elem náº±m á»Ÿ BOTTOM cá»­a sá»•
// â†’ Cáº¡nh dÆ°á»›i element = cáº¡nh dÆ°á»›i window
```

### Cáº¥m Scroll (Freeze)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Forbid Scrolling                                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  TrÆ°á»›c:                        Sau overflow="hidden":   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
  â”‚  â”‚                      â”‚â–“â–“â”‚   â”‚                         â”‚â”‚
  â”‚  â”‚   Scrollable         â”‚â–“â–“â”‚   â”‚   Frozen! ğŸ”’            â”‚â”‚
  â”‚  â”‚   content             â”‚â–“â–“â”‚   â”‚   (scrollbar biáº¿n máº¥t) â”‚â”‚
  â”‚  â”‚                      â”‚â–“â–“â”‚   â”‚                         â”‚â”‚
  â”‚  â”‚                      â”‚â–“â–“â”‚   â”‚   Content "nháº£y" â†’     â”‚â”‚
  â”‚  â”‚                      â”‚â–“â–“â”‚   â”‚   vÃ¬ scrollbar space   â”‚â”‚
  â”‚  â”‚                      â”‚â–“â–“â”‚   â”‚   Ä‘Æ°á»£c giáº£i phÃ³ng      â”‚â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
  â”‚                                                          â”‚
  â”‚  Fix "content jump":                                     â”‚
  â”‚  1. Äo clientWidth TRÆ¯á»šC freeze                          â”‚
  â”‚  2. Set overflow = "hidden"                              â”‚
  â”‚  3. Náº¿u clientWidth tÄƒng â†’ thÃªm padding-right           â”‚
  â”‚     báº±ng Ä‘Ãºng scrollbar width Ä‘Ã£ máº¥t                     â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cáº¥m scroll â€” "Ä‘Ã³ng bÄƒng" trang
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… Freeze scroll
document.body.style.overflow = "hidden";
// â†’ Trang Ä‘Ã³ng bÄƒng táº¡i vá»‹ trÃ­ scroll hiá»‡n táº¡i
// â†’ Scrollbar biáº¿n máº¥t

// âœ… Unfreeze scroll
document.body.style.overflow = "";
// â†’ KhÃ´i phá»¥c scroll bÃ¬nh thÆ°á»ng

// âš ï¸ Váº¥n Ä‘á»: khi scrollbar biáº¿n máº¥t, content "nháº£y"
// vÃ¬ space cá»§a scrollbar Ä‘Æ°á»£c giáº£i phÃ³ng

// âœ… Fix content jump:
function freezeScroll() {
  const scrollbarWidth =
    window.innerWidth - document.documentElement.clientWidth;

  document.body.style.overflow = "hidden";
  // ThÃªm padding thay tháº¿ scrollbar
  document.body.style.paddingRight = scrollbarWidth + "px";
}

function unfreezeScroll() {
  document.body.style.overflow = "";
  document.body.style.paddingRight = "";
}

// Ãp dá»¥ng cho modal, popup, overlay...
// CÅ©ng dÃ¹ng Ä‘Æ°á»£c cho báº¥t ká»³ element nÃ o, khÃ´ng chá»‰ body
```

### Tá»•ng Há»£p: Window & Document Geometry

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WINDOW & DOCUMENT GEOMETRY â€” SUMMARY                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Property / Method     â”‚  MÃ´ táº£                             â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  docEl.clientW/H       â”‚  Window size (KHÃ”NG scrollbar)     â”‚  â”‚
â”‚  â”‚  window.innerW/H       â”‚  Window size (CÃ“ scrollbar)        â”‚  â”‚
â”‚  â”‚  Math.max(...)         â”‚  Document full size (Ä‘Ã¡ng tin cáº­y) â”‚  â”‚
â”‚  â”‚  pageYOffset/scrollY   â”‚  Scroll position (READ-ONLY)       â”‚  â”‚
â”‚  â”‚  scrollTo(x, y)        â”‚  Scroll tuyá»‡t Ä‘á»‘i                  â”‚  â”‚
â”‚  â”‚  scrollBy(x, y)        â”‚  Scroll tÆ°Æ¡ng Ä‘á»‘i                  â”‚  â”‚
â”‚  â”‚  scrollIntoView(top)   â”‚  Scroll Ä‘áº¿n element                â”‚  â”‚
â”‚  â”‚  overflow: hidden      â”‚  Cáº¥m scroll (freeze)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ LuÃ´n dÃ¹ng docEl.clientW/H thay vÃ¬ window.innerW/H         â”‚
â”‚  âš ï¸ Document size: Math.max() vÃ¬ browser tÃ­nh khÃ¡c nhau       â”‚
â”‚  âš ï¸ Äá»c scroll: dÃ¹ng pageYOffset, KHÃ”NG dÃ¹ng docEl.scrollTop  â”‚
â”‚  âš ï¸ DOM pháº£i build xong trÆ°á»›c khi scroll báº±ng JS              â”‚
â”‚  âš ï¸ Freeze scroll â†’ thÃªm padding thay scrollbar               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 22. Coordinates â€” Há»‡ Tá»a Äá»™

### Tá»•ng Quan: Hai Há»‡ Tá»a Äá»™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COORDINATE SYSTEMS â€” Window vs Document                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   TRÆ¯á»šC KHI SCROLL:              SAU KHI SCROLL:                â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â”‚       â”‚
â”‚   â”‚ â”‚                â”‚   â”‚       â”‚â–’ Ä‘Ã£ scroll qua    â–’â”‚       â”‚
â”‚   â”‚ â”‚  pageY â•â•â•â•—    â”‚   â”‚       â”‚â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â”‚       â”‚
â”‚   â”‚ â”‚  clientY â•â•    â”‚   â”‚       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚   â”‚ â”‚     â—â”€â”€â”€â”€â”€â”€    â”‚   â”‚       â”‚ â”‚  pageY â•â•â•â•â•â•â•â•—â”‚  â”‚       â”‚
â”‚   â”‚ â”‚    pageX       â”‚   â”‚       â”‚ â”‚  clientY â•â•—   â”‚â”‚  â”‚       â”‚
â”‚   â”‚ â”‚    clientX     â”‚   â”‚       â”‚ â”‚     â—â”€â”€â”€ â•‘   â”‚â”‚  â”‚       â”‚
â”‚   â”‚ â”‚                â”‚   â”‚       â”‚ â”‚    pageX â•‘   â”‚â”‚  â”‚       â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚ â”‚  clientX â•   â”‚â”‚  â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚   ChÆ°a scroll â†’ pageY = clientY    ÄÃ£ scroll:                  â”‚
â”‚                 pageX = clientX    pageY = KHÃ”NG Ä‘á»•i (tá»« doc)  â”‚
â”‚                                     clientY = THAY Äá»”I (tá»« win)â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Há»‡ tá»a Ä‘á»™   â”‚  MÃ´ táº£                                      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Window       â”‚  TÃ­nh tá»« cá»­a sá»• (~ position:fixed)          â”‚  â”‚
â”‚  â”‚  clientX/Y    â”‚  Thay Ä‘á»•i khi scroll                        â”‚  â”‚
â”‚  â”‚               â”‚                                             â”‚  â”‚
â”‚  â”‚  Document     â”‚  TÃ­nh tá»« document (~ position:absolute)      â”‚  â”‚
â”‚  â”‚  pageX/Y      â”‚  KhÃ´ng thay Ä‘á»•i khi scroll                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  CÃ´ng thá»©c chuyá»ƒn Ä‘á»•i:                                          â”‚
â”‚  pageY = clientY + window.pageYOffset                           â”‚
â”‚  pageX = clientX + window.pageXOffset                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Hai há»‡ tá»a Ä‘á»™ trong JavaScript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. WINDOW coordinates (clientX/clientY)
//    - TÃ­nh tá»« gÃ³c trÃªn-trÃ¡i Cá»¬A Sá»”
//    - Giá»‘ng CSS position:fixed
//    - THAY Äá»”I khi scroll (element di chuyá»ƒn trong viewport)

// 2. DOCUMENT coordinates (pageX/pageY)
//    - TÃ­nh tá»« gÃ³c trÃªn-trÃ¡i TÃ€I LIá»†U
//    - Giá»‘ng CSS position:absolute (tá»« root)
//    - KHÃ”NG thay Ä‘á»•i khi scroll

// Khi chÆ°a scroll â†’ pageY = clientY, pageX = clientX
// Khi Ä‘Ã£ scroll:
//   pageY = clientY + window.pageYOffset
//   pageX = clientX + window.pageXOffset
```

### getBoundingClientRect â€” Tá»a Äá»™ Window Cá»§a Element

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  elem.getBoundingClientRect()                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  Window (viewport)                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚      left (=x)                right                  â”‚    â”‚
  â”‚  â”‚        â†“                         â†“                    â”‚    â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”€â”€â”€â”€â”€â”€              â”‚    â”‚
  â”‚  â”‚   top  â”ƒ                          â”ƒ                    â”‚    â”‚
  â”‚  â”‚  (=y)â†’ â”ƒ      Element             â”ƒ                    â”‚    â”‚
  â”‚  â”‚        â”ƒ                          â”ƒ  â† width â†’        â”‚    â”‚
  â”‚  â”‚        â”ƒ   (width, height)        â”ƒ                    â”‚    â”‚
  â”‚  â”‚        â”ƒ                          â”ƒ                    â”‚    â”‚
  â”‚  â”‚ bottom â”ƒ                          â”ƒ  â†• height         â”‚    â”‚
  â”‚  â”‚   â†’ â”€â”€â”€â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”€â”€â”€â”€â”€â”€              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Properties chÃ­nh:                                           â”‚
  â”‚  â€¢ x/y      = tá»a Ä‘á»™ gÃ³c trÃªn-trÃ¡i (= left/top)            â”‚
  â”‚  â€¢ width    = chiá»u rá»™ng rectangle                          â”‚
  â”‚  â€¢ height   = chiá»u cao rectangle                           â”‚
  â”‚                                                              â”‚
  â”‚  Derived (tÃ­nh tá»« x, y, width, height):                     â”‚
  â”‚  â€¢ left   = x                                               â”‚
  â”‚  â€¢ top    = y                                                â”‚
  â”‚  â€¢ right  = x + width                                       â”‚
  â”‚  â€¢ bottom = y + height                                      â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Tá»a Ä‘á»™ cÃ³ thá»ƒ lÃ  DECIMAL (10.5) â€” bÃ¬nh thÆ°á»ng          â”‚
  â”‚  âš ï¸ Tá»a Ä‘á»™ cÃ³ thá»ƒ Ã‚M (element á»Ÿ trÃªn viewport sau scroll)  â”‚
  â”‚  âš ï¸ right/bottom â‰  CSS right/bottom!                        â”‚
  â”‚     JS: tÃ­nh tá»« TOP-LEFT window                             â”‚
  â”‚     CSS: tÃ­nh tá»« cáº¡nh RIGHT/BOTTOM                          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// getBoundingClientRect() â€” tá»a Ä‘á»™ WINDOW cá»§a element
// Tráº£ vá» DOMRect object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const rect = elem.getBoundingClientRect();

// Properties chÃ­nh:
rect.x; // Tá»a Ä‘á»™ X gÃ³c trÃªn-trÃ¡i (= rect.left)
rect.y; // Tá»a Ä‘á»™ Y gÃ³c trÃªn-trÃ¡i (= rect.top)
rect.width; // Chiá»u rá»™ng
rect.height; // Chiá»u cao

// Derived properties:
rect.left; // = x
rect.top; // = y
rect.right; // = x + width
rect.bottom; // = y + height

// âš ï¸ GiÃ¡ trá»‹ THAY Äá»”I khi scroll
// â†’ CÃ¹ng element, scroll xuá»‘ng â†’ top giáº£m (cÃ³ thá»ƒ Ã¢m)

// âš ï¸ right/bottom KHÃC vá»›i CSS!
// CSS right = khoáº£ng cÃ¡ch tá»« cáº¡nh pháº£i window
// JS right = x + width (tá»« cáº¡nh trÃ¡i window)

// âš ï¸ GiÃ¡ trá»‹ cÃ³ thá»ƒ lÃ  decimal: 10.5
// â†’ KhÃ´ng cáº§n round khi set style.left/top
```

### elementFromPoint(x, y)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  document.elementFromPoint(x, y)                             â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  Window (viewport)                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚    â”‚
  â”‚  â”‚            â”‚  <div>     â”‚                              â”‚    â”‚
  â”‚  â”‚            â”‚     â—â†â”€â”€â”€â”€ (x, y)                        â”‚    â”‚
  â”‚  â”‚            â”‚  element   â”‚                              â”‚    â”‚
  â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  elementFromPoint(x,y) â†’ tráº£ vá» element              â”‚    â”‚
  â”‚  â”‚  SÃ‚U NHáº¤T (most nested) táº¡i tá»a Ä‘á»™ Ä‘Ã³               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Chá»‰ hoáº¡t Ä‘á»™ng trong vÃ¹ng VISIBLE (viewport)             â”‚
  â”‚  âš ï¸ Tá»a Ä‘á»™ ngoÃ i viewport â†’ tráº£ vá» null                    â”‚
  â”‚  âš ï¸ Káº¿t quáº£ phá»¥ thuá»™c scroll position                      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// elementFromPoint â€” tÃ¬m element táº¡i tá»a Ä‘á»™ window
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Tráº£ vá» element SÃ‚U NHáº¤T (most nested) táº¡i (x, y)
let elem = document.elementFromPoint(x, y);

// VÃ­ dá»¥: highlight element á»Ÿ giá»¯a window
let centerX = document.documentElement.clientWidth / 2;
let centerY = document.documentElement.clientHeight / 2;

let center = document.elementFromPoint(centerX, centerY);
center.style.background = "red";
alert(center.tagName);

// âš ï¸ Chá»‰ hoáº¡t Ä‘á»™ng trong viewport!
// Tá»a Ä‘á»™ ngoÃ i window â†’ null
let elem2 = document.elementFromPoint(-1, -1); // null!

// âš ï¸ LuÃ´n kiá»ƒm tra null trÆ°á»›c khi dÃ¹ng
let e = document.elementFromPoint(x, y);
if (e) {
  e.style.background = "";
} else {
  console.log("Tá»a Ä‘á»™ ngoÃ i viewport");
}
```

### Document Coordinates â€” Chuyá»ƒn Äá»•i Tá»a Äá»™

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Document Coordinates vs Window Coordinates                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  Document top â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
  â”‚  â”‚                                                           â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’ (Ä‘Ã£ scroll qua)                       â”‚
  â”‚  â”‚  â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’â–’                                        â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â† window top (pageYOffset)          â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
  â”‚  â”‚  â”‚   Viewport   â”‚                                        â”‚
  â”‚  â”‚  â”‚              â”‚                                        â”‚
  â”‚  â”‚  â”‚   â—  â†â”€â”€ clientY (tá»« window top)                      â”‚
  â”‚  â”‚  â”‚   â†‘                                                   â”‚
  â”‚  â”‚  â”‚   pageY (tá»« document top)                             â”‚
  â”‚  â”‚  â”‚   = clientY + pageYOffset                             â”‚
  â”‚  â”‚  â”‚              â”‚                                        â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (chÆ°a scroll tá»›i)                      â”‚
  â”‚  â”‚                                                           â”‚
  â”‚                                                              â”‚
  â”‚  Window coords â†’ dÃ¹ng vá»›i position:fixed                    â”‚
  â”‚  Document coords â†’ dÃ¹ng vá»›i position:absolute               â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chuyá»ƒn WINDOW coords â†’ DOCUMENT coords
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ´ng thá»©c:
// pageY = clientY + pageYOffset (vertical scroll)
// pageX = clientX + pageXOffset (horizontal scroll)

// âœ… HÃ m láº¥y document coordinates tá»« element
function getCoords(elem) {
  let box = elem.getBoundingClientRect();

  return {
    top: box.top + window.pageYOffset,
    right: box.right + window.pageXOffset,
    bottom: box.bottom + window.pageYOffset,
    left: box.left + window.pageXOffset,
  };
}

// getBoundingClientRect() â†’ WINDOW coords
// getCoords()             â†’ DOCUMENT coords
```

### á»¨ng Dá»¥ng: Positioning Elements

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ 1: Hiá»ƒn thá»‹ message dÆ°á»›i element (position:fixed)
// âš ï¸ Message sáº½ "trÃ´i" khi scroll!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createMessageUnder_Fixed(elem, html) {
  let message = document.createElement("div");
  message.style.cssText = "position:fixed; color: red";

  let coords = elem.getBoundingClientRect(); // WINDOW coords
  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;
  return message;
}
// âš ï¸ position:fixed â†’ message cá»‘ Ä‘á»‹nh trÃªn viewport
// â†’ Khi scroll â†’ message TÃCH khá»i element gá»‘c!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ 2: Hiá»ƒn thá»‹ message dÆ°á»›i element (position:absolute)
// âœ… Message DÃNH vá»›i element khi scroll!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createMessageUnder_Absolute(elem, html) {
  let message = document.createElement("div");
  message.style.cssText = "position:absolute; color: red";

  let coords = getCoords(elem); // DOCUMENT coords
  message.style.left = coords.left + "px";
  message.style.top = coords.bottom + "px";

  message.innerHTML = html;
  return message;
}
// âœ… position:absolute + document coords
// â†’ Message di chuyá»ƒn CÃ™NG vá»›i trang khi scroll

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ 3: positionAt â€” Ä‘áº·t element á»Ÿ cÃ¡c vá»‹ trÃ­ khÃ¡c nhau
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function positionAt(anchor, position, elem) {
  let coords = getCoords(anchor);

  switch (position) {
    case "top":
      elem.style.left = coords.left + "px";
      elem.style.top = coords.top - elem.offsetHeight + "px";
      break;
    case "right":
      elem.style.left = coords.left + anchor.offsetWidth + "px";
      elem.style.top = coords.top + "px";
      break;
    case "bottom":
      elem.style.left = coords.left + "px";
      elem.style.top = coords.bottom + "px";
      break;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ 4: TÃ¬m tá»a Ä‘á»™ inner corners cá»§a element
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getCorners(elem) {
  let coords = elem.getBoundingClientRect();

  return {
    outerTopLeft: [coords.left, coords.top],
    outerBottomRight: [coords.right, coords.bottom],

    // clientLeft/Top = border width
    innerTopLeft: [coords.left + elem.clientLeft, coords.top + elem.clientTop],

    // clientWidth/Height = inner area (padding + content)
    innerBottomRight: [
      coords.left + elem.clientLeft + elem.clientWidth,
      coords.top + elem.clientTop + elem.clientHeight,
    ],
  };
}
```

### Tá»•ng Há»£p: Coordinates

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COORDINATES â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  KhÃ¡i niá»‡m           â”‚  MÃ´ táº£                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Window coords       â”‚  Tá»« cá»­a sá»• (~ position:fixed)        â”‚  â”‚
â”‚  â”‚  clientX/clientY     â”‚  Thay Ä‘á»•i khi scroll                  â”‚  â”‚
â”‚  â”‚                      â”‚                                       â”‚  â”‚
â”‚  â”‚  Document coords     â”‚  Tá»« document (~ position:absolute)    â”‚  â”‚
â”‚  â”‚  pageX/pageY         â”‚  KhÃ´ng Ä‘á»•i khi scroll                 â”‚  â”‚
â”‚  â”‚                      â”‚                                       â”‚  â”‚
â”‚  â”‚  getBoundingClient   â”‚  Tráº£ window coords                    â”‚  â”‚
â”‚  â”‚  Rect()              â”‚  {x,y,width,height,top,left,...}      â”‚  â”‚
â”‚  â”‚                      â”‚                                       â”‚  â”‚
â”‚  â”‚  elementFromPoint    â”‚  Element sÃ¢u nháº¥t táº¡i (x,y)           â”‚  â”‚
â”‚  â”‚  (x, y)              â”‚  Chá»‰ trong viewport, null náº¿u ngoÃ i  â”‚  â”‚
â”‚  â”‚                      â”‚                                       â”‚  â”‚
â”‚  â”‚  Chuyá»ƒn Ä‘á»•i          â”‚  pageY = clientY + pageYOffset        â”‚  â”‚
â”‚  â”‚  window â†’ doc        â”‚  pageX = clientX + pageXOffset        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚  position:fixed  â†’ dÃ¹ng WINDOW coords (getBoundingClientRect)  â”‚
â”‚  position:absolute â†’ dÃ¹ng DOCUMENT coords (+ pageYOffset)      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ right/bottom trong JS â‰  CSS (JS tÃ­nh tá»« top-left)          â”‚
â”‚  âš ï¸ Coords cÃ³ thá»ƒ decimal hoáº·c negative                        â”‚
â”‚  âš ï¸ elementFromPoint tráº£ null náº¿u ngoÃ i viewport               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 23. Proxy & Reflect â€” Metaprogramming

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROXY & REFLECT â€” Báº£n Äá»“ Tá»•ng Quan                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    intercept     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    forward    â”Œâ”€â”€â”€â”€â”â”‚
â”‚  â”‚  Client   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Proxy    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ Obj â”‚â”‚
â”‚  â”‚  Code     â”‚                 â”‚  (traps)  â”‚              â”‚     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”˜â”‚
â”‚                                    â”‚                            â”‚
â”‚                                    â”‚ Reflect.xxx()              â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
â”‚                                                                 â”‚
â”‚  Proxy: wrapper cháº·n operations trÃªn object                    â”‚
â”‚  Reflect: built-in object, gá»i internal methods trá»±c tiáº¿p      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Internal Methodâ”‚ Trap (handler) â”‚ Triggers khi...         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ [[Get]]        â”‚ get            â”‚ Ä‘á»c property            â”‚   â”‚
â”‚  â”‚ [[Set]]        â”‚ set            â”‚ ghi property            â”‚   â”‚
â”‚  â”‚ [[HasProperty]]â”‚ has            â”‚ in operator             â”‚   â”‚
â”‚  â”‚ [[Delete]]     â”‚ deleteProperty â”‚ delete operator          â”‚   â”‚
â”‚  â”‚ [[Call]]       â”‚ apply          â”‚ gá»i function            â”‚   â”‚
â”‚  â”‚ [[Construct]]  â”‚ construct      â”‚ new operator            â”‚   â”‚
â”‚  â”‚ [[OwnPropKeys]]â”‚ ownKeys       â”‚ Object.keys, for..in    â”‚   â”‚
â”‚  â”‚ [[GetOwnProp]] â”‚ getOwnProperty â”‚ Object.getOwnProp...   â”‚   â”‚
â”‚  â”‚                â”‚ Descriptor     â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃº phÃ¡p cÆ¡ báº£n Proxy
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let proxy = new Proxy(target, handler);
// target  â€” object cáº§n wrap (báº¥t ká»³, ká»ƒ cáº£ function)
// handler â€” object chá»©a "traps" (phÆ°Æ¡ng thá»©c cháº·n operations)

// Proxy KHÃ”NG cÃ³ properties riÃªng
// Proxy rá»—ng (handler = {}) â†’ transparent wrapper
let target = {};
let proxy = new Proxy(target, {}); // empty handler

proxy.test = 5;
alert(target.test); // 5 â€” ghi vÃ o proxy â†’ ghi vÃ o target
alert(proxy.test); // 5 â€” Ä‘á»c tá»« proxy â†’ Ä‘á»c tá»« target
for (let key in proxy) alert(key); // "test" â€” iteration cÅ©ng forward

// âš ï¸ Sau khi proxy, KHÃ”NG dÃ¹ng target trá»±c tiáº¿p ná»¯a!
// LuÃ´n dÃ¹ng proxy thay tháº¿ target á»Ÿ má»i nÆ¡i
```

### get Trap â€” Default Values & Validation

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// get(target, property, receiver)
// Triggers: khi Äá»ŒC property
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥ 1: Array vá»›i default value 0
let numbers = [0, 1, 2];
numbers = new Proxy(numbers, {
  get(target, prop) {
    if (prop in target) {
      return target[prop];
    } else {
      return 0; // default thay vÃ¬ undefined
    }
  },
});
alert(numbers[1]); // 1
alert(numbers[123]); // 0 (khÃ´ng cÃ³ â†’ tráº£ default)

// VÃ­ dá»¥ 2: Dictionary â€” tráº£ phrase gá»‘c náº¿u chÆ°a dá»‹ch
let dictionary = {
  Hello: "Xin chÃ o",
  Bye: "Táº¡m biá»‡t",
};
dictionary = new Proxy(dictionary, {
  get(target, phrase) {
    if (phrase in target) return target[phrase];
    return phrase; // chÆ°a dá»‹ch â†’ tráº£ nguyÃªn báº£n
  },
});
alert(dictionary["Hello"]); // Xin chÃ o
alert(dictionary["Welcome to Proxy"]); // Welcome to Proxy
```

### set Trap â€” Validation Khi Ghi

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// set(target, property, value, receiver)
// Triggers: khi GHI property
// âš ï¸ PHáº¢I return true náº¿u thÃ nh cÃ´ng, false â†’ TypeError
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Array chá»‰ cháº¥p nháº­n number
let numbers = [];
numbers = new Proxy(numbers, {
  set(target, prop, val) {
    if (typeof val == "number") {
      target[prop] = val;
      return true; // âš ï¸ Báº®T BUá»˜C return true
    } else {
      return false; // â†’ TypeError
    }
  },
});

numbers.push(1); // OK
numbers.push(2); // OK
alert(numbers.length); // 2
numbers.push("test"); // TypeError! ('set' returned false)

// âš ï¸ push/unshift dÃ¹ng [[Set]] ná»™i bá»™ â†’ proxy váº«n báº¯t Ä‘Æ°á»£c
// KhÃ´ng cáº§n override cÃ¡c methods cá»§a Array!
```

### has Trap â€” ToÃ¡n Tá»­ `in`

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// has(target, property)
// Triggers: toÃ¡n tá»­ "in"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let range = { start: 1, end: 10 };
range = new Proxy(range, {
  has(target, prop) {
    return prop >= target.start && prop <= target.end;
  },
});

alert(5 in range); // true
alert(50 in range); // false
// Syntactic sugar Ä‘áº¹p cho range checking!
```

### ownKeys & getOwnPropertyDescriptor â€” áº¨n Properties

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ownKeys(target) â€” lá»c property list
// getOwnPropertyDescriptor(target, prop) â€” mÃ´ táº£ property
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// áº¨n properties báº¯t Ä‘áº§u báº±ng _
let user = { name: "John", age: 30, _password: "***" };
user = new Proxy(user, {
  ownKeys(target) {
    return Object.keys(target).filter((key) => !key.startsWith("_"));
  },
});
for (let key in user) alert(key); // name, age (KHÃ”NG cÃ³ _password)
alert(Object.keys(user)); // name,age

// âš ï¸ Vá»›i keys KHÃ”NG tá»“n táº¡i trong object:
// Object.keys cáº§n enumerable flag â†’ pháº£i thÃªm getOwnPropertyDescriptor
let obj = {};
obj = new Proxy(obj, {
  ownKeys(target) {
    return ["a", "b", "c"]; // keys khÃ´ng tá»“n táº¡i
  },
  getOwnPropertyDescriptor(target, prop) {
    return { enumerable: true, configurable: true };
  },
});
alert(Object.keys(obj)); // a, b, c
```

### Protected Properties â€” Báº£o Vá»‡ Private Fields

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Káº¿t há»£p get + set + deleteProperty + ownKeys
// Báº£o vá»‡ properties báº¯t Ä‘áº§u báº±ng _
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John", _password: "***" };
user = new Proxy(user, {
  get(target, prop) {
    if (prop.startsWith("_")) throw new Error("Access denied");
    let value = target[prop];
    // âš ï¸ Bind methods vá» target Ä‘á»ƒ this._password hoáº¡t Ä‘á»™ng
    return typeof value === "function" ? value.bind(target) : value;
  },
  set(target, prop, val) {
    if (prop.startsWith("_")) throw new Error("Access denied");
    target[prop] = val;
    return true;
  },
  deleteProperty(target, prop) {
    if (prop.startsWith("_")) throw new Error("Access denied");
    delete target[prop];
    return true;
  },
  ownKeys(target) {
    return Object.keys(target).filter((key) => !key.startsWith("_"));
  },
});

// âš ï¸ Táº I SAO bind(target)?
// Object methods (vd: checkPassword) cáº§n truy cáº­p this._password
// Náº¿u khÃ´ng bind â†’ this = proxy â†’ get trap cháº·n â†’ Error!
// Bind vá» target â†’ bypass proxy â†’ methods hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
```

### apply Trap â€” Wrapping Functions

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// apply(target, thisArg, args)
// Triggers: gá»i proxy nhÆ° function
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// So sÃ¡nh: wrapper function vs Proxy

// âŒ Wrapper function â€” Máº¤T properties
function delay_old(f, ms) {
  return function () {
    // wrapper
    setTimeout(() => f.apply(this, arguments), ms);
  };
}
let sayHi = (user) => alert(`Hello, ${user}!`);
alert(sayHi.length); // 1
sayHi = delay_old(sayHi, 3000);
alert(sayHi.length); // 0 â† Máº¤T length!

// âœ… Proxy â€” GIá»® NGUYÃŠN properties
function delay(f, ms) {
  return new Proxy(f, {
    apply(target, thisArg, args) {
      setTimeout(() => target.apply(thisArg, args), ms);
    },
  });
}
sayHi = delay(sayHi, 3000);
alert(sayHi.length); // 1 â† GIá»® NGUYÃŠN!
sayHi("John"); // Hello, John! (sau 3s)

// Proxy forward Má»ŒI operation (Ä‘á»c, gá»i, etc.) â†’ "richer" wrapper
```

### Reflect API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REFLECT â€” Gá»i Internal Methods Trá»±c Tiáº¿p                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Operation        â”‚  Reflect call         â”‚  Internal    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  obj[prop]        â”‚  Reflect.get(obj,p)   â”‚  [[Get]]     â”‚     â”‚
â”‚  â”‚  obj[p] = val     â”‚  Reflect.set(obj,p,v) â”‚  [[Set]]     â”‚     â”‚
â”‚  â”‚  delete obj[p]    â”‚  Reflect.deleteP(o,p) â”‚  [[Delete]]  â”‚     â”‚
â”‚  â”‚  new F(val)       â”‚  Reflect.construct    â”‚  [[Construct]]â”‚    â”‚
â”‚  â”‚  p in obj         â”‚  Reflect.has(obj,p)   â”‚  [[Has]]     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚  Má»—i Proxy trap â†” 1 Reflect method (cÃ¹ng tÃªn, cÃ¹ng args)      â”‚
â”‚  â†’ DÃ¹ng Reflect Ä‘á»ƒ forward operations an toÃ n                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Reflect â€” forward operations trong Proxy traps
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Logging proxy â€” theo dÃµi má»i read/write
let user = { name: "John" };
user = new Proxy(user, {
  get(target, prop, receiver) {
    alert(`GET ${prop}`);
    return Reflect.get(target, prop, receiver); // forward
  },
  set(target, prop, val, receiver) {
    alert(`SET ${prop}=${val}`);
    return Reflect.set(target, prop, val, receiver); // forward
  },
});
user.name; // "GET name"
user.name = "Pete"; // "SET name=Pete"

// âš ï¸ Táº I SAO Reflect.get Tá»T HÆ N target[prop]?
// â†’ VÃ¬ receiver (this context) cho GETTER!
```

### Receiver & Getter â€” Táº¡i Sao Cáº§n Reflect

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Váº¥n Ä‘á»: target[prop] SAI khi cÃ³ getter + inheritance
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  _name: "Guest",
  get name() {
    return this._name;
  },
};

let userProxy = new Proxy(user, {
  get(target, prop, receiver) {
    return target[prop]; // âŒ target = user, this = user
  },
});

let admin = {
  __proto__: userProxy,
  _name: "Admin",
};
alert(admin.name); // "Guest" âŒ (mong Ä‘á»£i "Admin")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Fix: dÃ¹ng Reflect.get vá»›i receiver
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let userProxy2 = new Proxy(user, {
  get(target, prop, receiver) {
    return Reflect.get(target, prop, receiver); // âœ… this = admin
    // Hoáº·c ngáº¯n gá»n: return Reflect.get(...arguments);
  },
});

let admin2 = { __proto__: userProxy2, _name: "Admin" };
alert(admin2.name); // "Admin" âœ…

// receiver = object ban Ä‘áº§u gá»i (admin)
// Reflect.get truyá»n receiver lÃ m this cho getter
// â†’ getter cháº¡y vá»›i this = admin â†’ this._name = "Admin"
```

### Proxy Limitations

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Built-in objects â€” Internal Slots
// Map, Set, Date, Promise dÃ¹ng internal slots
// Proxy KHÃ”NG cÃ³ slots â†’ methods fail
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let map = new Map();
let proxy = new Proxy(map, {});
// proxy.set('test', 1); // âŒ Error! (this.[[MapData]] not found)

// âœ… Fix: bind methods vá» target
let proxy2 = new Proxy(map, {
  get(target, prop, receiver) {
    let value = Reflect.get(...arguments);
    return typeof value == "function" ? value.bind(target) : value;
  },
});
proxy2.set("test", 1); // âœ… Works!
alert(proxy2.get("test")); // 1

// âš ï¸ Array KHÃ”NG dÃ¹ng internal slots â†’ proxy array OK!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Private Fields (#) â€” cÅ©ng dÃ¹ng internal slots
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class User {
  #name = "Guest";
  getName() {
    return this.#name;
  }
}
let u = new User();
u = new Proxy(u, {});
// u.getName(); // âŒ Error! (private field not found)

// âœ… Fix: same pattern â€” bind methods
u = new Proxy(new User(), {
  get(target, prop, receiver) {
    let value = Reflect.get(...arguments);
    return typeof value == "function" ? value.bind(target) : value;
  },
});
alert(u.getName()); // "Guest" âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. proxy !== target (khÃ¡c object)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Proxy vÃ  target lÃ  2 objects KHÃC NHAU
// â†’ Set, Map, WeakMap key: proxy â‰  target
// â†’ Strict equality: proxy !== target
// â†’ KHÃ”NG THá»‚ intercept ===
```

### Revocable Proxies

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Proxy.revocable â€” proxy cÃ³ thá»ƒ "thu há»“i"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let object = { data: "Valuable data" };
let { proxy, revoke } = Proxy.revocable(object, {});

alert(proxy.data); // "Valuable data"
revoke(); // Thu há»“i proxy!
// alert(proxy.data); // âŒ TypeError (revoked)

// DÃ¹ng WeakMap Ä‘á»ƒ quáº£n lÃ½ revoke functions:
let revokes = new WeakMap();
let { proxy: p, revoke: r } = Proxy.revocable(object, {});
revokes.set(p, r);

// Cáº§n revoke â†’ tÃ¬m trong WeakMap
revokes.get(p)(); // revoke!
// WeakMap cho phÃ©p GC khi proxy khÃ´ng cÃ²n referenced
```

### á»¨ng Dá»¥ng Thá»±c Táº¿

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Negative Array Index
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let array = [1, 2, 3];
array = new Proxy(array, {
  get(target, prop, receiver) {
    if (prop < 0) {
      prop = +prop + target.length; // -1 â†’ length-1
    }
    return Reflect.get(target, prop, receiver);
  },
});
alert(array[-1]); // 3 (= array[2])
alert(array[-2]); // 2 (= array[1])

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Observable Object â€” theo dÃµi thay Ä‘á»•i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let handlers = Symbol("handlers");

function makeObservable(target) {
  target[handlers] = [];
  target.observe = function (handler) {
    this[handlers].push(handler);
  };

  return new Proxy(target, {
    set(target, property, value, receiver) {
      let success = Reflect.set(...arguments);
      if (success) {
        target[handlers].forEach((h) => h(property, value));
      }
      return success;
    },
  });
}

let user = makeObservable({});
user.observe((key, value) => alert(`SET ${key}=${value}`));
user.name = "John"; // alerts: SET name=John
```

### Tá»•ng Há»£p: Proxy & Reflect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROXY & REFLECT â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PROXY:                                                         â”‚
â”‚  â€¢ Wrapper cháº·n operations trÃªn object/function                â”‚
â”‚  â€¢ handler = {} â†’ transparent wrapper (forward táº¥t cáº£)         â”‚
â”‚  â€¢ Traps: get, set, has, deleteProperty, apply, construct,...  â”‚
â”‚  â€¢ set trap PHáº¢I return true náº¿u thÃ nh cÃ´ng                    â”‚
â”‚  â€¢ Proxy nÃªn THAY THáº¾ target á»Ÿ má»i nÆ¡i                        â”‚
â”‚                                                                 â”‚
â”‚  REFLECT:                                                       â”‚
â”‚  â€¢ Má»—i trap â†” 1 Reflect method (cÃ¹ng tÃªn, cÃ¹ng args)          â”‚
â”‚  â€¢ Reflect.get truyá»n receiver Ä‘Ãºng cho getters                â”‚
â”‚  â€¢ return Reflect.xxx(...arguments) = safe forwarding          â”‚
â”‚                                                                 â”‚
â”‚  LIMITATIONS:                                                   â”‚
â”‚  â€¢ Built-in (Map/Set/Date) â€” internal slots â†’ bind methods     â”‚
â”‚  â€¢ Private fields (#) â€” cÅ©ng cáº§n bind methods                  â”‚
â”‚  â€¢ proxy !== target (khÃ¡c object, === khÃ´ng intercept Ä‘Æ°á»£c)     â”‚
â”‚  â€¢ Performance: property access cháº­m hÆ¡n vÃ i láº§n               â”‚
â”‚                                                                 â”‚
â”‚  USE CASES:                                                     â”‚
â”‚  â€¢ Default values, validation, logging, access control         â”‚
â”‚  â€¢ Observable objects, negative index, type checking            â”‚
â”‚  â€¢ Function decorators (giá»¯ name/length), revocable access     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 24. Event Loop: Microtasks & Macrotasks â€” VÃ²ng Láº·p Sá»± Kiá»‡n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT LOOP â€” Báº£n Äá»“ Tá»•ng Quan                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Láº¥y task CÅ¨ NHáº¤T tá»« Macrotask Queue â†’ cháº¡y         â”‚   â”‚
â”‚  â”‚     (script, setTimeout, setInterval, I/O, UI events)   â”‚   â”‚
â”‚  â”‚                         â†“                                â”‚   â”‚
â”‚  â”‚  2. Cháº¡y Táº¤T Cáº¢ Microtasks (cho Ä‘áº¿n háº¿t)               â”‚   â”‚
â”‚  â”‚     (Promise.then/catch/finally, queueMicrotask, await) â”‚   â”‚
â”‚  â”‚                         â†“                                â”‚   â”‚
â”‚  â”‚  3. Render (náº¿u cáº§n)                                     â”‚   â”‚
â”‚  â”‚     (DOM changes â†’ paint â†’ composite)                   â”‚   â”‚
â”‚  â”‚                         â†“                                â”‚   â”‚
â”‚  â”‚  4. Náº¿u Macrotask Queue rá»—ng â†’ chá» task má»›i            â”‚   â”‚
â”‚  â”‚                         â†“                                â”‚   â”‚
â”‚  â”‚  5. Quay láº¡i bÆ°á»›c 1                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Macrotask Queue    [script] [click] [setTimeout] ...   â”‚    â”‚
â”‚  â”‚  (FIFO â€” first come, first served)                      â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  Microtask Queue    [.then] [.catch] [queueMicrotask]   â”‚    â”‚
â”‚  â”‚  (cháº¡y Háº¾T sau Má»–I macrotask, TRÆ¯á»šC render)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Rendering KHÃ”NG xáº£y ra khi engine Ä‘ang cháº¡y task          â”‚
â”‚  âš ï¸ Task quÃ¡ lÃ¢u â†’ browser hiá»‡n "Page Unresponsive"           â”‚
â”‚  âš ï¸ Microtasks cháº¡y TRÆ¯á»šC render vÃ  TRÆ¯á»šC macrotask tiáº¿p      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Event Loop â€” thuáº­t toÃ¡n cÆ¡ báº£n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ²ng láº·p vÃ´ táº­n:
// 1. Chá» task â†’ 2. Cháº¡y task â†’ 3. Chá» tiáº¿p
// Engine "ngá»§" khi khÃ´ng cÃ³ task (gáº§n 0 CPU)

// VÃ­ dá»¥ cÃ¡c MACROTASKS:
// - <script src="..."> load xong â†’ cháº¡y script
// - User click/mousemove â†’ dispatch event + handlers
// - setTimeout/setInterval â†’ cháº¡y callback khi Ä‘áº¿n giá»
// - I/O operations (Node.js)

// VÃ­ dá»¥ cÃ¡c MICROTASKS:
// - Promise .then/.catch/.finally handlers
// - await (dÆ°á»›i hood = promise handling)
// - queueMicrotask(func)
// - MutationObserver callbacks
```

### Macrotask vs Microtask â€” Thá»© Tá»± Thá»±c Thi

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  THá»¨ Tá»° THá»°C THI â€” Chi tiáº¿t                                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚    Macrotask 1 (script)                                      â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚    â”‚  console.log(1)        â†’ output: 1  â”‚                  â”‚
  â”‚    â”‚  setTimeout(cb2)       â†’ macro queue â”‚                  â”‚
  â”‚    â”‚  Promise.then(cb3)     â†’ micro queue â”‚                  â”‚
  â”‚    â”‚  console.log(7)        â†’ output: 7  â”‚                  â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                    â†“                                          â”‚
  â”‚    ALL Microtasks                                            â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚    â”‚  cb3: console.log(3)   â†’ output: 3  â”‚                  â”‚
  â”‚    â”‚  cb5: console.log(5)   â†’ output: 5  â”‚                  â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                    â†“                                          â”‚
  â”‚    ğŸ¨ Render (náº¿u cáº§n)                                       â”‚
  â”‚                    â†“                                          â”‚
  â”‚    Macrotask 2 (setTimeout cb2)                              â”‚
  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
  â”‚    â”‚  console.log(2)        â†’ output: 2  â”‚                  â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
  â”‚                    â†“                                          â”‚
  â”‚    ALL Microtasks (náº¿u cÃ³) â†’ ğŸ¨ Render â†’ Macrotask 3...    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ kinh Ä‘iá»ƒn â€” Thá»© tá»± output
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setTimeout(() => alert("timeout")); // macrotask

Promise.resolve().then(() => alert("promise")); // microtask

alert("code"); // sync

// Output: "code" â†’ "promise" â†’ "timeout"
// 1. "code" = sync, cháº¡y ngay
// 2. "promise" = microtask, cháº¡y SAU sync, TRÆ¯á»šC macrotask
// 3. "timeout" = macrotask, cháº¡y SAU microtasks

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ phá»©c táº¡p â€” phÃ¢n tÃ­ch chi tiáº¿t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log(1); // sync â†’ 1

setTimeout(() => console.log(2)); // macro queue

Promise.resolve().then(() => console.log(3)); // micro queue

Promise.resolve().then(
  () => setTimeout(() => console.log(4)), // micro â†’ táº¡o macro
);

Promise.resolve().then(() => console.log(5)); // micro queue

setTimeout(() => console.log(6)); // macro queue

console.log(7); // sync â†’ 7

// Output: 1 7 3 5 2 6 4
//
// PhÃ¢n tÃ­ch:
// SYNC:      1, 7  (cháº¡y ngay)
// MICRO:     3, 5  (Promise.then â€” sau sync, trÆ°á»›c macro)
//            + setTimeout(â†’4) Ä‘Æ°á»£c THÃŠM vÃ o macro queue
// MACRO:     2, 6, 4  (theo thá»© tá»± FIFO)
```

### á»¨ng Dá»¥ng 1: Chia Nhá» CPU-Hungry Tasks

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  SPLITTING HEAVY TASKS                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  âŒ KHÃ”NG chia nhá» â†’ UI ÄÃ“NG BÄ‚NG:                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  Task náº·ng (1 tá»· iterations)                       â”‚      â”‚
  â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚      â”‚
  â”‚  â”‚  â† UI blocked, click/scroll khÃ´ng hoáº¡t Ä‘á»™ng â†’     â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  âœ… Chia nhá» báº±ng setTimeout â†’ UI PHáº¢N Há»’I:                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”              â”‚
  â”‚  â”‚Part 1â”‚â†’â”‚Part 2â”‚â†’â”‚Part 3â”‚â†’â”‚Part 4â”‚â†’â”‚Part 5â”‚â†’...          â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜              â”‚
  â”‚       â†•        â†•        â†•        â†•        â†•                 â”‚
  â”‚     click   render   scroll  render   click                 â”‚
  â”‚     (browser xá»­ lÃ½ events giá»¯a cÃ¡c pháº§n)                   â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Task náº·ng â€” UI Ä‘Ã³ng bÄƒng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let i = 0;
let start = Date.now();

function count() {
  for (let j = 0; j < 1e9; j++) {
    i++;
  }
  alert("Done in " + (Date.now() - start) + "ms");
}
count(); // â† Browser hang!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Chia nhá» báº±ng setTimeout â€” UI pháº£n há»“i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let i = 0;
let start = Date.now();

function count() {
  // LÃ m 1 pháº§n (1 triá»‡u iterations)
  do {
    i++;
  } while (i % 1e6 != 0);

  if (i == 1e9) {
    alert("Done in " + (Date.now() - start) + "ms");
  } else {
    setTimeout(count); // schedule pháº§n tiáº¿p theo
  }
}
count();
// UI váº«n responsive! Browser xá»­ lÃ½ events giá»¯a cÃ¡c pháº§n

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Tá»‘i Æ°u: schedule TRÆ¯á»šC khi lÃ m â†’ nhanh hÆ¡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function count() {
  if (i < 1e9 - 1e6) {
    setTimeout(count); // schedule TRÆ¯á»šC â†’ giáº£m delay
  }

  do {
    i++;
  } while (i % 1e6 != 0);

  if (i == 1e9) {
    alert("Done in " + (Date.now() - start) + "ms");
  }
}
// âš ï¸ Nested setTimeout delay tá»‘i thiá»ƒu 4ms
// â†’ Schedule sá»›m = cháº¡y sá»›m hÆ¡n!
```

### á»¨ng Dá»¥ng 2: Progress Indication

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM paint CHá»ˆ xáº£y ra SAU KHI task hoÃ n thÃ nh
// â†’ DÃ¹ng setTimeout Ä‘á»ƒ chia nhá» â†’ repaint giá»¯a cÃ¡c pháº§n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Chá»‰ tháº¥y giÃ¡ trá»‹ CUá»I (DOM paint sau task)
function count() {
  for (let i = 0; i < 1e6; i++) {
    progress.innerHTML = i; // KHÃ”NG repaint trong loop!
  }
}
count(); // â†’ chá»‰ tháº¥y 999999

// âœ… Chia nhá» â†’ repaint giá»¯a cÃ¡c pháº§n = progress bar!
let i = 0;
function count() {
  do {
    i++;
    progress.innerHTML = i; // cáº­p nháº­t UI
  } while (i % 1e3 != 0);

  if (i < 1e7) {
    setTimeout(count); // â†’ browser repaint â†’ tiáº¿p
  }
}
count(); // â†’ tháº¥y progress tÄƒng dáº§n!
```

### á»¨ng Dá»¥ng 3: HÃ nh Äá»™ng Sau Event

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// setTimeout(f, 0) â†’ cháº¡y f SAU KHI event bubbling xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

menu.onclick = function () {
  // ... xá»­ lÃ½ click

  let customEvent = new CustomEvent("menu-open", {
    bubbles: true,
  });

  // Dispatch SAU KHI click event hoÃ n táº¥t (bubbling done)
  setTimeout(() => menu.dispatchEvent(customEvent));
};

// âš ï¸ KhÃ´ng dÃ¹ng setTimeout â†’ customEvent dispatch
//    TRONG LÃšC click event chÆ°a bubbling xong
// âœ… setTimeout(f, 0) Ä‘áº£m báº£o f cháº¡y á»Ÿ macrotask SAU
```

### queueMicrotask vs setTimeout

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  queueMicrotask vs setTimeout                                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚                  â”‚  setTimeout(f, 0)                â”‚     â”‚
  â”‚  â”‚  queueMicrotask  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
  â”‚  â”‚  (f)             â”‚  Macrotask queue                 â”‚     â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
  â”‚  â”‚  Microtask queue â”‚  Cháº¡y SAU render                 â”‚     â”‚
  â”‚  â”‚  Cháº¡y TRÆ¯á»šC     â”‚  (delay tá»‘i thiá»ƒu 4ms náº¿u       â”‚     â”‚
  â”‚  â”‚  render          â”‚   nested)                        â”‚     â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
  â”‚  â”‚  Async nhÆ°ng     â”‚  Async, browser CÃ“ THá»‚          â”‚     â”‚
  â”‚  â”‚  KHÃ”NG cho       â”‚  repaint giá»¯a cÃ¡c láº§n           â”‚     â”‚
  â”‚  â”‚  browser repaint â”‚                                  â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ queueMicrotask cháº¡y TRÆ¯á»šC render â†’ UI KHÃ”NG cáº­p nháº­t  â”‚
  â”‚  âš ï¸ DÃ¹ng queueMicrotask khi cáº§n async nhÆ°ng CÃ™NG state     â”‚
  â”‚  âš ï¸ DÃ¹ng setTimeout khi cáº§n browser repaint (progress bar)  â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// queueMicrotask â€” async TRÆ¯á»šC render
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ queueMicrotask cho progress â†’ KHÃ”NG tháº¥y progress
let i = 0;
function count() {
  do {
    i++;
    progress.innerHTML = i;
  } while (i % 1e3 != 0);

  if (i < 1e6) {
    queueMicrotask(count); // microtask â†’ KHÃ”NG repaint!
  }
}
count(); // â†’ chá»‰ tháº¥y giÃ¡ trá»‹ cuá»‘i (giá»‘ng sync)

// âœ… DÃ¹ng queueMicrotask khi cáº§n:
// - Async execution nhÆ°ng CÃ™NG environment state
// - KhÃ´ng cÃ³ mouse changes, network data giá»¯a microtasks
// - Consistency giá»¯a cÃ¡c microtasks

// âœ… DÃ¹ng setTimeout khi cáº§n:
// - Browser repaint (progress bar, animation)
// - Xá»­ lÃ½ user events giá»¯a cÃ¡c pháº§n
// - Chia nhá» CPU-heavy tasks
```

### Web Workers â€” Parallel Processing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Web Workers â€” cháº¡y code á»Ÿ THREAD RIÃŠNG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Main thread:
const worker = new Worker("heavy-calc.js");
worker.postMessage({ data: bigArray });

worker.onmessage = (e) => {
  console.log("Result:", e.data);
};

// heavy-calc.js (Worker thread):
onmessage = (e) => {
  const result = heavyCalculation(e.data);
  postMessage(result); // gá»­i káº¿t quáº£ vá» main thread
};

// âš ï¸ Workers KHÃ”NG cÃ³ quyá»n truy cáº­p DOM
// âš ï¸ Workers cÃ³ event loop RIÃŠNG
// âš ï¸ Giao tiáº¿p qua postMessage / onmessage
// âœ… DÃ¹ng cho: heavy calculations, sá»­ dá»¥ng nhiá»u CPU cores
```

### Tá»•ng Há»£p: Event Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT LOOP â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ALGORITHM:                                                     â”‚
â”‚  1. Dequeue + run 1 MACROTASK (oldest)                          â”‚
â”‚  2. Run ALL MICROTASKS (cho Ä‘áº¿n háº¿t queue)                      â”‚
â”‚  3. Render (náº¿u cáº§n)                                            â”‚
â”‚  4. Náº¿u macro queue rá»—ng â†’ chá»                                 â”‚
â”‚  5. Quay láº¡i bÆ°á»›c 1                                             â”‚
â”‚                                                                 â”‚
â”‚  MACROTASKS:                                                    â”‚
â”‚  setTimeout, setInterval, I/O, UI events, <script>             â”‚
â”‚  â†’ Schedule: setTimeout(f, 0)                                   â”‚
â”‚                                                                 â”‚
â”‚  MICROTASKS:                                                    â”‚
â”‚  Promise.then/catch/finally, await, queueMicrotask             â”‚
â”‚  â†’ Cháº¡y TRÆ¯á»šC render, TRÆ¯á»šC macro tiáº¿p                         â”‚
â”‚  â†’ Äáº£m báº£o CÃ™NG environment state                              â”‚
â”‚                                                                 â”‚
â”‚  USE CASES:                                                     â”‚
â”‚  â€¢ Chia nhá» CPU-heavy tasks (setTimeout + chunks)              â”‚
â”‚  â€¢ Progress indication (repaint giá»¯a setTimeout)               â”‚
â”‚  â€¢ Post-event actions (setTimeout sau bubbling)                â”‚
â”‚  â€¢ Async cÃ¹ng state (queueMicrotask)                           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Rendering blocked trong khi task Ä‘ang cháº¡y                â”‚
â”‚  âš ï¸ Nested setTimeout delay â‰¥ 4ms                              â”‚
â”‚  âš ï¸ Microtask quÃ¡ nhiá»u â†’ block render (giá»‘ng sync)            â”‚
â”‚  âš ï¸ Web Workers: parallel thread, KHÃ”NG cÃ³ DOM access          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 25. Garbage Collection â€” Thu Gom RÃ¡c

### Tá»•ng Quan: Reachability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GARBAGE COLLECTION â€” Báº£n Äá»“ Tá»•ng Quan                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  KhÃ¡i niá»‡m cá»‘t lÃµi: REACHABILITY (kháº£ nÄƒng tiáº¿p cáº­n)          â”‚
â”‚                                                                 â”‚
â”‚  ROOTS (gá»‘c â€” luÃ´n reachable):                                  â”‚
â”‚  â€¢ Function Ä‘ang cháº¡y + local variables + parameters           â”‚
â”‚  â€¢ Chuá»—i nested calls hiá»‡n táº¡i                                 â”‚
â”‚  â€¢ Global variables                                             â”‚
â”‚                                                                 â”‚
â”‚  Reachable = tiáº¿p cáº­n Ä‘Æ°á»£c tá»« root qua chuá»—i references       â”‚
â”‚  Unreachable = KHÃ”NG ai trá» Ä‘áº¿n tá»« root â†’ Bá»Š XÃ“A              â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ref   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ref   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  <root>   â”‚ â”€â”€â”€â”€â”€â†’ â”‚ Object A â”‚ â”€â”€â”€â”€â”€â†’ â”‚ Object B â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       âœ… root           âœ… reachable       âœ… reachable        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ Object C â”‚ â†â”€â”€â”€â”€â”€â†’ â”‚ Object D â”‚  â† khÃ´ng ai tá»« root trá» Ä‘áº¿n â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚       âŒ unreachable    âŒ unreachable (cáº£ "Ä‘áº£o" bá»‹ xÃ³a)       â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ CÃ³ reference â‰  reachable (náº¿u ko ná»‘i vá»›i root)            â”‚
â”‚  âš ï¸ Outgoing refs khÃ´ng cá»©u object â€” chá»‰ INCOMING tá»« root    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VÃ­ Dá»¥ CÆ¡ Báº£n â€” References & GC

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Tham chiáº¿u Ä‘Æ¡n giáº£n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//  <global>
//     â”‚
//   user â”€â”€â†’ { name: "John" }
let user = { name: "John" };

//  <global>
//   user: null     ğŸ—‘ï¸ { name: "John" }  â† UNREACHABLE!
user = null;
// â†’ Object bá»‹ GC xÃ³a khá»i memory

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Hai references â†’ object sá»‘ng sÃ³t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

//  <global>
//   user â”€â”€â”
//          â”œâ”€â”€â†’ { name: "John" }
//  admin â”€â”€â”˜
let user = { name: "John" };
let admin = user; // copy reference

user = null;
// admin váº«n trá» â†’ object VáºªN reachable âœ…
// Chá»‰ khi admin = null â†’ object má»›i bá»‹ GC xÃ³a
```

### Interlinked Objects â€” Äáº£o Unreachable

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Objects liÃªn káº¿t chÃ©o â€” "Unreachable Island"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function marry(man, woman) {
  woman.husband = man;
  man.wife = woman;
  return { father: man, mother: woman };
}

let family = marry({ name: "John" }, { name: "Ann" });

//  <global>
//     â”‚
//   family â”€â”€â†’ { father, mother }
//                 â”‚         â”‚
//                 â–¼         â–¼
//          {John} â†â”€â”€wife/husbandâ”€â”€â†’ {Ann}

// XÃ³a 2 incoming refs Ä‘áº¿n John:
delete family.father;
delete family.mother.husband;
// â†’ John KHÃ”NG CÃ’N incoming ref tá»« root â†’ GC xÃ³a!
// âš ï¸ Outgoing refs (John.wife) KHÃ”NG cá»©u John

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cáº£ "Ä‘áº£o" biáº¿n máº¥t khi máº¥t káº¿t ná»‘i root
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

family = null;
// John â†â†’ Ann váº«n liÃªn káº¿t NHÆ¯NG:
// KhÃ´ng ai tá»« root trá» Ä‘áº¿n â†’ Cáº¢ Äáº¢O bá»‹ GC xÃ³a!
// âš ï¸ "Being referenced" â‰  "Being reachable from root"
```

### Mark-and-Sweep Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MARK-AND-SWEEP â€” Thuáº­t ToÃ¡n GC CÆ¡ Báº£n                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 1: MARK roots                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚<root>â”‚ âœ… marked                                              â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜                                                       â”‚
â”‚     â”‚                                                           â”‚
â”‚  BÆ°á»›c 2: Äi theo references tá»« roots â†’ mark                    â”‚
â”‚     â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  ref   â”Œâ”€â”€â”€â”€â”€â”€â”  ref   â”Œâ”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ Obj1 â”‚ âœ… â”€â”€â”€â†’ â”‚ Obj2 â”‚ âœ… â”€â”€â”€â†’ â”‚ Obj3 â”‚ âœ…                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 3: Tiáº¿p tá»¥c cho Ä‘áº¿n háº¿t reachable refs                  â”‚
â”‚                                                                 â”‚
â”‚  BÆ°á»›c 4: SWEEP â€” xÃ³a táº¥t cáº£ objects KHÃ”NG marked               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ ObjX â”‚ âŒ â”€â”€â”€â†’ â”‚ ObjY â”‚ âŒ  â† cáº£ 2 bá»‹ xÃ³a!                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                 â”‚
â”‚  HÃ¬nh dung: Ä‘á»• sÆ¡n tá»« roots, cháº£y theo references              â”‚
â”‚  SÆ¡n Ä‘áº¿n Ä‘Ã¢u = reachable. KhÃ´ng sÆ¡n = xÃ³a!                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### V8 Engine Optimizations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  V8 GC OPTIMIZATIONS                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. GENERATIONAL COLLECTION                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  Young Generation    â”‚  Old Generation  â”‚                    â”‚
â”‚  â”‚  (Scavenger)         â”‚  (Mark-Compact)  â”‚                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
â”‚  â”‚  Objects má»›i táº¡o     â”‚  Sá»‘ng sÃ³t nhiá»u  â”‚                    â”‚
â”‚  â”‚  Pháº§n lá»›n cháº¿t nhanh â”‚  GC cycles       â”‚                    â”‚
â”‚  â”‚  GC thÆ°á»ng xuyÃªn     â”‚  GC Ã­t hÆ¡n       â”‚                    â”‚
â”‚  â”‚  Nhanh (< 1ms)       â”‚  Cháº­m hÆ¡n        â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚  â†’ Objects "sá»‘ng lÃ¢u" Ä‘Æ°á»£c promote sang Old Gen                â”‚
â”‚                                                                 â”‚
â”‚  2. INCREMENTAL COLLECTION                                      â”‚
â”‚  â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”                                     â”‚
â”‚  â”‚GCâ”‚â†’â”‚JSâ”‚â†’â”‚GCâ”‚â†’â”‚JSâ”‚â†’â”‚GCâ”‚â†’...                                  â”‚
â”‚  â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜                                     â”‚
â”‚  Chia marking thÃ nh nhiá»u pháº§n nhá»                              â”‚
â”‚  â†’ Nhiá»u micro-pauses thay vÃ¬ 1 big pause                      â”‚
â”‚                                                                 â”‚
â”‚  3. IDLE-TIME COLLECTION                                        â”‚
â”‚  GC cháº¡y khi CPU ráº£nh (idle periods)                            â”‚
â”‚  â†’ Giáº£m áº£nh hÆ°á»Ÿng Ä‘áº¿n execution                                â”‚
â”‚                                                                 â”‚
â”‚  4. CONCURRENT MARKING                                          â”‚
â”‚  Worker threads mark objects Äá»’NG THá»œI vá»›i JS execution         â”‚
â”‚  â†’ Giáº£m main-thread pause time                                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Leaks â€” NguyÃªn NhÃ¢n Phá»• Biáº¿n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4 loáº¡i Memory Leak thÆ°á»ng gáº·p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1ï¸âƒ£ Global variables (vÃ´ tÃ¬nh)
function foo() {
  bar = "leak"; // thiáº¿u let/const â†’ global variable!
}
// âœ… Fix: luÃ´n dÃ¹ng let/const, 'use strict'

// 2ï¸âƒ£ Forgotten timers
let data = fetchData();
setInterval(() => {
  node.innerHTML = JSON.stringify(data);
}, 1000);
// data vÃ  node KHÃ”NG BAO GIá»œ Ä‘Æ°á»£c GC!
// âœ… Fix: clearInterval khi khÃ´ng cáº§n

// 3ï¸âƒ£ Closures giá»¯ reference
function outer() {
  let largeArray = new Array(1000000);
  return function inner() {
    // inner giá»¯ reference Ä‘áº¿n largeArray
    // dÃ¹ KHÃ”NG dÃ¹ng â†’ váº«n khÃ´ng bá»‹ GC!
    console.log("hello");
  };
}
let fn = outer(); // largeArray váº«n sá»‘ng!
// âœ… Fix: fn = null khi khÃ´ng cáº§n, hoáº·c set largeArray = null trong outer

// 4ï¸âƒ£ Detached DOM nodes
let button = document.getElementById("btn");
document.body.removeChild(button);
// button variable váº«n giá»¯ reference â†’ DOM node sá»‘ng trong memory!
// âœ… Fix: button = null sau khi remove
```

### Giáº£i PhÃ³ng Bá»™ Nhá»› Thá»§ CÃ´ng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Patterns giáº£i phÃ³ng memory
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. GÃ¡n null Ä‘á»ƒ cáº¯t reference
let largeData = loadBigData();
processData(largeData);
largeData = null; // â†’ GC cÃ³ thá»ƒ thu gom

// 2. WeakMap/WeakSet â€” auto GC khi key háº¿t referenced
let cache = new WeakMap();
let obj = { id: 1 };
cache.set(obj, "cached data");
obj = null; // â†’ cache entry Tá»° Äá»˜NG bá»‹ xÃ³a bá»Ÿi GC!

// 3. Clear timers
let timer = setInterval(doWork, 1000);
// Khi khÃ´ng cáº§n:
clearInterval(timer);
timer = null;

// 4. Remove event listeners
element.addEventListener("click", handler);
// Khi khÃ´ng cáº§n:
element.removeEventListener("click", handler);

// âš ï¸ KHÃ”NG THá»‚ force GC hoáº·c prevent GC
// GC cháº¡y Tá»° Äá»˜NG, chÃºng ta chá»‰ cÃ³ thá»ƒ:
// â†’ Cáº¯t references (gÃ¡n null)
// â†’ DÃ¹ng WeakMap/WeakSet
// â†’ Dá»n timers/listeners
```

### Tá»•ng Há»£p: Garbage Collection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GARBAGE COLLECTION â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CORE CONCEPT:                                                  â”‚
â”‚  â€¢ Reachable = tiáº¿p cáº­n Ä‘Æ°á»£c tá»« ROOT qua chuá»—i references     â”‚
â”‚  â€¢ Unreachable = khÃ´ng ai tá»« root trá» Ä‘áº¿n â†’ Bá»Š XÃ“A            â”‚
â”‚  â€¢ Referenced â‰  Reachable (Ä‘áº£o interlinked váº«n bá»‹ xÃ³a)        â”‚
â”‚  â€¢ Chá»‰ INCOMING refs quan trá»ng, outgoing khÃ´ng cá»©u object    â”‚
â”‚                                                                 â”‚
â”‚  ALGORITHM:                                                     â”‚
â”‚  â€¢ Mark-and-Sweep: mark tá»« roots â†’ sweep unmarked             â”‚
â”‚  â€¢ V8 Generational: Young (Scavenger) + Old (Mark-Compact)    â”‚
â”‚  â€¢ Incremental: chia marking thÃ nh micro-pauses                â”‚
â”‚  â€¢ Idle-time + Concurrent: giáº£m main-thread pause              â”‚
â”‚                                                                 â”‚
â”‚  MEMORY LEAKS:                                                  â”‚
â”‚  â€¢ Global vars (thiáº¿u let/const)                               â”‚
â”‚  â€¢ Forgotten timers (setInterval khÃ´ng clear)                  â”‚
â”‚  â€¢ Closures giá»¯ reference lá»›n                                  â”‚
â”‚  â€¢ Detached DOM nodes (remove nhÆ°ng cÃ²n reference)             â”‚
â”‚                                                                 â”‚
â”‚  GIáº¢I PHÃ“NG:                                                    â”‚
â”‚  â€¢ GÃ¡n null cáº¯t reference                                      â”‚
â”‚  â€¢ WeakMap/WeakSet tá»± dá»n                                      â”‚
â”‚  â€¢ clearInterval/clearTimeout                                  â”‚
â”‚  â€¢ removeEventListener                                          â”‚
â”‚  â€¢ âš ï¸ KHÃ”NG thá»ƒ force/prevent GC                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 26. Objects â€” Äá»‘i TÆ°á»£ng

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTS â€” Báº£n Äá»“ Tá»•ng Quan                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Object = "keyed collection" â€” tá»§ há»“ sÆ¡ vá»›i nhÃ£n tÃªn          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  user {                                        â”‚               â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚               â”‚
â”‚  â”‚    â”‚  name    â”‚    "John"        â”‚            â”‚               â”‚
â”‚  â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚               â”‚
â”‚  â”‚    â”‚  age     â”‚    30            â”‚            â”‚               â”‚
â”‚  â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚               â”‚
â”‚  â”‚    â”‚  isAdmin â”‚    true          â”‚            â”‚               â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚               â”‚
â”‚  â”‚        KEY (string/symbol)  VALUE (any type)  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  TRUY Cáº¬P:                                                      â”‚
â”‚  â€¢ Dot notation:    obj.property        (key Ä‘Æ¡n giáº£n)         â”‚
â”‚  â€¢ Square brackets: obj["property"]     (key báº¥t ká»³)           â”‚
â”‚  â€¢ Computed key:    { [expr]: value }   (key tá»« biáº¿n/biá»ƒu thá»©c)â”‚
â”‚                                                                 â”‚
â”‚  OPERATORS:                                                     â”‚
â”‚  â€¢ delete obj.prop          â€” xÃ³a property                     â”‚
â”‚  â€¢ "key" in obj             â€” kiá»ƒm tra tá»“n táº¡i                â”‚
â”‚  â€¢ for (let key in obj)     â€” duyá»‡t táº¥t cáº£ keys               â”‚
â”‚                                                                 â”‚
â”‚  THá»¨ Tá»° PROPERTIES:                                             â”‚
â”‚  â€¢ Integer keys â†’ sorted ascending (1, 41, 44, 49)            â”‚
â”‚  â€¢ Non-integer keys â†’ theo thá»© tá»± táº¡o (creation order)        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡o Object â€” 2 CÃº PhÃ¡p

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object constructor vs Object literal
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user1 = new Object(); // "object constructor" syntax
let user2 = {}; // "object literal" syntax â† THÆ¯á»œNG DÃ™NG

// Táº¡o object vá»›i properties ngay
let user = {
  name: "John", // key "name", value "John"
  age: 30, // key "age", value 30
}; // â† trailing comma: OK, dá»… thÃªm/xÃ³a/di chuyá»ƒn

// âš ï¸ Trailing comma (dáº¥u pháº©y cuá»‘i) = best practice
// â†’ Táº¥t cáº£ dÃ²ng Ä‘á»u giá»‘ng format â†’ dá»… diff/move
```

### Truy Cáº­p Properties

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. DOT NOTATION â€” key pháº£i lÃ  valid identifier
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John", age: 30 };

alert(user.name); // "John" â€” Ä‘á»c
user.isAdmin = true; // thÃªm property má»›i
delete user.age; // xÃ³a property

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. SQUARE BRACKETS â€” key báº¥t ká»³ (any string)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {};

// Multiword key â†’ Báº®T BUá»˜C dÃ¹ng []
user["likes birds"] = true;
alert(user["likes birds"]); // true
delete user["likes birds"];

// âŒ user.likes birds â†’ SyntaxError!
// Dot notation yÃªu cáº§u: khÃ´ng space, khÃ´ng báº¯t Ä‘áº§u báº±ng sá»‘,
//                        khÃ´ng kÃ½ tá»± Ä‘áº·c biá»‡t (trá»« $ vÃ  _)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. Square brackets vá»›i VARIABLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let key = "name";
alert(user[key]); // = user["name"] = user.name
// âŒ user.key    â†’ tÃ¬m property TÃŠN LÃ€ "key", KHÃ”NG pháº£i giÃ¡ trá»‹ biáº¿n key!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4. COMPUTED PROPERTIES â€” key tá»« biá»ƒu thá»©c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fruit = "apple";

let bag = {
  [fruit]: 5, // bag.apple = 5
  [fruit + "Juice"]: 10, // bag.appleJuice = 10
};

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
// let bag = {};
// bag[fruit] = 5;
// bag[fruit + "Juice"] = 10;
```

### Property Value Shorthand

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Khi property name = variable name â†’ viáº¿t táº¯t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function makeUser(name, age) {
  return {
    name, // = name: name
    age, // = age: age
  };
}

let user = makeUser("John", 30);
// user = { name: "John", age: 30 }

// âœ… CÃ³ thá»ƒ MIX shorthand vÃ  bÃ¬nh thÆ°á»ng:
let user = {
  name, // shorthand
  age: 30, // bÃ¬nh thÆ°á»ng
};
```

### Property Names â€” KhÃ´ng Giá»›i Háº¡n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object property names KHÃ”NG bá»‹ háº¡n cháº¿ nhÆ° biáº¿n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Reserved words â†’ OK cho property names!
let obj = {
  for: 1,
  let: 2,
  return: 3,
};
alert(obj.for + obj.let + obj.return); // 6

// Number keys â†’ tá»± Ä‘á»™ng convert thÃ nh string
let obj = { 0: "test" }; // = { "0": "test" }
alert(obj["0"]); // "test"
alert(obj[0]); // "test" â€” 0 convert thÃ nh "0"

// âš ï¸ Gotcha: __proto__
let obj = {};
obj.__proto__ = 5; // assign number
alert(obj.__proto__); // [object Object] â€” bá»‹ ignore!
// â†’ __proto__ lÃ  special property (liÃªn quan prototype)
```

### Kiá»ƒm Tra Property â€” "in" Operator

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Truy cáº­p property khÃ´ng tá»“n táº¡i â†’ undefined (KHÃ”NG error)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };
alert(user.noSuchProp); // undefined (khÃ´ng lá»—i)
alert(user.noSuchProp === undefined); // true â†’ "khÃ´ng cÃ³"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "in" operator â€” kiá»ƒm tra chÃ­nh xÃ¡c hÆ¡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("name" in user); // true â€” property tá»“n táº¡i
alert("age" in user); // false â€” khÃ´ng cÃ³

// âš ï¸ Left side pháº£i lÃ  QUOTED STRING (hoáº·c variable)
let key = "name";
alert(key in user); // true â€” dÃ¹ng biáº¿n (khÃ´ng cáº§n quotes)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº I SAO cáº§n "in"? !== undefined khÃ´ng Ä‘á»§?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let obj = { test: undefined }; // property tá»“n táº¡i, value = undefined

alert(obj.test); // undefined â†’ tÆ°á»Ÿng khÃ´ng cÃ³!
alert("test" in obj); // true â†’ ÄÃšNG: property CÃ“ tá»“n táº¡i

// âš ï¸ Hiáº¿m khi gÃ¡n undefined â€” thÆ°á»ng dÃ¹ng null cho "empty/unknown"
// NhÆ°ng "in" luÃ´n Ä‘Ãºng trong má»i trÆ°á»ng há»£p
```

### for..in Loop â€” Duyá»‡t Object

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// for..in â€” duyá»‡t Táº¤T Cáº¢ enumerable keys
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  age: 30,
  isAdmin: true,
};

for (let key in user) {
  alert(key); // "name", "age", "isAdmin"
  alert(user[key]); // "John", 30, true
}

// âš ï¸ KHÃC for(;;) â€” Ä‘Ã¢y lÃ  for..in, duyá»‡t object keys
// âš ï¸ CÃ³ thá»ƒ dÃ¹ng tÃªn biáº¿n khÃ¡c: for (let prop in obj)
```

### Thá»© Tá»± Properties

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  PROPERTY ORDER RULES                                         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  Integer properties â†’ SORTED ascending                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
  â”‚  â”‚  { "49": "DE", "41": "CH", "1": "US" }      â”‚            â”‚
  â”‚  â”‚  for..in â†’ "1", "41", "49"  (sorted!)       â”‚            â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
  â”‚                                                              â”‚
  â”‚  Non-integer properties â†’ CREATION ORDER                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
  â”‚  â”‚  { name: "John", surname: "Smith", age: 25 } â”‚            â”‚
  â”‚  â”‚  for..in â†’ "name", "surname", "age"          â”‚            â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
  â”‚                                                              â”‚
  â”‚  "Integer property" = string convert â†â†’ integer khÃ´ng Ä‘á»•i  â”‚
  â”‚  "49" âœ…  |  "+49" âŒ (thÃ nh "49")  |  "1.2" âŒ (thÃ nh "1")â”‚
  â”‚                                                              â”‚
  â”‚  ğŸ’¡ TRICK: thÃªm "+" trÆ°á»›c number â†’ non-integer â†’ giá»¯ order â”‚
  â”‚  { "+49": "DE", "+41": "CH", "+1": "US" }                  â”‚
  â”‚  for..in â†’ "+49", "+41", "+1" (creation order!)             â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Integer properties â€” sorted ascending
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let codes = { 49: "DE", 41: "CH", 44: "GB", 1: "US" };
for (let code in codes) alert(code);
// â†’ 1, 41, 44, 49  (SORTED, khÃ´ng theo thá»© tá»± táº¡o!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Fix: dÃ¹ng "+" prefix â†’ non-integer â†’ creation order
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let codes = { "+49": "DE", "+41": "CH", "+44": "GB", "+1": "US" };
for (let code in codes) alert(+code);
// â†’ 49, 41, 44, 1  (creation order! +code convert láº¡i number)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Integer property test:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
String(Math.trunc(Number("49"))); // "49" = "49" âœ… integer
String(Math.trunc(Number("+49"))); // "49" â‰  "+49" âŒ non-integer
String(Math.trunc(Number("1.2"))); // "1" â‰  "1.2"  âŒ non-integer
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. isEmpty â€” kiá»ƒm tra object rá»—ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function isEmpty(obj) {
  for (let key in obj) {
    return false; // cÃ³ Ã­t nháº¥t 1 key â†’ khÃ´ng rá»—ng
  }
  return true; // khÃ´ng cÃ³ key nÃ o â†’ rá»—ng
}

isEmpty({}); // true
isEmpty({ "8:30": "up" }); // false

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. sumSalaries â€” tá»•ng táº¥t cáº£ values
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let salaries = { John: 100, Ann: 160, Pete: 130 };

let sum = 0;
for (let key in salaries) {
  sum += salaries[key];
}
alert(sum); // 390

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. multiplyNumeric â€” nhÃ¢n Ä‘Ã´i numeric properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function multiplyNumeric(obj) {
  for (let key in obj) {
    if (typeof obj[key] == "number") {
      obj[key] *= 2; // modify IN-PLACE
    }
  }
}

let menu = { width: 200, height: 300, title: "My menu" };
multiplyNumeric(menu);
// menu = { width: 400, height: 600, title: "My menu" }
// âš ï¸ KhÃ´ng return â€” modify object trá»±c tiáº¿p (reference type)
```

### Tá»•ng Há»£p: Objects

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTS â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  BASICS:                                                        â”‚
â”‚  â€¢ Object = associative array (keyed collection)               â”‚
â”‚  â€¢ Keys = strings hoáº·c symbols | Values = any type             â”‚
â”‚  â€¢ Táº¡o: {} (literal, phá»• biáº¿n) hoáº·c new Object()              â”‚
â”‚  â€¢ Trailing comma cho property cuá»‘i = best practice            â”‚
â”‚                                                                 â”‚
â”‚  TRUY Cáº¬P:                                                      â”‚
â”‚  â€¢ obj.prop         â€” dot notation (key Ä‘Æ¡n giáº£n)              â”‚
â”‚  â€¢ obj["prop"]      â€” brackets (key báº¥t ká»³, tá»« biáº¿n)          â”‚
â”‚  â€¢ { [expr]: val }  â€” computed properties                      â”‚
â”‚  â€¢ { name }         â€” shorthand = { name: name }               â”‚
â”‚                                                                 â”‚
â”‚  OPERATORS:                                                     â”‚
â”‚  â€¢ delete obj.prop  â€” xÃ³a property                             â”‚
â”‚  â€¢ "key" in obj     â€” tá»“n táº¡i? (chÃ­nh xÃ¡c hÆ¡n === undefined) â”‚
â”‚  â€¢ for (key in obj) â€” duyá»‡t táº¥t cáº£ enumerable keys            â”‚
â”‚                                                                 â”‚
â”‚  PROPERTY ORDER:                                                â”‚
â”‚  â€¢ Integer keys â†’ sorted ascending                             â”‚
â”‚  â€¢ Non-integer â†’ creation order                                â”‚
â”‚  â€¢ Trick: "+" prefix biáº¿n integer â†’ non-integer                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Property names khÃ´ng háº¡n cháº¿ (reserved words OK)          â”‚
â”‚  âš ï¸ Number keys auto-convert thÃ nh string                      â”‚
â”‚  âš ï¸ __proto__ lÃ  special property (prototype chain)            â”‚
â”‚  âš ï¸ obj.key â‰  obj[key] â€” dot tÃ¬m literal "key", [] dÃ¹ng biáº¿n â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 27. Object References and Copying â€” Tham Chiáº¿u & Sao ChÃ©p

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT REFERENCES â€” Báº£n Äá»“ Tá»•ng Quan                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  PRIMITIVE â€” Copy by VALUE                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    copy    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ message  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ phrase   â”‚                          â”‚
â”‚  â”‚ "Hello!" â”‚            â”‚ "Hello!" â”‚  â† 2 báº£n sao Äá»˜C Láº¬P   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                 â”‚
â”‚  OBJECT â€” Copy by REFERENCE                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    copy    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  user    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  admin   â”‚                          â”‚
â”‚  â”‚  ref â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”       â”‚  ref â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                    â”‚
â”‚                  â–¼                        â–¼                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚              â”‚  { name: "John" }   â”‚  â† 1 object, 2 refs     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                 â”‚
â”‚  CLONING:                                                       â”‚
â”‚  â€¢ Shallow: Object.assign({}, obj) | {...obj}                  â”‚
â”‚  â€¢ Deep:    structuredClone(obj)                               â”‚
â”‚  â€¢ Custom:  for..in loop | _.cloneDeep(obj)                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Primitive vs Object â€” Copy Behavior

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRIMITIVE â€” copy by VALUE (2 báº£n sao Ä‘á»™c láº­p)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let message = "Hello!";
let phrase = message; // copy giÃ¡ trá»‹

phrase = "Bye!";
alert(message); // "Hello!" â€” KHÃ”NG bá»‹ áº£nh hÆ°á»Ÿng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// OBJECT â€” copy by REFERENCE (cÃ¹ng 1 object)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };
let admin = user; // copy REFERENCE (khÃ´ng copy object)

admin.name = "Pete"; // sá»­a qua admin
alert(user.name); // "Pete" â† user cÅ©ng tháº¥y thay Ä‘á»•i!

// âš ï¸ Biáº¿n user KHÃ”NG lÆ°u object
//    Biáº¿n user lÆ°u "Äá»ŠA CHá»ˆ" (reference) trá» Ä‘áº¿n object
//    Copy biáº¿n = copy Ä‘á»‹a chá»‰ â†’ 2 biáº¿n cÃ¹ng trá» 1 object
```

### So SÃ¡nh Object â€” Comparison by Reference

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Hai object báº±ng nhau CHá»ˆ KHI cÃ¹ng 1 object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let a = {};
let b = a; // copy reference
alert(a == b); // true  â€” cÃ¹ng 1 object
alert(a === b); // true

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2 object KHÃC NHAU â†’ LUÃ”N khÃ´ng báº±ng nhau
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let a = {};
let b = {}; // 2 object khÃ¡c nhau (dÃ¹ giá»‘ng ná»™i dung)
alert(a == b); // false â€” khÃ¡c reference!

// âš ï¸ So sÃ¡nh CONTENT khÃ´ng quan trá»ng
//    Chá»‰ so sÃ¡nh ADDRESS (reference)
```

### const Object â€” Váº«n CÃ³ Thá»ƒ Sá»­a Properties!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// const = reference KHÃ”NG Äá»”I, nhÆ°ng object BÃŠN TRONG thay Ä‘á»•i Ä‘Æ°á»£c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const user = { name: "John" };

user.name = "Pete"; // âœ… OK â€” sá»­a property
user.age = 30; // âœ… OK â€” thÃªm property
alert(user.name); // "Pete"

// âŒ user = {};     // TypeError â€” khÃ´ng thá»ƒ gÃ¡n láº¡i reference!

// const giá»¯ "mÅ©i tÃªn" cá»‘ Ä‘á»‹nh â†’ nhÆ°ng "cÃ¡i tá»§" (object) tá»± do thay Ä‘á»•i
// Muá»‘n freeze properties â†’ dÃ¹ng Object.freeze() (chapter khÃ¡c)
```

### Shallow Clone â€” Object.assign & Spread

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 1: for..in loop (manual)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John", age: 30 };
let clone = {};

for (let key in user) {
  clone[key] = user[key]; // copy tá»«ng property
}

clone.name = "Pete";
alert(user.name); // "John" â€” clone Äá»˜C Láº¬P

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 2: Object.assign(dest, ...sources)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };
let perm1 = { canView: true };
let perm2 = { canEdit: true };

Object.assign(user, perm1, perm2);
// user = { name: "John", canView: true, canEdit: true }

// Clone nhanh:
let clone = Object.assign({}, user);
// Copy Táº¤T Cáº¢ properties vÃ o {} rá»—ng

// âš ï¸ Property trÃ¹ng tÃªn â†’ Bá»Š OVERWRITE:
Object.assign(user, { name: "Pete" });
alert(user.name); // "Pete"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 3: Spread syntax
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let clone = { ...user }; // tÆ°Æ¡ng Ä‘Æ°Æ¡ng Object.assign({}, user)
```

### Váº¥n Äá» Nested Objects â€” Shallow vs Deep

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  SHALLOW CLONE PROBLEM                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  user â”€â”€â”€â”€â”€â”     clone â”€â”€â”€â”€â”                                â”‚
  â”‚            â–¼               â–¼                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  â”‚  â”‚ name: "John" âœ“  â”‚  â”‚ name: "John" âœ“  â”‚  â† primitive OK  â”‚
  â”‚  â”‚ sizes: ref â”€â”€â”  â”‚  â”‚ sizes: ref â”€â”€â”  â”‚                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜                   â”‚
  â”‚                 â”‚                     â”‚                      â”‚
  â”‚                 â–¼                     â–¼                      â”‚
  â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
  â”‚             â”‚ { height: 182,       â”‚  â† CHIA Sáºº object!     â”‚
  â”‚             â”‚   width: 50 }        â”‚  user.sizes === clone  â”‚
  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     .sizes = true      â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Object.assign / spread CHá»ˆ copy level 1 (shallow)      â”‚
  â”‚  â†’ Nested objects váº«n CHIA Sáºº reference                     â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Shallow clone â†’ nested objects VáºªN chia sáº»
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  sizes: { height: 182, width: 50 },
};

let clone = { ...user }; // shallow clone

alert(user.sizes === clone.sizes); // true â€” CÃ™NG object!

user.sizes.width = 60;
alert(clone.sizes.width); // 60 â† Bá»Š áº¢NH HÆ¯á»NG!
```

### Deep Clone â€” structuredClone

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// structuredClone â€” deep clone Táº¤T Cáº¢ nested objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  sizes: { height: 182, width: 50 },
};

let clone = structuredClone(user);

alert(user.sizes === clone.sizes); // false â€” KHÃC object!

user.sizes.width = 60;
alert(clone.sizes.width); // 50 â† KHÃ”NG bá»‹ áº£nh hÆ°á»Ÿng!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Há»— trá»£ circular references
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {};
user.me = user; // circular reference

let clone = structuredClone(user);
alert(clone.me === clone); // true â€” clone trá» Ä‘áº¿n CHÃNH clone
alert(clone.me === user); // false â€” KHÃ”NG trá» Ä‘áº¿n user

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ KHÃ”NG há»— trá»£ function properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

structuredClone({ f: function () {} }); // âŒ Error!

// Fix: dÃ¹ng _.cloneDeep(obj) tá»« lodash
// hoáº·c viáº¿t custom cloning function
```

### Tá»•ng Há»£p: Object References and Copying

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT REFERENCES â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CORE CONCEPT:                                                  â”‚
â”‚  â€¢ Primitive â†’ copy by VALUE (2 báº£n sao Ä‘á»™c láº­p)              â”‚
â”‚  â€¢ Object â†’ copy by REFERENCE (2 biáº¿n, 1 object)              â”‚
â”‚  â€¢ Biáº¿n object lÆ°u "Ä‘á»‹a chá»‰", KHÃ”NG lÆ°u object               â”‚
â”‚                                                                 â”‚
â”‚  SO SÃNH:                                                       â”‚
â”‚  â€¢ a == b â†’ true CHá»ˆ KHI cÃ¹ng 1 object (cÃ¹ng reference)      â”‚
â”‚  â€¢ 2 objects giá»‘ng ná»™i dung nhÆ°ng khÃ¡c ref â†’ false             â”‚
â”‚                                                                 â”‚
â”‚  CONST OBJECTS:                                                 â”‚
â”‚  â€¢ const user = {} â†’ KHÃ”NG thá»ƒ user = ...                     â”‚
â”‚  â€¢ NHÆ¯NG user.name = "x" â†’ OK (sá»­a property Ä‘Æ°á»£c)            â”‚
â”‚                                                                 â”‚
â”‚  CLONING:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Shallow      â”‚ Object.assign({}, obj)           â”‚           â”‚
â”‚  â”‚              â”‚ { ...obj }                        â”‚           â”‚
â”‚  â”‚              â”‚ âš ï¸ Nested objects = shared ref    â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Deep         â”‚ structuredClone(obj)              â”‚           â”‚
â”‚  â”‚              â”‚ âœ… Clone nested + circular refs   â”‚           â”‚
â”‚  â”‚              â”‚ âŒ KHÃ”NG há»— trá»£ functions        â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚ Custom       â”‚ _.cloneDeep(obj) (lodash)         â”‚           â”‚
â”‚  â”‚              â”‚ Manual for..in loop               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 28. Object Methods, "this" â€” PhÆ°Æ¡ng Thá»©c & Tá»« KhÃ³a this

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT METHODS & "this" â€” Báº£n Äá»“ Tá»•ng Quan                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  METHOD = function stored in object property                    â”‚
â”‚                                                                 â”‚
â”‚  let user = {                                                   â”‚
â”‚    name: "John",                                                â”‚
â”‚    sayHi() {              â† method shorthand                   â”‚
â”‚      alert(this.name);    â† this = object "trÆ°á»›c dáº¥u cháº¥m"    â”‚
â”‚    }                                                            â”‚
â”‚  };                                                             â”‚
â”‚  user.sayHi();  // "John"  (this = user)                       â”‚
â”‚                                                                 â”‚
â”‚  "this" RULES:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ obj.method()    â†’ this = obj                 â”‚               â”‚
â”‚  â”‚ func()          â†’ this = undefined (strict)  â”‚               â”‚
â”‚  â”‚ func()          â†’ this = window (non-strict) â”‚               â”‚
â”‚  â”‚ arrow function  â†’ KHÃ”NG cÃ³ this riÃªng        â”‚               â”‚
â”‚  â”‚                   â†’ láº¥y tá»« outer context      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ this Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh lÃºc CALL-TIME, khÃ´ng pháº£i lÃºc khai bÃ¡o â”‚
â”‚  âš ï¸ CÃ¹ng 1 function cÃ³ thá»ƒ cÃ³ this khÃ¡c nhau tÃ¹y cÃ¡ch gá»i    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡o Method â€” 3 CÃ¡ch

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 1: GÃ¡n function expression vÃ o property
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };

user.sayHi = function () {
  alert("Hello!");
};
user.sayHi(); // "Hello!"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 2: GÃ¡n function Ä‘Ã£ khai bÃ¡o sáºµn
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function sayHi() {
  alert("Hello!");
}
user.sayHi = sayHi;
user.sayHi(); // "Hello!"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 3: METHOD SHORTHAND â† phá»• biáº¿n nháº¥t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  sayHi() {
    // = sayHi: function() {...}
    alert("Hello!");
  },
};
user.sayHi(); // "Hello!"

// âš ï¸ Shorthand KHÃ”NG hoÃ n toÃ n giá»‘ng function expression
//    â†’ KhÃ¡c biá»‡t nhá» liÃªn quan inheritance (sáº½ há»c sau)
//    â†’ Háº§u háº¿t trÆ°á»ng há»£p: dÃ¹ng shorthand
```

### "this" Trong Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// this = object "trÆ°á»›c dáº¥u cháº¥m" khi gá»i method
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  sayHi() {
    alert(this.name); // this = user (object trÆ°á»›c dáº¥u cháº¥m)
  },
};

user.sayHi(); // "John"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Äá»ªNG dÃ¹ng tÃªn biáº¿n thay vÃ¬ this â€” KHÃ”NG an toÃ n!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  sayHi() {
    alert(user.name); // âŒ dÃ¹ng tÃªn biáº¿n trá»±c tiáº¿p
  },
};

let admin = user;
user = null; // overwrite biáº¿n gá»‘c

admin.sayHi(); // âŒ TypeError! user = null

// âœ… Náº¿u dÃ¹ng this.name â†’ váº«n hoáº¡t Ä‘á»™ng Ä‘Ãºng
// VÃ¬ this = admin (object trÆ°á»›c dáº¥u cháº¥m)
```

### "this" KhÃ´ng Bá»‹ RÃ ng Buá»™c (Unbound)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  "this" IS NOT BOUND â€” XÃ¡c Ä‘á»‹nh lÃºc Gá»ŒI, khÃ´ng lÃºc KHAI BÃOâ”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  function sayHi() { alert(this.name); }                     â”‚
  â”‚                                                              â”‚
  â”‚  let user  = { name: "John",  f: sayHi };                  â”‚
  â”‚  let admin = { name: "Admin", f: sayHi };                  â”‚
  â”‚                                                              â”‚
  â”‚  user.f();    â†’ this = user  â†’ "John"                      â”‚
  â”‚  admin.f();   â†’ this = admin â†’ "Admin"                     â”‚
  â”‚  admin['f']() â†’ this = admin â†’ "Admin" ([] = giá»‘ng dot)    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ CÃ™NG 1 function, nhÆ°ng this KHÃC nhau tÃ¹y cÃ¡ch gá»i!  â”‚
  â”‚                                                              â”‚
  â”‚  KHÃ”NG cÃ³ object:                                            â”‚
  â”‚  sayHi();     â†’ this = undefined (strict mode)              â”‚
  â”‚  sayHi();     â†’ this = window (non-strict) â† lá»—i lá»‹ch sá»­  â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¹ng 1 function, khÃ¡c this tÃ¹y object gá»i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };
let admin = { name: "Admin" };

function sayHi() {
  alert(this.name);
}

user.f = sayHi;
admin.f = sayHi;

user.f(); // "John"  (this = user)
admin.f(); // "Admin" (this = admin)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»i KHÃ”NG cÃ³ object â†’ this = undefined (strict)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function sayHi() {
  alert(this); // undefined (strict mode)
}
sayHi(); // â† gá»i nhÆ° function, KHÃ”NG pháº£i method

// âš ï¸ Non-strict: this = window (global object) â€” legacy behavior
```

### Arrow Functions â€” KHÃ”NG CÃ³ "this" RiÃªng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Arrow function KHÃ”NG cÃ³ this riÃªng
// â†’ Láº¥y this tá»« OUTER function (lexical this)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  firstName: "Ilya",
  sayHi() {
    let arrow = () => alert(this.firstName);
    arrow(); // "Ilya" â† this láº¥y tá»« sayHi() = user
  },
};

user.sayHi(); // "Ilya"

// âš ï¸ Náº¿u dÃ¹ng regular function thay vÃ¬ arrow:
let user = {
  firstName: "Ilya",
  sayHi() {
    let func = function () {
      alert(this.firstName);
    };
    func(); // âŒ undefined â€” this = undefined (strict)
  },
};

// â†’ Arrow function há»¯u Ã­ch khi muá»‘n giá»¯ this tá»« outer context
```

### "this" Trong Object Literal â€” Gotcha

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ this trong object literal = this cá»§a FUNCTION bao ngoÃ i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function makeUser() {
  return {
    name: "John",
    ref: this, // âŒ this = undefined (cá»§a makeUser)
  };
}

let user = makeUser(); // gá»i nhÆ° function, khÃ´ng pháº£i method
alert(user.ref.name); // âŒ Error! this = undefined

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Fix: dÃ¹ng METHOD thay vÃ¬ property
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function makeUser() {
  return {
    name: "John",
    ref() {
      return this; // this = object trÆ°á»›c dáº¥u cháº¥m khi Gá»ŒI
    },
  };
}

let user = makeUser();
alert(user.ref().name); // "John" â† user.ref() â†’ this = user
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Calculator â€” dÃ¹ng this lÆ°u trá»¯ state
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let calculator = {
  read() {
    this.a = +prompt("a?", 0);
    this.b = +prompt("b?", 0);
  },
  sum() {
    return this.a + this.b;
  },
  mul() {
    return this.a * this.b;
  },
};

calculator.read();
alert(calculator.sum()); // a + b
alert(calculator.mul()); // a * b

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. METHOD CHAINING â€” return this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let ladder = {
  step: 0,
  up() {
    this.step++;
    return this; // â† KEY: return this Ä‘á»ƒ chain
  },
  down() {
    this.step--;
    return this;
  },
  showStep() {
    alert(this.step);
    return this;
  },
};

// Chainable calls:
ladder.up().up().down().showStep().down().showStep();
// shows 1, then 0

// âš ï¸ Pattern phá»• biáº¿n trong JS libraries (jQuery, Lodash, etc.)
// Má»—i method return this â†’ cho phÃ©p gá»i liÃªn tiáº¿p
```

### Tá»•ng Há»£p: Object Methods & "this"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT METHODS & "this" â€” SUMMARY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  METHOD:                                                        â”‚
â”‚  â€¢ Function stored in object property                          â”‚
â”‚  â€¢ Shorthand: sayHi() { } = sayHi: function() { }             â”‚
â”‚                                                                 â”‚
â”‚  "this" RULES:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ obj.method() â”‚ this = obj (trÆ°á»›c dáº¥u cháº¥m)     â”‚           â”‚
â”‚  â”‚ func()       â”‚ this = undefined (strict mode)   â”‚           â”‚
â”‚  â”‚ func()       â”‚ this = window (non-strict)       â”‚           â”‚
â”‚  â”‚ arrow func   â”‚ KHÃ”NG cÃ³ this â†’ láº¥y tá»« outer     â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  KEY POINTS:                                                    â”‚
â”‚  â€¢ this xÃ¡c Ä‘á»‹nh lÃºc CALL-TIME, khÃ´ng pháº£i lÃºc khai bÃ¡o       â”‚
â”‚  â€¢ CÃ¹ng 1 function â†’ this khÃ¡c nhau tÃ¹y object gá»i            â”‚
â”‚  â€¢ DÃ¹ng this thay vÃ¬ tÃªn biáº¿n â†’ an toÃ n hÆ¡n                   â”‚
â”‚  â€¢ Object literal: ref: this â†’ this cá»§a outer function        â”‚
â”‚                                                                 â”‚
â”‚  PATTERNS:                                                      â”‚
â”‚  â€¢ Method chaining: return this â†’ obj.a().b().c()              â”‚
â”‚  â€¢ Arrow trong method: giá»¯ this tá»« method cha                  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Gá»i function KHÃ”NG cÃ³ object â†’ this = undefined           â”‚
â”‚  âš ï¸ ref: this trong literal = this Cá»¦A FUNCTION bao ngoÃ i    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 29. Constructor, Operator "new" â€” HÃ m Táº¡o & ToÃ¡n Tá»­ new

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONSTRUCTOR & "new" â€” Báº£n Äá»“ Tá»•ng Quan                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Constructor = regular function + 2 quy Æ°á»›c:                    â”‚
â”‚  1. TÃªn báº¯t Ä‘áº§u báº±ng CHá»® HOA (User, Calculator)               â”‚
â”‚  2. Chá»‰ gá»i vá»›i toÃ¡n tá»­ NEW                                    â”‚
â”‚                                                                 â”‚
â”‚  new User("Jack") â€” 3 bÆ°á»›c ngáº§m:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ 1. this = {}           â† táº¡o object rá»—ng    â”‚               â”‚
â”‚  â”‚ 2. function body()     â† sá»­a this           â”‚               â”‚
â”‚  â”‚ 3. return this         â† tráº£ object          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  RETURN RULES:                                                  â”‚
â”‚  â€¢ return object â†’ tráº£ object ÄÃ“ (bá» this)                   â”‚
â”‚  â€¢ return primitive â†’ Bá» QUA, váº«n tráº£ this                    â”‚
â”‚  â€¢ khÃ´ng return â†’ tráº£ this (máº·c Ä‘á»‹nh)                          â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Arrow functions KHÃ”NG thá»ƒ lÃ m constructor (khÃ´ng cÃ³ this)â”‚
â”‚  âš ï¸ new.target â€” kiá»ƒm tra function gá»i báº±ng new hay khÃ´ng    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Constructor Function â€” CÆ¡ Báº£n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Constructor = function + new â†’ táº¡o nhiá»u objects giá»‘ng nhau
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  this.name = name;
  this.isAdmin = false;
}

let user = new User("Jack");
alert(user.name); // "Jack"
alert(user.isAdmin); // false

// Táº¡o nhiá»u users cÃ¹ng "máº«u":
let user1 = new User("Ann");
let user2 = new User("Alice");

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// new User("Jack") thá»±c cháº¥t lÃ m gÃ¬?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  // this = {};            â† BÆ¯á»šC 1: táº¡o object rá»—ng (ngáº§m)

  this.name = name; // BÆ¯á»šC 2: thÃªm properties
  this.isAdmin = false;

  // return this;           â† BÆ¯á»šC 3: tráº£ object (ngáº§m)
}

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
let user = {
  name: "Jack",
  isAdmin: false,
};
// â†’ Constructor = "khuÃ´n" táº¡o objects, tÃ¡i sá»­ dá»¥ng Ä‘Æ°á»£c
```

### new function() {} â€” Táº¡o Object Phá»©c Táº¡p Má»™t Láº§n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IIFE constructor â€” táº¡o 1 object phá»©c táº¡p, KHÃ”NG tÃ¡i sá»­ dá»¥ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = new (function () {
  this.name = "John";
  this.isAdmin = false;

  // ...cÃ³ thá»ƒ cÃ³ logic phá»©c táº¡p
  // local variables, conditions, etc.
})();

// âš ï¸ Function KHÃ”NG lÆ°u â†’ KHÃ”NG thá»ƒ gá»i láº¡i
// â†’ DÃ¹ng khi cáº§n encapsulate logic táº¡o 1 object duy nháº¥t
```

### new.target â€” Kiá»ƒm Tra Constructor Mode

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// new.target = undefined (gá»i thÆ°á»ng) | function (gá»i báº±ng new)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  if (!new.target) {
    return new User(name); // tá»± thÃªm new náº¿u quÃªn
  }
  this.name = name;
}

let john = User("John"); // gá»i KHÃ”NG cÃ³ new â†’ váº«n OK
alert(john.name); // "John"

// âš ï¸ Pattern nÃ y dÃ¹ng trong libraries cho flexible syntax
// â†’ NhÆ°ng NÃŠN luÃ´n dÃ¹ng new cho rÃµ rÃ ng
```

### Return Tá»« Constructor â€” Quy Táº¯c Äáº·c Biá»‡t

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  RETURN FROM CONSTRUCTOR                                      â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  return object     â†’ tráº£ OBJECT ÄÃ“ (bá» this)              â”‚
  â”‚  return primitive  â†’ Bá» QUA, váº«n tráº£ this                  â”‚
  â”‚  khÃ´ng return      â†’ tráº£ this (máº·c Ä‘á»‹nh)                    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Return object â†’ OVERRIDE this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function BigUser() {
  this.name = "John";
  return { name: "Godzilla" }; // â† tráº£ object KHÃC
}

alert(new BigUser().name); // "Godzilla" (this bá»‹ bá»)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Return primitive â†’ Bá» QUA, váº«n tráº£ this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SmallUser() {
  this.name = "John";
  return; // â† primitive (hoáº·c undefined) â†’ bá» qua
}

alert(new SmallUser().name); // "John" (this Ä‘Æ°á»£c tráº£)

// âš ï¸ Háº§u háº¿t constructors KHÃ”NG cÃ³ return statement
```

### Methods Trong Constructor

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KhÃ´ng chá»‰ properties â€” cÃ³ thá»ƒ thÃªm METHODS vÃ o this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function User(name) {
  this.name = name;

  this.sayHi = function () {
    alert("My name is: " + this.name);
  };
}

let john = new User("John");
john.sayHi(); // "My name is: John"

// john = {
//   name: "John",
//   sayHi: function() { ... }
// }

// âš ï¸ Má»—i new User() táº¡o Má»šI function sayHi
// â†’ KhÃ´ng hiá»‡u quáº£ náº¿u táº¡o nhiá»u objects
// â†’ Giáº£i phÃ¡p: dÃ¹ng prototype hoáº·c class (há»c sau)
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Two functions â€“ one object
// new A() == new B() cÃ³ thá»ƒ khÃ´ng?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let obj = {};

function A() {
  return obj;
} // return object â†’ override this
function B() {
  return obj;
} // cÃ¹ng return 1 object

alert(new A() == new B()); // true â€” cÃ¹ng reference!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Calculator â€” constructor version
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Calculator() {
  this.read = function () {
    this.a = +prompt("a?", 0);
    this.b = +prompt("b?", 0);
  };
  this.sum = function () {
    return this.a + this.b;
  };
  this.mul = function () {
    return this.a * this.b;
  };
}

let calc = new Calculator();
calc.read();
alert("Sum=" + calc.sum()); // a + b
alert("Mul=" + calc.mul()); // a * b

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3. Accumulator â€” cá»™ng dá»“n giÃ¡ trá»‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Accumulator(startingValue) {
  this.value = startingValue;

  this.read = function () {
    this.value += +prompt("How much to add?", 0);
  };
}

let acc = new Accumulator(1);
acc.read(); // cá»™ng giÃ¡ trá»‹ user nháº­p
acc.read(); // cá»™ng tiáº¿p
alert(acc.value); // tá»•ng táº¥t cáº£
```

### Tá»•ng Há»£p: Constructor & "new"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONSTRUCTOR & "new" â€” SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CONSTRUCTOR FUNCTION:                                          â”‚
â”‚  â€¢ Regular function + tÃªn Viáº¿t Hoa + gá»i báº±ng new             â”‚
â”‚  â€¢ Má»¥c Ä‘Ã­ch: táº¡o NHIá»€U objects cÃ¹ng "khuÃ´n"                   â”‚
â”‚                                                                 â”‚
â”‚  new F() â€” 3 BÆ¯á»šC:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ BÆ°á»›c 1       â”‚ this = {} (táº¡o object rá»—ng)     â”‚           â”‚
â”‚  â”‚ BÆ°á»›c 2       â”‚ Cháº¡y function body (sá»­a this)   â”‚           â”‚
â”‚  â”‚ BÆ°á»›c 3       â”‚ return this (tráº£ object)         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  RETURN:                                                        â”‚
â”‚  â€¢ return object â†’ tráº£ object Ä‘Ã³ (bá» this)                    â”‚
â”‚  â€¢ return primitive/nothing â†’ tráº£ this                         â”‚
â”‚                                                                 â”‚
â”‚  ADVANCED:                                                      â”‚
â”‚  â€¢ new.target â€” kiá»ƒm tra gá»i báº±ng new hay khÃ´ng               â”‚
â”‚  â€¢ new function() {} â€” IIFE constructor, 1 láº§n duy nháº¥t       â”‚
â”‚  â€¢ Methods trong constructor: this.f = function() {}           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Arrow functions KHÃ”NG thá»ƒ lÃ m constructor                 â”‚
â”‚  âš ï¸ Má»—i new táº¡o má»›i methods â†’ dÃ¹ng prototype/class tá»‘i Æ°u hÆ¡nâ”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 30. Optional Chaining `?.` â€” Truy Cáº­p An ToÃ n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPTIONAL CHAINING ?. â€” Báº£n Äá»“ Tá»•ng Quan                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 Dáº NG:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ obj?.prop         â”‚ tráº£ obj.prop hoáº·c undefined     â”‚        â”‚
â”‚  â”‚ obj?.[expr]       â”‚ tráº£ obj[expr] hoáº·c undefined    â”‚        â”‚
â”‚  â”‚ obj.method?.()    â”‚ gá»i method hoáº·c undefined       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  CÃCH HOáº T Äá»˜NG:                                                â”‚
â”‚  â€¢ Náº¿u pháº§n TRÆ¯á»šC ?. lÃ  null/undefined â†’ return undefined      â”‚
â”‚  â€¢ Náº¿u KHÃ”NG â†’ tiáº¿p tá»¥c truy cáº­p bÃ¬nh thÆ°á»ng                  â”‚
â”‚  â€¢ Short-circuit: dá»«ng TOÃ€N Bá»˜ Ä‘Ã¡nh giÃ¡ bÃªn pháº£i              â”‚
â”‚                                                                 â”‚
â”‚  RULES:                                                         â”‚
â”‚  âœ… Äá»c properties         âœ… Gá»i methods                      â”‚
â”‚  âœ… DÃ¹ng vá»›i delete         âŒ KHÃ”NG dÃ¹ng bÃªn trÃ¡i assignment  â”‚
â”‚  âš ï¸ Biáº¿n PHáº¢I Ä‘Æ°á»£c khai bÃ¡o trÆ°á»›c (let/const/var)             â”‚
â”‚  âš ï¸ Äá»ªNG láº¡m dá»¥ng â€” cÃ³ thá»ƒ che giáº¥u programming errors       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Váº¥n Äá»: Truy Cáº­p Property KhÃ´ng Tá»“n Táº¡i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Truy cáº­p property trÃªn undefined â†’ ERROR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {}; // khÃ´ng cÃ³ "address"

alert(user.address.street); // âŒ TypeError!
// user.address = undefined
// undefined.street â†’ ERROR!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch cÅ©: if/ternary â€” dÃ i dÃ²ng, láº·p láº¡i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Ternary:
alert(user.address ? user.address.street : undefined);

// AND chaining:
alert(user.address && user.address.street && user.address.street.name);

// âš ï¸ Property name láº·p láº¡i nhiá»u láº§n â†’ khÃ³ Ä‘á»c, khÃ³ maintain
```

### Optional Chaining `?.` â€” Giáº£i PhÃ¡p

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ?. dá»«ng náº¿u trÆ°á»›c nÃ³ lÃ  null/undefined â†’ tráº£ undefined
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {}; // khÃ´ng cÃ³ address

alert(user?.address?.street); // undefined (khÃ´ng error!)

// So sÃ¡nh:
// CÅ¨:  user.address && user.address.street && user.address.street.name
// Má»šI: user?.address?.street?.name  â† ngáº¯n, sáº¡ch, khÃ´ng láº·p

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Hoáº¡t Ä‘á»™ng cáº£ khi object = null
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = null;

alert(user?.address); // undefined
alert(user?.address.street); // undefined
// âš ï¸ ?. CHá»ˆ lÃ m optional pháº§n TRÆ¯á»šC nÃ³ (user)
//    .street KHÃ”NG optional â†’ náº¿u address tá»“n táº¡i nhÆ°ng
//    khÃ´ng cÃ³ street â†’ váº«n ERROR
//    â†’ ThÃªm ?. cho má»—i level cáº§n optional
```

### Short-Circuiting â€” Dá»«ng ÄÃ¡nh GiÃ¡ Sá»›m

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Náº¿u trÆ°á»›c ?. lÃ  null/undefined â†’ Dá»ªNG TOÃ€N Bá»˜ bÃªn pháº£i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = null;
let x = 0;

user?.sayHi(x++); // user = null â†’ Dá»ªNG, khÃ´ng gá»i sayHi

alert(x); // 0 â€” x++ KHÃ”NG Ä‘Æ°á»£c thá»±c thi

// âš ï¸ Má»i thá»© sau ?. Ä‘á»u bá»‹ bá» qua khi short-circuit
```

### CÃ¡c Dáº¡ng KhÃ¡c: `?.()` vÃ  `?.[]`

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ?.() â€” gá»i method cÃ³ thá»ƒ KHÃ”NG tá»“n táº¡i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let userAdmin = {
  admin() {
    alert("I am admin");
  },
};
let userGuest = {};

userAdmin.admin?.(); // "I am admin"
userGuest.admin?.(); // undefined (khÃ´ng error)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ?.[] â€” truy cáº­p property báº±ng bracket notation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let key = "firstName";
let user1 = { firstName: "John" };
let user2 = null;

alert(user1?.[key]); // "John"
alert(user2?.[key]); // undefined (khÃ´ng error)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… DÃ¹ng vá»›i delete â€” OK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

delete user?.name; // xÃ³a náº¿u user tá»“n táº¡i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ KHÃ”NG dÃ¹ng bÃªn trÃ¡i assignment
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = null;
user?.name = "John"; // âŒ Error!
// ÄÃ¡nh giÃ¡ thÃ nh: undefined = "John" â†’ lá»—i
```

### âš ï¸ LÆ°u Ã Quan Trá»ng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Äá»ªNG láº¡m dá»¥ng ?. â€” che giáº¥u lá»—i láº­p trÃ¬nh
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ QuÃ¡ nhiá»u ?.
user?.address?.street?.name;

// âœ… Chá»‰ optional nÆ¡i Cáº¦N THIáº¾T
// user Báº®T BUá»˜C tá»“n táº¡i, address thÃ¬ optional:
user.address?.street;

// â†’ Náº¿u user = undefined â†’ BÃO Lá»–I (Ä‘Ãºng! phÃ¡t hiá»‡n bug)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Biáº¿n PHáº¢I Ä‘Æ°á»£c khai bÃ¡o trÆ°á»›c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// user?.address;  // âŒ ReferenceError náº¿u user chÆ°a khai bÃ¡o

let user;
user?.address; // âœ… OK â€” undefined (Ä‘Ã£ khai bÃ¡o)
```

### Tá»•ng Há»£p: Optional Chaining

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPTIONAL CHAINING ?. â€” SUMMARY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 Dáº NG:                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ obj?.prop         â”‚ Safe property access             â”‚        â”‚
â”‚  â”‚ obj?.[expr]       â”‚ Safe bracket access              â”‚        â”‚
â”‚  â”‚ obj.method?.()    â”‚ Safe method call                 â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  BEHAVIOR:                                                      â”‚
â”‚  â€¢ null/undefined trÆ°á»›c ?. â†’ return undefined ngay             â”‚
â”‚  â€¢ Short-circuit: dá»«ng TOÃ€N Bá»˜ Ä‘Ã¡nh giÃ¡ bÃªn pháº£i              â”‚
â”‚  â€¢ Chá»‰ áº£nh hÆ°á»Ÿng pháº§n TRÆ¯á»šC ?., khÃ´ng pháº£i sau                â”‚
â”‚                                                                 â”‚
â”‚  âœ… Äá»c, gá»i method, delete                                    â”‚
â”‚  âŒ KHÃ”NG dÃ¹ng bÃªn trÃ¡i assignment                             â”‚
â”‚  âš ï¸ Biáº¿n pháº£i khai bÃ¡o trÆ°á»›c | Ä‘á»«ng láº¡m dá»¥ng                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 31. Object to Primitive Conversion â€” Chuyá»ƒn Äá»•i Object Sang Primitive

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT â†’ PRIMITIVE CONVERSION â€” Báº£n Äá»“ Tá»•ng Quan               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khi object gáº·p operator (+, -, alert, ==, ...)                â”‚
â”‚  â†’ JS tá»± CHUYá»‚N object sang PRIMITIVE trÆ°á»›c khi tÃ­nh           â”‚
â”‚                                                                 â”‚
â”‚  3 HINTS (gá»£i Ã½ kiá»ƒu cáº§n chuyá»ƒn):                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ "string" â”‚ alert(obj), obj dÃ¹ng lÃ m key             â”‚        â”‚
â”‚  â”‚ "number" â”‚ +obj, obj1 - obj2, >, <, Number(obj)     â”‚        â”‚
â”‚  â”‚ "default"â”‚ obj1 + obj2, obj == number                â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  THá»¨ Tá»° TÃŒM METHOD:                                            â”‚
â”‚  1. obj[Symbol.toPrimitive](hint) â€” náº¿u cÃ³ â†’ dÃ¹ng luÃ´n        â”‚
â”‚  2. hint = "string" â†’ toString() â†’ valueOf()                   â”‚
â”‚  3. hint = "number"/"default" â†’ valueOf() â†’ toString()         â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Boolean: Táº¤T Cáº¢ objects = true (khÃ´ng chuyá»ƒn Ä‘á»•i)        â”‚
â”‚  âš ï¸ Method PHáº¢I return primitive, khÃ´ng pháº£i object            â”‚
â”‚  âš ï¸ Káº¿t quáº£ obj1 + obj2 luÃ´n lÃ  PRIMITIVE, khÃ´ng pháº£i object â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3 Hints â€” Gá»£i Ã Kiá»ƒu Chuyá»ƒn Äá»•i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HINT "string" â€” khi cáº§n string
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(obj); // hint: "string"
anotherObj[obj] = 123; // dÃ¹ng obj lÃ m key â†’ "string"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HINT "number" â€” khi cáº§n sá»‘ (trá»« binary +)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let num = Number(obj); // hint: "number"
let n = +obj; // unary plus â†’ "number"
let delta = date1 - date2; // trá»« â†’ "number"
let greater = user1 > user2; // so sÃ¡nh â†’ "number"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HINT "default" â€” operator khÃ´ng cháº¯c cáº§n kiá»ƒu gÃ¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let total = obj1 + obj2; // binary + â†’ "default"
if (user == 1) {
} // == â†’ "default"

// âš ï¸ Thá»±c táº¿: háº§u háº¿t objects xá»­ lÃ½ "default" = "number"
// â†’ Chá»‰ Date object lÃ  ngoáº¡i lá»‡
```

### Symbol.toPrimitive â€” CÃ¡ch Hiá»‡n Äáº¡i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Symbol.toPrimitive: 1 method xá»­ lÃ½ Táº¤T Cáº¢ hints
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  money: 1000,

  [Symbol.toPrimitive](hint) {
    alert(`hint: ${hint}`);
    return hint == "string" ? `{name: "${this.name}"}` : this.money;
  },
};

alert(user); // hint: "string" â†’ {name: "John"}
alert(+user); // hint: "number" â†’ 1000
alert(user + 500); // hint: "default" â†’ 1500

// âš ï¸ Náº¿u cÃ³ Symbol.toPrimitive â†’ KHÃ”NG cáº§n toString/valueOf
// âš ï¸ PHáº¢I return primitive â€” return object â†’ TypeError
```

### toString / valueOf â€” CÃ¡ch Truyá»n Thá»‘ng

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  CONVERSION ALGORITHM (khÃ´ng cÃ³ Symbol.toPrimitive)           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                              â”‚
  â”‚  hint = "string":                                            â”‚
  â”‚    1. toString()  â†’ náº¿u return primitive â†’ DÃ™NG             â”‚
  â”‚    2. valueOf()   â†’ náº¿u return primitive â†’ DÃ™NG             â”‚
  â”‚                                                              â”‚
  â”‚  hint = "number" hoáº·c "default":                             â”‚
  â”‚    1. valueOf()   â†’ náº¿u return primitive â†’ DÃ™NG             â”‚
  â”‚    2. toString()  â†’ náº¿u return primitive â†’ DÃ™NG             â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Return object â†’ Bá» QUA (khÃ´ng error, historical)       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Default behavior (plain object)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John" };

alert(user); // "[object Object]" (toString)
alert(user.valueOf() === user); // true (tráº£ chÃ­nh nÃ³ â†’ bá» qua)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Custom toString + valueOf
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  money: 1000,

  toString() {
    return `{name: "${this.name}"}`; // hint "string"
  },
  valueOf() {
    return this.money; // hint "number"/"default"
  },
};

alert(user); // toString â†’ {name: "John"}
alert(+user); // valueOf â†’ 1000
alert(user + 500); // valueOf â†’ 1500

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chá»‰ dÃ¹ng toString â€” "catch-all"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  name: "John",
  toString() {
    return this.name;
  },
};

alert(user); // "John"
alert(user + 500); // "John500" (string concat)

// âš ï¸ KhÃ´ng cÃ³ Symbol.toPrimitive + valueOf
// â†’ toString xá»­ lÃ½ Táº¤T Cáº¢ conversions
```

### Further Conversions â€” Chuyá»ƒn Äá»•i Tiáº¿p

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2-stage: Object â†’ primitive â†’ (náº¿u cáº§n) â†’ kiá»ƒu khÃ¡c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let obj = {
  toString() {
    return "2"; // return string "2"
  },
};

alert(obj * 2); // 4
// BÆ°á»›c 1: obj â†’ primitive "2" (toString)
// BÆ°á»›c 2: "2" * 2 â†’ 2 * 2 = 4 (string â†’ number)

alert(obj + 2); // "22"
// BÆ°á»›c 1: obj â†’ primitive "2" (toString)
// BÆ°á»›c 2: "2" + 2 â†’ "22" (string concat vÃ¬ binary +)

// âš ï¸ Conversion method KHÃ”NG cáº§n return Ä‘Ãºng "hinted" type
// â†’ Chá»‰ cáº§n return PRIMITIVE (báº¥t ká»³ kiá»ƒu nÃ o)
```

### Tá»•ng Há»£p: Object â†’ Primitive

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECT â†’ PRIMITIVE â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 HINTS:                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ "string" â”‚ alert, obj as key   â”‚ toString â†’ valueOf â”‚        â”‚
â”‚  â”‚ "number" â”‚ +, -, >, <, Number  â”‚ valueOf â†’ toString â”‚        â”‚
â”‚  â”‚ "default"â”‚ binary +, ==        â”‚ valueOf â†’ toString â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  PRIORITY ORDER:                                                â”‚
â”‚  1. Symbol.toPrimitive(hint) â€” náº¿u cÃ³ â†’ dÃ¹ng cho Táº¤T Cáº¢     â”‚
â”‚  2. toString / valueOf theo hint                                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Boolean: objects luÃ´n = true                               â”‚
â”‚  âš ï¸ Must return PRIMITIVE (Symbol.toPrimitive strict)          â”‚
â”‚  âš ï¸ toString catch-all khi khÃ´ng cÃ³ valueOf                    â”‚
â”‚  âš ï¸ 2-stage: obj â†’ primitive â†’ (auto convert náº¿u cáº§n)        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 32. Methods of Primitives â€” PhÆ°Æ¡ng Thá»©c Cá»§a Kiá»ƒu NguyÃªn Thá»§y

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  METHODS OF PRIMITIVES â€” Báº£n Äá»“ Tá»•ng Quan                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  NGHá»ŠCH LÃ: Primitives muá»‘n cÃ³ methods nhÆ°ng pháº£i nháº¹         â”‚
â”‚                                                                 â”‚
â”‚  GIáº¢I PHÃP â€” "Object Wrapper" (auto-boxing):                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ 1. "Hello".toUpperCase()                     â”‚               â”‚
â”‚  â”‚ 2. JS táº¡o WRAPPER object táº¡m (new String)   â”‚               â”‚
â”‚  â”‚ 3. Gá»i method trÃªn wrapper                   â”‚               â”‚
â”‚  â”‚ 4. Tráº£ káº¿t quáº£ primitive                      â”‚               â”‚
â”‚  â”‚ 5. Há»¦Y wrapper object ngay láº­p tá»©c           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  WRAPPER TYPES:                                                 â”‚
â”‚  String, Number, Boolean, Symbol, BigInt                        â”‚
â”‚  (null & undefined KHÃ”NG cÃ³ wrapper â†’ KHÃ”NG cÃ³ methods)        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ new Number(0) â†’ object (truthy!) â‰  Number(0) â†’ primitive â”‚
â”‚  âš ï¸ str.test = 5 â†’ wrapper táº¡m nháº­n, rá»“i Há»¦Y â†’ máº¥t!        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Object Wrapper â€” Auto-Boxing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Primitive Gá»ŒI method â†’ JS tá»± táº¡o wrapper object táº¡m
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "Hello";
alert(str.toUpperCase()); // "HELLO"

// Thá»±c táº¿ xáº£y ra:
// 1. str lÃ  primitive string
// 2. JS táº¡o new String("Hello") â€” wrapper object táº¡m
// 3. Gá»i .toUpperCase() trÃªn wrapper â†’ "HELLO"
// 4. Wrapper bá»‹ Há»¦Y ngay
// 5. str váº«n lÃ  primitive "Hello" (khÃ´ng thay Ä‘á»•i)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Number cÅ©ng cÃ³ methods
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let n = 1.23456;
alert(n.toFixed(2)); // "1.23"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Engine Tá»I Æ¯U â€” cÃ³ thá»ƒ skip táº¡o wrapper tháº­t sá»±
// â†’ NhÆ°ng BEHAVIOR váº«n nhÆ° cÃ³ wrapper
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### âš ï¸ new Number vs Number â€” KHÃ”NG Giá»‘ng Nhau!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// new Number(0) â†’ OBJECT (wrapper) â€” KHÃ”NG nÃªn dÃ¹ng!
// Number(0) â†’ PRIMITIVE â€” OK, dÃ¹ng cho type conversion
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(typeof 0); // "number" â€” primitive
alert(typeof new Number(0)); // "object" â€” wrapper!

// âš ï¸ Object luÃ´n TRUTHY trong boolean context:
let zero = new Number(0);
if (zero) {
  alert("zero is truthy!?!"); // â† CHáº Y! vÃ¬ zero lÃ  object
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… DÃ¹ng KHÃ”NG cÃ³ new â†’ type conversion (an toÃ n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let num = Number("123"); // 123 â€” primitive number
let str = String(123); // "123" â€” primitive string
let bool = Boolean(1); // true â€” primitive boolean
```

### null & undefined â€” KhÃ´ng CÃ³ Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// null vÃ  undefined KHÃ”NG cÃ³ wrapper object
// â†’ KHÃ”NG cÃ³ methods, truy cáº­p property â†’ ERROR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(null.test); // âŒ TypeError!
alert(undefined.test); // âŒ TypeError!

// â†’ ÄÃ¢y lÃ  "the most primitive" â€” HOÃ€N TOÃ€N khÃ´ng cÃ³ gÃ¬
```

### BÃ i Táº­p: str.test = 5

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GÃ¡n property cho primitive â€” chuyá»‡n gÃ¬ xáº£y ra?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "Hello";

str.test = 5; // (*)

alert(str.test); // ???

// STRICT MODE: âŒ TypeError táº¡i (*) â€” khÃ´ng gÃ¡n Ä‘Æ°á»£c
// NON-STRICT:  undefined

// Giáº£i thÃ­ch (non-strict):
// 1. str.test = 5 â†’ táº¡o wrapper object táº¡m
// 2. GÃ¡n test = 5 vÃ o wrapper
// 3. Wrapper bá»‹ Há»¦Y ngay sau Ä‘Ã³
// 4. str.test láº§n sau â†’ táº¡o wrapper Má»šI â†’ khÃ´ng cÃ³ test
// â†’ undefined

// âš ï¸ Káº¾T LUáº¬N: Primitives KHÃ”NG thá»ƒ lÆ°u thÃªm data
// â†’ Muá»‘n thÃªm properties â†’ dÃ¹ng OBJECT
```

### Tá»•ng Há»£p: Methods of Primitives

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  METHODS OF PRIMITIVES â€” SUMMARY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MECHANISM:                                                     â”‚
â”‚  â€¢ Primitive gá»i method â†’ JS táº¡o wrapper object Táº M           â”‚
â”‚  â€¢ Gá»i method trÃªn wrapper â†’ tráº£ primitive â†’ Há»¦Y wrapper      â”‚
â”‚  â€¢ Engine tá»‘i Æ°u (cÃ³ thá»ƒ skip wrapper), nhÆ°ng behavior giá»¯    â”‚
â”‚                                                                 â”‚
â”‚  WRAPPERS: String, Number, Boolean, Symbol, BigInt             â”‚
â”‚                                                                 â”‚
â”‚  NO WRAPPER: null, undefined â†’ KHÃ”NG cÃ³ methods                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ GOTCHAS:                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ new Number(0) â†’ object (truthy!) â€” Äá»ªNG dÃ¹ng       â”‚       â”‚
â”‚  â”‚ Number("123") â†’ primitive 123 â€” OK                   â”‚       â”‚
â”‚  â”‚ str.test = 5 â†’ wrapper táº¡m nháº­n rá»“i Há»¦Y â†’ máº¥t     â”‚       â”‚
â”‚  â”‚ Primitives KHÃ”NG lÆ°u thÃªm data/properties           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 33. Numbers â€” Kiá»ƒu Sá»‘

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NUMBERS IN JAVASCRIPT â€” Báº£n Äá»“ Tá»•ng Quan                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  2 LOáº I Sá»:                                                    â”‚
â”‚  â€¢ Regular numbers â€” IEEE-754 64-bit (double precision)        â”‚
â”‚  â€¢ BigInt â€” integers Ä‘á»™ dÃ i tÃ¹y Ã½ (chapter riÃªng)             â”‚
â”‚                                                                 â”‚
â”‚  VIáº¾T Sá»:                                                       â”‚
â”‚  1e9 = 1 tá»· | 1e-6 = 0.000001 | 1_000_000 (separator)       â”‚
â”‚  0xff (hex) | 0b1111 (binary) | 0o377 (octal)                 â”‚
â”‚                                                                 â”‚
â”‚  ROUNDING: floor â†“ | ceil â†‘ | round â‰ˆ | trunc âœ‚ï¸            â”‚
â”‚  toFixed(n) â†’ STRING (lÃ m trÃ²n n chá»¯ sá»‘ tháº­p phÃ¢n)           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ IEEE-754: 0.1 + 0.2 â‰  0.3 (precision loss)              â”‚
â”‚  âš ï¸ NaN !== NaN | isNaN vs Number.isNaN (strict)             â”‚
â”‚  âš ï¸ parseInt("100px") = 100 | parseFloat("12.5em") = 12.5   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÃ¡ch Viáº¿t Sá»‘ â€” e-notation & Separators

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// e-notation: nhÃ¢n/chia vá»›i 10^n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let billion = 1e9; // 1 * 10^9 = 1,000,000,000
alert(7.3e9); // 7,300,000,000

1e3 === 1 * 1000; // 1000
1.23e6 === 1.23 * 1000000; // 1230000

// Sá»‘ ráº¥t nhá»: e Ã¢m = chia cho 10^n
let mcs = 1e-6; // 1 / 10^6 = 0.000001
1e-3 === 1 / 1000; // 0.001
1.23e-6 === 1.23 / 1000000; // 0.00000123

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Underscore separator (ES2021) â€” syntactic sugar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let billion2 = 1_000_000_000; // dá»… Ä‘á»c, engine bá» qua _
```

### Hex, Binary, Octal

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3 há»‡ sá»‘ cÃ³ prefix riÃªng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(0xff); // 255 (hex, case-insensitive)
alert(0xff); // 255

let a = 0b11111111; // 255 (binary)
let b = 0o377; // 255 (octal)
alert(a == b); // true

// Há»‡ sá»‘ khÃ¡c â†’ dÃ¹ng parseInt(str, base)
```

### toString(base) â€” Chuyá»ƒn Sá»‘ Sang Chuá»—i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// num.toString(base) â€” base tá»« 2 Ä‘áº¿n 36
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let num = 255;
alert(num.toString(16)); // "ff"
alert(num.toString(2)); // "11111111"

// base=36: 0-9 + A-Z â€” rÃºt ngáº¯n ID
alert((123456).toString(36)); // "2n9c"

// âš ï¸ HAI Dáº¤U CHáº¤M: 123456..toString(36)
// Dáº¥u cháº¥m Ä‘áº§u = pháº§n tháº­p phÃ¢n (rá»—ng)
// Dáº¥u cháº¥m sau = gá»i method
// Hoáº·c: (123456).toString(36)
```

### Rounding â€” LÃ m TrÃ²n Sá»‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ROUNDING METHODS                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚             â”‚ floor  â”‚ ceil   â”‚ round  â”‚ trunc  â”‚             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  3.1        â”‚  3     â”‚  4     â”‚  3     â”‚  3     â”‚             â”‚
â”‚  3.5        â”‚  3     â”‚  4     â”‚  4     â”‚  3     â”‚             â”‚
â”‚  3.6        â”‚  3     â”‚  4     â”‚  4     â”‚  3     â”‚             â”‚
â”‚ -1.1        â”‚ -2     â”‚ -1     â”‚ -1     â”‚ -1     â”‚             â”‚
â”‚ -1.5        â”‚ -2     â”‚ -1     â”‚ -1     â”‚ -1     â”‚             â”‚
â”‚ -1.6        â”‚ -2     â”‚ -1     â”‚ -2     â”‚ -1     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                â”‚
â”‚  floor â†“ luÃ´n xuá»‘ng | ceil â†‘ luÃ´n lÃªn                        â”‚
â”‚  round â‰ˆ gáº§n nháº¥t (.5 lÃªn) | trunc âœ‚ï¸ cáº¯t pháº§n tháº­p phÃ¢n   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LÃ m trÃ²n Ä‘áº¿n n chá»¯ sá»‘ tháº­p phÃ¢n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡ch 1: multiply-and-divide
let num = 1.23456;
alert(Math.round(num * 100) / 100); // 1.23

// CÃ¡ch 2: toFixed(n) â†’ tráº£ STRING!
alert(num.toFixed(2)); // "1.23"
alert((12.36).toFixed(1)); // "12.4" (lÃ m trÃ²n lÃªn)
alert((12.34).toFixed(5)); // "12.34000" (thÃªm 0)

// âš ï¸ toFixed tráº£ STRING â†’ dÃ¹ng + hoáº·c Number() Ä‘á»ƒ convert
alert(+num.toFixed(2)); // 1.23 (number)
```

### Imprecise Calculations â€” IEEE-754

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 64 bits: 52 digits + 11 exponent + 1 sign
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(1e500); // Infinity â€” overflow

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 0.1 + 0.2 â‰  0.3 â€” precision loss!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(0.1 + 0.2 == 0.3); // false!
alert(0.1 + 0.2); // 0.30000000000000004

// Táº¡i sao? 0.1 trong binary lÃ  endless fraction
alert((0.1).toFixed(20)); // "0.10000000000000000555"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIáº¢I PHÃP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. toFixed
let sum = 0.1 + 0.2;
alert(+sum.toFixed(2)); // 0.3

// 2. Multiply â†’ integer math â†’ divide back
alert((0.1 * 10 + 0.2 * 10) / 10); // 0.3

// 3. LÆ°u cents thay vÃ¬ dollars (trÃ¡nh fractions)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GOTCHAS khÃ¡c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(9999999999999999); // 10000000000000000 (loss of precision)

// 6.35.toFixed(1) = "6.3" (khÃ´ng pháº£i 6.4!)
alert((6.35).toFixed(20)); // 6.3499999999...
// Fix: Math.round(6.35 * 10) / 10 â†’ 6.4

// Two zeroes: 0 vÃ  -0 tá»“n táº¡i (sign bit)
```

### isNaN, isFinite, Number.isNaN, Number.isFinite

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// isNaN(value) â€” convert rá»“i test
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(isNaN(NaN)); // true
alert(isNaN("str")); // true â€” "str" â†’ NaN

// âš ï¸ NaN !== NaN (unique!)
alert(NaN === NaN); // false

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// isFinite(value) â€” convert rá»“i test khÃ´ng pháº£i NaN/Â±Infinity
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(isFinite("15")); // true (convert â†’ 15)
alert(isFinite("str")); // false (NaN)
alert(isFinite(Infinity)); // false

// Validate input lÃ  sá»‘:
// isFinite(num) â†’ true náº¿u lÃ  regular number

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Number.isNaN / Number.isFinite â€” STRICT (khÃ´ng convert)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(Number.isNaN(NaN)); // true
alert(Number.isNaN("str")); // false! (string, khÃ´ng convert)
alert(isNaN("str")); // true  (convert â†’ NaN â†’ true)

alert(Number.isFinite(123)); // true
alert(Number.isFinite("123")); // false! (string, khÃ´ng convert)
alert(isFinite("123")); // true  (convert â†’ 123 â†’ true)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object.is â€” so sÃ¡nh SameValue (spec internal)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Object.is(NaN, NaN); // true  (khÃ¡c ===)
Object.is(0, -0); // false (khÃ¡c ===)
// CÃ²n láº¡i giá»‘ng === hoÃ n toÃ n
```

### parseInt & parseFloat â€” Äá»c Sá»‘ Tá»« Chuá»—i

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "Soft" conversion â€” Ä‘á»c cho Ä‘áº¿n khi gáº·p kÃ½ tá»± khÃ´ng há»£p lá»‡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(parseInt("100px")); // 100
alert(parseFloat("12.5em")); // 12.5
alert(parseInt("12.3")); // 12 (integer only)
alert(parseFloat("12.3.4")); // 12.3 (cháº¥m thá»© 2 â†’ dá»«ng)

alert(parseInt("a123")); // NaN (kÃ½ tá»± Ä‘áº§u khÃ´ng pháº£i sá»‘)

// âš ï¸ KhÃ¡c Number()/+ â€” strict, fail háº¿t:
alert(+"100px"); // NaN

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// parseInt(str, radix) â€” parse theo há»‡ sá»‘
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(parseInt("0xff", 16)); // 255
alert(parseInt("ff", 16)); // 255
alert(parseInt("2n9c", 36)); // 123456
```

### Math Object â€” HÃ m ToÃ¡n Há»c

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡c hÃ m thÆ°á»ng dÃ¹ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Math.random(); // 0 â‰¤ x < 1
Math.max(3, 5, -10, 0); // 5
Math.min(1, 2); // 1
Math.pow(2, 10); // 1024

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Random trong khoáº£ng [min, max)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function random(min, max) {
  return min + Math.random() * (max - min);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Random INTEGER trong khoáº£ng [min, max] (inclusive)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function randomInteger(min, max) {
  return Math.floor(min + Math.random() * (max + 1 - min));
}
// âš ï¸ Math.round cho XÃC SUáº¤T KHÃ”NG Äá»€U á»Ÿ biÃªn
// â†’ DÃ¹ng Math.floor + (max + 1 - min) cho uniform distribution
```

### Tá»•ng Há»£p: Numbers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NUMBERS â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  VIáº¾T Sá»:                                                       â”‚
â”‚  1e9 (tá»·) | 1e-6 (triá»‡u pháº§n) | 1_000 (separator)           â”‚
â”‚  0xff (hex) | 0b1111 (bin) | 0o377 (oct)                      â”‚
â”‚                                                                 â”‚
â”‚  CHUYá»‚N Äá»”I:                                                   â”‚
â”‚  num.toString(base) 2-36 | parseInt(str,base) | parseFloat    â”‚
â”‚                                                                 â”‚
â”‚  LÃ€M TRÃ’N:                                                     â”‚
â”‚  floor â†“ | ceil â†‘ | round â‰ˆ | trunc âœ‚ï¸ | toFixed(n)â†’STRING â”‚
â”‚                                                                 â”‚
â”‚  KIá»‚M TRA:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ isNaN(v)           â”‚ convert â†’ test NaN       â”‚              â”‚
â”‚  â”‚ Number.isNaN(v)    â”‚ NO convert, type+NaN     â”‚              â”‚
â”‚  â”‚ isFinite(v)        â”‚ convert â†’ not NaN/Â±Inf   â”‚              â”‚
â”‚  â”‚ Number.isFinite(v) â”‚ NO convert, type+finite  â”‚              â”‚
â”‚  â”‚ Object.is(a,b)     â”‚ NaN===NaNâœ“, 0!==-0âœ“    â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ 0.1+0.2â‰ 0.3 | toFixed("6.3" not "6.4") | NaN!==NaN      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 34. Strings â€” Chuá»—i KÃ½ Tá»±

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRINGS IN JAVASCRIPT â€” Báº£n Äá»“ Tá»•ng Quan                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Encoding: luÃ´n UTF-16 (khÃ´ng phá»¥ thuá»™c page encoding)         â”‚
â”‚  Immutable: KHÃ”NG thá»ƒ thay Ä‘á»•i kÃ½ tá»±, chá»‰ táº¡o string Má»šI    â”‚
â”‚                                                                 â”‚
â”‚  QUOTES:                                                        â”‚
â”‚  'single' = "double" (giá»‘ng nhau)                              â”‚
â”‚  `backticks` â†’ ${expr}, multi-line, tagged templates           â”‚
â”‚                                                                 â”‚
â”‚  TRUY Cáº¬P: str[0] | str.at(-1) (negative OK)                  â”‚
â”‚  Äá»˜ DÃ€I: str.length (property, KHÃ”NG pháº£i function)          â”‚
â”‚                                                                 â”‚
â”‚  TÃŒM KIáº¾M:                                                     â”‚
â”‚  indexOf(sub,pos) â†’ vá»‹ trÃ­/-1 | includes â†’ true/false        â”‚
â”‚  startsWith/endsWith â†’ true/false                              â”‚
â”‚                                                                 â”‚
â”‚  Cáº®T: slice(start,end) âœ… | substring | substr (deprecated)  â”‚
â”‚  CASE: toLowerCase() | toUpperCase()                           â”‚
â”‚  SO SÃNH: codePointAt | localeCompare (i18n)                  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ str.length lÃ  PROPERTY (khÃ´ng cÃ³ ())                      â”‚
â”‚  âš ï¸ indexOf tráº£ 0 = falsy trong if â†’ check !== -1            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quotes & Special Characters

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3 loáº¡i quotes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let single = "single-quoted";
let double = "double-quoted";
let backtick = `1 + 2 = ${1 + 2}`; // "1 + 2 = 3"

// Backticks: multi-line
let guestList = `Guests:
 * John
 * Pete`;

// Single/double: dÃ¹ng \n cho multi-line
let guestList2 = "Guests:\n * John\n * Pete";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Special characters (escape sequences)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// \n  New line        \t  Tab
// \\  Backslash       \'  Single quote
// \"  Double quote    \`  Backtick

alert("I'm the Walrus!"); // escape same-type quote
alert("I'm the Walrus!"); // hoáº·c dÃ¹ng quote khÃ¡c
alert(`The backslash: \\`); // "The backslash: \"
```

### Length, Access & Immutability

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .length â€” PROPERTY (khÃ´ng pháº£i function!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("My\n".length); // 3 (\n = 1 kÃ½ tá»±)
// âš ï¸ str.length â€” ÄÃšNG
// âŒ str.length() â€” SAI (TypeError)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Truy cáº­p kÃ½ tá»±: [] vÃ  .at()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "Hello";
alert(str[0]); // "H"
alert(str.at(0)); // "H"
alert(str[str.length - 1]); // "o"
alert(str.at(-1)); // "o" â† negative index OK!
alert(str[-2]); // undefined ([] khÃ´ng há»— trá»£ negative)
alert(str.at(-2)); // "l"

// Iterate: for..of
for (let char of "Hello") {
  alert(char); // H, e, l, l, o
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// IMMUTABLE â€” khÃ´ng thay Ä‘á»•i Ä‘Æ°á»£c kÃ½ tá»±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str2 = "Hi";
str2[0] = "h"; // âŒ khÃ´ng effect (strict â†’ error)
str2 = "h" + str2[1]; // âœ… táº¡o string Má»šI: "hi"
```

### Case & Searching

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// toLowerCase / toUpperCase
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("Interface".toUpperCase()); // "INTERFACE"
alert("Interface".toLowerCase()); // "interface"
alert("Interface"[0].toLowerCase()); // "i"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// indexOf(substr, pos) â€” tráº£ vá»‹ trÃ­ hoáº·c -1
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "Widget with id";
alert(str.indexOf("Widget")); // 0
alert(str.indexOf("widget")); // -1 (case-sensitive)
alert(str.indexOf("id")); // 1 (..idget)
alert(str.indexOf("id", 2)); // 12 (tÃ¬m tá»« pos 2)

// âš ï¸ GOTCHA: indexOf = 0 lÃ  FALSY trong if!
if (str.indexOf("Widget") != -1) {
  // â† pháº£i check !== -1
  alert("Found!");
}

// lastIndexOf â€” tÃ¬m tá»« cuá»‘i lÃªn

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// includes, startsWith, endsWith â€” true/false
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("Widget".includes("id")); // true
alert("Widget".includes("id", 3)); // false (tá»« pos 3)
alert("Widget".startsWith("Wid")); // true
alert("Widget".endsWith("get")); // true
```

### Getting a Substring â€” slice vs substring vs substr

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUBSTRING METHODS                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ method             â”‚ selectsâ€¦          â”‚ negatives            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ slice(start, end)  â”‚ start â†’ end       â”‚ âœ… cho phÃ©p         â”‚
â”‚ substring(s, e)    â”‚ giá»¯a s vÃ  e       â”‚ âŒ xem nhÆ° 0        â”‚
â”‚ substr(s, len)     â”‚ tá»« s, láº¥y len    â”‚ âœ… start negative   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ âš ï¸ substr â€” Annex B (deprecated), dÃ¹ng slice thay tháº¿       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
let str = "stringify";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// slice(start, end) â€” âœ… NÃŠN DÃ™NG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(str.slice(0, 5)); // "strin" (0 â†’ 5, khÃ´ng gá»“m 5)
alert(str.slice(2)); // "ringify" (2 â†’ háº¿t)
alert(str.slice(-4, -1)); // "gif" (negative OK)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// substring(start, end) â€” swap náº¿u start > end
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(str.substring(2, 6)); // "ring"
alert(str.substring(6, 2)); // "ring" (swap!)
alert(str.slice(6, 2)); // "" (slice â†’ rá»—ng)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// substr(start, length) â€” âš ï¸ deprecated
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(str.substr(2, 4)); // "ring" (tá»« 2, láº¥y 4 chars)
alert(str.substr(-4, 2)); // "gi" (negative start OK)

// â†’ Chá»‰ cáº§n nhá»› slice lÃ  Ä‘á»§!
```

### Comparing Strings â€” UTF-16 & localeCompare

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Strings so sÃ¡nh theo CHARACTER CODE (UTF-16)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("a" > "Z"); // true! (97 > 90)
alert("Ã–sterreich" > "Zealand"); // true! (Ã– code lá»›n hÆ¡n)

// codePointAt / fromCodePoint
alert("Z".codePointAt(0)); // 90
alert("z".codePointAt(0)); // 122
alert(String.fromCodePoint(90)); // "Z"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// localeCompare â€” so sÃ¡nh Ä‘Ãºng theo ngÃ´n ngá»¯ (i18n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert("Ã–sterreich".localeCompare("Zealand")); // -1 (Ã– < Z Ä‘Ãºng!)
// Tráº£: negative (nhá» hÆ¡n) | 0 (báº±ng) | positive (lá»›n hÆ¡n)
// Há»— trá»£ locale, case sensitivity, diacritical marks
```

### Practical Methods & Exercises

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡c methods há»¯u Ã­ch khÃ¡c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

" hello ".trim(); // "hello" (bá» spaces 2 Ä‘áº§u)
"ha".repeat(3); // "hahaha"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Táº¬P 1: ucFirst â€” viáº¿t hoa chá»¯ Ä‘áº§u
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ucFirst(str) {
  if (!str) return str;
  return str[0].toUpperCase() + str.slice(1);
}
alert(ucFirst("john")); // "John"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Táº¬P 2: checkSpam â€” case-insensitive
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function checkSpam(str) {
  let lower = str.toLowerCase();
  return lower.includes("viagra") || lower.includes("xxx");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Táº¬P 3: truncate â€” cáº¯t string + "â€¦"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function truncate(str, maxlength) {
  return str.length > maxlength ? str.slice(0, maxlength - 1) + "â€¦" : str;
}
// truncate("What I'd like to tell", 20) â†’ "What I'd like to teâ€¦"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Táº¬P 4: extractCurrencyValue
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function extractCurrencyValue(str) {
  return +str.slice(1);
}
alert(extractCurrencyValue("$120") === 120); // true
```

### Tá»•ng Há»£p: Strings

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRINGS â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  QUOTES: 'single' = "double" | `backticks` (${}, multi-line)  â”‚
â”‚  ENCODING: UTF-16 | IMMUTABLE: khÃ´ng sá»­a, chá»‰ táº¡o má»›i       â”‚
â”‚                                                                 â”‚
â”‚  TRUY Cáº¬P:                                                     â”‚
â”‚  str.length (property!) | str[0] | str.at(-1) (negative OK)  â”‚
â”‚                                                                 â”‚
â”‚  TÃŒM KIáº¾M:                                                     â”‚
â”‚  indexOf(sub) â†’ pos/-1 | includes â†’ bool                     â”‚
â”‚  startsWith/endsWith â†’ bool                                   â”‚
â”‚                                                                 â”‚
â”‚  Cáº®T CHUá»–I: slice(start, end) âœ… (nhá»› má»—i slice lÃ  Ä‘á»§)    â”‚
â”‚  CASE: toLowerCase() / toUpperCase()                           â”‚
â”‚  TIá»†N ÃCH: trim(), repeat(n)                                  â”‚
â”‚                                                                 â”‚
â”‚  SO SÃNH: character code (a>Z!) | localeCompare (i18n Ä‘Ãºng)  â”‚
â”‚  codePointAt() â†” String.fromCodePoint()                      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ str.length khÃ´ng cÃ³ () | indexOf=0 falsy | substr=deprecatedâ”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 35. Arrays â€” Máº£ng

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ARRAYS IN JAVASCRIPT â€” Báº£n Äá»“ Tá»•ng Quan                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Array = OBJECT Ä‘áº·c biá»‡t cho ORDERED COLLECTION               â”‚
â”‚  LÆ°u theo reference (nhÆ° object) | Deque (2 Ä‘áº§u)              â”‚
â”‚                                                                 â”‚
â”‚  KHAI BÃO: let arr = [a, b, c]  (âœ… dÃ¹ng [])                 â”‚
â”‚  TRUY Cáº¬P: arr[0] | arr.at(-1) (negative OK)                  â”‚
â”‚  Äá»˜ DÃ€I: arr.length (greatest index + 1, writable!)          â”‚
â”‚                                                                 â”‚
â”‚  CUá»I Máº¢NG (NHANH):                                            â”‚
â”‚  push(...items) â†’ thÃªm cuá»‘i | pop() â†’ láº¥y cuá»‘i              â”‚
â”‚                                                                 â”‚
â”‚  Äáº¦U Máº¢NG (CHáº¬M â€” pháº£i shift táº¥t cáº£):                        â”‚
â”‚  unshift(...items) â†’ thÃªm Ä‘áº§u | shift() â†’ láº¥y Ä‘áº§u          â”‚
â”‚                                                                 â”‚
â”‚  LOOPS: for (i) âœ… | for..of âœ… | for..in âŒ NEVER           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Array = object â†’ copy by REFERENCE                       â”‚
â”‚  âš ï¸ [] == [] â†’ false (different objects)                      â”‚
â”‚  âš ï¸ 0 == [] â†’ true ([] â†’ "" â†’ 0)                            â”‚
â”‚  âš ï¸ new Array(2) â†’ [empty Ã— 2], NOT [2]                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Khai BÃ¡o & Truy Cáº­p

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Khai bÃ¡o â€” luÃ´n dÃ¹ng []
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fruits = ["Apple", "Orange", "Plum"];
alert(fruits[0]); // "Apple"
alert(fruits.length); // 3

// Mix types OK (nhÆ°ng hiáº¿m khi dÃ¹ng)
let arr = [
  "Apple",
  { name: "John" },
  true,
  function () {
    alert("hi");
  },
];
arr[3](); // "hi"

// Trailing comma OK
let items = [
  "Apple",
  "Orange",
  "Plum", // â† trailing comma
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .at() â€” negative index
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(fruits[fruits.length - 1]); // "Plum" (cÃ¡ch cÅ©)
alert(fruits.at(-1)); // "Plum" (cÃ¡ch má»›i âœ…)
alert(fruits.at(-2)); // "Orange"
```

### push/pop, shift/unshift â€” Deque Operations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ARRAY AS DEQUE â€” Thao tÃ¡c 2 Ä‘áº§u                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  unshift â”€â”€â†’ [ a, b, c, d ] â†â”€â”€ push                        â”‚
â”‚  shift  â†â”€â”€ [ a, b, c, d ] â”€â”€â†’ pop                          â”‚
â”‚                                                                â”‚
â”‚  Stack (LIFO): push + pop (NHANH)                             â”‚
â”‚  Queue (FIFO): push + shift (shift CHáº¬M)                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CUá»I máº£ng â€” NHANH (O(1))
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fruits = ["Apple", "Orange"];
fruits.push("Pear"); // thÃªm cuá»‘i â†’ ["Apple", "Orange", "Pear"]
alert(fruits.pop()); // "Pear" â€” láº¥y + xÃ³a cuá»‘i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äáº¦U máº£ng â€” CHáº¬M (O(n) â€” pháº£i dá»‹ch táº¥t cáº£)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fruits.unshift("Banana"); // thÃªm Ä‘áº§u â†’ ["Banana", "Apple", "Orange"]
alert(fruits.shift()); // "Banana" â€” láº¥y + xÃ³a Ä‘áº§u

// Push/unshift nhiá»u items cÃ¹ng lÃºc
fruits.push("Peach", "Grape");
fruits.unshift("Mango", "Kiwi");
```

### Performance â€” Táº¡i Sao shift/unshift Cháº­m

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  push/pop vs shift/unshift â€” PERFORMANCE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  pop():   [a, b, c, d] â†’ [a, b, c]                          â”‚
â”‚           Chá»‰ xÃ³a cuá»‘i + giáº£m length â†’ O(1)                 â”‚
â”‚                                                                â”‚
â”‚  shift(): [a, b, c, d] â†’ [b, c, d]                          â”‚
â”‚           1. XÃ³a index 0                                      â”‚
â”‚           2. Dá»‹ch Táº¤T Cáº¢ elements sang trÃ¡i                 â”‚
â”‚           3. Cáº­p nháº­t length                                  â”‚
â”‚           â†’ O(n) â€” cÃ ng nhiá»u elements cÃ ng cháº­m             â”‚
â”‚                                                                â”‚
â”‚  âš ï¸ push/pop = NHANH | shift/unshift = CHáº¬M                â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Internals â€” Array LÃ  Object

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Array = object Ä‘áº·c biá»‡t â†’ copy by REFERENCE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fruits = ["Banana"];
let arr = fruits; // copy REFERENCE, cÃ¹ng 1 array
arr.push("Pear");
alert(fruits); // "Banana,Pear" â€” cáº£ 2 tháº¥y thay Ä‘á»•i!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Misuse â€” Äá»ªNG LÃ€M NHá»®NG ÄIá»€U NÃ€Y
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let bad = [];
bad.test = 5; // âŒ Non-numeric property
bad[99999] = 1; // âŒ Táº¡o lá»— há»•ng lá»›n
// â†’ Engine Táº®T array optimizations!

// âš ï¸ Array tá»‘i Æ°u cho CONTIGUOUS ORDERED DATA
// Náº¿u cáº§n arbitrary keys â†’ dÃ¹ng object {}
```

### Loops â€” for, for..of, âŒfor..in

```javascript
let arr = ["Apple", "Orange", "Pear"];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// for classic â€” nhanh nháº¥t, old-browser OK
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

for (let i = 0; i < arr.length; i++) {
  alert(arr[i]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// for..of â€” modern, ngáº¯n gá»n âœ…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

for (let fruit of arr) {
  alert(fruit); // chá»‰ value, khÃ´ng cÃ³ index
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// for..in â€” âŒ NEVER dÃ¹ng cho arrays!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

for (let key in arr) {
  alert(arr[key]); // "hoáº¡t Ä‘á»™ng" nhÆ°ng...
}
// Váº¥n Ä‘á»:
// 1. Láº·p Táº¤T Cáº¢ properties (ká»ƒ cáº£ non-numeric)
// 2. Tá»‘i Æ°u cho generic objects, CHáº¬M 10-100x
// 3. Array-like objects cÃ³ thÃªm properties láº¡
```

### length, new Array, Multidimensional

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// length = greatest numeric index + 1 (WRITABLE!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr = [1, 2, 3, 4, 5];
arr.length = 2; // TRUNCATE! â†’ [1, 2]
arr.length = 5; // má»Ÿ rá»™ng nhÆ°ng values KHÃ”NG quay láº¡i
alert(arr[3]); // undefined

arr.length = 0; // âœ… cÃ¡ch nhanh nháº¥t xÃ³a sáº¡ch array

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// new Array(n) â€” GOTCHA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let bad = new Array(2); // [empty Ã— 2], NOT [2]!
alert(bad[0]); // undefined
alert(bad.length); // 2
// â†’ LuÃ´n dÃ¹ng [] Ä‘á»ƒ trÃ¡nh báº«y

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Multidimensional arrays
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let matrix = [
  [1, 2, 3],
  [4, 5, 6],
  [7, 8, 9],
];
alert(matrix[0][1]); // 2
```

### toString & So SÃ¡nh Arrays

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// toString â€” comma-separated string
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert([1, 2, 3]); // "1,2,3"
alert(String([1, 2, 3])); // "1,2,3"

// KhÃ´ng cÃ³ Symbol.toPrimitive, khÃ´ng cÃ³ valueOf
// Chá»‰ toString: [] â†’ "", [1] â†’ "1", [1,2] â†’ "1,2"

alert([] + 1); // "1"   (""  + 1)
alert([1] + 1); // "11"  ("1" + 1)
alert([1, 2] + 1); // "1,21"("1,2" + 1)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ Äá»ªNG SO SÃNH arrays vá»›i ==
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert([] == []); // false! (2 objects khÃ¡c nhau)
alert([0] == [0]); // false!

// So sÃ¡nh vá»›i primitive â†’ convert array to primitive
alert(0 == []); // true!  ([] â†’ "" â†’ 0)
alert("0" == []); // false! ("0" !== "")

// â†’ So sÃ¡nh arrays: dÃ¹ng loop item-by-item
```

### BÃ i Táº­p: Kadane's Algorithm â€” Max Subarray Sum

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TÃ¬m subarray liÃªn tiáº¿p cÃ³ tá»•ng lá»›n nháº¥t â€” O(n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getMaxSubSum(arr) {
  let maxSum = 0;
  let partialSum = 0;

  for (let item of arr) {
    partialSum += item;
    maxSum = Math.max(maxSum, partialSum);
    if (partialSum < 0) partialSum = 0; // reset náº¿u Ã¢m
  }

  return maxSum;
}

alert(getMaxSubSum([-1, 2, 3, -9])); // 5
alert(getMaxSubSum([2, -1, 2, 3, -9])); // 6
alert(getMaxSubSum([-1, 2, 3, -9, 11])); // 11
alert(getMaxSubSum([-1, -2, -3])); // 0 (empty subarray)

// âš ï¸ Náº¿u táº¥t cáº£ Ã¢m â†’ tráº£ 0 (láº¥y 0 elements)
// Trick: partialSum < 0 â†’ reset vá» 0
// â†’ Chá»‰ cáº§n 1 láº§n duyá»‡t array
```

### Tá»•ng Há»£p: Arrays

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ARRAYS â€” SUMMARY                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Khai bÃ¡o: [] (âœ…) | new Array() (rare, gotcha vá»›i single num)â”‚
â”‚  Truy cáº­p: arr[0] | arr.at(-1) | arr.length (writable!)      â”‚
â”‚                                                                 â”‚
â”‚  THAO TÃC:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ Method     â”‚ Vá»‹ trÃ­   â”‚ Speed â”‚                              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚
â”‚  â”‚ push()     â”‚ cuá»‘i     â”‚ FAST  â”‚                              â”‚
â”‚  â”‚ pop()      â”‚ cuá»‘i     â”‚ FAST  â”‚                              â”‚
â”‚  â”‚ unshift()  â”‚ Ä‘áº§u     â”‚ SLOW  â”‚                              â”‚
â”‚  â”‚ shift()    â”‚ Ä‘áº§u     â”‚ SLOW  â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                 â”‚
â”‚  LOOPS: for(i) âœ… | for..of âœ… | for..in âŒ                  â”‚
â”‚  COPY BY REFERENCE (lÃ  object!)                                â”‚
â”‚  COMPARE: âŒ == | âœ… loop item-by-item                        â”‚
â”‚  toString: [1,2] â†’ "1,2" | [] + 1 â†’ "1"                     â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ arr.length=0 xÃ³a sáº¡ch | misuse kills optimization       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 36. Array Methods â€” PhÆ°Æ¡ng Thá»©c Máº£ng

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ARRAY METHODS â€” Báº£n Äá»“ Tá»•ng Quan                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  THÃŠM/XÃ“A:                                                     â”‚
â”‚  splice(pos, del, ...items) â€” Swiss army knife (MUTATE)       â”‚
â”‚  slice(start, end) â†’ new array (COPY)                         â”‚
â”‚  concat(...items) â†’ new array                                 â”‚
â”‚                                                                 â”‚
â”‚  TÃŒM KIáº¾M:                                                     â”‚
â”‚  indexOf/lastIndexOf â†’ pos/-1 | includes â†’ bool              â”‚
â”‚  find(fn) â†’ item/undefined | findIndex(fn) â†’ pos/-1          â”‚
â”‚  filter(fn) â†’ [matching items]                                â”‚
â”‚                                                                 â”‚
â”‚  BIáº¾N Äá»”I:                                                     â”‚
â”‚  map(fn) â†’ new array | sort(fn) â€” MUTATE, default=string    â”‚
â”‚  reverse() â€” MUTATE | split/join â€” strâ†”arr                   â”‚
â”‚  reduce(fn, init) â†’ single value                             â”‚
â”‚                                                                 â”‚
â”‚  KIá»‚M TRA:                                                     â”‚
â”‚  Array.isArray() | some(fn) â€” âˆƒ | every(fn) â€” âˆ€             â”‚
â”‚  flat(depth) | flatMap(fn)                                    â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ sort/reverse/splice MUTATE array gá»‘c!                    â”‚
â”‚  âš ï¸ sort() default = STRING comparison!                       â”‚
â”‚  âš ï¸ includes xá»­ lÃ½ NaN Ä‘Ãºng, indexOf thÃ¬ KHÃ”NG             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### splice â€” Swiss Army Knife (MUTATE)

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// splice(start, deleteCount, ...items) â€” MUTATE array
// Tráº£ vá» array cÃ¡c elements Ä‘Ã£ xÃ³a
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// XÃ“A
let arr = ["I", "study", "JavaScript"];
arr.splice(1, 1); // tá»« index 1, xÃ³a 1
alert(arr); // ["I", "JavaScript"]

// XÃ“A + THAY THáº¾
let arr2 = ["I", "study", "JavaScript", "right", "now"];
let removed = arr2.splice(0, 3, "Let's", "dance");
alert(arr2); // ["Let's", "dance", "right", "now"]
alert(removed); // ["I", "study", "JavaScript"]

// CHá»ˆ CHÃˆN (deleteCount = 0)
let arr3 = ["I", "study", "JavaScript"];
arr3.splice(2, 0, "complex", "language");
alert(arr3); // ["I", "study", "complex", "language", "JavaScript"]

// NEGATIVE INDEX
let arr4 = [1, 2, 5];
arr4.splice(-1, 0, 3, 4); // chÃ¨n trÆ°á»›c pháº§n tá»­ cuá»‘i
alert(arr4); // [1, 2, 3, 4, 5]

// âš ï¸ delete arr[1] â†’ Ä‘á»ƒ láº¡i hole, dÃ¹ng splice thay tháº¿!
```

### slice & concat (KHÃ”NG mutate)

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// slice(start, end) â†’ NEW array (khÃ´ng mutate)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr = ["t", "e", "s", "t"];
alert(arr.slice(1, 3)); // ["e", "s"]
alert(arr.slice(-2)); // ["s", "t"]
let copy = arr.slice(); // âœ… shallow copy

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// concat(...items) â†’ NEW array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr2 = [1, 2];
alert(arr2.concat([3, 4])); // [1, 2, 3, 4]
alert(arr2.concat([3, 4], [5, 6])); // [1, 2, 3, 4, 5, 6]
alert(arr2.concat([3, 4], 5, 6)); // [1, 2, 3, 4, 5, 6]

// Symbol.isConcatSpreadable â€” cho array-like objects
let arrayLike = {
  0: "something",
  1: "else",
  [Symbol.isConcatSpreadable]: true,
  length: 2,
};
alert(arr2.concat(arrayLike)); // [1, 2, "something", "else"]
```

### forEach, indexOf, includes, find, filter

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// forEach(fn) â€” cháº¡y fn cho má»—i element, KHÃ”NG tráº£ gÃ¬
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

["Bilbo", "Gandalf", "Nazgul"].forEach((item, index, array) => {
  alert(`${item} is at index ${index}`);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// indexOf/includes â€” giá»‘ng string counterparts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr = [1, 0, false];
alert(arr.indexOf(0)); // 1 (strict ===)
alert(arr.indexOf(false)); // 2
alert(arr.indexOf(null)); // -1

alert(arr.includes(1)); // true

// âš ï¸ includes xá»­ lÃ½ NaN ÄÃšNG, indexOf thÃ¬ KHÃ”NG!
alert([NaN].indexOf(NaN)); // -1 (sai!)
alert([NaN].includes(NaN)); // true (Ä‘Ãºng!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// find(fn) â†’ FIRST item thá»a Ä‘iá»u kiá»‡n (hoáº·c undefined)
// findIndex(fn) â†’ index / -1
// findLastIndex(fn) â†’ tÃ¬m tá»« cuá»‘i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let users = [
  { id: 1, name: "John" },
  { id: 2, name: "Pete" },
  { id: 3, name: "Mary" },
  { id: 4, name: "John" },
];

let user = users.find((item) => item.id === 1);
alert(user.name); // "John"

alert(users.findIndex((u) => u.name === "John")); // 0
alert(users.findLastIndex((u) => u.name === "John")); // 3

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// filter(fn) â†’ ALL items thá»a Ä‘iá»u kiá»‡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let someUsers = users.filter((item) => item.id < 3);
alert(someUsers.length); // 2
```

### map, sort, reverse

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// map(fn) â†’ NEW array (káº¿t quáº£ fn cho má»—i element)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let lengths = ["Bilbo", "Gandalf", "Nazgul"].map((item) => item.length);
alert(lengths); // [5, 7, 6]

// âš ï¸ map tráº£ OBJECT â†’ pháº£i bá»c () cho arrow function
let usersMapped = users.map((user) => ({
  fullName: user.name,
  id: user.id,
}));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// sort(fn) â€” MUTATE! Default = string comparison!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr = [1, 2, 15];
arr.sort();
alert(arr); // [1, 15, 2] â† SAI! (so sÃ¡nh STRING)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// a vÃ  b LÃ€ GÃŒ trong sort((a, b) => ...)?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// sort() gá»i callback NHIá»€U Láº¦N vá»›i Cáº¶P pháº§n tá»­:
//   a = pháº§n tá»­ ÄANG XÃ‰T (current element)
//   b = pháº§n tá»­ SO SÃNH (comparison element)
//
// RETURN VALUE quyáº¿t Ä‘á»‹nh THá»¨ Tá»°:
//   < 0 (Ã¢m)  â†’ a Ä‘á»©ng TRÆ¯á»šC b  (a â† b)
//   = 0        â†’ giá»¯ nguyÃªn       (a = b)
//   > 0 (dÆ°Æ¡ng)â†’ a Ä‘á»©ng SAU b    (b â† a)
//
// VÃ Dá»¤: sort((a, b) => a - b) â€” sáº¯p xáº¿p TÄ‚NG Dáº¦N:
//   a=2, b=15 â†’ 2-15 = -13 (Ã¢m) â†’ 2 trÆ°á»›c 15 âœ…
//   a=15, b=1 â†’ 15-1 = 14 (dÆ°Æ¡ng) â†’ 15 sau 1 âœ…
//
// sort((a, b) => b - a) â€” sáº¯p xáº¿p GIáº¢M Dáº¦N:
//   a=2, b=15 â†’ 15-2 = 13 (dÆ°Æ¡ng) â†’ 2 sau 15
//   â†’ káº¿t quáº£: [15, 2, 1]
//
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚  SORT COMPARISON FLOW:                            â”‚
// â”‚                                                    â”‚
// â”‚  sort((a, b) => a - b)  â€” TÄ‚NG Dáº¦N               â”‚
// â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
// â”‚  â”‚  a   â”‚  b   â”‚ a - b  â”‚ Káº¿t quáº£          â”‚       â”‚
// â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
// â”‚  â”‚  2   â”‚  15  â”‚  -13   â”‚ 2 trÆ°á»›c 15       â”‚       â”‚
// â”‚  â”‚  15  â”‚  1   â”‚  +14   â”‚ 15 sau 1         â”‚       â”‚
// â”‚  â”‚  2   â”‚  1   â”‚  +1    â”‚ 2 sau 1          â”‚       â”‚
// â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
// â”‚  â†’ Káº¿t quáº£: [1, 2, 15] âœ…                         â”‚
// â”‚                                                    â”‚
// â”‚  sort((a, b) => b - a)  â€” GIáº¢M Dáº¦N               â”‚
// â”‚  â†’ Äáº£o a vÃ  b â†’ sá»‘ lá»›n Ä‘á»©ng trÆ°á»›c!               â”‚
// â”‚  â†’ Káº¿t quáº£: [15, 2, 1]                            â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

arr.sort((a, b) => a - b);
alert(arr); // [1, 2, 15] â† ÄÃšNG!

// Strings â†’ dÃ¹ng localeCompare
// a.localeCompare(b) tráº£ -1/0/1 (Ã¢m = a trÆ°á»›c b theo alphabet)
let countries = ["Ã–sterreich", "Andorra", "Vietnam"];
countries.sort((a, b) => a.localeCompare(b));
alert(countries); // ["Andorra", "Ã–sterreich", "Vietnam"]

// Sort objects theo property:
let users = [
  { name: "John", age: 25 },
  { name: "Pete", age: 20 },
];
users.sort((a, b) => a.age - b.age);
// a.age=25, b.age=20 â†’ 25-20=5 (dÆ°Æ¡ng) â†’ a sau b
// â†’ [{age:20}, {age:25}] â€” TÄ‚NG Dáº¦N theo tuá»•i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// reverse() â€” MUTATE! Äáº£o ngÆ°á»£c array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arr2 = [1, 2, 3, 4, 5];
arr2.reverse();
alert(arr2); // [5, 4, 3, 2, 1]
```

### split/join, reduce

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// str.split(delim) â†’ array | arr.join(glue) â†’ string
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let names = "Bilbo, Gandalf, Nazgul";
let arr = names.split(", ");
alert(arr); // ["Bilbo", "Gandalf", "Nazgul"]

alert("test".split("")); // ["t", "e", "s", "t"]

let str = arr.join(";");
alert(str); // "Bilbo;Gandalf;Nazgul"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// reduce(fn, initial) â†’ single value
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let sum = [1, 2, 3, 4, 5].reduce((acc, cur) => acc + cur, 0);
alert(sum); // 15

// âš ï¸ KhÃ´ng cÃ³ initial + array rá»—ng â†’ ERROR!
// â†’ LuÃ´n cung cáº¥p initial value

// reduceRight â€” giá»‘ng reduce nhÆ°ng tá»« pháº£i sang trÃ¡i
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REDUCE FLOW: [1, 2, 3, 4, 5].reduce((acc, cur) => acc+cur, 0)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Call     â”‚ acc     â”‚ cur     â”‚ result                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1st      â”‚ 0       â”‚ 1       â”‚ 1                              â”‚
â”‚ 2nd      â”‚ 1       â”‚ 2       â”‚ 3                              â”‚
â”‚ 3rd      â”‚ 3       â”‚ 3       â”‚ 6                              â”‚
â”‚ 4th      â”‚ 6       â”‚ 4       â”‚ 10                             â”‚
â”‚ 5th      â”‚ 10      â”‚ 5       â”‚ 15 â† final                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Array.isArray, some/every, flat

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Array.isArray â€” vÃ¬ typeof [] = "object"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(typeof []); // "object" (khÃ´ng phÃ¢n biá»‡t Ä‘Æ°á»£c!)
alert(Array.isArray([])); // true âœ…
alert(Array.isArray({})); // false

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// some(fn) â€” âˆƒ cÃ³ ÃT NHáº¤T 1 element thá»a?
// every(fn) â€” âˆ€ Táº¤T Cáº¢ elements thá»a?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert([1, -2, 3].some((n) => n < 0)); // true
alert([1, 2, 3].every((n) => n > 0)); // true

// âœ… So sÃ¡nh arrays báº±ng every
function arraysEqual(arr1, arr2) {
  return arr1.length === arr2.length && arr1.every((v, i) => v === arr2[i]);
}
alert(arraysEqual([1, 2], [1, 2])); // true

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// flat(depth) / flatMap(fn)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert([1, [2, [3]]].flat()); // [1, 2, [3]] (depth=1)
alert([1, [2, [3]]].flat(Infinity)); // [1, 2, 3]
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: camelize â€” "my-short-string" â†’ "myShortString"
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function camelize(str) {
  return str
    .split("-")
    .map((word, i) => (i === 0 ? word : word[0].toUpperCase() + word.slice(1)))
    .join("");
}
alert(camelize("background-color")); // "backgroundColor"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: filterRange â€” tráº£ NEW array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function filterRange(arr, a, b) {
  return arr.filter((item) => a <= item && item <= b);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 3: filterRangeInPlace â€” MUTATE array gá»‘c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function filterRangeInPlace(arr, a, b) {
  for (let i = 0; i < arr.length; i++) {
    if (arr[i] < a || arr[i] > b) {
      arr.splice(i, 1);
      i--; // â† quan trá»ng! vÃ¬ splice dá»‹ch elements
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 4: Fisher-Yates Shuffle â€” uniform random
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    let j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]]; // destructuring swap
  }
}
// âš ï¸ arr.sort(() => Math.random() - 0.5) â†’ KHÃ”NG uniform!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 5: getAverageAge â€” reduce
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getAverageAge(users) {
  return users.reduce((sum, u) => sum + u.age, 0) / users.length;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 6: groupById â€” reduce táº¡o object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function groupById(arr) {
  return arr.reduce((obj, item) => {
    obj[item.id] = item;
    return obj;
  }, {});
}
```

### Tá»•ng Há»£p: Array Methods

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ARRAY METHODS â€” CHEAT SHEET                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  THÃŠM/XÃ“A:                                                     â”‚
â”‚  push/pop/shift/unshift (Â§35)                                  â”‚
â”‚  splice(pos, del, ...items) â€” MUTATE, Swiss army knife        â”‚
â”‚  slice(start, end) â†’ new array copy                           â”‚
â”‚  concat(...items) â†’ new array (Symbol.isConcatSpreadable)     â”‚
â”‚                                                                 â”‚
â”‚  TÃŒM KIáº¾M:                                                     â”‚
â”‚  indexOf/lastIndexOf â†’ pos/-1 (===, NaN sai!)                â”‚
â”‚  includes â†’ bool (NaN Ä‘Ãºng âœ…)                                â”‚
â”‚  find(fn) â†’ first item | filter(fn) â†’ all items              â”‚
â”‚  findIndex / findLastIndex â†’ pos/-1                           â”‚
â”‚                                                                 â”‚
â”‚  BIáº¾N Äá»”I:                                                     â”‚
â”‚  map(fn) â†’ new array | forEach(fn) â†’ void                    â”‚
â”‚  sort(fn) â€” MUTATE, default STRING! (a,b)=>a-b cho numbers  â”‚
â”‚  reverse() â€” MUTATE | split(delim)â†”join(glue)                â”‚
â”‚  reduce(fn, init) â†’ accumulate single value                  â”‚
â”‚                                                                 â”‚
â”‚  KIá»‚M TRA:                                                     â”‚
â”‚  Array.isArray() | some (âˆƒ) | every (âˆ€)                      â”‚
â”‚  flat(depth) | flatMap(fn) | fill | copyWithin               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ MUTATE: sort, reverse, splice, push/pop/shift/unshift    â”‚
â”‚  âš ï¸ sort() máº·c Ä‘á»‹nh so sÃ¡nh STRING                            â”‚
â”‚  âš ï¸ map tráº£ object â†’ bá»c () : user => ({...})               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 37. Iterables â€” Äá»‘i TÆ°á»£ng Láº·p ÄÆ°á»£c

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ITERABLES â€” Báº£n Äá»“ Tá»•ng Quan                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ITERABLE = object cÃ³ Symbol.iterator method                   â”‚
â”‚  â†’ DÃ¹ng Ä‘Æ°á»£c trong for..of, spread, destructuring              â”‚
â”‚                                                                 â”‚
â”‚  PROTOCOL:                                                      â”‚
â”‚  obj[Symbol.iterator]() â†’ { next() }                           â”‚
â”‚  next() â†’ { done: bool, value: any }                           â”‚
â”‚                                                                 â”‚
â”‚  BUILT-IN ITERABLES:                                            â”‚
â”‚  Array âœ… | String âœ… (surrogate-aware) | Map/Set âœ…            â”‚
â”‚  Plain Object âŒ (khÃ´ng iterable máº·c Ä‘á»‹nh)                     â”‚
â”‚                                                                 â”‚
â”‚  PHÃ‚N BIá»†T:                                                     â”‚
â”‚  Iterable: cÃ³ Symbol.iterator â†’ for..of âœ…                     â”‚
â”‚  Array-like: cÃ³ indexes + length â†’ for..of âŒ (trá»« khi iterable)â”‚
â”‚  String: Cáº¢ HAI (iterable + array-like)                        â”‚
â”‚                                                                 â”‚
â”‚  Array.from(iterableOrArrayLike, mapFn?)                       â”‚
â”‚  â†’ Biáº¿n iterable/array-like thÃ nh Array tháº­t                  â”‚
â”‚  â†’ Xá»­ lÃ½ surrogate pairs Ä‘Ãºng (khÃ¡c str.split)               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ 2 for..of song song cÃ¹ng object â†’ cáº§n iterator riÃªng     â”‚
â”‚  âš ï¸ Array-like â‰  Iterable (khÃ¡c nhau!)                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Symbol.iterator Protocol

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o object iterable vá»›i Symbol.iterator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let range = {
  from: 1,
  to: 5,
};

// ThÃªm Symbol.iterator â†’ dÃ¹ng Ä‘Æ°á»£c for..of
range[Symbol.iterator] = function () {
  // Tráº£ vá» iterator object
  return {
    current: this.from,
    last: this.to,

    next() {
      if (this.current <= this.last) {
        return { done: false, value: this.current++ };
      } else {
        return { done: true };
      }
    },
  };
};

for (let num of range) {
  alert(num); // 1, 2, 3, 4, 5
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ITERATOR PROTOCOL FLOW                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  for..of báº¯t Ä‘áº§u                                               â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  obj[Symbol.iterator]() â†’ iterator { next() }                  â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  â”Œâ”€â†’ iterator.next()                                           â”‚
â”‚  â”‚      â”‚                                                       â”‚
â”‚  â”‚      â”œâ”€â†’ { done: false, value: 1 } â†’ loop body              â”‚
â”‚  â”‚      â”œâ”€â†’ { done: false, value: 2 } â†’ loop body              â”‚
â”‚  â”‚      â”œâ”€â†’ { done: false, value: 3 } â†’ loop body              â”‚
â”‚  â”‚      â””â”€â†’ { done: true } â†’ STOP                              â”‚
â”‚  â”‚                                                              â”‚
â”‚  â””â”€â”€ láº·p láº¡i cho Ä‘áº¿n done: true                                â”‚
â”‚                                                                 â”‚
â”‚  KEY: obj vÃ  iterator lÃ  2 OBJECTS RIÃŠNG BIá»†T                  â”‚
â”‚  â†’ Separation of concerns                                      â”‚
â”‚  â†’ Cho phÃ©p 2 for..of song song (2 iterators khÃ¡c nhau)       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Object LÃ  Iterator Cá»§a ChÃ­nh NÃ³

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Merge: object vá»«a lÃ  iterable vá»«a lÃ  iterator
// Ngáº¯n hÆ¡n nhÆ°ng KHÃ”NG thá»ƒ 2 for..of song song
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let range = {
  from: 1,
  to: 5,

  [Symbol.iterator]() {
    this.current = this.from;
    return this; // â† tráº£ chÃ­nh nÃ³
  },

  next() {
    if (this.current <= this.to) {
      return { done: false, value: this.current++ };
    } else {
      return { done: true };
    }
  },
};

for (let num of range) alert(num); // 1, 2, 3, 4, 5

// âš ï¸ 2 for..of cÃ¹ng lÃºc sáº½ CHIA Sáºº state â†’ bug!
// VÃ¬ chá»‰ cÃ³ 1 iterator (object chÃ­nh nÃ³)
```

### String Iterable & Gá»i Iterator Thá»§ CÃ´ng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// String lÃ  iterable â€” xá»­ lÃ½ surrogate pairs Ä‘Ãºng!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

for (let char of "test") {
  alert(char); // t, e, s, t
}

// Surrogate pairs OK!
for (let char of "ğ’³ğŸ˜‚") {
  alert(char); // "ğ’³", "ğŸ˜‚" (Ä‘Ãºng!)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»i iterator thá»§ cÃ´ng â€” kiá»ƒm soÃ¡t nhiá»u hÆ¡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "Hello";
let iterator = str[Symbol.iterator]();

while (true) {
  let result = iterator.next();
  if (result.done) break;
  alert(result.value); // H, e, l, l, o
}
// â†’ CÃ³ thá»ƒ táº¡m dá»«ng, lÃ m viá»‡c khÃ¡c, rá»“i tiáº¿p tá»¥c
```

### Iterable vs Array-like

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Iterable: cÃ³ Symbol.iterator â†’ for..of works
// Array-like: cÃ³ indexes + length â†’ KHÃ”NG cÃ³ Symbol.iterator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let arrayLike = {
  0: "Hello",
  1: "World",
  length: 2,
};

// âŒ Error: arrayLike is not iterable
// for (let item of arrayLike) {}

// String = Cáº¢ HAI: iterable + array-like
// range (vÃ­ dá»¥ trÃªn) = iterable nhÆ°ng KHÃ”NG array-like (khÃ´ng cÃ³ indexes/length)
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ITERABLE vs ARRAY-LIKE                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚ Iterable     â”‚ Array-like                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CÃ³ gÃ¬           â”‚ Symbol.      â”‚ indexes (0,1..)               â”‚
â”‚                 â”‚ iterator     â”‚ + length                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ for..of         â”‚ âœ…           â”‚ âŒ (trá»« khi cÅ©ng iterable)   â”‚
â”‚ arr[0]          â”‚ âŒ (trá»« khi  â”‚ âœ…                            â”‚
â”‚                 â”‚ cÅ©ng AL)     â”‚                               â”‚
â”‚ push/pop/map    â”‚ âŒ           â”‚ âŒ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VÃ­ dá»¥           â”‚ range object â”‚ {0:"a", length:1}             â”‚
â”‚ Cáº£ hai          â”‚ String, Array, Map, Set                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†’ Array tháº­t   â”‚ Array.from() hoáº·c [...iterable]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Array.from â€” Chuyá»ƒn ThÃ nh Array Tháº­t

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Array.from(obj, mapFn?, thisArg?)
// Cháº¥p nháº­n cáº£ iterable VÃ€ array-like
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Array-like â†’ Array
let arrayLike = { 0: "Hello", 1: "World", length: 2 };
let arr = Array.from(arrayLike);
alert(arr.pop()); // "World" â† array methods OK!

// Iterable â†’ Array
let arr2 = Array.from(range); // range tá»« vÃ­ dá»¥ trÃªn
alert(arr2); // [1, 2, 3, 4, 5]

// Vá»›i mapFn
let arr3 = Array.from(range, (num) => num * num);
alert(arr3); // [1, 4, 9, 16, 25]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Surrogate-aware string â†’ array
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = "ğ’³ğŸ˜‚";
let chars = Array.from(str); // âœ… surrogate pairs Ä‘Ãºng!
alert(chars.length); // 2 (Ä‘Ãºng!)
alert(chars[0]); // "ğ’³"
alert(chars[1]); // "ğŸ˜‚"

// So sÃ¡nh: str.split("") â†’ KHÃ”NG xá»­ lÃ½ surrogate Ä‘Ãºng!

// Surrogate-aware slice
function slice(str, start, end) {
  return Array.from(str).slice(start, end).join("");
}
alert(slice("ğ’³ğŸ˜‚ğ©·¶", 1, 3)); // "ğŸ˜‚ğ©·¶" (Ä‘Ãºng!)
```

### Tá»•ng Há»£p: Iterables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ITERABLES â€” SUMMARY                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Iterable = object cÃ³ Symbol.iterator method                   â”‚
â”‚  Iterator = object cÃ³ next() â†’ { done, value }                 â”‚
â”‚                                                                 â”‚
â”‚  Built-in: String âœ… Array âœ… Map âœ… Set âœ…                     â”‚
â”‚  Plain Object: âŒ (pháº£i tá»± thÃªm Symbol.iterator)              â”‚
â”‚                                                                 â”‚
â”‚  for..of gá»i tá»± Ä‘á»™ng, nhÆ°ng cÃ³ thá»ƒ gá»i thá»§ cÃ´ng              â”‚
â”‚  String iterator xá»­ lÃ½ surrogate pairs Ä‘Ãºng                   â”‚
â”‚                                                                 â”‚
â”‚  Iterable â‰  Array-like (khÃ¡c nhau!)                           â”‚
â”‚  â†’ String/Array = cáº£ hai                                      â”‚
â”‚  â†’ Array.from() chuyá»ƒn BOTH thÃ nh Array tháº­t                  â”‚
â”‚  â†’ Array.from(obj, mapFn) há»— trá»£ mapping                     â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Object merged iterator â†’ khÃ´ng 2 for..of song song       â”‚
â”‚  âš ï¸ Array-like KHÃ”NG cÃ³ push/pop/map (cáº§n Array.from)        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 38. Map and Set â€” Bá»™ SÆ°u Táº­p NÃ¢ng Cao

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAP & SET â€” Báº£n Äá»“ Tá»•ng Quan                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MAP â€” Keyed Collection (keys Báº¤T Ká»² kiá»ƒu)                    â”‚
â”‚  new Map() | .set(key, val) | .get(key) | .has(key)            â”‚
â”‚  .delete(key) | .clear() | .size                              â”‚
â”‚  Keys: ANY type (objects, NaN, functions...)                   â”‚
â”‚  So sÃ¡nh: SameValueZero (â‰ˆ === nhÆ°ng NaN === NaN)             â”‚
â”‚  âš ï¸ map[key] SAI! DÃ¹ng map.set/get                            â”‚
â”‚                                                                 â”‚
â”‚  SET â€” Unique Values Collection                                 â”‚
â”‚  new Set([iterable]) | .add(val) | .has(val)                   â”‚
â”‚  .delete(val) | .clear() | .size                              â”‚
â”‚  Má»—i value chá»‰ xuáº¥t hiá»‡n 1 Láº¦N                                â”‚
â”‚  Tá»‘t hÆ¡n arr.find() cho uniqueness check (O(1) vs O(n))      â”‚
â”‚                                                                 â”‚
â”‚  CHUYá»‚N Äá»”I:                                                   â”‚
â”‚  Object â†’ Map: new Map(Object.entries(obj))                    â”‚
â”‚  Map â†’ Object: Object.fromEntries(map)                         â”‚
â”‚                                                                 â”‚
â”‚  ITERATION (cáº£ Map vÃ  Set): giá»¯ insertion order               â”‚
â”‚  .keys() | .values() | .entries() | .forEach()                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ map.keys() tráº£ iterable, KHÃ”NG pháº£i Array!               â”‚
â”‚     â†’ Array.from(map.keys()) náº¿u cáº§n array methods            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Map â€” Keys Báº¥t Ká»³ Kiá»ƒu

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Map: keys giá»¯ nguyÃªn TYPE (khÃ´ng convert sang string)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let map = new Map();

map.set("1", "str1"); // string key
map.set(1, "num1"); // numeric key
map.set(true, "bool1"); // boolean key

// Object sáº½ convert "1" vÃ  1 thÃ nh cÃ¹ng key
// Map giá»¯ TYPE â†’ 2 keys khÃ¡c nhau!
alert(map.get(1)); // "num1"
alert(map.get("1")); // "str1"
alert(map.size); // 3

// âš ï¸ Äá»ªNG dÃ¹ng map[key] â€” Ä‘Ã³ lÃ  treats map nhÆ° plain object!
// âœ… LuÃ´n dÃ¹ng: map.set(), map.get(), map.has()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object lÃ m key â€” feature quan trá»ng nháº¥t cá»§a Map!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let john = { name: "John" };
let ben = { name: "Ben" };

let visitsMap = new Map();
visitsMap.set(john, 123);
visitsMap.set(ben, 234);
alert(visitsMap.get(john)); // 123 â† má»—i object = key riÃªng

// So sÃ¡nh: Object KHÃ”NG thá»ƒ dÃ¹ng object lÃ m key
let visitsObj = {};
visitsObj[john] = 123; // convert â†’ "[object Object]"
visitsObj[ben] = 234; // GHI ÄÃˆ vÃ¬ cÃ¹ng key!
alert(visitsObj["[object Object]"]); // 234 â† SAI!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SameValueZero: NaN === NaN trong Map!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let map2 = new Map();
map2.set(NaN, "works!");
alert(map2.get(NaN)); // "works!" â† NaN lÃ  key há»£p lá»‡

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Chaining: set() tráº£ map â†’ chain Ä‘Æ°á»£c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

map.set("a", 1).set("b", 2).set("c", 3);
```

### Map Iteration & Conversion

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Iteration â€” GIá»® insertion order!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let recipeMap = new Map([
  ["cucumber", 500],
  ["tomatoes", 350],
  ["onion", 50],
]);

// .keys() â†’ iterable of keys
for (let vegetable of recipeMap.keys()) {
  alert(vegetable); // cucumber, tomatoes, onion
}

// .values() â†’ iterable of values
for (let amount of recipeMap.values()) {
  alert(amount); // 500, 350, 50
}

// .entries() â†’ iterable of [key, value] (default for..of)
for (let [key, value] of recipeMap) {
  alert(`${key}: ${value}`); // cucumber: 500, ...
}

// forEach
recipeMap.forEach((value, key) => {
  alert(`${key}: ${value}`);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object â†” Map conversion
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Object â†’ Map
let obj = { name: "John", age: 30 };
let map = new Map(Object.entries(obj));
alert(map.get("name")); // "John"

// Map â†’ Object
let map2 = new Map([
  ["banana", 1],
  ["orange", 2],
]);
let obj2 = Object.fromEntries(map2); // hoáº·c map2.entries()
alert(obj2.banana); // 1
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAP vs OBJECT                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚ Map              â”‚ Object                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Key types        â”‚ ANY (obj, NaN..) â”‚ String / Symbol only      â”‚
â”‚ Key comparison   â”‚ SameValueZero    â”‚ toString conversion       â”‚
â”‚ Iteration order  â”‚ Insertion âœ…     â”‚ Insertion* (complex)      â”‚
â”‚ Size             â”‚ .size O(1)       â”‚ Object.keys().length      â”‚
â”‚ Iteration        â”‚ Directly iterableâ”‚ Object.keys/values/entriesâ”‚
â”‚ Performance      â”‚ Tá»‘t cho add/del â”‚ Tá»‘t cho static data      â”‚
â”‚ JSON             â”‚ âŒ (cáº§n convert)â”‚ âœ… native                 â”‚
â”‚ Prototype        â”‚ KhÃ´ng pollution  â”‚ CÃ³ thá»ƒ inherit keys       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Chuyá»ƒn Ä‘á»•i       â”‚ Object.fromEntries(map)                     â”‚
â”‚                  â”‚ new Map(Object.entries(obj))                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Set â€” GiÃ¡ Trá»‹ Duy Nháº¥t

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set: má»—i value chá»‰ xuáº¥t hiá»‡n 1 Láº¦N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let set = new Set();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

set.add(john);
set.add(pete);
set.add(mary);
set.add(john); // â† duplicate â†’ ignored!
set.add(mary); // â† duplicate â†’ ignored!

alert(set.size); // 3 (chá»‰ 3 unique values)

for (let user of set) {
  alert(user.name); // John, Pete, Mary
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set vs Array cho uniqueness check
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Array: arr.find() â†’ O(n) cho má»—i check
// âœ… Set: set.has() â†’ O(1) optimized internally

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set iteration â€” giá»‘ng Map, giá»¯ insertion order
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fruitSet = new Set(["oranges", "apples", "bananas"]);

for (let value of fruitSet) alert(value);

// forEach â€” value láº·p 2 láº§n (for Map compatibility)
fruitSet.forEach((value, valueAgain, set) => {
  alert(value); // value === valueAgain
});

// .keys() = .values() (cho compatibility)
// .entries() â†’ [value, value] pairs
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: unique â€” Set loáº¡i trÃ¹ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function unique(arr) {
  return Array.from(new Set(arr));
}
alert(unique(["Hare", "Krishna", "Hare"])); // ["Hare", "Krishna"]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: aclean â€” lá»c anagrams báº±ng Map
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function aclean(arr) {
  let map = new Map();
  for (let word of arr) {
    let sorted = word.toLowerCase().split("").sort().join("");
    map.set(sorted, word); // cÃ¹ng sorted key â†’ ghi Ä‘Ã¨
  }
  return Array.from(map.values());
}
// ["nap","teachers","PAN","ear","era"] â†’ ["PAN","teachers","era"]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 3: map.keys() â†’ Array (iterable â‰  Array!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let map = new Map();
map.set("name", "John");

// âŒ map.keys().push("more") â†’ TypeError!
let keys = Array.from(map.keys()); // âœ… convert trÆ°á»›c
keys.push("more");
alert(keys); // ["name", "more"]
```

### Tá»•ng Há»£p: Map and Set

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAP & SET â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MAP: keyed collection, keys Báº¤T Ká»² type                      â”‚
â”‚  new Map() | .set(k,v) | .get(k) | .has(k)                    â”‚
â”‚  .delete(k) | .clear() | .size                                â”‚
â”‚  Object lÃ m key âœ… | SameValueZero (NaN=NaN)                  â”‚
â”‚  Chaining: map.set().set().set()                               â”‚
â”‚  Iteration: .keys() .values() .entries() â†’ insertion order    â”‚
â”‚  Objectâ†”Map: Object.entries() / Object.fromEntries()          â”‚
â”‚                                                                 â”‚
â”‚  SET: unique values collection                                 â”‚
â”‚  new Set([iterable]) | .add(v) | .has(v) O(1)                 â”‚
â”‚  .delete(v) | .clear() | .size                                â”‚
â”‚  Duplicate add â†’ ignored | forEach(v, v, set)                 â”‚
â”‚  .keys()=.values() | .entries()â†’[v,v] (Map compat)            â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ map[key] SAI â†’ dÃ¹ng map.set/get                           â”‚
â”‚  âš ï¸ map.keys() tráº£ iterable â†’ Array.from() náº¿u cáº§n Array    â”‚
â”‚  âš ï¸ Set vs Array: set.has() O(1) >> arr.find() O(n)          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 39. WeakMap and WeakSet â€” Bá»™ SÆ°u Táº­p Yáº¿u

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEAKMAP & WEAKSET â€” Báº£n Äá»“ Tá»•ng Quan                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Váº¤N Äá»€: Map/Set GIá»® references â†’ objects KHÃ”NG bá»‹ GC       â”‚
â”‚  â†’ Memory leak khi key/value khÃ´ng cÃ²n cáº§n thiáº¿t            â”‚
â”‚                                                                 â”‚
â”‚  WEAKMAP:                                                       â”‚
â”‚  Keys pháº£i lÃ  OBJECTS (khÃ´ng primitive)                        â”‚
â”‚  Key bá»‹ GC â†’ entry tá»± Ä‘á»™ng xÃ³a                              â”‚
â”‚  Chá»‰ cÃ³: .set .get .has .delete                               â”‚
â”‚  KHÃ”NG cÃ³: .size .keys .values .entries .clear .forEach       â”‚
â”‚  KHÃ”NG iterable!                                               â”‚
â”‚                                                                 â”‚
â”‚  WEAKSET:                                                       â”‚
â”‚  Chá»‰ cháº¥p nháº­n OBJECTS                                        â”‚
â”‚  Object bá»‹ GC â†’ tá»± Ä‘á»™ng xÃ³a khá»i set                       â”‚
â”‚  Chá»‰ cÃ³: .add .has .delete                                    â”‚
â”‚  KHÃ”NG cÃ³: .size .keys .values .entries .clear .forEach       â”‚
â”‚                                                                 â”‚
â”‚  USE CASES:                                                     â”‚
â”‚  WeakMap: additional data, caching, private data               â”‚
â”‚  WeakSet: boolean flags ("visited?", "unread?")                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ "Secondary" storage â€” data lives/dies vá»›i object         â”‚
â”‚  âš ï¸ KhÃ´ng biáº¿t Ä‘Æ°á»£c size, khÃ´ng iterate Ä‘Æ°á»£c                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡i Sao Cáº§n WeakMap?

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Váº¤N Äá»€: Map giá»¯ reference â†’ object khÃ´ng bá»‹ GC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let john = { name: "John" };

// Map giá»¯ strong reference
let map = new Map();
map.set(john, "...");

john = null; // xÃ³a reference
// âŒ john VáºªN náº±m trong map.keys()!
// â†’ MEMORY LEAK!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIáº¢I PHÃP: WeakMap giá»¯ weak reference
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let john2 = { name: "John" };

let weakMap = new WeakMap();
weakMap.set(john2, "...");

john2 = null; // xÃ³a reference
// âœ… john2 Ä‘Æ°á»£c GC! Entry trong WeakMap tá»± xÃ³a.
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAP vs WEAKMAP                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚ Map                 â”‚ WeakMap               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Key types        â”‚ Any                 â”‚ Objects ONLY          â”‚
â”‚ GC behavior      â”‚ Giá»¯ reference      â”‚ Weak reference        â”‚
â”‚ Key bá»‹ GC       â”‚ Váº«n á»Ÿ trong map    â”‚ Tá»± xÃ³a entry         â”‚
â”‚ .size            â”‚ âœ…                  â”‚ âŒ                    â”‚
â”‚ Iteration        â”‚ âœ… keys/values/...  â”‚ âŒ KHÃ”NG iterate     â”‚
â”‚ .clear()         â”‚ âœ…                  â”‚ âŒ                    â”‚
â”‚ forEach          â”‚ âœ…                  â”‚ âŒ                    â”‚
â”‚ Methods          â”‚ set/get/has/delete  â”‚ set/get/has/delete    â”‚
â”‚                  â”‚ + keys/values/...   â”‚ (chá»‰ 4 methods)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Use case         â”‚ General storage      â”‚ Additional/secondary  â”‚
â”‚                  â”‚                     â”‚ data, caching         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WeakMap â€” Methods & Constraints

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WeakMap: keys PHáº¢I lÃ  objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let weakMap = new WeakMap();

let obj = {};
weakMap.set(obj, "ok"); // âœ… object key
// weakMap.set("test", "Err");  // âŒ TypeError: primitive key!

// Chá»‰ cÃ³ 4 methods:
weakMap.get(obj); // "ok"
weakMap.has(obj); // true
weakMap.delete(obj); // true
// weakMap.set(obj, val);

// âŒ KHÃ”NG cÃ³ (vÃ¬ GC timing khÃ´ng xÃ¡c Ä‘á»‹nh):
// weakMap.size    â†’ undefined
// weakMap.keys()  â†’ âŒ
// weakMap.values()â†’ âŒ
// weakMap.entries()â†’ âŒ
// weakMap.clear() â†’ âŒ
// weakMap.forEach()â†’ âŒ
// for..of weakMap â†’ âŒ
```

### Use Case 1: Additional Data

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gáº¯n thÃªm data vÃ o object khÃ´ng sá»Ÿ há»¯u
// Data tá»± Ä‘á»™ng biáº¿n máº¥t khi object bá»‹ GC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ Dá»¤: Ä‘áº¿m visits cho users (3rd-party objects)

// âŒ Vá»›i Map: memory leak!
let visitsMap = new Map();
function countUser(user) {
  let count = visitsMap.get(user) || 0;
  visitsMap.set(user, count + 1);
}
let john = { name: "John" };
countUser(john);
john = null; // âŒ john váº«n trong visitsMap!

// âœ… Vá»›i WeakMap: tá»± dá»n!
let visitsWeak = new WeakMap();
function countUserWeak(user) {
  let count = visitsWeak.get(user) || 0;
  visitsWeak.set(user, count + 1);
}
let pete = { name: "Pete" };
countUserWeak(pete);
pete = null; // âœ… pete vÃ  visit count Ä‘á»u bá»‹ GC!
```

### Use Case 2: Caching

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cache káº¿t quáº£ theo object â€” tá»± dá»n khi object háº¿t dÃ¹ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Vá»›i Map: cache.size váº«n tÄƒng!
let cacheMap = new Map();
function processMap(obj) {
  if (!cacheMap.has(obj)) {
    let result = /* heavy computation */ obj;
    cacheMap.set(obj, result);
  }
  return cacheMap.get(obj);
}
let data = {
  /* ... */
};
processMap(data);
data = null;
alert(cacheMap.size); // 1 â† memory leak!

// âœ… Vá»›i WeakMap: cache tá»± dá»n!
let cacheWeak = new WeakMap();
function processWeak(obj) {
  if (!cacheWeak.has(obj)) {
    let result = /* heavy computation */ obj;
    cacheWeak.set(obj, result);
  }
  return cacheWeak.get(obj);
}
let data2 = {
  /* ... */
};
processWeak(data2);
data2 = null;
// âœ… cache entry tá»± xÃ³a khi data2 bá»‹ GC!
```

### WeakSet â€” Boolean Flags

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WeakSet: lÆ°u "yes/no" facts vá» objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let visitedSet = new WeakSet();

let john = { name: "John" };
let pete = { name: "Pete" };
let mary = { name: "Mary" };

visitedSet.add(john);
visitedSet.add(pete);
visitedSet.add(john); // duplicate â†’ ignored

alert(visitedSet.has(john)); // true
alert(visitedSet.has(mary)); // false

john = null;
// âœ… john tá»± Ä‘á»™ng bá»‹ xÃ³a khá»i visitedSet

// Chá»‰ cÃ³ 3 methods:
// .add(obj)    â†’ thÃªm
// .has(obj)    â†’ check
// .delete(obj) â†’ xÃ³a
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: Store "unread" flags
// Messages managed bá»Ÿi code khÃ¡c â†’ khÃ´ng modify objects!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let messages = [
  { text: "Hello", from: "John" },
  { text: "How goes?", from: "John" },
  { text: "See you soon", from: "Alice" },
];

// WeakSet = "has been read?" (yes/no)
let readMessages = new WeakSet();
readMessages.add(messages[0]); // Ä‘á»c xong
readMessages.add(messages[1]);

alert(readMessages.has(messages[0])); // true

// XÃ³a message khá»i array â†’ tá»± xÃ³a khá»i WeakSet!
messages.shift();
// messages[0] khÃ´ng cÃ²n reference â†’ GC!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: Store read DATES
// Cáº§n lÆ°u data (date) â†’ dÃ¹ng WeakMap
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let readMap = new WeakMap();
readMap.set(messages[0], new Date(2026, 1, 10));
readMap.set(messages[1], new Date(2026, 1, 10));

alert(readMap.get(messages[0])); // Date object
// XÃ³a message â†’ date cÅ©ng bá»‹ GC!

// KEY: WeakSet = yes/no, WeakMap = data gáº¯n vá»›i object
```

### Tá»•ng Há»£p: WeakMap & WeakSet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEAKMAP & WEAKSET â€” SUMMARY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  WeakMap: Map-like, keys = OBJECTS only                        â”‚
â”‚  Key bá»‹ GC â†’ entry tá»± xÃ³a | Weak reference                   â”‚
â”‚  Methods: set/get/has/delete (chá»‰ 4)                          â”‚
â”‚  KHÃ”NG: size, keys, values, entries, clear, forEach           â”‚
â”‚                                                                 â”‚
â”‚  WeakSet: Set-like, values = OBJECTS only                      â”‚
â”‚  Object bá»‹ GC â†’ tá»± xÃ³a | Weak reference                      â”‚
â”‚  Methods: add/has/delete (chá»‰ 3)                              â”‚
â”‚  KHÃ”NG: size, keys, values, entries, clear, forEach           â”‚
â”‚                                                                 â”‚
â”‚  Use cases:                                                    â”‚
â”‚  â€¢ WeakMap: additional data, caching, private fields           â”‚
â”‚  â€¢ WeakSet: boolean flags ("read?", "visited?")                â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ "Secondary" storage â€” data sá»‘ng/cháº¿t theo object          â”‚
â”‚  âš ï¸ KhÃ´ng biáº¿t size, khÃ´ng iterate Ä‘Æ°á»£c (vÃ¬ GC timing)       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 40. Destructuring Assignment â€” PhÃ©p GÃ¡n PhÃ¢n RÃ£

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DESTRUCTURING â€” Báº£n Äá»“ Tá»•ng Quan                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ARRAY: let [a, b, ...rest] = array                            â”‚
â”‚  â€¢ Bá» qua: [a, , c] | Default: [a = 1]                       â”‚
â”‚  â€¢ Swap: [a, b] = [b, a] | Rest: ...rest â†’ array              â”‚
â”‚  â€¢ Hoáº¡t Ä‘á»™ng vá»›i má»i iterable (string, Set, Map...)           â”‚
â”‚                                                                 â”‚
â”‚  OBJECT: let {prop: var = default, ...rest} = obj               â”‚
â”‚  â€¢ TÃªn khÃ¡c: {width: w} | Default: {width = 100}              â”‚
â”‚  â€¢ Káº¿t há»£p: {width: w = 100} | Rest: ...rest â†’ object        â”‚
â”‚  â€¢ Thá»© tá»± KHÃ”NG quan trá»ng                                   â”‚
â”‚                                                                 â”‚
â”‚  NESTED: let { size: { width, height } } = options              â”‚
â”‚  SMART PARAMS: function({title = "", width = 100} = {})        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Array khÃ´ng bá»‹ modify (chá»‰ copy values)                   â”‚
â”‚  âš ï¸ Object khÃ´ng cÃ³ let: pháº£i bá»c ({...} = obj)               â”‚
â”‚  âš ï¸ Smart params: = {} Ä‘á»ƒ gá»i khÃ´ng args khÃ´ng lá»—i           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Array Destructuring

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÆ¡ báº£n: unpack array thÃ nh variables
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let [firstName, surname] = ["John", "Smith"];
alert(firstName); // "John"
alert(surname); // "Smith"

// Káº¿t há»£p vá»›i split
let [first, last] = "John Smith".split(" ");

// âš ï¸ "Destructuring" KHÃ”NG modify array gá»‘c!
// Chá»‰ lÃ  shorthand cho: let firstName = arr[0]; ...

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Bá» qua pháº§n tá»­ báº±ng comma
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let [name, , title] = ["Julius", "Caesar", "Consul"];
alert(title); // "Consul" (bá» qua "Caesar")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Hoáº¡t Ä‘á»™ng vá»›i Má»ŒI iterable (khÃ´ng chá»‰ array)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let [a, b, c] = "abc"; // string
let [one, two] = new Set([1, 2]); // Set

// Assign vÃ o object properties
let user = {};
[user.name, user.surname] = "John Smith".split(" ");

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Swap variables â€” trick hay!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let guest = "Jane",
  admin = "Pete";
[guest, admin] = [admin, guest];
alert(guest); // "Pete" (swapped!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Rest ...rest â€” láº¥y pháº§n cÃ²n láº¡i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let [name1, name2, ...rest] = ["Julius", "Caesar", "Consul", "Republic"];
alert(rest); // ["Consul", "Republic"]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Default values
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let [x = "Guest", y = "Anonymous"] = ["Julius"];
alert(x); // "Julius" (tá»« array)
alert(y); // "Anonymous" (default)

// Default cÃ³ thá»ƒ lÃ  expression/function call
// Chá»‰ Ä‘Æ°á»£c evaluate khi value khÃ´ng cÃ³!
```

### Object Destructuring

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÆ¡ báº£n: {prop} = obj | thá»© tá»± KHÃ”NG quan trá»ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let options = { title: "Menu", width: 100, height: 200 };

let { title, width, height } = options;
alert(title); // "Menu"
alert(width); // 100
alert(height); // 200

// Thá»© tá»± khÃ¡c â€” váº«n OK!
let { height: h, width: w, title: t } = options;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Äá»•i tÃªn báº±ng colon: { source: target }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let { width: myWidth, height: myHeight } = options;
alert(myWidth); // 100 (width â†’ myWidth)
alert(myHeight); // 200 (height â†’ myHeight)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Default + Rename + Rest
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Default
let { width: wd = 100, color = "red" } = { width: 50 };
alert(wd); // 50 (cÃ³ trong obj)
alert(color); // "red" (default)

// Káº¿t há»£p rename + default
let { width: w2 = 100, height: h2 = 200 } = { title: "Menu" };
alert(w2); // 100 (default)

// Rest pattern
let { title: t2, ...rest } = { title: "Menu", height: 200, width: 100 };
alert(rest.height); // 200
alert(rest.width); // 100

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ GOTCHA: khÃ´ng cÃ³ let â†’ pháº£i bá»c ()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let title3, width3;
// {title3, width3} = {title3: "X", width3: 1}; // âŒ Error!
({ title3, width3 } = { title3: "X", width3: 1 }); // âœ… OK!
// VÃ¬ JS hiá»ƒu {...} lÃ  code block náº¿u á»Ÿ Ä‘áº§u statement
```

### Nested & Loop Destructuring

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Nested destructuring
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let options = {
  size: { width: 100, height: 200 },
  items: ["Cake", "Donut"],
  extra: true,
};

let {
  size: { width, height }, // nested object
  items: [item1, item2], // nested array
  title = "Menu", // default
} = options;

alert(width); // 100
alert(height); // 200
alert(item1); // "Cake"
alert(title); // "Menu" (default)
// âš ï¸ size vÃ  items KHÃ”NG lÃ  variables (chá»‰ lÃ  pattern)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Loop vá»›i destructuring + Object.entries
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John", age: 30 };
for (let [key, value] of Object.entries(user)) {
  alert(`${key}: ${value}`); // name: John, age: 30
}

// Map: tá»± nhiÃªn iterate [key, value]
for (let [key, value] of someMap) {
  alert(`${key}: ${value}`);
}
```

### Smart Function Parameters

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Váº¤N Äá»€: function nhiá»u params cÃ³ defaults
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ BÃ€I: pháº£i nhá»› thá»© tá»±, truyá»n undefined cho defaults
function showMenu(title, width, height, items) {
  /**/
}
showMenu("My", undefined, undefined, ["Item1"]); // ugly!

// âœ… GIáº¢I PHÃP: destructuring params
function showMenu({
  title = "Untitled",
  width = 200,
  height = 100,
  items = [],
}) {
  alert(`${title} ${width} ${height}`);
  alert(items);
}

showMenu({ title: "My menu", items: ["Item1"] });
// â†’ title="My menu", width=200, height=100, items=["Item1"]

// Vá»›i rename + nested
function showMenu2({
  title = "Untitled",
  width: w = 100,
  height: h = 200,
  items: [item1, item2] = [],
}) {
  alert(`${title} ${w} ${h}`);
}

// âš ï¸ KhÃ´ng truyá»n gÃ¬ â†’ Error! (destructure undefined)
showMenu(); // âŒ TypeError!

// âœ… Fix: = {} default cho toÃ n bá»™ object
function showMenu3({ title = "Menu", width = 100 } = {}) {
  alert(`${title} ${width}`);
}
showMenu3(); // "Menu 100" â†’ OK!
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: Destructuring user object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John", years: 30 };

let { name, years: age, isAdmin = false } = user;
alert(name); // "John"
alert(age); // 30 (years â†’ age)
alert(isAdmin); // false (default)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: topSalary vá»›i Object.entries + destructuring
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function topSalary(salaries) {
  let maxName = null;
  let maxSalary = 0;

  for (let [name, salary] of Object.entries(salaries)) {
    if (salary > maxSalary) {
      maxSalary = salary;
      maxName = name;
    }
  }
  return maxName;
}

alert(topSalary({ John: 100, Pete: 300, Mary: 250 })); // "Pete"
alert(topSalary({})); // null
```

### Tá»•ng Há»£p: Destructuring

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DESTRUCTURING â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ARRAY: let [a, b, ...rest] = array                            â”‚
â”‚  â€¢ Skip: [a, , c] | Default: [a = 1]                          â”‚
â”‚  â€¢ Swap: [a,b]=[b,a] | Works vá»›i má»i iterable                 â”‚
â”‚  â€¢ ...rest â†’ array pháº§n cÃ²n láº¡i                              â”‚
â”‚                                                                 â”‚
â”‚  OBJECT: let {prop: var = default, ...rest} = obj               â”‚
â”‚  â€¢ Rename: {width: w} | Default: {w = 100}                    â”‚
â”‚  â€¢ Both: {width: w = 100} | ...rest â†’ object                  â”‚
â”‚  â€¢ Thá»© tá»± khÃ´ng quan trá»ng | Chá»‰ extract cáº§n dÃ¹ng           â”‚
â”‚                                                                 â”‚
â”‚  NESTED: let { size: { width } } = options                     â”‚
â”‚  SMART PARAMS: function({a = 1, b = 2} = {})                   â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Array khÃ´ng bá»‹ modify (chá»‰ copy)                          â”‚
â”‚  âš ï¸ Object: {x}={} khÃ´ng cÃ³ let â†’ bá»c ({x}={})                â”‚
â”‚  âš ï¸ Smart params pháº£i cÃ³ = {} Ä‘á»ƒ gá»i khÃ´ng args              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 41. Date and Time â€” NgÃ y Giá»

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE & TIME â€” Báº£n Äá»“ Tá»•ng Quan                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Táº O: new Date() | new Date(ms) | new Date(string)             â”‚
â”‚       new Date(year, month, day, h, m, s, ms)                  â”‚
â”‚  âš ï¸ month = 0..11 (Jan=0!) | day default=1                    â”‚
â”‚                                                                 â”‚
â”‚  GET: getFullYear/Month/Date/Day/Hours/Minutes/Seconds/Ms      â”‚
â”‚       getTime() â†’ timestamp | getTimezoneOffset() â†’ minutes   â”‚
â”‚       UTC: getUTCFullYear, getUTCMonth...                      â”‚
â”‚  âš ï¸ getDay(): 0=Sunday..6=Saturday                             â”‚
â”‚  âš ï¸ getYear() DEPRECATED â†’ dÃ¹ng getFullYear()                 â”‚
â”‚                                                                 â”‚
â”‚  SET: setFullYear/Month/Date/Hours/Minutes/Seconds/Ms          â”‚
â”‚       setTime(ms) | UTC variants: setUTCHours...               â”‚
â”‚                                                                 â”‚
â”‚  AUTOCORRECT: out-of-range tá»± Ä‘iá»u chá»‰nh                      â”‚
â”‚    new Date(2013, 0, 32) â†’ Feb 1! | setDate(0) â†’ last day    â”‚
â”‚                                                                 â”‚
â”‚  ARITHMETIC: +date = timestamp | date2 - date1 = ms            â”‚
â”‚  Date.now() â†’ timestamp nhanh (khÃ´ng táº¡o object)             â”‚
â”‚  Date.parse("YYYY-MM-DDTHH:mm:ss.sssZ") â†’ timestamp           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Timestamps = milliseconds (khÃ´ng pháº£i seconds!)           â”‚
â”‚  âš ï¸ performance.now() cho microsecond precision               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡o Date Object

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4 cÃ¡ch táº¡o Date
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1) Hiá»‡n táº¡i
let now = new Date();

// 2) Tá»« timestamp (ms tá»« 01.01.1970 UTC)
let jan01 = new Date(0); // 01.01.1970
let jan02 = new Date(24 * 3600 * 1000); // 02.01.1970
let dec31 = new Date(-24 * 3600 * 1000); // 31.12.1969 (Ã¢m!)

// 3) Tá»« string (Date.parse internal)
let date1 = new Date("2017-01-26");
// âš ï¸ Timezone: khÃ´ng cÃ³ T â†’ UTC, cÃ³ T â†’ local!

// 4) Tá»« components (local timezone)
// âš ï¸ month = 0..11! (Jan=0, Dec=11)
new Date(2011, 0, 1); // 1 Jan 2011, 00:00:00
new Date(2011, 0, 1, 2, 3, 4, 567); // 02:03:04.567
// Chá»‰ year vÃ  month báº¯t buá»™c, day default=1
```

### Getters & Setters

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GETTERS â€” láº¥y components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let date = new Date();

date.getFullYear(); // 2026 (4 digits, KHÃ”NG dÃ¹ng getYear!)
date.getMonth(); // 0..11 (âš ï¸ Jan=0!)
date.getDate(); // 1..31 (ngÃ y trong thÃ¡ng)
date.getDay(); // 0..6 (âš ï¸ 0=Sunday, 6=Saturday)
date.getHours(); // 0..23
date.getMinutes(); // 0..59
date.getSeconds(); // 0..59
date.getMilliseconds(); // 0..999

date.getTime(); // timestamp (ms tá»« 1970)
date.getTimezoneOffset(); // UTC offset (phÃºt)
// VN = UTC+7 â†’ -420

// UTC variants: getUTCFullYear(), getUTCMonth()...
alert(date.getHours()); // giá» local
alert(date.getUTCHours()); // giá» UTC+0

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTERS â€” sá»­a components
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let today = new Date();
today.setHours(0, 0, 0, 0); // reset vá» Ä‘áº§u ngÃ y

// setFullYear(year, [month], [date])
// setMonth(month, [date])
// setDate(date)
// setHours(hour, [min], [sec], [ms])
// setMinutes(min, [sec], [ms])
// setSeconds(sec, [ms])
// setMilliseconds(ms)
// setTime(ms) â€” set toÃ n bá»™ báº±ng timestamp
// UTC variants: setUTCHours()...
```

### Autocorrection & Arithmetic

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Autocorrection: out-of-range tá»± Ä‘iá»u chá»‰nh!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Date(2013, 0, 32); // 32 Jan â†’ 1 Feb 2013!

// ThÃªm 2 ngÃ y vÃ o 28 Feb (leap year!)
let date = new Date(2016, 1, 28);
date.setDate(date.getDate() + 2);
alert(date); // 1 Mar 2016 âœ… (tá»± xá»­ lÃ½ leap year)

// ThÃªm 70 giÃ¢y
let d = new Date();
d.setSeconds(d.getSeconds() + 70); // tá»± cá»™ng phÃºt

// setDate(0) = ngÃ y cuá»‘i thÃ¡ng trÆ°á»›c!
let d2 = new Date(2016, 0, 2);
d2.setDate(0); // â†’ 31 Dec 2015

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Date to number & Date diff
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(+new Date()); // timestamp = date.getTime()

// Trá»« dates = chÃªnh lá»‡ch ms
let start = new Date();
/* ... do work ... */
let end = new Date();
alert(`Took ${end - start} ms`);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Date.now() â€” nhanh hÆ¡n new Date().getTime()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let t1 = Date.now(); // khÃ´ng táº¡o Date object!
/* ... do work ... */
let t2 = Date.now();
alert(`Took ${t2 - t1} ms`);
// âœ… Nhanh hÆ¡n, khÃ´ng GC pressure
```

### Date.parse & Benchmarking

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Date.parse("YYYY-MM-DDTHH:mm:ss.sssZ")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let ms = Date.parse("2012-01-26T13:51:50.417-07:00");
alert(ms); // 1327611110417 (timestamp)

// Táº¡o Date tá»« parse
let date = new Date(Date.parse("2012-01-26T13:51:50.417-07:00"));

// Shorter variants OK:
// "YYYY-MM-DD" | "YYYY-MM" | "YYYY"
// Invalid format â†’ NaN

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Benchmarking tips
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// getTime() NHANH hÆ¡n date2 - date1 (khÃ´ng type conversion)
function diffGetTime(d1, d2) {
  return d2.getTime() - d1.getTime();
}
function diffSubtract(d1, d2) {
  return d2 - d1;
}

// Benchmark Ä‘Ãºng: cháº¡y nhiá»u láº§n, xen káº½, warm-up
function bench(f) {
  let d1 = new Date(0),
    d2 = new Date();
  let start = Date.now();
  for (let i = 0; i < 100000; i++) f(d1, d2);
  return Date.now() - start;
}

// Warm-up trÆ°á»›c
bench(diffSubtract);
bench(diffGetTime);
// Rá»“i cháº¡y xen káº½ 10 láº§n
let t1 = 0,
  t2 = 0;
for (let i = 0; i < 10; i++) {
  t1 += bench(diffSubtract);
  t2 += bench(diffGetTime);
}
// âš ï¸ performance.now() cho microsecond precision
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: getWeekDay â€” short format
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getWeekDay(date) {
  return ["SU", "MO", "TU", "WE", "TH", "FR", "SA"][date.getDay()];
}
alert(getWeekDay(new Date(2014, 0, 3))); // "FR"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: European weekday (Mon=1..Sun=7)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getLocalDay(date) {
  let day = date.getDay();
  return day === 0 ? 7 : day; // Sunday 0 â†’ 7
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 3: getDateAgo â€” khÃ´ng modify date gá»‘c!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getDateAgo(date, days) {
  let copy = new Date(date); // clone!
  copy.setDate(date.getDate() - days);
  return copy.getDate();
}
alert(getDateAgo(new Date(2015, 0, 2), 1)); // 1 (1 Jan)
alert(getDateAgo(new Date(2015, 0, 2), 365)); // 2 (2 Jan 2014)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 4: getLastDayOfMonth â€” setDate(0) trick!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getLastDayOfMonth(year, month) {
  return new Date(year, month + 1, 0).getDate();
  // Day 0 of next month = last day of this month!
}
alert(getLastDayOfMonth(2012, 1)); // 29 (leap year Feb)
alert(getLastDayOfMonth(2013, 1)); // 28

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 5: getSecondsToday / getSecondsToTomorrow
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getSecondsToday() {
  let now = new Date();
  let today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  return Math.round((now - today) / 1000);
}

function getSecondsToTomorrow() {
  let now = new Date();
  let tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
  return Math.round((tomorrow - now) / 1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 6: formatDate â€” relative time
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function formatDate(date) {
  let diff = new Date() - date;
  if (diff < 1000) return "right now";

  let sec = Math.floor(diff / 1000);
  if (sec < 60) return sec + " sec. ago";

  let min = Math.floor(diff / 60000);
  if (min < 60) return min + " min. ago";

  let d = date;
  return [
    "0" + d.getDate(),
    "0" + (d.getMonth() + 1),
    "" + d.getFullYear(),
    "0" + d.getHours(),
    "0" + d.getMinutes(),
  ]
    .map((s) => s.slice(-2))
    .join(".")
    .replace(/\./, ".")
    .replace(/\.(\d{2})$/, " $1");
  // Simplified: DD.MM.YY HH:mm
}
```

### Tá»•ng Há»£p: Date and Time

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATE & TIME â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Táº¡o: new Date() | new Date(ms) | new Date("str")              â”‚
â”‚       new Date(year, month, ...) | âš ï¸ month=0..11!            â”‚
â”‚                                                                 â”‚
â”‚  Get: getFullYear/Month/Date/Day/Hours/Min/Sec/Ms              â”‚
â”‚       getTime()â†’timestamp | getTimezoneOffset()â†’min          â”‚
â”‚       UTC variants: getUTCHours()...                           â”‚
â”‚  âš ï¸ getDay()=0(Sun) | getYear() DEPRECATED                    â”‚
â”‚                                                                 â”‚
â”‚  Set: setFullYear/Month/Date/Hours/Min/Sec/Ms/Time             â”‚
â”‚  Autocorrect: out-of-range tá»± Ä‘iá»u chá»‰nh                      â”‚
â”‚    setDate(0)=last day prev month | +2 days xá»­ lÃ½ leap year   â”‚
â”‚                                                                 â”‚
â”‚  +date=timestamp | date2-date1=ms | Date.now() nhanh          â”‚
â”‚  Date.parse("YYYY-MM-DDTHH:mm:ss.sssZ")â†’timestamp             â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ JS timestamps = milliseconds (khÃ´ng pháº£i seconds)         â”‚
â”‚  âš ï¸ performance.now() cho microsecond precision               â”‚
â”‚  âš ï¸ Clone date trÆ°á»›c khi modify: new Date(date)               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 42. JSON Methods, toJSON â€” Serialize & Parse

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JSON METHODS â€” Báº£n Äá»“ Tá»•ng Quan                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JSON.stringify(value, replacer?, space?)                       â”‚
â”‚  â€¢ Há»— trá»£: objects, arrays, strings, numbers, booleans, null   â”‚
â”‚  â€¢ Bá» qua: functions, Symbol, undefined                        â”‚
â”‚  â€¢ âš ï¸ Circular reference â†’ Error!                              â”‚
â”‚  â€¢ Strings luÃ´n double-quoted, keys cÅ©ng double-quoted          â”‚
â”‚                                                                 â”‚
â”‚  replacer: array â†’ whitelist props | fn(key,value) â†’ filter   â”‚
â”‚  space: number (indent) hoáº·c string (prefix)                   â”‚
â”‚  toJSON(): object tá»± define serialize logic                    â”‚
â”‚                                                                 â”‚
â”‚  JSON.parse(str, reviver?)                                      â”‚
â”‚  â€¢ reviver: fn(key,value) â†’ transform (e.g. stringâ†’Date)      â”‚
â”‚  â€¢ âš ï¸ JSON khÃ´ng há»— trá»£ comments, trailing commas              â”‚
â”‚  â€¢ âš ï¸ Keys/strings PHáº¢I double-quoted                          â”‚
â”‚                                                                 â”‚
â”‚  Deep clone: JSON.parse(JSON.stringify(obj))                    â”‚
â”‚  âš ï¸ Máº¥t functions, Symbol, undefined, Dateâ†’string             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### JSON.stringify

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÆ¡ báº£n: object/array â†’ JSON string
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let student = {
  name: "John",
  age: 30,
  isAdmin: false,
  courses: ["html", "css", "js"],
  spouse: null,
};

let json = JSON.stringify(student);
typeof json; // "string"
// '{"name":"John","age":30,"isAdmin":false,"courses":["html","css","js"],"spouse":null}'

// Primitives cÅ©ng OK
JSON.stringify(1); // "1"
JSON.stringify("test"); // '"test"' (double-quoted!)
JSON.stringify(true); // "true"
JSON.stringify([1, 2, 3]); // "[1,2,3]"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ Bá»‹ Bá» QUA: functions, Symbol, undefined
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = {
  sayHi() {}, // âŒ method
  [Symbol("id")]: 123, // âŒ Symbol
  something: undefined, // âŒ undefined
};
alert(JSON.stringify(user)); // "{}" (rá»—ng!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Nested objects: OK! | Circular reference: ERROR!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Nested âœ…
JSON.stringify({ title: "Conf", room: { number: 23 } });
// '{"title":"Conf","room":{"number":23}}'

// Circular âŒ
let room = { number: 23 };
let meetup = { place: room };
room.occupiedBy = meetup;
JSON.stringify(meetup); // Error: circular structure!
```

### Replacer & Space

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JSON.stringify(value, replacer, space)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// REPLACER dáº¡ng ARRAY: whitelist properties
JSON.stringify(meetup, ["title", "participants", "name"]);
// Chá»‰ giá»¯ cÃ¡c props trong list (Ã¡p dá»¥ng toÃ n bá»™ cÃ¢y)

// REPLACER dáº¡ng FUNCTION: filter/transform
JSON.stringify(meetup, function replacer(key, value) {
  // key=="" á»Ÿ láº§n gá»i Ä‘áº§u (wrapper {"":meetup})
  return key === "occupiedBy" ? undefined : value;
  // return undefined â†’ bá» qua property
});
// âš ï¸ Replacer Ä‘Æ°á»£c gá»i RECURSIVE cho má»i nested!

// SPACE: pretty-print
JSON.stringify(user, null, 2);
// {
//   "name": "John",
//   "age": 25
// }
// space cÃ³ thá»ƒ lÃ  string: JSON.stringify(obj, null, "--")
```

### toJSON & JSON.parse

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// toJSON â€” custom serialize logic
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let room = {
  number: 23,
  toJSON() {
    return this.number;
  }, // custom!
};

JSON.stringify(room); // "23" (khÃ´ng pháº£i {"number":23})
JSON.stringify({ title: "Conf", room }); // '{"title":"Conf","room":23}'

// Date cÃ³ built-in toJSON â†’ ISO string
JSON.stringify(new Date()); // '"2026-02-10T..."'

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JSON.parse(str, reviver?)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let numbers = JSON.parse("[0, 1, 2, 3]");
alert(numbers[1]); // 1

let user = JSON.parse('{"name":"John","age":35}');
alert(user.name); // "John"

// âš ï¸ Lá»—i thÆ°á»ng gáº·p trong JSON viáº¿t tay:
// { name: "John" }        âŒ key khÃ´ng quotes
// { "name": 'John' }      âŒ single quotes
// { "date": new Date() }  âŒ khÃ´ng cho new
// KhÃ´ng há»— trá»£ comments, trailing commas

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Reviver â€” transform khi parse (e.g. string â†’ Date)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let str = '{"title":"Conf","date":"2017-11-30T12:00:00.000Z"}';

let meetup = JSON.parse(str, function (key, value) {
  if (key === "date") return new Date(value);
  return value;
});
alert(meetup.date.getDate()); // 30 âœ…
// Reviver Ä‘Æ°á»£c gá»i recursive cho má»i nested!
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: Deep clone báº±ng JSON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let user = { name: "John Smith", age: 35 };
let clone = JSON.parse(JSON.stringify(user));
// âš ï¸ Máº¥t functions/Symbol/undefined/Date!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: Exclude backreferences (circular)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let room = { number: 23 };
let meetup = {
  title: "Conference",
  occupiedBy: [{ name: "John" }, { name: "Alice" }],
  place: room,
};
room.occupiedBy = meetup; // circular!
meetup.self = meetup; // circular!

alert(
  JSON.stringify(meetup, function replacer(key, value) {
    // key=="" lÃ  láº§n gá»i Ä‘áº§u (wrapper object) â†’ giá»¯
    // Nhá»¯ng láº§n khÃ¡c náº¿u value === meetup â†’ bá»
    return key !== "" && value === meetup ? undefined : value;
  }),
);
// '{"title":"Conference","occupiedBy":[{"name":"John"},{"name":"Alice"}],"place":{"number":23}}'
```

### Tá»•ng Há»£p: JSON Methods

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JSON METHODS â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  JSON.stringify(value, replacer?, space?)                       â”‚
â”‚  â€¢ Há»— trá»£: obj, arr, string, number, boolean, null            â”‚
â”‚  â€¢ Bá» qua: function, Symbol, undefined                        â”‚
â”‚  â€¢ Circular â†’ Error! | Nested â†’ auto-convert               â”‚
â”‚                                                                 â”‚
â”‚  replacer: [...props] hoáº·c fn(key,val)                         â”‚
â”‚  space: number hoáº·c string (pretty-print)                      â”‚
â”‚  toJSON(): object tá»± define output                             â”‚
â”‚                                                                 â”‚
â”‚  JSON.parse(str, reviver?) â€” reviver transform values          â”‚
â”‚  Deep clone: JSON.parse(JSON.stringify(obj))                    â”‚
â”‚  âš ï¸ Máº¥t fn/Symbol/undefined/Date | Keys pháº£i double-quoted    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 43. Introduction: Callbacks â€” Láº­p TrÃ¬nh Báº¥t Äá»“ng Bá»™

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALLBACKS â€” Báº£n Äá»“ Tá»•ng Quan                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Async: action báº¯t Ä‘áº§u NGAY, hoÃ n thÃ nh SAU                    â”‚
â”‚  Callback: fn truyá»n vÃ o, Ä‘Æ°á»£c gá»i khi async xong             â”‚
â”‚                                                                 â”‚
â”‚  Error-first callback:                                         â”‚
â”‚    callback(err, result)                                       â”‚
â”‚    â€¢ arg1 = error (null náº¿u OK)                                â”‚
â”‚    â€¢ arg2+ = káº¿t quáº£ thÃ nh cÃ´ng                               â”‚
â”‚                                                                 â”‚
â”‚  Callback-in-callback: lá»“ng nhau cho sequential                 â”‚
â”‚  âš ï¸ Pyramid of Doom / Callback Hell                            â”‚
â”‚     loadScript('1.js', fn() {                                  â”‚
â”‚       loadScript('2.js', fn() {                                â”‚
â”‚         loadScript('3.js', fn() { ... })                       â”‚
â”‚       })                                                       â”‚
â”‚     })                                                          â”‚
â”‚                                                                 â”‚
â”‚  Giáº£i phÃ¡p: Promises â†’ async/await                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Callback-Based Async

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Váº¤N Äá»€: async khÃ´ng biáº¿t khi nÃ o xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// KhÃ´ng cÃ³ callback:
function loadScript(src) {
  let script = document.createElement("script");
  script.src = src;
  document.head.append(script);
}

loadScript("/my/script.js");
newFunction(); // âŒ Error! Script chÆ°a load xong!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIáº¢I PHÃP: callback = fn cháº¡y khi xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loadScript(src, callback) {
  let script = document.createElement("script");
  script.src = src;
  script.onload = () => callback(script); // gá»i khi load xong
  document.head.append(script);
}

loadScript("/my/script.js", function () {
  newFunction(); // âœ… OK! Script Ä‘Ã£ load xong
});
```

### Error-First Callback & Sequential Loading

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Error-first callback convention
// callback(err, result) â€” arg1 = error, arg2 = result
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loadScript(src, callback) {
  let script = document.createElement("script");
  script.src = src;
  script.onload = () => callback(null, script); // thÃ nh cÃ´ng
  script.onerror = () => callback(new Error(`Load error: ${src}`)); // lá»—i
  document.head.append(script);
}

loadScript("/my/script.js", function (error, script) {
  if (error) {
    // xá»­ lÃ½ lá»—i
  } else {
    // script loaded thÃ nh cÃ´ng
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sequential: callback-in-callback
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

loadScript("1.js", function (error, script) {
  if (error) {
    handleError(error);
    return;
  }

  loadScript("2.js", function (error, script) {
    if (error) {
      handleError(error);
      return;
    }

    loadScript("3.js", function (error, script) {
      if (error) {
        handleError(error);
        return;
      }
      // táº¥t cáº£ 3 scripts loaded!
    });
  });
});
```

### Pyramid of Doom

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ Váº¤N Äá»€: Callback Hell / Pyramid of Doom
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ ng nhiá»u async â†’ cÃ ng lá»“ng sÃ¢u â†’ khÃ³ Ä‘á»c!
loadScript("1.js", function (err, script) {
  if (err) {
    handleError(err);
  } else {
    loadScript("2.js", function (err, script) {
      if (err) {
        handleError(err);
      } else {
        loadScript("3.js", function (err, script) {
          if (err) {
            handleError(err);
          } else {
            // ... nesting Ä‘iÃªn!
          }
        });
      }
    });
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Giáº£m thiá»‡u: tÃ¡ch thÃ nh named functions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

loadScript("1.js", step1);

function step1(err, script) {
  if (err) {
    handleError(err);
    return;
  }
  loadScript("2.js", step2);
}

function step2(err, script) {
  if (err) {
    handleError(err);
    return;
  }
  loadScript("3.js", step3);
}

function step3(err, script) {
  if (err) {
    handleError(err);
    return;
  }
  // done! NhÆ°ng code bá»‹ "tÃ© rÃ¡c" khÃ³ Ä‘á»c
}

// âœ… GIáº¢I PHÃP THáº¬T Sá»°: Promises â†’ async/await
```

### Tá»•ng Há»£p: Callbacks

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALLBACKS â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Callback = fn truyá»n vÃ o, cháº¡y khi async hoÃ n thÃ nh          â”‚
â”‚  Error-first: callback(err, result)                            â”‚
â”‚    arg1 = error (null náº¿u OK) | arg2+ = káº¿t quáº£              â”‚
â”‚                                                                 â”‚
â”‚  Sequential: callback-in-callback (lá»“ng nhau)                  â”‚
â”‚  âš ï¸ Pyramid of Doom: nesting sÃ¢u, khÃ³ Ä‘á»c, khÃ³ maintain     â”‚
â”‚                                                                 â”‚
â”‚  Giáº£m thiá»‡u: tÃ¡ch named fn | NhÆ°ng váº«n khÃ³ Ä‘á»c              â”‚
â”‚  Giáº£i phÃ¡p: Promises â†’ async/await (chÆ°Æ¡ng sau)               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 44. Promise â€” Lá»i Há»©a Báº¥t Äá»“ng Bá»™

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE â€” Báº£n Äá»“ Tá»•ng Quan                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new Promise(function(resolve, reject) { ... })                â”‚
â”‚  executor cháº¡y Tá»° Äá»˜NG, gá»i resolve(value) hoáº·c reject(err)  â”‚
â”‚                                                                 â”‚
â”‚  States:  pending â”€â”€â†’ fulfilled (resolve)                      â”‚
â”‚                   â””â”€â†’ rejected  (reject)                       â”‚
â”‚  âš ï¸ Chá»‰ 1 láº§n! resolve/reject tiáº¿p theo bá»‹ IGNORE             â”‚
â”‚                                                                 â”‚
â”‚  Consumers:                                                     â”‚
â”‚  .then(onFulfilled, onRejected)                                â”‚
â”‚  .catch(onRejected)  = .then(null, fn)                         â”‚
â”‚  .finally(fn)        = cháº¡y luÃ´n, KHÃ”NG nháº­n args             â”‚
â”‚                        pass-through result/error                â”‚
â”‚                                                                 â”‚
â”‚  Promise vs Callback:                                           â”‚
â”‚  âœ… Natural order (run â†’ .then)                                â”‚
â”‚  âœ… Multiple handlers (.then nhiá»u láº§n)                        â”‚
â”‚  âœ… Chaining (chÆ°Æ¡ng sau)                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Constructor & States

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// new Promise(executor) â€” executor cháº¡y Tá»° Äá»˜NG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let promise = new Promise(function (resolve, reject) {
  // executor: producing code
  // resolve(value) â€” thÃ nh cÃ´ng
  // reject(error)  â€” tháº¥t báº¡i

  setTimeout(() => resolve("done"), 1000);
});
// state: "pending" â†’ (1s) â†’ "fulfilled", result: "done"

// Reject example:
let failed = new Promise((resolve, reject) => {
  setTimeout(() => reject(new Error("Whoops!")), 1000);
});
// state: "pending" â†’ (1s) â†’ "rejected", result: Error

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ CHá»ˆ 1 Láº¦N! Calls tiáº¿p theo bá»‹ ignore
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p = new Promise((resolve, reject) => {
  resolve("done"); // âœ… láº§n Ä‘áº§u
  reject(new Error("...")); // âŒ ignored
  setTimeout(() => resolve("..."), 1000); // âŒ ignored
});

// Resolve NGAY cÅ©ng OK (cached result)
let instant = new Promise((resolve) => resolve(123));
// state: "fulfilled" ngay láº­p tá»©c
```

### Consumers: then, catch, finally

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .then(onFulfilled, onRejected)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

promise.then(
  (result) => console.log(result), // khi fulfilled
  (error) => console.log(error), // khi rejected
);

// Chá»‰ quan tÃ¢m success:
promise.then(alert);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .catch(fn) = .then(null, fn) â€” chá»‰ handle error
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p = new Promise((_, reject) => {
  setTimeout(() => reject(new Error("Whoops!")), 1000);
});
p.catch(alert); // "Error: Whoops!" sau 1s

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .finally(fn) â€” cháº¡y LUÃ”N, khÃ´ng nháº­n args
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve, reject) => {
  setTimeout(() => resolve("value"), 2000);
})
  .finally(() => alert("Promise ready")) // cháº¡y trÆ°á»›c
  .then((result) => alert(result)); // "value"

// finally Ä‘áº·c biá»‡t:
// 1) KhÃ´ng nháº­n arguments (khÃ´ng biáº¿t success/error)
// 2) "Pass through" result/error cho handler tiáº¿p theo
// 3) Return value bá»‹ ignore (trá»« khi throw error)
// 4) Náº¿u throw â†’ error Ä‘i tá»›i nearest error handler

new Promise((_, reject) => {
  throw new Error("err");
})
  .finally(() => alert("cleanup")) // cháº¡y trÆ°á»›c
  .catch((err) => alert(err)); // "Error: err"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Handler trÃªn settled promise â†’ cháº¡y NGAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let done = new Promise((resolve) => resolve("done!"));
done.then(alert); // "done!" (ngay láº­p tá»©c)
// KhÃ¡c real-life subscription: Promise linh hoáº¡t hÆ¡n!
```

### Promise vs Callback: loadScript

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALLBACK version (cÅ©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loadScript(src, callback) {
  let script = document.createElement("script");
  script.src = src;
  script.onload = () => callback(null, script);
  script.onerror = () => callback(new Error(`Load error: ${src}`));
  document.head.append(script);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROMISE version (má»›i) â€” KHÃ”NG cáº§n callback param!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loadScript(src) {
  return new Promise((resolve, reject) => {
    let script = document.createElement("script");
    script.src = src;
    script.onload = () => resolve(script);
    script.onerror = () => reject(new Error(`Load error: ${src}`));
    document.head.append(script);
  });
}

let p = loadScript("lodash.js");
p.then((script) => alert(`${script.src} loaded!`));
p.then((script) => alert("Another handler!"));
// âœ… Multiple handlers! Callback chá»‰ cÃ³ 1.

// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚     PROMISES         â”‚     CALLBACKS                â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ Natural order:       â”‚ Pháº£i biáº¿t trÆ°á»›c callback     â”‚
// â”‚ run â†’ .then          â”‚ khi gá»i function             â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ .then nhiá»u láº§n      â”‚ Chá»‰ 1 callback               â”‚
// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
// â”‚ Chaining (ch.sau)    â”‚ Pyramid of Doom              â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### BÃ i Táº­p Thá»±c HÃ nh

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 1: Re-resolve a promise?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let promise = new Promise((resolve, reject) => {
  resolve(1);
  setTimeout(() => resolve(2), 1000);
});
promise.then(alert); // 1
// âš ï¸ resolve(2) bá»‹ IGNORE â€” chá»‰ láº§n Ä‘áº§u cÃ³ hiá»‡u lá»±c!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I 2: delay(ms) â€” Promise-based setTimeout
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function delay(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

delay(3000).then(() => alert("runs after 3 seconds"));
// resolve gá»i KHÃ”NG argument â€” chá»‰ cáº§n delay!
```

### Tá»•ng Há»£p: Promise

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new Promise(executor) â€” executor(resolve, reject) auto-run    â”‚
â”‚  States: pending â†’ fulfilled (resolve) / rejected (reject)     â”‚
â”‚  âš ï¸ Chá»‰ 1 láº§n! Calls tiáº¿p bá»‹ ignore                          â”‚
â”‚                                                                 â”‚
â”‚  .then(onOK, onErr) | .catch(fn) | .finally(fn)               â”‚
â”‚  finally: no args, pass-through, return ignored                â”‚
â”‚  Handler on settled â†’ cháº¡y ngay                                â”‚
â”‚                                                                 â”‚
â”‚  Promise > Callback: natural order, multiple .then, chaining   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 45. Promises Chaining â€” Chuá»—i Lá»i Há»©a

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISES CHAINING â€” Báº£n Äá»“ Tá»•ng Quan                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .then() tráº£ vá» NEW PROMISE â†’ chain tiáº¿p Ä‘Æ°á»£c               â”‚
â”‚  return value â†’ promise resolved vá»›i value Ä‘Ã³               â”‚
â”‚  return Promise â†’ chá» settle, rá»“i tiáº¿p                      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ CHAINING â‰  nhiá»u .then trÃªn 1 promise                     â”‚
â”‚  Chaining: .then().then() â†’ result truyá»n xuá»‘ng             â”‚
â”‚  Nhiá»u .then: má»—i cÃ¡i nháº­n CÃ™NG result gá»‘c                   â”‚
â”‚                                                                 â”‚
â”‚  Thenable: object cÃ³ .then() â†’ tÆ°Æ¡ng thÃ­ch Promise          â”‚
â”‚  fetch: .then(râ†’r.json()).then(dataâ†’...) chain thá»±c táº¿       â”‚
â”‚  âœ… Code "flat" (xuá»‘ng dÆ°á»›i), khÃ´ng pyramid                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chaining CÆ¡ Báº£n

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .then() tráº£ vá» NEW Promise â†’ chain
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve) => {
  setTimeout(() => resolve(1), 1000);
})
  .then((result) => {
    alert(result); // 1
    return result * 2; // â†’ new Promise resolved vá»›i 2
  })
  .then((result) => {
    alert(result); // 2
    return result * 2; // â†’ new Promise resolved vá»›i 4
  })
  .then((result) => {
    alert(result); // 4
  });
// Flow: 1 â†’ 2 â†’ 4 (result truyá»n xuá»‘ng!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ NEWBIE ERROR: nhiá»u .then trÃªn 1 promise â‰  chaining!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p = new Promise((resolve) => setTimeout(() => resolve(1), 1000));

p.then((r) => {
  alert(r);
  return r * 2;
}); // 1
p.then((r) => {
  alert(r);
  return r * 2;
}); // 1 (âŒ khÃ´ng pháº£i 2!)
p.then((r) => {
  alert(r);
  return r * 2;
}); // 1 (âŒ khÃ´ng pháº£i 4!)
// Táº¥t cáº£ nháº­n CÃ™NG result gá»‘c = 1, KHÃ”NG truyá»n tiáº¿p!
```

### Returning Promises & loadScript

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Return Promise â†’ chain CHá» settle rá»“i tiáº¿p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve) => setTimeout(() => resolve(1), 1000))
  .then((result) => {
    alert(result); // 1
    return new Promise((resolve) => {
      setTimeout(() => resolve(result * 2), 1000);
    });
  })
  .then((result) => {
    alert(result); // 2 (sau 1s ná»¯a)
    return new Promise((resolve) => {
      setTimeout(() => resolve(result * 2), 1000);
    });
  })
  .then((result) => alert(result)); // 4 (sau 1s ná»¯a)
// 1 â†’ (1s) â†’ 2 â†’ (1s) â†’ 4

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// loadScript: flat chain thay vÃ¬ pyramid!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

loadScript("one.js")
  .then((script) => loadScript("two.js"))
  .then((script) => loadScript("three.js"))
  .then((script) => {
    one();
    two();
    three(); // táº¥t cáº£ loaded!
  });
// âœ… Flat! Xuá»‘ng dÆ°á»›i, khÃ´ng sang pháº£i!
```

### Thenable & fetch Chaining

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Thenable: object cÃ³ .then() method
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Thenable {
  constructor(num) {
    this.num = num;
  }
  then(resolve, reject) {
    setTimeout(() => resolve(this.num * 2), 1000);
  }
}

new Promise((resolve) => resolve(1))
  .then((result) => new Thenable(result)) // obj cÃ³ .then()
  .then(alert); // 2 (sau 1s)
// JS check: return value cÃ³ .then()? â†’ gá»i nÃ³!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// fetch chaining: thá»±c táº¿ dÃ¹ng promises
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fetch("/user.json")
  .then((response) => response.json()) // parse JSON
  .then((user) => fetch(`https://api.github.com/users/${user.name}`))
  .then((response) => response.json()) // parse GitHub JSON
  .then(
    (githubUser) =>
      new Promise((resolve, reject) => {
        let img = document.createElement("img");
        img.src = githubUser.avatar_url;
        document.body.append(img);
        setTimeout(() => {
          img.remove();
          resolve(githubUser); // âœ… return Promise Ä‘á»ƒ chain tiáº¿p!
        }, 3000);
      }),
  )
  .then((githubUser) => alert(`Done: ${githubUser.name}`));
// Good practice: async action LUÃ”N return promise!

// TÃ¡ch thÃ nh reusable functions:
function loadJson(url) {
  return fetch(url).then((r) => r.json());
}
function loadGithubUser(name) {
  return loadJson(`https://api.github.com/users/${name}`);
}
// loadJson("/user.json")
//   .then(user => loadGithubUser(user.name))
//   .then(showAvatar)
//   .then(user => alert(`Done: ${user.name}`));
```

### BÃ i Táº­p: .then(f1).catch(f2) vs .then(f1, f2)

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2 cÃ¡ch nÃ y KHÃC nhau!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡ch 1: .then(f1).catch(f2)
promise.then(f1).catch(f2);
// Náº¿u f1 THROW error â†’ f2 Báº®T Ä‘Æ°á»£c!
// (catch á»Ÿ STEP tiáº¿p theo trong chain)

// CÃ¡ch 2: .then(f1, f2)
promise.then(f1, f2);
// Náº¿u f1 THROW error â†’ f2 KHÃ”NG báº¯t Ä‘Æ°á»£c!
// (f1 vÃ  f2 cÃ¹ng level, chá»‰ 1 cháº¡y)

// âœ… .then(f1).catch(f2) AN TOÃ€N hÆ¡n!
```

### Tá»•ng Há»£p: Promises Chaining

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISES CHAINING â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .then() tráº£ NEW promise â†’ chain tiáº¿p                          â”‚
â”‚  return value â†’ resolved vá»›i value                            â”‚
â”‚  return Promise â†’ chá» settle, rá»“i chain tiáº¿p                  â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Chaining â‰  nhiá»u .then trÃªn 1 promise                     â”‚
â”‚  Thenable: object cÃ³ .then() â†’ tÆ°Æ¡ng thÃ­ch                    â”‚
â”‚  .then(f1).catch(f2) an toÃ n hÆ¡n .then(f1, f2)                â”‚
â”‚  Async action nÃªn luÃ´n return promise                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 46. Error Handling with Promises â€” Xá»­ LÃ½ Lá»—i

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERROR HANDLING â€” Báº£n Äá»“ Tá»•ng Quan                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .catch á»Ÿ CUá»I chain â†’ báº¯t Má»Œc error trÆ°á»›c Ä‘Ã³              â”‚
â”‚  reject() hoáº·c throw â†’ nháº£y Ä‘áº¿n nearest .catch              â”‚
â”‚                                                                 â”‚
â”‚  Implicit try..catch:                                          â”‚
â”‚  â€¢ executor throw â†’ auto reject                              â”‚
â”‚  â€¢ .then handler throw â†’ auto reject                         â”‚
â”‚  â€¢ Ká»ƒ cáº£ programming errors (ReferenceError...)              â”‚
â”‚                                                                 â”‚
â”‚  Rethrowing:                                                    â”‚
â”‚  .catch xá»­ lÃ½ xong â†’ tiáº¿p .then bÃ¬nh thÆ°á»ng               â”‚
â”‚  .catch throw láº¡i â†’ nháº£y Ä‘áº¿n .catch tiáº¿p theo               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Unhandled rejection: khÃ´ng .catch â†’ global error          â”‚
â”‚  Browser: window.unhandledrejection event                      â”‚
â”‚  âš ï¸ setTimeout throw KHÃ”NG bá»‹ catch (async context riÃªng)    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implicit try..catch & .catch

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .catch á»Ÿ cuá»‘i chain: báº¯t Má»ŒI error
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fetch("https://no-such-server.blabla")
  .then((response) => response.json())
  .catch((err) => alert(err)); // TypeError: failed to fetch
// .catch khÃ´ng cáº§n ngay sau! CÃ³ thá»ƒ sau nhiá»u .then

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Implicit try..catch: throw = reject
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Executor throw = reject:
new Promise((resolve, reject) => {
  throw new Error("Whoops!"); // = reject(new Error(...))
}).catch(alert); // "Error: Whoops!"

// Handler throw cÅ©ng bá»‹ catch:
new Promise((resolve) => resolve("ok"))
  .then((result) => {
    throw new Error("Whoops!"); // reject!
  })
  .catch(alert); // "Error: Whoops!"

// Ká»ƒ cáº£ programming errors:
new Promise((resolve) => resolve("ok"))
  .then((result) => {
    blabla(); // ReferenceError!
  })
  .catch(alert); // "ReferenceError: blabla is not defined"
```

### Rethrowing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .catch xá»­ lÃ½ xong â†’ tiáº¿p .then bÃ¬nh thÆ°á»ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve, reject) => {
  throw new Error("Whoops!");
})
  .catch((error) => {
    alert("Error handled!"); // xá»­ lÃ½ xong
  })
  .then(() => alert("Next handler runs")); // âœ… cháº¡y!
// catch â†’ then (recovery!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .catch throw láº¡i â†’ nháº£y Ä‘áº¿n .catch káº¿ tiáº¿p
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve, reject) => {
  throw new Error("Whoops!");
})
  .catch((error) => {
    if (error instanceof URIError) {
      // xá»­ lÃ½ Ä‘Æ°á»£c
    } else {
      alert("Can't handle");
      throw error; // rethrow! â†’ .catch tiáº¿p theo
    }
  })
  .then(() => {
    /* KHÃ”NG cháº¡y */
  })
  .catch((error) => alert(`Unknown: ${error}`)); // âœ… báº¯t láº¡i!
```

### Unhandled Rejections & setTimeout

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ KhÃ´ng .catch = unhandled rejection!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise(() => {
  noSuchFunction(); // Error!
}).then(() => { ... });
// KhÃ´ng .catch â†’ error "káº¹t"! Global error!

// Browser: báº¯t unhandled rejections
window.addEventListener("unhandledrejection", function(event) {
  alert(event.promise); // promise gÃ¢y lá»—i
  alert(event.reason);  // error object
});

new Promise(() => { throw new Error("Whoops!"); });
// â†’ unhandledrejection event fires!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ BÃ€I Táº¬P: setTimeout throw KHÃ”NG bá»‹ catch!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

new Promise((resolve, reject) => {
  setTimeout(() => {
    throw new Error("Whoops!"); // âŒ KHÃ”NG bá»‹ catch!
  }, 1000);
}).catch(alert); // KHÃ”NG cháº¡y!

// Táº¡i sao? Implicit try..catch bao SYNCHRONOUS code.
// setTimeout callback cháº¡y SAU, trong ASYNC context riÃªng.
// Promise Ä‘Ã£ settled trÆ°á»›c khi setTimeout callback cháº¡y.
// âœ… Fix: dÃ¹ng reject() thay vÃ¬ throw trong setTimeout:
new Promise((resolve, reject) => {
  setTimeout(() => reject(new Error("Whoops!")), 1000);
}).catch(alert); // âœ… "Error: Whoops!"
```

### Tá»•ng Há»£p: Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERROR HANDLING â€” SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Implicit try..catch: throw = auto reject                      â”‚
â”‚  .catch cuá»‘i chain báº¯t Má»ŒI error (reject + throw)             â”‚
â”‚  Rethrowing: .catch xá»­ lÃ½ â†’ .then | throw â†’ .catch tiáº¿p     â”‚
â”‚                                                                 â”‚
â”‚  Unhandled rejection: khÃ´ng .catch â†’ global error             â”‚
â”‚  Browser: unhandledrejection event                             â”‚
â”‚  âš ï¸ setTimeout throw â‰  reject (async context riÃªng)           â”‚
â”‚  âœ… DÃ¹ng reject() trong setTimeout, khÃ´ng throw                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 47. Promise API â€” 6 Static Methods

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE API â€” Báº£n Äá»“ Tá»•ng Quan                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  METHOD                      â”‚  Káº¼T QUáº¢                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Promise.all(promises)       â”‚  Chá» Táº¤T Cáº¢     | 1 fail = reject â”‚
â”‚  Promise.allSettled(p)       â”‚  Chá» Táº¤T Cáº¢     | cÃ³ status/value â”‚
â”‚  Promise.race(promises)      â”‚  First SETTLED  | win             â”‚
â”‚  Promise.any(promises)       â”‚  First FULFILLED| AggregateError  â”‚
â”‚  Promise.resolve(value)      â”‚  Táº¡o resolved promise              â”‚
â”‚  Promise.reject(error)       â”‚  Táº¡o rejected promise              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Promise.all â€” Táº¥t Cáº£ Hoáº·c KhÃ´ng

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise.all: chá» Táº¤T Cáº¢, 1 fail = reject NGAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Promise.all([
  new Promise((resolve) => setTimeout(() => resolve(1), 3000)),
  new Promise((resolve) => setTimeout(() => resolve(2), 2000)),
  new Promise((resolve) => setTimeout(() => resolve(3), 1000)),
]).then(alert); // [1, 2, 3] â€” GIá»® THá»¨ Tá»° gá»‘c!
// Chá» 3s (lÃ¢u nháº¥t), káº¿t quáº£ theo thá»© tá»± input

// Thá»±c táº¿: map URLs â†’ promises
let urls = ["user/1", "user/2", "user/3"];
let requests = urls.map((url) => fetch(url));
Promise.all(requests)
  .then((responses) => Promise.all(responses.map((r) => r.json())))
  .then((users) => users.forEach((u) => alert(u.name)));

// âš ï¸ 1 reject = Táº¤T Cáº¢ fail!
Promise.all([
  new Promise((resolve) => setTimeout(() => resolve(1), 1000)),
  new Promise((_, reject) =>
    setTimeout(() => reject(new Error("Whoops!")), 2000),
  ),
  new Promise((resolve) => setTimeout(() => resolve(3), 3000)),
]).catch(alert); // "Error: Whoops!" â€” cÃ¡c promise khÃ¡c bá»‹ IGNORE
// âš ï¸ Promise.all KHÃ”NG cancel cÃ¡c promise khÃ¡c (váº«n cháº¡y tiáº¿p)

// Cháº¥p nháº­n non-promise values:
Promise.all([1, 2, 3]).then(alert); // [1, 2, 3]
Promise.all([
  new Promise((resolve) => setTimeout(() => resolve(1), 1000)),
  2,
  3,
]).then(alert); // [1, 2, 3]
```

### Promise.allSettled â€” Táº¥t Cáº£ Káº¿t Quáº£

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// allSettled: chá» Táº¤T Cáº¢, KHÃ”NG fail-fast!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let urls = ["user/1", "user/2", "https://no-such-url"];

Promise.allSettled(urls.map((url) => fetch(url))).then((results) => {
  results.forEach((result, i) => {
    if (result.status === "fulfilled") {
      alert(`${urls[i]}: ${result.value.status}`);
    }
    if (result.status === "rejected") {
      alert(`${urls[i]}: ${result.reason}`);
    }
  });
});

// Káº¿t quáº£:
// [
//   { status: "fulfilled", value: Response },
//   { status: "fulfilled", value: Response },
//   { status: "rejected",  reason: Error   }
// ]

// Polyfill (old browsers):
if (!Promise.allSettled) {
  Promise.allSettled = (promises) =>
    Promise.all(
      promises.map((p) =>
        Promise.resolve(p).then(
          (value) => ({ status: "fulfilled", value }),
          (reason) => ({ status: "rejected", reason }),
        ),
      ),
    );
}
```

### Promise.race & Promise.any

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// race: first SETTLED (resolve HOáº¶C reject) wins
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Promise.race([
  new Promise((resolve) => setTimeout(() => resolve(1), 1000)),
  new Promise((_, reject) => setTimeout(() => reject(new Error("!")), 2000)),
  new Promise((resolve) => setTimeout(() => resolve(3), 3000)),
]).then(alert); // 1 (nhanh nháº¥t!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// any: first FULFILLED wins (bá» qua reject)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Promise.any([
  new Promise((_, reject) => setTimeout(() => reject(new Error("!")), 1000)),
  new Promise((resolve) => setTimeout(() => resolve(1), 2000)),
  new Promise((resolve) => setTimeout(() => resolve(3), 3000)),
]).then(alert); // 1 (first fulfilled, bá» qua reject!)

// Táº¥t cáº£ reject â†’ AggregateError:
Promise.any([
  new Promise((_, reject) => setTimeout(() => reject(new Error("A")), 1000)),
  new Promise((_, reject) => setTimeout(() => reject(new Error("B")), 2000)),
]).catch((err) => {
  console.log(err.constructor.name); // "AggregateError"
  console.log(err.errors[0]); // Error: A
  console.log(err.errors[1]); // Error: B
});
```

### Promise.resolve & Promise.reject

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o promise Ä‘Ã£ settle sáºµn (compatibility)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Promise.resolve(123); // = new Promise(resolve => resolve(123))
Promise.reject(new Error("!")); // = new Promise((_, reject) => reject(...))

// Thá»±c táº¿: function luÃ´n tráº£ promise
let cache = new Map();
function loadCached(url) {
  if (cache.has(url)) {
    return Promise.resolve(cache.get(url)); // cached!
  }
  return fetch(url)
    .then(response => response.text())
    .then(text => { cache.set(url, text); return text; });
}
loadCached(url).then(...); // LUÃ”N .then Ä‘Æ°á»£c!

// âš ï¸ async/await lÃ m resolve/reject Ã­t dÃ¹ng hÆ¡n
```

### Tá»•ng Há»£p: Promise API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISE API â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .all       â”‚ chá» táº¥t cáº£, 1 fail = reject            â”‚
â”‚  .allSettled â”‚ chá» táº¥t cáº£, tráº£ {status, value/reason}   â”‚
â”‚  .race      â”‚ first settled (resolve or reject)        â”‚
â”‚  .any       â”‚ first fulfilled, AggregateError náº¿u Ä‘á»u fail â”‚
â”‚  .resolve   â”‚ táº¡o resolved promise                    â”‚
â”‚  .reject    â”‚ táº¡o rejected promise                    â”‚
â”‚                                                                 â”‚
â”‚  Hay dÃ¹ng nháº¥t: Promise.all                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 48. Promisification â€” Chuyá»ƒn Callback ThÃ nh Promise

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISIFICATION â€” Báº£n Äá»“ Tá»•ng Quan                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Callback-based fn â†’ Promise-based fn                         â”‚
â”‚  Wrapper: bá»c fn gá»‘c, return new Promise                     â”‚
â”‚  err â†’ reject(err) | result â†’ resolve(result)               â”‚
â”‚                                                                 â”‚
â”‚  Generic helper: promisify(f)                                  â”‚
â”‚  â€¢ Push custom callback vÃ o args                              â”‚
â”‚  â€¢ Gá»i f.call(this, ...args)                                 â”‚
â”‚  â€¢ manyArgs: resolve vá»›i array results                       â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Chá»‰ cho fn gá»i callback 1 Láº¦N                             â”‚
â”‚  Node.js: util.promisify() built-in                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Promisify loadScript

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Callback â†’ Promise: wrapper thá»§ cÃ´ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Fn gá»‘c (callback-based):
function loadScript(src, callback) {
  let script = document.createElement("script");
  script.src = src;
  script.onload = () => callback(null, script);
  script.onerror = () => callback(new Error(`Load error: ${src}`));
  document.head.append(script);
}

// Promisified version:
let loadScriptPromise = function(src) {
  return new Promise((resolve, reject) => {
    loadScript(src, (err, script) => {
      if (err) reject(err);
      else resolve(script);
    });
  });
};

loadScriptPromise("path/script.js").then(...);
// âœ… Wrapper bá»c fn gá»‘c, dÃ¹ng callback Ä‘á»ƒ resolve/reject
```

### Generic promisify() Helper

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// promisify(f): generic helper
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function promisify(f, manyArgs = false) {
  return function(...args) {
    return new Promise((resolve, reject) => {
      function callback(err, ...results) {
        if (err) {
          reject(err);
        } else {
          resolve(manyArgs ? results : results[0]);
        }
      }

      args.push(callback); // thÃªm callback vÃ o cuá»‘i
      f.call(this, ...args); // gá»i fn gá»‘c
    });
  };
}

// Sá»­ dá»¥ng:
let loadScriptPromise = promisify(loadScript);
loadScriptPromise("path/script.js").then(...);

// Multi-arg callback:
let fn = promisify(someFunction, true);
fn(...).then(arrayOfResults => ...);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ Háº N CHáº¾: chá»‰ cho fn gá»i callback 1 Láº¦N!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Promise chá»‰ cÃ³ 1 result. Callback cÃ³ thá»ƒ gá»i nhiá»u láº§n.
// Promisification chá»‰ phÃ¹ há»£p fn gá»i callback ÄÃšNH 1 Láº¦N.
// Calls tiáº¿p theo bá»‹ ignore (nhÆ° resolve/reject cá»§a Promise).

// Node.js: util.promisify() built-in
const util = require("util");
const readFile = util.promisify(fs.readFile);
readFile("file.txt", "utf8").then(data => ...);
```

### Tá»•ng Há»£p: Promisification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROMISIFICATION â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Callback fn â†’ return new Promise wrapper                     â”‚
â”‚  promisify(f): generic, push callback, f.call(this)           â”‚
â”‚  manyArgs: resolve vá»›i [results] array                        â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Chá»‰ cho fn gá»i callback 1 láº§n!                           â”‚
â”‚  Node.js: util.promisify() built-in                            â”‚
â”‚  KhÃ´ng thay tháº¿ toÃ n bá»™ callbacks, bá»• sung                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 49. Microtasks â€” HÃ ng Äá»£i Vi TÃ¡c Vá»¥

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MICROTASKS â€” Báº£n Äá»“ Tá»•ng Quan                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .then/.catch/.finally LUÃ”N asynchronous                      â”‚
â”‚  VÃ o "microtask queue" (PromiseJobs)                          â”‚
â”‚                                                                 â”‚
â”‚  Thá»© tá»±:                                                        â”‚
â”‚  1. Current code cháº¡y xong                                     â”‚
â”‚  2. Microtask queue cháº¡y (FIFO)                                â”‚
â”‚  3. Macrotask (setTimeout, etc.)                               â”‚
â”‚                                                                 â”‚
â”‚  unhandledrejection: check SAU khi microtask queue rá»—ng       â”‚
â”‚  setTimeout .catch = QUÃ TRá»„! Event Ä‘Ã£ fire rá»“i              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Microtask Queue & Thá»© Tá»± Thá»±c Thi

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// .then cháº¡y SAU current code, dÃ¹ Promise Ä‘Ã£ resolve
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let promise = Promise.resolve();

promise.then(() => alert("promise done!"));

alert("code finished"); // âœ… HIá»‚N TRÆ¯á»œC!

// Thá»© tá»±: "code finished" â†’ "promise done!"
// Táº¡i sao? .then vÃ o microtask queue, chá» current code xong

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Microtask Queue (FIFO):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Current code cháº¡y háº¿t
// 2. Engine láº¥y tasks tá»« microtask queue (FIFO)
// 3. Má»—i .then/.catch/.finally = 1 microtask

Promise.resolve()
  .then(() => alert("promise done!"))
  .then(() => alert("code finished"));
// Báº£o Ä‘áº£m thá»© tá»±: dÃ¹ng .then chain!

// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚  [Current Code] â†’ [Microtasks] â†’ [Macrotasks] â”‚
// â”‚  (sync code)       (.then/catch)   (setTimeout)  â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Unhandled Rejection & Microtask Timing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ³ .catch â†’ khÃ´ng trigger unhandledrejection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p1 = Promise.reject(new Error("Failed!"));
p1.catch((err) => alert("caught")); // âœ… handled!

window.addEventListener("unhandledrejection", (e) => alert(e.reason));
// KHÃ”NG trigger! VÃ¬ Ä‘Ã£ cÃ³ .catch

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// KhÃ´ng .catch â†’ unhandledrejection fires!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p2 = Promise.reject(new Error("Failed!"));
window.addEventListener("unhandledrejection", (e) => alert(e.reason));
// "Error: Failed!" â€” unhandled!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ setTimeout .catch = QUÃ TRá»„!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let p3 = Promise.reject(new Error("Failed!"));
setTimeout(() => p3.catch((err) => alert("caught")), 1000);

window.addEventListener("unhandledrejection", (e) => alert(e.reason));
// "Error: Failed!" hiá»ƒn TRÆ¯á»œC, rá»“i "caught" sau 1s

// Táº¡i sao? unhandledrejection check SAU khi microtask queue Rá»–NG.
// setTimeout lÃ  macrotask â†’ cháº¡y SAU microtask queue.
// LÃºc check: chÆ°a cÃ³ .catch â†’ event fires!
// setTimeout .catch: Ä‘Ãºng nhÆ°ng QUÃ MUá»˜N.
```

### Tá»•ng Há»£p: Microtasks

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MICROTASKS â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  .then/.catch/.finally = microtasks (asynchronous)             â”‚
â”‚  Cháº¡y SAU current code, TRÆ¯á»œC macrotask                      â”‚
â”‚  FIFO: enqueue trÆ°á»›c â†’ cháº¡y trÆ°á»›c                             â”‚
â”‚                                                                 â”‚
â”‚  unhandledrejection: check sau microtask queue rá»—ng           â”‚
â”‚  setTimeout .catch = quÃ¡ trá»… (macrotask, cháº¡y sau)            â”‚
â”‚  Äáº£m báº£o thá»© tá»±: dÃ¹ng .then chain                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 50. Event Loop: Microtasks & Macrotasks

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT LOOP ALGORITHM                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Láº¥y & cháº¡y Macrotask cÅ© nháº¥t (script, setTimeout...)    â”‚
â”‚  2. Cháº¡y Há»T Microtask queue (.then, queueMicrotask)         â”‚
â”‚  3. Render (náº¿u cÃ³ thay Ä‘á»•i DOM)                               â”‚
â”‚  4. Quay láº¡i bÆ°á»›c 1 (hoáº·c sleep chá» task má»›i)               â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Rendering KHÃ”NG xáº£y ra khi Ä‘ang cháº¡y task                â”‚
â”‚  âš ï¸ Task quÃ¡ lÃ¢u â†’ "Page Unresponsive"                        â”‚
â”‚  âœ… Split CPU task vá»›i setTimeout(fn, 0)                       â”‚
â”‚  âœ… queueMicrotask(fn) â€” async nhÆ°ng TRÆ¯á»œC render              â”‚
â”‚  âœ… Web Workers cho heavy calculations                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Splitting CPU-Hungry Tasks

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ BLOCK: CPU-heavy task cháº·n toÃ n bá»™ UI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function count() {
  for (let i = 0; i < 1e9; i++) {} // âŒ Hang!
  alert("Done");
}
count(); // Browser "khÃ´ng pháº£n há»“i"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… FIX: Split vá»›i setTimeout(fn, 0)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let i = 0;
function count() {
  do {
    i++;
  } while (i % 1e6 !== 0); // 1M má»—i láº§n

  if (i < 1e9) {
    setTimeout(count); // nhÆ°á»ng event loop!
  } else {
    alert("Done");
  }
}
count(); // âœ… UI responsive, events Ä‘Æ°á»£c xá»­ lÃ½ giá»¯a cÃ¡c chunks

// Trick: schedule TRÆ¯á»œC khi lÃ m viá»‡c â†’ nhanh hÆ¡n!
function countFaster() {
  if (i < 1e9 - 1e6) setTimeout(countFaster); // schedule trÆ°á»›c!
  do {
    i++;
  } while (i % 1e6 !== 0);
  if (i === 1e9) alert("Done");
}
// Táº¡i sao nhanh hÆ¡n? Táº­n dá»¥ng 4ms delay tá»‘i thiá»ƒu cá»§a setTimeout
```

### Progress Indication & Post-Event

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Progress: DOM paint chá»‰ SAU khi task xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ KhÃ´ng tháº¥y progress (chá»‰ hiá»ƒn giÃ¡ trá»‹ cuá»‘i):
for (let i = 0; i < 1e6; i++) {
  progress.innerHTML = i; // KHÃ”NG repaint!
}

// âœ… Split vá»›i setTimeout â†’ cÃ³ progress bar:
let i = 0;
function count() {
  do {
    i++;
    progress.innerHTML = i;
  } while (i % 1e3 !== 0);
  if (i < 1e7) setTimeout(count); // repaint giá»¯a cÃ¡c chunks!
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Post-event: setTimeout(fn, 0) sau khi event xá»­ lÃ½ xong
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

menu.onclick = function () {
  // dispatch custom event SAU khi click bubbling xong
  setTimeout(() =>
    menu.dispatchEvent(new CustomEvent("menu-open", { bubbles: true })),
  );
};
```

### queueMicrotask & Execution Order

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// queueMicrotask: async nhÆ°ng TRÆ¯á»œC render!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setTimeout(() => alert("timeout")); // macrotask
Promise.resolve().then(() => alert("promise")); // microtask
alert("code"); // sync

// Thá»© tá»±: "code" â†’ "promise" â†’ "timeout"

// queueMicrotask(fn) khÃ´ng gÃ¢y render (khÃ¡c setTimeout):
let i = 0;
function count() {
  do {
    i++;
    progress.innerHTML = i;
  } while (i % 1e3 !== 0);
  if (i < 1e6) queueMicrotask(count); // microtask!
}
// âš ï¸ RENDER chá»‰ á»Ÿ CUá»I (giá»‘ng sync), khÃ´ng tháº¥y progress!
// DÃ¹ng setTimeout náº¿u cáº§n progress bar

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ€I Táº¬P: output order?
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log(1); // sync
setTimeout(() => console.log(2)); // macro
Promise.resolve().then(() => console.log(3)); // micro
Promise.resolve().then(() => setTimeout(() => console.log(4))); // micro â†’ macro
Promise.resolve().then(() => console.log(5)); // micro
setTimeout(() => console.log(6)); // macro
console.log(7); // sync

// Káº¿t quáº£: 1 7 3 5 2 6 4
// BÆ°á»›c 1: sync â†’ 1, 7
// BÆ°á»›c 2: microtask â†’ 3, setTimeout(...4) enqueue, 5
// BÆ°á»›c 3: macrotask â†’ 2, 6, 4
```

### Web Workers & Tá»•ng Há»£p

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Web Workers: parallel thread, KHÃ”NG cÃ³ DOM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Cháº¡y code trong thread riÃªng, khÃ´ng block event loop
// Trao Ä‘á»•i messages vá»›i main process
// CÃ³ variables vÃ  event loop riÃªng
// DÃ¹ng cho heavy calculations (multi-core CPU)
const worker = new Worker("worker.js");
worker.postMessage({ data: bigArray });
worker.onmessage = (e) => console.log(e.data);
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT LOOP â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. Macrotask (oldest) â†’ 2. ALL microtasks â†’ 3. Render        â”‚
â”‚                                                                 â”‚
â”‚  Macrotask: setTimeout, setInterval, script, I/O              â”‚
â”‚  Microtask: .then/.catch, queueMicrotask, await               â”‚
â”‚                                                                 â”‚
â”‚  Split CPU task: setTimeout(fn, 0) â†’ UI responsive            â”‚
â”‚  Progress bar: cáº§n setTimeout (khÃ´ng queueMicrotask)           â”‚
â”‚  Post-event: setTimeout(fn, 0) sau bubbling                   â”‚
â”‚  Heavy calc: dÃ¹ng Web Workers (parallel thread)                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 51. Async/Await â€” Viáº¿t Async NhÆ° Sync

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASYNC/AWAIT â€” Báº£n Äá»“ Tá»•ng Quan                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  async function: LUÃ”N tráº£ Promise                              â”‚
â”‚  await: suspends execution, chá» promise settle                â”‚
â”‚  âš ï¸ await CHá»ˆ dÃ¹ng trong async function                       â”‚
â”‚                                                                 â”‚
â”‚  Error: await reject â†’ throw (dÃ¹ng try..catch)                â”‚
â”‚  KhÃ´ng try..catch â†’ .catch() ngoÃ i hoáº·c unhandled              â”‚
â”‚                                                                 â”‚
â”‚  await + Promise.all â†’ parallelize                            â”‚
â”‚  Top-level await (ES modules)                                  â”‚
â”‚  await cháº¥p nháº­n Thenable objects                              â”‚
â”‚  async class methods                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Async Functions & Await

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// async: function LUÃ”N tráº£ Promise
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function f() {
  return 1; // auto-wrapped: Promise.resolve(1)
}
f().then(alert); // 1

// TÆ°Æ¡ng Ä‘Æ°Æ¡ng:
async function f() {
  return Promise.resolve(1);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// await: suspends, chá» promise settle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function f() {
  let promise = new Promise(resolve => {
    setTimeout(() => resolve("done!"), 1000);
  });

  let result = await promise; // táº¡m dá»«ng Ä‘áº¿n khi resolve!
  alert(result); // "done!"
}
// await KHÃ”NG tá»‘n CPU â€” engine lÃ m viá»‡c khÃ¡c trong khi chá»

// âš ï¸ KHÃ”NG dÃ¹ng await trong regular function:
function f() {
  let result = await Promise.resolve(1); // âŒ SyntaxError!
}
```

### showAvatar Rewrite & Top-Level Await

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise chain â†’ async/await (dá»… Ä‘á»c hÆ¡n ráº¥t nhiá»u!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function showAvatar() {
  let response = await fetch("/user.json");
  let user = await response.json();

  let githubResponse = await fetch(`https://api.github.com/users/${user.name}`);
  let githubUser = await githubResponse.json();

  let img = document.createElement("img");
  img.src = githubUser.avatar_url;
  document.body.append(img);

  await new Promise((resolve) => setTimeout(resolve, 3000));
  img.remove();
  return githubUser;
}
// âœ… Dá»… Ä‘á»c nhÆ° sync code!

// Top-level await (ES modules):
// let response = await fetch("/user.json");
// Hoáº·c wrap IIFE náº¿u khÃ´ng dÃ¹ng module:
(async () => {
  let response = await fetch("/user.json");
  let user = await response.json();
})();

// await cháº¥p nháº­n Thenable:
class Thenable {
  constructor(num) {
    this.num = num;
  }
  then(resolve) {
    setTimeout(() => resolve(this.num * 2), 1000);
  }
}
async function f() {
  let result = await new Thenable(1); // chá» 1s
  alert(result); // 2
}

// Async class methods:
class Waiter {
  async wait() {
    return await Promise.resolve(1);
  }
}
new Waiter().wait().then(alert); // 1
```

### Error Handling & Promise.all

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// await reject = throw! DÃ¹ng try..catch
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function f() {
  await Promise.reject(new Error("Whoops!")); // = throw!
}
// giá»‘ng: async function f() { throw new Error("Whoops!"); }

// try..catch báº¯t error:
async function f() {
  try {
    let response = await fetch("http://no-such-url");
    let user = await response.json();
  } catch (err) {
    alert(err); // báº¯t cáº£ fetch vÃ  json errors!
  }
}

// KhÃ´ng try..catch â†’ dÃ¹ng .catch() ngoÃ i:
async function f() {
  let response = await fetch("http://no-such-url");
}
f().catch(alert); // TypeError: failed to fetch

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// await + Promise.all: parallelize!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let results = await Promise.all([fetch(url1), fetch(url2), fetch(url3)]); // chá» táº¥t cáº£ song song!
// Error propagates: try..catch báº¯t Ä‘Æ°á»£c
```

### BÃ i Táº­p: Rewrite & Dangerous Promise.all

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i 1: Rewrite loadJson vá»›i async/await
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadJson(url) {
  let response = await fetch(url);
  if (response.status === 200) {
    return response.json(); // return promise, outer await!
  }
  throw new Error(response.status);
}
loadJson("no-such-user.json").catch(alert); // Error: 404

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i 2: Rethrow vá»›i while loop (khÃ´ng recursion!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class HttpError extends Error {
  constructor(response) {
    super(`${response.status} for ${response.url}`);
    this.name = "HttpError";
    this.response = response;
  }
}

async function demoGithubUser() {
  let user;
  while (true) {
    let name = prompt("Enter name?", "iliakan");
    try {
      user = await loadJson(`https://api.github.com/users/${name}`);
      break; // thÃ nh cÃ´ng â†’ thoÃ¡t loop!
    } catch (err) {
      if (err instanceof HttpError && err.response.status === 404) {
        alert("No such user, reenter.");
      } else {
        throw err; // rethrow unknown!
      }
    }
  }
  alert(`Full name: ${user.name}`);
}
// âœ… while(true) + try/catch + break = Ä‘áº¹p hÆ¡n recursion!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i 3: Gá»i async tá»« non-async
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function wait() {
  await new Promise((resolve) => setTimeout(resolve, 1000));
  return 10;
}
function f() {
  wait().then((result) => alert(result)); // âœ… .then!
}
// KhÃ´ng await Ä‘Æ°á»£c â†’ dÃ¹ng .then() vÃ¬ async fn tráº£ Promise

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÃ i 4: âš ï¸ Dangerous Promise.all
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Promise.all reject ngay khi 1 fail
// NhÆ°ng cÃ¡c promise KHÃC váº«n cháº¡y â†’ uncaught errors!

// Fix 1: customPromiseAll (ignore subsequent)
function customPromiseAll(promises) {
  return new Promise((resolve, reject) => {
    const results = [];
    let count = 0,
      hasError = false;
    promises.forEach((p, i) => {
      p.then((result) => {
        if (hasError) return;
        results[i] = result;
        if (++count === promises.length) resolve(results);
      }).catch((err) => {
        if (hasError) return;
        hasError = true;
        reject(err);
      });
    });
  });
}

// Fix 2: chá» Táº¤T Cáº¢ settle trÆ°á»›c khi reject
function customPromiseAllWait(promises) {
  return new Promise((resolve, reject) => {
    const results = new Array(promises.length);
    let settled = 0,
      firstError = null;
    promises.forEach((p, i) => {
      Promise.resolve(p)
        .then((r) => {
          results[i] = r;
        })
        .catch((e) => {
          if (!firstError) firstError = e;
        })
        .finally(() => {
          if (++settled === promises.length) {
            firstError ? reject(firstError) : resolve(results);
          }
        });
    });
  });
}
```

### Tá»•ng Há»£p: Async/Await

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASYNC/AWAIT â€” SUMMARY                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  async fn: luÃ´n tráº£ Promise, cho phÃ©p await                   â”‚
â”‚  await: suspend, chá» settle, reject = throw                  â”‚
â”‚  Error: try..catch hoáº·c .catch() ngoÃ i                        â”‚
â”‚                                                                 â”‚
â”‚  await + Promise.all = parallelize                             â”‚
â”‚  Top-level await trong ES modules                              â”‚
â”‚  Gá»i async tá»« non-async: fn().then(...)                       â”‚
â”‚  âš ï¸ Promise.all: cÃ¡c promise khÃ¡c váº«n cháº¡y khi 1 fail        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 52. Browser Environment & Specs

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER ENVIRONMENT                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚               window (global object)                            â”‚
â”‚              /        |        \                                â”‚
â”‚           DOM        BOM      JavaScript                      â”‚
â”‚         (document)  (navigator,  (Object, Array,              â”‚
â”‚                      location,    Function...)                 â”‚
â”‚                      alert...)                                  â”‚
â”‚                                                                 â”‚
â”‚  Specs:                                                         â”‚
â”‚  â€¢ DOM: dom.spec.whatwg.org                                    â”‚
â”‚  â€¢ CSSOM: w3.org/TR/cssom-1                                    â”‚
â”‚  â€¢ HTML: html.spec.whatwg.org (bao gá»“m BOM)                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Window, DOM, CSSOM

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// window: 2 vai trÃ² â€” global object + browser window
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function sayHi() {
  alert("Hello");
}
window.sayHi(); // global functions = methods cá»§a window

alert(window.innerHeight); // chiá»u cao cá»­a sá»• browser

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM: Document Object Model â€” page content as objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// document = entry point! Táº¥t cáº£ page content = objects
document.body.style.background = "red";
setTimeout(() => (document.body.style.background = ""), 1000);

// DOM khÃ´ng chá»‰ cho browser! Server-side cÅ©ng dÃ¹ng
// Spec: DOM Living Standard (dom.spec.whatwg.org)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CSSOM: CSS Object Model â€” CSS rules as objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Biá»ƒu diá»…n CSS rules nhÆ° objects, Ä‘á»c/ghi
// DÃ¹ng cÃ¹ng DOM khi modify style rules
// Hiáº¿m khi cáº§n trá»±c tiáº¿p (thÆ°á»ng add/remove CSS classes)
// Spec: w3.org/TR/cssom-1
```

### BOM & Specifications

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BOM: Browser Object Model â€” ngoÃ i document
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// navigator: thÃ´ng tin browser & OS
navigator.userAgent; // browser info
navigator.platform; // Windows/Linux/Mac

// location: URL hiá»‡n táº¡i, redirect
alert(location.href); // current URL
location.href = "https://wikipedia.org"; // redirect!

// alert/confirm/prompt cÅ©ng lÃ  BOM!
// KhÃ´ng liÃªn quan trá»±c tiáº¿p document, lÃ  browser methods

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3 SPECS CHÃNH:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. DOM spec: cáº¥u trÃºc document, thao tÃ¡c, events
//    dom.spec.whatwg.org

// 2. CSSOM spec: stylesheets, style rules, binding
//    w3.org/TR/cssom-1

// 3. HTML spec: HTML tags + BOM (setTimeout, alert, location...)
//    html.spec.whatwg.org
//    Láº¥y DOM spec vÃ  má»Ÿ rá»™ng vá»›i nhiá»u properties/methods

// TÃ¬m kiáº¿m: "WHATWG [term]" hoáº·c "MDN [term]"
// MDN: developer.mozilla.org â€” dá»… Ä‘á»c, thá»±c táº¿
// Spec: chi tiáº¿t hÆ¡n, fundamental
```

### Tá»•ng Há»£p: Browser Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER ENVIRONMENT â€” SUMMARY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  window: global object + browser window                        â”‚
â”‚  DOM: document â€” page content lÃ  objects, thao tÃ¡c            â”‚
â”‚  CSSOM: CSS rules lÃ  objects (hiáº¿m khi dÃ¹ng trá»±c tiáº¿p)       â”‚
â”‚  BOM: navigator, location, alert/confirm/prompt               â”‚
â”‚                                                                 â”‚
â”‚  3 Specs: DOM (whatwg) + CSSOM (w3) + HTML (whatwg, bao BOM)   â”‚
â”‚  TÃ¬m: MDN (Ä‘á»c nhanh) hoáº·c Spec (chi tiáº¿t)                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 53. DOM Tree â€” Cáº¥u TrÃºc CÃ¢y DOM

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOM TREE                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  HTML â†’ DOM Tree: má»i thá»© lÃ  NODE                              â”‚
â”‚                                                                 â”‚
â”‚  4 loáº¡i node thÆ°á»ng dÃ¹ng (trong 12):                           â”‚
â”‚  â€¢ document â€” entry point                                      â”‚
â”‚  â€¢ element nodes â€” HTML tags                                   â”‚
â”‚  â€¢ text nodes â€” ná»™i dung vÄƒn báº£n (ká»ƒ cáº£ spaces/newlines)    â”‚
â”‚  â€¢ comment nodes â€” <!-- -->                                    â”‚
â”‚                                                                 â”‚
â”‚  Autocorrect: browser tá»± sá»­a HTML lá»—i                          â”‚
â”‚  <table> luÃ´n cÃ³ <tbody> (tá»± thÃªm!)                           â”‚
â”‚  Spaces/newlines trÆ°á»›c <head> bá»‹ ignore                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DOM Tree Structure & Text Nodes

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HTML â†’ DOM Tree: tags = element nodes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// <html>
//   <head>
//     <title>About elk</title>
//   </head>
//   <body>
//     The truth about elk.
//   </body>
// </html>

// DOM Tree:
// â–¾ HTML
//   â–¾ HEAD
//     #text â†µâ£â£
//     â–¾ TITLE
//       #text "About elk"
//     #text â†µ
//   #text â†µ
//   â–¾ BODY
//     #text "â†µâ£â£The truth about elk.â†µ"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Text nodes: SPACES vÃ  NEWLINES cÅ©ng lÃ  nodes!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// \n (newline) vÃ  spaces táº¡o text nodes trong DOM
// 2 ngoáº¡i lá»‡:
// 1. Spaces/newlines TRÆ¯á»œC <head> bá»‹ IGNORE
// 2. Ná»™i dung SAU </body> tá»± chuyá»ƒn vÃ o body

// KhÃ´ng cÃ³ space-only text nodes:
// <html><head><title>About</title></head><body>Text</body></html>
// â†’ DOM gá»n hÆ¡n, khÃ´ng cÃ³ #text whitespace

// DevTools áº©n space-only text nodes Ä‘á»ƒ tiáº¿t kiá»‡m khÃ´ng gian
```

### Autocorrection & Node Types

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Autocorrection: browser tá»± sá»­a HTML lá»—i!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// File chá»‰ cÃ³ "Hello" â†’ browser tá»± thÃªm:
// <html><head></head><body>Hello</body></html>

// Tags khÃ´ng Ä‘Ã³ng: <p>Hello <li>Mom <li>Dad
// â†’ Browser tá»± Ä‘Ã³ng tags, táº¡o DOM há»£p lá»‡

// âš ï¸ TABLE luÃ´n cÃ³ <tbody> (tá»± thÃªm!):
// <table><tr><td>1</td></tr></table>
// DOM: TABLE â†’ TBODY â†’ TR â†’ TD â†’ #text "1"
// Cáº©n tháº­n khi query table elements!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 12 node types, 4 thÆ°á»ng dÃ¹ng:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. document          â€” entry point vÃ o DOM
// 2. element nodes     â€” HTML tags (<div>, <p>...)
// 3. text nodes        â€” ná»™i dung text (ká»ƒ cáº£ spaces)
// 4. comment nodes     â€” <!-- comment -->

// Má»i thá»© trong HTML Ä‘á»u vÃ o DOM, ká»ƒ cáº£ comments!
// <!DOCTYPE> cÅ©ng lÃ  DOM node (trÆ°á»›c <html>)
// document cÅ©ng lÃ  1 DOM node

// Comments cÃ³ thá»ƒ chá»©a data Ä‘á»ƒ JS Ä‘á»c:
// <!-- config: {theme: "dark"} -->
// JS cÃ³ thá»ƒ Ä‘á»c: node.nodeValue hoáº·c node.data
```

### DevTools & Console Interaction

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DevTools Elements tab:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Elements tab: DOM structure (simplified, áº©n whitespace)
// Styles subtab: CSS rules cho element
// Computed subtab: CSS tÃ­nh toÃ¡n cuá»‘i cÃ¹ng
// Event Listeners subtab: event handlers

// Console interaction:
// Chá»n element trong Elements tab
// $0 = element vá»«a chá»n, $1 = element trÆ°á»›c Ä‘Ã³
$0.style.background = "red"; // style element Ä‘Ã£ chá»n!

// NgÆ°á»£c láº¡i: tá»« Console â†’ Elements:
inspect(document.body); // scroll Ä‘áº¿n element trong Elements

// Hoáº·c output DOM node trong console:
console.log(document.body); // khÃ¡m phÃ¡ properties
```

### Tá»•ng Há»£p: DOM Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOM TREE â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Tags â†’ element nodes, text â†’ text nodes                     â”‚
â”‚  Comments, DOCTYPE Ä‘á»u lÃ  DOM nodes                            â”‚
â”‚  Spaces/newlines = text nodes (Ä‘á»«ng quÃªn!)                    â”‚
â”‚                                                                 â”‚
â”‚  Autocorrect: browser sá»­a HTML lá»—i, thÃªm <tbody>               â”‚
â”‚  DevTools: $0 = selected, inspect(node) â†’ Elements             â”‚
â”‚  12 node types, 4 thá»±c táº¿: document/element/text/comment      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 54. Walking the DOM â€” Di Chuyá»ƒn Trong DOM

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WALKING THE DOM                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  All nodes:        Element-only:                                â”‚
â”‚  parentNode        parentElement                                â”‚
â”‚  childNodes        children                                     â”‚
â”‚  firstChild        firstElementChild                            â”‚
â”‚  lastChild         lastElementChild                             â”‚
â”‚  previousSibling   previousElementSibling                      â”‚
â”‚  nextSibling       nextElementSibling                           â”‚
â”‚                                                                 â”‚
â”‚  Top-level: document.documentElement / .body / .head           â”‚
â”‚  âš ï¸ document.body cÃ³ thá»ƒ null (script trong <head>)           â”‚
â”‚  Table: table.rows, tr.cells, td.cellIndex                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Top-Level Nodes & Children

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Top-level: document.documentElement / .body / .head
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.documentElement; // <html>
document.body; // <body> (âš ï¸ cÃ³ thá»ƒ null!)
document.head; // <head>

// âš ï¸ document.body = null náº¿u script trong <head>:
// <head><script>alert(document.body)</script></head>
// â†’ null! Browser chÆ°a Ä‘á»c <body>
// null trong DOM = "khÃ´ng tá»“n táº¡i"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Children: childNodes, firstChild, lastChild
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// children = direct children (con trá»±c tiáº¿p)
// descendants = táº¥t cáº£ nested (con chÃ¡u)

// childNodes: Táº¤T Cáº¢ child nodes (bao gá»“m text!)
for (let i = 0; i < document.body.childNodes.length; i++) {
  alert(document.body.childNodes[i]); // Text, DIV, Text, UL...
}

// Shortcuts:
elem.childNodes[0] === elem.firstChild; // true
elem.childNodes[elem.childNodes.length - 1] === elem.lastChild; // true
elem.hasChildNodes(); // kiá»ƒm tra cÃ³ con khÃ´ng
```

### DOM Collections & Siblings

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM Collections: array-like, iterable, LIVE, READ-ONLY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… for..of (iterable, cÃ³ Symbol.iterator)
for (let node of document.body.childNodes) {
  alert(node);
}

// âŒ Array methods khÃ´ng cÃ³!
document.body.childNodes.filter; // undefined!
// âœ… Fix: Array.from()
Array.from(document.body.childNodes).filter((n) => n.nodeType === 1);

// LIVE: thÃªm/xÃ³a node â†’ collection tá»± cáº­p nháº­t
// READ-ONLY: khÃ´ng childNodes[i] = ... Ä‘Æ°á»£c!
// âš ï¸ KHÃ”NG dÃ¹ng for..in (láº¥y cáº£ extra properties!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Siblings & Parent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.body.parentNode === document.documentElement; // true
document.head.nextSibling; // HTMLBodyElement
document.body.previousSibling; // HTMLHeadElement
```

### Element-Only Navigation & Table

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Element-only: bá» qua text/comment nodes!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// children            (chá»‰ element nodes)
// firstElementChild   / lastElementChild
// previousElementSibling / nextElementSibling
// parentElement

for (let elem of document.body.children) {
  alert(elem); // DIV, UL, DIV, SCRIPT (khÃ´ng text!)
}

// parentElement vs parentNode:
document.documentElement.parentNode; // document
document.documentElement.parentElement; // null!
// â†’ document khÃ´ng pháº£i element! parentElement tráº£ null

// Äi lÃªn Ä‘áº¿n <html> (khÃ´ng lÃªn document):
while ((elem = elem.parentElement)) {
  alert(elem);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Table navigation: thuá»™c tÃ­nh Ä‘áº·c biá»‡t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// table.rows           â†’ collection cá»§a <tr>
// table.caption/tHead/tFoot
// table.tBodies        â†’ collection cá»§a <tbody>
// tbody.rows           â†’ <tr> trong tbody
// tr.cells             â†’ <td>/<th> trong <tr>
// tr.rowIndex          â†’ index trong toÃ n table
// tr.sectionRowIndex   â†’ index trong section
// td.cellIndex         â†’ index trong <tr>

let td = table.rows[0].cells[1]; // row 0, cell 1
td.style.backgroundColor = "red";

// BÃ i táº­p: tÃ´ Ä‘Æ°á»ng chÃ©o table
for (let i = 0; i < table.rows.length; i++) {
  table.rows[i].cells[i].style.backgroundColor = "red";
}
```

### Tá»•ng Há»£p: Walking the DOM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WALKING THE DOM â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  All: parentNode, childNodes, first/lastChild, prev/nextSib   â”‚
â”‚  Element: parentElement, children, first/lastElementChild     â”‚
â”‚           prev/nextElementSibling                              â”‚
â”‚                                                                 â”‚
â”‚  childNodes: array-like, LIVE, READ-ONLY, dÃ¹ng for..of       â”‚
â”‚  âš ï¸ document.body cÃ³ thá»ƒ null (script á»Ÿ <head>)               â”‚
â”‚  Table: rows, cells, rowIndex, cellIndex                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 55. Searching: getElement*, querySelector*

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SEARCHING DOM                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Method              Searches   On elem?  Live?                â”‚
â”‚  querySelector       CSS sel    âœ…         âŒ (static)           â”‚
â”‚  querySelectorAll    CSS sel    âœ…         âŒ (static)           â”‚
â”‚  getElementById      id         âŒ (doc)   âŒ                    â”‚
â”‚  getElementsByName   name       âŒ (doc)   âœ… (live)             â”‚
â”‚  getElementsByTag*   tag        âœ…         âœ… (live)             â”‚
â”‚  getElementsByClass* class      âœ…         âœ… (live)             â”‚
â”‚                                                                 â”‚
â”‚  matches(css): kiá»ƒm tra elem khá»›p selector                    â”‚
â”‚  closest(css): tá»• tiÃªn gáº§n nháº¥t khá»›p selector                â”‚
â”‚  contains(elem): kiá»ƒm tra cha-con                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### getElementById & querySelector

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// getElementById: chá»‰ gá»i trÃªn document, id pháº£i unique
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let elem = document.getElementById("elem");
elem.style.background = "red";

// âš ï¸ id táº¡o global variable (nhÆ°ng Ä‘á»«ng dÃ¹ng!)
// elem.style... hoáº¡t Ä‘á»™ng nhÆ°ng khÃ´ng rÃµ nguá»“n biáº¿n
// âš ï¸ JS variable cÃ¹ng tÃªn sáº½ override:
// let elem = 5; // giá» elem = 5, khÃ´ng pháº£i DOM!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// querySelectorAll: máº¡nh nháº¥t! DÃ¹ng CSS selector
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Tráº£ STATIC collection (khÃ´ng live!)
let items = document.querySelectorAll("ul > li:last-child");
for (let elem of items) {
  alert(elem.innerHTML);
}

// CÃ³ thá»ƒ dÃ¹ng pseudo-classes:
document.querySelectorAll(":hover"); // elements Ä‘ang hover

// querySelector: chá»‰ pháº§n tá»­ Äáº¦U TIÃŠN (nhanh hÆ¡n!)
let first = document.querySelector("div.article");
// = querySelectorAll("div.article")[0] nhÆ°ng nhanh hÆ¡n
```

### matches, closest & getElementsBy\*

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// matches: kiá»ƒm tra elem khá»›p CSS selector
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

for (let elem of document.body.children) {
  if (elem.matches('a[href$="zip"]')) {
    alert("Archive: " + elem.href); // chá»‰ láº¥y .zip links!
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// closest: tá»• tiÃªn gáº§n nháº¥t khá»›p selector (bao gá»“m chÃ­nh nÃ³)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let chapter = document.querySelector(".chapter"); // LI
chapter.closest(".book"); // UL
chapter.closest(".contents"); // DIV
chapter.closest("h1"); // null (h1 khÃ´ng pháº£i ancestor!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// getElementsBy*: LIVE collections! (cÅ© nhÆ°ng váº«n gáº·p)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let divs = document.getElementsByTagName("div"); // LIVE!
let arts = form.getElementsByClassName("article"); // LIVE!
let forms = document.getElementsByName("my-form"); // LIVE!

// âš ï¸ Äá»«ng quÃªn chá»¯ "s"!
// getElementByTagName âŒ â†’ getElementsByTagName âœ…

// âš ï¸ Tráº£ collection, khÃ´ng pháº£i element!
// document.getElementsByTagName("input").value = 5; âŒ
// document.getElementsByTagName("input")[0].value = 5; âœ…

// contains: kiá»ƒm tra cha-con
elemA.contains(elemB); // true náº¿u elemB trong elemA
```

### Live vs Static Collections

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// getElementsBy* = LIVE â†’ tá»± cáº­p nháº­t!
// querySelectorAll = STATIC â†’ snapshot!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// LIVE: getElementsByTagName
// <div>First</div>
let divs = document.getElementsByTagName("div");
alert(divs.length); // 1
// <div>Second</div> (thÃªm vÃ o DOM)
alert(divs.length); // 2 âœ”ï¸ tá»± cáº­p nháº­t!

// STATIC: querySelectorAll
let divs2 = document.querySelectorAll("div");
alert(divs2.length); // 1
// <div>Second</div> (thÃªm vÃ o DOM)
alert(divs2.length); // 1 âœ”ï¸ váº«n 1 (snapshot!)

// BÃ i táº­p: tÃ¬m elements
// document.getElementById("age-table")
// table.getElementsByTagName("label")     // 3 labels
// table.querySelector("td")               // first td
// document.getElementsByName("search")[0]  // form
// form.querySelector("input")             // first input
// form.querySelectorAll("input")          // láº¥y last báº±ng [length-1]
```

### Tá»•ng Há»£p: Searching DOM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SEARCHING DOM â€” SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â­ querySelector / querySelectorAll: máº¡nh nháº¥t, STATIC       â”‚
â”‚  getElementById: nhanh, chá»‰ document, id unique                â”‚
â”‚  getElementsBy*: LIVE, legacy nhÆ°ng váº«n gáº·p                   â”‚
â”‚                                                                 â”‚
â”‚  matches(css): elem khá»›p selector? true/false                 â”‚
â”‚  closest(css): ancestor gáº§n nháº¥t (bao gá»“m chÃ­nh nÃ³)          â”‚
â”‚  contains(elem): kiá»ƒm tra cha-con                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 56. Node Properties: type, tag and contents

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE PROPERTIES                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Hierarchy: EventTarget â†’ Node â†’ Element â†’ HTMLElement       â”‚
â”‚            â†’ HTMLInputElement / HTMLAnchorElement...            â”‚
â”‚                                                                 â”‚
â”‚  nodeType: 1=element, 3=text, 9=document (read-only)           â”‚
â”‚  tagName/nodeName: tag (uppercase HTML), nodeName cho má»i nodeâ”‚
â”‚  innerHTML: HTML content (r/w, âš ï¸ += full overwrite)           â”‚
â”‚  outerHTML: full HTML (âš ï¸ write khÃ´ng thay Ä‘á»•i biáº¿n!)         â”‚
â”‚  textContent: pure text, safe insert (khÃ´ng HTML)             â”‚
â”‚  data/nodeValue: ná»™i dung text/comment node                    â”‚
â”‚  hidden: áº©n element (= display:none)                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DOM Class Hierarchy & nodeType

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM Class Hierarchy:
// EventTarget â†’ Node â†’ Document
//                    â†’ CharacterData â†’ Text / Comment
//                    â†’ Element â†’ HTMLElement â†’ concrete
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥: <input> káº¿ thá»«a:
// HTMLInputElement â†’ HTMLElement â†’ Element
// â†’ Node â†’ EventTarget â†’ Object

alert(document.body.constructor.name); // HTMLBodyElement
alert(document.body instanceof HTMLElement); // true
alert(document.body instanceof Node); // true
alert(document.body instanceof EventTarget); // true

// console.log(elem): hiá»ƒn DOM tree
// console.dir(elem): hiá»ƒn JS object (xem properties)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// nodeType: giÃ¡ trá»‹ sá»‘ (read-only, cÅ© nhÆ°ng tiá»‡n)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.nodeType === 1; // element node
elem.nodeType === 3; // text node
document.nodeType === 9; // document node
// Hiá»‡n Ä‘áº¡i: dÃ¹ng instanceof, nhÆ°ng nodeType Ä‘Ã´i khi tiá»‡n hÆ¡n
```

### Tag, innerHTML & outerHTML

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// tagName vs nodeName:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.body.tagName; // "BODY" (uppercase trong HTML mode)
document.body.nodeName; // "BODY" (giá»‘ng tagName cho elements)

// tagName: CHá»ˆ cho Element nodes
// nodeName: cho Má»ŒcI node type
document.body.firstChild.tagName; // undefined (text node!)
document.body.firstChild.nodeName; // "#text"
document.nodeName; // "#document"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// innerHTML: Ä‘á»c/ghi HTML content bÃªn trong element
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(document.body.innerHTML); // Ä‘á»c
document.body.innerHTML = "The new BODY!"; // ghi

// Browser sá»­a HTML lá»—i:
document.body.innerHTML = "<b>test"; // â†’ <b>test</b>

// âš ï¸ <script> chÃ¨n qua innerHTML KHÃ”NG execute!

// âš ï¸âš ï¸ innerHTML += lÃ  FULL OVERWRITE!
chatDiv.innerHTML += "<div>Hello!</div>";
// = chatDiv.innerHTML = chatDiv.innerHTML + "..."
// â†’ XÃ³a toÃ n bá»™ ná»™i dung cÅ© rá»“i ghi láº¡i!
// â†’ Images reload, input values máº¥t, selection máº¥t!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// outerHTML: full HTML cá»§a element (bao gá»“m chÃ­nh nÃ³)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(elem.outerHTML); // "<div id='elem'>Hello <b>World</b></div>"

// âš ï¸âš ï¸ outerHTML = ... KHÃ”NG thay Ä‘á»•i biáº¿n!
let div = document.querySelector("div");
div.outerHTML = "<p>New</p>";
// DOM: <p>New</p> thay tháº¿ <div>
// NhÆ°ng: div váº«n giá»¯ giÃ¡ trá»‹ cÅ©! (detached)
alert(div.outerHTML); // váº«n <div>Hello, world!</div>
```

### textContent, data & hidden

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// nodeValue / data: ná»™i dung text/comment node
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let text = document.body.firstChild;
alert(text.data); // "Hello" (ná»™i dung text node)

let comment = text.nextSibling;
alert(comment.data); // "Comment" (ná»™i dung comment)
// DÃ¹ng cho template instructions trong HTML comments

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// textContent: pure text (khÃ´ng HTML), AN TOÃ€N!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(news.textContent); // chá»‰ text, khÃ´ng tags

// So sÃ¡nh:
let name = "<b>Hacker!</b>";
elem1.innerHTML = name; // â†’ render HTML: Hacker! (bold)
elem2.textContent = name; // â†’ hiá»ƒn raw: <b>Hacker!</b>
// âœ… textContent an toÃ n cho user input!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// hidden: áº©n element (= CSS display:none)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.hidden = true; // áº©n
elem.hidden = false; // hiá»‡n

// Blinking effect:
setInterval(() => (elem.hidden = !elem.hidden), 1000);

// Class-specific properties:
// input.value, input.type, a.href, elem.id ...
alert(input.type); // "text"
alert(input.value); // giÃ¡ trá»‹ hiá»‡n táº¡i
alert(a.href); // full URL
```

### Tá»•ng Há»£p: Node Properties

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NODE PROPERTIES â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Hierarchy: EventTarget â†’ Node â†’ Element â†’ HTMLElement       â”‚
â”‚  nodeType: 1/3/9 (element/text/document), read-only            â”‚
â”‚  tagName: element only (uppercase). nodeName: má»i node        â”‚
â”‚                                                                 â”‚
â”‚  innerHTML: HTML content (r/w), âš ï¸ += full overwrite           â”‚
â”‚  outerHTML: full HTML, âš ï¸ write khÃ´ng thay Ä‘á»•i variable       â”‚
â”‚  textContent: pure text, an toÃ n cho user input                â”‚
â”‚  data: ná»™i dung text/comment node                               â”‚
â”‚  hidden: áº©n element (= display:none)                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 57. Modifying the Document â€” Thay Äá»•i DOM

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MODIFYING THE DOCUMENT                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Táº¡o: createElement(tag), createTextNode(text)                 â”‚
â”‚  ChÃ¨n: append / prepend / before / after / replaceWith        â”‚
â”‚  HTML: insertAdjacentHTML(where, html)                         â”‚
â”‚        beforebegin / afterbegin / beforeend / afterend         â”‚
â”‚  XÃ³a: node.remove()                                            â”‚
â”‚  Clone: cloneNode(true/false)                                  â”‚
â”‚  Di chuyá»ƒn: insert tá»± remove khá»i vá»‹ trÃ­ cÅ©                  â”‚
â”‚  âš ï¸ document.write: chá»‰ khi page Ä‘ang load!                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡o Element & ChÃ¨n VÃ o DOM

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o nodes:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let div = document.createElement("div");       // táº¡o element
let textNode = document.createTextNode("Hi");   // táº¡o text node

div.className = "alert";
div.innerHTML = "<strong>Hi!</strong> Important message.";
// ChÆ°a trong DOM! Chá»‰ lÃ  biáº¿n JS.

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Insertion methods (modern):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

node.append(...nodes or strings);   // cuá»‘i node
node.prepend(...nodes or strings);  // Ä‘áº§u node
node.before(...nodes or strings);   // trÆ°á»›c node
node.after(...nodes or strings);    // sau node
node.replaceWith(...nodes or strings); // thay tháº¿ node

document.body.append(div); // thÃªm vÃ o cuá»‘i body

// Strings chÃ¨n nhÆ° TEXT (safe!), khÃ´ng pháº£i HTML
ol.before("before"); // text "before" trÆ°á»›c <ol>
ol.after("after");   // text "after" sau <ol>
```

### insertAdjacentHTML & Remove/Clone

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// insertAdjacentHTML: chÃ¨n HTML string!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 4 positions:
//   "beforebegin"  â†’ trÆ°á»›c elem
//   "afterbegin"   â†’ Ä‘áº§u trong elem
//   "beforeend"    â†’ cuá»‘i trong elem
//   "afterend"     â†’ sau elem

div.insertAdjacentHTML("beforebegin", "<p>Hello</p>");
div.insertAdjacentHTML("afterend", "<p>Bye</p>");

// CÅ©ng cÃ³: insertAdjacentText, insertAdjacentElement
// NhÆ°ng thá»±c táº¿ chá»‰ insertAdjacentHTML hay dÃ¹ng

// Thay tháº¿ cho innerHTML += (Ä‘á»«ng full overwrite!):
document.body.insertAdjacentHTML("beforeend", "<div>New</div>");

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Remove & Clone:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

node.remove(); // xÃ³a node khá»i DOM
setTimeout(() => div.remove(), 1000); // xÃ³a sau 1s

// Di chuyá»ƒn: insert Tá»° remove khá»i vá»‹ trÃ­ cÅ©!
second.after(first); // khÃ´ng cáº§n gá»i remove trÆ°á»›c!

// Clone:
let div2 = div.cloneNode(true); // deep clone (vá»›i children)
let div3 = div.cloneNode(false); // shallow (khÃ´ng children)
div2.querySelector("strong").innerHTML = "Bye!";
div.after(div2); // chÃ¨n clone sau original
```

### DocumentFragment & Old-School Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DocumentFragment: wrapper node (ná»™i dung "blend in")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fragment = new DocumentFragment();
for (let i = 1; i <= 3; i++) {
  let li = document.createElement("li");
  li.append(i);
  fragment.append(li);
}
ul.append(fragment); // chá»‰ children Ä‘Æ°á»£c chÃ¨n!

// Thá»±c táº¿ Ã­t dÃ¹ng, thay báº±ng array:
ul.append(...getListContent()); // spread array of nodes

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Old-school methods (tráº£ vá» node, váº«n gáº·p trong code cÅ©):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

parent.appendChild(node); // = append
parent.insertBefore(node, nextSibling); // chÃ¨n trÆ°á»›c sibling
parent.removeChild(node); // = remove
parent.replaceChild(newElem, oldChild); // = replaceWith

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ document.write: chá»‰ dÃ¹ng khi page Ä‘ang LOAD!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.write("<b>Hello</b>"); // ghi trá»±c tiáº¿p vÃ o HTML
// âš ï¸ Gá»i SAU page load â†’ XÃ“A TOÃ€N Bá»˜ document!
// Nhanh vÃ¬ khÃ´ng modify DOM, ghi tháº³ng vÃ o HTML stream
// Chá»‰ tháº¥y trong scripts cÅ©

// BÃ i táº­p: clear element
function clear(elem) {
  while (elem.firstChild) elem.firstChild.remove();
  // hoáº·c: elem.innerHTML = "";
}

// BÃ i táº­p: sort table
let sorted = Array.from(table.tBodies[0].rows).sort((a, b) =>
  a.cells[0].innerHTML.localeCompare(b.cells[0].innerHTML),
);
table.tBodies[0].append(...sorted); // re-insert tá»± remove cÅ©
```

### Tá»•ng Há»£p: Modifying the Document

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MODIFYING DOCUMENT â€” SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Táº¡o: createElement(tag), createTextNode(text)                 â”‚
â”‚  ChÃ¨n: append/prepend/before/after/replaceWith (text safe)     â”‚
â”‚  HTML: insertAdjacentHTML (beforebegin â†’ afterend)            â”‚
â”‚  XÃ³a: node.remove(). Di chuyá»ƒn: insert tá»± remove             â”‚
â”‚  Clone: cloneNode(true) deep, cloneNode(false) shallow        â”‚
â”‚  Old: appendChild, insertBefore, removeChild, replaceChild    â”‚
â”‚  âš ï¸ document.write: chá»‰ khi loading, sau Ä‘Ã³ xÃ³a document     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 58. Styles and Classes â€” Styles vÃ  Class

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STYLES AND CLASSES                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Æ¯u tiÃªn CSS class > inline style                              â”‚
â”‚  className: toÃ n bá»™ string class (thay tháº¿ háº¿t)               â”‚
â”‚  classList: add/remove/toggle/contains (tá»«ng class)            â”‚
â”‚  elem.style: camelCase, âš ï¸ cáº§n Ä‘Æ¡n vá»‹ (px, %)                â”‚
â”‚  Reset style: gÃ¡n "" hoáº·c removeProperty()                     â”‚
â”‚  style.cssText: ghi Ä‘Ã¨ toÃ n bá»™ inline style                   â”‚
â”‚  getComputedStyle(elem): Ä‘á»c resolved styles (read-only)       â”‚
â”‚  âš ï¸ :visited styles bá»‹ áº©n vÃ¬ báº£o máº­t                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### className & classList

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// className: toÃ n bá»™ class string
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

alert(document.body.className); // "main page"
document.body.className = "new-class"; // THAY THáº¾ Háº¾T!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// classList: thao tÃ¡c tá»«ng class riÃªng láº»
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.classList.add("active"); // thÃªm class
elem.classList.remove("active"); // xÃ³a class
elem.classList.toggle("active"); // thÃªm/xÃ³a (toggle)
elem.classList.contains("active"); // kiá»ƒm tra â†’ true/false

// classList lÃ  iterable:
for (let name of document.body.classList) {
  alert(name); // liá»‡t kÃª tá»«ng class
}

// ThÃªm nhiá»u class cÃ¹ng lÃºc:
elem.classList.add("foo", "bar");
elem.classList.remove("foo", "bar");
```

### elem.style & getComputedStyle

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// elem.style: inline styles (camelCase)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.style.backgroundColor = "red"; // background-color
elem.style.zIndex = "1000"; // z-index
elem.style.borderLeftWidth = "2px"; // border-left-width

// Browser-prefixed:
button.style.MozBorderRadius = "5px";
button.style.WebkitBorderRadius = "5px";

// âš ï¸ PHáº¢I cÃ³ Ä‘Æ¡n vá»‹!
elem.style.margin = 20; // âŒ khÃ´ng hoáº¡t Ä‘á»™ng!
elem.style.margin = "20px"; // âœ… Ä‘Ãºng

// Reset style: gÃ¡n empty string
elem.style.display = "none"; // áº©n
elem.style.display = ""; // vá» máº·c Ä‘á»‹nh (CSS class Ã¡p dá»¥ng láº¡i)
elem.style.removeProperty("background"); // xÃ³a property

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// style.cssText: ghi Ä‘Ã¨ TOÃ€N Bá»˜ inline style
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

div.style.cssText = `
  color: red !important;
  background-color: yellow;
  width: 100px;
`;
// âš ï¸ XÃ³a styles cÅ©! Chá»‰ dÃ¹ng cho elements má»›i.
// TÆ°Æ¡ng Ä‘Æ°Æ¡ng: div.setAttribute("style", "...")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// getComputedStyle: Ä‘á»c RESOLVED styles (read-only)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// elem.style chá»‰ Ä‘á»c inline style, KHÃ”NG tháº¥y CSS class!
let computed = getComputedStyle(document.body);
alert(computed.marginTop); // "5px" (resolved, khÃ´ng "1em")
alert(computed.color); // "rgb(255, 0, 0)"

// Pseudo-element:
let style = getComputedStyle(elem, "::before");
alert(style.content);

// âš ï¸ LuÃ´n dÃ¹ng FULL property name:
getComputedStyle(elem).marginTop; // âœ…
getComputedStyle(elem).margin; // âŒ khÃ´ng Ä‘áº£m báº£o

// âš ï¸ :visited styles bá»‹ áº©n vÃ¬ báº£o máº­t!
// KhÃ´ng thá»ƒ Ä‘á»c mÃ u :visited links
```

### Tá»•ng Há»£p: Styles and Classes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STYLES AND CLASSES â€” SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  className: full string (thay tháº¿ háº¿t)                         â”‚
â”‚  classList: add/remove/toggle/contains (iterable)              â”‚
â”‚  elem.style: camelCase, cáº§n units (px, %), reset = ""          â”‚
â”‚  style.cssText: ghi Ä‘Ã¨ toÃ n bá»™ inline style                   â”‚
â”‚  getComputedStyle(elem, [pseudo]): resolved styles, read-only  â”‚
â”‚  âš ï¸ elem.style khÃ´ng tháº¥y CSS classes                         â”‚
â”‚  âš ï¸ :visited bá»‹ áº©n, dÃ¹ng full property name                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 59. Introduction to Browser Events â€” Sá»± Kiá»‡n TrÃ¬nh Duyá»‡t

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER EVENTS                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 cÃ¡ch gÃ¡n handler:                                            â”‚
â”‚    1. HTML attribute: onclick="..."                             â”‚
â”‚    2. DOM property: elem.onclick = fn                          â”‚
â”‚    3. addEventListener(event, handler, [options])              â”‚
â”‚                                                                 â”‚
â”‚  addEventListener: nhiá»u handlers, once/capture/passive        â”‚
â”‚  removeEventListener: cáº§n CÃ™NG function reference!             â”‚
â”‚  Event object: type, currentTarget, clientX/Y                  â”‚
â”‚  handleEvent: object lÃ m handler                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event Types & Handler Assignment

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡c loáº¡i events chÃ­nh:
// Mouse: click, contextmenu, mouseover/out, mousedown/up, mousemove
// Keyboard: keydown, keyup
// Form: submit, focus
// Document: DOMContentLoaded
// CSS: transitionend
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡ch 1: HTML attribute (khÃ´ng khuyáº¿n khÃ­ch)
// <input onclick="alert('Click!')" type="button">

// CÃ¡ch 2: DOM property (chá»‰ 1 handler/event)
elem.onclick = function () {
  alert("Thank you");
};
elem.onclick = null; // xÃ³a handler

// âš ï¸ Chá»‰ gÃ¡n function reference, KHÃ”NG gá»i!
elem.onclick = sayThanks; // âœ… Ä‘Ãºng
elem.onclick = sayThanks(); // âŒ sai (gÃ¡n káº¿t quáº£ = undefined)

// âš ï¸ Trong HTML attribute thÃ¬ Cáº¦N ngoáº·c ():
// <input onclick="sayThanks()"> â†’ browser táº¡o: function() { sayThanks(); }

// this trong handler = element Ä‘Ã³:
// <button onclick="alert(this.innerHTML)">Click</button>
```

### addEventListener & removeEventListener

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃ¡ch 3: addEventListener (linh hoáº¡t nháº¥t!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

element.addEventListener(event, handler, [options]);
// options: { once, capture, passive }
// once: true â†’ tá»± xÃ³a sau 1 láº§n
// capture: true â†’ xá»­ lÃ½ á»Ÿ capturing phase
// passive: true â†’ khÃ´ng gá»i preventDefault

// Nhiá»u handlers cho cÃ¹ng event:
elem.addEventListener("click", handler1);
elem.addEventListener("click", handler2); // cáº£ 2 Ä‘á»u cháº¡y!

// Má»™t sá»‘ events CHá»ˆ hoáº¡t Ä‘á»™ng vá»›i addEventListener:
document.addEventListener("DOMContentLoaded", fn); // âœ…
document.onDOMContentLoaded = fn; // âŒ khÃ´ng hoáº¡t Ä‘á»™ng!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// removeEventListener: cáº§n CÃ™NG function reference!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function handler() {
  alert("Thanks!");
}
elem.addEventListener("click", handler);
elem.removeEventListener("click", handler); // âœ… cÃ¹ng reference

// âš ï¸ KHÃ”NG hoáº¡t Ä‘á»™ng:
elem.addEventListener("click", () => alert(1));
elem.removeEventListener("click", () => alert(1)); // âŒ khÃ¡c object!

// âš ï¸ KhÃ´ng dÃ¹ng setAttribute cho handlers:
// document.body.setAttribute("onclick", fn); // âŒ sai!
// DOM property case-sensitive: elem.onclick âœ…, elem.ONCLICK âŒ
```

### Event Object & handleEvent

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Event object: chi tiáº¿t vá» sá»± kiá»‡n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.onclick = function (event) {
  alert(event.type); // "click"
  alert(event.currentTarget); // element cÃ³ handler
  alert(event.clientX); // toáº¡ Ä‘á»™ X (window-relative)
  alert(event.clientY); // toáº¡ Ä‘á»™ Y
};

// event.currentTarget = this (trá»« arrow function)
// HTML: <input onclick="alert(event.type)"> cÅ©ng cÃ³ event

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// handleEvent: object lÃ m handler
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Menu {
  handleEvent(event) {
    let method = "on" + event.type[0].toUpperCase() + event.type.slice(1);
    this[method](event); // dispatch to specific method
  }
  onMousedown() {
    elem.innerHTML = "Pressed";
  }
  onMouseup() {
    elem.innerHTML += "...Released";
  }
}

let menu = new Menu();
elem.addEventListener("mousedown", menu); // gá»i menu.handleEvent
elem.addEventListener("mouseup", menu);

// Æ¯u Ä‘iá»ƒm: tÃ¡ch logic theo event type, dá»… maintain
```

### Tá»•ng Há»£p: Browser Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER EVENTS â€” SUMMARY                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  HTML attr: onclick="..." (khÃ´ng khuyáº¿n khÃ­ch)               â”‚
â”‚  DOM prop: elem.onclick = fn (1 handler/event)                â”‚
â”‚  addEventListener: nhiá»u handlers, once/capture/passive        â”‚
â”‚  removeEventListener: cáº§n cÃ¹ng function reference!             â”‚
â”‚  Event object: type, currentTarget, clientX/Y                  â”‚
â”‚  handleEvent: object handler, dispatch by event type           â”‚
â”‚  âš ï¸ onclick = fn (khÃ´ng ()), setAttribute khÃ´ng dÃ¹ng          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 60. Bubbling and Capturing â€” Ná»•i Bá»t vÃ  Báº¯t Sá»± Kiá»‡n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUBBLING AND CAPTURING                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 phases: Capturing (xuá»‘ng) â†’ Target â†’ Bubbling (lÃªn)       â”‚
â”‚  event.target: element gá»‘c gÃ¢y event (khÃ´ng Ä‘á»•i)             â”‚
â”‚  event.currentTarget (= this): element cÃ³ handler             â”‚
â”‚  stopPropagation(): dá»«ng bubbling lÃªn trÃªn                     â”‚
â”‚  stopImmediatePropagation(): dá»«ng cáº£ handlers cÃ¹ng element   â”‚
â”‚  Capturing: addEventListener(..., {capture: true})            â”‚
â”‚  Háº§u háº¿t events bubble. focus khÃ´ng bubble.                  â”‚
â”‚  âš ï¸ Äá»«ng stop bubbling khi khÃ´ng cáº§n thiáº¿t!                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Bubbling & event.target

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Bubbling: event cháº¡y tá»« target LÃŠN trÃªn qua ancestors
// Click <p> â†’ p â†’ div â†’ form â†’ body â†’ html â†’ document
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Háº§u háº¿t events bubble (ngoáº¡i lá»‡: focus, blur...)

// event.target vs this (event.currentTarget):
form.onclick = function (event) {
  // event.target: element Ä‘Æ°á»£c click THá»°C Sá»° (khÃ´ng Ä‘á»•i)
  // this = event.currentTarget: element cÃ³ HANDLER (form)
  alert("target: " + event.target.tagName); // P, DIV, FORM
  alert("this: " + this.tagName); // luÃ´n FORM
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// stopPropagation: dá»«ng bubbling
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

event.stopPropagation();
// Dá»«ng bubble lÃªn trÃªn, nhÆ°ng handlers KHÃC cÃ¹ng element váº«n cháº¡y

event.stopImmediatePropagation();
// Dá»«ng Táº¤T Cáº¢: khÃ´ng bubble + khÃ´ng cháº¡y handlers khÃ¡c cÃ¹ng elem

// âš ï¸ Äá»«ng stopPropagation khi khÃ´ng cáº§n!
// VÃ­ dá»¥: analytics báº¯t document clicks sáº½ tháº¥t báº¡i
// náº¿u submenu gá»i stopPropagation â†’ "dead zone"
```

### 3 Phases & Capturing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3 phases cá»§a event propagation:
//   1. Capturing: document â†’ html â†’ body â†’ ... â†’ target
//   2. Target:    event Ä‘áº¿n target element
//   3. Bubbling:  target â†’ ... â†’ body â†’ html â†’ document
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Máº·c Ä‘á»‹nh: handlers cháº¡y á»Ÿ bubbling phase
// on<event>, HTML attributes, addEventListener(event, fn)

// Báº¯t capturing: {capture: true} hoáº·c true
elem.addEventListener("click", handler, { capture: true });
elem.addEventListener("click", handler, true); // alias

// Click <p>: thá»© tá»± thá»±c táº¿:
// Capturing: HTML â†’ BODY â†’ FORM â†’ DIV â†’ P
// Bubbling:  P â†’ DIV â†’ FORM â†’ BODY â†’ HTML

for (let elem of document.querySelectorAll("*")) {
  elem.addEventListener(
    "click",
    (e) => alert(`Capturing: ${elem.tagName}`),
    true,
  );
  elem.addEventListener("click", (e) => alert(`Bubbling: ${elem.tagName}`));
}

// event.eventPhase: 1=capturing, 2=target, 3=bubbling

// âš ï¸ removeEventListener cáº§n cÃ¹ng phase!
elem.removeEventListener("click", handler, true); // pháº£i cÃ³ true

// stopPropagation á»Ÿ capturing cÅ©ng cháº·n bubbling!
// Same-phase handlers cháº¡y theo thá»© tá»± add
```

### Tá»•ng Há»£p: Bubbling and Capturing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUBBLING & CAPTURING â€” SUMMARY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Capturing (1) â†’ Target (2) â†’ Bubbling (3)                   â”‚
â”‚  event.target: element gá»‘c (khÃ´ng Ä‘á»•i qua phases)             â”‚
â”‚  event.currentTarget = this: element cÃ³ handler               â”‚
â”‚  stopPropagation: dá»«ng bubble (handlers cÃ¹ng elem váº«n cháº¡y)  â”‚
â”‚  stopImmediatePropagation: dá»«ng toÃ n bá»™                       â”‚
â”‚  Capturing: addEventListener(..., true)                        â”‚
â”‚  âš ï¸ removeEventListener cáº§n cÃ¹ng phase                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 61. Event Delegation â€” á»¦y Quyá»n Sá»± Kiá»‡n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT DELEGATION                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1 handler trÃªn container thay vÃ¬ N handlers trÃªn children     â”‚
â”‚  DÃ¹ng event.target + closest() xÃ¡c Ä‘á»‹nh element thá»±c sá»±       â”‚
â”‚  data-action: map action â†’ method (Menu pattern)              â”‚
â”‚  Behavior pattern: data-* + document handler                  â”‚
â”‚  Æ¯u: Ã­t memory, thÃªm/xÃ³a DOM tá»± do, innerHTML an toÃ n        â”‚
â”‚  Háº¡n cháº¿: event pháº£i bubble, thÃªm CPU check                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Delegation Pattern & closest()

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Thay vÃ¬ N handlers â†’ 1 handler trÃªn container
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥: highlight <td> khi click trong table
table.onclick = function (event) {
  let td = event.target.closest("td"); // tÃ¬m <td> gáº§n nháº¥t

  if (!td) return; // click ngoÃ i <td>
  if (!table.contains(td)) return; // td thuá»™c table khÃ¡c (nested)

  highlight(td);
};

// âš ï¸ event.target cÃ³ thá»ƒ lÃ  child cá»§a <td> (nhÆ° <strong>)
// â†’ DÃ¹ng closest() thay vÃ¬ event.target.tagName check

// Æ¯u Ä‘iá»ƒm:
// âœ… KhÃ´ng cáº§n gÃ¡n handler cho má»—i <td>
// âœ… ThÃªm/xÃ³a <td> Ä‘á»™ng â†’ váº«n hoáº¡t Ä‘á»™ng
// âœ… Tiáº¿t kiá»‡m memory
```

### data-action & Behavior Pattern

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// data-action: map button â†’ method
// <button data-action="save">Save</button>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class Menu {
  constructor(elem) {
    this._elem = elem;
    elem.onclick = this.onClick.bind(this); // âš ï¸ bind this!
  }
  save() {
    alert("saving");
  }
  load() {
    alert("loading");
  }
  search() {
    alert("searching");
  }

  onClick(event) {
    let action = event.target.dataset.action;
    if (action) this[action](); // gá»i method theo data-action
  }
}
new Menu(document.getElementById("menu"));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Behavior pattern: data-* + document-level handler
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Counter: <input data-counter value="1">
document.addEventListener("click", function (event) {
  if (event.target.dataset.counter != undefined) {
    event.target.value++; // tÄƒng value khi click
  }
});

// Toggler: <button data-toggle-id="form-id">
document.addEventListener("click", function (event) {
  let id = event.target.dataset.toggleId;
  if (!id) return;
  document.getElementById(id).hidden ^= true; // toggle hidden
});

// âš ï¸ Document-level: LUÃ”N dÃ¹ng addEventListener
// document.onclick = ... sáº½ ghi Ä‘Ã¨ handlers khÃ¡c!
```

### Tá»•ng Há»£p: Event Delegation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EVENT DELEGATION â€” SUMMARY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Algorithm: 1 handler â†’ check event.target â†’ handle          â”‚
â”‚  closest(): tÃ¬m ancestor match selector (nested elements)     â”‚
â”‚  container.contains(td): check thuá»™c table nÃ y               â”‚
â”‚  data-action: map button clicks â†’ methods                    â”‚
â”‚  Behavior: data-* attrs + document addEventListener           â”‚
â”‚  âœ… Ãt memory, thÃªm/xÃ³a DOM tá»± do, Ã­t code                    â”‚
â”‚  âš ï¸ Event pháº£i bubble, thÃªm CPU load nhá»                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 62. Browser Default Actions â€” HÃ nh Vi Máº·c Äá»‹nh TrÃ¬nh Duyá»‡t

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BROWSER DEFAULT ACTIONS                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  event.preventDefault(): cháº·n default action                  â”‚
â”‚  return false: chá»‰ vá»›i on<event> (khÃ´ng addEventListener)    â”‚
â”‚  passive: true â†’ khÃ´ng gá»i preventDefault (scroll mÆ°á»£t hÆ¡n)  â”‚
â”‚  event.defaultPrevented: check Ä‘Ã£ prevent chÆ°a               â”‚
â”‚  Follow-up: mousedown â†’ focus (cháº·n mousedown = máº¥t focus)  â”‚
â”‚  âš ï¸ Giá»¯ semantic HTML! <a> = navigation, <button> = action     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### preventDefault & return false

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Default actions chÃ­nh:
// click <a> â†’ navigate | submit <form> â†’ send
// mousedown â†’ text selection | contextmenu â†’ menu
// keydown â†’ add char | checkbox click â†’ toggle
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡ch 1: event.preventDefault() (luÃ´n hoáº¡t Ä‘á»™ng)
// <a href="/" onclick="event.preventDefault()">link</a>

// CÃ¡ch 2: return false (CHá»ˆ vá»›i on<event>)
// <a href="/" onclick="return false">link</a>

// VÃ­ dá»¥: menu JS-powered
menu.onclick = function (event) {
  if (event.target.nodeName != "A") return;
  let href = event.target.getAttribute("href");
  alert(href); // xá»­ lÃ½ báº±ng JS
  return false; // cháº·n navigate
};

// âš ï¸ return false trong addEventListener KHÃ”NG cháº·n default!
// Chá»‰ event.preventDefault() má»›i hoáº¡t Ä‘á»™ng

// âš ï¸ onclick="handler()" khÃ´ng truyá»n return!
// Sá»­a: onclick="return handler()" hoáº·c dÃ¹ng event.preventDefault()

// Follow-up events: cháº·n mousedown â†’ máº¥t focus
// <input onmousedown="return false"> â†’ click khÃ´ng focus
```

### passive & defaultPrevented

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// passive: true â†’ khÃ´ng gá»i preventDefault
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Mobile: touchmove cÃ³ thá»ƒ cháº·n scroll qua preventDefault
// Browser pháº£i Ä‘á»£i xá»­ lÃ½ xong handler má»›i scroll â†’ cháº­m!
elem.addEventListener("touchmove", handler, { passive: true });
// â†’ Browser scroll ngay, khÃ´ng Ä‘á»£i, mÆ°á»£t hÆ¡n

// Firefox/Chrome: passive = true Máº¶C Äá»Šnh cho touchstart/touchmove

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// event.defaultPrevented: thay tháº¿ stopPropagation!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// VÃ­ dá»¥: nested context menu (khÃ´ng cáº§n stopPropagation)
elem.oncontextmenu = function (event) {
  event.preventDefault();
  alert("Button menu");
};

document.oncontextmenu = function (event) {
  if (event.defaultPrevented) return; // Ä‘Ã£ xá»­ lÃ½ rá»“i!
  event.preventDefault();
  alert("Document menu");
};

// âœ… Tá»‘t hÆ¡n stopPropagation: events váº«n bubble
// â†’ analytics vÃ  outer handlers váº«n nháº­n event

// âš ï¸ preventDefault() â‰  stopPropagation()
// preventDefault: cháº·n default action cá»§a browser
// stopPropagation: cháº·n event lan truyá»n
// 2 thá»© Ä‘á»™c láº­p, khÃ´ng liÃªn quan nhau!
```

### Tá»•ng Há»£p: Browser Default Actions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEFAULT ACTIONS â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  preventDefault(): cháº·n default (luÃ´n hoáº¡t Ä‘á»™ng)              â”‚
â”‚  return false: chá»‰ on<event> (khÃ´ng addEventListener)         â”‚
â”‚  passive: true â†’ cam káº¿t khÃ´ng preventDefault (mobile)        â”‚
â”‚  defaultPrevented: check Ä‘Ã£ prevent â†’ thay stopPropagation   â”‚
â”‚  Follow-up: cháº·n event trÆ°á»›c sáº½ máº¥t event sau               â”‚
â”‚  âš ï¸ preventDefault â‰  stopPropagation (Ä‘á»™c láº­p nhau)          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 63. Dispatching Custom Events â€” Táº¡o vÃ  PhÃ¡t Sá»± Kiá»‡n

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DISPATCHING CUSTOM EVENTS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new Event(type, {bubbles, cancelable})                        â”‚
â”‚  elem.dispatchEvent(event): phÃ¡t event                        â”‚
â”‚  event.isTrusted: true = user, false = script                 â”‚
â”‚  MouseEvent/KeyboardEvent: constructor riÃªng (clientX...)      â”‚
â”‚  CustomEvent: detail property cho data tÃ¹y Ã½                   â”‚
â”‚  cancelable: true Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng                â”‚
â”‚  dispatchEvent tráº£ false náº¿u Ä‘Ã£ preventDefault               â”‚
â”‚  Events-in-events: Ä‘á»“ng bá»™! DÃ¹ng setTimeout Ä‘á»ƒ async         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event & dispatchEvent

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o event: new Event(type, options)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let event = new Event("click"); // máº·c Ä‘á»‹nh: khÃ´ng bubble
elem.dispatchEvent(event); // phÃ¡t event

// Options:
let event2 = new Event("hello", {
  bubbles: true, // Ä‘á»ƒ event bubble lÃªn
  cancelable: true, // Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng
});

// event.isTrusted:
// true = user tháº­t (click, keydown...)
// false = script táº¡o (dispatchEvent)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Constructor riÃªng cho tá»«ng loáº¡i event:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// MouseEvent: há»— trá»£ clientX/clientY
let click = new MouseEvent("click", {
  bubbles: true,
  cancelable: true,
  clientX: 100,
  clientY: 200,
});
alert(click.clientX); // 100 âœ…

// new Event("click", {clientX: 100}) â†’ clientX = undefined âŒ
// Event generic khÃ´ng cho set properties Ä‘áº·c biá»‡t

// CÃ¡c class khÃ¡c: KeyboardEvent, FocusEvent, WheelEvent...
```

### CustomEvent & preventDefault

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CustomEvent: detail property cho data tÃ¹y Ã½
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elem.addEventListener("hello", function (event) {
  alert(event.detail.name); // "John"
});

elem.dispatchEvent(
  new CustomEvent("hello", {
    detail: { name: "John" }, // data tÃ¹y Ã½ trong detail
  }),
);

// Custom events CHá»ˆ báº¯t Ä‘Æ°á»£c vá»›i addEventListener
// document.onhello KHÃ”NG hoáº¡t Ä‘á»™ng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// preventDefault trÃªn custom events
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function hide() {
  let event = new CustomEvent("hide", {
    cancelable: true, // âš ï¸ Báº®T BUá»˜C Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng!
  });

  if (!rabbit.dispatchEvent(event)) {
    // dispatchEvent tráº£ FALSE náº¿u Ä‘Ã£ preventDefault
    alert("Action prevented!");
  } else {
    rabbit.hidden = true;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Events-in-events: Äá»’NG Bá»˜!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

menu.onclick = function () {
  alert(1);
  menu.dispatchEvent(new CustomEvent("menu-open", { bubbles: true }));
  alert(2);
};
document.addEventListener("menu-open", () => alert("nested"));
// Output: 1 â†’ nested â†’ 2 (Ä‘á»“ng bá»™!)

// Muá»‘n async: bá»c trong setTimeout
setTimeout(() =>
  menu.dispatchEvent(
    new CustomEvent("menu-open", {
      bubbles: true,
    }),
  ),
);
// Output: 1 â†’ 2 â†’ nested (async)
```

### Tá»•ng Há»£p: Custom Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CUSTOM EVENTS â€” SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new Event(type, {bubbles, cancelable})                        â”‚
â”‚  MouseEvent/KeyboardEvent: properties riÃªng                    â”‚
â”‚  CustomEvent: detail cho data tÃ¹y Ã½                            â”‚
â”‚  dispatchEvent(event): phÃ¡t event, tráº£ false náº¿u prevented    â”‚
â”‚  cancelable: true Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng                â”‚
â”‚  isTrusted: true = user, false = script                       â”‚
â”‚  Events-in-events Ä‘á»“ng bá»™, setTimeout cho async               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 64. Mutation Observer â€” Theo DÃµi Thay Äá»•i DOM

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MUTATION OBSERVER                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new MutationObserver(callback): táº¡o observer                 â”‚
â”‚  observer.observe(node, config): báº¯t Ä‘áº§u theo dÃµi             â”‚
â”‚  Config: childList, subtree, attributes, characterData        â”‚
â”‚  MutationRecord: type, target, addedNodes, removedNodes       â”‚
â”‚  observer.disconnect(): dá»«ng theo dÃµi                         â”‚
â”‚  observer.takeRecords(): láº¥y mutations chÆ°a xá»­ lÃ½           â”‚
â”‚  Weak references: khÃ´ng cháº·n garbage collection              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### observe & MutationRecord

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o vÃ  gáº¯n observer
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let observer = new MutationObserver((mutationRecords) => {
  console.log(mutationRecords);
});

// Config options:
observer.observe(elem, {
  childList: true, // thÃªm/xÃ³a children trá»±c tiáº¿p
  subtree: true, // vÃ  táº¥t cáº£ descendants
  attributes: true, // thay Ä‘á»•i attributes
  attributeFilter: ["class", "style"], // chá»‰ theo dÃµi nhá»¯ng attr nÃ y
  characterData: true, // thay Ä‘á»•i text content
  attributeOldValue: true, // giá»¯ old value cá»§a attr
  characterDataOldValue: true, // giá»¯ old value cá»§a text
});

// MutationRecord properties:
// type: "attributes" | "characterData" | "childList"
// target: element/text node bá»‹ thay Ä‘á»•i
// addedNodes/removedNodes: nodes Ä‘Æ°á»£c thÃªm/xÃ³a
// previousSibling/nextSibling: siblings cá»§a nodes thÃªm/xÃ³a
// attributeName: tÃªn attr Ä‘Ã£ Ä‘á»•i
// oldValue: giÃ¡ trá»‹ cÅ© (náº¿u báº­t *OldValue)

// VÃ­ dá»¥: edit text trong contentEditable
// mutationRecords = [{
//   type: "characterData",
//   oldValue: "edit",
//   target: <text node>
// }]
```

### Use Cases & Additional Methods

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Use case 1: Tá»± Ä‘á»™ng highlight code snippets
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let observer = new MutationObserver((mutations) => {
  for (let mutation of mutations) {
    for (let node of mutation.addedNodes) {
      if (!(node instanceof HTMLElement)) continue;

      // Node chÃ­nh lÃ  code snippet?
      if (node.matches('pre[class*="language-"]')) {
        Prism.highlightElement(node);
      }
      // Hoáº·c chá»©a code snippets bÃªn trong?
      for (let elem of node.querySelectorAll('pre[class*="language-"]')) {
        Prism.highlightElement(elem);
      }
    }
  }
});
observer.observe(demoElem, { childList: true, subtree: true });

// Use case 2: XÃ³a unwanted elements (ads tá»« 3rd-party scripts)
// Use case 3: Detect DOM changes tá»« libraries khÃ¡c

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// disconnect & takeRecords
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Láº¥y mutations chÆ°a xá»­ lÃ½ TRÆ¯á»œC khi disconnect
let records = observer.takeRecords(); // chÆ°a xá»­ lÃ½
observer.disconnect(); // dá»«ng theo dÃµi

// âš ï¸ takeRecords() xÃ³a khá»i queue â†’ callback khÃ´ng gá»i láº¡i

// Garbage collection: observer dÃ¹ng WEAK REFERENCES
// Node bá»‹ xÃ³a khá»i DOM â†’ váº«n Ä‘Æ°á»£c GC (observer khÃ´ng cháº·n)
```

### Tá»•ng Há»£p: Mutation Observer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MUTATION OBSERVER â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  observe(node, config): theo dÃµi childList/attrs/text         â”‚
â”‚  MutationRecord: type, target, addedNodes, oldValue           â”‚
â”‚  disconnect(): dá»«ng, takeRecords(): láº¥y pending              â”‚
â”‚  Use cases: auto-highlight, xÃ³a ads, integrate 3rd-party     â”‚
â”‚  Config Ä‘á»ƒ tá»‘i Æ°u, khÃ´ng theo dÃµi thá»«a                       â”‚
â”‚  Weak refs: khÃ´ng cháº·n GC                                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 65. Selection and Range â€” VÃ¹ng Chá»n vÃ  Pháº¡m Vi

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SELECTION AND RANGE                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Range: cáº·p boundary points (start, end)                      â”‚
â”‚  setStart/setEnd: text offset hoáº·c child index               â”‚
â”‚  Selection: window.getSelection()                              â”‚
â”‚  anchor/focus â‰  start/end (cÃ³ thá»ƒ ngÆ°á»£c)                    â”‚
â”‚  Form: selectionStart/End, setRangeText                       â”‚
â”‚  Unselectable: user-select:none, onselectstart                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Range Object

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Range = cáº·p boundary points (start, end)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let range = new Range();

// Text node: offset = vá»‹ trÃ­ trong text
range.setStart(p.firstChild, 2); // tá»« kÃ½ tá»± thá»© 2
range.setEnd(p.firstChild, 4); // Ä‘áº¿n kÃ½ tá»± thá»© 4
console.log(range); // "ll" (tá»« "Hello")

// Element node: offset = child index
range.setStart(p, 0); // tá»« child Ä‘áº§u tiÃªn
range.setEnd(p, 2); // Ä‘áº¿n child thá»© 2 (khÃ´ng bao gá»“m)

// Span across nodes:
range.setStart(p.firstChild, 2);
range.setEnd(p.querySelector("b").firstChild, 3);
// "ample: italic and bol"

// Properties:
// startContainer/startOffset, endContainer/endOffset
// collapsed: true náº¿u start === end
// commonAncestorContainer: ancestor chung gáº§n nháº¥t

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Range methods:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set: setStartBefore/After(node), setEndBefore/After(node)
// Select: selectNode(node), selectNodeContents(node)
// collapse(toStart): thu gá»n range
// cloneRange(): copy range

// Editing:
range.deleteContents(); // xÃ³a ná»™i dung
range.extractContents(); // xÃ³a + tráº£ vá» DocumentFragment
range.cloneContents(); // copy tráº£ vá» DocumentFragment
range.insertNode(node); // chÃ¨n node á»Ÿ Ä‘áº§u range
range.surroundContents(node); // bao bá»c range (âš ï¸ cáº§n full tags)
```

### Selection API & Form Controls

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Selection: window.getSelection()
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let sel = document.getSelection();

// Properties: anchorNode/Offset (start), focusNode/Offset (end)
// âš ï¸ anchor/focus CÃ“ THá»‚ ngÆ°á»£c (user kÃ©o pháº£i â†’ trÃ¡i)
// Range start/end luÃ´n start < end

// Methods:
sel.getRangeAt(0); // láº¥y range (chá»‰ 1 trá»« Firefox)
sel.addRange(range); // thÃªm range
sel.removeAllRanges(); // xÃ³a háº¿t (cáº§n trÆ°á»›c addRange)
sel.setBaseAndExtent(anchorNode, aOffset, focusNode, fOffset);
sel.selectAllChildren(node);
sel.deleteFromDocument();
sel.toString(); // text cá»§a selection

// Events:
// onselectstart: báº¯t Ä‘áº§u chá»n (return false = cháº·n)
// document.onselectionchange: selection thay Ä‘á»•i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Form Controls (input/textarea): API riÃªng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Properties (writable):
input.selectionStart; // vá»‹ trÃ­ Ä‘áº§u
input.selectionEnd; // vá»‹ trÃ­ cuá»‘i
input.selectionDirection; // "forward"/"backward"/"none"

// Methods:
input.select(); // chá»n toÃ n bá»™
input.setSelectionRange(start, end, direction);
input.setRangeText(replacement, start, end, selectionMode);
// selectionMode: "select"/"start"/"end"/"preserve"(default)

// Di chuyá»ƒn cursor: set selectionStart = selectionEnd
area.selectionStart = area.selectionEnd = 10;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LÃ m unselectable:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. CSS: user-select: none (váº«n chá»n Ä‘Æ°á»£c tá»« ngoÃ i)
// 2. onselectstart = () => false (cháº·n báº¯t Ä‘áº§u)
// 3. document.getSelection().empty() (Ã­t dÃ¹ng, bá»‹ nháº¥p nhÃ¡y)
```

### Tá»•ng Há»£p: Selection and Range

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SELECTION & RANGE â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Range: setStart/End (text offset hoáº·c child index)           â”‚
â”‚  Editing: delete/extract/clone/insert/surround                â”‚
â”‚  Selection: anchor/focus (cÃ³ thá»ƒ ngÆ°á»£c)                     â”‚
â”‚  removeAllRanges() trÆ°á»›c addRange()                           â”‚
â”‚  Form: selectionStart/End, setRangeText                       â”‚
â”‚  Cursor: selectionStart = selectionEnd                         â”‚
â”‚  Unselectable: user-select:none / onselectstart                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 66. Fetch â€” Gá»i API vá»›i JavaScript

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH API                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  fetch(url, options): tráº£ Promise<Response>                    â”‚
â”‚  2 giai Ä‘oáº¡n: headers â†’ body                                  â”‚
â”‚  response.ok / .status: check HTTP status                      â”‚
â”‚  Body: .text() .json() .blob() .arrayBuffer() .formData()     â”‚
â”‚  âš ï¸ Chá»‰ Ä‘á»c body 1 láº§n!                                       â”‚
â”‚  POST: method + body + headers (Content-Type)                  â”‚
â”‚  404/500 khÃ´ng reject! Chá»‰ network error má»›i reject           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Response: Headers & Body

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Giai Ä‘oáº¡n 1: Headers (resolve ngay khi server tráº£ headers)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let response = await fetch(url);

response.status; // 200, 404, 500...
response.ok; // true náº¿u 200-299
response.headers.get("Content-Type");

// âš ï¸ 404/500 KHÃ”NG reject!
// Chá»‰ network error (khÃ´ng káº¿t ná»‘i) má»›i reject

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Giai Ä‘oáº¡n 2: Body (cáº§n gá»i method riÃªng)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let json = await response.json(); // parse JSON
let text = await response.text(); // plain text
let blob = await response.blob(); // binary (Blob)
let buf = await response.arrayBuffer(); // low-level binary
let form = await response.formData(); // FormData

// âš ï¸ CHá»ˆ Äá»Œc BODY 1 Láº¦N!
let text2 = await response.text(); // âœ…
let json2 = await response.json(); // âŒ fails (already consumed)

// Response headers (Map-like):
for (let [key, value] of response.headers) {
  console.log(`${key} = ${value}`);
}
```

### POST & Binary

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POST JSON:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let response = await fetch("/api/user", {
  method: "POST",
  headers: {
    "Content-Type": "application/json;charset=utf-8",
  },
  body: JSON.stringify({ name: "John" }),
});

// âš ï¸ Máº·c Ä‘á»‹nh body string â†’ Content-Type: text/plain;charset=UTF-8
// Pháº£i set application/json thá»§ cÃ´ng!

// Body cÃ³ thá»ƒ lÃ :
// - String (JSON.stringify)
// - FormData (multipart/form-data)
// - Blob/BufferSource (binary)
// - URLSearchParams (x-www-form-urlencoded)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»­i binary (Blob tá»± set Content-Type):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let blob = await new Promise((resolve) => canvas.toBlob(resolve, "image/png"));
let response2 = await fetch("/api/image", {
  method: "POST",
  body: blob, // Blob.type = "image/png" â†’ auto Content-Type
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Parallel fetch vá»›i Promise.all:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function getUsers(names) {
  let jobs = names.map((name) =>
    fetch(`https://api.github.com/users/${name}`)
      .then((res) => (res.status === 200 ? res.json() : null))
      .catch(() => null),
  );
  return Promise.all(jobs);
}
// âš ï¸ Gáº¯n .then(res.json()) trá»±c tiáº¿p vÃ o tá»«ng fetch
// Ä‘á»ƒ khÃ´ng chá» táº¥t cáº£ fetch xong má»›i Ä‘á»c body

// Forbidden headers (browser control): Cookie, Origin, Referer,
// Host, Connection, Content-Length, Sec-*, Proxy-*...
```

### Tá»•ng Há»£p: Fetch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH â€” SUMMARY                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  fetch(url, {method, headers, body}): Promise<Response>        â”‚
â”‚  2 stages: headers (resolve) â†’ body (method call)             â”‚
â”‚  response.ok / .status + .headers (Map-like)                   â”‚
â”‚  Body: .json() .text() .blob() .arrayBuffer() .formData()     â”‚
â”‚  Body chá»‰ Ä‘á»c 1 láº§n (consumed)                                 â”‚
â”‚  POST: JSON.stringify + Content-Type: application/json        â”‚
â”‚  Blob body tá»± set Content-Type                                 â”‚
â”‚  404/500 khÃ´ng reject, chá»‰ network error reject              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 67. FormData â€” Gá»­i Form vá»›i Fetch

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FORMDATA                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new FormData(form): tá»± capture fields tá»« HTML form           â”‚
â”‚  fetch body: auto Content-Type: multipart/form-data            â”‚
â”‚  append(name, value): thÃªm field (cho phÃ©p trÃ¹ng)             â”‚
â”‚  set(name, value): thay tháº¿ field (xÃ³a trÃ¹ng)                â”‚
â”‚  append(name, blob, fileName): gá»­i file                       â”‚
â”‚  delete/get/has: quáº£n lÃ½ fields                                â”‚
â”‚  Iterable: for..of loop                                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Methods & Gá»­i Form

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o FormData tá»« HTML form:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

formElem.onsubmit = async (e) => {
  e.preventDefault();
  let response = await fetch("/api/user", {
    method: "POST",
    body: new FormData(formElem), // tá»± capture táº¥t cáº£ fields
    // Content-Type: multipart/form-data (tá»± Ä‘á»™ng!)
  });
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FormData methods:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fd = new FormData();

// append: thÃªm field (cho phÃ©p NHIá»€U field cÃ¹ng tÃªn)
fd.append("key", "value1");
fd.append("key", "value2"); // 2 fields "key"!

// set: thay tháº¿ táº¥t cáº£ field cÃ¹ng tÃªn
fd.set("key", "newValue"); // chá»‰ 1 field "key"

fd.delete("key"); // xÃ³a field
fd.get("key"); // láº¥y giÃ¡ trá»‹
fd.has("key"); // true/false

// Iterate:
for (let [name, value] of fd) {
  console.log(`${name} = ${value}`);
}
```

### Files & Blob

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»­i form vá»›i file (input type="file"):
// Tá»± Ä‘á»™ng multipart/form-data encoding
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// new FormData(formElem) tá»± báº¯t cáº£ <input type="file">

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Gá»­i Blob nhÆ° file trong FormData:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let imageBlob = await new Promise((resolve) =>
  canvas.toBlob(resolve, "image/png"),
);

let formData = new FormData();
formData.append("firstName", "John");
formData.append("image", imageBlob, "image.png");
// arg 3: fileName (tÃªn file nhÆ° tá»« filesystem)
// Giá»‘ng nhÆ° <input type="file" name="image"> vá»›i file "image.png"

let response = await fetch("/api/image-form", {
  method: "POST",
  body: formData, // multipart/form-data vá»›i cáº£ text + file
});

// âš ï¸ append vs set:
// append("a", 1), append("a", 2) â†’ 2 fields "a"
// set("a", 1), set("a", 2) â†’ chá»‰ 1 field "a" = 2
```

### Tá»•ng Há»£p: FormData

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FORMDATA â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new FormData(form): auto capture fields                       â”‚
â”‚  fetch body â†’ Content-Type: multipart/form-data (auto)       â”‚
â”‚  append: thÃªm (cho phÃ©p trÃ¹ng)                                 â”‚
â”‚  set: thay tháº¿ (xÃ³a trÃ¹ng)                                    â”‚
â”‚  append(name, blob, fileName): gá»­i file/Blob                  â”‚
â”‚  delete/get/has + for..of iteration                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 68. Fetch: Download Progress â€” Theo DÃµi Tiáº¿n TrÃ¬nh Táº£i

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH: DOWNLOAD PROGRESS                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  response.body: ReadableStream                                  â”‚
â”‚  getReader() + while loop: Ä‘á»c chunk-by-chunk                  â”‚
â”‚  Content-Length: biáº¿t total size                               â”‚
â”‚  Uint8Array chunks â†’ concatenate â†’ TextDecoder/Blob          â”‚
â”‚  âš ï¸ Chá»‰ download progress! Upload cáº§n XMLHttpRequest           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ReadableStream & Progress Tracking

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 5 bÆ°á»›c: fetch â†’ reader â†’ loop â†’ concat â†’ decode
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Step 1: fetch + láº¥y reader
let response = await fetch(url);
const reader = response.body.getReader();

// Step 2: total size tá»« Content-Length
const contentLength = +response.headers.get("Content-Length");

// Step 3: Ä‘á»c chunks trong while loop
let receivedLength = 0;
let chunks = [];
while (true) {
  const { done, value } = await reader.read();
  // done: true khi háº¿t
  // value: Uint8Array cá»§a chunk
  if (done) break;

  chunks.push(value);
  receivedLength += value.length;
  console.log(`${receivedLength} / ${contentLength}`);
}

// Step 4: gá»™p chunks thÃ nh 1 Uint8Array
let chunksAll = new Uint8Array(receivedLength);
let position = 0;
for (let chunk of chunks) {
  chunksAll.set(chunk, position);
  position += chunk.length;
}

// Step 5: decode thÃ nh string
let result = new TextDecoder("utf-8").decode(chunksAll);
let data = JSON.parse(result);

// Hoáº·c binary: let blob = new Blob(chunks);

// âš ï¸ KHÃ”NG dÃ¹ng cáº£ reader vÃ  response.json() cho cÃ¹ng 1 response!
// âš ï¸ Fetch KHÃ”NG há»— trá»£ upload progress! DÃ¹ng XMLHttpRequest.
// âš ï¸ Content-Length cÃ³ thá»ƒ váº¯ng (cross-origin)
```

### Tá»•ng Há»£p: Download Progress

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DOWNLOAD PROGRESS â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  response.body.getReader(): ReadableStream reader              â”‚
â”‚  reader.read(): {done, value (Uint8Array)}                     â”‚
â”‚  Content-Length: total size (cÃ³ thá»ƒ váº¯ng)                    â”‚
â”‚  Concat: Uint8Array.set(chunk, position)                       â”‚
â”‚  Decode: TextDecoder / new Blob(chunks)                        â”‚
â”‚  Chá»‰ download! Upload cáº§n XMLHttpRequest                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 69. Fetch: Abort â€” Há»§y Request

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH: ABORT                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  AbortController: abort() + signal                              â”‚
â”‚  fetch(url, {signal}): pass signal option                      â”‚
â”‚  abort() â†’ reject vá»›i AbortError                               â”‚
â”‚  1 controller há»§y nhiá»u fetch cÃ¹ng lÃºc                        â”‚
â”‚  DÃ¹ng cho cáº£ custom async tasks                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AbortController & Fetch Integration

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AbortController cÆ¡ báº£n:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let controller = new AbortController();
// controller.signal: object cho event listeners
// controller.abort(): phÃ¡t "abort" event

controller.signal.addEventListener("abort", () => {
  console.log("Aborted!");
});

controller.abort();
console.log(controller.signal.aborted); // true

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DÃ¹ng vá»›i fetch: pass signal option
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let controller2 = new AbortController();
setTimeout(() => controller2.abort(), 1000); // timeout 1s

try {
  let response = await fetch(url, {
    signal: controller2.signal, // â† pass signal
  });
} catch (err) {
  if (err.name === "AbortError") {
    console.log("Fetch aborted!"); // há»§y thÃ nh cÃ´ng
  } else {
    throw err; // error khÃ¡c
  }
}
// âš ï¸ abort() â†’ promise REJECTS vá»›i AbortError
```

### Scalable: Há»§y nhiá»u fetch & Custom Tasks

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1 controller há»§y NHIá»€U fetch:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let controller = new AbortController();

let fetchJobs = urls.map((url) => fetch(url, { signal: controller.signal }));
let results = await Promise.all(fetchJobs);

// controller.abort() â†’ há»§y Táº¤T Cáº¢ fetches!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Há»§y cáº£ custom tasks cÃ¹ng fetches:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let ourJob = new Promise((resolve, reject) => {
  // láº¯ng nghe abort event
  controller.signal.addEventListener("abort", reject);
  // ... lÃ m viá»‡c gÃ¬ Ä‘Ã³
});

let all = await Promise.all([...fetchJobs, ourJob]);
// controller.abort() â†’ há»§y cáº£ fetches + ourJob!
```

### Tá»•ng Há»£p: Fetch Abort

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH ABORT â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  AbortController: abort() + signal (.aborted)                  â”‚
â”‚  fetch(url, {signal}): há»§y báº±ng controller.abort()           â”‚
â”‚  Promise rejects vá»›i AbortError (try/catch)                   â”‚
â”‚  1 controller há»§y nhiá»u fetch + custom tasks                  â”‚
â”‚  signal.addEventListener("abort", reject)                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 70. Fetch API â€” Táº¥t Cáº£ Options

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH API â€” FULL OPTIONS                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  referrer/referrerPolicy: kiá»ƒm soÃ¡t Referer header             â”‚
â”‚  mode: cors / same-origin / no-cors                            â”‚
â”‚  credentials: same-origin / include / omit                     â”‚
â”‚  cache: default / no-store / reload / no-cache...              â”‚
â”‚  redirect: follow / error / manual                              â”‚
â”‚  integrity: SHA-256/384/512 checksum                            â”‚
â”‚  keepalive: request sá»‘ng sau khi page unload (64KB)            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### referrer, referrerPolicy & mode

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// referrer: set/xÃ³a Referer header
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fetch(url, { referrer: "" }); // khÃ´ng gá»­i Referer
fetch(url, { referrer: "https://..." }); // chá»‰ trong same origin

// referrerPolicy: quy táº¯c chung cho Referer
// Default: "strict-origin-when-cross-origin"
//
// same-origin  cross-origin  HTTPSâ†’HTTP
// "no-referrer":           -        -           -
// "no-referrer-when-downgrade": full  full        -
// "origin":              origin   origin      origin
// "origin-when-cross-origin":  full  origin      origin
// "same-origin":          full      -           -
// "strict-origin":       origin   origin        -
// "strict-origin-when-cross-origin": full origin  -  (default)
// "unsafe-url":           full     full         full

fetch(url, {
  referrerPolicy: "origin-when-cross-origin",
  // cross-origin chá»‰ gá»­i origin, khÃ´ng path
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// mode: kiá»ƒm soÃ¡t cross-origin
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// "cors" (default): cross-origin cho phÃ©p
// "same-origin": chá»‰ same-origin, cross-origin bá»‹ cháº·n
// "no-cors": chá»‰ safe cross-origin requests
```

### credentials, cache, redirect, integrity & keepalive

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// credentials: gá»­i cookies/auth
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "same-origin" (default): chá»‰ gá»­i cho same-origin
// "include": luÃ´n gá»­i (cáº§n Access-Control-Allow-Credentials)
// "omit": khÃ´ng bao giá» gá»­i

fetch(url, { credentials: "include" }); // gá»­i cookies cross-origin

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// cache: kiá»ƒm soÃ¡t HTTP cache
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "default": standard HTTP cache
// "no-store": ignore cache hoÃ n toÃ n
// "reload": khÃ´ng láº¥y tá»« cache, populate cache vá»›i response
// "no-cache": conditional request náº¿u cÃ³ cache
// "force-cache": dÃ¹ng cache dÃ¹ stale
// "only-if-cached": chá»‰ cache (mode: same-origin)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// redirect: xá»­ lÃ½ redirects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "follow" (default): tá»± Ä‘á»™ng follow 301/302
// "error": error náº¿u redirect
// "manual": xá»­ lÃ½ thá»§ cÃ´ng (response.type = "opaqueredirect")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// integrity: checksum verification
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fetch(url, { integrity: "sha256-abcdef" });
// Fetch tá»± tÃ­nh SHA-256, so sÃ¡nh â†’ error náº¿u mismatch

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// keepalive: request sá»‘ng sau khi page unload
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.onunload = () => {
  fetch("/analytics", {
    method: "POST",
    body: "statistics",
    keepalive: true, // tiáº¿p tá»¥c sau khi rá»i page
  });
};
// âš ï¸ Giá»›i háº¡n: body tá»•ng â‰¤ 64KB cho táº¥t cáº£ keepalive requests
// âš ï¸ KhÃ´ng handle Ä‘Æ°á»£c response sau unload
```

### Tá»•ng Há»£p: Fetch API Options

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH API OPTIONS â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  referrer/Policy: kiá»ƒm soÃ¡t Referer (8 policies)              â”‚
â”‚  mode: cors/same-origin/no-cors                                â”‚
â”‚  credentials: same-origin/include/omit                         â”‚
â”‚  cache: 6 cháº¿ Ä‘á»™ (default â†’ only-if-cached)                 â”‚
â”‚  redirect: follow/error/manual                                  â”‚
â”‚  integrity: SHA checksum verification                           â”‚
â”‚  keepalive: sá»‘ng sau unload (â‰¤ 64KB)                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 71. URL Objects â€” Parse vÃ  XÃ¢y Dá»±ng URL

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  URL OBJECTS                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new URL(url, base): parse + xÃ¢y dá»±ng URL                      â”‚
â”‚  Components: protocol/host/pathname/search/hash                â”‚
â”‚  searchParams (URLSearchParams): auto-encode                   â”‚
â”‚  encodeURI: whole URL, encodeURIComponent: params              â”‚
â”‚  URL objects dÃ¹ng thay string á»Ÿ má»i nÆ¡i                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### URL Constructor & Components

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o URL:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let url = new URL("https://site.com/path?q=test#hash");

// Vá»›i base URL:
let url2 = new URL("/profile", "https://site.com");
// â†’ https://site.com/profile

// Relative path:
let base = new URL("https://site.com/a/b");
let rel = new URL("c", base); // https://site.com/a/c

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Components:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

url.protocol; // "https:"
url.host; // "site.com"
url.pathname; // "/path"
url.search; // "?q=test"
url.hash; // "#hash"
url.href; // full URL = url.toString()

// DÃ¹ng URL object thay string:
fetch(url); // âœ… cháº¥p nháº­n URL object
let xhr = new XMLHttpRequest();
xhr.open("GET", url); // âœ…
```

### searchParams & Encoding

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// url.searchParams (URLSearchParams): auto-encode!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let url = new URL("https://google.com/search");

url.searchParams.set("q", "test me!");
// â†’ https://google.com/search?q=test+me%21

// Methods:
// append(name, value): thÃªm (cho phÃ©p trÃ¹ng)
// delete(name), get(name), getAll(name)
// has(name), set(name, value), sort()
// Iterable (nhÆ° Map)

for (let [name, value] of url.searchParams) {
  console.log(`${name}=${value}`); // q=test me! (decoded)
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Encoding: encodeURI vs encodeURIComponent
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// encodeURI: toÃ n bá»™ URL (giá»¯ :, ?, =, &, #)
encodeURI("http://site.com/Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚");
// http://site.com/%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82

// encodeURIComponent: 1 param (encode Cáº¢ :, ?, =, &, #)
let q = encodeURIComponent("Rock&Roll");
// Rock%26Roll â†’ an toÃ n cho search param

// âš ï¸ encodeURI("Rock&Roll") = "Rock&Roll" (khÃ´ng encode &!)
// â†’ search param bá»‹ sai: ?q=Rock&Roll thay vÃ¬ ?q=Rock%26Roll

// URL class dÃ¹ng RFC3986 (má»›i)
// encode* dÃ¹ng RFC2396 (cÅ©, vÃ­ dá»¥: encode [] cá»§a IPv6 sai)
// â†’ Æ¯u tiÃªn dÃ¹ng URL class!
```

### Tá»•ng Há»£p: URL Objects

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  URL OBJECTS â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new URL(url, base): parse + relative paths                    â”‚
â”‚  protocol/host/pathname/search/hash/href                       â”‚
â”‚  searchParams: auto-encode, iterable                           â”‚
â”‚  encodeURI: whole URL (giá»¯ & ? = #)                          â”‚
â”‚  encodeURIComponent: 1 param (encode & ? = #)                 â”‚
â”‚  URL class (RFC3986) > encode* (RFC2396)                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 72. XMLHttpRequest

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  XMLHTTPREQUEST                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 bÆ°á»›c: new XMLHttpRequest â†’ open â†’ send                     â”‚
â”‚  Events: load / error / progress                                â”‚
â”‚  responseType: text / json / blob / arraybuffer                â”‚
â”‚  readyState: 0â†’4 (UNSENT â†’ DONE)                              â”‚
â”‚  xhr.upload.onprogress: UPLOAD progress (Æ°u tháº¿ vs fetch)     â”‚
â”‚  setRequestHeader: appends (khÃ´ng overwrite!)                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÆ¡ Báº£n: open, send, Events & Response

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 3 bÆ°á»›c: táº¡o â†’ cáº¥u hÃ¬nh â†’ gá»­i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let xhr = new XMLHttpRequest();
xhr.open("GET", "/api/data"); // âš ï¸ chÆ°a gá»­i! Chá»‰ cáº¥u hÃ¬nh
xhr.send(); // gá»­i request

// Events:
xhr.onload = function () {
  // load: request complete (dÃ¹ status 200, 404, 500)
  if (xhr.status !== 200) {
    console.log(`Error ${xhr.status}: ${xhr.statusText}`);
  } else {
    console.log(xhr.response); // server response body
  }
};
xhr.onerror = function () {
  // error: network down, invalid URL (khÃ´ng pháº£i HTTP error!)
};
xhr.onprogress = function (event) {
  // event.loaded: bytes Ä‘Ã£ táº£i
  // event.total: tá»•ng bytes (náº¿u lengthComputable)
  // event.lengthComputable: true náº¿u cÃ³ Content-Length
};

// Response properties:
// xhr.status (200, 404...), xhr.statusText ("OK", "Not Found")
// xhr.response (body), xhr.timeout = 10000 (ms)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// responseType: set format response
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// "" / "text": string (default)
// "json": auto JSON.parse
// "blob": Blob object
// "arraybuffer": ArrayBuffer
// "document": XML/HTML document

xhr.responseType = "json"; // set TRÆ¯á»œC khi send
xhr.onload = () => console.log(xhr.response.message);

// readyState: 0(UNSENT) â†’ 1(OPENED) â†’ 2(HEADERS) â†’ 3(LOADING) â†’ 4(DONE)
// readystatechange: deprecated, dÃ¹ng load/error/progress
```

### Headers, POST, Upload Progress & Cross-Origin

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HTTP Headers:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

xhr.setRequestHeader("Content-Type", "application/json");
// âš ï¸ setRequestHeader APPENDS, khÃ´ng overwrite!
xhr.setRequestHeader("X-Auth", "123");
xhr.setRequestHeader("X-Auth", "456");
// X-Auth: 123, 456

xhr.getResponseHeader("Content-Type"); // 1 header
xhr.getAllResponseHeaders(); // táº¥t cáº£ (trá»« Set-Cookie)
// Parse: split("\r\n") + split(": ")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// POST: FormData hoáº·c JSON
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FormData:
xhr.open("POST", "/submit");
xhr.send(new FormData(form)); // multipart/form-data

// JSON:
xhr.setRequestHeader("Content-Type", "application/json");
xhr.send(JSON.stringify({ name: "John" }));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPLOAD PROGRESS: Æ°u tháº¿ lá»›n nháº¥t cá»§a XHR vs fetch!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

xhr.upload.onprogress = function (event) {
  console.log(`Uploaded ${event.loaded} of ${event.total}`);
};
xhr.upload.onload = () => console.log("Upload done!");
xhr.upload.onerror = () => console.log("Upload error!");
// xhr.upload events: loadstart/progress/abort/error/load/timeout/loadend

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cross-origin & Abort:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

xhr.withCredentials = true; // gá»­i cookies cross-origin
xhr.abort(); // há»§y request, xhr.status = 0

// âš ï¸ Sync mode: xhr.open("GET", url, false)
// JavaScript block cho Ä‘áº¿n khi cÃ³ response â†’ TRÃNH!
// KhÃ´ng cÃ³ progress, khÃ´ng timeout, block UI

// Lifecycle events:
// loadstart â†’ progress â†’ abort/error/load/timeout â†’ loadend
// error, abort, timeout, load: mutually exclusive
```

### Tá»•ng Há»£p: XMLHttpRequest

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  XMLHTTPREQUEST â€” SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 steps: new XHR â†’ open(method, url) â†’ send(body)           â”‚
â”‚  Events: load/error/progress + timeout                          â”‚
â”‚  responseType: text/json/blob/arraybuffer/document             â”‚
â”‚  readyState: 0â†’4 (readystatechange deprecated)                â”‚
â”‚  setRequestHeader: appends (khÃ´ng overwrite)                   â”‚
â”‚  xhr.upload.onprogress: UPLOAD progress (Æ°u tháº¿ fetch)       â”‚
â”‚  withCredentials: cookies cross-origin                          â”‚
â”‚  Lifecycle: loadstartâ†’progressâ†’load/errorâ†’loadend           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 73. Resumable File Upload

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESUMABLE FILE UPLOAD                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  DÃ¹ng XHR (fetch khÃ´ng cÃ³ upload progress)                     â”‚
â”‚  fileId: name + size + lastModified                            â”‚
â”‚  Há»i server: startByte Ä‘Ã£ nháº­n                               â”‚
â”‚  Gá»­i tiáº¿p: file.slice(startByte)                              â”‚
â”‚  âš ï¸ onprogress chá»‰ track Ä‘Ã£ Gá»¬I, khÃ´ng cháº¯c server Ä‘Ã£ NHáº¬N  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Algorithm: fileId, Status Check & Resume

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Step 1: Táº¡o fileId duy nháº¥t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let fileId = file.name + "-" + file.size + "-" + file.lastModified;
// Äá»•i name/size/lastModified â†’ fileId má»›i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Step 2: Há»i server Ä‘Ã£ nháº­n bao nhiÃªu bytes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let response = await fetch("status", {
  headers: { "X-File-Id": fileId },
});
let startByte = +(await response.text()); // 0 náº¿u chÆ°a cÃ³

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Step 3: Gá»­i pháº§n cÃ²n láº¡i báº±ng XHR + Blob.slice
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let xhr = new XMLHttpRequest();
xhr.open("POST", "upload");
xhr.setRequestHeader("X-File-Id", fileId);
xhr.setRequestHeader("X-Start-Byte", startByte);

xhr.upload.onprogress = (e) => {
  // TÃ­nh tá»•ng: startByte (pháº§n Ä‘Ã£ upload trÆ°á»›c) + e.loaded
  console.log(`Uploaded ${startByte + e.loaded} of ${startByte + e.total}`);
};

xhr.send(file.slice(startByte)); // gá»­i tá»« startByte trá»Ÿ Ä‘i

// âš ï¸ Táº¡i sao khÃ´ng dÃ¹ng onprogress Ä‘á»ƒ biáº¿t server Ä‘Ã£ nháº­n?
// onprogress = data Ä‘Ã£ Gá»¬I (sent), khÃ´ng cháº¯c Ä‘Ã£ NHáº¬N (received)
// CÃ³ thá»ƒ bá»‹ buffer bá»Ÿi proxy, server crash, máº¥t giá»¯a Ä‘Æ°á»ng
// â†’ Chá»‰ server má»›i biáº¿t chÃ­nh xÃ¡c Ä‘Ã£ nháº­n bao nhiÃªu!
```

### Tá»•ng Há»£p: Resumable Upload

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESUMABLE UPLOAD â€” SUMMARY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  fileId = name + size + lastModified                           â”‚
â”‚  fetch("status", {X-File-Id}) â†’ startByte                    â”‚
â”‚  xhr.send(file.slice(startByte)): gá»­i pháº§n cÃ²n láº¡i           â”‚
â”‚  X-File-Id + X-Start-Byte: server biáº¿t resume                 â”‚
â”‚  onprogress = Ä‘Ã£ gá»­i, khÃ´ng cháº¯c server Ä‘Ã£ nháº­n            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 74. Long Polling

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LONG POLLING                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Regular polling: gá»­i má»—i 10s â†’ delay + lÃ£ng phÃ­              â”‚
â”‚  Long polling: server GIá»® connection cho Ä‘áº¿n khi cÃ³ data    â”‚
â”‚  Browser reconnect ngay sau khi nháº­n response                 â”‚
â”‚  PhÃ¹ há»£p: messages hiáº¿m. Nhiá»u â†’ WebSocket/SSE               â”‚
â”‚  Server cáº§n handle nhiá»u pending connections                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Regular Polling vs Long Polling

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Regular Polling: má»—i 10s gá»­i request
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âš ï¸ NhÆ°á»£c: delay Ä‘áº¿n 10s, lÃ£ng phÃ­ requests dÃ¹ khÃ´ng cÃ³ data

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Long Polling: server GIá»® connection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Flow:
// 1. Browser gá»­i request
// 2. Server GIá»® connection (khÃ´ng tráº£ vá» ngay)
// 3. Khi cÃ³ message â†’ server respond
// 4. Browser reconnect NGAY Láº¬P
// 5. Láº·p láº¡i...

async function subscribe() {
  let response = await fetch("/subscribe");

  if (response.status === 502) {
    // Connection timeout (proxy/server Ä‘Ã³ng)
    // â†’ Reconnect ngay
    await subscribe();
  } else if (response.status !== 200) {
    // Lá»—i khÃ¡c â†’ Ä‘á»£i 1s rá»“i reconnect
    showMessage(response.statusText);
    await new Promise((r) => setTimeout(r, 1000));
    await subscribe();
  } else {
    // ThÃ nh cÃ´ng â†’ xá»­ lÃ½ message + reconnect
    let message = await response.text();
    showMessage(message);
    await subscribe(); // láº¥y message tiáº¿p
  }
}
subscribe();

// âš ï¸ Server cáº§n handle NHIá»€U pending connections cÃ¹ng lÃºc
// Node.js: OK (event-driven, non-blocking)
// PHP/Ruby: 1 process/connection â†’ tá»‘n memory!
// Cáº§n kiáº¿n trÃºc phÃ¹ há»£p (async, event-loop)

// âš ï¸ DÃ¹ng khi messages HIáº¾M
// Messages nhiá»u â†’ má»—i message = 1 request + headers overhead
// â†’ DÃ¹ng WebSocket hoáº·c Server-Sent Events thay tháº¿
```

### Tá»•ng Há»£p: Long Polling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LONG POLLING â€” SUMMARY                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Server giá»¯ connection Ä‘áº¿n khi cÃ³ data                       â”‚
â”‚  Browser reconnect ngay sau response                            â”‚
â”‚  502: reconnect ngay, error khÃ¡c: delay 1s                    â”‚
â”‚  Server: handle many pending connections                        â”‚
â”‚  Tá»‘t cho rare messages, nhiá»u â†’ WebSocket/SSE                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 75. WebSocket

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEBSOCKET                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Persistent bi-directional connection (RFC 6455)               â”‚
â”‚  ws:// / wss:// (luÃ´n Æ°u tiÃªn wss)                            â”‚
â”‚  Events: open / message / error / close                        â”‚
â”‚  send(string | Blob | ArrayBuffer)                             â”‚
â”‚  Handshake: HTTP Upgrade â†’ 101 Switching Protocols             â”‚
â”‚  Cross-origin by nature, khÃ´ng háº¡n cháº¿                       â”‚
â”‚  KhÃ´ng built-in reconnection                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÆ¡ Báº£n: Káº¿t Ná»‘i, Events & Handshake

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o WebSocket: luÃ´n dÃ¹ng wss:// (encrypted)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let socket = new WebSocket("wss://example.com/chat");
// wss = WebSocket over TLS (nhÆ° HTTPS)
// ws = khÃ´ng encrypted, proxy cÃ³ thá»ƒ cháº·n!

// 4 Events:
socket.onopen = (e) => {
  console.log("Connected!");
  socket.send("Hello Server"); // gá»­i text
};
socket.onmessage = (event) => {
  console.log(event.data); // nháº­n data
};
socket.onclose = (event) => {
  // event.wasClean: true náº¿u Ä‘Ã³ng sáº¡ch
  // event.code: 1000 (normal), 1006 (lost)
  // event.reason: lÃ½ do Ä‘Ã³ng
};
socket.onerror = (error) => console.log("Error!");

// Handshake (browser tá»± Ä‘á»™ng):
// Request:  Connection: Upgrade, Upgrade: websocket
//           Sec-WebSocket-Key, Sec-WebSocket-Version: 13
// Response: 101 Switching Protocols
//           Sec-WebSocket-Accept (verify key)
// âš ï¸ KhÃ´ng thá»ƒ emulate báº±ng XHR/fetch!

// Subprotocols:
let ws = new WebSocket(url, ["soap", "wamp"]);
// Server chá»n protocol há»— trá»£ trong response
```

### Data Transfer, Rate Limiting & Close

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Data frames: text / binary / ping-pong / close
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

socket.send("text");           // string
socket.send(new Blob([...]));  // binary
socket.send(new ArrayBuffer()); // binary

// binaryType: "blob" (default) hoáº·c "arraybuffer"
socket.binaryType = "arraybuffer";
socket.onmessage = (e) => {
  // e.data: string (text) hoáº·c ArrayBuffer (binary)
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Rate limiting: bufferedAmount
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

setInterval(() => {
  if (socket.bufferedAmount === 0) {
    socket.send(moreData()); // chá»‰ gá»­i khi buffer trá»‘ng
  }
}, 100);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Close: code + reason
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

socket.close(1000, "Work complete"); // normal close
// Codes: 1000 (normal), 1006 (lost, khÃ´ng set thá»§ cÃ´ng)
//        1001 (going away), 1009 (message too big)
//        1011 (server error). < 1000 reserved!

// readyState:
// 0 = CONNECTING, 1 = OPEN, 2 = CLOSING, 3 = CLOSED

// âš ï¸ Cross-origin: khÃ´ng háº¡n cháº¿ (khÃ¡c fetch/XHR)
// âš ï¸ KhÃ´ng cÃ³ built-in reconnection, auth, high-level features
// â†’ DÃ¹ng libraries (Socket.io, ws) hoáº·c tá»± implement
```

### Tá»•ng Há»£p: WebSocket

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEBSOCKET â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new WebSocket("wss://...") â†’ persistent connection           â”‚
â”‚  Events: open/message/error/close                              â”‚
â”‚  send(string|Blob|ArrayBuffer)                                 â”‚
â”‚  Handshake: Upgrade â†’ 101 Switching Protocols                 â”‚
â”‚  Close codes: 1000 normal, 1006 lost                           â”‚
â”‚  readyState: 0â†’3 (CONNECTINGâ†’CLOSED)                         â”‚
â”‚  bufferedAmount: rate limiting                                  â”‚
â”‚  Cross-origin OK, khÃ´ng built-in reconnection                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 76. Server-Sent Events (SSE)

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVER-SENT EVENTS (SSE)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  One-directional: server â†’ client (khÃ¡c WebSocket)            â”‚
â”‚  Chá»‰ text data, regular HTTP                                   â”‚
â”‚  Auto-reconnect built-in (Æ°u tháº¿ vs WebSocket)                â”‚
â”‚  Message ids + Last-Event-ID on reconnect                      â”‚
â”‚  Server: Content-Type: text/event-stream                       â”‚
â”‚  EventSource > WebSocket khi chá»‰ cáº§n nháº­n data              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EventSource: Káº¿t Ná»‘i, Messages & Reconnect

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o EventSource:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let source = new EventSource("/events");
// Cross-origin:
let source2 = new EventSource("https://other.com/events", {
  withCredentials: true, // gá»­i cookies cross-origin
});

// Events:
source.onmessage = (event) => {
  console.log(event.data); // message data
};
source.onopen = () => console.log("Connected!");
source.onerror = () => console.log("Error/reconnecting");
source.close(); // Ä‘Ã³ng connection (khÃ´ng reopen Ä‘Æ°á»£c!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Auto-reconnect (built-in!):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Server set delay: retry: 15000 (ms)
// 204 response: ngá»«ng reconnect
// Sai Content-Type hoáº·c status: ngá»«ng reconnect

// Message id + resume:
// Server gá»­i: data: ... \n id: 1 \n\n
// Browser lÆ°u: source.lastEventId = "1"
// Reconnect gá»­i header: Last-Event-ID: 1
// Server gá»­i láº¡i messages sau id 1

// readyState:
// 0 = CONNECTING, 1 = OPEN, 2 = CLOSED
```

### Server Response Format & Custom Events

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Server response: Content-Type: text/event-stream
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Fields:
// data: message body (nhiá»u data: = 1 message vá»›i \n)
// id: renews lastEventId (gá»­i Last-Event-ID on reconnect)
// retry: delay reconnect (ms), khÃ´ng set tá»« JS
// event: custom event name (pháº£i trÆ°á»›c data:)
// Messages phÃ¢n cÃ¡ch bá»Ÿi \n\n

// Server gá»­i:
// event: join\n
// data: Bob\n\n
//
// data: Hello\n\n
//
// event: leave\n
// data: Bob\n\n

// Custom events dÃ¹ng addEventListener (khÃ´ng dÃ¹ng onmessage):
source.addEventListener("join", (e) => {
  console.log(`Joined: ${e.data}`); // Bob
});
source.addEventListener("message", (e) => {
  console.log(`Said: ${e.data}`); // Hello
});
source.addEventListener("leave", (e) => {
  console.log(`Left: ${e.data}`); // Bob
});

// âš ï¸ SSE vs WebSocket:
// SSE: one-way (serverâ†’client), text, HTTP, auto-reconnect
// WebSocket: bi-directional, text+binary, WS protocol
// SSE Ä‘á»§ khi chá»‰ cáº§n nháº­n data (chat, prices, notifications)
```

### Tá»•ng Há»£p: Server-Sent Events

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSE â€” SUMMARY                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  new EventSource(url, {withCredentials})                       â”‚
â”‚  One-way: server â†’ client (text only, HTTP)                  â”‚
â”‚  Auto-reconnect + retry: (ms) + 204 stops                     â”‚
â”‚  id: + lastEventId + Last-Event-ID header                     â”‚
â”‚  event: custom events (addEventListener)                       â”‚
â”‚  readyState: 0(CONNECTING) / 1(OPEN) / 2(CLOSED)              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 77. SSE: HTML Spec Deep Dive

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSE: HTML SPEC DEEP DIVE                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Processing: announce / reestablish / fail                     â”‚
â”‚  Parsing: UTF-8, CRLF/LF/CR, : comment â†’ keepalive           â”‚
â”‚  Fields: data (append+\n), id (no NULL), retry (digits)       â”‚
â”‚  Dispatch: empty data skip, trailing \n removed                â”‚
â”‚  Authoring: 15s keepalive, 6 conn/domain, SharedWorker         â”‚
â”‚  GC: strong ref while listeners active                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Processing Model & Stream Parsing

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Processing Model: 3 tráº¡ng thÃ¡i chuyá»ƒn Ä‘á»•i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Announce connection:
//   readyState = OPEN, fire "open" event

// Reestablish connection (máº¥t káº¿t ná»‘i):
//   readyState = CONNECTING, fire "error" event
//   Äá»£i reconnection time (retry:)
//   CÃ³ thá»ƒ exponential backoff náº¿u fail liÃªn tá»¥c
//   Gá»­i Last-Event-ID header náº¿u cÃ³ lastEventId
//   Gá»i láº¡i fetch vá»›i cÃ¹ng request

// Fail connection (fatal):
//   readyState = CLOSED, fire "error" event
//   KHÃ”NG reconnect
//   Xáº£y ra khi: status != 200, Content-Type != text/event-stream

// Constructor internals:
// - cache mode: "no-store" (khÃ´ng cache!)
// - Set (Accept, text/event-stream) header
// - CORS: Anonymous hoáº·c Use Credentials

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Stream Parsing: UTF-8, line endings
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// MIME: text/event-stream (luÃ´n UTF-8, khÃ´ng Ä‘á»•i encoding)
// Line endings: CRLF (\r\n), LF (\n), CR (\r)
// Blank line (\n\n): dispatch event
// Line báº¯t Ä‘áº§u ":" â†’ COMMENT (bá»‹ ignore)
//   â†’ DÃ¹ng lÃ m keepalive má»—i 15s chá»‘ng proxy timeout!

// Server gá»­i keepalive:
// : keepalive\n\n     â† comment, browser ignore
// : \n\n               â† cÅ©ng lÃ  comment
```

### Field Interpretation & Dispatch Rules

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 4 Fields (so sÃ¡nh literal, case-sensitive):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// "data": APPEND vÃ o data buffer + thÃªm \n
//   nhiá»u data: = 1 message (join báº±ng \n)
//   VÃ­ dá»¥: data: YHOO\n data: +2\n\n
//   â†’ event.data = "YHOO\n+2" (trailing \n bá»‹ xÃ³a)

// "id": set last event ID buffer
//   âš ï¸ Náº¿u chá»©a U+0000 NULL â†’ IGNORE!
//   id khÃ´ng cÃ³ value ("id\n") â†’ reset vá» ""
//   â†’ KhÃ´ng gá»­i Last-Event-ID khi reconnect

// "retry": chá»‰ cháº¥p nháº­n ASCII DIGITS
//   retry: 15000 â†’ OK, retry: abc â†’ IGNORE

// "event": set event type buffer
//   KhÃ´ng cÃ³ event: â†’ type = "message" (default)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Dispatch Rules:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Set lastEventId tá»« last event ID buffer
// 2. Data buffer rá»—ng ("") â†’ KHÃ”NG dispatch, reset buffers
// 3. XÃ³a trailing \n cuá»‘i data buffer
// 4. Táº¡o MessageEvent: type, data, origin, lastEventId
// 5. Event type = event buffer hoáº·c "message" (default)
// 6. Reset data buffer + event type buffer

// âš ï¸ File káº¿t thÃºc giá»¯a event (khÃ´ng cÃ³ blank line) â†’ DISCARD
// âš ï¸ id khÃ´ng cÃ³ trong event hiá»‡n táº¡i â†’ giá»¯ lastEventId cÅ©
// âš ï¸ Space sau ":" lÃ  optional ("data:test" = "data: test")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Authoring Notes (thá»±c táº¿ quan trá»ng!):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Keepalive: gá»­i comment (: ...) má»—i 15s
//    chá»‘ng proxy timeout cáº¯t connection

// 2. Per-server connection limit: HTTP/1.1 = 6 conn/domain
//    Nhiá»u tabs má»Ÿ EventSource cÃ¹ng domain â†’ háº¿t slots!
//    Giáº£i phÃ¡p: SharedWorker chia sáº» 1 EventSource
//    hoáº·c unique subdomain má»—i connection

// 3. HTTP chunking cÃ³ thá»ƒ gÃ¢y delay báº¥t ngá»
//    â†’ Disable chunking cho event streams

// 4. GC: browser giá»¯ strong ref Ä‘áº¿n EventSource khi:
//    - CONNECTING + cÃ³ open/message/error listeners
//    - OPEN + cÃ³ message/error listeners
//    Document unload â†’ forcibly close
```

### Tá»•ng Há»£p: SSE Spec Internals

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSE SPEC INTERNALS â€” SUMMARY                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Announce: OPEN + open event                                   â”‚
â”‚  Reestablish: CONNECTING + error + wait retry                 â”‚
â”‚  Fail: CLOSED + error (status!=200, wrong Content-Type)        â”‚
â”‚  data: append + \n, trailing \n removed on dispatch            â”‚
â”‚  id: no NULL allowed, empty id resets                          â”‚
â”‚  Comment (: ...) má»—i 15s chá»‘ng proxy timeout                  â”‚
â”‚  6 conn/domain limit â†’ SharedWorker                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 78. Web Workers

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEB WORKERS                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Background threads, khÃ´ng block UI                            â”‚
â”‚  Dedicated Worker: 1 script â†’ 1 worker                       â”‚
â”‚  Shared Worker: nhiá»u scripts/tabs cÃ¹ng dÃ¹ng                   â”‚
â”‚  postMessage/onmessage: data COPIED (structured clone)         â”‚
â”‚  Transferable: zero-copy (ArrayBuffer cleared after)           â”‚
â”‚  KhÃ´ng DOM, khÃ´ng window, cÃ³ fetch/WebSocket/IndexedDB        â”‚
â”‚  terminate(), importScripts(), subworkers                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Dedicated Worker: Táº¡o, Gá»­i/Nháº­n & Terminate

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o Dedicated Worker
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const worker = new Worker("worker.js");
// Bundler-friendly:
const worker2 = new Worker(new URL("worker.js", import.meta.url));

// Main thread gá»­i message:
worker.postMessage([10, 20]); // gá»­i array
worker.postMessage({ type: "calc", data: 42 }); // gá»­i object

// Main thread nháº­n message:
worker.onmessage = (e) => {
  console.log(e.data); // káº¿t quáº£ tá»« worker
};

// Worker (worker.js):
// onmessage = (e) => {
//   const result = e.data[0] * e.data[1];
//   postMessage(result);  // gá»­i vá» main
// };
// âš ï¸ Trong worker: onmessage/postMessage trá»±c tiáº¿p
//    (worker = global scope, khÃ´ng cáº§n worker.xxx)
// âš ï¸ Main thread: worker.onmessage / worker.postMessage

// Terminate:
worker.terminate(); // kill ngay láº­p tá»©c

// Error handling:
worker.onerror = (e) => {
  // e.message, e.filename, e.lineno
  console.error(e.message);
};

// Import scripts (trong worker):
// importScripts("foo.js", "bar.js");
// Synchronous! Download báº¥t ká»³ thá»© tá»±, execute theo thá»© tá»±

// Subworkers: worker táº¡o worker con
// Pháº£i cÃ¹ng origin, URI relative to parent worker
```

### Shared Worker & Data Transfer

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Shared Worker: nhiá»u tabs/scripts cÃ¹ng dÃ¹ng
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const shared = new SharedWorker("worker.js");
// Pháº£i dÃ¹ng PORT Ä‘á»ƒ communicate:
shared.port.postMessage([5, 3]);
shared.port.onmessage = (e) => console.log(e.data);
// port.start() cáº§n gá»i náº¿u dÃ¹ng addEventListener

// Worker (shared):
// onconnect = (e) => {
//   const port = e.ports[0];
//   port.onmessage = (e) => {
//     port.postMessage(e.data[0] * e.data[1]);
//   };
// };
// âš ï¸ Browsing contexts pháº£i cÃ¹ng origin!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Data Transfer: 3 cÃ¡ch
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Structured Clone (default): copy, há»— trá»£ JSON + circular ref
worker.postMessage({ date: new Date() }); // deep copy

// 2. Transferable: zero-copy, original cleared!
const buffer = new ArrayBuffer(1024 * 1024 * 32); // 32MB
worker.postMessage(buffer, [buffer]); // transfer ownership
// buffer.byteLength === 0 sau transfer!

// 3. SharedArrayBuffer: shared memory (cáº£ 2 thread tháº¥y)
// Cáº§n cáº©n tháº­n: determinism, security concerns

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Embedded Worker (Blob URL):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function fn2workerURL(fn) {
  const blob = new Blob([`(${fn.toString()})()`], {
    type: "text/javascript",
  });
  return URL.createObjectURL(blob);
}
const inlineWorker = new Worker(
  fn2workerURL(() => {
    onmessage = (e) => postMessage(e.data * 2);
  }),
);

// âš ï¸ Thread Safety:
// KhÃ´ng DOM, khÃ´ng window (dÃ¹ng self)
// CÃ³: fetch, WebSocket, IndexedDB, setTimeout, Math, Array...
// Serialized communication â†’ khÃ³ gÃ¢y race condition
// CSP riÃªng (khÃ´ng inherit parent), trá»« blob/data URL

// Other Workers:
// ServiceWorker: proxy, offline, push notifications
// Audio Worklet: xá»­ lÃ½ audio real-time (lightweight)
```

### Tá»•ng Há»£p: Web Workers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WEB WORKERS â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Dedicated: new Worker("file.js"), 1:1                         â”‚
â”‚  Shared: new SharedWorker, PORT communication                  â”‚
â”‚  postMessage/onmessage: structured clone (copy)                â”‚
â”‚  Transferable: zero-copy, original cleared                     â”‚
â”‚  SharedArrayBuffer: shared memory                              â”‚
â”‚  KhÃ´ng DOM/window, cÃ³ fetch/WS/IndexedDB                     â”‚
â”‚  terminate(), importScripts(), embedded via Blob               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 79. Worker: Functions & APIs Available

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKER: FUNCTIONS & APIS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CÃ“: fetch, XHR, WebSocket, SSE, IndexedDB                     â”‚
â”‚  CÃ“: Canvas, WebGL, WebGPU, Web Crypto, Streams                â”‚
â”‚  CÃ“: setTimeout/setInterval, structuredClone                   â”‚
â”‚  CÃ“: Performance, Notifications, Push API                      â”‚
â”‚  KHÃ”NG: DOM, window, document, localStorage                   â”‚
â”‚  WORKER-ONLY: importScripts()                                  â”‚
â”‚  DEDICATED-ONLY: rAF, postMessage trá»±c tiáº¿p                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### WorkerGlobalScope Functions & Web APIs

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WorkerGlobalScope: functions cÃ³ sáºµn
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Timer:      setTimeout, setInterval, clearTimeout, clearInterval
// Encoding:   atob(), btoa()
// Network:    fetch()
// Clone:      structuredClone()
// Microtask:  queueMicrotask()
// Error:      reportError()
// Image:      createImageBitmap()

// â•â•â• WORKER-ONLY (khÃ´ng cÃ³ á»Ÿ main thread) â•â•â•
// importScripts("foo.js", "bar.js") â€” synchronous

// â•â•â• DEDICATED WORKER-ONLY â•â•â•
// postMessage()  â€” gá»­i vá» main thread
// requestAnimationFrame() / cancelAnimationFrame()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Web APIs cÃ³ trong Worker (phÃ¢n nhÃ³m):
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ğŸ“¦ Storage:     IndexedDB, Cache Storage (Cookie Store: SW only)
// ğŸŒ Network:     Fetch, XMLHttpRequest, WebSocket, SSE
// ğŸ¨ Graphics:    Canvas, WebGL, WebGPU
// ğŸ” Crypto:      Web Crypto, Web Locks
// ğŸ¥ Media:       MediaCapabilities, WebCodecs
//                MediaSource (dedicated only)
// ğŸ”” Background:  BackgroundFetch, BackgroundSync, Push, Notifications
// ğŸ“¡ Streams:     Streams API, Compression Streams
// ğŸ› ï¸ Utilities:   URL, Encoding, Console, Performance, Permissions
//                BroadcastChannel, Channel Messaging
//                Trusted Types, File API, File System API
//                Prioritized Task Scheduling

// ğŸ”§ Worker-related: Worker, WorkerGlobalScope,
//                    WorkerLocation, WorkerNavigator

// âŒ KHÃ”NG CÃ“ trong Worker:
// - DOM (document, Element, etc.)
// - window object
// - alert(), confirm(), prompt()
// - localStorage, sessionStorage (dÃ¹ng IndexedDB thay tháº¿)
// - Synchronous XHR (khÃ´ng cÃ³ responseXML)
```

### Tá»•ng Há»£p: Worker APIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKER APIs â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CÃ“: fetch/XHR/WS/SSE, IndexedDB, Canvas/WebGL/WebGPU         â”‚
â”‚  CÃ“: Web Crypto, Streams, Performance, Notifications           â”‚
â”‚  CÃ“: setTimeout, structuredClone, queueMicrotask               â”‚
â”‚  WORKER-ONLY: importScripts()                                  â”‚
â”‚  DEDICATED-ONLY: postMessage, rAF                              â”‚
â”‚  KHÃ”NG: DOM, window, alert, localStorage                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 80. Structured Clone Algorithm

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRUCTURED CLONE ALGORITHM                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Deep copy: recursion + cycle detection map                    â”‚
â”‚  DÃ¹ng: structuredClone(), postMessage(), IndexedDB             â”‚
â”‚  âœ“ Array, Object, Map, Set, Date, RegExp, Error, TypedArray   â”‚
â”‚  âœ“ Blob, File, ImageBitmap, ImageData, CryptoKey              â”‚
â”‚  âœ— Functions â†’ DataCloneError                                  â”‚
â”‚  âœ— DOM nodes â†’ DataCloneError                                  â”‚
â”‚  âœ— Symbol, prototype chain, property descriptors               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Limitations & Supported Types

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Structured Clone: deep copy vá»›i cycle detection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// DÃ¹ng á»Ÿ Ä‘Ã¢u:
// - structuredClone(value)
// - postMessage() (Workers)
// - IndexedDB (lÆ°u objects)
// - history.pushState()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ— KHÃ”NG CLONE ÄÆ¯á»¢C:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Functions â†’ DataCloneError!
structuredClone({ fn: () => {} }); // âŒ DataCloneError

// 2. DOM nodes â†’ DataCloneError!
structuredClone(document.body); // âŒ DataCloneError

// 3. Symbol â†’ khÃ´ng Ä‘Æ°á»£c clone
structuredClone({ [Symbol("key")]: "val" }); // Symbol bá»‹ máº¥t

// 4. Property descriptors KHÃ”NG preserved:
const obj = {};
Object.defineProperty(obj, "x", {
  value: 1,
  writable: false,
  enumerable: true,
});
const clone = structuredClone(obj);
// clone.x writable = true (default!) â† descriptor máº¥t

// 5. Prototype chain KHÃ”NG walked/duplicated:
class Dog {
  bark() {}
}
const dog = new Dog();
const cloneDog = structuredClone(dog);
// cloneDog instanceof Dog â†’ false!
// cloneDog.bark â†’ undefined!

// 6. RegExp lastIndex KHÃ”NG preserved:
const re = /abc/g;
re.exec("abcabc"); // lastIndex = 3
structuredClone(re).lastIndex; // 0 (reset!)

// 7. Getters/Setters â†’ giÃ¡ trá»‹ tÄ©nh:
const computed = {
  get now() {
    return Date.now();
  },
};
// Clone chá»‰ láº¥y value, khÃ´ng clone getter

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ“ CLONE ÄÆ¯á»¢C â€” JavaScript Types:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Primitives:  string, number, boolean, null, undefined, bigint
//              (KHÃ”NG symbol)
// Objects:     plain objects (object literals) only
// Collections: Array, Map, Set
// Binary:      ArrayBuffer, TypedArray (Uint8Array...), DataView
// Date/RegExp: Date âœ“, RegExp âœ“ (nhÆ°ng lastIndex = 0)
// Error:       Error, TypeError, RangeError, ReferenceError,
//              SyntaxError, EvalError, URIError
//              â†’ serialize: name, message, stack, cause
//              â†’ tÃªn khÃ¡c â†’ set thÃ nh "Error"
// Boolean/Number/String: wrapper objects âœ“

// âš ï¸ Circular references â†’ OK!
const circular = { a: 1 };
circular.self = circular;
structuredClone(circular); // âœ“ khÃ´ng infinite loop

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ“ CLONE ÄÆ¯á»¢C â€” Web/API Types:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// File/Blob:    Blob, File, FileList
// Image:        ImageBitmap, ImageData
// Crypto:       CryptoKey
// DOM Geometry: DOMMatrix, DOMPoint, DOMQuad, DOMRect
//               (+ ReadOnly variants)
// Error:        DOMException (name + message)
// Media:        AudioData, VideoFrame,
//               EncodedAudioChunk, EncodedVideoChunk
// FileSystem:   FileSystemDirectoryHandle, FileSystemFileHandle
// WebRTC:       RTCCertificate, RTCEncodedAudioFrame
// GPU:          GPUCompilationInfo, GPUCompilationMessage
//
// Marked [Serializable] in Web IDL spec
```

### Tá»•ng Há»£p: Structured Clone

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STRUCTURED CLONE â€” SUMMARY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Deep copy + cycle detection (no infinite loop)                â”‚
â”‚  âœ“ Primitives (trá»« Symbol), plain Objects, Array/Map/Set       â”‚
â”‚  âœ“ Date, RegExp (lastIndex=0), Error (name+message+stack)      â”‚
â”‚  âœ“ ArrayBuffer, TypedArray, Blob, File, ImageBitmap            â”‚
â”‚  âœ— Functions, DOM nodes â†’ DataCloneError                       â”‚
â”‚  âœ— Property descriptors, getters/setters, prototype chain      â”‚
â”‚  âœ— Class private fields, Symbol                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 81. Transferable Objects

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRANSFERABLE OBJECTS                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Transfer ownership: original Ä‘Æ°á»£c DETACH, khÃ´ng copy         â”‚
â”‚  Zero-copy cho ArrayBuffer (byteLength = 0 sau transfer)       â”‚
â”‚  postMessage(data, [transferList])                              â”‚
â”‚  structuredClone(data, { transfer: [...] })                    â”‚
â”‚  TypedArray: serializable nhÆ°ng KHÃ”NG transferable            â”‚
â”‚  Pháº£i transfer .buffer (ArrayBuffer) thay vÃ¬ TypedArray        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Transfer vá»›i postMessage & structuredClone

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Transfer vá»›i postMessage (Worker)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Táº¡o 8MB buffer:
const uInt8Array = new Uint8Array(1024 * 1024 * 8).map((v, i) => i);
console.log(uInt8Array.byteLength); // 8388608

// Transfer underlying buffer Ä‘áº¿n worker:
worker.postMessage(uInt8Array, [uInt8Array.buffer]);
console.log(uInt8Array.byteLength); // 0 â† DETACHED!
// âš ï¸ uInt8Array khÃ´ng dÃ¹ng Ä‘Æ°á»£c ná»¯a, read/write â†’ throw!

// âš ï¸ TypedArray (Uint8Array, Int32Array...) lÃ  SERIALIZABLE
//    nhÆ°ng KHÃ”NG transferable!
//    Pháº£i transfer .buffer (ArrayBuffer):
worker.postMessage(uInt8Array, [uInt8Array.buffer]); // âœ…
// worker.postMessage(uInt8Array, [uInt8Array]);     // âŒ Lá»—i!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Transfer vá»›i structuredClone
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const original = new Uint8Array(1024);

// Clone (copy):
const clone = structuredClone(original);
console.log(original.byteLength); // 1024 (váº«n Ä‘Ã³)
console.log(clone.byteLength); // 1024

// Clone + Transfer (move):
const transferred = structuredClone(original, {
  transfer: [original.buffer], // transfer .buffer, khÃ´ng pháº£i TypedArray
});
console.log(transferred.byteLength); // 1024
console.log(original.byteLength); // 0 â† DETACHED!

// âš ï¸ Transferred resources PHáº¢I attach vÃ o data object!
//    Transfer array chá»‰ chá»‰ Ä‘á»‹nh CÃCH gá»­i, khÃ´ng tá»± gá»­i data

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Supported Transferable Objects:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ğŸ“¦ Buffer:   ArrayBuffer
// ğŸ“¨ Messaging: MessagePort
// ğŸ¨ Graphics:  ImageBitmap, OffscreenCanvas
// ğŸ¥ Media:     AudioData, VideoFrame,
//              MediaSourceHandle, MediaStreamTrack
// ğŸ“¡ Streams:   ReadableStream, WritableStream, TransformStream
// ğŸ”— Other:     RTCDataChannel, MIDIAccess
//
// Marked [Transferable] in Web IDL spec
// âš ï¸ KhÃ¡c vá»›i [Serializable] (clone Ä‘Æ°á»£c nhÆ°ng khÃ´ng transfer)
```

### Tá»•ng Há»£p: Transferable Objects

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TRANSFERABLE OBJECTS â€” SUMMARY                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Transfer = move ownership (zero-copy, original detached)      â”‚
â”‚  postMessage(data, [transferList])                              â”‚
â”‚  structuredClone(data, { transfer: [...] })                    â”‚
â”‚  TypedArray: serializable, KHÃ”NG transferable                  â”‚
â”‚  Transfer .buffer (ArrayBuffer) thay vÃ¬ TypedArray             â”‚
â”‚  Supported: ArrayBuffer, MessagePort, Streams, ImageBitmap    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 82. Worker Interfaces Deep Dive

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKER INTERFACES                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  EventTarget â†’ WorkerGlobalScope â†’ Dedicated/Shared/Service  â”‚
â”‚  Worker: constructor, postMessage, terminate                   â”‚
â”‚  SharedWorker: constructor, port (MessagePort)                 â”‚
â”‚  WorkerGlobalScope: self, fetch, importScripts, IndexedDB      â”‚
â”‚  WorkerLocation: URL subset (href, origin, pathname...)        â”‚
â”‚  WorkerNavigator: Navigator subset (onLine, hardwareConcurrency)â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Worker & SharedWorker (Main Thread Side)

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Worker (Dedicated) â€” Main thread API
// EventTarget â†’ Worker
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const worker = new Worker("/worker.js");
// CÃ³ thá»ƒ dÃ¹ng Blob URLs

// Methods:
worker.postMessage(data); // gá»­i message
worker.postMessage(data, [buf]); // gá»­i + transfer
worker.terminate(); // kill ngay, khÃ´ng dá»n dáº¹p
// âš ï¸ ServiceWorker KHÃ”NG há»— trá»£ terminate()

// Events:
worker.onmessage = (e) => {}; // nháº­n message
worker.onerror = (e) => {}; // runtime error
worker.onmessageerror = (e) => {}; // deserialize fail

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SharedWorker â€” Main thread API
// EventTarget â†’ SharedWorker
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const shared = new SharedWorker("worker.js");

// Properties:
shared.port; // MessagePort â€” kÃªnh giao tiáº¿p duy nháº¥t!

// Communication qua port:
shared.port.postMessage(data);
shared.port.onmessage = (e) => {};
// âš ï¸ port.start() cáº§n gá»i náº¿u dÃ¹ng addEventListener

// Events:
shared.onerror = (e) => {};

// âš ï¸ SharedWorker alive khi cÃ²n Document/Worker giá»¯ reference
// âš ï¸ All browsing contexts pháº£i cÃ¹ng origin
```

### DedicatedWorkerGlobalScope & SharedWorkerGlobalScope

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DedicatedWorkerGlobalScope (self trong dedicated worker)
// EventTarget â†’ WorkerGlobalScope â†’ DedicatedWorkerGlobalScope
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Properties:
// self.name      â€” tÃªn worker (Ä‘áº·t khi new Worker(url, {name}))

// Methods:
// close()        â€” dá»«ng, há»§y tasks trong event loop
// postMessage()  â€” gá»­i vá» main thread
// requestAnimationFrame(cb) â€” cho OffscreenCanvas
// cancelAnimationFrame(id)

// Events:
// message        â€” nháº­n message tá»« main
// messageerror   â€” deserialize fail

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SharedWorkerGlobalScope (self trong shared worker)
// EventTarget â†’ WorkerGlobalScope â†’ SharedWorkerGlobalScope
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Properties:
// self.name      â€” tÃªn shared worker

// Methods:
// close()        â€” dá»«ng, há»§y tasks

// Events:
// connect        â€” client má»›i káº¿t ná»‘i
// onconnect = (e) => {
//   const port = e.ports[0];
//   port.onmessage = (e) => { port.postMessage(result); };
//   port.start(); // cáº§n náº¿u dÃ¹ng addEventListener
// };
```

### WorkerGlobalScope, WorkerLocation & WorkerNavigator

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WorkerGlobalScope (base class cho má»i worker)
// EventTarget â†’ WorkerGlobalScope
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Properties (read only):
// self           â€” reference tá»›i global scope
// location       â€” WorkerLocation (URL info)
// navigator      â€” WorkerNavigator (device info)
// caches         â€” CacheStorage (offline)
// crypto         â€” Crypto object
// indexedDB      â€” IDBFactory
// isSecureContext â€” boolean HTTPS
// origin         â€” origin string
// performance    â€” Performance (subset)
// fonts          â€” FontFaceSet
// scheduler      â€” Prioritized Task Scheduling
// trustedTypes   â€” Trusted Types API

// Methods:
// fetch(), importScripts(), structuredClone()
// setTimeout/setInterval/clearTimeout/clearInterval
// atob(), btoa(), queueMicrotask(), reportError()
// createImageBitmap()

// Events:
// error             â€” runtime error
// online / offline  â€” network status thay Ä‘á»•i
// languagechange    â€” ngÃ´n ngá»¯ thay Ä‘á»•i
// unhandledrejection / rejectionhandled â€” Promise
// securitypolicyviolation â€” CSP vi pháº¡m

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WorkerLocation (self.location)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Subset cá»§a Location, read-only:
// href, protocol, host, hostname, origin
// port, pathname, search, hash
// toString() === href

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WorkerNavigator (self.navigator)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Subset cá»§a Navigator, read-only:
// onLine              â€” boolean, máº¡ng cÃ³/khÃ´ng
// hardwareConcurrency â€” sá»‘ lÃµi CPU
// language / languages
// userAgent / userAgentData
// connection          â€” NetworkInformation
// deviceMemory        â€” GB (lÃ m trÃ²n power of 2)
// locks               â€” Web Locks API
// permissions         â€” Permissions API
// storage             â€” StorageManager
// serviceWorker       â€” ServiceWorkerContainer
// gpu                 â€” WebGPU entry point
// serial              â€” Web Serial API
// usb                 â€” WebUSB API
// mediaCapabilities
// setAppBadge() / clearAppBadge()
```

### Tá»•ng Há»£p: Worker Interfaces

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WORKER INTERFACES â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Worker: postMessage, terminate, message/error events          â”‚
â”‚  SharedWorker: port (MessagePort), connect event               â”‚
â”‚  DedicatedScope: close, postMessage, rAF                       â”‚
â”‚  SharedScope: close, connect event                             â”‚
â”‚  WorkerGlobalScope: self, location, navigator, fetch,          â”‚
â”‚    caches, crypto, indexedDB, importScripts                    â”‚
â”‚  WorkerLocation: URL subset (href, origin, pathname...)        â”‚
â”‚  WorkerNavigator: onLine, hardwareConcurrency, locks, gpu      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 83. Service Worker API

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICE WORKER API                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Proxy giá»¯a app â†” browser â†” network                         â”‚
â”‚  Lifecycle: Download â†’ Install â†’ Activate                     â”‚
â”‚  HTTPS only (localhost OK)                                     â”‚
â”‚  KhÃ´ng DOM, khÃ´ng sync XHR, khÃ´ng localStorage               â”‚
â”‚  Cache-first strategy cho offline experience                   â”‚
â”‚  FetchEvent.respondWith() intercept requests                   â”‚
â”‚  skipWaiting() + clients.claim() force activation              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Lifecycle & Registration

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Service Worker Lifecycle:
// Download â†’ Install â†’ Activate
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Registration (main thread):
const registration = await navigator.serviceWorker.register("/sw.js", {
  scope: "/", // kiá»ƒm soÃ¡t táº¥t cáº£ URLs dÆ°á»›i origin
});

// Check tráº¡ng thÃ¡i:
if (registration.installing) console.log("Installing");
if (registration.waiting) console.log("Installed, waiting");
if (registration.active) console.log("Active");

// 2. Lifecycle:
// - Download: khi user access láº§n Ä‘áº§u, hoáº·c sau 24h
// - Install: file má»›i (byte-wise compare), fire install event
// - Worker-in-waiting: new version install nhÆ°ng chÆ°a activate
//   (chá» táº¥t cáº£ pages cÅ© Ä‘Ã³ng)
// - Activate: khi khÃ´ng cÃ²n pages dÃ¹ng old worker

// 3. Force activation (bá» qua waiting):
self.addEventListener("install", () => {
  self.skipWaiting(); // activate ngay, khÃ´ng Ä‘á»£i pages Ä‘Ã³ng
});
self.addEventListener("activate", () => {
  self.clients.claim(); // control pages Ä‘ang má»Ÿ ngay
});

// âš ï¸ Constraints:
// - HTTPS only (localhost OK)
// - KhÃ´ng DOM, khÃ´ng window
// - KhÃ´ng sync XHR, khÃ´ng localStorage
// - KhÃ´ng dynamic import() â€” chá»‰ static import
// - Fully async, promise-based
// - Scope máº·c Ä‘á»‹nh = directory chá»©a sw.js
//   (má»Ÿ rá»™ng vá»›i Service-Worker-Allowed header)
```

### Cache API & Fetch Interception

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Install: populate cache
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

self.addEventListener("install", (event) => {
  event.waitUntil(
    caches
      .open("v1")
      .then((cache) =>
        cache.addAll([
          "/",
          "/index.html",
          "/style.css",
          "/app.js",
          "/gallery/image1.jpg",
          "/gallery/image2.jpg",
        ]),
      ),
  );
  // waitUntil() Ä‘áº£m báº£o install khÃ´ng xong
  // cho Ä‘áº¿n khi cache Ä‘Æ°á»£c populate
  // Promise reject â†’ install lá»—i, worker khÃ´ng hoáº¡t Ä‘á»™ng
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Fetch: cache-first strategy
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

self.addEventListener("fetch", (event) => {
  event.respondWith(
    caches.match(event.request).then((cached) => {
      if (cached) return cached; // âœ“ cÃ³ trong cache

      return fetch(event.request)
        .then((response) => {
          // Clone response: stream chá»‰ Ä‘á»c 1 láº§n!
          // 1 báº£n cho browser, 1 báº£n cho cache
          const clone = response.clone();
          caches.open("v1").then((cache) => cache.put(event.request, clone));
          return response;
        })
        .catch(() => {
          // Offline fallback:
          return (
            caches.match("/fallback.html") ||
            new Response("Offline", {
              status: 408,
              headers: { "Content-Type": "text/plain" },
            })
          );
        });
    }),
  );
});

// âš ï¸ response.clone() báº¯t buá»™c vÃ¬ stream chá»‰ Ä‘á»c 1 láº§n
// âš ï¸ event.waitUntil() giá»¯ worker alive khi cache chÆ°a xong

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Activate: dá»n cache cÅ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

self.addEventListener("activate", (event) => {
  const keepList = ["v2"];
  event.waitUntil(
    caches
      .keys()
      .then((keys) =>
        Promise.all(
          keys
            .filter((k) => !keepList.includes(k))
            .map((k) => caches.delete(k)),
        ),
      ),
  );
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Navigation Preload (tá»‘i Æ°u startup delay)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

self.addEventListener("activate", (event) => {
  event.waitUntil(self.registration?.navigationPreload.enable());
});

self.addEventListener("fetch", (event) => {
  event.respondWith(
    (async function () {
      const cached = await caches.match(event.request);
      if (cached) return cached;

      // DÃ¹ng preload response náº¿u cÃ³ (song song vá»›i SW startup)
      const preloaded = await event.preloadResponse;
      if (preloaded) return preloaded;

      return fetch(event.request);
    })(),
  );
});
```

### Key Interfaces & Use Cases

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Key Interfaces:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Cache / CacheStorage:
//   caches.open(name)     â€” táº¡o/má»Ÿ cache
//   cache.addAll(urls)    â€” fetch + cache nhiá»u URLs
//   cache.put(req, res)   â€” lÆ°u response
//   cache.match(req)      â€” tÃ¬m trong cache
//   caches.delete(name)   â€” xÃ³a cache
//   caches.keys()         â€” danh sÃ¡ch tÃªn caches

// ServiceWorkerContainer (navigator.serviceWorker):
//   register(url, {scope}) â€” Ä‘Äƒng kÃ½ SW
//   ready                  â€” Promise<registration>
//   controller             â€” active SW controlling page

// ServiceWorkerRegistration:
//   installing / waiting / active
//   update()               â€” force check update
//   unregister()           â€” há»§y Ä‘Äƒng kÃ½
//   navigationPreload      â€” NavigationPreloadManager

// Events (trong ServiceWorkerGlobalScope):
//   install    â€” populate cache, waitUntil()
//   activate   â€” dá»n cache cÅ©, waitUntil()
//   fetch      â€” intercept requests, respondWith()
//   push       â€” push notifications
//   sync       â€” background sync
//   message    â€” tá»« client

// ExtendableEvent:
//   waitUntil(promise)   â€” giá»¯ SW alive

// FetchEvent:
//   request              â€” Request object
//   respondWith(response) â€” custom response
//   preloadResponse      â€” Promise (navigation preload)

// Client / Clients:
//   clients.claim()      â€” control open pages ngay
//   clients.matchAll()   â€” danh sÃ¡ch clients
//   client.postMessage()  â€” gá»­i message vá» page

// â•â•â• Use Cases â•â•â•
// - Offline-first PWA
// - Push notifications
// - Background sync
// - API mocking
// - Pre-fetching resources
// - Custom templating (URL patterns)
// - Centralized updates (geolocation, gyroscope)
```

### Tá»•ng Há»£p: Service Worker

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICE WORKER â€” SUMMARY                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Proxy: app â†” browser â†” network                             â”‚
â”‚  Lifecycle: Download â†’ Install â†’ Activate                     â”‚
â”‚  Install: caches.open + cache.addAll (waitUntil)               â”‚
â”‚  Fetch: respondWith(caches.match || fetch)                     â”‚
â”‚  Activate: dá»n cache cÅ©, clients.claim()                      â”‚
â”‚  skipWaiting() + clients.claim() = force activation            â”‚
â”‚  response.clone() vÃ¬ stream chá»‰ Ä‘á»c 1 láº§n                     â”‚
â”‚  Navigation preload giáº£m startup delay                        â”‚
â”‚  HTTPS only, no DOM, no localStorage, no dynamic import       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 84. History API

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HISTORY API                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  window.history â€” singleton, main thread only                  â”‚
â”‚  Navigate: back(), forward(), go(n)                            â”‚
â”‚  Modify: pushState() â€” thÃªm entry                              â”‚
â”‚          replaceState() â€” cáº­p nháº­t entry hiá»‡n táº¡i              â”‚
â”‚  popstate event â€” khi active history entry thay Ä‘á»•i            â”‚
â”‚  SPA: pushState + popstate = synthesize navigation             â”‚
â”‚  State: any serializable object, same-origin URL               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### History Interface & Properties

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// History â€” singleton (window.history)
// âš ï¸ Main thread only, KHÃ”NG cÃ³ trong Worker/Worklet
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Properties:
history.length; // sá»‘ entries trong session history
history.state; // state hiá»‡n táº¡i (read-only)
history.scrollRestoration; // 'auto' | 'manual'

// Navigation methods (async, silent náº¿u out-of-bounds):
history.back(); // === history.go(-1)
history.forward(); // === history.go(1)
history.go(-2); // lÃ¹i 2 trang
history.go(0); // reload trang hiá»‡n táº¡i
history.go(); // reload (khÃ´ng tham sá»‘)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// pushState & replaceState
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// pushState: THÃŠM entry má»›i vÃ o history stack
history.pushState(
  { page: 1 }, // state â€” any serializable object
  "", // title â€” luÃ´n truyá»n "" (bá»‹ ignore trá»« Safari)
  "?page=1", // url â€” same-origin, hiá»ƒn thá»‹ trÃªn URL bar
);

// replaceState: Cáº¬P NHáº¬T entry hiá»‡n táº¡i (khÃ´ng thÃªm má»›i)
history.replaceState({ page: 2 }, "", "?page=2");

// âš ï¸ pushState/replaceState KHÃ”NG trigger popstate!
// âš ï¸ URL pháº£i same-origin
// âš ï¸ State pháº£i serializable (structured clone)
// âš ï¸ title bá»‹ ignore bá»Ÿi háº§u háº¿t browsers
```

### popstate Event & SPA Pattern

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// popstate â€” fire khi active history entry thay Ä‘á»•i
// (back/forward button, history.back/forward/go)
// KHÃ”NG fire khi pushState/replaceState!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.addEventListener("popstate", (event) => {
  console.log(event.state); // copy of state object
  // event.hasUAVisualTransition â€” UA cÃ³ visual transition khÃ´ng
  if (event.state) {
    displayContent(event.state); // restore page
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SPA Pattern: pushState + popstate
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Initial page: replaceState Ä‘á»ƒ lÆ°u state ban Ä‘áº§u
history.replaceState(initialState, "", location.href);

// 2. Navigation: pushState khi user click link
document.addEventListener("click", async (e) => {
  const id = e.target.dataset.page;
  if (!id) return;
  e.preventDefault();

  const data = await fetch(`/api/${id}`).then((r) => r.json());
  displayContent(data);
  history.pushState(data, "", `/page/${id}`); // synthesize nav
});

// 3. Back/Forward: popstate Ä‘á»ƒ restore
window.addEventListener("popstate", (event) => {
  if (event.state) displayContent(event.state);
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VÃ­ dá»¥ thá»±c táº¿:
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

history.pushState({ page: 1 }, "", "?page=1");
history.pushState({ page: 2 }, "", "?page=2");
history.replaceState({ page: 3 }, "", "?page=3");
history.back();
// popstate: state = {page: 1}, URL = ?page=1
history.back();
// popstate: state = null, URL = original
history.go(2);
// popstate: state = {page: 3}, URL = ?page=3

// âš ï¸ Security:
// - KhÃ´ng access URLs cá»§a pages khÃ¡c
// - KhÃ´ng clear/disable history
// - location.replace() thay tháº¿ entry hiá»‡n táº¡i
// âš ï¸ Edge cases:
// - popstate: window.location Ä‘Ã£ update nhÆ°ng document
//   cÃ³ thá»ƒ chÆ°a sáºµn sÃ ng â†’ dÃ¹ng setTimeout(fn, 0)
// - Browsers cÃ³ thá»ƒ khÃ´ng fire popstate náº¿u page
//   chÆ°a Ä‘Æ°á»£c interact
```

### Tá»•ng Há»£p: History API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HISTORY API â€” SUMMARY                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Navigate: back(), forward(), go(n) â€” async, silent            â”‚
â”‚  pushState(state, "", url) â€” thÃªm entry, khÃ´ng reload          â”‚
â”‚  replaceState(state, "", url) â€” cáº­p nháº­t, khÃ´ng reload         â”‚
â”‚  popstate: fire khi back/forward, KHÃ”NG khi push/replace       â”‚
â”‚  event.state = copy of state object                            â”‚
â”‚  SPA: replaceState (init) + pushState (nav) + popstate (back)  â”‚
â”‚  URL must be same-origin, state must be serializable           â”‚
â”‚  scrollRestoration: 'auto' | 'manual'                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 85. Fetch API Deep Dive

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH API DEEP DIVE                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  fetch(url, options) â†’ Promise<Response>                       â”‚
â”‚  Promise-based, thay tháº¿ XMLHttpRequest                        â”‚
â”‚  Available: window + Worker contexts                           â”‚
â”‚  Body types: string, Blob, FormData, ReadableStream...         â”‚
â”‚  Mode: cors (default), same-origin, no-cors                    â”‚
â”‚  Credentials: omit, same-origin (default), include             â”‚
â”‚  Response: status/ok, body methods (json/text/blob...)          â”‚
â”‚  Streaming: response.body = ReadableStream                     â”‚
â”‚  Cancel: AbortController + signal                              â”‚
â”‚  fetchLater(): deferred fetch for end-of-visit beaconing       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Request: Method, Body & Headers

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Basics: fetch(url, options) â†’ Promise<Response>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const response = await fetch("https://api.example.com/data");
if (!response.ok) throw new Error(`Status: ${response.status}`);
const data = await response.json();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Method & Body
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// POST vá»›i JSON body:
await fetch(url, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ username: "example" }),
});

// Body types há»— trá»£:
// string, ArrayBuffer, TypedArray, DataView,
// Blob, File, URLSearchParams, FormData, ReadableStream

// URLSearchParams tá»± convert:
await fetch(url, {
  method: "POST",
  headers: { "Content-Type": "application/x-www-form-urlencoded" },
  body: new URLSearchParams({ user: "a", pass: "b" }),
  // â†’ "user=a&pass=b"
});

// GET vá»›i query string:
const params = new URLSearchParams({ q: "search" });
await fetch(`/api?${params}`); // /api?q=search

// âš ï¸ Body lÃ  stream â†’ chá»‰ dÃ¹ng 1 láº§n!
const req = new Request(url, { method: "POST", body: "..." });
await fetch(req); // OK
await fetch(req); // âŒ Body already consumed!
// Giáº£i phÃ¡p: req.clone() trÆ°á»›c khi fetch
const req2 = req.clone();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Headers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Object literal:
await fetch(url, {
  headers: { "Content-Type": "application/json" },
});

// Headers object (sanitization: lowercase, trim):
const h = new Headers();
h.append("Content-Type", "application/json");
h.append("X-Custom", "value");
await fetch(url, { headers: h });

// âš ï¸ Forbidden headers: browser tá»± set (Host, Cookie...)
// âš ï¸ no-cors mode: chá»‰ CORS-safelisted headers
```

### Cross-Origin, Credentials & Abort

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Mode: cors (default), same-origin, no-cors
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

await fetch(url, { mode: "cors" }); // default
// cors: CORS mechanism, preflight náº¿u not simple request
// same-origin: cross-origin â†’ reject
// no-cors: opaque response, methods chá»‰ GET/HEAD/POST
//          headers bá»‹ restrict â†’ dÃ¹ng cho Service Worker

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Credentials: cookies, TLS certs, Auth headers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

await fetch(url, { credentials: "same-origin" }); // default
// omit: khÃ´ng gá»­i, khÃ´ng nháº­n credentials
// same-origin: chá»‰ same-origin
// include: luÃ´n gá»­i, ká»ƒ cáº£ cross-origin

// âš ï¸ include + cross-origin:
// - Server PHáº¢I set Access-Control-Allow-Credentials: true
// - Access-Control-Allow-Origin PHáº¢I explicit (khÃ´ng *)
// - SameSite=Strict/Lax cookies váº«n khÃ´ng gá»­i cross-site

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AbortController: cancel request
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const controller = new AbortController();

fetch(url, { signal: controller.signal })
  .then((res) => res.json())
  .catch((e) => {
    if (e.name === "AbortError") console.log("Cancelled");
  });

controller.abort(); // â†’ AbortError

// âš ï¸ Abort sau fetch fulfilled nhÆ°ng trÆ°á»›c read body:
// â†’ read body cÅ©ng throw AbortError
```

### Response: Status, Body & Streaming

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Response object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const res = await fetch(url);

// Status:
res.status; // 200, 404, 500...
res.ok; // true náº¿u status 200-299
res.statusText; // 'OK', 'Not Found'...

// Type:
// 'basic'          â€” same-origin
// 'cors'           â€” cross-origin CORS
// 'opaque'         â€” no-cors, status=0, body=null
// 'opaqueredirect' â€” redirect='manual'

// Headers:
res.headers.get("Content-Type");

// Body methods (táº¥t cáº£ async, tráº£ Promise):
await res.json(); // parse JSON
await res.text(); // text string
await res.blob(); // Blob
await res.arrayBuffer(); // ArrayBuffer
await res.formData(); // FormData

// âš ï¸ Body chá»‰ Ä‘á»c 1 Láº¦N (stream)!
// Clone náº¿u cáº§n Ä‘á»c nhiá»u láº§n:
const clone = res.clone();
const data1 = await res.json();
const data2 = await clone.json(); // OK

// âš ï¸ fetch() KHÃ”NG reject khi 404/500!
// Chá»‰ reject: network error, bad scheme
// â†’ LuÃ´n check response.ok

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Streaming response body
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// response.body = ReadableStream
const stream = res.body.pipeThrough(new TextDecoderStream());
for await (const chunk of stream) {
  console.log(chunk); // xá»­ lÃ½ tá»«ng chunk
}

// Line-by-line processing (async generator):
async function* lineIterator(url) {
  const res = await fetch(url);
  const reader = res.body.pipeThrough(new TextDecoderStream()).getReader();
  let { value: chunk = "", done } = await reader.read();
  const re = /\r?\n/g;
  let start = 0;
  while (true) {
    const m = re.exec(chunk);
    if (!m) {
      if (done) break;
      const rest = chunk.slice(start);
      ({ value: chunk, done } = await reader.read());
      chunk = rest + (chunk || "");
      start = re.lastIndex = 0;
      continue;
    }
    yield chunk.substring(start, m.index);
    start = re.lastIndex;
  }
  if (start < chunk.length) yield chunk.substring(start);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// fetchLater(): deferred fetch for beaconing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Gá»­i khi tab Ä‘Ã³ng hoáº·c sau timeout:
fetchLater("/analytics", {
  method: "POST",
  body: JSON.stringify(analyticsData),
  activateAfter: 60000, // 60s timeout
});

// Quota: 640KiB/document
//   512KiB top-level, 128KiB shared (subframes)
//   Max 64KiB per origin
// QuotaExceededError náº¿u vÆ°á»£t quota
// AbortController Ä‘á»ƒ há»§y náº¿u khÃ´ng cáº§n
```

### Tá»•ng Há»£p: Fetch API

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FETCH API â€” SUMMARY                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  fetch(url, opts) â†’ Promise<Response>, KHÃ”NG reject khi 4xx/5xxâ”‚
â”‚  Body: string/Blob/FormData/URLSearchParams/ReadableStream     â”‚
â”‚  Body lÃ  stream â†’ chá»‰ Ä‘á»c 1 láº§n, clone() náº¿u cáº§n              â”‚
â”‚  Mode: cors(default)/same-origin/no-cors(opaque)               â”‚
â”‚  Credentials: same-origin(default)/include/omit                â”‚
â”‚  AbortController + signal â†’ cancel request                     â”‚
â”‚  Response: ok/status, json()/text()/blob() â€” táº¥t cáº£ async      â”‚
â”‚  Streaming: response.body = ReadableStream + TextDecoderStream â”‚
â”‚  fetchLater(): deferred beaconing, 640KiB quota                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 86. Cookies & document.cookie

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COOKIES & document.cookie                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Server Set-Cookie â†’ Browser tá»± gá»­i Cookie header              â”‚
â”‚  document.cookie: accessor (getter/setter)                     â”‚
â”‚  Write chá»‰ update cookie Ä‘Æ°á»£c mention, khÃ´ng ghi Ä‘Ã¨ táº¥t cáº£    â”‚
â”‚  Limits: 4KB/cookie, ~20+ cookies/domain                       â”‚
â”‚  Attributes: path, domain, expires/max-age, secure,            â”‚
â”‚              samesite (strict/lax/none), httpOnly               â”‚
â”‚  Third-party: cross-domain tracking, Safari block máº·c Ä‘á»‹nh     â”‚
â”‚  GDPR: explicit consent cho tracking cookies                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Read/Write & Attributes

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// document.cookie â€” accessor (getter/setter)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Read: tráº£ Táº¤T Cáº¢ cookies dáº¡ng "name1=val1; name2=val2"
alert(document.cookie);

// Write: chá»‰ update cookie ÄÆ¯á»¢C MENTION
document.cookie = "user=John"; // chá»‰ set 'user', khÃ´ng Ä‘Ã¨

// Encode kÃ½ tá»± Ä‘áº·c biá»‡t:
const name = "my name",
  value = "John Smith";
document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
// â†’ "my%20name=John%20Smith"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Limits:
// - 4KB/cookie (sau encode)
// - ~20+ cookies/domain (tÃ¹y browser)
// - Chá»‰ set/update 1 cookie/láº§n qua document.cookie
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Attributes: sau key=value, phÃ¢n cÃ¡ch bá»Ÿi ;
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.cookie = "user=John; path=/; expires=Tue, 19 Jan 2038 03:14:07 GMT";

// PATH:
// path=/ â†’ accessible má»i trang
// path=/admin â†’ chá»‰ /admin vÃ  /admin/*
// Default: current path

// DOMAIN:
// Máº·c Ä‘á»‹nh: chá»‰ domain set cookie
// domain=site.com â†’ accessible táº¡i *.site.com
// âš ï¸ KhÃ´ng set domain khÃ¡c 2nd-level domain
document.cookie = "user=John; domain=site.com"; // *.site.com OK

// EXPIRES / MAX-AGE:
// KhÃ´ng set â†’ session cookie (xÃ³a khi Ä‘Ã³ng browser/tab)
// expires: GMT date string
const date = new Date(Date.now() + 86400e3); // +1 ngÃ y
document.cookie = "user=John; expires=" + date.toUTCString();
// max-age: seconds tá»« hiá»‡n táº¡i (precedence over expires)
document.cookie = "user=John; max-age=3600"; // 1 giá»
// max-age=0 hoáº·c negative â†’ XÃ“A cookie ngay
document.cookie = "user=John; max-age=0";

// SECURE:
// Chá»‰ gá»­i qua HTTPS
document.cookie = "user=John; secure";

// HTTPONLY:
// âš ï¸ Chá»‰ set qua Set-Cookie header (server)
// JS KHÃ”NG access Ä‘Æ°á»£c â†’ báº£o vá»‡ khá»i XSS
// document.cookie KHÃ”NG tháº¥y httpOnly cookies
```

### SameSite, Third-Party & GDPR

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SameSite â€” báº£o vá»‡ XSRF (Cross-Site Request Forgery)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// samesite=strict:
// - KHÃ”NG gá»­i náº¿u request tá»« site KHÃC
// - Ká»ƒ cáº£ click link tá»« email â†’ khÃ´ng gá»­i cookie
// - An toÃ n nháº¥t nhÆ°ng user bá»‹ "logout" khi click link ngoÃ i
document.cookie = "session=abc; samesite=strict";

// samesite=lax (default náº¿u khÃ´ng set):
// - Gá»­i náº¿u: HTTP method safe (GET) VÃ€ top-level navigation
// - KhÃ´ng gá»­i: POST form, iframe, JS fetch tá»« site khÃ¡c
// - CÃ¢n báº±ng security + UX
document.cookie = "session=abc; samesite=lax";

// samesite=none:
// - LuÃ´n gá»­i (ká»ƒ cáº£ cross-site)
// - Báº®T BUá»˜C kÃ¨m secure (chá»‰ HTTPS)
// - DÃ¹ng cho cross-site legitimate (OAuth, embeds)
document.cookie = "session=abc; samesite=none; secure";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Third-Party Cookies
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Cookie Ä‘Æ°á»£c set bá»Ÿi domain KHÃC trang Ä‘ang truy cáº­p
// VÃ­ dá»¥: site.com load <img src="ads.com/banner">
//   â†’ ads.com set cookie id=1234
//   â†’ ads.com track user qua nhiá»u sites
//
// âš ï¸ Safari: block third-party cookies máº·c Ä‘á»‹nh
// âš ï¸ Chrome: phasing out third-party cookies
// âš ï¸ <script src="analytics.com"> set cookie
//    â†’ cookie thuá»™c domain HIá»†N Táº I (khÃ´ng pháº£i third-party)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GDPR (EU)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Tracking/identifying cookies â†’ Cáº¦N explicit consent
// Functional cookies (khÃ´ng track) â†’ khÃ´ng cáº§n consent
// 2 pattern phá»• biáº¿n:
//   1. Checkbox trong registration form
//   2. Modal splash screen cho newcomers

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Helper Functions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getCookie(name) {
  const matches = document.cookie.match(
    new RegExp(
      "(?:^|; )" +
        name.replace(/([.$?*|{}()\[\]\\\/+^])/g, "\\$1") +
        "=([^;]*)",
    ),
  );
  return matches ? decodeURIComponent(matches[1]) : undefined;
}

function setCookie(name, value, attrs = {}) {
  attrs = { path: "/", ...attrs };
  if (attrs.expires instanceof Date)
    attrs.expires = attrs.expires.toUTCString();
  let cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
  for (const [k, v] of Object.entries(attrs))
    cookie += "; " + k + (v === true ? "" : "=" + v);
  document.cookie = cookie;
}

function deleteCookie(name) {
  setCookie(name, "", { "max-age": -1 });
}
// âš ï¸ Delete/update PHáº¢I dÃ¹ng cÃ¹ng path + domain khi set
```

### Tá»•ng Há»£p: Cookies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COOKIES â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  document.cookie: accessor, write chá»‰ update 1 cookie          â”‚
â”‚  Encode: encodeURIComponent cho name + value                   â”‚
â”‚  Limits: 4KB/cookie, ~20+/domain, 1 cookie/write              â”‚
â”‚  path=/: má»i trang. domain=site.com: + subdomains             â”‚
â”‚  expires (GMT) / max-age (seconds) â†’ session náº¿u khÃ´ng set    â”‚
â”‚  secure: HTTPS only. httpOnly: JS khÃ´ng access (server set)    â”‚
â”‚  samesite: strict (no cross) / lax (safe GET) / none (+secure) â”‚
â”‚  Third-party: Safari block, Chrome phasing out                 â”‚
â”‚  GDPR: explicit consent cho tracking cookies                   â”‚
â”‚  Delete: max-age=0, pháº£i cÃ¹ng path + domain                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 87. IndexedDB

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INDEXEDDB                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Key-value DB trong browser, máº¡nh hÆ¡n localStorage             â”‚
â”‚  Stores báº¥t ká»³ serializable value, multiple key types          â”‚
â”‚  Transactions cho reliability (all-or-nothing)                 â”‚
â”‚  Indexes cho search by object field                            â”‚
â”‚  Key ranges (IDBKeyRange) cho range queries                    â”‚
â”‚  Cursors cho large datasets (tiáº¿t kiá»‡m memory)                â”‚
â”‚  Schema versioning: upgradeneeded event                        â”‚
â”‚  Event-based native API, promise wrapper (idb)                 â”‚
â”‚  Intended for offline apps + ServiceWorkers                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Open, Versioning & Object Stores

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Open database: indexedDB.open(name, version)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const openRequest = indexedDB.open("myDB", 1);

openRequest.onupgradeneeded = function (event) {
  // Fire khi: version < specified HOáº¶C DB chÆ°a tá»“n táº¡i
  const db = openRequest.result;
  switch (event.oldVersion) {
    case 0: // DB má»›i, chÆ°a tá»“n táº¡i
      db.createObjectStore("books", { keyPath: "id" });
    // keyPath: property lÃ m key
    // autoIncrement: true â†’ key tá»± tÄƒng
    case 1: // upgrade tá»« v1 â†’ v2
    // thÃªm store má»›i, táº¡o index...
  }
};

openRequest.onsuccess = function () {
  const db = openRequest.result;

  // âš ï¸ Handle parallel update (tab khÃ¡c upgrade DB)
  db.onversionchange = function () {
    db.close();
    alert("DB outdated, please reload.");
  };
};

openRequest.onerror = () => console.error(openRequest.error);

openRequest.onblocked = function () {
  // Tab khÃ¡c chÆ°a close connection cÅ©
  // â†’ connection má»›i bá»‹ block
};

// XÃ³a database:
indexedDB.deleteDatabase("myDB");

// âš ï¸ open version CÅ¨ hÆ¡n DB hiá»‡n táº¡i â†’ error
// âš ï¸ DB scoped theo origin (domain/protocol/port)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Object Stores (tÆ°Æ¡ng Ä‘Æ°Æ¡ng "tables")
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Chá»‰ táº¡o/xÃ³a trong upgradeneeded handler!
db.createObjectStore("books", { keyPath: "id" });
db.createObjectStore("logs", { autoIncrement: true });
db.deleteObjectStore("oldStore");

// Check tá»“n táº¡i:
if (!db.objectStoreNames.contains("books")) {
  db.createObjectStore("books", { keyPath: "id" });
}

// Key types: number, date, string, binary, array
// Values: almost any serializable (structured clone)
// âš ï¸ Circular references â†’ khÃ´ng store Ä‘Æ°á»£c
```

### Transactions & CRUD

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Transactions: all-or-nothing
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Types: 'readonly' (default), 'readwrite', 'versionchange'
const tx = db.transaction("books", "readwrite");
const store = tx.objectStore("books");

// add vs put:
store.add(book); // ConstraintError náº¿u key Ä‘Ã£ tá»“n táº¡i
store.put(book); // REPLACE náº¿u key Ä‘Ã£ tá»“n táº¡i

// Delete:
store.delete("js"); // xÃ³a theo key
store.clear(); // xÃ³a Táº¤T Cáº¢

tx.oncomplete = () => console.log("Saved!");
tx.onabort = () => console.log("Error:", tx.error);
tx.abort(); // há»§y thá»§ cÃ´ng, rollback má»i thay Ä‘á»•i

// âš ï¸ AUTOCOMMIT: transaction tá»± commit khi:
//    - Má»i requests hoÃ n thÃ nh
//    - Microtask queue trá»‘ng
// âš ï¸ KHÃ”NG Ä‘áº·t fetch/setTimeout trong transaction!
//    â†’ TransactionInactiveError

// Sai:
await store.add(book1);
await fetch("/api"); // â† transaction Ä‘Ã£ commit!
await store.add(book2); // âŒ TransactionInactiveError

// ÄÃºng: fetch trÆ°á»›c, rá»“i má»›i transaction
const data = await fetch("/api").then((r) => r.json());
const tx2 = db.transaction("books", "readwrite");
await tx2.objectStore("books").add(data);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Error handling & Event delegation
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Events bubble: request â†’ transaction â†’ database
db.onerror = (e) => console.log("DB error:", e.target.error);

// Prevent transaction abort on ConstraintError:
request.onerror = function (event) {
  if (request.error.name === "ConstraintError") {
    event.preventDefault(); // khÃ´ng abort transaction
    event.stopPropagation(); // khÃ´ng bubble lÃªn db.onerror
  }
};

// âš ï¸ readonly: nhiá»u transaction Ä‘á»c cÃ¹ng store Ä‘á»“ng thá»i
// âš ï¸ readwrite: LOCK store â†’ transaction khÃ¡c pháº£i chá»
```

### Search, Indexes & Cursors

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Search by key: get/getAll/getKey/getAllKeys/count
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const store = db.transaction("books").objectStore("books");

store.get("js"); // 1 record
store.getAll(); // táº¥t cáº£
store.getAll(IDBKeyRange.bound("css", "html")); // range
store.getAllKeys(IDBKeyRange.lowerBound("js", true));
store.count();

// IDBKeyRange:
IDBKeyRange.lowerBound(lower, open); // â‰¥ (hoáº·c > náº¿u open)
IDBKeyRange.upperBound(upper, open); // â‰¤ (hoáº·c < náº¿u open)
IDBKeyRange.bound(lower, upper, lo, uo); // between
IDBKeyRange.only(key); // exact

// âš ï¸ Object store luÃ´n sorted by key

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Indexes: search by object field
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Táº¡o trong upgradeneeded:
openRequest.onupgradeneeded = function () {
  const store = db.createObjectStore("books", { keyPath: "id" });
  store.createIndex("price_idx", "price");
  // Options: { unique: true, multiEntry: true }
  // unique: enforce unique values
  // multiEntry: náº¿u value lÃ  array â†’ má»—i pháº§n tá»­ thÃ nh key
};

// DÃ¹ng index:
const idx = store.index("price_idx");
idx.getAll(10); // books vá»›i price=10
idx.getAll(IDBKeyRange.upperBound(5)); // price â‰¤ 5
// Results sorted by index field (price)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Cursors: duyá»‡t tá»«ng record (tiáº¿t kiá»‡m memory)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const req = store.openCursor(); // hoáº·c openKeyCursor
// Direction: 'next'(default), 'prev', 'nextunique', 'prevunique'

req.onsuccess = function () {
  const cursor = req.result;
  if (cursor) {
    console.log(cursor.key, cursor.value);
    cursor.continue(); // next record
    // cursor.advance(n) â€” skip n records
  } else {
    console.log("Done"); // háº¿t records
  }
};

// Cursor trÃªn index:
const idxReq = idx.openCursor(IDBKeyRange.upperBound(5));
idxReq.onsuccess = function () {
  const cursor = idxReq.result;
  if (cursor) {
    cursor.key; // index key (price)
    cursor.primaryKey; // object key (id)
    cursor.value; // full object
    cursor.continue();
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Promise wrapper (idb library)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import { openDB } from "idb";

const db = await openDB("myDB", 1, {
  upgrade(db) {
    db.createObjectStore("books", { keyPath: "id" });
  },
});

const tx = db.transaction("books", "readwrite");
await tx.objectStore("books").add({ id: "js", price: 10 });
await tx.done; // = transaction.oncomplete

// âš ï¸ Inactive transaction pitfall váº«n Ã¡p dá»¥ng!
// âš ï¸ promise.request Ä‘á»ƒ access native request object
```

### Tá»•ng Há»£p: IndexedDB

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INDEXEDDB â€” SUMMARY                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  open(name, ver): upgradeneeded â†’ success/error                â”‚
â”‚  Object stores: createObjectStore (upgradeneeded only)         â”‚
â”‚  keyPath (property key) vs autoIncrement                       â”‚
â”‚  Transactions: readonly/readwrite, autocommit after microtasks â”‚
â”‚  âš ï¸ KhÃ´ng fetch/setTimeout trong transaction!                   â”‚
â”‚  add (ConstraintError on dup) vs put (replace)                 â”‚
â”‚  Search: get/getAll + IDBKeyRange (bound/lower/upper/only)     â”‚
â”‚  Index: createIndex â†’ search by field, sorted by field         â”‚
â”‚  Cursor: openCursor, continue/advance, memory-efficient        â”‚
â”‚  Events bubble: request â†’ transaction â†’ database               â”‚
â”‚  versionchange: parallel update, onblocked                     â”‚
â”‚  idb wrapper: async/await, tx.done                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 88. Objects Deep Dive

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTS DEEP DIVE                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Object: unordered name-value pairs (properties + methods)     â”‚
â”‚  Primitive (immutable): Number, String, Boolean, Undefined,    â”‚
â”‚                         Null, Symbol, BigInt                   â”‚
â”‚  Reference (mutable): Object â€” stored as pointer               â”‚
â”‚  Create: literal {}, new Object(), Constructor, Prototype      â”‚
â”‚  Access: dot notation, bracket notation (dynamic keys)         â”‚
â”‚  Attributes: configurable, enumerable, writable                â”‚
â”‚  Own vs Inherited: hasOwnProperty, in, for...in                â”‚
â”‚  Delete: delete operator (own only, returns true)              â”‚
â”‚  Serialize: JSON.stringify / JSON.parse                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Reference vs Primitive & Creating Objects

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Primitive: stored as VALUE (copy Ä‘á»™c láº­p)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let a = "Kobe";
let b = a; // b = 'Kobe' (copy value)
a = "Bryant";
console.log(b); // 'Kobe' â€” khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Reference: stored as POINTER (share cÃ¹ng object)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const person = { name: "Kobe" };
const another = person; // copy REFERENCE
person.name = "Bryant";
console.log(another.name); // 'Bryant' â€” cÃ¹ng object!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Táº¡o Objects: 4 cÃ¡ch
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Object Literal (phá»• biáº¿n nháº¥t):
const book = { title: "JS", pages: 280 };

// 2. Object Constructor:
const obj = new Object();
obj.name = "test";

// 3. Constructor Pattern (táº¡o nhiá»u instances):
function Fruit(color, name) {
  this.color = color; // own property
  this.fruitName = name; // own property
  this.showName = function () {
    console.log("This is a " + this.fruitName);
  };
}
const mango = new Fruit("Yellow", "Mango");
mango.showName(); // 'This is a Mango'

// 4. Prototype Pattern:
function Animal() {}
Animal.prototype.type = "Mammal";
Animal.prototype.speak = function () {
  console.log(this.type + " speaks");
};
const cat = new Animal();
cat.speak(); // 'Mammal speaks'

// âš ï¸ Constructor: má»—i instance cÃ³ copy má»›i cá»§a methods
// âš ï¸ Prototype: táº¥t cáº£ instances share cÃ¹ng methods
// â†’ Best practice: Constructor + Prototype káº¿t há»£p
```

### Property Attributes, Access & Ownership

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Property Attributes (default: táº¥t cáº£ true)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Data properties cÃ³ 3 attributes:
// - configurable: property cÃ³ thá»ƒ delete/change type
// - enumerable: xuáº¥t hiá»‡n trong for...in
// - writable: cÃ³ thá»ƒ thay Ä‘á»•i value

Object.defineProperty(obj, "name", {
  value: "John",
  writable: false, // khÃ´ng ghi Ä‘Æ°á»£c
  enumerable: true, // xuáº¥t hiá»‡n trong for...in
  configurable: false, // khÃ´ng delete/redefine
});

// Accessor properties (getter/setter):
const user = {
  _name: "John",
  get name() {
    return this._name;
  },
  set name(val) {
    this._name = val.trim();
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Accessing Properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Dot notation:
book.title; // 'JS'

// Bracket notation (dynamic/number/reserved word keys):
book["title"]; // 'JS'
const key = "pages";
book[key]; // 280
book["bookMark" + 1]; // dynamic key

// Number keys PHáº¢I dÃ¹ng bracket:
const ages = { 30: "Young", 100: "Old" };
ages[30]; // 'Young' (âœ– ages.30)

// Nonexistent property â†’ undefined
book.author; // undefined

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Own vs Inherited Properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const school = { schoolName: "MIT" };

// in: check OWN + INHERITED
"schoolName" in school; // true (own)
"toString" in school; // true (inherited tá»« Object.prototype)

// hasOwnProperty: chá»‰ OWN
school.hasOwnProperty("schoolName"); // true
school.hasOwnProperty("toString"); // false

// for...in: enumerate own + inherited (enumerable)
for (const key in school) {
  if (school.hasOwnProperty(key)) {
    // chá»‰ own properties
  }
}

// Object.keys(): chá»‰ OWN enumerable
Object.keys(school); // ['schoolName']

// Object.getOwnPropertyNames(): OWN (cáº£ non-enumerable)
```

### Delete, Serialize & Prototype

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// delete operator
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const list = { mike: "Book", jason: "Sweater" };
delete list.mike; // true â€” xÃ³a thÃ nh cÃ´ng
delete list.toString; // true â€” nhÆ°ng KHÃ”NG xÃ³a (inherited)
list.toString(); // váº«n hoáº¡t Ä‘á»™ng

// âš ï¸ Chá»‰ delete Ä‘Æ°á»£c OWN properties
// âš ï¸ KhÃ´ng delete: inherited, non-configurable, var-declared
// âš ï¸ delete luÃ´n tráº£ true (ká»ƒ cáº£ property khÃ´ng tá»“n táº¡i)
// âš ï¸ Muá»‘n xÃ³a inherited â†’ delete trÃªn prototype object

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// JSON.stringify / JSON.parse
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const data = { mike: "Book", jason: "Sweater" };

// Serialize (object â†’ string):
const str = JSON.stringify(data);
// '{"mike":"Book","jason":"Sweater"}'

// Pretty print:
JSON.stringify(data, null, 2);

// Deserialize (string â†’ object):
const obj2 = JSON.parse(str);
console.log(obj2.mike); // 'Book'

// Deep clone báº±ng JSON:
const clone = JSON.parse(JSON.stringify(original));
// âš ï¸ Máº¥t: functions, undefined, Symbol, Date â†’ string
// âš ï¸ Modern: structuredClone(obj) cho deep clone

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Prototype chain
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Prototype property: trÃªn function/class (F.prototype)
// [[Prototype]] / __proto__: trÃªn instance
// Chain: instance â†’ Constructor.prototype â†’ Object.prototype â†’ null

function Person(name) {
  this.name = name;
}
Person.prototype.greet = function () {
  return "Hi, " + this.name;
};

const p = new Person("John");
p.greet(); // 'Hi, John' (inherited)
p.hasOwnProperty("name"); // true (own)
p.hasOwnProperty("greet"); // false (inherited)

// Object.create() cho prototype chain:
const animal = {
  speak() {
    return "sound";
  },
};
const dog = Object.create(animal);
dog.speak(); // 'sound' (inherited)
```

### Tá»•ng Há»£p: Objects

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OBJECTS â€” SUMMARY                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Primitive: stored as value, immutable, copy Ä‘á»™c láº­p           â”‚
â”‚  Reference: stored as pointer, mutable, copy share object     â”‚
â”‚  Create: literal {}, new Object(), Constructor, Prototype      â”‚
â”‚  Access: dot (obj.key) vs bracket (obj['key'], dynamic)        â”‚
â”‚  Attributes: configurable/enumerable/writable (default true)   â”‚
â”‚  in: own+inherited. hasOwnProperty: own only                  â”‚
â”‚  for...in: own+inherited enumerable. Object.keys: own only     â”‚
â”‚  delete: own only, tráº£ true luÃ´n, inherited â†’ delete prototype â”‚
â”‚  JSON.stringify/parse: serialize/deserialize                   â”‚
â”‚  Prototype chain: instance â†’ F.prototype â†’ Object.prototype   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 89. Prototype in Plain Language

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROTOTYPE IN PLAIN LANGUAGE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  2 concepts liÃªn quan:                                         â”‚
â”‚  1. Prototype PROPERTY (F.prototype):                          â”‚
â”‚     - Má»i function Ä‘á»u cÃ³, default = empty object              â”‚
â”‚     - Attach methods/props â†’ instances káº¿ thá»«a                 â”‚
â”‚     - KHÃ”NG enumerable (for..in khÃ´ng tháº¥y)                    â”‚
â”‚     - __proto__ = pseudo property (browser, deprecated)        â”‚
â”‚  2. Prototype ATTRIBUTE ([[Prototype]]):                       â”‚
â”‚     - Äáº·c tÃ­nh trÃªn Má»ŒI object, trá» Ä‘áº¿n "parent"              â”‚
â”‚     - Set tá»± Ä‘á»™ng khi táº¡o object (constructor quyáº¿t Ä‘á»‹nh)      â”‚
â”‚     - Táº¡o nÃªn PROTOTYPE CHAIN cho property lookup              â”‚
â”‚                                                                 â”‚
â”‚  Constructor: function + new â†’ initialize object               â”‚
â”‚  Chain: obj â†’ __proto__ â†’ ... â†’ Object.prototype â†’ null        â”‚
â”‚  Lookup: tÃ¬m property trÃªn obj â†’ prototype â†’ chain â†’ undefined â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Prototype Property & Constructor

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 1. Prototype PROPERTY: dÃ¹ng cho inheritance
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Má»i function Ä‘á»u cÃ³ .prototype (empty by default)
function PrintStuff(myDocuments) {
  this.documents = myDocuments; // own property
}

// Attach method lÃªn prototype â†’ instances káº¿ thá»«a:
PrintStuff.prototype.print = function () {
  console.log(this.documents);
};

const newObj = new PrintStuff("I can print!");
newObj.print(); // 'I can print!' â€” inherited tá»« prototype

// âš ï¸ F.prototype KHÃ”NG enumerable (for..in khÃ´ng tháº¥y)
// âš ï¸ __proto__ = deprecated cÃ¡ch access [[Prototype]]
//    DÃ¹ng Object.getPrototypeOf(obj) thay tháº¿

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Constructor: function gá»i báº±ng new
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Account() {}
const userAccount = new Account();

// Má»i object káº¿ thá»«a constructor property:
console.log(userAccount.constructor); // Account()

const myObj = {};
console.log(myObj.constructor); // Object()

// constructor property trá» Ä‘áº¿n function táº¡o ra object
// âš ï¸ Náº¿u ghi Ä‘Ã¨ F.prototype = {}, constructor bá»‹ máº¥t!
// Fix: F.prototype = { constructor: F, ...methods }
```

### Prototype Attribute & Inheritance

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 2. Prototype ATTRIBUTE: set tá»± Ä‘á»™ng khi táº¡o object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// RULE 1: Literal / new Object() â†’ prototype = Object.prototype
const obj1 = {}; // [[Prototype]] = Object.prototype
const obj2 = new Object(); // [[Prototype]] = Object.prototype

// RULE 2: new Constructor() â†’ prototype = Constructor.prototype
function Fruit() {}
const apple = new Fruit(); // [[Prototype]] = Fruit.prototype
const arr = new Array(); // [[Prototype]] = Array.prototype

// RULE 3: Object.create(proto) â†’ prototype = proto
const animal = {
  speak() {
    return "sound";
  },
};
const dog = Object.create(animal); // [[Prototype]] = animal

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Prototype-based Inheritance
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Plant() {
  this.country = "Mexico";
  this.isOrganic = true;
}

Plant.prototype.showNameAndColor = function () {
  console.log("I am a " + this.name + " and my color is " + this.color);
};

Plant.prototype.amIOrganic = function () {
  if (this.isOrganic) console.log("I am organic!");
};

function FruitItem(name, color) {
  this.name = name;
  this.color = color;
}

// Set Fruit's prototype = instance of Plant:
FruitItem.prototype = new Plant();
// â†’ FruitItem instances káº¿ thá»«a Táº¤T Cáº¢ tá»« Plant + Fruit

const banana = new FruitItem("Banana", "Yellow");
console.log(banana.name); // 'Banana' (own)
banana.showNameAndColor(); // 'I am a Banana...' (from Plant)
banana.amIOrganic(); // 'I am organic!' (from Plant)
console.log(banana.country); // 'Mexico' (from Plant instance)

// Chain: banana â†’ FruitItem.prototype (=Plant instance)
//                â†’ Plant.prototype â†’ Object.prototype â†’ null
```

### Prototype Chain & Property Lookup

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Prototype Chain: cÆ¡ cháº¿ truy cáº­p properties
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const myFriends = { name: "Pete" };

// 1. TÃ¬m trÃªn object â†’ FOUND
console.log(myFriends.name); // 'Pete'

// 2. TÃ¬m trÃªn object â†’ KHÃ”NG cÃ³ â†’ lÃªn prototype
//    myFriends â†’ Object.prototype â†’ toString found!
myFriends.toString(); // '[object Object]'

// Object.prototype methods inherited by ALL objects:
// - constructor, hasOwnProperty(), isPrototypeOf()
// - propertyIsEnumerable(), toLocaleString()
// - toString(), valueOf()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Property Shadowing (overriding)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function People() {
  this.superstar = "Michael Jackson";
}
People.prototype.athlete = "Tiger Woods";

const famous = new People();
famous.superstar = "Steve Jobs"; // SHADOW own property

console.log(famous.superstar); // 'Steve Jobs' (own, stops here)
console.log(famous.athlete); // 'Tiger Woods' (prototype)
console.log(famous.toString()); // '[object Object]' (Object.prototype)

// Lookup order:
// famous â†’ People.prototype â†’ Object.prototype â†’ null
// TÃ¬m tháº¥y á»Ÿ Ä‘Ã¢u â†’ Dá»ªNG, tráº£ value
// KhÃ´ng tÃ¬m tháº¥y â†’ undefined

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»•ng káº¿t: Built-in prototype chains
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Array:   [] â†’ Array.prototype â†’ Object.prototype â†’ null
// Number:  new Number() â†’ Number.prototype â†’ Object.prototype
// String:  new String() â†’ String.prototype â†’ Object.prototype
// Function: fn â†’ Function.prototype â†’ Object.prototype â†’ null
// Custom:  new F() â†’ F.prototype â†’ Object.prototype â†’ null

// âš ï¸ ALL built-in constructors inherit from Object.prototype
// âš ï¸ Object.prototype á»Ÿ TOP of má»i chain (trá»« Object.create(null))
// âš ï¸ Chá»‰ Object.create(null) táº¡o object KHÃ”NG cÃ³ prototype
```

### Tá»•ng Há»£p: Prototype

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROTOTYPE â€” SUMMARY                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  F.prototype: property trÃªn function, attach methods â†’ inherit â”‚
â”‚  [[Prototype]]: attribute trÃªn object, trá» Ä‘áº¿n "parent"        â”‚
â”‚  {} / new Object() â†’ Object.prototype                          â”‚
â”‚  new F() â†’ F.prototype                                         â”‚
â”‚  Object.create(proto) â†’ proto                                  â”‚
â”‚  Constructor: fn + new, instances inherit constructor prop      â”‚
â”‚  Inheritance: Child.prototype = new Parent()                   â”‚
â”‚  Chain: obj â†’ F.prototype â†’ ... â†’ Object.prototype â†’ null      â”‚
â”‚  Lookup: tÃ¬m property theo chain, dá»«ng khi found               â”‚
â”‚  Shadowing: own property ghi Ä‘Ã¨ inherited                      â”‚
â”‚  Object.prototype: top of chain, má»i built-in káº¿ thá»«a          â”‚
â”‚  âš ï¸ Ghi Ä‘Ã¨ F.prototype = {} â†’ máº¥t constructor!                 â”‚
â”‚  âš ï¸ __proto__ deprecated â†’ dÃ¹ng Object.getPrototypeOf()        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 90. Variable Scope & Hoisting Explained

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VARIABLE SCOPE & HOISTING                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Scope = context nÆ¡i variable tá»“n táº¡i & accessible             â”‚
â”‚  var: Function-level scope (KHÃ”NG block-level!)                â”‚
â”‚  let/const: Block-level scope (ES6+)                           â”‚
â”‚  Local var Æ°u tiÃªn hÆ¡n global var cÃ¹ng tÃªn                     â”‚
â”‚  KhÃ´ng khai bÃ¡o var â†’ tá»± thÃªm vÃ o global scope!                â”‚
â”‚  Global vars gáº¯n vÃ o window object                             â”‚
â”‚  setTimeout callback: this = window (global scope)             â”‚
â”‚                                                                 â”‚
â”‚  Hoisting: var declarations Ä‘Æ°a lÃªn TOP (value = undefined)    â”‚
â”‚  Function declaration hoisted + override var declaration        â”‚
â”‚  NhÆ°ng variable ASSIGNMENT override function declaration       â”‚
â”‚  Function expression (var f = function) KHÃ”NG hoisted          â”‚
â”‚  let/const: TDZ (Temporal Dead Zone) â†’ ReferenceError          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Variable Scope: Local, Global & Traps

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Function-level scope (var) â€” KHÃ”NG cÃ³ block-level!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var name = "Richard";

function showName() {
  var name = "Jack"; // LOCAL â€” chá»‰ trong function nÃ y
  console.log(name); // 'Jack'
}
console.log(name); // 'Richard' â€” global khÃ´ng Ä‘á»•i

// âš ï¸ var trong if/for KHÃ”NG táº¡o local scope:
var x = "Richard";
if (x) {
  x = "Jack"; // thay Ä‘á»•i GLOBAL x!
}
console.log(x); // 'Jack'

for (var i = 1; i <= 10; i++) {}
console.log(i); // 11 â€” var i lÃ  GLOBAL!

// âœ… let/const Sá»¬A: táº¡o block scope
for (let j = 1; j <= 10; j++) {}
// console.log(j);   // ReferenceError â€” j chá»‰ trong for

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Undeclared variable trap
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var celebrity = "Michael Jackson";

function showCelebrity() {
  console.log(celebrity);
}
function showOrdinary() {
  celebrity = "Johnny"; // KHÃ”NG cÃ³ var â†’ thay Ä‘á»•i GLOBAL!
  console.log(celebrity);
}

showCelebrity(); // 'Michael Jackson'
showOrdinary(); // 'Johnny'
showCelebrity(); // 'Johnny' â€” global Ä‘Ã£ bá»‹ Ä‘á»•i!

// âœ… Fix: luÃ´n khai bÃ¡o var/let/const
function showOrdinaryFixed() {
  var celebrity = "Johnny"; // LOCAL â€” khÃ´ng áº£nh hÆ°á»Ÿng global
  console.log(celebrity);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Local Æ°u tiÃªn hÆ¡n Global (cÃ¹ng tÃªn)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var user = "Paul";
function users() {
  var user = "Jack"; // local Æ°u tiÃªn
  console.log(user); // 'Jack'
}
users();
console.log(user); // 'Paul' â€” global khÃ´ng Ä‘á»•i

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Global variables & window object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Má»i global var gáº¯n vÃ o window:
var myName = "Richard";
console.log(window.myName); // 'Richard'
console.log("myName" in window); // true

// Initialized without var/let/const â†’ auto global:
function showAge() {
  age = 90; // GLOBAL! (strict mode â†’ ReferenceError)
}
showAge();
console.log(age); // 90 â€” accessible everywhere

// âš ï¸ "use strict": lá»—i náº¿u assign biáº¿n chÆ°a khai bÃ¡o
```

### setTimeout, Pollution & Hoisting

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// setTimeout: this = window (global scope)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var highValue = 200;
var constantVal = 2;
var myObj = {
  highValue: 20,
  constantVal: 5,
  calculateIt: function () {
    setTimeout(function () {
      // this = WINDOW, khÃ´ng pháº£i myObj!
      console.log(this.constantVal * this.highValue);
    }, 2000);
  },
};
myObj.calculateIt(); // 400 (2 * 200) â€” dÃ¹ng global!

// âœ… Fix: arrow function (this lexical)
myObj.calculateIt = function () {
  setTimeout(() => {
    console.log(this.constantVal * this.highValue); // 100
  }, 2000);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Avoid polluting global scope
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âŒ Sai:
var firstName, lastName;
function fullName() {
  console.log(firstName + " " + lastName);
}

// âœ… ÄÃºng: khai bÃ¡o trong function
function fullNameFixed() {
  var firstName = "Michael",
    lastName = "Jackson";
  console.log(firstName + " " + lastName);
}

// âœ… Modern: ES modules, IIFE, let/const

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Variable Hoisting
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Chá»‰ DECLARATION hoisted, KHÃ”NG pháº£i assignment!
function showHoist() {
  console.log("Name: " + name); // undefined (hoisted, chÆ°a assign)
  var name = "Ford";
  console.log("Name: " + name); // 'Ford'
}

// JS engine xá»­ lÃ½ thá»±c táº¿:
function showHoistActual() {
  var name; // â† hoisted lÃªn Ä‘Ã¢y
  console.log("Name: " + name); // undefined
  name = "Ford"; // assignment táº¡i vá»‹ trÃ­ gá»‘c
  console.log("Name: " + name); // 'Ford'
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Function declaration OVERRIDE variable declaration
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Case 1: function declaration > var declaration
var myName;
function myName() {
  console.log("Rich");
}
console.log(typeof myName); // 'function' â† fn wins

// Case 2: var ASSIGNMENT > function declaration
var myName = "Richard"; // ASSIGNMENT â€” wins!
function myName() {
  console.log("Rich");
}
console.log(typeof myName); // 'string' â† assignment wins

// âš ï¸ Function expression KHÃ”NG hoisted:
var myFn = function () {
  console.log("Rich");
};
// myFn lÃ  undefined trÆ°á»›c dÃ²ng nÃ y (hoisted as var)

// âš ï¸ let/const: TDZ (Temporal Dead Zone)
// console.log(x); // ReferenceError!
// let x = 5;
```

### Tá»•ng Há»£p: Variable Scope & Hoisting

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VARIABLE SCOPE & HOISTING â€” SUMMARY                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  var: function scope, KHÃ”NG block scope, hoisted (undefined)   â”‚
â”‚  let/const: block scope, TDZ â†’ ReferenceError náº¿u trÆ°á»›c khai  â”‚
â”‚  Local > Global khi cÃ¹ng tÃªn trong function                    â”‚
â”‚  KhÃ´ng var â†’ auto global! (strict mode â†’ error)                â”‚
â”‚  Global vars gáº¯n vÃ o window object                             â”‚
â”‚  setTimeout callback: this = window (fix: arrow fn / bind)     â”‚
â”‚  TrÃ¡nh pollute global: modules, IIFE, let/const                â”‚
â”‚                                                                 â”‚
â”‚  Hoisting: chá»‰ declaration, KHÃ”NG assignment                   â”‚
â”‚  Function declaration > var declaration (hoisting)             â”‚
â”‚  var ASSIGNMENT > function declaration                          â”‚
â”‚  Function expression (var f = fn) KHÃ”NG hoisted                â”‚
â”‚  âš ï¸ for var i â†’ global! | for let j â†’ block scope             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 91. Closures In-Depth

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURES IN-DEPTH                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Closure = inner function + access outer function's scope      â”‚
â”‚  3 scope chains:                                               â”‚
â”‚    1. Own scope (biáº¿n trong {})                                â”‚
â”‚    2. Outer function's variables + parameters                  â”‚
â”‚    3. Global variables                                         â”‚
â”‚                                                                 â”‚
â”‚  Váº«n access outer vars SAU KHI outer function Ä‘Ã£ return!       â”‚
â”‚  Store REFERENCES, khÃ´ng pháº£i values                           â”‚
â”‚  â†’ Äá»c Ä‘Æ°á»£c updated value (private vars pattern)               â”‚
â”‚  â†’ Bug: for loop closure (táº¥t cáº£ share cÃ¹ng i)                 â”‚
â”‚  Fix: IIFE (capture má»—i iteration) hoáº·c let (block scope)     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Closure Basics & Scope Chain

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Closure = inner function + outer scope access
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showName(firstName, lastName) {
  var nameIntro = "Your name is ";

  // Inner function: access outer vars + params
  function makeFullName() {
    return nameIntro + firstName + " " + lastName;
  }

  return makeFullName();
}
showName("Michael", "Jackson");
// 'Your name is Michael Jackson'

// 3 scope chains:
// 1. Own: {} bÃªn trong makeFullName
// 2. Outer: nameIntro, firstName, lastName
// 3. Global: window, etc.

// âš ï¸ Inner function access outer PARAMETERS directly
// âš ï¸ NhÆ°ng KHÃ”NG access outer arguments object

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Closure váº«n access SAU KHI outer function returns
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function celebrityName(firstName) {
  var nameIntro = "This celebrity is ";

  function lastName(theLastName) {
    return nameIntro + firstName + " " + theLastName;
  }
  return lastName; // tráº£ vá» FUNCTION, khÃ´ng gá»i
}

var mjName = celebrityName("Michael");
// celebrityName Ä‘Ã£ return, nhÆ°ng...

mjName("Jackson");
// 'This celebrity is Michael Jackson'
// â†’ closure váº«n access nameIntro + firstName!

// Táº¡i sao? Functions giá»¯ scope chain lÃºc CREATION
// â†’ DÃ¹ outer function Ä‘Ã£ finished, vars váº«n sá»‘ng
```

### References, Private Vars & Loop Bug

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Closures store REFERENCES, khÃ´ng pháº£i values
// â†’ Äá»c Ä‘Æ°á»£c UPDATED value
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function celebrityID() {
  var id = 999;

  return {
    getID: function () {
      return id; // Ä‘á»c CURRENT value
    },
    setID: function (newID) {
      id = newID; // thay Ä‘á»•i outer var
    },
  };
}

var mjID = celebrityID();
mjID.getID(); // 999
mjID.setID(567); // thay Ä‘á»•i id
mjID.getID(); // 567 â€” updated!

// â†’ Pattern: PRIVATE VARIABLES (Douglas Crockford)
// id khÃ´ng thá»ƒ access trá»±c tiáº¿p tá»« ngoÃ i
// Chá»‰ qua getID/setID â†’ encapsulation!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Closures Gone Awry: for loop bug
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function celebrityIDCreator(celebrities) {
  var i;
  var uniqueID = 100;
  for (i = 0; i < celebrities.length; i++) {
    celebrities[i]["id"] = function () {
      return uniqueID + i; // i lÃ  REFERENCE!
    };
  }
  return celebrities;
}

var celebs = [
  { name: "Stallone", id: 0 },
  { name: "Cruise", id: 0 },
  { name: "Willis", id: 0 },
];
var result = celebrityIDCreator(celebs);
result[0].id(); // 103 (âŒ expected 100)
result[1].id(); // 103 (âŒ expected 101)
result[2].id(); // 103 (âŒ expected 102)

// Táº¡i sao? Táº¥t cáº£ closures share CÃ™NG 1 biáº¿n i
// Khi gá»i .id(), for loop Ä‘Ã£ xong â†’ i = 3
// â†’ uniqueID + 3 = 103 cho Táº¤T Cáº¢

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Fix 1: IIFE (capture giÃ¡ trá»‹ má»—i iteration)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function celebrityIDCreatorFixed(celebrities) {
  var i;
  var uniqueID = 100;
  for (i = 0; i < celebrities.length; i++) {
    celebrities[i]["id"] = (function (j) {
      return function () {
        return uniqueID + j; // j = copy cá»§a i lÃºc Ä‘Ã³
      };
    })(i); // IIFE: truyá»n i vÃ o ngay
  }
  return celebrities;
}
// result[0].id() = 100, [1] = 101, [2] = 102 âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Fix 2: let (block scope â€” má»—i iteration riÃªng)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function celebrityIDCreatorModern(celebrities) {
  var uniqueID = 100;
  for (let i = 0; i < celebrities.length; i++) {
    celebrities[i]["id"] = function () {
      return uniqueID + i; // let táº¡o i Má»šI má»—i iteration
    };
  }
  return celebrities;
}
// result[0].id() = 100, [1] = 101, [2] = 102 âœ…
// â†’ Modern JS: dÃ¹ng let thay IIFE!
```

### Tá»•ng Há»£p: Closures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSURES â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Closure = inner fn + outer scope (vars + params + global)     â”‚
â”‚  Váº«n access outer vars SAU KHI outer fn Ä‘Ã£ return              â”‚
â”‚  Store REFERENCES, khÃ´ng values â†’ Ä‘á»c updated value            â”‚
â”‚  Private vars pattern: return {getX, setX} (encapsulation)     â”‚
â”‚                                                                 â”‚
â”‚  âŒ Bug: for loop â€” táº¥t cáº£ closures share cÃ¹ng i              â”‚
â”‚  âœ… Fix 1: IIFE â€” (function(j){ return fn })(i)                â”‚
â”‚  âœ… Fix 2: let â€” block scope, má»—i iteration i riÃªng           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ Inner fn access outer params, KHÃ”NG access arguments obj  â”‚
â”‚  âš ï¸ Scope chain theo CREATION site, khÃ´ng pháº£i call site       â”‚
â”‚  âš ï¸ Closures giá»¯ refs â†’ memory khÃ´ng auto-clear (leak risk)   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 92. Callback Functions In-Depth

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALLBACK FUNCTIONS IN-DEPTH                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Functions = first-class objects (nhÆ° String, Array, etc.)     â”‚
â”‚  Callback = function pass vÃ o function khÃ¡c, gá»i SAU         â”‚
â”‚  Callbacks lÃ  CLOSURES (access containing fn scope)             â”‚
â”‚  Truyá»n: named function hoáº·c anonymous function               â”‚
â”‚  Check typeof === 'function' trÆ°á»›c khi gá»i                   â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ this problem: method callback â†’ this = window             â”‚
â”‚  Fix: call/apply/bind truyá»n context                          â”‚
â”‚  Multiple callbacks: success/error/complete                    â”‚
â”‚  Callback Hell: pyramid of doom â†’ Promises/async-await         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### First-Class Functions & Callback Basics

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Functions = first-class objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Functions cÃ³ thá»ƒ:
// 1. Stored in variables
// 2. Passed as arguments
// 3. Created within functions
// 4. Returned from functions

// Callback = function truyá»n vÃ o function khÃ¡c:
$("#btn_1").click(function () {
  alert("Btn 1 Clicked"); // anonymous callback
});

var friends = ["Mike", "Stacy", "Andy", "Rick"];
friends.forEach(function (name, index) {
  console.log(index + 1 + ". " + name);
});

// âš ï¸ Truyá»n function DEFINITION, khÃ´ng pháº£i execution
// âš ï¸ KhÃ´ng cÃ³ () â€” chá»‰ truyá»n tÃªn function
// "Called back" táº¡i má»™t thá»i Ä‘iá»ƒm trong containing function

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Callbacks lÃ  CLOSURES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Callback access containing function's scope + global
var selections = [];
$(".niners").click(function () {
  selections.push(this.prop("name"));
  // â†‘ access outer variable selections (closure!)
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Named vs Anonymous callbacks
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function logStuff(userData) {
  if (typeof userData === "string") {
    console.log(userData);
  } else if (typeof userData === "object") {
    for (var item in userData) {
      console.log(item + ": " + userData[item]);
    }
  }
}

function getInput(options, callback) {
  // Check callback lÃ  function trÆ°á»›c khi gá»i!
  if (typeof callback === "function") {
    callback(options);
  }
}

// Truyá»n named function:
getInput({ name: "Rich", speciality: "JS" }, logStuff);
// name: Rich
// speciality: JS

// âœ… typeof check: trÃ¡nh runtime error
// âœ… Named callbacks: reusable, dá»… debug (stack trace)
```

### this Problem, Call/Apply & Callback Hell

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ this problem: method callback máº¥t context
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var clientData = {
  id: 94545,
  fullName: "Not Set",
  setUserName: function (firstName, lastName) {
    this.fullName = firstName + " " + lastName;
  },
};

function getUserInput(firstName, lastName, callback) {
  callback(firstName, lastName);
}

// âŒ this = window, KHÃ”NG pháº£i clientData!
getUserInput("Barack", "Obama", clientData.setUserName);
console.log(clientData.fullName); // 'Not Set' â€” khÃ´ng Ä‘á»•i!
console.log(window.fullName); // 'Barack Obama' â€” set trÃªn window!

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Fix: call/apply/bind truyá»n context
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getUserInputFixed(firstName, lastName, callback, callbackObj) {
  // apply: set this = callbackObj
  callback.apply(callbackObj, [firstName, lastName]);
}

getUserInputFixed("Barack", "Obama", clientData.setUserName, clientData);
console.log(clientData.fullName); // 'Barack Obama' âœ…

// Modern fix: bind hoáº·c arrow function
getUserInput("Barack", "Obama", clientData.setUserName.bind(clientData));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Multiple callbacks & Versatile functions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

$.ajax({
  url: "/api/data",
  success: successCallback, // khi thÃ nh cÃ´ng
  complete: completeCallback, // luÃ´n cháº¡y
  error: errorCallback, // khi lá»—i
});

// Táº¡o function versatile vá»›i callback:
function getUserData(firstName, lastName, gender, callback) {
  var fullName = firstName + " " + lastName;
  if (typeof callback === "function") {
    callback(fullName, gender);
  }
}

function greetUser(name, sex) {
  var salutation = sex === "Man" ? "Mr." : "Ms.";
  console.log("Hello, " + salutation + " " + name);
}

function makePoemFor(name) {
  console.log(name + " is finer than fine wine.");
}

// CÃ¹ng 1 function, khÃ¡c callback = khÃ¡c behavior:
getUserData("Bill", "Gates", "Man", greetUser); // Hello, Mr. Bill Gates
getUserData("Bill", "Gates", "Man", makePoemFor); // Bill Gates is finer...

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Callback Hell (Pyramid of Doom)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Lá»“ng callbacks nhiá»u táº§ng:
getData(function (a) {
  getMoreData(a, function (b) {
    getEvenMore(b, function (c) {
      getFinal(c, function (d) {
        console.log(d); // Pyramid of Doom!
      });
    });
  });
});

// âœ… Solutions:
// 1. Named functions: Ä‘áº·t tÃªn vÃ  truyá»n tÃªn
// 2. Modularity: tÃ¡ch thÃ nh modules/files riÃªng
// 3. Promises: .then().then().catch()
// 4. async/await: sequential-looking async code
```

### Tá»•ng Há»£p: Callback Functions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CALLBACK FUNCTIONS â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Functions = first-class objects (pass/store/return)           â”‚
â”‚  Callback = fn truyá»n vÃ o fn khÃ¡c, gá»i SAU (called back)     â”‚
â”‚  Callbacks lÃ  closures: access containing scope + global       â”‚
â”‚  Named hoáº·c anonymous â€” named tá»‘t hÆ¡n (debug/reuse)           â”‚
â”‚  typeof === 'function' check trÆ°á»›c khi gá»i                   â”‚
â”‚                                                                 â”‚
â”‚  âŒ this problem: method as callback â†’ this = window           â”‚
â”‚  âœ… Fix: apply(obj, args) / call(obj, a, b) / bind(obj)        â”‚
â”‚  Multiple callbacks: success/error/complete pattern            â”‚
â”‚  Versatile: cÃ¹ng fn + khÃ¡c callback = khÃ¡c behavior             â”‚
â”‚                                                                 â”‚
â”‚  âŒ Callback Hell: nested â†’ pyramid of doom                    â”‚
â”‚  âœ… Fix: named fns, modules, Promises, async/await              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 93. JavaScript's "this" Keyword Mastery

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JAVASCRIPT'S "this" KEYWORD                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  this = object INVOKE function (khÃ´ng pháº£i nÆ¡i define)         â”‚
â”‚  ÄÆ°á»£c gÃ¡n giÃ¡ trá»‹ táº¡i INVOCATION, khÃ´ng pháº£i definition        â”‚
â”‚  Global scope: this = window (strict: undefined)               â”‚
â”‚  Object method: this = object Ä‘Ã³                               â”‚
â”‚                                                                 â”‚
â”‚  4 báº«y tráº­p (this máº¥t context):                                â”‚
â”‚    1. Method as callback â†’ this = DOM/window                   â”‚
â”‚    2. Closure/inner fn â†’ this = window                         â”‚
â”‚    3. Method assign to var â†’ this = window                     â”‚
â”‚    4. Borrowing methods â†’ this = borrower object               â”‚
â”‚  Fix: bind/call/apply, var self=this, arrow function           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### this Basics & Global/Object Context

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Biggest Gotcha: this = INVOKING object
// KHÃ”NG pháº£i object chá»©a definition!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var person = {
  firstName: "Penelope",
  lastName: "Barrymore",
  showFullName: function () {
    console.log(this.firstName + " " + this.lastName);
  },
};

person.showFullName(); // 'Penelope Barrymore'
// this = person (person INVOKE showFullName)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Global scope: this = window
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var firstName = "Peter";
var lastName = "Ally";

function showFullName() {
  console.log(this.firstName + " " + this.lastName);
}

showFullName(); // 'Peter Ally' â€” this = window
window.showFullName(); // 'Peter Ally' â€” same thing!
person.showFullName(); // 'Penelope Barrymore' â€” this = person

// âš ï¸ strict mode: this = undefined trong global function

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Context Ä‘á»•i Ä‘Æ°á»£c báº±ng apply/call
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var anotherPerson = { firstName: "Rohit", lastName: "Khan" };

person.showFullName.apply(anotherPerson);
// 'Rohit Khan' â€” context chuyá»ƒn sang anotherPerson
```

### 4 Báº«y Tráº­p & CÃ¡ch Fix

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Trap 1: Method as callback â†’ máº¥t context
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var user = {
  data: [{ name: 'T. Woods', age: 37 }],
  clickHandler: function() {
    console.log(this.data[0].name); // this = ?
  }
};

// âŒ this = button, KHÃ”NG pháº£i user!
$('button').click(user.clickHandler); // Error!

// âœ… Fix: bind
$('button').click(user.clickHandler.bind(user));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Trap 2: this trong closure/inner function
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var user2 = {
  tournament: 'The Masters',
  data: [{ name: 'T. Woods' }, { name: 'P. Mickelson' }],
  clickHandler: function() {
    // this.data OK â€” this = user2
    this.data.forEach(function(person) {
      // âŒ this = WINDOW, khÃ´ng pháº£i user2!
      console.log(person.name + ' at ' + this.tournament);
      // 'T. Woods at undefined'
    });
  }
};

// âœ… Fix 1: var self = this (classic)
clickHandler: function() {
  var self = this; // capture this
  this.data.forEach(function(person) {
    console.log(person.name + ' at ' + self.tournament); // âœ…
  });
}

// âœ… Fix 2: arrow function (modern â€” lexical this)
clickHandler: function() {
  this.data.forEach((person) => {
    console.log(person.name + ' at ' + this.tournament); // âœ…
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Trap 3: Method assign to variable
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var data = [{ name: 'Samantha', age: 12 }]; // global
var user3 = {
  data: [{ name: 'T. Woods', age: 37 }],
  showData: function() {
    console.log(this.data[0].name);
  }
};

var showUserData = user3.showData;
showUserData(); // 'Samantha' âŒ (this = window, dÃ¹ng global data)

// âœ… Fix: bind
var showUserData = user3.showData.bind(user3);
showUserData(); // 'T. Woods' âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Trap 4: Borrowing methods
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var gameController = {
  scores: [20, 34, 55, 46, 77],
  avgScore: null
};

var appController = {
  scores: [900, 845, 809, 950],
  avgScore: null,
  avg: function() {
    var sum = this.scores.reduce(function(a, b) {
      return a + b;
    });
    this.avgScore = sum / this.scores.length;
  }
};

// âŒ this = appController (dÃ¹ng appController.scores!)
gameController.avgScore = appController.avg();

// âœ… Fix: apply â€” set this = gameController
appController.avg.apply(gameController);
console.log(gameController.avgScore); // 46.4 âœ…
console.log(appController.avgScore);  // null â€” khÃ´ng áº£nh hÆ°á»Ÿng
```

### Tá»•ng Há»£p: this Keyword

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "this" KEYWORD â€” SUMMARY                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  this = INVOKING object, gÃ¡n táº¡i invocation time               â”‚
â”‚  Global: window (strict: undefined)                            â”‚
â”‚  Object method: this = object Ä‘Ã³                               â”‚
â”‚  Context changeable vá»›i call/apply/bind                       â”‚
â”‚                                                                 â”‚
â”‚  Trap 1: method as callback â†’ this = DOM/window               â”‚
â”‚    Fix: .bind(obj)                                              â”‚
â”‚  Trap 2: closure/inner fn â†’ this = window                     â”‚
â”‚    Fix: var self = this | arrow fn (lexical this)               â”‚
â”‚  Trap 3: method â†’ variable â†’ this = window                    â”‚
â”‚    Fix: .bind(obj)                                              â”‚
â”‚  Trap 4: borrowing methods â†’ this = borrower                  â”‚
â”‚    Fix: .apply(targetObj) / .call(targetObj)                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 94. Apply, Call & Bind Methods

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLY, CALL & BIND METHODS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  3 methods trÃªn Function.prototype:                            â”‚
â”‚  call(obj, a, b)  â€” gá»i ngay, args riÃªng láº»                  â”‚
â”‚  apply(obj, [a,b]) â€” gá»i ngay, args lÃ  array                 â”‚
â”‚  bind(obj, a)     â€” TRáº¢ FN Má»šI, khÃ´ng gá»i ngay              â”‚
â”‚                                                                 â”‚
â”‚  DÃ¹ng cho:                                                      â”‚
â”‚    1. Set this explicitly                                      â”‚
â”‚    2. Borrow methods (Array methods trÃªn array-like)           â”‚
â”‚    3. Currying / partial application (bind)                    â”‚
â”‚    4. Variadic functions (apply + array args)                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Bind: Set this & Currying

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// bind() = tráº£ function Má»šI vá»›i this cá»‘ Ä‘á»‹nh
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Fix callback context:
var user = {
  data: [{ name: "T. Woods", age: 37 }],
  clickHandler: function () {
    console.log(this.data[0].name);
  },
};

$("button").click(user.clickHandler.bind(user)); // âœ…

// Fix method assign to variable:
var showDataVar = user.clickHandler.bind(user);
showDataVar(); // 'T. Woods' âœ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Borrow methods vá»›i bind
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var cars = {
  data: [{ name: "Honda Accord", age: 14 }],
};
cars.showData = user.clickHandler.bind(cars);
cars.showData(); // 'Honda Accord' â€” this = cars

// âš ï¸ bind thÃªm method má»›i lÃªn object (cÃ³ thá»ƒ overwrite)
// Tá»‘t hÆ¡n: dÃ¹ng call/apply khÃ´ng cáº§n gáº¯n method

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Currying / Partial application vá»›i bind
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function greet(gender, age, name) {
  var salutation = gender === "male" ? "Mr. " : "Ms. ";
  return age > 25 ? "Hello, " + salutation + name : "Hey, " + name;
}

// Preset 2 args, chá»‰ cáº§n truyá»n name:
var greetAdultMale = greet.bind(null, "male", 45);
greetAdultMale("John"); // 'Hello, Mr. John'

var greetYoung = greet.bind(null, "", 16);
greetYoung("Alex"); // 'Hey, Alex'
// null = khÃ´ng dÃ¹ng this trong greet
```

### Apply & Call: Borrowing & Variadic

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Set this vá»›i call/apply
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function avg(scores) {
  var sum = scores.reduce(function (a, b) {
    return a + b;
  });
  this.avgScore = sum / scores.length;
}

var gameCtrl = { scores: [20, 34, 55, 46, 77], avgScore: null };

avg(gameCtrl.scores); // this = window!
console.log(window.avgScore); // 46.4
console.log(gameCtrl.avgScore); // null

avg.call(gameCtrl, gameCtrl.scores); // this = gameCtrl!
console.log(gameCtrl.avgScore); // 46.4 âœ…

// apply: tÆ°Æ¡ng tá»± nhÆ°ng args lÃ  array
callback.apply(callbackObj, [firstName, lastName]);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Borrow Array methods trÃªn array-like objects
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// array-like: keys = non-negative integers + length
var arrayLike = { 0: "Martin", 1: 78, 2: 67, length: 3 };

// Borrow slice â†’ convert to real array:
var arr = Array.prototype.slice.call(arrayLike, 0);
// ['Martin', 78, 67]

// Borrow indexOf:
Array.prototype.indexOf.call(arrayLike, "Martin"); // 0

// arguments object = array-like:
function getArgs() {
  var args = Array.prototype.slice.call(arguments);
  console.log(args); // real array!
}
getArgs("Water", "Salt"); // ['Water', 'Salt']

// Modern: Array.from(arguments) hoáº·c [...arguments]

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Variadic functions vá»›i apply
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var nums = [23, 11, 34, 56];

// Math.max khÃ´ng nháº­n array trá»±c tiáº¿p:
Math.max(nums); // NaN
Math.max.apply(null, nums); // 56 âœ…
// Modern: Math.max(...nums)       // 56 âœ…

// Custom variadic:
function welcome() {
  var args = Array.prototype.slice.call(arguments);
  var last = args.pop();
  console.log("Welcome " + args.join(", ") + ", and " + last);
}
welcome.apply(null, ["Peter", "Mike", "Judy", "Malcolm"]);
// 'Welcome Peter, Mike, Judy, and Malcolm'

// âš ï¸ Thay Ä‘á»•i original method â†’ borrowed copy cÅ©ng thay Ä‘á»•i
// (khÃ´ng pháº£i deep copy, chá»‰ reference)
```

### Tá»•ng Há»£p: Apply, Call & Bind

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  APPLY, CALL & BIND â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  call(obj, a, b):  gá»i NGAY, args riÃªng láº», set this         â”‚
â”‚  apply(obj, [a,b]): gá»i NGAY, args ARRAY, set this            â”‚
â”‚  bind(obj, a):     TRáº¢ FN Má»šI, this + partial args cá»‘ Ä‘á»‹nh   â”‚
â”‚                                                                 â”‚
â”‚  Set this: callback context, borrowing methods                â”‚
â”‚  Borrow: Array methods trÃªn array-like (arguments, NodeList)  â”‚
â”‚  Currying: bind(null, preset1, preset2) â†’ partial fn          â”‚
â”‚  Variadic: Math.max.apply(null, arr) | modern: ...spread      â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ apply/call = gá»i ngay | bind = tráº£ fn má»›i (khÃ´ng gá»i)   â”‚
â”‚  âš ï¸ Borrowed method = reference, thay Ä‘á»•i original = áº£nh hÆ°á»Ÿng â”‚
â”‚  Modern alt: spread (...), Array.from(), arrow fn              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 95. this Complete Reference (MDN-Level)

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  this COMPLETE REFERENCE (MDN-LEVEL)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Non-strict: this luÃ´n lÃ  object (this substitution)           â”‚
â”‚  Strict: this cÃ³ thá»ƒ báº¥t ká»³ value (undefined, null, etc.)    â”‚
â”‚  Arrow fn: lexical this (khÃ´ng thá»ƒ Ä‘á»•i báº±ng bind/call)      â”‚
â”‚  Constructor: this = new object (Ä‘áº·c biá»‡t)                     â”‚
â”‚  Class: instance vs static context                            â”‚
â”‚  Getter/Setter: this = object accessed on                     â”‚
â”‚  DOM handler: this = element fired event                      â”‚
â”‚  bind chá»‰ work Má»˜T Láº¦N: rebind bá»‹ ignored                    â”‚
â”‚  Module top-level: this = undefined                            â”‚
â”‚  Derived class: super() trÆ°á»›c khi dÃ¹ng this                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Function Context, Strict Mode & this Substitution

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// this = hidden parameter, gÃ¡n khi function Ä‘Æ°á»£c gá»i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getThis() {
  return this;
}

const obj1 = { name: "obj1" };
const obj2 = { name: "obj2" };
obj1.getThis = getThis;
obj2.getThis = getThis;

obj1.getThis(); // { name: 'obj1' }
obj2.getThis(); // { name: 'obj2' }
// CÃ¹ng function, khÃ¡c object invoke â†’ khÃ¡c this

// Prototype chain: this = object gá»i, khÃ´ng pháº£i object own
const obj3 = { __proto__: obj1, name: "obj3" };
obj3.getThis(); // { name: 'obj3' } (khÃ´ng pháº£i obj1!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Strict mode: this giá»¯ nguyÃªn value
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function strictThis() {
  "use strict";
  return this;
}

strictThis(); // undefined (khÃ´ng pháº£i window!)
strictThis.call(7); // 7 (Number primitive, KHÃ”NG wrap)
strictThis.call(null); // null (KHÃ”NG thÃ nh globalThis)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Non-strict: this substitution
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function nonStrictThis() {
  return this;
}

nonStrictThis(); // globalThis (window)
nonStrictThis.call(null); // globalThis (khÃ´ng pháº£i null!)
nonStrictThis.call(7); // Number {7} (WRAPPED!)
nonStrictThis.call("foo"); // String {'foo'} (WRAPPED!)

// Non-strict rules:
// null/undefined â†’ globalThis
// primitive â†’ wrapper object (Number, String, Boolean)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Callbacks: this thÆ°á»ng = undefined (strict) / globalThis
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function logThis() {
  "use strict";
  console.log(this);
}

[1, 2, 3].forEach(logThis);
// undefined, undefined, undefined

// thisArg parameter: set this cho callbacks
[1, 2, 3].forEach(logThis, { name: "obj" });
// {name:'obj'}, {name:'obj'}, {name:'obj'}
// forEach, map, filter, etc. Ä‘á»u cÃ³ thisArg
```

### Arrow Functions, Constructors & Class Context

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Arrow fn: lexical this (khÃ´ng thá»ƒ Ä‘á»•i!)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const globalObj = this;
const foo = () => this;
foo() === globalObj; // true

// call/apply/bind Bá»Š IGNORED vá»›i arrow fn:
const obj = { name: "obj" };
foo.call(obj) === globalObj; // true! (khÃ´ng Ä‘á»•i)
foo.bind(obj)() === globalObj; // true! (khÃ´ng Ä‘á»•i)

// Arrow fn trong method:
const myObj = {
  getThisGetter() {
    const getter = () => this; // lexical = myObj
    return getter;
  },
};
const fn = myObj.getThisGetter();
fn() === myObj; // true âœ…

// NhÆ°ng náº¿u unbind method trÆ°á»›c:
const fn2 = myObj.getThisGetter; // khÃ´ng gá»i trÃªn myObj
fn2()() === globalThis; // true! (this cá»§a getThisGetter = global)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Constructors: this = new object
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function C() {
  this.a = 37;
}
let o = new C();
o.a; // 37 â€” this = new object

function C2() {
  this.a = 37;
  return { a: 38 }; // return non-primitive overrides!
}
o = new C2();
o.a; // 38! (this.a = 37 bá»‹ discard)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// bind chá»‰ works Má»˜T Láº¦N!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function f() {
  return this.a;
}
const g = f.bind({ a: "azerty" });
g(); // 'azerty'

const h = g.bind({ a: "yoo" }); // bind Láº¦N 2 = IGNORED!
h(); // 'azerty' (khÃ´ng pháº£i 'yoo'!)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Class: instance vs static this
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

class MyClass {
  instanceField = this; // this = instance being constructed
  static staticField = this; // this = class itself
}

const c = new MyClass();
c.instanceField === c; // true
MyClass.staticField === MyClass; // true

// Derived class: super() TRÆ¯á»œC khi dÃ¹ng this!
class Base {}
class Derived extends Base {
  constructor() {
    // this = X! ReferenceError trÆ°á»›c super()
    super(); // táº¡o this binding
    this.a = 5; // OK sau super()
  }
}

// Bound methods in classes:
class Car {
  constructor() {
    this.sayBye = this.sayBye.bind(this); // fix context
  }
  sayHi() {
    console.log(`Hello from ${this.name}`);
  }
  sayBye() {
    console.log(`Bye from ${this.name}`);
  }
  get name() {
    return "Ferrari";
  }
}

const car = new Car();
const bird = { name: "Tweety" };
bird.sayHi = car.sayHi;
bird.sayHi(); // 'Hello from Tweety' (this = bird)
bird.sayBye = car.sayBye;
bird.sayBye(); // 'Bye from Ferrari' (bound â†’ this = car!)

// âš ï¸ Má»—i instance cÃ³ BAN SAO riÃªng cá»§a bound method
// â†’ tÄƒng memory. DÃ¹ng khi tháº­t sá»± cáº§n thiáº¿t.
```

### Getter/Setter, DOM & Global Context

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Getter/Setter: this = object ACCESSED on
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const o = {
  a: 1,
  b: 2,
  c: 3,
  get average() {
    return (this.a + this.b + this.c) / 3;
  },
};
o.average; // 2 â€” this = o

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM event handlers
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function bluify(e) {
  console.log(this === e.currentTarget); // true
  this.style.backgroundColor = "#A5D9F3";
}
// addEventListener: this = DOM element

// Inline handler:
// <button onclick="alert(this.tagName)"> â†’ this = button
// NhÆ°ng inner function trong handler: this = globalThis

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Global context & Modules
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

console.log(this === window); // true (script tag)
this.myVar = "hello"; // = window.myVar

// Module top-level: this = UNDEFINED!
// <script type="module">this</script> â†’ undefined

// Node.js CommonJS: this = module.exports
// eval: direct = enclosing this, indirect = globalThis
```

### Tá»•ng Há»£p: this Complete Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  this COMPLETE REFERENCE â€” SUMMARY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Context           â”‚ this value                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  obj.method()      â”‚ obj                                       â”‚
â”‚  fn() non-strict   â”‚ globalThis (window)                       â”‚
â”‚  fn() strict       â”‚ undefined                                 â”‚
â”‚  arrow fn          â”‚ lexical (enclosing scope, immutable)      â”‚
â”‚  new Fn()          â”‚ new object                                â”‚
â”‚  bind(obj)         â”‚ obj (permanently, once only)              â”‚
â”‚  call/apply(obj)   â”‚ obj                                       â”‚
â”‚  getter/setter     â”‚ object accessed on                        â”‚
â”‚  DOM handler       â”‚ DOM element                               â”‚
â”‚  class field       â”‚ instance (static: class itself)           â”‚
â”‚  module top-level  â”‚ undefined                                 â”‚
â”‚  global script     â”‚ globalThis                                â”‚
â”‚                                                                 â”‚
â”‚  Non-strict substitution: null/undefined â†’ globalThis          â”‚
â”‚  Non-strict substitution: primitive â†’ wrapper object           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 96. Introducing Asynchronous JavaScript

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INTRODUCING ASYNCHRONOUS JAVASCRIPT                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Synchronous = step-by-step, BLOCKING (chá» xong má»›i tiáº¿p)    â”‚
â”‚  JS = single-threaded: 1 thread = 1 viá»‡c táº¡i 1 thá»i Ä‘iá»ƒm     â”‚
â”‚  Long-running sync â†’ UI freeze (khÃ´ng type/click Ä‘Æ°á»£c)       â”‚
â”‚                                                                 â”‚
â”‚  Asynchronous = báº¯t Ä‘áº§u task â†’ return ngay â†’ notify khi xong â”‚
â”‚  Event handlers: gáº¯n listener, gá»i khi event xáº£y ra          â”‚
â”‚  Callbacks: fn truyá»n vÃ o fn khÃ¡c, gá»i lÃºc thÃ­ch há»£p          â”‚
â”‚  Callback Hell: nested callbacks â†’ pyramid of doom            â”‚
â”‚  Modern: Promises â†’ async/await thay tháº¿ callbacks            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Synchronous vs Asynchronous & Táº¡i Sao Cáº§n Async

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Synchronous: tá»«ng bÆ°á»›c, BLOCKING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const name = "Miriam";
const greeting = `Hello, my name is ${name}!`;
console.log(greeting); // Chá» dÃ²ng 1 â†’ dÃ²ng 2 â†’ dÃ²ng 3

// Synchronous function: caller CHá» function xong
function makeGreeting(name) {
  return `Hello, my name is ${name}!`;
}
const greet = makeGreeting("Miriam"); // BLOCKING cho Ä‘áº¿n khi return

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Váº¥n Ä‘á» vá»›i long-running sync: UI FREEZE!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function generatePrimes(quota) {
  const primes = [];
  while (primes.length < quota) {
    const candidate = Math.floor(Math.random() * 1000000);
    if (isPrime(candidate)) primes.push(candidate);
  }
  return primes; // CHá» vÃ i giÃ¢y!
}

// Khi generatePrimes cháº¡y:
// - KHÃ”NG type Ä‘Æ°á»£c trong textbox
// - KHÃ”NG click Ä‘Æ°á»£c button
// - UI hoÃ n toÃ n FREEZE
// VÃ¬ JS = SINGLE-THREADED: 1 thread = 1 viá»‡c

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âœ… Async giáº£i quyáº¿t: 4 bÆ°á»›c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// 1. Gá»i function báº¯t Ä‘áº§u operation
// 2. Function return NGAY Láº¬P Tá»¨C (khÃ´ng block)
// 3. Operation cháº¡y mÃ  khÃ´ng block main thread
// 4. NOTIFY káº¿t quáº£ khi hoÃ n thÃ nh

// Common async APIs:
// - fetch()          â†’ HTTP requests
// - getUserMedia()   â†’ camera/microphone
// - setTimeout()     â†’ delay execution
// - showOpenFilePicker() â†’ file selection
```

### Event Handlers, Callbacks & Callback Hell

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Event handlers = async programming
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// XMLHttpRequest: async API vá»›i events
const xhr = new XMLHttpRequest();

xhr.addEventListener("loadend", () => {
  console.log(`Finished: status ${xhr.status}`);
});

xhr.open("GET", "https://api.example.com/data");
xhr.send();
console.log("Started XHR request"); // Cháº¡y NGAY, khÃ´ng chá»!

// Output order:
// 'Started XHR request'      â† ngay láº­p tá»©c
// 'Finished: status 200'     â† khi response vá»

// Event handler = function gá»i KHÃ”NG ngay
// mÃ  khi event xáº£y ra (async notification)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Sync version: dá»… Ä‘á»c
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function doStep1(init) {
  return init + 1;
}
function doStep2(init) {
  return init + 2;
}
function doStep3(init) {
  return init + 3;
}

function doOperation() {
  let result = 0;
  result = doStep1(result); // 1
  result = doStep2(result); // 3
  result = doStep3(result); // 6
  console.log(`result: ${result}`); // 6
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// âŒ Callback version: Pyramid of Doom!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function doStep1(init, callback) {
  const result = init + 1;
  callback(result);
}
function doStep2(init, callback) {
  const result = init + 2;
  callback(result);
}
function doStep3(init, callback) {
  const result = init + 3;
  callback(result);
}

// Nested callbacks = Callback Hell:
function doOperation() {
  doStep1(0, (result1) => {
    doStep2(result1, (result2) => {
      doStep3(result2, (result3) => {
        console.log(`result: ${result3}`); // 6
      }); // â† Pyramid
    }); // â† of
  }); // â† Doom!
}

// Váº¥n Ä‘á»:
// - KhÃ³ Ä‘á»c (deeply nested indentation)
// - KhÃ³ debug
// - Error handling táº¡i Má»–I táº§ng, khÃ´ng pháº£i 1 nÆ¡i
// â†’ Modern JS: Promises + async/await thay callbacks
```

### Tá»•ng Há»£p: Async JavaScript Introduction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ASYNC JAVASCRIPT â€” SUMMARY                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Sync: step-by-step, blocking, caller chá» xong má»›i tiáº¿p     â”‚
â”‚  JS single-threaded: 1 thread = 1 viá»‡c táº¡i 1 thá»i Ä‘iá»ƒm      â”‚
â”‚  Long-running sync â†’ UI freeze (khÃ´ng tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£c)       â”‚
â”‚                                                                 â”‚
â”‚  Async: báº¯t Ä‘áº§u â†’ return ngay â†’ khÃ´ng block â†’ notify        â”‚
â”‚  Event handlers: gáº¯n listener, gá»i khi event                  â”‚
â”‚  XMLHttpRequest: early async API vá»›i events                   â”‚
â”‚  Callbacks: fn truyá»n vÃ o fn, gá»i khi thÃ­ch há»£p              â”‚
â”‚                                                                 â”‚
â”‚  âŒ Callback Hell = nested pyramid, khÃ³ Ä‘á»c/debug             â”‚
â”‚  âŒ Error handling táº¡i má»—i táº§ng nested                        â”‚
â”‚  âœ… Modern: Promises (.then/.catch) + async/await              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 97. Memory Management & Garbage Collection

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEMORY MANAGEMENT & GARBAGE COLLECTION                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Life cycle: Allocate â†’ Use â†’ Release                         â”‚
â”‚  JS: auto allocate + auto release (GC)                        â”‚
â”‚  Reference-counting: âŒ circular reference problem             â”‚
â”‚  Mark-and-sweep: âœ… modern, root â†’ reachable = alive           â”‚
â”‚  WeakMap/WeakSet: weakly held, GC-able keys                   â”‚
â”‚  WeakRef: weak reference, deref() â†’ undefined khi GC'd       â”‚
â”‚  FinalizationRegistry: callback khi object bá»‹ GC             â”‚
â”‚  V8: --max-old-space-size, --expose-gc                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Memory Life Cycle & Allocation

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Memory Life Cycle: Allocate â†’ Use â†’ Release
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// JS tá»± Ä‘á»™ng allocate khi khai bÃ¡o:
const n = 123; // allocate memory cho number
const s = "string"; // allocate memory cho string
const o = { a: 1, b: null }; // allocate object + properties
const a = [1, null, "str"]; // allocate array + values
function f(a) {
  return a + 2;
} // allocate function (callable object)

// Allocate qua function calls:
const d = new Date(); // allocate Date object
const el = document.createElement("div"); // allocate DOM element

// Allocate qua methods:
const s2 = "string".substring(0, 3); // Má»šI string
const a3 = [1, 2].concat([3, 4]); // Má»šI array
// substring: immutable â†’ JS CÃ“ THá»‚ optimize (khÃ´ng allocate)

// Use: Ä‘á»c/ghi memory Ä‘Ã£ allocate
// Release: khi khÃ´ng cáº§n ná»¯a â†’ GC xá»­ lÃ½
// âš ï¸ Váº¥n Ä‘á» khÃ³: XÃC Äá»ŠNH khi nÃ o memory khÃ´ng cáº§n (undecidable)
```

### Reference-Counting vs Mark-and-Sweep

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Reference-counting: 0 refs = collectible (âŒ naÃ¯ve)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let x = { a: { b: 2 } }; // 2 objects, x refs outer
let y = x; // y cÅ©ng ref outer â†’ 2 refs
x = 1; // outer cÃ²n 1 ref (y)
let z = y.a; // inner cÃ³ 2 refs (property + z)
y = "mozilla"; // outer = 0 refs â†’ GC âœ…
// inner váº«n cÃ³ z ref
z = null; // inner = 0 refs â†’ GC âœ…

// âŒ CIRCULAR REFERENCE: khÃ´ng bao giá» 0 refs!
function f() {
  const x = {};
  const y = {};
  x.a = y; // x refs y
  y.a = x; // y refs x â†’ circular!
  return "azerty";
}
f(); // x, y out of scope NHÆ¯NG má»—i cÃ¡i cÃ³ 1 ref
// Reference-counting: KHÃ”NG GC Ä‘Æ°á»£c! (memory leak)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Mark-and-sweep: unreachable = collectible (âœ… modern)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Root = global object
// Tá»« root, tÃ¬m táº¥t cáº£ reachable objects
// Unreachable objects = collected

// âœ… Fixes circular refs:
// Sau f() return, x vÃ  y KHÃ”NG reachable tá»« root
// â†’ cáº£ hai Ä‘Æ°á»£c GC dÃ¹ cÃ³ circular refs!

// Táº¥t cáº£ modern engines dÃ¹ng mark-and-sweep
// Cáº£i tiáº¿n: generational / incremental / concurrent / parallel
// NhÆ°ng core algorithm váº«n lÃ  mark-and-sweep

// âš ï¸ KhÃ´ng thá»ƒ manually trigger GC trong JS
// Äá»ƒ GC: lÃ m object unreachable (set = null, let go out of scope)
```

### WeakMap, WeakSet, WeakRef & FinalizationRegistry

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WeakMap / WeakSet: weakly held keys
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// WeakMap: key-value, keys bá»‹ GC khi khÃ´ng strong ref
// WeakSet: unique values, values bá»‹ GC khi khÃ´ng strong ref

// Constraints:
// - Chá»‰ objects/symbols lÃ m key (primitives = forged: 1 === 1)
// - KHÃ”NG iterable (khÃ´ng .keys(), .values(), .size)
// - KhÃ´ng .clear()

let obj = { data: "important" };
const wm = new WeakMap();
wm.set(obj, "metadata");
wm.get(obj); // 'metadata'

obj = null; // khÃ´ng strong ref â†’ key GC-able
// wm entry tá»± Ä‘á»™ng biáº¿n máº¥t

// Ephemerons: key connectivity Ä‘á»‹nh value connectivity
// (khÃ´ng pháº£i ngÆ°á»£c láº¡i)
const wm2 = new WeakMap();
const key = {};
wm2.set(key, { key }); // value refs keyâ€” nhÆ°ng váº«n GC-able nhá» ephemerons

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WeakRef: weak reference, deref() khi cáº§n
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Use case: cache system (Map + WeakRef)
function cached(getter) {
  const cache = new Map();
  return async (key) => {
    if (cache.has(key)) {
      const val = cache.get(key).deref();
      if (val !== undefined) return val; // váº«n sá»‘ng!
    }
    const value = await getter(key);
    cache.set(key, new WeakRef(value)); // weak ref!
    return value;
  };
}
// deref() = undefined khi object Ä‘Ã£ bá»‹ GC
// KhÃ´ng dÃ¹ng WeakMap vÃ¬: WeakMap keys weak, VALUES strong
// á» Ä‘Ã¢y cáº§n VALUES weak (large objects)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FinalizationRegistry: callback khi GC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const registry = new FinalizationRegistry((key) => {
  // Gá»i khi object Ä‘Ã£ GC
  if (!cache.get(key)?.deref()) {
    cache.delete(key); // cleanup stale entry
  }
});
registry.register(value, key); // observe GC

// âš ï¸ KhÃ´ng guarantee callback gá»i khi nÃ o / cÃ³ gá»i khÃ´ng
// Chá»‰ dÃ¹ng cho non-critical cleanup
// Deterministic cleanup: dÃ¹ng try...finally

// V8 config:
// node --max-old-space-size=6000 index.js
// node --expose-gc --inspect index.js
```

### Tá»•ng Há»£p: Memory Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MEMORY MANAGEMENT â€” SUMMARY                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Life cycle: Allocate â†’ Use â†’ Release (GC)                    â”‚
â”‚  JS auto allocate: value init + function calls                â”‚
â”‚  Methods táº¡o objects má»›i: substring, concat, slice              â”‚
â”‚                                                                 â”‚
â”‚  Reference-counting: 0 refs = GC (âŒ circular ref leak)       â”‚
â”‚  Mark-and-sweep: unreachable tá»« root = GC (âœ… modern)         â”‚
â”‚  âœ… Fixes circular refs (unreachable dÃ¹ cÃ³ ref láº«n nhau)      â”‚
â”‚                                                                 â”‚
â”‚  WeakMap/WeakSet: keys weakly held, GC-able, not iterable     â”‚
â”‚  WeakRef: weak ref, deref() = undefined khi GC'd              â”‚
â”‚  FinalizationRegistry: callback khi GC (âš ï¸ no guarantee)      â”‚
â”‚  Deterministic cleanup: try...finally (khÃ´ng pháº£i GC)         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 98. Front-End Architecture of Large-Scale Projects

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONT-END ARCHITECTURE (LARGE-SCALE)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Core: giáº£i quyáº¿t váº¥n Ä‘á», tá»‰ lá»‡ ngÆ°á»i/hiá»‡u quáº£, Ä‘o lÆ°á»ng Ä‘Æ°á»£c â”‚
â”‚  Chia 2 táº§ng: Basic Layer + Application Layer                  â”‚
â”‚                                                                 â”‚
â”‚  BASIC LAYER (háº¡ táº§ng, Ã­t liÃªn quan business):                  â”‚
â”‚    GitLab â†’ Version Mgmt â†’ Jenkins CI/CD                     â”‚
â”‚    Pure FE versioning â†’ Scaffold â†’ Node BFF                  â”‚
â”‚    Analytics/Tracking â†’ Monitoring/Alarms                     â”‚
â”‚    Security â†’ ESLint â†’ Canary Release                        â”‚
â”‚    FE-BE separation â†’ Mock â†’ Backups                         â”‚
â”‚                                                                 â”‚
â”‚  APPLICATION LAYER (gáº§n user, giáº£i váº¥n Ä‘á» cá»¥ thá»ƒ):             â”‚
â”‚    Multi-page > SPA â†’ Split by app/domain                    â”‚
â”‚    Component Library â†’ Unified Tech Stack                    â”‚
â”‚    Browser compat â†’ Content Platform â†’ RBAC                  â”‚
â”‚    SSO â†’ CDN â†’ Load Balancing â†’ Shared APIs                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Basic Layer: Háº¡ Táº§ng & CI/CD

```
GITLAB + VERSION MANAGEMENT:
â€¢ Self-hosted GitLab: báº£o vá»‡ code assets, quáº£n lÃ½ permissions
â€¢ Branch lock sau release: 0.0.1 released â†’ branch LOCKED
â€¢ Auto deploy: dev push â†’ Jenkins auto compile/package/publish
â€¢ Multi-version coexist: rollback nhanh khi bug production

JENKINS CI/CD:
â€¢ GitLab push â†’ auto compile â†’ package â†’ merge â†’ CDN/server
â€¢ Dev chá»‰ focus code, khÃ´ng lo deploy/env

PURE FE VERSIONING:
â€¢ Deploy new version â†’ external link sáºµn (chÆ°a active)
â€¢ Config tool Ä‘á»•i HTML resource imports â†’ new version live
â€¢ KhÃ´ng cáº§n backend deploy khi chá»‰ thay Ä‘á»•i frontend
â€¢ Rollback nhanh qua config

SCAFFOLDING:
â€¢ Unified project structure: dá»… handover, dá»… switch projects
â€¢ Pre-import component libraries + config
â€¢ Giáº£m thá»i gian setup, thá»‘ng nháº¥t tech stack

NODE BFF (Backend For Frontend):
â€¢ SSR cho SEO (React/Vue isomorphic rendering)
â€¢ Giáº£m blank screen time homepage
â€¢ FE Ä‘á»c trá»±c tiáº¿p backend services/DB
â€¢ âš ï¸ Risk: cÃ³ thá»ƒ gÃ¢y P0 failures

ANALYTICS / TRACKING SYSTEM:
â€¢ PV/UV (daily/weekly/monthly/yearly)
â€¢ Feature usage tracking
â€¢ Error capture + charts
â€¢ Decouple tá»« business logic (register â†’ import â†’ view)
â€¢ Data = tiá»n, data = vÅ© khÃ­ tá»‘t nháº¥t

MONITORING & ALARMS:
â€¢ Traffic drop >80% â†’ auto alarm + email
â€¢ Error spike >200% â†’ alarm
â€¢ No visits (báº¥t thÆ°á»ng) â†’ alarm
â€¢ Auto summary: browser/OS/error distribution
â€¢ PhÃ¡t hiá»‡n bug sá»›m (trÆ°á»›c work order)

SECURITY:
â€¢ XSS: encode user input, khÃ´ng dÃ¹ng eval
â€¢ HTTPS: báº¯t buá»™c
â€¢ CSRF: server-side token handling

ESLINT:
â€¢ Giáº£m low-level bugs (spelling errors)
â€¢ TÄƒng readability + maintainability
â€¢ Config vÃ o scaffold, mandatory khi push GitLab

CANARY / GRAY-SCALE RELEASE:
â€¢ Phases: 1% â†’ 5-10% â†’ 30-50% â†’ 100%
â€¢ Test trÃªn production vá»›i nhÃ³m nhá»
â€¢ Cho phÃ©p IP/account cá»¥ thá»ƒ access gray version
â€¢ Rollback nhanh náº¿u cÃ³ váº¥n Ä‘á»

FE-BE SEPARATION (HTML ownership):
â€¢ Backend own HTML: inject tracking JS, i18n, page ID
â€¢ Frontend own: CSS, JS, static assets
â€¢ Giáº£m coupling giá»¯a pages vÃ  functions

MOCK (trong scaffold):
â€¢ ?debug=true â†’ Ä‘á»c local JSON thay vÃ¬ API
â€¢ src/test_ajax/userinfo.json
â€¢ Giáº£m chi phÃ­ communication FE-BE parallel dev

BACKUPS:
â€¢ Regular backups + multi-machine + disaster recovery
â€¢ TrÃ¡nh máº¥t data do server crash / rm -f / DB errors
```

### Application Layer: Architecture & Services

```
MULTI-PAGE > SPA (large projects):
â€¢ Pages Ä‘á»™c láº­p: refactor 1 page khÃ´ng áº£nh hÆ°á»Ÿng pages khÃ¡c
â€¢ Update tá»«ng page riÃªng (SPA: update 1 = update all)
â€¢ Version control Ä‘Æ¡n giáº£n hÆ¡n
â€¢ Canary release dá»… hÆ¡n
â€¢ NhÆ°á»£c: blank screen khi chuyá»ƒn page (acceptable)

SPLIT BY APPLICATION/DOMAIN:
â€¢ 1 business function = 1 repo (FE + BE)
â€¢ KhÃ´ng gá»™p táº¥t cáº£ FE vÃ o 1 repo (khÃ³ maintain, khÃ´ng an toÃ n)
â€¢ Permission per app, publish per app

COMPONENT LIBRARY:
â€¢ Prerequisite: unified tech stack
â€¢ TypeScript + extensible + detailed docs
â€¢ Version isolation: minor = optimize, major = breaking
â€¢ Cáº§n UI designer tham gia
â€¢ <10 FE devs: dÃ¹ng Antd/third-party (cost-effective hÆ¡n)

UNIFIED TECH STACK:
â€¢ 1 framework: Vue (average team) / React (strong team)
â€¢ IE8: jQuery
â€¢ 1 component library (built/third-party)
â€¢ 1 version per third-party (maps, charts, etc.)
â€¢ Avoid reinventing the wheel giá»¯a teams

BROWSER COMPATIBILITY:
â€¢ PostCSS: auto vendor prefixes
â€¢ Webpack loader: handle special cases
â€¢ Team code standards: trÃ¡nh unstable syntax
â€¢ Share solutions cho common bugs

CONTENT PLATFORM:
â€¢ Internal blog + forum
â€¢ Knowledge sharing, tech discussion
â€¢ Giáº£m communication cost, tÄƒng tech accumulation

ACCESS CONTROL (RBAC):
â€¢ Automated: create â†’ approve â†’ auto-delete khi resign
â€¢ Time-limited permissions
â€¢ Clear approval flow

SSO (Single Sign-On):
â€¢ Login 1 láº§n, access táº¥t cáº£ business lines
â€¢ Unified user data, giáº£m dev cost per business
â€¢ TÄƒng UX, traffic redirection

CDN:
â€¢ Users access gáº§n hÆ¡n â†’ giáº£m latency
â€¢ Giáº£m bandwidth cost, há»— trá»£ video/static/live
â€¢ Giáº£m cross-carrier slow, giáº£m DDoS

LOAD BALANCING (Nginx):
â€¢ Giáº£m load server Ä‘Æ¡n, dá»… scale
â€¢ Handle peak traffic (events, campaigns)
â€¢ TÄƒng availability, scalability, stability

SHARED APIs (PC + H5):
â€¢ CÃ¹ng business = cÃ¹ng interface (redundant data OK)
â€¢ Append data khi business thay Ä‘á»•i (khÃ´ng break)
â€¢ Unique API chá»‰ khi special flow per platform
```

### Tá»•ng Há»£p: Frontend Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND ARCHITECTURE â€” SUMMARY                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Core: problem-solving, cost/benefit, measurable results       â”‚
â”‚  10+ FE devs â†’ cÃ ng nhiá»u ngÆ°á»i â†’ cÃ ng cáº§n architecture     â”‚
â”‚                                                                 â”‚
â”‚  BASIC: GitLab + Version + Jenkins + FE versioning            â”‚
â”‚         Scaffold + Node BFF + Analytics + Monitoring           â”‚
â”‚         Security + ESLint + Canary + FE-BE sep + Mock         â”‚
â”‚                                                                 â”‚
â”‚  APP:   Multi-page + Split by domain + Component Lib          â”‚
â”‚         Unified stack + Compat + Content + RBAC               â”‚
â”‚         SSO + CDN + Load Balancing + Shared APIs               â”‚
â”‚                                                                 â”‚
â”‚  Æ¯Æ° tiÃªn theo quy mÃ´/tiáº¿n Ä‘á»™/nhÃ¢n sá»±, khÃ´ng Ã¡p dá»¥ng cá»©ng   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 99. Monorepo: Advantages, Pitfalls & Selection

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MONOREPO: ADVANTAGES, PITFALLS & SELECTION                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Evolution: Monolith â†’ MultiRepo â†’ MonoRepo                   â”‚
â”‚  Monorepo = nhiá»u projects trong 1 repo                        â”‚
â”‚  Google, Facebook, Microsoft Ä‘á»u dÃ¹ng                           â”‚
â”‚                                                                 â”‚
â”‚  Pitfalls: Ghost deps â†’ pnpm fix                              â”‚
â”‚           Long install â†’ hoist + pnpm cache                   â”‚
â”‚           Long build â†’ incremental + parallel                  â”‚
â”‚                                                                 â”‚
â”‚  Tools: Turborepo (cache) | Rush (Microsoft)                   â”‚
â”‚         Nx (distributed) | Lerna (versions)                    â”‚
â”‚         pnpm workspace (fastest install)                        â”‚
â”‚  Recommend: Lerna + pnpm â†’ add Nx khi scale                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Evolution & MultiRepo vs MonoRepo

```
EVOLUTION:
â‘  Monolith: 1 repo, 1 app khá»•ng lá»“
   â†’ Code nhiá»u + phá»©c táº¡p, build cháº­m

â‘¡ MultiRepo: nhiá»u repo, má»—i module riÃªng
   âœ… Decouple modules, test/release Ä‘á»™c láº­p
   âŒ Cross-repo share khÃ³, dep management phá»©c táº¡p

â‘¢ MonoRepo: 1 repo, nhiá»u modules
   âœ… Share code/config, dep consistency
   âŒ Repo lá»›n (GB), git clone cháº­m

MULTIREPO vs MONOREPO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   â”‚ MultiRepo            â”‚ MonoRepo              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Code Visibility    â”‚ âœ… Isolation          â”‚ âœ… Full overview       â”‚
â”‚                   â”‚ âŒ Debug deps hard   â”‚ âŒ Non-owner modify   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dependencies       â”‚ âŒ Duplicate installsâ”‚ âœ… Hoist, install onceâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Permissions        â”‚ âœ… Per-repo access   â”‚ âŒ No project-level   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dev Iteration      â”‚ âŒ Switch repos hard â”‚ âœ… All-in-one, reuse  â”‚
â”‚                   â”‚ âŒ npm link manual   â”‚ âœ… Auto dep linking   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Config             â”‚ âŒ Each repo differs â”‚ âœ… Consistent configs â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Build/Deploy       â”‚ âŒ Manual version +  â”‚ âœ… 1 command deploys  â”‚
â”‚                   â”‚   multi-repo deploy â”‚   with dep order     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SCENARIOS:
âœ… Large-scale: nhiá»u projects liÃªn quan cháº·t
âœ… Shared code: component libs, utils, configs
âœ… Unified CI/CD: incremental builds
âš ï¸ Cáº©n tháº­n: repo quÃ¡ lá»›n, access control phá»©c táº¡p, teams Ä‘á»™c láº­p cao
```

### Pitfalls & Solutions

```
GHOST DEPENDENCIES:
â€¢ npm/yarn hoist deps â†’ project dÃ¹ng dep KHÃ”NG cÃ³ trong package.json
â€¢ Dep bá»‹ remove bá»Ÿi project khÃ¡c â†’ project nÃ y CRASH
â€¢ âœ… Fix: pnpm (node_modules structure = package.json deps)

LONG INSTALL TIME:
â€¢ Má»—i project cÃ³ package.json riÃªng â†’ total deps lá»›n
â€¢ âœ… Fix: hoist same versions lÃªn root + pnpm cache (hard links)

LONG BUILD TIME:
â€¢ Sequential build giá»¯a dependent projects
â€¢ âœ… Fix: incremental build (chá»‰ build changed)
â€¢ âœ… Fix: parallel build (Turborepo/Nx/Rush)
```

### Tool Selection & Comparison

```
BUILD-FOCUSED TOOLS (performance optimization):

TURBOREPO (Vercel):
â€¢ Parallel tasks: config dep order trong turbo.json
â€¢ Local cache: node_modules/.cache/turbo/ (láº§n 2 = instant)
â€¢ Remote cache: share cache trong CI/CD team (cloud)

RUSH (Microsoft):
â€¢ Ghost deps FIXED: install vÃ o common/temp + symlinks
â€¢ Parallel build + plugin system
â€¢ Auto version + ChangeLog generation
â€¢ Rush Stack: Heft (build) + API Extractor + ESLint config

NX (Nrwl):
â€¢ Cache + remote cache (public API, tá»± host Ä‘Æ°á»£c)
â€¢ Incremental build (minimal, khÃ´ng full)
â€¢ Parallel build (auto analyze dep graph)
â€¢ Distributed build via Nx Cloud (nhiá»u CI agents)
â€¢ Speed up Lerna vá»›i Nx task scheduler

LIGHTWEIGHT TOOLS (dep + version mgmt):

LERNA:
â€¢ 3 viá»‡c chÃ­nh: run commands, manage deps, publish packages
â€¢ Auto npm link local packages
â€¢ 2 modes:
  - Fixed/Locked: táº¥t cáº£ packages cÃ¹ng version ("version": "0.0.0")
  - Independent: má»—i package version riÃªng ("version": "independent")
â€¢ Commands: init, create, add, bootstrap, exec, run, clean, publish
â€¢ lerna publish: detect changes â†’ update versions â†’ git tag â†’ npm publish
â€¢ âŒ KhÃ´ng cÃ³ build/test/cache capabilities

YARN/NPM WORKSPACE:
â€¢ "workspaces": ["packages/*"] trong root package.json
â€¢ Dep hoisting lÃªn root node_modules
â€¢ Káº¿t há»£p vá»›i Lerna: yarn = dep mgmt, Lerna = publishing
â€¢ lerna.json: "npmClient": "yarn", "useWorkspaces": true

PNPM WORKSPACE:
â€¢ CAS (Content Addressable Storage): hard links tá»« store
â€¢ Virtual store: node_modules/.pnpm/<pkg>@<version>
â€¢ âœ… No ghost deps (structure = package.json)
â€¢ âœ… Fastest install (hard link, khÃ´ng copy)
â€¢ âœ… Disk efficient (same version = 1 copy)

TOOL COMPARISON:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚ Turbo   â”‚ Rush â”‚ Nx â”‚ Lerna â”‚ pnpm â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dep Mgmt      â”‚ âŒ      â”‚ âœ…   â”‚ âŒ â”‚ âŒ    â”‚ âœ…   â”‚
â”‚ Version Mgmt  â”‚ âŒ      â”‚ âœ…   â”‚ âŒ â”‚ âœ…    â”‚ âŒ   â”‚
â”‚ Incremental   â”‚ âœ…      â”‚ âœ…   â”‚ âœ… â”‚ âŒ    â”‚ âŒ   â”‚
â”‚ Plugins       â”‚ âœ…      â”‚ âœ…   â”‚ âœ… â”‚ âŒ    â”‚ âŒ   â”‚
â”‚ Cloud Cache   â”‚ âœ…      â”‚ âœ…   â”‚ âœ… â”‚ âŒ    â”‚ âŒ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜

RECOMMENDATION (Progressive):
â‘  Start: Lerna + pnpm workspace + lerna-changelog
   â†’ Dep mgmt + version mgmt + publish
â‘¡ Scale: thÃªm Nx/Turborepo
   â†’ Incremental + parallel + cache builds
```

### Tá»•ng Há»£p: Monorepo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MONOREPO â€” SUMMARY                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Monolith â†’ MultiRepo â†’ MonoRepo (evolution)                  â”‚
â”‚  MonoRepo: share code, unified config, 1 cmd deploy           â”‚
â”‚  âŒ Ghost deps, long install/build, no per-project access       â”‚
â”‚                                                                 â”‚
â”‚  pnpm: no ghost deps + fastest install + disk efficient       â”‚
â”‚  Lerna: version mgmt + publish (fixed/independent)             â”‚
â”‚  Turborepo: parallel + local/remote cache                      â”‚
â”‚  Nx: incremental + distributed build + Nx Cloud                â”‚
â”‚  Rush: Microsoft, plugin system, ghost deps fixed              â”‚
â”‚                                                                 â”‚
â”‚  Start: Lerna + pnpm â†’ Scale: + Nx/Turborepo                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 100. Front-End Infrastructure for Non-Major Companies

### Tá»•ng Quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONT-END INFRASTRUCTURE (NON-MAJOR COMPANIES)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Äá»‹nh nghÄ©a: FE Engineering + DevOps + CI/CD + BFF + Tools      â”‚
â”‚  4 táº§ng: Business âŠƒ Engineering âŠƒ Frontend âŠƒ Backend           â”‚
â”‚                                                                 â”‚
â”‚  Táº¡i sao: reuse, efficiency, standardize, team growth          â”‚
â”‚  CÃ¡ch thá»±c hiá»‡n: people â†’ problems â†’ solutions â†’ execute      â”‚
â”‚  4 traits: tech sound + stable + efficient + good UX           â”‚
â”‚                                                                 â”‚
â”‚  16 COMPONENTS:                                                 â”‚
â”‚    Standards â†’ Docs â†’ Templates â†’ CLI Scaffold                â”‚
â”‚    Component Lib â†’ Responsive/Adaptive â†’ Utils/Hooks          â”‚
â”‚    Tool Automation â†’ BFF â†’ SSR â†’ CI/CD                       â”‚
â”‚    Monitoring â†’ Visualization â†’ Performance                    â”‚
â”‚    Low-Code â†’ Micro-Frontend                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Infrastructure Layers & Why Build

```
INFRASTRUCTURE LAYERS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUSINESS INFRA (toÃ n team)                          â”‚
â”‚  FE/BE infra + specs + product rules + design specs â”‚
â”‚  R&D process + testing + release standards + BizMW  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ENGINEERING INFRA (toÃ n engineering team)            â”‚
â”‚  Coding specs + API specs + FE-BE collab            â”‚
â”‚  Env deploy + microservices + performance + securityâ”‚
â”‚  Monitoring + visualization                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  FRONTEND INFRA (chá»‰ FE team)                        â”‚
â”‚  FE specs + scaffold + templates + component lib    â”‚
â”‚  Utils + BFF + CI/CD + tracking/monitoring           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BACKEND INFRA (chá»‰ BE team)                         â”‚
â”‚  BE specs + templates + security + logging           â”‚
â”‚  Microservices + REST API + DB + permissions         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Core overlap: coding specs + R&D process + release standards

WHY BUILD FE INFRA?
â€¢ Business reuse: giáº£m duplicate code giá»¯a projects
â€¢ R&D efficiency: tÄƒng tá»‘c Ä‘á»™ phÃ¡t triá»ƒn
â€¢ Standardize: thá»‘ng nháº¥t quy trÃ¬nh R&D
â€¢ Team growth: nÃ¢ng cao ká»¹ nÄƒng team
â€¢ Tech influence: áº£nh hÆ°á»Ÿng trong community
â€¢ Open source: Ä‘Ã³ng gÃ³p ngÆ°á»£c láº¡i

HOW TO PROMOTE:
â‘  Find people: chá»n dev cÃ³ Ä‘á»™ng lá»±c, systemic thinking, stable
â‘¡ Define problems: dá»±a trÃªn nhÃ¢n sá»±, tech stack, business hiá»‡n táº¡i
â‘¢ Propose solutions: viáº¿t BP chi tiáº¿t, thuyáº¿t phá»¥c leadership
â‘£ Execute incrementally: khÃ´ng áº£nh hÆ°á»Ÿng business hiá»‡n táº¡i

4 KEY TRAITS:
â€¢ Tech soundness: giáº£i phÃ¡p ká»¹ thuáº­t Ä‘Ãºng
â€¢ Stability: khÃ´ng gÃ¢y downtime
â€¢ R&D efficiency: tÄƒng nÄƒng suáº¥t thá»±c sá»±
â€¢ User experience: UX tá»‘t cho end-user
```

### 16 FE Infrastructure Components

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘  STANDARDS â€” Front-End Specifications (Quy chuáº©n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã nghÄ©a: giáº£m dev cost + ensure consistency + tÄƒng team efficiency
"Náº¿u FE khÃ´ng chuáº©n, pháº§n cÃ²n láº¡i pháº£i chá»."

3 loáº¡i programmer:
â€¢ "Bá» cuá»™c": code cháº¡y lÃ  Ä‘Æ°á»£c
â€¢ "Äá»§ tiÃªu chuáº©n": code cháº¡y khÃ´ng bug
â€¢ "Xuáº¥t sáº¯c": code cháº¡y, khÃ´ng bug, readable + maintainable + reusable
â†’ RÃµ rÃ ng nÃªn chá»n loáº¡i thá»© 3

                        å‰ç«¯è§„èŒƒ (FE Standards)
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚           â”‚           â”‚              â”‚
    CRè§„èŒƒ    BFFç ”å‘è§„èŒƒ   è®¾è®¡è§„èŒƒ    æµ‹è¯•è§„èŒƒ       å…¶å®ƒè§„èŒƒ
  (Code Review)(BFF Dev) (Design)  (Testing)      (Others)
    â”‚           â”‚          â”‚          â”‚              â”‚
    â”œâ”€ CRå®¡æ ¸äºº    â”œâ”€ FE-BEåä½œ  â”œâ”€é€šç”¨ç»„ä»¶åº“  â”œâ”€ Unit tests    â”œâ”€ æŠ€æœ¯æ ˆè§„èŒƒ
    â”‚   (reviewer) â”‚  è§„èŒƒ     â”‚  è§„èŒƒ      â”‚  cho componentâ”‚  (tech stack)
    â”œâ”€ CRåŸºæœ¬è§„èŒƒ   â”‚          â”œâ”€é€šç”¨æ ·å¼   â”‚  library     â”‚  1.Lang: TS/JS
    â”‚  (basic rules)â”‚          â”‚  è§„èŒƒ     â”‚              â”‚  2.UI Framework
    â””â”€ CRå†…å®¹å®šä¹‰   â”‚          â””â”€å¸¸è§äº¤äº’   â”‚              â”‚  3.Build: Webpack/Vite
       (content)   â”‚            è§„èŒƒ      â”‚              â”‚  4.Pkg: npm/yarn/pnpm
                   â”‚                     â”‚              â”‚
                   â”‚                     â”‚           â”œâ”€ æµè§ˆå™¨æ”¯æŒè§„èŒƒ
                   â”‚                     â”‚           â”‚  (browser support)
                   â”‚                     â”‚           â””â”€ IDEç¼–è¾‘å™¨è§„èŒƒ
                   â”‚                     â”‚              (IDE standards)
                   â”‚                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
          â”‚                        â”‚    â”‚
     å‰ç«¯å‘½åè§„èŒƒ              ç›®å½•æ„å»ºè§„èŒƒ
     (FE Naming)            (Directory)
       â”‚                       â”‚
       â”œâ”€ File/folder naming   â”œâ”€ Vue3 directory
       â””â”€ Code naming          â”œâ”€ Nuxt3 directory
                               â””â”€ Others...
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                â”‚
       ç¼–ç¨‹è§„èŒƒ                          GIT è§„èŒƒ
     (Coding Standards)              (Git Standards)
       â”‚                               â”‚
       â”œâ”€ HTML, JS, TS, CSS,           â”œâ”€ GIT branch naming
       â”‚  Vue, React, ...              â”œâ”€ GIT branchä¿ç•™è§„èŒƒ
       â”‚                               â”œâ”€ GIT COMMIT æ ¡éªŒ
       â””â”€ å·¥å…·è‡ªåŠ¨åŒ–                     â”œâ”€ ESLint æ ¡éªŒ
          (Tool Automation)            â”œâ”€ Stylelint æ ¡éªŒ
          â”œâ”€ ESLint                     â””â”€ ç®€ç¹ä½“æ ¡éªŒ
          â”œâ”€ Prettier
          â””â”€ Stylelint
          æ³¨æ„ï¼šä¼˜å…ˆä½¿ç”¨å·¥å…·è‡ªåŠ¨åŒ–ï¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¡ DOCUMENTATION â€” Front-End Documentation (TÃ i liá»‡u)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Váº¥n Ä‘á» thÆ°á»ng gáº·p:
â€¢ Nhiá»u cÃ´ng ty nhá» THIáº¾U tÃ i liá»‡u nghiÃªm trá»ng
â€¢ New hire sÃ¡ng setup env, chiá»u code requirements
â€¢ 1 thÃ¡ng vÃ o váº«n khÃ´ng biáº¿t org structure + business divisions
â€¢ Senior háº§u nhÆ° khÃ´ng tÆ°Æ¡ng tÃ¡c vá»›i new hire
â€¢ Chuyá»ƒn dá»± Ã¡n â†’ bá»‘i rá»‘i, khÃ´ng biáº¿t báº¯t Ä‘áº§u tá»« Ä‘Ã¢u

Ã nghÄ©a: onboard nhanh + integrate team + hiá»ƒu business

                    å‰ç«¯æ–‡æ¡£ (FE Documentation)
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚       â”‚          â”‚              â”‚
     æ–°äººæ–‡æ¡£    æŠ€æœ¯æ–‡æ¡£  ä¸šåŠ¡æ–‡æ¡£   é¡¹ç›®æ–‡æ¡£       è®¡åˆ’æ–‡æ¡£
   (Onboarding)(Tech)  (Business)(Project)     (Planning)
       â”‚                              â”‚              â”‚
       â”œâ”€ å…¬å¸ä»‹ç»                     â”œâ”€ æ—§é¡¹ç›®æ–‡æ¡£    â”œâ”€ æœˆåº¦è®¡åˆ’
       â”‚  (company intro)             â”‚  (legacy docs) â”‚  (monthly)
       â”œâ”€ ä¸šåŠ¡ä»‹ç»                     â”‚  (cáº§n tÃ­ch lÅ©y â”‚ â”œâ”€ å­£åº¦è®¡åˆ’
       â”‚  (business intro)            â”‚   documentation)â”‚  (quarterly)
       â”œâ”€ å›¢é˜Ÿä»‹ç»                     â””â”€ æ–°é¡¹ç›®æ–‡æ¡£    â””â”€ å¹´åº¦è®¡åˆ’
       â”‚  (team intro)                   (new project)    (yearly)
       â”œâ”€ æµç¨‹ä»‹ç»
       â”‚  (process intro)
       â””â”€ ç­‰ç­‰...
                          â”‚
                    æŠ€æœ¯åˆ†äº«äº¤æµä¼šæ–‡æ¡£
                    (Tech Sharing Docs)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¢ TEMPLATES â€” Front-End Project Templates (Máº«u dá»± Ã¡n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scenario: Boss muá»‘n thÃªm business line má»›i, FE-BE separation
â†’ Dev chá»n tech stack, táº¡o project
â†’ Tá»‘n thá»i gian, cÃ³ thá»ƒ xung Ä‘á»™t tech stack giá»¯a projects
â†’ Cáº§n project template chuáº©n!

Ã nghÄ©a: táº¡o project nhanh + unified tech stack + dá»… quáº£n lÃ½

           å‰ç«¯é¡¹ç›®æ¨¡æ¿ (FE Project Templates)
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      â”‚       â”‚       â”‚          â”‚          â”‚
     Vueæ¨¡æ¿  Nuxt.js  å°ç¨‹åº   å¾®å‰ç«¯      BFF       ç®¡ç†åå°
    (Vue TPL) (Nuxt)  (Mini   (Micro-FE  (BFF      (Admin
       â”‚             Program)  TPL)      TPL)      TPL)
       â”œâ”€ Vue2 (deprecated)
       â””â”€ Vue3 æ¨¡æ¿
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚              â”‚
     Reactæ¨¡æ¿      Nodeæ¨¡æ¿       å…¶å®ƒæ¨¡æ¿
   (deprecated)   (Node TPL)    (Others)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘£ CLI SCAFFOLDING â€” Front-End Scaffolding (GiÃ n giÃ¡o)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TiÃªu chuáº©n Ä‘o lÆ°á»ng FE team trÆ°á»Ÿng thÃ nh
>90% teams chá»‰ dÃ¹ng CLI Ä‘á»ƒ táº¡o project â†’ CHÆ¯A maximize resources!

Scenario:
- Templates á»Ÿ trÃªn chá»‰ lÃ  fixed templates
- NhÆ°ng má»—i project config KHÃC nhau
- CÃ³ project khÃ´ng cáº§n TypeScript, cÃ³ project khÃ´ng cáº§n git hooks
â†’ CLI scaffold CÃ“ THá»‚ Ä‘Ã¡p á»©ng táº¥t cáº£ nhu cáº§u nÃ y

5 Ã½ nghÄ©a:
â€¢ Setup project nhanh
â€¢ Unified tech stack
â€¢ Standardize coding style
â€¢ TÄƒng R&D efficiency
â€¢ Automation

              å‰ç«¯è„šæ‰‹æ¶ (CLI Scaffold)
                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚       â”‚    â”‚    â”‚          â”‚          â”‚
 å¿«é€Ÿåˆ›å»º  è§„èŒƒä»£ç   mock  é›†åˆ    commit   è‡ªåŠ¨åŒ–éƒ¨ç½²  é›†åˆå·¥å…·
 é¡¹ç›®      (Code   æ•°æ®   å¾®å‰ç«¯  hook     (Auto     å‡½æ•°/Hooksç­‰
 (Quick   Style)  (Mock (Micro (Commit  Deploy)   (Utils/
  Create)         Data) -FE    Hooks)             Hooks
                        Integ)                    Integration)
    â”‚          â”‚          â”‚
    â”‚          â”‚          â”‚
 æ’ä»¶/æ¨¡å—    æŒç»­å»ºè®¾ä¸­...
 å¿«é€Ÿä¸Šæ‰‹     (Continuously
 (Plugin/     Improving)
  Module
  Quick Start)

CLI scaffold KHÃ”NG CHá»ˆ táº¡o project:
â€¢ å¿«é€Ÿåˆ›å»ºé¡¹ç›®: táº¡o project tá»« template trong vÃ i giÃ¢y
â€¢ è§„èŒƒä»£ç : auto apply coding standards (ESLint, Prettier)
â€¢ mock æ•°æ®: tÃ­ch há»£p mock server cho dev offline
â€¢ é›†åˆå¾®å‰ç«¯: support micro-frontend architecture
â€¢ commit hook: auto config Husky + CommitLint
â€¢ è‡ªåŠ¨åŒ–éƒ¨ç½²: tÃ­ch há»£p CI/CD scripts
â€¢ é›†åˆå·¥å…·å‡½æ•°/Hooks: bundle utils library vÃ o project
â€¢ æ’ä»¶/æ¨¡å—å¿«é€Ÿä¸Šæ‰‹: plugin system cho extensions
â€¢ æŒç»­å»ºè®¾ä¸­...: liÃªn tá»¥c cáº£i tiáº¿n theo nhu cáº§u team

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¤ COMPONENT LIBRARY â€” Front-End UI Components (ThÆ° viá»‡n UI)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Open source: Ant Design, Element UI, Vant UI, Arco Design...
Náº¿u phÃ¹ há»£p â†’ tiáº¿t kiá»‡m 50% thá»i gian dev!

Tuy nhiÃªn:
â€¢ Medium/large companies cÃ³ tiÃªu chuáº©n riÃªng
â€¢ Designer style + interaction KHÃC open source
â†’ Cáº§n build component library riÃªng Ä‘á»ƒ thá»‘ng nháº¥t design specs

Scenario (CVå¤§æ³• Problem):
- æŸæ—¥, é¡¹ç›®Aä¸­éœ€è¦åŠ ä¸€ä¸ªæ—¥å†å¯é€‰çš„ç»„ä»¶;
  (Má»™t ngÃ y, project A cáº§n thÃªm calendar picker component)
- ä½†æ˜¯é¡¹ç›®Bä¸­æ˜¯å­˜åœ¨è¿™ä¸ªç»„ä»¶çš„;
  (NhÆ°ng project B Ä‘Ã£ cÃ³ component nÃ y rá»“i)
- ä¸€èˆ¬çš„åšæ³•å°±æ˜¯ CV å¤§æ³•, ç®€å•å¿«é€Ÿ;
  (CÃ¡ch thÆ°á»ng lÃ m = Copy-Paste, nhanh gá»n)
- è¦æ˜¯ä»¥åæœ‰å¾ˆå¤šç±»ä¼¼æ—¥å†ç»„ä»¶å‘¢?
  (Náº¿u sau nÃ y cÃ³ NHIá»€U component tÆ°Æ¡ng tá»± thÃ¬ sao?)
- ä¸å¯èƒ½ä¸€ç›´ CVå¤§æ³• å§?
  (KhÃ´ng thá»ƒ cá»© Copy-Paste mÃ£i Ä‘Æ°á»£c Ä‘Ãºng khÃ´ng?)
- æ‰€ä»¥ä¸€ä¸ªé€šç”¨çš„ UI ç»„ä»¶åº“å°±å¿…ä¸å¯å°‘äº† ~
  (â†’ VÃ¬ váº­y, component library lÃ  KHÃ”NG THá»‚ THIáº¾U!)

Ã nghÄ©a: component reuse â†’ tÄƒng R&D efficiency

            å‰ç«¯ç»„ä»¶åº“ (UI Design)
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     â”‚      â”‚    â”‚    â”‚          â”‚          â”‚
  icon  Button Input Check Radio   Select    Breadcrumb
  å›¾æ ‡   æŒ‰é’®   è¾“å…¥æ¡† box   å•é€‰æ¡†   é€‰æ‹©å™¨     é¢åŒ…å±‘
                     å¤é€‰æ¡†
    â”‚          â”‚          â”‚          â”‚          â”‚
    â”‚          â”‚          â”‚          â”‚          â”‚
 Dropdown  Message    Toast      Modal     Loading
 ä¸‹æ‹‰èœå•   å…¨å±€æ¶ˆæ¯    æç¤º       å¯¹è¯æ¡†      åŠ è½½
            æç¤º
    â”‚
 æŒç»­å¼€å‘ä¸­...
 (Continuously
  Developing)

Component categories:
â”œâ”€ åŸºç¡€ç»„ä»¶ (Base): icon, Button, Input, Checkbox, Radio
â”œâ”€ é€‰æ‹©ç»„ä»¶ (Selection): Select, Dropdown
â”œâ”€ å¯¼èˆªç»„ä»¶ (Navigation): Breadcrumb
â”œâ”€ åé¦ˆç»„ä»¶ (Feedback): Message, Toast, Modal, Loading
â””â”€ æŒç»­å¼€å‘ä¸­... (more components added based on needs)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¥ RESPONSIVE vs ADAPTIVE DESIGN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Responsive Design (å“åº”å¼):
â€¢ 1 bá»™ code, layout thay Ä‘á»•i theo screen size
â€¢ CÃ¹ng page â†’ different layouts on different screens
â€¢ Giáº£i quyáº¿t váº¥n Ä‘á» mobile browser
â€¢ Æ¯u: 1 code, high flexibility, nhanh multi-platform
â€¢ DÃ¹ng: CSS media queries, flexbox, grid

Adaptive Design (è‡ªé€‚åº”):
â€¢ Nhiá»u bá»™ code, detect device â†’ return page riÃªng
â€¢ PC vs Mobile â†’ hoÃ n toÃ n khÃ¡c nhau
â€¢ Æ¯u: design + UX tá»‘t hÆ¡n, performance tá»‘t hÆ¡n

Chá»n theo nÃ o?
â€¢ Layout diff Lá»šN giá»¯a PC/H5 â†’ Adaptive
â€¢ Layout TÆ¯Æ NG Tá»° â†’ Responsive (tiáº¿t kiá»‡m hÆ¡n)
â€¢ âš ï¸ Äá»«ng chá»n mÃ¹ quÃ¡ng, pháº£i dá»±a trÃªn thá»±c táº¿

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¦ UTILS / HOOKS LIBRARY (ThÆ° viá»‡n cÃ´ng cá»¥)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Váº¥n Ä‘á»: Day.js, axios, lodash... features cÃ³ thá»ƒ KHÃ”NG pháº£i cÃ¡i báº¡n cáº§n
HÆ¡n ná»¯a: biÃªn giá»›i utils library Lá»šN â†’ import cáº£ lib chá»‰ dÃ¹ng 1 function
â†’ Bundle size tÄƒng vÃ´ Ã­ch

"Tree Shaking cÃ³ rá»“i, cáº§n gÃ¬ lo?"
â†’ Tree Shaking KHÃ”NG giáº£i quyáº¿t háº¿t 100% má»i trÆ°á»ng há»£p!

â†’ Build internal utils: reuse + giáº£m bundle + team growth

           å‰ç«¯å·¥å…·åº“ (ç±» Hooks / Utils)
                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     â”‚      â”‚     â”‚     â”‚          â”‚          â”‚
  Query  Device ç¯å¢ƒ   Local  Day      Thousands  Debounce
  å‚æ•°    è®¾å¤‡   åŒºåˆ†   Storage æ—¥æœŸæ ¼å¼  åƒåˆ†ä½     é˜²æŠ–
  è§£æ    è§£æ         å°è£…    çš„å°è£…    æ ¼å¼åŒ–
 (URL   (Device      (Storage(Date     (Number   (Debounce)
  Query  Detection)   Wrapper)Format)  Format)
  Parse)
    â”‚          â”‚          â”‚          â”‚          â”‚
    â”‚          â”‚          â”‚          â”‚          â”‚
 Throttle   Array     Array      Array     åˆ¤æ–­ç±»å‹
 èŠ‚æµ       æ•°ç»„å»é‡    æ•°ç»„æ‰å¹³åŒ–   æ’åº      (Type
 (Throttle) (Dedupe)  (Flatten)  (Sort)    Checking)
    â”‚
 å…¶å®ƒ (æš‚ä¸ä¸¾ä¾‹) ....
 (Others...)

Cá»¥ thá»ƒ:
â€¢ Query å‚æ•°è§£æ: parse URL search params â†’ object
â€¢ Device è®¾å¤‡è§£æ: detect mobile/tablet/desktop/OS/browser
â€¢ ç¯å¢ƒåŒºåˆ†: distinguish dev/staging/production environment
â€¢ LocalStorage å°è£…: wrapper with expiry, namespace, type-safe
â€¢ Day æ—¥æœŸæ ¼å¼çš„å°è£…: lightweight date formatting (thay Day.js)
â€¢ Thousands åƒåˆ†ä½æ ¼å¼åŒ–: 1234567 â†’ "1,234,567"
â€¢ Debounce é˜²æŠ–: delay execution until stopped triggering
â€¢ Throttle èŠ‚æµ: limit execution to once per interval
â€¢ Array æ•°ç»„å»é‡: deduplicate arrays (primitive + object)
â€¢ Array æ•°ç»„æ‰å¹³åŒ–: flatten nested arrays
â€¢ Array æ’åº: custom sorting utilities
â€¢ åˆ¤æ–­ç±»å‹: accurate type checking (toString.call pattern)
â€¢ å…¶å®ƒ...: thÃªm theo nhu cáº§u business cá»¥ thá»ƒ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘§ TOOL AUTOMATION (CÃ´ng cá»¥ tá»± Ä‘á»™ng hÃ³a)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ KHÃC vá»›i Utils Library:
â€¢ Utils: code-level method reuse (Day.js, lodash)
â€¢ Tool Automation: HIGH-LEVEL PROCESS automation

Scenario 1 (Code Style):
- Dev viáº¿t code â†’ khÃ´ng format â†’ Ä‘áº©y lÃªn â†’ mess
- Reviewer máº¥t thá»i gian cho style thay vÃ¬ logic
â†’ Tool automation giáº£i quyáº¿t!

Scenario 2 (Cross-Project ESLint):
- æŸæ—¥, é¡¹ç›®Aä¸­ä½¿ç”¨çš„ ESLint ç­‰å·¥å…·æŸä¸ªè§„åˆ™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„;
  (Project A dÃ¹ng ESLint, cÃ³ rule KHÃ”NG phÃ¹ há»£p)
- é‚£ä¹ˆæ­¤æ—¶ä½ å¯ä»¥åœ¨å¯¹åº”çš„ .eslintrc.js æ–‡ä»¶ä¸­ä¿®æ”¹;
  (Sá»­a trong .eslintrc.js â†’ OK)
- å¦‚æœä½ æ­¤æ—¶åˆæœ‰å“ªä¸ªè§„åˆ™ä¸ç¬¦åˆ, ä¸€æ¬¡é‡å¤ä¸Šè¿°æ“ä½œ;
  (Láº§n sau láº¡i cÃ³ rule khÃ´ng phÃ¹ há»£p â†’ láº¡i sá»­a láº¡i...)
- ä½†æ˜¯å¦‚æœåœ¨é¡¹ç›®Bä¸­ä¹Ÿéœ€è¦ç±»æ˜¯çš„è§„åˆ™å‘¢?
  (NhÆ°ng náº¿u project B cÅ©ng cáº§n rule tÆ°Æ¡ng tá»±?)
- å¥½å®¶ä¼™, ä¸Š CVå¤§æ³• å§?
  (á»’, láº¡i Copy-Paste Ä‘Ãºng khÃ´ng?)
- å…¶å®å‘¢æˆ‘ä»¬åšæˆä¸€ä¸ªç¬¦åˆæˆ‘ä»¬è§„åˆ™çš„å‰ç«¯è‡ªåŠ¨åŒ–å·¥å…·å²‚ä¸æ˜¯ç¾ç¾å“’ ~
  (â†’ Tháº­t ra, lÃ m 1 bá»™ automation tools THá»NG NHáº¤T rules
     cho Táº¤T Cáº¢ projects má»›i lÃ  ÄÃšNG CÃCH!)

Ã nghÄ©a: consistency + automated + efficiency

Tool Automation components:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Code Quality                      â”‚
â”‚  â”œâ”€ ESLint (JS/TS linting)        â”‚
â”‚  â”œâ”€ Stylelint (CSS linting)       â”‚
â”‚  â””â”€ Prettier (formatting)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Git Hooks                         â”‚
â”‚  â”œâ”€ Husky (pre-commit hooks)      â”‚
â”‚  â”œâ”€ lint-staged (staged files)    â”‚
â”‚  â””â”€ CommitLint (commit messages)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Testing                           â”‚
â”‚  â”œâ”€ Jest / Vitest (unit tests)    â”‚
â”‚  â”œâ”€ Cypress / Playwright (E2E)    â”‚
â”‚  â””â”€ Coverage reports              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â­ Best Practice:                  â”‚
â”‚  ÄÃ³ng gÃ³i thÃ nh shared config pkg â”‚
â”‚  @company/eslint-config            â”‚
â”‚  @company/prettier-config          â”‚
â”‚  @company/commitlint-config        â”‚
â”‚  â†’ Táº¥t cáº£ projects extends tá»« 1   â”‚
â”‚    source of truth duy nháº¥t!       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¨ BFF â€” Backends For Frontends (Backend phá»¥c vá»¥ Frontend)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Aggregate backend microservices â†’ unified, friendly API
Compatible: mobile / web / H5 / third-party

Scenario:
- Dev gá»i 5 APIs cho 1 page â†’ slow, complex, error handling khÃ³
- Backend microservices phá»©c táº¡p, FE khÃ´ng cáº§n biáº¿t
â†’ BFF layer giáº£i quyáº¿t!

Benefits:
â€¢ Aggregate APIs, giáº£i phÃ³ng backend
â€¢ Decouple FE khá»i microservice complexity
â€¢ Better security (hide internal services)
â€¢ Better FE error handling
â€¢ Easy to maintain/modify API

BFF Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mobile  â”‚  â”‚  Web    â”‚  â”‚   H5    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
     â”‚   BFF Layer  â”‚    â† Aggregate + Transform
     â”‚  (Node.js)   â”‚
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚        â”‚        â”‚
â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”
â”‚Svc Aâ”‚ â”‚Svc Bâ”‚ â”‚Svc Câ”‚  â† Backend Microservices
â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘© SSR â€” Server-Side Rendering
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Server render HTML â†’ send to browser â†’ hydrate (bind events)
PHP, ASP, JSP = early SSR | Modern: Next.js, Nuxt.js

Báº¯t buá»™c cho ToC projects cáº§n SEO
B\áº¯t buá»™c trong FE-BE separation environment

Benefits:
â€¢ FE-BE separation (code riÃªng, deploy riÃªng)
â€¢ Fast first paint (HTML sáºµn tá»« server)
â€¢ SEO-friendly (search engine Ä‘á»c Ä‘Æ°á»£c HTML)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘ª CI/CD â€” Continuous Integration / Deployment
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

git commit â†’ auto deploy: test / staging / production
KhÃ´ng cáº§n manual package + copy lÃªn servers má»—i láº§n

Scenario:
- TrÆ°á»›c: package â†’ FTP/SCP â†’ multiple servers â†’ multiple envs
â†’ BÃ¢y giá»: git push â†’ pipeline â†’ auto deploy everywhere

Benefits:
â€¢ TÄƒng developer productivity
â€¢ Automated publishing
â€¢ Improve code quality (auto test trÆ°á»›c deploy)
â€¢ Deliver updates faster

CI/CD Pipeline:
git push â†’ Lint â†’ Test â†’ Build â†’ Deploy
              â”‚       â”‚       â”‚       â”‚
              â–¼       â–¼       â–¼       â–¼
          ESLint   Jest    Webpack  Nginx/CDN
          Prettier  E2E    Vite    Docker/K8s

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘« MONITORING / DATA TRACKING (GiÃ¡m sÃ¡t / Theo dÃµi dá»¯ liá»‡u)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Háº§u háº¿t ToC projects cáº§n tracking â†’ hiá»ƒu user behavior
â†’ Product upgrade + iteration â†’ phá»¥c vá»¥ user tá»‘t hÆ¡n

Scenario 1: Product muá»‘n biáº¿t user click nÃºt nÃ o nhiá»u nháº¥t
Scenario 2: Operation muá»‘n biáº¿t conversion rate tá»«ng page

4 loáº¡i data:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡Œä¸ºæ•°æ® (Behavior Data)                  â”‚
â”‚  Time + Location + User + Interaction     â”‚
â”‚  + Content of interaction                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è´¨é‡æ•°æ® (Quality Data)                   â”‚
â”‚  Browser loading status + Errors          â”‚
â”‚  + Exceptions                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¯å¢ƒæ•°æ® (Environment Data)               â”‚
â”‚  Browser metadata + Geo + Carrier info    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿è¥æ•°æ® (Operations Data)                â”‚
â”‚  PV, UV, Conversion rate, Retention rate  â”‚
â”‚  (ráº¥t trá»±c quan)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Má»¥c Ä‘Ã­ch:
â€¢ Precise point-to-point marketing
â€¢ Classification & statistics
â€¢ Build user profiles
â€¢ Guide product development + optimize UX

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¬ VISUALIZATION PLATFORM (Ná»n táº£ng trá»±c quan hÃ³a)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å‰ç«¯å¯è§†åŒ– bao gá»“m:
â€¢ æ•°æ®å¯è§†åŒ– (data visualization)
â€¢ å›¾å½¢å¯è§†åŒ– (graphic visualization)
â€¢ VRå…¨æ™¯å¯è§†åŒ– (VR panorama)
â€¢ ä¸­åå°è§†è§‰å¯è§†åŒ– (admin dashboard)
â€¢ å·¥ç¨‹å¯è§†åŒ–å¹³å° (engineering visualization)

Scenario:
- TRÆ¯á»šC: táº¡o project má»›i â†’ tÃ¬m ops â†’ ops máº¥t ná»­a ngÃ y config
         â†’ config xong â†’ thÃ´ng bÃ¡o dev
- BÃ‚Y GIá»œ: 1. VÃ o visualization platform
            2. Config env system
            3. Done! (10 phÃºt)

Ã nghÄ©a:
â€¢ Facilitates project management
â€¢ TÄƒng work efficiency Ä‘Ã¡ng ká»ƒ
â€¢ 1-click CI/CD stream setup
â€¢ Environment config nhanh chÃ³ng

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘­ PERFORMANCE OPTIMIZATION (Tá»‘i Æ°u hiá»‡u nÄƒng)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Náº¿u B2B â†’ performance cÃ³ thá»ƒ khÃ´ng quan trá»ng láº¯m
Náº¿u ToC â†’ Báº®T BUá»˜C pháº£i nghÄ© Ä‘áº¿n performance!

Scenario: User má»Ÿ web â†’ loading mÃ£i â†’ "Trang gÃ¬ ghÃª váº­y! Dá»Ÿ quÃ¡!"
â†’ Máº¥t user = máº¥t revenue

Performance Optimization areas:
â”œâ”€ Network: CDN, compression, caching, HTTP/2
â”œâ”€ Resource: lazy loading, code splitting, tree shaking
â”œâ”€ Rendering: virtual DOM, reflow/repaint minimize
â”œâ”€ Runtime: Web Workers, debounce/throttle
â”œâ”€ Build: bundle analysis, minification
â””â”€ Monitoring: Lighthouse, Web Vitals (LCP, FID, CLS)

Benefits: faster load + better UX + giáº£m server load
Bonus: NÃ¢ng cao coding skills cá»§a developers

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘® LOW-CODE PLATFORM (Ná»n táº£ng Ã­t code)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä½ä»£ç  (Low-Code): visual building, ÃT code hÆ¡n
æ— ä»£ç  (No-Code): visual building, KHÃ”NG code

Scenario: Business team muá»‘n trang landing page
â†’ TrÆ°á»›c: FE dev code 2-3 ngÃ y
â†’ BÃ¢y giá»: kÃ©o tháº£ trÃªn low-code platform â†’ 30 phÃºt

Benefits:
â€¢ Giáº£m development cost
â€¢ WYSIWYG (What You See Is What You Get)
â€¢ One-stop R&D
â€¢ Technical convergence
â€¢ Low professional threshold
â€¢ Beginner-friendly

âš ï¸ CHÃš Ã:
â€¢ PhÃ¹ há»£p: B2B platforms, HIGH business volume
â€¢ KHÃ”NG phÃ¹ há»£p: Ã­t business, doanh nghiá»‡p nhá»
â€¢ Chá»‰ Ã¡p dá»¥ng khi khá»‘i lÆ°á»£ng business Äá»¦ Lá»šN
â€¢ "ç”¨æ–°æŠ€æœ¯ï¼Œæ›´å¤šçš„ä¸æ˜¯å› ä¸ºå…ˆè¿›ï¼Œè€Œæ˜¯é€‚åˆ"
  "DÃ¹ng tech má»›i vÃ¬ PHÃ™ Há»¢P, khÃ´ng vÃ¬ TIÃŠN TIáº¾N"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â‘¯ MICRO-FRONTEND (Vi giao diá»‡n)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Concept tÆ°Æ¡ng tá»± microservices, má»Ÿ rá»™ng ra FE world
"Chia large FE app â†’ nhiá»u small FE apps,
 má»—i app cÃ³ own repo, focus 1 feature"

âš ï¸ DÃ¹ chia nhá», cuá»‘i cÃ¹ng váº«n integrate thÃ nh SPA
â†’ KhÃ´ng máº¥t UX, mÃ  cÃ²n Cáº¢I THIá»†N

Why Micro-Frontend:
â€¢ Flexible tech choice (Vue + React + Angular cÃ¹ng tá»“n táº¡i)
â€¢ Faster, independent deployment
â€¢ Team code isolation
â€¢ Parallel development + team autonomy
â€¢ Incremental project upgrades

Micro-Frontend Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Main App (Shell)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚App A â”‚  â”‚App B â”‚  â”‚App C â”‚       â”‚
â”‚  â”‚(Vue) â”‚  â”‚(Reactâ”‚  â”‚(Vue) â”‚       â”‚
â”‚  â”‚      â”‚  â”‚      â”‚  â”‚      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  Own repo   Own repo   Own repo      â”‚
â”‚  Own deploy Own deploy Own deploy    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Value of Micro-Frontend:
â”œâ”€ Tech agnostic (khÃ´ng báº¯t buá»™c 1 framework)
â”œâ”€ Independent develop & deploy
â”œâ”€ Code isolation between teams
â”œâ”€ Incremental migration (legacy â†’ modern)
â””â”€ Team autonomy (má»—i team tá»± quáº£n lÃ½)
```

### Tá»•ng Há»£p: FE Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FE INFRASTRUCTURE â€” SUMMARY                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  4 layers: Business âŠƒ Engineering âŠƒ FE âŠƒ BE                   â”‚
â”‚  Promote: people â†’ problems â†’ solutions â†’ execute             â”‚
â”‚  4 traits: tech sound + stable + efficient + good UX           â”‚
â”‚                                                                 â”‚
â”‚  Foundation: Standards + Docs + Templates + CLI                â”‚
â”‚  UI/Tools:   Component Lib + Responsive + Utils + Automation   â”‚
â”‚  Services:   BFF + SSR + CI/CD + Monitoring                    â”‚
â”‚  Advanced:   Visualization + Performance + Low-Code + Micro-FE â”‚
â”‚                                                                 â”‚
â”‚  Start incremental, khÃ´ng áº£nh hÆ°á»Ÿng existing business         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 101. CÃ¢u Há»i Phá»ng Váº¥n Tá»•ng Há»£p

### Quick Reference

```
8 DATA TYPES:
Primitive (7): Number, String, Boolean, null, undefined, Symbol, BigInt
Reference (1): Object (includes Array, Function, Date, RegExp, Map, Set, etc.)

MEMORY:
Primitive â†’ Stack (value stored directly)
Reference â†’ Stack (pointer) + Heap (actual value)

TYPE DETECTION:
typeof        â†’ Fast, primitives + function, but nullâ†’"object"
instanceof    â†’ Objects, inheritance check, primitives fail
toString.call â†’ Most accurate, all types, verbose syntax
Array.isArray â†’ Specifically for arrays

var vs let vs const:
var   â†’ Function scope, hoisted (undefined), allows re-declare, maps to window
let   â†’ Block scope, TDZ, no re-declare, no window mapping
const â†’ Block scope, TDZ, no re-declare, no reassign, must initialize

GARBAGE COLLECTION:
Mark-and-Sweep  â†’ Standard: mark reachable from root, sweep rest
Reference Count â†’ IE legacy: count refs, GC when 0 (circular ref bug!)
V8 Generational â†’ Young (Scavenger) + Old (Mark-Sweep-Compact)

MEMORY LEAKS (4 types):
1. Global variables    â†’ "use strict" + let/const
2. Closures            â†’ Limit scope, null-ify after use
3. DOM references      â†’ WeakMap, null after remove
4. Timers/listeners    â†’ clearInterval, removeEventListener

SCOPE:
Global Scope    â†’ Accessible everywhere
Function Scope  â†’ var, accessible within function
Block Scope     â†’ let/const, accessible within {}
Scope Chain     â†’ Current â†’ Parent â†’ ... â†’ Global (lexical, not call-site)

CLOSURES:
What      â†’ Function + reference to outer scope variables
Two roles â†’ Protection (isolate) + Saving (preserve)
Formed by â†’ Nested functions + inner refs outer local vars
Downside  â†’ Memory not auto-cleared, potential leaks

this (5 CASES):
Regular fn()   â†’ window (strict: undefined)
obj.method()   â†’ obj
new Fn()       â†’ new object
Arrow fn       â†’ lexical this (scope chá»©a nÃ³, CANNOT change)
call/apply/bind â†’ explicit object
Priority: new > bind > implicit > default | Arrow bypasses all

PROTOTYPE:
Fn.prototype        â†’ Object chá»©a shared methods
obj.__proto__        â†’ Trá» Ä‘áº¿n Constructor.prototype
instance.__proto__  === Constructor.prototype
Prototype Chain     â†’ obj â†’ __proto__ â†’ ... â†’ Object.prototype â†’ null
Pass-by-reference   â†’ Thay Ä‘á»•i prototype áº£nh hÆ°á»Ÿng Táº¤T Cáº¢ instances
ES6 class = syntactic sugar trÃªn prototype

new OPERATOR (4 steps):
1. Táº¡o object rá»—ng {}
2. obj.__proto__ = Constructor.prototype
3. Constructor.call(obj, args) â€” bind this + execute
4. Return object â†’ dÃ¹ng nÃ³ | Return primitive â†’ dÃ¹ng obj

EVENT LOOP:
JS = Single-threaded â†’ Event Loop xá»­ lÃ½ async
Sync â†’ ALL Micro-tasks â†’ 1 Macro-task â†’ ALL Micro â†’ repeat
Macro: setTimeout, setInterval, I/O, rAF, setImmediate (Node)
Micro: Promise.then, async/await, nextTick, queueMicrotask
Node.js: 6 phases (timers â†’ pending â†’ idle â†’ poll â†’ check â†’ close)
process.nextTick > Promise.then (Node.js micro priority)

setTimeout vs Promise vs async/await:
setTimeout    â†’ MACRO-task queue, cháº¡y SAU micro-tasks
Promise       â†’ Constructor = SYNC, .then/.catch = MICRO-task
async/await   â†’ TrÆ°á»›c await = SYNC, sau await = MICRO-task
Thá»© tá»±: Sync > Micro (Promise/await) > Macro (setTimeout)

GOTCHAS:
typeof null === "object"
NaN !== NaN
[] instanceof Object === true
var in loop â†’ shared variable (bug)
let in loop â†’ per-iteration scope (correct)
Scope chain follows CREATION site, not CALL site
setTimeout(fn, 0) â‰  instant (min ~4ms browser)
new Promise(fn) â€” fn cháº¡y SYNC (báº«y phá»ng váº¥n!)

PROMISE API:
3 States: Pending â†’ Fulfilled (resolve) / Rejected (reject)
Instance: .then(fn) â†’ .catch(fn) â†’ .finally(fn)
Static: .all (táº¥t cáº£), .allSettled (khÃ´ng fail), .race (ai nhanh), .any (ai thÃ nh cÃ´ng)
.catch() báº¯t lá»—i toÃ n chain â€” onRejected trong .then chá»‰ báº¯t cÃ¹ng level

ASYNC/AWAIT:
Báº£n cháº¥t: Generator (yield/next) + Auto-executor + Promise
TrÆ°á»›c await = SYNC, sau await = Micro-task
async fn luÃ´n return Promise
Sequential: await a; await b; (phá»¥ thuá»™c nhau)
Parallel: Promise.all([a, b]) (Ä‘á»™c láº­p â†’ nhanh hÆ¡n)

THROTTLE vs DEBOUNCE:
Throttle: cháº¡y Äá»€U má»—i N ms (timestamp) â€” scroll, mousemove, game input
Debounce: cháº¡y SAU KHI ngá»«ng trigger (clearTimeout) â€” search, resize, auto-save
Cáº£ hai lÃ  HOF + Closure (lÆ°u timer/lastTime qua closure)

ELEMENT GEOMETRY:
offsetWidth/Height = border + padding + content + scrollbar (toÃ n bá»™)
clientWidth/Height = padding + content (KHÃ”NG scrollbar)
scrollWidth/Height = toÃ n bá»™ content ká»ƒ cáº£ overflow
scrollLeft/Top = khoáº£ng Ä‘Ã£ scroll (DUY NHáº¤T writable)
scrollBottom = scrollHeight - scrollTop - clientHeight
âŒ KHÃ”NG dÃ¹ng getComputedStyle â†’ STRING, auto, cross-browser khÃ¡c

WINDOW & DOCUMENT GEOMETRY:
Window size: documentElement.clientWidth/Height (KHÃ”NG scrollbar)
window.innerWidth/Height = bao gá»“m scrollbar (Ã­t dÃ¹ng)
Document full size: Math.max(body+docEl scroll/offset/client H/W)
Äá»c scroll: pageYOffset (=scrollY), pageXOffset (=scrollX) â€” READ-ONLY
scrollTo(x,y) = tuyá»‡t Ä‘á»‘i, scrollBy(x,y) = tÆ°Æ¡ng Ä‘á»‘i
elem.scrollIntoView(true/false) = scroll Ä‘áº¿n element
Freeze: body.overflow="hidden" + padding thay scrollbar

COORDINATES:
Window (clientX/Y) = tá»« cá»­a sá»•, thay Ä‘á»•i khi scroll (~ position:fixed)
Document (pageX/Y) = tá»« document top, khÃ´ng Ä‘á»•i (~ position:absolute)
getBoundingClientRect() â†’ window coords {x,y,width,height,top,left,right,bottom}
pageY = clientY + pageYOffset | pageX = clientX + pageXOffset
elementFromPoint(x,y) â†’ element sÃ¢u nháº¥t táº¡i tá»a Ä‘á»™, null náº¿u ngoÃ i viewport
JS right/bottom â‰  CSS: JS tÃ­nh tá»« top-left, CSS tÃ­nh tá»« cáº¡nh Ä‘á»‘i diá»‡n

PROXY & REFLECT:
new Proxy(target, handler) â€” wrapper cháº·n operations trÃªn object
Traps: get, set, has, deleteProperty, apply, construct, ownKeys,...
set trap PHáº¢I return true (náº¿u khÃ´ng â†’ TypeError)
Reflect.xxx(target, prop, receiver) â€” forward an toÃ n, giá»¯ Ä‘Ãºng this
Reflect.get > target[prop] vÃ¬ truyá»n receiver cho getter (inheritance)
Limitations: Built-in slots (Map/Set) â†’ bind methods, proxy !== target
Proxy.revocable(target, handler) â†’ {proxy, revoke} â€” thu há»“i Ä‘Æ°á»£c

EVENT LOOP:
Algorithm: 1 Macro â†’ ALL Micros â†’ Render â†’ láº·p
Macro: setTimeout, setInterval, I/O, UI events, <script>
Micro: Promise.then/catch/finally, await, queueMicrotask
Micro cháº¡y TRÆ¯á»šC render â†’ Ä‘áº£m báº£o CÃ™NG environment state
Chia CPU-heavy task = setTimeout + chunks â†’ UI responsive
DOM paint CHá»ˆ sau task hoÃ n thÃ nh â†’ setTimeout cho progress
Nested setTimeout delay â‰¥ 4ms | schedule sá»›m = cháº¡y sá»›m
queueMicrotask = async TRÆ¯á»šC render | setTimeout = SAU render
Web Workers: parallel thread, KHÃ”NG cÃ³ DOM access

GARBAGE COLLECTION:
Reachable = tiáº¿p cáº­n tá»« ROOT qua chuá»—i references â†’ giá»¯ láº¡i
Roots: function Ä‘ang cháº¡y, call chain, global variables
Unreachable = khÃ´ng ai tá»« root trá» Ä‘áº¿n â†’ Bá»Š XÃ“A
Referenced â‰  Reachable (Ä‘áº£o interlinked váº«n bá»‹ xÃ³a)
Chá»‰ INCOMING refs quan trá»ng, outgoing khÃ´ng cá»©u object
Mark-and-Sweep: mark tá»« roots â†’ sweep unmarked
V8: Generational (Young/Old) + Incremental + Idle-time
Leaks: global vars, forgotten timers, closures, detached DOM
Fix: null refs, WeakMap/WeakSet, clear timers, remove listeners
âš ï¸ KHÃ”NG thá»ƒ force/prevent GC â€” chá»‰ cáº¯t references

OBJECTS:
Object = keyed collection | Keys: string/symbol | Values: any
Táº¡o: {} (literal) hoáº·c new Object() | trailing comma = best practice
Dot: obj.prop (key Ä‘Æ¡n giáº£n) | Brackets: obj["prop"] (key báº¥t ká»³)
Computed: { [expr]: val } | Shorthand: { name } = { name: name }
delete obj.prop â€” xÃ³a | "key" in obj â€” tá»“n táº¡i (chÃ­nh xÃ¡c hÆ¡n === undefined)
for (key in obj) â€” duyá»‡t enumerable keys
Order: integer keys sorted ascending | non-integer = creation order
âš ï¸ obj.key â‰  obj[key] â€” dot = literal "key", [] = biáº¿n
âš ï¸ Number keys auto-convert string | __proto__ = special property

OBJECT REFERENCES & COPYING:
Primitive = copy by VALUE (2 báº£n Ä‘á»™c láº­p)
Object = copy by REFERENCE (2 biáº¿n, 1 object)
So sÃ¡nh: a == b chá»‰ true khi CÃ™NG 1 object (cÃ¹ng ref)
const obj = {} â†’ sá»­a properties OK, gÃ¡n láº¡i obj = ... â†’ ERROR
Shallow: Object.assign({}, obj) | {...obj} | âš ï¸ nested = shared
Deep: structuredClone(obj) | âœ… circular refs | âŒ functions
Custom: _.cloneDeep(obj) | manual for..in loop

OBJECT METHODS & "this":
Method = function stored in object property
Shorthand: sayHi() {} = sayHi: function() {}
this = object "trÆ°á»›c dáº¥u cháº¥m" khi gá»i method
this xÃ¡c Ä‘á»‹nh lÃºc CALL-TIME, khÃ´ng pháº£i lÃºc khai bÃ¡o
func() khÃ´ng object â†’ this = undefined (strict) | window (non-strict)
Arrow function: KHÃ”NG cÃ³ this riÃªng â†’ láº¥y tá»« outer context
Chaining pattern: return this â†’ obj.a().b().c()
âš ï¸ ref: this trong literal = this Cá»¦A FUNCTION bao ngoÃ i

CONSTRUCTOR & "new":
Constructor = regular function + tÃªn Viáº¿t Hoa + gá»i báº±ng new
new F(): 1) this={} 2) cháº¡y body 3) return this
return object â†’ tráº£ object Ä‘Ã³ (bá» this) | return primitive â†’ bá» qua
new.target: undefined (normal) | function (new mode)
new function(){} â€” IIFE constructor, 1 láº§n duy nháº¥t
Methods trong constructor: má»—i new táº¡o Má»šI function
âš ï¸ Arrow func KHÃ”NG lÃ m constructor | dÃ¹ng prototype/class tá»‘i Æ°u hÆ¡n

OPTIONAL CHAINING ?.:
obj?.prop | obj?.[expr] | obj.method?.()
null/undefined trÆ°á»›c ?. â†’ return undefined ngay (short-circuit)
Chá»‰ optional pháº§n TRÆ¯á»šC ?., khÃ´ng áº£nh hÆ°á»Ÿng sau
âœ… Äá»c, gá»i method, delete | âŒ KHÃ”NG dÃ¹ng bÃªn trÃ¡i assignment
âš ï¸ Biáº¿n pháº£i khai bÃ¡o trÆ°á»›c | Ä‘á»«ng láº¡m dá»¥ng (che giáº¥u bugs)

OBJECT â†’ PRIMITIVE CONVERSION:
3 hints: "string" (alert) | "number" (+, -, >) | "default" (binary +, ==)
1. Symbol.toPrimitive(hint) â€” náº¿u cÃ³ â†’ dÃ¹ng cho Táº¤T Cáº¢
2. "string" â†’ toString() â†’ valueOf()
3. "number"/"default" â†’ valueOf() â†’ toString()
Default: toString = "[object Object]" | valueOf = object chÃ­nh nÃ³
toString catch-all khi khÃ´ng cÃ³ Symbol.toPrimitive + valueOf
2-stage: obj â†’ primitive â†’ auto convert náº¿u cáº§n
âš ï¸ Boolean: objects luÃ´n = true | Must return PRIMITIVE

METHODS OF PRIMITIVES:
Primitive gá»i method â†’ JS táº¡o WRAPPER object táº¡m â†’ gá»i method â†’ Há»¦Y
Wrappers: String, Number, Boolean, Symbol, BigInt
null & undefined KHÃ”NG cÃ³ wrapper â†’ KHÃ”NG cÃ³ methods
new Number(0) â†’ object (truthy!) | Number("123") â†’ primitive 123
str.test = 5 â†’ wrapper táº¡m nháº­n rá»“i Há»¦Y â†’ máº¥t!
âš ï¸ Primitives KHÃ”NG lÆ°u thÃªm data/properties

NUMBERS:
1e9 (tá»·) | 1e-6 (0.000001) | 1_000 (separator)
0xff (hex) | 0b1111 (bin) | 0o377 (oct)
num.toString(base) 2-36 | 123456..toString(36) = "2n9c"
floor â†“ | ceil â†‘ | round â‰ˆ | trunc âœ‚ï¸ | toFixed(n)â†’STRING
0.1+0.2 â‰  0.3 (IEEE-754) | NaN !== NaN
isNaN (convert) | Number.isNaN (strict, no convert)
isFinite (convert) | Number.isFinite (strict)
Object.is: NaN===NaNâœ“, 0!==-0âœ“
parseInt("100px")=100 | parseFloat("12.5em")=12.5
Math.random() [0,1) | Math.floor(random*(max+1-min)+min)

STRINGS:
UTF-16 luÃ´n | Immutable (khÃ´ng sá»­a, táº¡o má»›i)
3 quotes: 'single' = "double" | `backticks` (${}+multi-line)
str.length PROPERTY (khÃ´ng cÃ³ ()) | str[0] | str.at(-1)
Special chars: \n \t \\ \' \" \`
Slice(start,end) âœ… | substring (swap) | substr (deprecated)
indexOf â†’ pos/-1 | includes/startsWith/endsWith â†’ bool
âš ï¸ indexOf=0 lÃ  falsy! Check !== -1
toLowerCase/toUpperCase | codePointAt | localeCompare (i18n)
trim() | repeat(n)

ARRAYS:
Array = object Ä‘áº·c biá»‡t cho ordered collection | copy by REFERENCE
Khai bÃ¡o: [] (âœ…) | new Array(2) = [emptyÃ—2] GOTCHA
arr[0] | arr.at(-1) | arr.length (writable, greatest idx+1)
push/pop (cuá»‘i, FAST O(1)) | shift/unshift (Ä‘áº§u, SLOW O(n))
Loops: for(i) âœ… | for..of âœ… | for..in âŒ NEVER
toString: [1,2]â†’"1,2" | []+1â†’"1" | [1]+1â†’"11"
âš ï¸ []==[] false | 0==[] true | arr.length=0 xÃ³a sáº¡ch

ARRAY METHODS:
splice(pos,del,...items) MUTATE Swiss-knife | slice(s,e)â†’new copy
concat(...items)â†’new | forEach(fn)â†’void
indexOf===strict (NaN sai!) | includes (NaN Ä‘Ãºng âœ…)
find(fn)â†’1st item | filter(fn)â†’all items | findIndexâ†’pos
map(fn)â†’new arr | sort(fn) MUTATE default=STRING! | reverse() MUTATE
split(delim)â†”join(glue) | reduce(fn,init)â†’1 value
Array.isArray() | some(âˆƒ) | every(âˆ€) | flat(depth)
âš ï¸ sort/reverse/splice MUTATE | sort() default STRING
âš ï¸ map return obj â†’ bá»c (): u=>({...}) | reduce empty+no init=ERROR

ITERABLES:
Iterable = cÃ³ Symbol.iterator â†’ dÃ¹ng for..of, spread, destructuring
Protocol: obj[Symbol.iterator]() â†’ { next() â†’ {done, value} }
Built-in: String âœ… Array âœ… Map/Set âœ… | Object âŒ
Iterable â‰  Array-like (indexes+length) | String = Cáº¢ HAI
Array.from(obj, mapFn?) â†’ Array tháº­t tá»« iterable/array-like
âš ï¸ Array.from xá»­ lÃ½ surrogate Ä‘Ãºng (khÃ¡c str.split)
âš ï¸ Merged iterator â†’ khÃ´ng 2 for..of song song

MAP & SET:
Map: keys Báº¤T Ká»² type (obj, NaN OK) | SameValueZero
new Map() | .set(k,v) | .get(k) | .has(k) | .size
âš ï¸ map[key] SAI â†’ dÃ¹ng .set/.get | Chaining .set().set()
Objectâ†’Map: new Map(Object.entries(obj))
Mapâ†’Object: Object.fromEntries(map)
Set: unique values | .add(v) | .has(v) O(1) | .size
.keys()/.values()/.entries() | forEach | insertion order
âš ï¸ map.keys() = iterable â‰  Array â†’ Array.from()

WEAKMAP & WEAKSET:
WeakMap: keys=OBJECTS only | key bá»‹ GC â†’ entry tá»± xÃ³a
Methods: set/get/has/delete (chá»‰ 4) | KHÃ”NG size/keys/iterate
WeakSet: values=OBJECTS only | add/has/delete (chá»‰ 3)
Use: additional data, caching (WeakMap) | flags (WeakSet)
âš ï¸ Secondary storage â€” data sá»‘ng/cháº¿t theo object
âš ï¸ KhÃ´ng iterate, khÃ´ng biáº¿t size (GC timing)

DESTRUCTURING:
Array: let [a, b, ...rest] = arr | Skip: [a,,c] | Default: [a=1]
Swap: [a,b]=[b,a] | Works vá»›i má»i iterable
Object: let {prop: var = default, ...rest} = obj
Rename: {width: w} | Default: {w=100} | Both: {w:x=100}
Nested: {size:{width}} | Thá»© tá»± khÃ´ng quan trá»ng
Smart params: fn({a=1, b=2} = {}) | = {} cho gá»i khÃ´ng args
âš ï¸ Object: khÃ´ng let â†’ bá»c ({x}=obj) (JS hiá»ƒu {} = code block)

DATE & TIME:
new Date() | new Date(ms) | new Date("str") | new Date(y,m,...)
âš ï¸ month=0..11 (Jan=0!) | getDay()=0(Sun)
Get: getFullYear/Month/Date/Hours/Min/Sec/Ms | getTime()â†’ts
Set: setFullYear/Month/Date/Hours/... | Autocorrect out-of-range
setDate(0)=last day prev month | +date=timestamp | d2-d1=ms
Date.now() nhanh (no object) | Date.parse("ISO")â†’timestamp
âš ï¸ Timestamps = milliseconds! | Clone: new Date(date)

JSON METHODS:
JSON.stringify(val, replacer?, space?) â†’ string
Há»— trá»£: obj/arr/string/number/bool/null | Bá»: fn/Symbol/undefined
Circular â†’ Error! | Nested â†’ auto | toJSON() custom
replacer: [...props] whitelist | fn(key,val) filter
space: number/string â†’ pretty-print
JSON.parse(str, reviver?) | reviver: fn(key,val) transform
Deep clone: JSON.parse(JSON.stringify(obj)) âš ï¸ máº¥t fn/Date

CALLBACKS:
Callback = fn truyá»n vÃ o, cháº¡y khi async hoÃ n thÃ nh
Error-first: callback(err, result) | err=null náº¿u OK
Sequential: callback-in-callback (lá»“ng nhau)
âš ï¸ Pyramid of Doom = nesting sÃ¢u, khÃ³ Ä‘á»c
Giáº£i phÃ¡p: Promises â†’ async/await

PROMISE:
new Promise((resolve, reject) => { ... }) executor auto-run
States: pending â†’ fulfilled/rejected (chá»‰ 1 láº§n!)
.then(onOK, onErr) | .catch(fn) | .finally(fn)
finally: no args, pass-through result/error
Handler on settled promise â†’ cháº¡y ngay
Promise > Callback: natural order, multiple .then

PROMISES CHAINING:
.then() tráº£ NEW promise â†’ chain tiáº¿p
return value â†’ resolved | return Promise â†’ chá» settle
âš ï¸ Chaining â‰  nhiá»u .then trÃªn 1 promise
Thenable: object cÃ³ .then() tÆ°Æ¡ng thÃ­ch Promise
fetch chain: .then(râ†’r.json()).then(dataâ†’...)
.then(f1).catch(f2) an toÃ n hÆ¡n .then(f1,f2)

ERROR HANDLING:
Implicit try..catch: throw = auto reject (executor + handler)
.catch cuá»‘i chain báº¯t Má»ŒI error (reject + throw)
Rethrowing: .catch xá»­ lÃ½ â†’ .then | throw â†’ .catch tiáº¿p
Unhandled rejection â†’ global error (unhandledrejection)
âš ï¸ setTimeout throw â‰  reject! DÃ¹ng reject() trong setTimeout

PROMISE API:
.all: chá» táº¥t cáº£, 1 fail = reject ngay (giá»¯ thá»© tá»±)
.allSettled: chá» táº¥t cáº£, tráº£ {status, value/reason}
.race: first settled (resolve or reject)
.any: first fulfilled, AggregateError náº¿u Ä‘á»u fail
.resolve/.reject: táº¡o promise Ä‘Ã£ settle (compatibility)

PROMISIFICATION:
Callback fn â†’ return new Promise wrapper
promisify(f): push callback, f.call(this, ...args)
manyArgs = true: resolve vá»›i [results] array
âš ï¸ Chá»‰ cho fn gá»i callback 1 láº§n!
Node.js: util.promisify() built-in

MICROTASKS:
.then/.catch/.finally = microtasks (async, sau current code)
Current code â†’ Microtask queue (FIFO) â†’ Macrotask
unhandledrejection check sau microtask queue rá»—ng
setTimeout .catch = quÃ¡ trá»… (macrotask)
Äáº£m báº£o thá»© tá»±: dÃ¹ng .then chain

EVENT LOOP:
Macrotask (oldest) â†’ ALL microtasks â†’ Render â†’ repeat
Macro: setTimeout, setInterval, script, I/O
Micro: .then/.catch, queueMicrotask, await
Split CPU: setTimeout(fn, 0) nhÆ°á»ng event loop
Progress bar: cáº§n setTimeout (khÃ´ng queueMicrotask)
Post-event: setTimeout(fn, 0) sau bubbling
Web Workers: parallel thread, khÃ´ng DOM

ASYNC/AWAIT:
async fn: luÃ´n tráº£ Promise, cho phÃ©p await
await: suspend execution, chá» settle, reject = throw
Error: try..catch hoáº·c .catch() ngoÃ i
await + Promise.all = parallelize
Top-level await (ES modules) hoáº·c IIFE
Gá»i async tá»« non-async: fn().then(...)
âš ï¸ Promise.all: cÃ¡c promise khÃ¡c váº«n cháº¡y khi 1 fail

BROWSER ENVIRONMENT:
window: global object + browser window
DOM: document = page content lÃ  objects (dom.spec.whatwg.org)
CSSOM: CSS rules lÃ  objects (w3.org/TR/cssom-1)
BOM: navigator, location, alert/confirm/prompt
HTML spec (html.spec.whatwg.org) bao gá»“m BOM
TÃ¬m kiáº¿m: MDN (Ä‘á»c nhanh) hoáº·c WHATWG spec (chi tiáº¿t)

DOM TREE:
HTML â†’ DOM Tree: tags = element nodes, text = text nodes
Spaces/newlines cÅ©ng lÃ  text nodes!
Autocorrect: browser sá»­a HTML lá»—i, tá»± thÃªm <tbody>
4 node types thÆ°á»ng dÃ¹ng: document/element/text/comment
Comments, DOCTYPE Ä‘á»u lÃ  DOM nodes
DevTools: $0 = selected element, inspect(node)

WALKING THE DOM:
Top: document.documentElement / .body / .head
All: parentNode, childNodes, first/lastChild, prev/nextSibling
Element: parentElement, children, first/lastElementChild
childNodes: array-like, LIVE, READ-ONLY, for..of
âš ï¸ document.body cÃ³ thá»ƒ null náº¿u script á»Ÿ <head>
parentElement vs parentNode (document khÃ´ng pháº£i element)
Table: rows, cells, rowIndex, cellIndex, tBodies

SEARCHING DOM:
querySelector/All: CSS selector, STATIC, máº¡nh nháº¥t
getElementById: chá»‰ document, id unique
getElementsBy*: LIVE collections (TagName/ClassName/Name)
matches(css): kiá»ƒm tra elem khá»›p selector
closest(css): tá»• tiÃªn gáº§n nháº¥t khá»›p selector
contains(elem): kiá»ƒm tra cha-con

NODE PROPERTIES:
Hierarchy: EventTarget â†’ Node â†’ Element â†’ HTMLElement
nodeType: 1=element, 3=text, 9=document (read-only)
tagName: element only (uppercase). nodeName: má»i node
innerHTML: HTML content, âš ï¸ += full overwrite
outerHTML: write khÃ´ng thay Ä‘á»•i variable reference!
textContent: pure text, an toÃ n user input
data/nodeValue: text/comment content
hidden: áº©n element (= display:none)
console.log(elem) vs console.dir(elem)

MODIFYING DOCUMENT:
Táº¡o: createElement(tag), createTextNode(text)
ChÃ¨n: append/prepend/before/after/replaceWith
Strings chÃ¨n nhÆ° text (safe), khÃ´ng HTML
insertAdjacentHTML(where, html): chÃ¨n HTML string
before/afterbegin, before/afterend (4 vá»‹ trÃ­)
remove(): xÃ³a node. Insert = tá»± move
cloneNode(true): deep, cloneNode(false): shallow
Old: appendChild/insertBefore/removeChild/replaceChild
âš ï¸ document.write chá»‰ khi loading!

STYLES AND CLASSES:
className: full string, thay tháº¿ háº¿t
classList: add/remove/toggle/contains, iterable
elem.style: camelCase, cáº§n units (px, %)
Reset: gÃ¡n "" hoáº·c removeProperty()
style.cssText: ghi Ä‘Ã¨ toÃ n bá»™ inline style
getComputedStyle(elem): resolved styles, read-only
âš ï¸ elem.style khÃ´ng tháº¥y CSS classes!
âš ï¸ :visited bá»‹ áº©n, dÃ¹ng full property name

BROWSER EVENTS:
3 cÃ¡ch: HTML attr, DOM prop, addEventListener
addEventListener: nhiá»u handlers, once/capture/passive
removeEventListener: cáº§n cÃ¹ng fn reference!
DOMContentLoaded chá»‰ vá»›i addEventListener
Event: type, currentTarget, clientX/Y
handleEvent: object lÃ m handler
onclick = fn (khÃ´ng ()), case-sensitive

BUBBLING & CAPTURING:
3 phases: Capturing â†’ Target â†’ Bubbling
event.target: element gá»‘c (khÃ´ng Ä‘á»•i)
event.currentTarget = this: cÃ³ handler
stopPropagation: dá»«ng bubble lÃªn
stopImmediatePropagation: dá»«ng táº¥t cáº£
Capturing: addEventListener(..., true)
removeEventListener cáº§n cÃ¹ng phase
âš ï¸ Äá»«ng stop bubbling khi khÃ´ng cáº§n!

EVENT DELEGATION:
1 handler trÃªn container, check event.target
closest(): tÃ¬m ancestor match selector
container.contains(): check nested tables
data-action: map clicks â†’ methods
Behavior: data-* + document addEventListener
âœ… Ãt memory, DOM Ä‘á»™ng, Ã­t code
âš ï¸ Event pháº£i bubble!

DEFAULT ACTIONS:
preventDefault(): cháº·n default action
return false: chá»‰ on<event> (khÃ´ng addEventListener)
passive: true â†’ cam káº¿t khÃ´ng preventDefault (mobile)
defaultPrevented: check Ä‘Ã£ prevent (thay stopPropagation)
Follow-up: cháº·n mousedown = máº¥t focus
âš ï¸ preventDefault â‰  stopPropagation!

CUSTOM EVENTS:
new Event(type, {bubbles, cancelable})
MouseEvent/KeyboardEvent: constructor riÃªng
CustomEvent: detail property cho data
dispatchEvent(event): phÃ¡t event
dispatchEvent tráº£ false náº¿u Ä‘Ã£ preventDefault
cancelable: true Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng
isTrusted: true = user, false = script
Events-in-events Ä‘á»“ng bá»™, setTimeout cho async

MUTATION OBSERVER:
observe(node, {childList, subtree, attributes, characterData})
MutationRecord: type, target, addedNodes/removedNodes
attributeOldValue/characterDataOldValue: giá»¯ old value
disconnect(): dá»«ng, takeRecords(): láº¥y pending
Use cases: auto-highlight, xÃ³a ads, 3rd-party integration
Weak refs: khÃ´ng cháº·n garbage collection

SELECTION & RANGE:
Range: setStart/End (text offset / child index)
selectNode/NodeContents, collapse, cloneRange
Editing: delete/extract/clone/insert/surround
Selection: anchor/focus (cÃ³ thá»ƒ ngÆ°á»£c)
removeAllRanges() trÆ°á»›c addRange()
Form: selectionStart/End, setRangeText
user-select:none / onselectstart cháº·n chá»n

FETCH API:
fetch(url, {method, headers, body}): Promise<Response>
2 stages: headers (resolve) â†’ body (.json/.text/.blob)
response.ok (200-299), .status, .headers (Map-like)
Body chá»‰ Ä‘á»c 1 láº§n (consumed)
POST: JSON.stringify + Content-Type: application/json
Blob body tá»± set Content-Type
404/500 khÃ´ng reject, chá»‰ network error reject
Forbidden headers: Cookie, Origin, Referer, Sec-*...

FORMDATA:
new FormData(form): auto capture fields
fetch body â†’ Content-Type: multipart/form-data
append(name, value): thÃªm (cho phÃ©p trÃ¹ng)
set(name, value): thay tháº¿ (xÃ³a trÃ¹ng)
append(name, blob, fileName): gá»­i file
delete/get/has + for..of iteration

DOWNLOAD PROGRESS:
response.body.getReader(): ReadableStream
reader.read(): {done, value (Uint8Array)}
Content-Length: total size (cÃ³ thá»ƒ váº¯ng cross-origin)
Concat chunks: Uint8Array.set(chunk, position)
Decode: TextDecoder("utf-8").decode() / new Blob(chunks)
âš ï¸ Chá»‰ download progress! Upload cáº§n XMLHttpRequest

FETCH ABORT:
AbortController: abort() + signal (.aborted)
fetch(url, {signal}): há»§y báº±ng controller.abort()
abort() â†’ reject vá»›i AbortError (try/catch)
1 controller há»§y nhiá»u fetch cÃ¹ng lÃºc
signal.addEventListener("abort"): custom tasks

FETCH API OPTIONS:
referrer/referrerPolicy: kiá»ƒm soÃ¡t Referer header
mode: cors / same-origin / no-cors
credentials: same-origin / include / omit
cache: default/no-store/reload/no-cache/force-cache/only-if-cached
redirect: follow / error / manual
integrity: SHA checksum verification
keepalive: true (sá»‘ng sau unload, â‰¤ 64KB)

URL OBJECTS:
new URL(url, base): parse + relative paths
Components: protocol/host/pathname/search/hash/href
searchParams (URLSearchParams): auto-encode, iterable
append/delete/get/getAll/has/set/sort
encodeURI: whole URL (giá»¯ & ? = #)
encodeURIComponent: 1 param (encode & ? = #)
URL class (RFC3986) > encode* (RFC2396)

XMLHTTPREQUEST:
3 steps: new XHR â†’ open(method, url) â†’ send(body)
Events: load/error/progress + timeout
responseType: text/json/blob/arraybuffer/document
readyState: 0â†’4 (readystatechange deprecated)
setRequestHeader: appends (khÃ´ng overwrite)
xhr.upload.onprogress: UPLOAD progress (Æ°u tháº¿ fetch)
withCredentials: cookies cross-origin
abort(): há»§y request, status = 0
Lifecycle: loadstartâ†’progressâ†’load/error/timeoutâ†’loadend

RESUMABLE FILE UPLOAD:
fileId = name + size + lastModified
fetch("status", {X-File-Id}) â†’ startByte
xhr.send(file.slice(startByte)): gá»­i pháº§n cÃ²n láº¡i
X-File-Id + X-Start-Byte: headers cho server
onprogress = Ä‘Ã£ gá»­i (sent), khÃ´ng cháº¯c Ä‘Ã£ nháº­n (received)

LONG POLLING:
Server giá»¯ connection Ä‘áº¿n khi cÃ³ data
Browser reconnect ngay sau response
502: reconnect ngay, error khÃ¡c: delay 1s
Recursive async subscribe() function
Server cáº§n handle nhiá»u pending connections
Tá»‘t cho rare messages, nhiá»u â†’ WebSocket/SSE

WEBSOCKET:
new WebSocket("wss://...") (luÃ´n wss, khÃ´ng ws)
Events: open/message/error/close
send(string | Blob | ArrayBuffer)
Handshake: Upgrade â†’ 101 Switching Protocols
binaryType: "blob" (default) / "arraybuffer"
bufferedAmount: rate limiting
close(code, reason): 1000 normal, 1006 lost
readyState: 0(CONNECTING) â†’ 3(CLOSED)
Cross-origin OK, khÃ´ng built-in reconnection

SERVER-SENT EVENTS (SSE):
new EventSource(url, {withCredentials})
One-way: server â†’ client (text only, HTTP)
Auto-reconnect + retry: (ms), 204 stops
id: + lastEventId + Last-Event-ID on reconnect
Server: Content-Type: text/event-stream
Fields: data: / id: / retry: / event:
event: custom events (addEventListener, khÃ´ng onmessage)
readyState: 0(CONNECTING) / 1(OPEN) / 2(CLOSED)
close(): Ä‘Ã³ng (khÃ´ng reopen, táº¡o má»›i)

SSE SPEC INTERNALS:
Announce: OPEN + fire open
Reestablish: CONNECTING + error + wait retry + Last-Event-ID
Fail: CLOSED + error (status!=200, wrong Content-Type)
data: append + \n, trailing \n removed on dispatch
id: no NULL, empty id resets lastEventId
retry: only ASCII digits, ignore otherwise
: comment line = keepalive (má»—i 15s)
6 conn/domain limit â†’ SharedWorker share EventSource
cache mode: no-store

WEB WORKERS:
new Worker("file.js"): Dedicated (1:1)
new SharedWorker: nhiá»u tabs, dÃ¹ng PORT
postMessage/onmessage: structured clone (copy)
Transferable: zero-copy, original cleared (ArrayBuffer)
SharedArrayBuffer: shared memory
KhÃ´ng DOM/window, cÃ³ fetch/WS/IndexedDB
terminate(): kill ngay, onerror: message/filename/lineno
importScripts(): synchronous, execute theo thá»© tá»±
Embedded: Blob + URL.createObjectURL
CSP riÃªng (khÃ´ng inherit parent)

WORKER AVAILABLE APIS:
CÃ“: fetch/XHR/WebSocket/SSE, IndexedDB, Canvas/WebGL/WebGPU
CÃ“: Web Crypto, Web Locks, Streams, Compression
CÃ“: setTimeout/setInterval, structuredClone, queueMicrotask
CÃ“: Performance, Notifications, Push, BroadcastChannel
WORKER-ONLY: importScripts() (synchronous)
DEDICATED-ONLY: postMessage(), rAF/cancelRAF
KHÃ”NG: DOM, window, document, alert, localStorage

STRUCTURED CLONE ALGORITHM:
Deep copy + cycle detection (circular ref OK)
DÃ¹ng: structuredClone(), postMessage(), IndexedDB
âœ“ Primitives (trá»« Symbol), plain Objects, Array/Map/Set
âœ“ Date, RegExp (lastIndex=0!), Error types
âœ“ ArrayBuffer, TypedArray, Blob, File, ImageBitmap
âœ— Functions â†’ DataCloneError
âœ— DOM nodes â†’ DataCloneError
âœ— Property descriptors, getters/setters máº¥t
âœ— Prototype chain khÃ´ng clone
âœ— Class private fields, Symbol

TRANSFERABLE OBJECTS:
Transfer = move ownership (zero-copy, original detached)
postMessage(data, [transferList])
structuredClone(data, { transfer: [...] })
TypedArray: serializable, KHÃ”NG transferable
Transfer .buffer (ArrayBuffer) thay vÃ¬ TypedArray
Supported: ArrayBuffer, MessagePort, Streams
           ImageBitmap, OffscreenCanvas, VideoFrame
Marked [Transferable] in Web IDL

WORKER INTERFACES:
Worker: postMessage(), terminate(), message/error/messageerror
SharedWorker: port (MessagePort), error event
DedicatedScope: name, close(), postMessage(), rAF
  Events: message, messageerror
SharedScope: name, close(), connect event
WorkerGlobalScope: self, location, navigator, caches, crypto
  indexedDB, performance, fetch, importScripts, structuredClone
  Events: error, online/offline, unhandledrejection
WorkerLocation: href, origin, pathname, search, hash
WorkerNavigator: onLine, hardwareConcurrency, language, locks
  connection, deviceMemory, gpu, storage, permissions

SERVICE WORKER API:
Proxy: app â†” browser â†” network, HTTPS only
Lifecycle: Download â†’ Install â†’ Activate
Install: caches.open() + cache.addAll() + waitUntil()
Fetch: event.respondWith(caches.match || fetch)
Activate: dá»n cache cÅ©, clients.claim()
skipWaiting() = activate ngay, clients.claim() = control pages
response.clone() vÃ¬ stream chá»‰ Ä‘á»c 1 láº§n
Navigation preload: event.preloadResponse
No DOM, no sync XHR, no localStorage, no import()

HISTORY API:
history.length, history.state, history.scrollRestoration
Navigate: back(), forward(), go(n) â€” async, silent
pushState(state, "", url) â€” thÃªm entry má»›i
replaceState(state, "", url) â€” cáº­p nháº­t entry hiá»‡n táº¡i
popstate: fire khi back/forward, KHÃ”NG khi push/replace
event.state = copy of state object
SPA: replaceState(init) + pushState(nav) + popstate(back)
URL must be same-origin, state must be serializable
title param bá»‹ ignore (trá»« Safari)

FETCH API:
fetch(url, opts) â†’ Promise<Response>
KHÃ”NG reject khi 404/500, chá»‰ network error
Body: string/Blob/FormData/URLSearchParams/ReadableStream
Body lÃ  stream â†’ chá»‰ Ä‘á»c 1 láº§n â†’ clone()
Mode: cors(default), same-origin, no-cors(opaque)
Credentials: same-origin(default), include, omit
AbortController + signal â†’ AbortError
Response: ok/status, json()/text()/blob() async
Streaming: response.body = ReadableStream
fetchLater(): deferred beaconing, 640KiB quota

COOKIES:
document.cookie: accessor getter/setter
Write chá»‰ update cookie Ä‘Æ°á»£c mention
Encode: encodeURIComponent(name) + '=' + encodeURIComponent(value)
Limits: 4KB/cookie, ~20+/domain
path=/ (má»i trang), domain=site.com (+subdomains)
expires (GMT date) / max-age (seconds, precedence)
KhÃ´ng set â†’ session cookie (xÃ³a khi Ä‘Ã³ng browser)
secure: HTTPS only. httpOnly: JS khÃ´ng access
samesite: strict / lax (default, safe GET top-nav) / none (+secure)
Third-party: Safari block, Chrome phasing out
GDPR: consent cho tracking cookies

INDEXEDDB:
open(name, version): upgradeneeded/success/error
Schema versioning: upgradeneeded khi version < specified
Object stores: createObjectStore (upgradeneeded only)
keyPath (property key) vs autoIncrement
Transactions: readonly/readwrite, autocommit after microtasks
âš ï¸ KHÃ”NG fetch/setTimeout trong transaction!
add (ConstraintError dup) vs put (replace), delete, clear
IDBKeyRange: lowerBound/upperBound/bound/only
Indexes: createIndex â†’ search by field
Cursors: openCursor, continue/advance, memory-efficient
Events bubble: request â†’ transaction â†’ database
versionchange + onblocked cho parallel updates

OBJECTS:
Primitive: value, immutable. Reference: pointer, mutable
Create: literal {}, new Object(), Constructor, Prototype
Access: dot (obj.key), bracket (obj['key'], dynamic)
Attributes: configurable/enumerable/writable (default true)
in: own+inherited. hasOwnProperty: own only
for...in: own+inherited enumerable. Object.keys: own only
delete: own only, luÃ´n tráº£ true, inherited â†’ delete prototype
JSON.stringify/parse: serialize/deserialize
Prototype chain: instance â†’ F.prototype â†’ Object.prototype â†’ null

PROTOTYPE:
F.prototype: property trÃªn function, attach methods â†’ káº¿ thá»«a
[[Prototype]]: attribute trÃªn object, trá» Ä‘áº¿n parent
{} / new Object() â†’ Object.prototype | new F() â†’ F.prototype
Object.create(proto) â†’ proto
Constructor: fn + new, instances inherit constructor property
Inheritance: Child.prototype = new Parent()
Chain: obj â†’ F.prototype â†’ ... â†’ Object.prototype â†’ null
Lookup: tÃ¬m property theo chain, dá»«ng khi found, háº¿t â†’ undefined
Shadowing: own property ghi Ä‘Ã¨ inherited (lookup stops)
Object.prototype: top of chain, methods: toString/valueOf/hasOwnProperty...
âš ï¸ Ghi Ä‘Ã¨ F.prototype = {} â†’ máº¥t constructor
âš ï¸ __proto__ deprecated â†’ Object.getPrototypeOf()

VARIABLE SCOPE & HOISTING:
var: function scope, KHÃ”NG block scope | let/const: block scope
var trong if/for = váº«n global! | let trong for = block scope
KhÃ´ng var/let/const â†’ auto global (strict â†’ error)
Local > Global khi cÃ¹ng tÃªn trong function
Global vars gáº¯n vÃ o window | setTimeout this = window
Hoisting: chá»‰ declaration (value=undefined), KHÃ”NG assignment
Function declaration > var declaration khi hoisted
var ASSIGNMENT > function declaration
Function expression (var f = fn) KHÃ”NG hoisted
let/const: TDZ â†’ ReferenceError náº¿u trÆ°á»›c khai bÃ¡o

CLOSURES:
Closure = inner fn + access outer scope (vars + params + global)
3 scope chains: own + outer function + global
Váº«n access outer vars SAU KHI outer fn Ä‘Ã£ return
Store REFERENCES, khÃ´ng values â†’ Ä‘á»c updated value
Private vars: return {getX, setX} â€” encapsulation pattern
âŒ for loop bug: táº¥t cáº£ closures share cÃ¹ng i (last value)
âœ… Fix: IIFE (capture per iteration) hoáº·c let (block scope)
âš ï¸ Inner fn KHÃ”NG access outer arguments object
âš ï¸ Scope chain theo CREATION site | memory leak risk

CALLBACK FUNCTIONS:
Functions = first-class objects (pass/store/return nhÆ° variable)
Callback = fn truyá»n vÃ o fn khÃ¡c, gá»i SAU (called back)
Callbacks lÃ  closures: access containing fn scope + global
Named (reusable, debug) hoáº·c anonymous callbacks
typeof === 'function' check trÆ°á»›c khi gá»i callback
âŒ this problem: method as callback â†’ this = window
âœ… Fix: callback.apply(obj, args) / .call(obj, a, b) / .bind(obj)
Multiple callbacks: success/error/complete pattern
âŒ Callback Hell: nested callbacks â†’ pyramid of doom
âœ… Fix: named fns, modules, Promises, async/await

JAVASCRIPT'S "this" KEYWORD:
this = INVOKING object (gÃ¡n táº¡i invocation, khÃ´ng pháº£i definition)
Global: this = window | strict mode: undefined
Object method: this = object gá»i method Ä‘Ã³
Trap 1: method as callback â†’ this = DOM/window â†’ fix: .bind(obj)
Trap 2: closure/inner fn â†’ this = window â†’ fix: self=this | arrow fn
Trap 3: method assign to var â†’ this = window â†’ fix: .bind(obj)
Trap 4: borrowing methods â†’ this = borrower â†’ fix: .apply(target)
Context = subject of executing code, changeable vá»›i call/apply/bind

APPLY, CALL & BIND METHODS:
call(obj, a, b): gá»i NGAY, args riÃªng láº», set this
apply(obj, [a,b]): gá»i NGAY, args ARRAY, set this
bind(obj, a): TRáº¢ FN Má»šI, this + partial args cá»‘ Ä‘á»‹nh (khÃ´ng gá»i)
Set this: fix callback context, borrowing methods
Borrow Array methods trÃªn array-like: arguments, NodeList
Currying: bind(null, preset1) â†’ partial application
Variadic: Math.max.apply(null, arr) | modern: Math.max(...arr)
âš ï¸ Borrowed method = reference, original changes reflect
Modern alt: spread (...), Array.from(), arrow fn

this COMPLETE REFERENCE:
Non-strict: null/undefined â†’ globalThis | primitive â†’ wrapper object
Strict: this giá»¯ nguyÃªn (undefined, null, primitive)
Arrow fn: lexical this (khÃ´ng thá»ƒ Ä‘á»•i báº±ng bind/call/apply)
new Fn(): this = new object (Ä‘áº·c biá»‡t: return object overrides)
bind chá»‰ works Má»˜T Láº¦N: rebind bá»‹ ignored
Class: instance field this = instance | static field this = class
Derived: must call super() before using this
Getter/Setter: this = object accessed on (khÃ´ng pháº£i defined on)
DOM handler: this = element | inline inner fn = globalThis
Module top-level: this = undefined
Bound methods: má»—i instance = báº£n sao riÃªng (âš ï¸ memory)

INTRODUCING ASYNCHRONOUS JAVASCRIPT:
Sync = step-by-step, blocking, caller chá» function xong
JS single-threaded: 1 thread = 1 viá»‡c â†’ long sync = UI freeze
Async: báº¯t Ä‘áº§u task â†’ return ngay â†’ khÃ´ng block â†’ notify khi xong
Event handlers: gáº¯n listener, gá»i khi event (XMLHttpRequest pattern)
Callbacks: fn truyá»n vÃ o fn, gá»i khi thÃ­ch há»£p
âŒ Callback Hell: nested â†’ pyramid of doom, khÃ³ Ä‘á»c/debug
âŒ Error handling táº¡i má»—i táº§ng nested
âœ… Modern: Promises (.then/.catch) + async/await thay callbacks
Common async APIs: fetch(), getUserMedia(), setTimeout()

MEMORY MANAGEMENT & GARBAGE COLLECTION:
Life cycle: Allocate â†’ Use â†’ Release (GC tá»± Ä‘á»™ng)
JS auto allocate: value init (number/string/object/array/fn)
Methods táº¡o objects má»›i: substring, concat, slice
Reference-counting: 0 refs = GC (âŒ circular ref = memory leak)
Mark-and-sweep: root â†’ reachable = alive, unreachable = GC (âœ… modern)
WeakMap/WeakSet: keys weakly held, only objects/symbols, not iterable
WeakRef: deref() = undefined khi GC'd (cache pattern)
FinalizationRegistry: callback khi GC (âš ï¸ no timing guarantee)
Deterministic cleanup: try...finally (khÃ´ng pháº£i GC)
V8: --max-old-space-size, --expose-gc

FRONTEND ARCHITECTURE (LARGE-SCALE):
Basic Layer: GitLab + version lock + Jenkins CI/CD + pure FE versioning
Scaffold: unified structure + pre-import libs + quick switch
Node BFF: SSR cho SEO + giáº£m blank screen + Ä‘á»c backend services
Analytics: PV/UV + feature usage + error capture + charts
Monitoring: traffic drop/error spike â†’ auto alarm
Security: XSS encode + HTTPS + CSRF token
ESLint: mandatory in CI + giáº£m bugs + readability
Canary: 1% â†’ 5% â†’ 50% â†’ 100% + rollback nhanh
FE-BE sep: backend own HTML (inject tracking/i18n)
App Layer: multi-page > SPA + split by domain + component lib
Unified stack + browser compat + SSO + CDN + load balancing
Shared APIs: cÃ¹ng business = cÃ¹ng interface (PC + H5)

MONOREPO:
Evolution: Monolith â†’ MultiRepo â†’ MonoRepo
MonoRepo: nhiá»u projects trong 1 repo, share code/config
MultiRepo: âœ… isolation âŒ dup deps, npm link manual
MonoRepo: âœ… hoist deps, auto link, 1 cmd deploy âŒ repo lá»›n, no per-project access
Ghost deps: dÃ¹ng dep khÃ´ng cÃ³ trong package.json â†’ pnpm fix
pnpm: CAS hard links + virtual store + no ghost deps + fastest
Lerna: version mgmt (fixed/independent) + publish + commands
Turborepo: parallel tasks + local/remote cache
Nx: incremental + parallel + distributed build + Nx Cloud
Rush: Microsoft, common/temp install + parallel + plugins
Start: Lerna + pnpm workspace â†’ Scale: + Nx/Turborepo

FRONTEND INFRASTRUCTURE (NON-MAJOR):
4 layers: Business âŠƒ Engineering âŠƒ Frontend âŠƒ Backend
Why: reuse + efficiency + standardize + team growth + open source
Promote: find people â†’ define problems â†’ solutions â†’ execute incrementally
4 traits: tech soundness + stability + R&D efficiency + UX
16 components: Standards, Docs, Templates, CLI Scaffold,
  Component Lib, Responsive/Adaptive, Utils/Hooks, Tool Automation,
  BFF, SSR, CI/CD, Monitoring/Tracking, Visualization,
  Performance, Low-Code, Micro-Frontend
CLI: >90% chá»‰ táº¡o project (chÆ°a maximize)
BFF: aggregate microservices â†’ unified API
Low-Code: phÃ¹ há»£p B2B high volume, khÃ´ng vÃ¬ tiÃªn tiáº¿n mÃ  vÃ¬ phÃ¹ há»£p
Micro-FE: split large app â†’ small independent apps + parallel dev
```

### CÃ¢u Há»i ThÆ°á»ng Gáº·p

**1. JavaScript cÃ³ bao nhiÃªu kiá»ƒu dá»¯ liá»‡u?**

> 8 kiá»ƒu: 7 primitive (Number, String, Boolean, null, undefined, Symbol, BigInt) vÃ  1 reference (Object, bao gá»“m Array, Function, Date, etc.)

**2. Sá»± khÃ¡c biá»‡t giá»¯a primitive vÃ  reference types?**

> - Primitive: lÆ°u trá»±c tiáº¿p trong stack, copy by value, immutable
> - Reference: giÃ¡ trá»‹ lÆ°u trong heap, stack lÆ°u pointer, copy by reference

**3. Táº¡i sao typeof null === "object"?**

> ÄÃ¢y lÃ  bug tá»« JavaScript Ä‘áº§u tiÃªn. Trong implementation ban Ä‘áº§u, values Ä‘Æ°á»£c lÆ°u vá»›i type tag, vÃ  null cÃ³ type tag 0 (giá»‘ng object). Bug nÃ y khÃ´ng thá»ƒ fix vÃ¬ sáº½ break existing code.

**4. CÃ¡ch nÃ o chÃ­nh xÃ¡c nháº¥t Ä‘á»ƒ kiá»ƒm tra type?**

> Object.prototype.toString.call(value) - hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c vá»›i táº¥t cáº£ types, ká»ƒ cáº£ null vÃ  Array.

**5. PhÃ¢n biá»‡t undefined vÃ  null?**

> - undefined: variable chÆ°a Ä‘Æ°á»£c gÃ¡n giÃ¡ trá»‹, hoáº·c function khÃ´ng return
> - null: giÃ¡ trá»‹ Ä‘Æ°á»£c gÃ¡n cÃ³ chá»§ Ä‘Ã­ch Ä‘á»ƒ biá»ƒu thá»‹ "khÃ´ng cÃ³ giÃ¡ trá»‹"

**6. Sá»± khÃ¡c biá»‡t giá»¯a var, let, const?**

> - `var`: function scope, hoisting (initialized undefined), cho phÃ©p khai bÃ¡o láº¡i, táº¡o mapping vá»›i window
> - `let`: block scope, TDZ (khÃ´ng dÃ¹ng trÆ°á»›c khi khai bÃ¡o), khÃ´ng cho khai bÃ¡o láº¡i
> - `const`: giá»‘ng let nhÆ°ng PHáº¢I khá»Ÿi táº¡o khi khai bÃ¡o vÃ  KHÃ”NG thá»ƒ gÃ¡n láº¡i (reference immutable, value cÃ³ thá»ƒ thay Ä‘á»•i)

**7. Temporal Dead Zone (TDZ) lÃ  gÃ¬?**

> TDZ lÃ  khoáº£ng thá»i gian tá»« Ä‘áº§u block scope Ä‘áº¿n dÃ²ng khai bÃ¡o biáº¿n let/const. Trong khoáº£ng nÃ y, báº¥t ká»³ access nÃ o Ä‘áº¿n biáº¿n Ä‘á»u throw ReferenceError. Äiá»u nÃ y khÃ¡c vá»›i `typeof` trÃªn biáº¿n chÆ°a khai bÃ¡o (undeclared) â€” tráº£ vá» "undefined" mÃ  khÃ´ng lá»—i.

**8. Táº¡i sao `var i` trong for loop gÃ¢y bug vá»›i setTimeout?**

> `var` lÃ  function scope nÃªn chá»‰ cÃ³ Má»˜T biáº¿n `i` cho toÃ n bá»™ loop. Khi callback cháº¡y, loop Ä‘Ã£ káº¿t thÃºc vÃ  `i` Ä‘Ã£ lÃ  giÃ¡ trá»‹ cuá»‘i. `let` táº¡o block scope Má»šI cho má»—i iteration, má»—i callback capture báº£n copy riÃªng.

**9. const object cÃ³ thá»ƒ thay Ä‘á»•i property khÃ´ng?**

> CÃ³. `const` chá»‰ Ä‘áº£m báº£o reference báº¥t biáº¿n (khÃ´ng thá»ƒ gÃ¡n láº¡i biáº¿n), nhÆ°ng value bÃªn trong object/array váº«n cÃ³ thá»ƒ thay Ä‘á»•i. Äá»ƒ freeze hoÃ n toÃ n, dÃ¹ng `Object.freeze()`.

**10. Giáº£i thÃ­ch cÆ¡ cháº¿ Garbage Collection trong JavaScript?**

> JS sá»­ dá»¥ng GC tá»± Ä‘á»™ng. Phá»• biáº¿n nháº¥t lÃ  **Mark-and-Sweep**: GC báº¯t Ä‘áº§u tá»« root (window), Ä‘Ã¡nh dáº¥u táº¥t cáº£ objects reachable, sau Ä‘Ã³ sweep (xÃ³a) cÃ¡c objects unreachable. V8 (Chrome) sá»­ dá»¥ng **Generational GC** vá»›i Young Generation (Scavenger, nhanh, thÆ°á»ng xuyÃªn) vÃ  Old Generation (Mark-Sweep-Compact, Ã­t thÆ°á»ng xuyÃªn hÆ¡n).

**11. 4 loáº¡i Memory Leak chÃ­nh trong JavaScript?**

> 1. **Global variables**: biáº¿n toÃ n cá»¥c vÃ´ tÃ¬nh (quÃªn let/const)
> 2. **Closures**: giá»¯ reference Ä‘áº¿n outer scope, ngÄƒn GC thu há»“i
> 3. **DOM references**: giá»¯ reference Ä‘áº¿n element Ä‘Ã£ bá»‹ remove khá»i DOM
> 4. **Timers/event listeners**: quÃªn clearInterval hoáº·c removeEventListener

**12. Reference Counting cÃ³ váº¥n Ä‘á» gÃ¬? Táº¡i sao khÃ´ng cÃ²n Ä‘Æ°á»£c dÃ¹ng?**

> Reference Counting khÃ´ng xá»­ lÃ½ Ä‘Æ°á»£c **circular reference** (tham chiáº¿u vÃ²ng). Khi A trá» Ä‘áº¿n B vÃ  B trá» Ä‘áº¿n A, cáº£ hai refCount khÃ´ng bao giá» vá» 0 â†’ memory leak vÄ©nh viá»…n. Mark-and-Sweep giáº£i quyáº¿t váº¥n Ä‘á» nÃ y vÃ¬ cáº£ A vÃ  B Ä‘á»u unreachable tá»« root â†’ sáº½ bá»‹ GC.

**13. CÃ¡ch tá»‘i Æ°u bá»™ nhá»› trong JavaScript?**

> - Heap: gÃ¡n `= null` Ä‘á»ƒ há»§y reference (null pointer)
> - Stack: há»§y bá» heap memory mÃ  context bÃªn ngoÃ i chiáº¿m giá»¯ (release closure)
> - DÃ¹ng `WeakMap`/`WeakSet` cho cache (cho phÃ©p GC tá»± Ä‘á»™ng)
> - Clear timers vÃ  remove event listeners khi khÃ´ng cáº§n
> - DÃ¹ng `"use strict"` Ä‘á»ƒ trÃ¡nh global variables vÃ´ tÃ¬nh

**14. Scope vÃ  Scope Chain lÃ  gÃ¬?**

> **Scope** lÃ  pháº¡m vi mÃ  biáº¿n vÃ  function cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p. CÃ³ 3 loáº¡i: Global (truy cáº­p má»i nÆ¡i), Function (chá»‰ trong function), Block (chá»‰ trong `{}` vá»›i let/const). **Scope Chain** lÃ  chuá»—i tÃ¬m kiáº¿m biáº¿n tá»« scope hiá»‡n táº¡i â†’ scope cha â†’ ... â†’ global. Náº¿u khÃ´ng tÃ¬m tháº¥y á»Ÿ global thÃ¬ throw ReferenceError.

**15. Lexical Scope nghÄ©a lÃ  gÃ¬? Táº¡i sao quan trá»ng?**

> Lexical Scope (Static Scope) nghÄ©a lÃ  scope Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh táº¡i thá»i Ä‘iá»ƒm function Ä‘Æ°á»£c **Táº O** (viáº¿t code), khÃ´ng pháº£i nÆ¡i function Ä‘Æ°á»£c **Gá»ŒI** (runtime). Äiá»u nÃ y cÃ³ nghÄ©a scope chain of a function phá»¥ thuá»™c vÃ o vá»‹ trÃ­ khai bÃ¡o trong source code, giÃºp code dá»… dá»± Ä‘oÃ¡n vÃ  debug hÆ¡n.

**16. Scope Chain vÃ  Prototype Chain khÃ¡c nhau nhÆ° tháº¿ nÃ o?**

> - **Scope Chain**: tÃ¬m **biáº¿n** (variables), hÆ°á»›ng inner â†’ outer â†’ global, xÃ¡c Ä‘á»‹nh táº¡i compile time, ReferenceError náº¿u khÃ´ng tÃ¬m tháº¥y.
> - **Prototype Chain**: tÃ¬m **property** cá»§a object, hÆ°á»›ng obj â†’ `__proto__` â†’ ... â†’ null, xÃ¡c Ä‘á»‹nh táº¡i runtime, tráº£ vá» `undefined` náº¿u khÃ´ng tÃ¬m tháº¥y.

**17. Closure lÃ  gÃ¬? Hai chá»©c nÄƒng chÃ­nh?**

> Closure lÃ  function cÃ³ quyá»n truy cáº­p biáº¿n trong scope cá»§a function khÃ¡c. Hai chá»©c nÄƒng chÃ­nh:
>
> 1. **Báº£o vá»‡ (Protection)**: táº¡o vÃ¹ng code Ä‘á»™c láº­p, biáº¿n private khÃ´ng bá»‹ can thiá»‡p tá»« bÃªn ngoÃ i
> 2. **LÆ°u giá»¯ (Saving)**: náº¿u context khÃ´ng bá»‹ release, biáº¿n private cÅ©ng khÃ´ng bá»‹ release, cÃ³ thá»ƒ truy xuáº¥t á»Ÿ context cáº¥p dÆ°á»›i

**18. Closure hÃ¬nh thÃ nh trong Ä‘iá»u kiá»‡n nÃ o?**

> Cáº§n 2 Ä‘iá»u kiá»‡n Ä‘á»“ng thá»i: (1) Functions lá»“ng nhau (nested), vÃ  (2) inner function tham chiáº¿u biáº¿n local cá»§a outer function. Äiá»u nÃ y kÃ©o dÃ i vÃ²ng Ä‘á»i cá»§a biáº¿n outer, vÃ¬ GC khÃ´ng thá»ƒ thu há»“i biáº¿n Ä‘ang Ä‘Æ°á»£c reference.

**19. Táº¡i sao nÃ³i closure cÃ³ thá»ƒ gÃ¢y memory leak?**

> Closure giá»¯ reference Ä‘áº¿n biáº¿n outer scope â†’ biáº¿n nÃ y KHÃ”NG bá»‹ GC thu há»“i â†’ luÃ´n lÆ°u trong memory. Náº¿u cÃ³ quÃ¡ nhiá»u closures hoáº·c closure giá»¯ data lá»›n mÃ  khÃ´ng Ä‘Æ°á»£c release (gÃ¡n `= null`), memory sáº½ liÃªn tá»¥c tÄƒng â†’ memory leak. ÄÃ¢y lÃ  trade-off: kÃ©o dÃ i vÃ²ng Ä‘á»i biáº¿n (useful) nhÆ°ng tá»‘n memory (dangerous).

**20. Giáº£i thÃ­ch 5 trÆ°á»ng há»£p cá»§a this trong JavaScript?**

> 1. **Regular function**: this = window (strict mode: undefined)
> 2. **Object method**: this = object gá»i method (object trÆ°á»›c dáº¥u `.` cuá»‘i cÃ¹ng)
> 3. **Constructor (new)**: this = object má»›i Ä‘Æ°á»£c táº¡o
> 4. **Arrow function**: this = lexical (this cá»§a scope chá»©a nÃ³, KHÃ”NG THá»‚ thay Ä‘á»•i)
> 5. **call/apply/bind**: this = object truyá»n vÃ o

**21. apply, call, bind khÃ¡c nhau tháº¿ nÃ o?**

> - **call**: gá»i ngay, nháº­n **danh sÃ¡ch** tham sá»‘ â€” `fn.call(thisArg, a, b)`
> - **apply**: gá»i ngay, nháº­n **máº£ng** tham sá»‘ â€” `fn.apply(thisArg, [a, b])`
> - **bind**: KHÃ”NG gá»i ngay, tráº£ vá» **function má»›i** vá»›i this Ä‘Ã£ bind â€” `fn.bind(thisArg)`
>
> bind + new: new **tháº¯ng**, this = object má»›i (khÃ´ng pháº£i object bind). Cáº£ 3 Ä‘á»u KHÃ”NG cÃ³ tÃ¡c dá»¥ng vá»›i arrow function.

**22. Táº¡i sao arrow function khÃ´ng nÃªn dÃ¹ng lÃ m method?**

> Arrow function khÃ´ng cÃ³ `this` riÃªng â€” nÃ³ káº¿ thá»«a `this` tá»« scope chá»©a nÃ³. Náº¿u dÃ¹ng lÃ m method cá»§a object literal, `this` sáº½ trá» vá» **global** (hoáº·c undefined trong strict mode) thay vÃ¬ object, vÃ¬ scope chá»©a object literal lÃ  global scope.

**23. Prototype vÃ  Prototype Chain lÃ  gÃ¬?**

> **Prototype**: Má»—i function cÃ³ property `.prototype` (object chá»©a shared methods). Má»—i instance cÃ³ `__proto__` trá» Ä‘áº¿n `Constructor.prototype`.
>
> **Prototype Chain**: Chuá»—i `__proto__` liÃªn káº¿t tá»« instance â†’ prototype â†’ prototype's prototype â†’ ... â†’ `Object.prototype` â†’ `null`. Khi tÃ¬m property, JS Ä‘i theo chain nÃ y. Náº¿u Ä‘áº¿n `null` váº«n khÃ´ng tÃ¬m tháº¥y â†’ tráº£ vá» `undefined`.

**24. Táº¡i sao thay Ä‘á»•i prototype áº£nh hÆ°á»Ÿng táº¥t cáº£ instances?**

> JavaScript objects truyá»n theo **tham chiáº¿u** (pass-by-reference). Instances KHÃ”NG cÃ³ báº£n copy riÃªng cá»§a prototype â€” chÃºng SHARE cÃ¹ng má»™t prototype object. Khi thÃªm/sá»­a method trÃªn prototype, táº¥t cáº£ instances Ä‘á»u tháº¥y thay Ä‘á»•i vÃ¬ chÃºng trá» Ä‘áº¿n cÃ¹ng object qua `__proto__`.

**25. hasOwnProperty vÃ  `in` khÃ¡c gÃ¬ nhau?**

> - `hasOwnProperty()`: chá»‰ kiá»ƒm tra property **trá»±c tiáº¿p trÃªn object** (own property)
> - `in`: kiá»ƒm tra cáº£ own property **láº«n inherited** tá»« prototype chain
> - `Object.keys()`: chá»‰ tráº£ vá» own **enumerable** properties

**26. Giáº£i thÃ­ch cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a new operator?**

> `new` thá»±c hiá»‡n 4 bÆ°á»›c: (1) Táº¡o object rá»—ng `{}`, (2) GÃ¡n `obj.__proto__ = Constructor.prototype` (liÃªn káº¿t prototype chain), (3) Bind `this = obj` vÃ  thá»±c thi constructor code, (4) Kiá»ƒm tra return â€” náº¿u return object thÃ¬ dÃ¹ng object Ä‘Ã³, náº¿u return primitive hoáº·c khÃ´ng return thÃ¬ dÃ¹ng obj Ä‘Ã£ táº¡o á»Ÿ step 1.

**27. Táº¡i sao quÃªn `new` khi gá»i constructor láº¡i gÃ¢y bug?**

> Thiáº¿u `new` â†’ function Ä‘Æ°á»£c gá»i nhÆ° regular function â†’ `this = window` (non-strict) â†’ properties gÃ¡n vÃ o global object thay vÃ¬ instance má»›i. Fix báº±ng `new.target` check trong function hoáº·c dÃ¹ng ES6 `class` (tá»± throw TypeError náº¿u thiáº¿u new).

**28. Event Loop lÃ  gÃ¬? Giáº£i thÃ­ch thá»© tá»± thá»±c thi?**

> JS lÃ  single-threaded, dÃ¹ng **Event Loop** Ä‘á»ƒ xá»­ lÃ½ async. Thá»© tá»±: (1) Cháº¡y háº¿t sync code trong Call Stack, (2) Clear TOÃ€N Bá»˜ micro-task queue (Promise.then, async/await), (3) Láº¥y 1 macro-task (setTimeout, I/O) Ä‘áº©y vÃ o Stack cháº¡y, (4) Quay láº¡i step 2 clear micro-tasks. Láº·p 2-3-4 cho Ä‘áº¿n khi cáº£ 2 queue rá»—ng.

**29. Macro-task vÃ  micro-task khÃ¡c nhau tháº¿ nÃ o?**

> **Macro-tasks** do host environment cung cáº¥p (setTimeout, setInterval, I/O, rAF) â€” má»—i vÃ²ng loop chá»‰ láº¥y 1 task. **Micro-tasks** do JS engine cung cáº¥p (Promise.then, queueMicrotask, process.nextTick) â€” clear TOÃ€N Bá»˜ sau má»—i macro-task. Micro luÃ´n Æ°u tiÃªn hÆ¡n macro. Trong Node.js, `process.nextTick` Æ°u tiÃªn hÆ¡n `Promise.then`.

**30. Promise constructor lÃ  sync hay async?**

> Promise constructor (executor function) cháº¡y **Äá»’NG Bá»˜** â€” code bÃªn trong `new Promise(fn)` thá»±c thi NGAY Láº¬P Tá»¨C. Chá»‰ cÃ³ `.then()/.catch()/.finally()` má»›i vÃ o micro-task queue (báº¥t Ä‘á»“ng bá»™). LÆ°u Ã½: `resolve()` KHÃ”NG dá»«ng executor â€” code sau `resolve()` váº«n cháº¡y tiáº¿p.

**31. async/await khÃ¡c gÃ¬ Promise vá» máº·t thá»±c thi?**

> Báº£n cháº¥t async/await lÃ  **syntactic sugar** cho Promise. Code trÆ°á»›c `await` = SYNC (cháº¡y ngay). Gáº·p `await` â†’ function **yield** (tráº£ quyá»n cho call stack), pháº§n code sau `await` trá»Ÿ thÃ nh micro-task. Cáº£ hai Ä‘á»u vÃ o cÃ¹ng micro-task queue vá»›i cÃ¹ng priority.

**32. Promise cÃ³ máº¥y tráº¡ng thÃ¡i? Äáº·c Ä‘iá»ƒm?**

> Promise cÃ³ 3 tráº¡ng thÃ¡i: **Pending** (khá»Ÿi táº¡o), **Fulfilled** (resolve thÃ nh cÃ´ng), **Rejected** (reject tháº¥t báº¡i). Má»™t khi Ä‘Ã£ **settled** (fulfilled/rejected) â†’ KHÃ”NG THá»‚ thay Ä‘á»•i. `resolve()` khÃ´ng dá»«ng executor â€” code sau resolve váº«n cháº¡y.

**33. Promise.all vs Promise.allSettled vs Promise.race vs Promise.any?**

> `Promise.all`: chá» Táº¤T Cáº¢, fail ngay náº¿u 1 reject. `Promise.allSettled`: chá» Táº¤T Cáº¢, khÃ´ng bao giá» fail, tráº£ `{status, value/reason}`. `Promise.race`: resolve/reject vá»›i promise settled Äáº¦U TIÃŠN. `Promise.any`: resolve vá»›i promise fulfilled Äáº¦U TIÃŠN, chá»‰ reject náº¿u Táº¤T Cáº¢ fail (AggregateError).

**34. async/await báº£n cháº¥t lÃ  gÃ¬?**

> async/await lÃ  **syntactic sugar** cho **Generator + auto-executor + Promise**. `async function` tÆ°Æ¡ng Ä‘Æ°Æ¡ng `function*`, `await` tÆ°Æ¡ng Ä‘Æ°Æ¡ng `yield`. KhÃ¡c biá»‡t: generator cáº§n executor thá»§ cÃ´ng (Ä‘á»ƒ gá»i `.next()`), cÃ²n async/await Ä‘Æ°á»£c JS engine tá»± Ä‘á»™ng thá»±c thi.

**35. Khi nÃ o dÃ¹ng sequential await, khi nÃ o dÃ¹ng Promise.all?**

> **Sequential** (`await a; await b;`) khi cÃ¡c request **phá»¥ thuá»™c** nhau (output cá»§a a lÃ  input cá»§a b). **Parallel** (`Promise.all([a, b])`) khi cÃ¡c request **Ä‘á»™c láº­p** â€” cháº¡y song song nhanh hÆ¡n. LÆ°u Ã½: `await` trong vÃ²ng láº·p sáº½ sequential; `forEach + await` khÃ´ng hoáº¡t Ä‘á»™ng (fire-and-forget) â€” dÃ¹ng `for...of` hoáº·c `Promise.all(arr.map())`.

**36. Throttle vÃ  Debounce khÃ¡c nhau tháº¿ nÃ o? Viáº¿t code?**

> **Throttle**: giá»›i háº¡n táº§n suáº¥t â€” fn cháº¡y tá»‘i Ä‘a 1 láº§n má»—i N ms, dÃ¹ng timestamp so sÃ¡nh. **Debounce**: chá» á»•n Ä‘á»‹nh â€” má»—i trigger reset timer, fn chá»‰ cháº¡y khi ngá»«ng trigger Ä‘á»§ N ms, dÃ¹ng `clearTimeout + setTimeout`. Cáº£ hai lÃ  HOF tráº£ vá» closure giá»¯ state (lastTime/timer).

**37. Khi nÃ o dÃ¹ng throttle, khi nÃ o dÃ¹ng debounce?**

> **Throttle** khi cáº§n pháº£n há»“i liÃªn tá»¥c Ä‘á»u Ä‘áº·n: scroll load more, mouse move tooltip, game input. **Debounce** khi chá»‰ cáº§n káº¿t quáº£ cuá»‘i cÃ¹ng: search input auto-search, window resize re-render, form auto-save, validate email/phone khi gÃµ.

**38. offsetWidth vs clientWidth vs scrollWidth khÃ¡c nhau tháº¿ nÃ o?**

> `offsetWidth` = border + padding + content + scrollbar (kÃ­ch thÆ°á»›c **ngoÃ i** toÃ n bá»™). `clientWidth` = padding + content (KHÃ”NG scrollbar â€” vÃ¹ng **nhÃ¬n tháº¥y**). `scrollWidth` = client area + pháº§n overflow bá»‹ áº©n (toÃ n bá»™ content **ká»ƒ cáº£ cuá»™n**). Táº¥t cáº£ lÃ  read-only, trá»« `scrollLeft/scrollTop`.

**39. Táº¡i sao khÃ´ng dÃ¹ng getComputedStyle Ä‘á»ƒ láº¥y width?**

> 4 lÃ½ do: (1) tráº£ vá» STRING "300px" thay vÃ¬ number. (2) Inline element tráº£ "auto". (3) `box-sizing` thay Ä‘á»•i Ã½ nghÄ©a width. (4) Scrollbar: Chrome trá»« scrollbar, Firefox khÃ´ng â€” `clientWidth` luÃ´n nháº¥t quÃ¡n trÃªn má»i browser.

**40. LÃ m sao láº¥y kÃ­ch thÆ°á»›c cá»­a sá»• trÃ¬nh duyá»‡t?**

> DÃ¹ng `document.documentElement.clientWidth/clientHeight` â€” tráº£ vá» kÃ­ch thÆ°á»›c vÃ¹ng hiá»ƒn thá»‹ **trá»« scrollbar**. KHÃ”NG dÃ¹ng `window.innerWidth/innerHeight` vÃ¬ bao gá»“m scrollbar, gÃ¢y sai khi tÃ­nh layout. Hai giÃ¡ trá»‹ chá»‰ khÃ¡c nhau khi cÃ³ scrollbar hiá»ƒn thá»‹.

**41. LÃ m sao láº¥y kÃ­ch thÆ°á»›c toÃ n bá»™ document?**

> DÃ¹ng `Math.max()` káº¿t há»£p `scrollHeight`, `offsetHeight`, `clientHeight` tá»« cáº£ `document.body` vÃ  `document.documentElement`. LÃ½ do: `documentElement.scrollHeight` khÃ´ng Ä‘Ã¡ng tin â€” trÃªn Chrome/Safari/Opera, náº¿u khÃ´ng cÃ³ scroll, giÃ¡ trá»‹ nÃ y cÃ³ thá»ƒ **nhá» hÆ¡n** `clientHeight`.

**42. pageYOffset vs documentElement.scrollTop â€” dÃ¹ng cÃ¡i nÃ o?**

> DÃ¹ng `window.pageYOffset` (alias `window.scrollY`). `documentElement.scrollTop` hoáº¡t Ä‘á»™ng sai trÃªn WebKit cÅ© (Safari) â€” pháº£i dÃ¹ng `document.body.scrollTop` thay tháº¿. `pageYOffset` hoáº¡t Ä‘á»™ng **nháº¥t quÃ¡n** trÃªn má»i browser. Cáº£ hai Ä‘á»u read-only.

**43. scrollTo vs scrollBy vs scrollIntoView â€” khi nÃ o dÃ¹ng?**

> `scrollTo(x, y)`: scroll Ä‘áº¿n tá»a Ä‘á»™ **tuyá»‡t Ä‘á»‘i** (vd: `scrollTo(0,0)` = vá» Ä‘áº§u trang). `scrollBy(x, y)`: scroll **tÆ°Æ¡ng Ä‘á»‘i** tá»« vá»‹ trÃ­ hiá»‡n táº¡i (vd: `scrollBy(0,10)` = thÃªm 10px xuá»‘ng). `scrollIntoView(top)`: scroll Ä‘á»ƒ element **hiá»ƒn thá»‹** â€” `true` (default) align top, `false` align bottom. âš ï¸ DOM pháº£i build xong trÆ°á»›c khi scroll.

**44. LÃ m sao "Ä‘Ã³ng bÄƒng" scroll trang?**

> Set `document.body.style.overflow = "hidden"`. Trang freeze táº¡i vá»‹ trÃ­ hiá»‡n táº¡i. âš ï¸ Scrollbar biáº¿n máº¥t â†’ content "nháº£y" sang pháº£i. Fix báº±ng cÃ¡ch tÃ­nh `scrollbarWidth = innerWidth - clientWidth` rá»“i thÃªm `paddingRight` báº±ng Ä‘Ãºng kÃ­ch thÆ°á»›c scrollbar. Unfreeze báº±ng cÃ¡ch reset cáº£ `overflow` vÃ  `paddingRight` vá» `""`.

**45. clientX/clientY vs pageX/pageY khÃ¡c nhau tháº¿ nÃ o?**

> `clientX/clientY` = tá»a Ä‘á»™ **window** (tÃ­nh tá»« cá»­a sá»•, giá»‘ng `position:fixed`), **thay Ä‘á»•i** khi scroll. `pageX/pageY` = tá»a Ä‘á»™ **document** (tÃ­nh tá»« document, giá»‘ng `position:absolute`), **khÃ´ng Ä‘á»•i** khi scroll. Chuyá»ƒn Ä‘á»•i: `pageY = clientY + window.pageYOffset`.

**46. getBoundingClientRect() tráº£ vá» gÃ¬?**

> Tráº£ vá» `DOMRect` object chá»©a tá»a Ä‘á»™ **window** cá»§a element: `x/y` (= `left/top`), `width/height`, `right` (= x + width), `bottom` (= y + height). âš ï¸ GiÃ¡ trá»‹ **thay Ä‘á»•i** khi scroll, cÃ³ thá»ƒ lÃ  **decimal** (10.5) vÃ  **negative** (element á»Ÿ trÃªn viewport). `right/bottom` trong JS **khÃ¡c** CSS: JS tÃ­nh tá»« top-left, CSS tÃ­nh tá»« cáº¡nh Ä‘á»‘i diá»‡n.

**47. elementFromPoint(x, y) dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Tráº£ vá» element **sÃ¢u nháº¥t** (most nested) táº¡i tá»a Ä‘á»™ window `(x, y)`. Chá»‰ hoáº¡t Ä‘á»™ng trong **viewport** â€” tráº£ `null` náº¿u tá»a Ä‘á»™ ngoÃ i vÃ¹ng hiá»ƒn thá»‹. Káº¿t quáº£ thay Ä‘á»•i theo scroll position. LuÃ´n kiá»ƒm tra `null` trÆ°á»›c khi dÃ¹ng.

**48. Khi nÃ o dÃ¹ng window coords, khi nÃ o dÃ¹ng document coords?**

> **Window coords** + `position:fixed` khi muá»‘n element cá»‘ Ä‘á»‹nh trÃªn viewport (toolbar, popup). **Document coords** + `position:absolute` khi muá»‘n element dÃ­nh vá»›i content (tooltip, note). Láº¥y document coords báº±ng `getBoundingClientRect()` + `pageYOffset/pageXOffset`.

**49. Proxy lÃ  gÃ¬ vÃ  khi nÃ o nÃªn dÃ¹ng?**

> Proxy lÃ  wrapper **cháº·n operations** trÃªn object (Ä‘á»c, ghi, xÃ³a, gá»i, etc.) thÃ´ng qua **traps** trong handler. DÃ¹ng cho: **validation** (kiá»ƒm tra type khi ghi), **default values** (tráº£ giÃ¡ trá»‹ máº·c Ä‘á»‹nh thay vÃ¬ undefined), **logging** (theo dÃµi read/write), **access control** (áº©n properties báº¯t Ä‘áº§u `_`), **observable objects** (notify khi thay Ä‘á»•i). Proxy rá»—ng (`handler = {}`) lÃ  transparent wrapper.

**50. Táº¡i sao set trap pháº£i return true?**

> ÄÃ¢y lÃ  **invariant** báº¯t buá»™c. `[[Set]]` pháº£i return `true` náº¿u ghi thÃ nh cÃ´ng, `false` náº¿u tháº¥t báº¡i. Return `false` â†’ **TypeError** tá»± Ä‘á»™ng. QuÃªn return (implicit `undefined` = falsy) cÅ©ng gÃ¢y TypeError. CÃ¡c built-in methods nhÆ° `push/unshift` dÃ¹ng `[[Set]]` ná»™i bá»™ nÃªn proxy váº«n báº¯t Ä‘Æ°á»£c.

**51. Táº¡i sao nÃªn dÃ¹ng Reflect.get thay vÃ¬ target[prop]?**

> `target[prop]` **sai** khi cÃ³ **getter + inheritance**. Khi object con káº¿ thá»«a proxy, `target[prop]` cháº¡y getter vá»›i `this = target` (object gá»‘c) thay vÃ¬ `this = receiver` (object con). `Reflect.get(target, prop, receiver)` truyá»n `receiver` Ä‘Ãºng lÃ m `this` cho getter â†’ káº¿t quáº£ chÃ­nh xÃ¡c.

**52. Proxy cÃ³ nhá»¯ng limitations gÃ¬?**

> 1. **Built-in objects** (Map, Set, Date, Promise) dÃ¹ng **internal slots** â€” proxy khÃ´ng cÃ³ slots â†’ methods fail. Fix: bind methods vá» target. 2) **Private fields** (#) cÅ©ng dÃ¹ng internal slots â†’ same fix. 3) `proxy !== target` â€” **strict equality** khÃ´ng thá»ƒ intercept. 4) **Performance**: property access cháº­m hÆ¡n vÃ i láº§n. âš ï¸ Array khÃ´ng dÃ¹ng internal slots â†’ proxy array OK.

**53. Proxy.revocable dÃ¹ng khi nÃ o?**

> Khi cáº§n **thu há»“i quyá»n truy cáº­p** vÃ o object. `Proxy.revocable(target, handler)` tráº£ `{proxy, revoke}`. Gá»i `revoke()` â†’ má»i operation trÃªn proxy Ä‘á»u **TypeError**. DÃ¹ng **WeakMap** lÆ°u `revoke` functions (key = proxy) Ä‘á»ƒ GC tá»± dá»n khi proxy háº¿t referenced.

**54. Event Loop hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> VÃ²ng láº·p vÃ´ táº­n: 1) Láº¥y **macrotask cÅ© nháº¥t** tá»« queue â†’ cháº¡y. 2) Cháº¡y **Táº¤T Cáº¢ microtasks** (cho Ä‘áº¿n háº¿t queue). 3) **Render** DOM changes (náº¿u cáº§n). 4) Náº¿u macro queue rá»—ng â†’ chá» task má»›i â†’ quay láº¡i 1. âš ï¸ Rendering **KHÃ”NG** xáº£y ra khi engine Ä‘ang cháº¡y task. Task quÃ¡ lÃ¢u â†’ browser hiá»‡n "Page Unresponsive".

**55. Macrotask vs Microtask khÃ¡c gÃ¬?**

> **Macrotasks**: setTimeout, setInterval, I/O, UI events, `<script>` â€” xá»­ lÃ½ FIFO, má»—i láº§n cháº¡y **1 task**. **Microtasks**: Promise.then/catch/finally, await, queueMicrotask â€” cháº¡y **Táº¤T Cáº¢** sau má»—i macrotask, **TRÆ¯á»šC render**. Microtasks Ä‘áº£m báº£o cÃ¹ng environment state (khÃ´ng cÃ³ mouse/network changes).

**56. LÃ m sao chia nhá» CPU-heavy task?**

> DÃ¹ng `setTimeout(continuation, 0)` Ä‘á»ƒ chia task thÃ nh chunks. Má»—i chunk cháº¡y xong â†’ tráº£ quyá»n cho event loop â†’ browser xá»­ lÃ½ events + render â†’ cháº¡y chunk tiáº¿p. âš ï¸ Nested setTimeout delay **â‰¥ 4ms**. Tá»‘i Æ°u: schedule **TRÆ¯á»šC** khi báº¯t Ä‘áº§u chunk â†’ giáº£m delay.

**57. queueMicrotask dÃ¹ng khi nÃ o? KhÃ¡c setTimeout sao?**

> `queueMicrotask(f)` cháº¡y f **sau sync code** nhÆ°ng **TRÆ¯á»šC render** â€” dÃ¹ng khi cáº§n async execution trong **cÃ¹ng environment state**. `setTimeout(f, 0)` cháº¡y f á»Ÿ macrotask **SAU render** â€” browser **CÃ“ THá»‚ repaint** giá»¯a cÃ¡c láº§n. âš ï¸ queueMicrotask cho progress bar â†’ KHÃ”NG tháº¥y progress (giá»‘ng sync). DÃ¹ng setTimeout cho progress/animation.

**58. Garbage Collection hoáº¡t Ä‘á»™ng tháº¿ nÃ o trong JavaScript?**

> GC tá»± Ä‘á»™ng dá»±a trÃªn **reachability**: objects tiáº¿p cáº­n Ä‘Æ°á»£c tá»« **roots** (global vars, call chain) qua chuá»—i references â†’ giá»¯ láº¡i. Objects khÃ´ng ai tá»« root trá» Ä‘áº¿n â†’ **bá»‹ xÃ³a**. Thuáº­t toÃ¡n cÆ¡ báº£n: **Mark-and-Sweep** â€” mark tá»« roots theo references â†’ sweep táº¥t cáº£ unmarked objects.

**59. "Being referenced" khÃ¡c "being reachable" tháº¿ nÃ o?**

> Má»™t nhÃ³m objects cÃ³ thá»ƒ **reference láº«n nhau** (interlinked) nhÆ°ng náº¿u **khÃ´ng ai tá»« root trá» Ä‘áº¿n** â†’ cáº£ "Ä‘áº£o" bá»‹ GC xÃ³a. VÃ­ dá»¥: `family = null` â†’ John â†â†’ Ann váº«n liÃªn káº¿t nhÆ°ng cáº£ hai unreachable. Chá»‰ **incoming refs tá»« root** má»›i cá»©u object, outgoing refs khÃ´ng quan trá»ng.

**60. Ká»ƒ 4 nguyÃªn nhÃ¢n memory leak phá»• biáº¿n?**

> 1. **Global variables vÃ´ tÃ¬nh** (thiáº¿u let/const â†’ biáº¿n global). 2) **Forgotten timers** (setInterval khÃ´ng clear â†’ callback + data sá»‘ng mÃ£i). 3) **Closures** giá»¯ reference Ä‘áº¿n biáº¿n lá»›n dÃ¹ khÃ´ng dÃ¹ng. 4) **Detached DOM nodes** (removeChild nhÆ°ng variable cÃ²n reference â†’ node sá»‘ng trong memory). Fix: strict mode, clear timers, nullify refs, WeakMap/WeakSet.

**61. WeakMap/WeakSet giÃºp gÃ¬ cho memory management?**

> WeakMap/WeakSet giá»¯ references **yáº¿u** (weak) Ä‘áº¿n keys â€” khi key object khÃ´ng cÃ²n reference nÃ o khÃ¡c â†’ GC **tá»± Ä‘á»™ng xÃ³a** cáº£ key láº«n value. DÃ¹ng cho: caching (auto-evict), thÃªm metadata cho objects mÃ  khÃ´ng ngÄƒn GC, lÆ°u private data. âš ï¸ Keys pháº£i lÃ  objects, khÃ´ng iterate Ä‘Æ°á»£c.

**62. Dot notation khÃ¡c square brackets notation tháº¿ nÃ o?**

> **Dot** (`obj.prop`) yÃªu cáº§u key lÃ  **valid identifier** (khÃ´ng space, khÃ´ng báº¯t Ä‘áº§u sá»‘, khÃ´ng kÃ½ tá»± Ä‘áº·c biá»‡t). **Brackets** (`obj["prop"]`) nháº­n **any string** vÃ  cho phÃ©p dÃ¹ng **biáº¿n** (`obj[key]`). âš ï¸ `obj.key` tÃ¬m property tÃªn "key" chá»© KHÃ”NG dÃ¹ng giÃ¡ trá»‹ biáº¿n `key`.

**63. Property ordering trong object nhÆ° tháº¿ nÃ o?**

> **Integer properties** (string convert â†” integer khÃ´ng Ä‘á»•i, vÃ­ dá»¥ "49") Ä‘Æ°á»£c **sorted ascending**. **Non-integer properties** giá»¯ **creation order**. Trick: thÃªm "+" prefix (`"+49"`) biáº¿n integer thÃ nh non-integer â†’ giá»¯ thá»© tá»± táº¡o.

**64. Khi nÃ o dÃ¹ng "in" operator thay vÃ¬ === undefined?**

> Khi property **tá»“n táº¡i** nhÆ°ng value lÃ  **undefined**: `obj.test === undefined` tráº£ `true` (tÆ°á»Ÿng khÃ´ng cÃ³) nhÆ°ng `"test" in obj` tráº£ `true` (Ä‘Ãºng: cÃ³ tá»“n táº¡i). DÃ¹ hiáº¿m gáº·p (thÆ°á»ng dÃ¹ng `null`), `in` luÃ´n chÃ­nh xÃ¡c trong má»i trÆ°á»ng há»£p.

**65. Computed properties lÃ  gÃ¬?**

> DÃ¹ng **square brackets trong object literal** `{ [expr]: val }` Ä‘á»ƒ láº¥y property name tá»« **biá»ƒu thá»©c/biáº¿n** lÃºc runtime. VÃ­ dá»¥: `let fruit = "apple"; { [fruit]: 5 }` â†’ `{ apple: 5 }`. CÃ³ thá»ƒ dÃ¹ng biá»ƒu thá»©c phá»©c táº¡p: `{ [fruit + "Juice"]: 10 }`.

**66. Object Ä‘Æ°á»£c copy "by reference" nghÄ©a lÃ  sao?**

> Biáº¿n object lÆ°u **Ä‘á»‹a chá»‰** (reference) chá»© khÃ´ng lÆ°u object. Copy biáº¿n = copy **Ä‘á»‹a chá»‰** â†’ 2 biáº¿n cÃ¹ng trá» 1 object. Sá»­a qua biáº¿n nÃ y â†’ biáº¿n kia tháº¥y ngay. KhÃ¡c primitive: copy by value â†’ 2 báº£n Ä‘á»™c láº­p.

**67. Táº¡i sao `const obj = {}` váº«n sá»­a properties Ä‘Æ°á»£c?**

> `const` giá»¯ **reference cá»‘ Ä‘á»‹nh** â€” khÃ´ng thá»ƒ `obj = ...` (gÃ¡n láº¡i). NhÆ°ng **properties bÃªn trong** tá»± do thay Ä‘á»•i vÃ¬ `const` khÃ´ng freeze object. Muá»‘n freeze â†’ dÃ¹ng `Object.freeze(obj)` (shallow freeze).

**68. Shallow clone khÃ¡c deep clone tháº¿ nÃ o?**

> **Shallow** (`Object.assign`, `{...obj}`) chá»‰ copy **level 1** â€” nested objects váº«n **chia sáº» reference**. **Deep** (`structuredClone`) clone **táº¥t cáº£ levels** â†’ hoÃ n toÃ n Ä‘á»™c láº­p. âš ï¸ `structuredClone` há»— trá»£ circular refs nhÆ°ng KHÃ”NG há»— trá»£ function properties.

**69. 2 objects giá»‘ng ná»™i dung nhÆ°ng `{} == {}` lÃ  false, táº¡i sao?**

> Objects so sÃ¡nh báº±ng **reference** (address), KHÃ”NG so sÃ¡nh content. `{}` vÃ  `{}` lÃ  2 objects khÃ¡c nhau trong memory â†’ khÃ¡c reference â†’ `false`. Chá»‰ `a == b` khi `a` vÃ  `b` cÃ¹ng trá» Ä‘áº¿n **1 object duy nháº¥t** (vÃ­ dá»¥: `let b = a`).

**70. "this" trong JavaScript hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> `this` Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh lÃºc **call-time**, khÃ´ng pháº£i lÃºc khai bÃ¡o. Khi gá»i `obj.method()` â†’ `this = obj` (object trÆ°á»›c dáº¥u cháº¥m). CÃ¹ng 1 function cÃ³ thá»ƒ cÃ³ `this` khÃ¡c nhau tÃ¹y object gá»i. Gá»i khÃ´ng cÃ³ object â†’ `this = undefined` (strict) hoáº·c `window` (non-strict).

**71. Arrow function khÃ¡c regular function vá» "this" nhÆ° tháº¿ nÃ o?**

> Arrow function **KHÃ”NG cÃ³ this riÃªng** â€” láº¥y `this` tá»« **outer function** (lexical this). Há»¯u Ã­ch trong callbacks/methods khi muá»‘n giá»¯ `this` cá»§a method cha. Regular function trong cÃ¹ng vá»‹ trÃ­ sáº½ cÃ³ `this = undefined` (strict).

**72. Táº¡i sao nÃªn dÃ¹ng `this` thay vÃ¬ tÃªn biáº¿n trong method?**

> Náº¿u dÃ¹ng tÃªn biáº¿n (`user.name`) vÃ  sau Ä‘Ã³ biáº¿n bá»‹ overwrite (`user = null`) â†’ **TypeError**. DÃ¹ng `this.name` luÃ´n trá» Ä‘áº¿n object Ä‘ang gá»i method, khÃ´ng phá»¥ thuá»™c vÃ o tÃªn biáº¿n â†’ an toÃ n vÃ  reusable hÆ¡n.

**73. Method chaining pattern hoáº¡t Ä‘á»™ng ra sao?**

> Má»—i method **return this** â†’ cho phÃ©p gá»i liÃªn tiáº¿p: `obj.a().b().c()`. Ráº¥t phá»• biáº¿n trong JS libraries (jQuery, Lodash). VÃ­ dá»¥: `ladder.up().up().down().showStep()` â€” má»—i method sá»­a state vÃ  return object láº¡i cho method tiáº¿p theo.

**74. Constructor function lÃ  gÃ¬ vÃ  `new` hoáº¡t Ä‘á»™ng ra sao?**

> Constructor lÃ  **regular function** vá»›i 2 quy Æ°á»›c: tÃªn **Viáº¿t Hoa** vÃ  gá»i báº±ng `new`. Khi gá»i `new F()`: 1) táº¡o `this = {}` ngáº§m, 2) cháº¡y function body (sá»­a this), 3) return this ngáº§m. Káº¿t quáº£: táº¡o nhiá»u objects cÃ¹ng "khuÃ´n" má»™t cÃ¡ch tÃ¡i sá»­ dá»¥ng.

**75. `return` trong constructor hoáº¡t Ä‘á»™ng khÃ¡c gÃ¬?**

> Return **object** â†’ tráº£ object Ä‘Ã³ (bá» this). Return **primitive** hoáº·c khÃ´ng return â†’ **bá» qua**, váº«n tráº£ this. Háº§u háº¿t constructors khÃ´ng cÃ³ return statement. Trick: 2 constructor return cÃ¹ng 1 object â†’ `new A() == new B()` = true.

**76. `new.target` dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Kiá»ƒm tra function Ä‘Æ°á»£c gá»i báº±ng `new` hay khÃ´ng. `new.target = undefined` (gá»i thÆ°á»ng), `= function` (gá»i báº±ng new). DÃ¹ng trong libraries: `if (!new.target) return new F(name)` â€” tá»± thÃªm new náº¿u quÃªn.

**77. Táº¡i sao khÃ´ng nÃªn Ä‘á»‹nh nghÄ©a methods trong constructor?**

> Má»—i `new F()` táº¡o **Má»šI function** cho má»—i method â†’ khÃ´ng hiá»‡u quáº£ vá» memory náº¿u táº¡o nhiá»u objects. Giáº£i phÃ¡p: dÃ¹ng **prototype** (methods chia sáº» 1 láº§n) hoáº·c **class** syntax (ES6+). Constructor chá»‰ nÃªn gÃ¡n properties.

**78. Optional chaining `?.` hoáº¡t Ä‘á»™ng ra sao?**

> Náº¿u pháº§n **trÆ°á»›c** `?.` lÃ  `null`/`undefined` â†’ **return undefined** ngay (short-circuit). 3 dáº¡ng: `obj?.prop`, `obj?.[expr]`, `obj.method?.()`. Chá»‰ áº£nh hÆ°á»Ÿng pháº§n trÆ°á»›c `?.`, khÃ´ng pháº£i sau.

**79. Short-circuiting cá»§a `?.` lÃ  gÃ¬?**

> Khi trÆ°á»›c `?.` lÃ  `null`/`undefined`, **toÃ n bá»™** Ä‘Ã¡nh giÃ¡ bÃªn pháº£i **dá»«ng láº¡i**. VÃ­ dá»¥: `user?.sayHi(x++)` â€” náº¿u `user = null` thÃ¬ `sayHi` khÃ´ng gá»i vÃ  `x++` khÃ´ng thá»±c thi.

**80. Táº¡i sao khÃ´ng nÃªn láº¡m dá»¥ng `?.`?**

> Láº¡m dá»¥ng `?.` **che giáº¥u programming errors**. Náº¿u `user` Báº®T BUá»˜C tá»“n táº¡i, dÃ¹ng `user.address?.street` (khÃ´ng `user?.`). Náº¿u `user = undefined` â†’ bÃ¡o lá»—i (phÃ¡t hiá»‡n bug) thay vÃ¬ im láº·ng tráº£ `undefined`.

**81. `?.` dÃ¹ng Ä‘Æ°á»£c vá»›i assignment khÃ´ng?**

> **KHÃ”NG** â€” `?.` chá»‰ dÃ¹ng cho **Ä‘á»c**, **gá»i method**, vÃ  **delete**. `user?.name = "John"` â†’ Error vÃ¬ Ä‘Ã¡nh giÃ¡ thÃ nh `undefined = "John"`. Muá»‘n gÃ¡n an toÃ n pháº£i kiá»ƒm tra `if (user) user.name = "John"`.

**82. Object chuyá»ƒn sang primitive nhÆ° tháº¿ nÃ o?**

> JS dÃ¹ng 3 **hints**: `"string"` (alert, key), `"number"` (+, -, >), `"default"` (binary +, ==). TÃ¬m method theo thá»© tá»±: 1) `Symbol.toPrimitive(hint)`, 2) `toString()/valueOf()` theo hint. Táº¥t cáº£ objects luÃ´n `true` trong boolean context.

**83. `Symbol.toPrimitive` khÃ¡c `toString/valueOf` tháº¿ nÃ o?**

> `Symbol.toPrimitive` lÃ  cÃ¡ch **hiá»‡n Ä‘áº¡i**: 1 method xá»­ lÃ½ **táº¥t cáº£** hints, **Báº®T BUá»˜C** return primitive (return object â†’ TypeError). `toString/valueOf` lÃ  cÃ¡ch **cÅ©**: return object chá»‰ bá»‹ **bá» qua** (khÃ´ng error, historical). Náº¿u cÃ³ `Symbol.toPrimitive` â†’ khÃ´ng gá»i `toString/valueOf`.

**84. Táº¡i sao `toString()` lÃ  "catch-all" cho conversions?**

> Khi khÃ´ng cÃ³ `Symbol.toPrimitive` vÃ  `valueOf` (hoáº·c valueOf return object) â†’ `toString()` xá»­ lÃ½ **táº¥t cáº£** hints. ThÆ°á»ng chá»‰ cáº§n implement `toString()` cho logging/debugging. VÃ­ dá»¥: `alert(user)` vÃ  `user + 500` Ä‘á»u dÃ¹ng `toString`.

**85. "Further conversion" lÃ  gÃ¬?**

> Conversion 2 giai Ä‘oáº¡n: 1) Object â†’ primitive (vÃ­ dá»¥ string `"2"`), 2) Primitive â†’ kiá»ƒu cáº§n thiáº¿t (`"2" * 2 â†’ 4`). Method conversion **khÃ´ng cáº§n** return Ä‘Ãºng "hinted" type â€” chá»‰ cáº§n return **primitive báº¥t ká»³**.

**86. Primitives gá»i methods Ä‘Æ°á»£c báº±ng cÃ¡ch nÃ o?**

> JS táº¡o **wrapper object táº¡m** (String, Number, Boolean, Symbol, BigInt) khi primitive gá»i method. Gá»i method trÃªn wrapper â†’ tráº£ káº¿t quáº£ â†’ **há»§y wrapper** ngay. Engine tá»‘i Æ°u cÃ³ thá»ƒ skip táº¡o wrapper tháº­t sá»±, nhÆ°ng behavior giá»¯ nguyÃªn.

**87. Táº¡i sao `new Number(0)` nguy hiá»ƒm?**

> `new Number(0)` táº¡o **object** (typeof = "object"), luÃ´n **truthy** trong boolean context. `if (new Number(0))` â†’ true! DÃ¹ng `Number("123")` (khÃ´ng `new`) Ä‘á»ƒ convert sang **primitive** an toÃ n.

**88. `str.test = 5` rá»“i `alert(str.test)` ra gÃ¬?**

> **Strict mode**: TypeError (khÃ´ng gÃ¡n Ä‘Æ°á»£c). **Non-strict**: `undefined` â€” gÃ¡n vÃ o wrapper táº¡m, wrapper bá»‹ há»§y ngay, láº§n sau táº¡o wrapper má»›i khÃ´ng cÃ³ `.test`. Káº¿t luáº­n: primitives **KHÃ”NG** lÆ°u thÃªm properties.

**89. `null` vÃ  `undefined` cÃ³ methods khÃ´ng?**

> **KHÃ”NG** â€” lÃ  2 giÃ¡ trá»‹ "most primitive", khÃ´ng cÃ³ wrapper object. Truy cáº­p property (`null.test`) â†’ **TypeError**. KhÃ¡c vá»›i string/number/boolean luÃ´n cÃ³ wrapper táº¡m khi cáº§n.

**90. Táº¡i sao `0.1 + 0.2 !== 0.3`?**

> Sá»‘ Ä‘Æ°á»£c lÆ°u dáº¡ng **IEEE-754 64-bit**. 0.1 vÃ  0.2 lÃ  **endless binary fractions** â†’ lÆ°u vá»›i precision loss. Khi cá»™ng: 0.1 + 0.2 = 0.30000000000000004. Fix: `+sum.toFixed(2)` hoáº·c nhÃ¢n lÃªn integers rá»“i chia láº¡i.

**91. `isNaN` khÃ¡c `Number.isNaN` tháº¿ nÃ o?**

> `isNaN(value)` **convert** sang number rá»“i test: `isNaN("str")` = true. `Number.isNaN(value)` **khÃ´ng convert**: `Number.isNaN("str")` = false (vÃ¬ "str" lÃ  string, khÃ´ng pháº£i number NaN). `Number.isNaN` chá»‰ true khi value **vá»«a lÃ  number vá»«a lÃ  NaN**.

**92. `parseInt` khÃ¡c `Number()` tháº¿ nÃ o?**

> `parseInt("100px")` = 100 â€” Ä‘á»c sá»‘ cho Ä‘áº¿n kÃ½ tá»± khÃ´ng há»£p lá»‡ ("soft"). `Number("100px")` = NaN â€” **strict**, toÃ n bá»™ string pháº£i lÃ  sá»‘. `parseInt` cÃ³ tham sá»‘ `radix`: `parseInt("ff", 16)` = 255.

**93. `toFixed` cÃ³ Ä‘iá»ƒm gÃ¬ cáº§n lÆ°u Ã½?**

> 1. Tráº£ **STRING** (khÃ´ng pháº£i number) â†’ dÃ¹ng `+` Ä‘á»ƒ convert. 2) `6.35.toFixed(1)` = "6.3" (khÃ´ng pháº£i 6.4!) vÃ¬ 6.35 trong binary lÃ  6.3499... Fix: `Math.round(6.35 * 10) / 10` = 6.4.

**94. Táº¡i sao `Math.round` cho random integer khÃ´ng Ä‘á»u?**

> `Math.round` cho **xÃ¡c suáº¥t biÃªn tháº¥p hÆ¡n 2 láº§n**: values 1â€“1.4999 â†’ 1 (50%), 1.5â€“2.4999 â†’ 2 (100%), 2.5â€“2.999 â†’ 3 (50%). Fix: dÃ¹ng `Math.floor(min + Math.random() * (max + 1 - min))` cho **uniform distribution**.

**95. `Object.is` khÃ¡c `===` tháº¿ nÃ o?**

> 2 khÃ¡c biá»‡t: `Object.is(NaN, NaN)` = **true** (=== false), `Object.is(0, -0)` = **false** (=== true). DÃ¹ng trong JS spec internal (SameValue algorithm). CÃ²n láº¡i giá»‘ng `===` hoÃ n toÃ n.

**96. Strings trong JS encoded báº±ng gÃ¬? CÃ³ immutable khÃ´ng?**

> LuÃ´n **UTF-16**, khÃ´ng phá»¥ thuá»™c page encoding. Strings lÃ  **immutable** â€” khÃ´ng thá»ƒ thay Ä‘á»•i tá»«ng kÃ½ tá»±, chá»‰ cÃ³ thá»ƒ táº¡o string má»›i. `str[0] = 'h'` khÃ´ng cÃ³ effect (strict mode â†’ error).

**97. `str.length` lÃ  property hay function?**

> LÃ  **property** (khÃ´ng cÃ³ `()`). `str.length()` â†’ TypeError. LÆ°u Ã½: `"My\n".length` = 3 vÃ¬ `\n` lÃ  **1 kÃ½ tá»±**. `str.at(-1)` tráº£ kÃ½ tá»± cuá»‘i, `str[-1]` tráº£ `undefined`.

**98. `indexOf` cÃ³ gotcha gÃ¬ khi dÃ¹ng trong `if`?**

> `indexOf` tráº£ **0** khi tÃ¬m tháº¥y á»Ÿ Ä‘áº§u string, mÃ  0 lÃ  **falsy**! `if (str.indexOf("Widget"))` khÃ´ng cháº¡y dÃ¹ tÃ¬m tháº¥y. Pháº£i dÃ¹ng `if (str.indexOf("Widget") !== -1)`. Hoáº·c dÃ¹ng `includes()` tráº£ `true/false` trá»±c tiáº¿p.

**99. `slice` khÃ¡c `substring` khÃ¡c `substr` tháº¿ nÃ o?**

> `slice(start, end)`: há»— trá»£ negative, tráº£ "" náº¿u start > end. `substring(start, end)`: **swap** náº¿u start > end, negative = 0. `substr(start, len)`: láº¥y theo **length** â€” **deprecated** (Annex B). **Chá»‰ cáº§n nhá»› `slice`** lÃ  Ä‘á»§.

**100. Táº¡i sao `'a' > 'Z'` lÃ  true?**

> Strings so sÃ¡nh theo **character code** (UTF-16). `'a'` = 97, `'Z'` = 90 â†’ 97 > 90 = true. Lowercase luÃ´n lá»›n hÆ¡n uppercase. Äá»ƒ so sÃ¡nh Ä‘Ãºng theo ngÃ´n ngá»¯, dÃ¹ng `localeCompare()` (ECMA-402 i18n standard).

**101. LÃ m sao truncate string cÃ³ ellipsis Ä‘Ãºng cÃ¡ch?**

> DÃ¹ng kÃ½ tá»± Unicode `"â€¦"` (1 character, khÃ´ng pháº£i 3 dáº¥u cháº¥m). Function: `str.length > max ? str.slice(0, max - 1) + "â€¦" : str`. LÆ°u Ã½: cáº¯t `max - 1` kÃ½ tá»± vÃ¬ `"â€¦"` chiáº¿m 1 vá»‹ trÃ­.

**102. Array lÃ  object hay kiá»ƒu riÃªng?**

> Array lÃ  **object Ä‘áº·c biá»‡t** cho ordered collection. Copy by **reference** (2 biáº¿n cÃ¹ng trá» 1 array). `typeof []` = "object". So sÃ¡nh `[] == []` = **false** (2 objects khÃ¡c nhau). Engine tá»‘i Æ°u cho **contiguous ordered data** â€” misuse (add string keys, táº¡o holes) sáº½ **táº¯t optimizations**.

**103. Táº¡i sao `push/pop` nhanh hÆ¡n `shift/unshift`?**

> `push/pop` thao tÃ¡c á»Ÿ **cuá»‘i** array â†’ O(1), khÃ´ng cáº§n dá»‹ch elements. `shift/unshift` thao tÃ¡c á»Ÿ **Ä‘áº§u** â†’ O(n), pháº£i **dá»‹ch táº¥t cáº£ elements** sang trÃ¡i/pháº£i vÃ  **renumber indexes**. CÃ ng nhiá»u elements cÃ ng cháº­m.

**104. Táº¡i sao khÃ´ng dÃ¹ng `for..in` cho arrays?**

> 3 lÃ½ do: 1) Láº·p **táº¥t cáº£ properties** (ká»ƒ cáº£ non-numeric). 2) Tá»‘i Æ°u cho **generic objects**, cháº­m 10-100x so vá»›i for/for..of. 3) Array-like objects cÃ³ thÃªm properties láº¡. DÃ¹ng `for(i)` hoáº·c `for..of` thay tháº¿.

**105. `arr.length` lÃ  gÃ¬ chÃ­nh xÃ¡c?**

> KhÃ´ng pháº£i sá»‘ lÆ°á»£ng elements mÃ  lÃ  **greatest numeric index + 1**. VÃ­ dá»¥: `arr[123] = 1` â†’ `arr.length = 124`. **Writable**: giáº£m length sáº½ **truncate** (khÃ´ng khÃ´i phá»¥c). `arr.length = 0` lÃ  cÃ¡ch nhanh nháº¥t **xÃ³a sáº¡ch** array.

**106. `new Array(2)` tráº£ gÃ¬?**

> Tráº£ array vá»›i **length=2 nhÆ°ng khÃ´ng cÃ³ elements** (`[empty Ã— 2]`), KHÃ”NG pháº£i `[2]`. `arr[0]` = undefined. ÄÃ¢y lÃ  gotcha cá»§a `new Array` vá»›i single number argument. LuÃ´n dÃ¹ng `[]` Ä‘á»ƒ trÃ¡nh báº«y.

**107. `0 == []` lÃ  true, giáº£i thÃ­ch?**

> `[]` convert to primitive qua `toString()` â†’ `""`. Sau Ä‘Ã³ `0 == ""` â†’ `""` convert to number = 0 â†’ `0 == 0` = **true**. TÆ°Æ¡ng tá»±: `[1] + 1` = `"1" + 1` = `"11"`. **Äá»«ng so sÃ¡nh arrays vá»›i ==**, dÃ¹ng loop item-by-item.

**108. `splice` khÃ¡c `slice` tháº¿ nÃ o?**

> `splice(pos, del, ...items)` **MUTATE** array gá»‘c: xÃ³a `del` elements tá»« `pos`, chÃ¨n `items` vÃ o. Tráº£ array Ä‘Ã£ xÃ³a. `slice(start, end)` **KHÃ”NG mutate**: tráº£ **new array** copy tá»« `start` Ä‘áº¿n `end`. `slice()` khÃ´ng args = **shallow copy**. Nhá»›: splice = **s**urgery (cáº¯t), slice = **s**napshot (chá»¥p).

**109. Táº¡i sao `sort()` khÃ´ng sort numbers Ä‘Ãºng?**

> Default comparison lÃ  **STRING**! `[1, 2, 15].sort()` â†’ `[1, 15, 2]` vÃ¬ `"15" < "2"` (lexicographic). Fix: `arr.sort((a, b) => a - b)`. Cho strings i18n: `arr.sort((a, b) => a.localeCompare(b))`. `sort()` **MUTATE** array gá»‘c!

**110. `includes` xá»­ lÃ½ NaN khÃ¡c `indexOf` tháº¿ nÃ o?**

> `[NaN].indexOf(NaN)` = **-1** (sai! vÃ¬ indexOf dÃ¹ng `===`, mÃ  `NaN !== NaN`). `[NaN].includes(NaN)` = **true** (Ä‘Ãºng! vÃ¬ includes dÃ¹ng SameValueZero algorithm). Náº¿u array cÃ³ thá»ƒ chá»©a NaN â†’ dÃ¹ng `includes`.

**111. `find` vs `filter` vs `findIndex`?**

> `find(fn)` â†’ tráº£ **first item** thá»a (hoáº·c undefined). `filter(fn)` â†’ tráº£ **array táº¥t cáº£ items** thá»a. `findIndex(fn)` â†’ tráº£ **index** (hoáº·c -1). `findLastIndex` â†’ tÃ¬m tá»« cuá»‘i. Common pattern: `users.find(u => u.id === 1)`.

**112. `reduce` hoáº¡t Ä‘á»™ng tháº¿ nÃ o? Báº«y nÃ o?**

> `reduce((acc, cur) => ..., initial)`: accumulate thÃ nh **1 giÃ¡ trá»‹**. Náº¿u **khÃ´ng** cÃ³ `initial` + array **rá»—ng** â†’ **TypeError**! LuÃ´n cung cáº¥p initial value. VÃ­ dá»¥: `[1,2,3].reduce((s,c) => s+c, 0)` = 6. `reduceRight` cháº¡y tá»« pháº£i sang trÃ¡i.

**113. CÃ¡ch shuffle array Ä‘á»u (uniform)?**

> `arr.sort(() => Math.random() - 0.5)` **KHÃ”NG** uniform â€” xÃ¡c suáº¥t lá»‡ch do sorting algorithm. DÃ¹ng **Fisher-Yates**: duyá»‡t ngÆ°á»£c, swap má»—i element vá»›i random element trÆ°á»›c nÃ³. `for(i=n-1; i>0; i--) { j=random(0..i); swap(arr[i], arr[j]) }`. O(n), uniform distribution.

**114. Iterable lÃ  gÃ¬? CÃ¡ch táº¡o object iterable?**

> Iterable = object cÃ³ method `[Symbol.iterator]()` tráº£ vá» **iterator** (object cÃ³ `next()`). `next()` tráº£ `{ done: bool, value: any }`. Khi `done: true` â†’ dá»«ng. `for..of` gá»i `Symbol.iterator` tá»± Ä‘á»™ng. Built-in iterables: **String, Array, Map, Set**.

**115. Iterable khÃ¡c Array-like tháº¿ nÃ o?**

> **Iterable**: cÃ³ `Symbol.iterator` â†’ `for..of` works. **Array-like**: cÃ³ `indexes` (0, 1â€¦) + `length` â†’ KHÃ”NG cÃ³ `Symbol.iterator` (trá»« khi tá»± thÃªm). **String** = cáº£ hai. Cáº£ hai Ä‘á»u **khÃ´ng cÃ³** push/pop/map â†’ cáº§n `Array.from()` Ä‘á»ƒ chuyá»ƒn thÃ nh Array tháº­t.

**116. Táº¡i sao string iterator xá»­ lÃ½ surrogate pairs Ä‘Ãºng?**

> String iterator trong JavaScript nháº­n biáº¿t **surrogate pairs** (emoji, kÃ½ tá»± Unicode > U+FFFF). `for..of "ğŸ˜‚"` â†’ 1 character (Ä‘Ãºng), nhÆ°ng `"ğŸ˜‚".length` = 2 (Ä‘áº¿m code units). `Array.from(str)` cÅ©ng dÃ¹ng iterator nÃªn xá»­ lÃ½ Ä‘Ãºng, khÃ¡c `str.split("")` cÃ³ thá»ƒ tÃ¡ch sai surrogate.

**117. `Array.from` dÃ¹ng khi nÃ o?**

> Chuyá»ƒn **iterable** hoáº·c **array-like** thÃ nh **Array tháº­t** Ä‘á»ƒ dÃ¹ng array methods (push, pop, mapâ€¦). Há»— trá»£ `mapFn`: `Array.from(range, n => n*n)`. Xá»­ lÃ½ surrogate Ä‘Ãºng cho strings. Pattern: `Array.from({length: 5}, (_, i) => i)` â†’ `[0,1,2,3,4]`.

**118. Object merged iterator cÃ³ váº¥n Ä‘á» gÃ¬?**

> Khi `[Symbol.iterator]()` tráº£ **chÃ­nh object** (`return this`), object vá»«a lÃ  iterable vá»«a lÃ  iterator â†’ code ngáº¯n hÆ¡n. NhÆ°ng **2 for..of cÃ¹ng lÃºc** sáº½ **chia sáº» state** (cÃ¹ng `this.current`) â†’ bug. Giáº£i phÃ¡p: tráº£ **iterator object má»›i** má»—i láº§n gá»i `Symbol.iterator`.

**119. Map khÃ¡c Object á»Ÿ Ä‘iá»ƒm nÃ o quan trá»ng nháº¥t?**

> Map cho phÃ©p **keys Báº¤T Ká»² type** (objects, NaN, functionsâ€¦) â€” Object chá»‰ String/Symbol. Map dÃ¹ng **SameValueZero** (NaN === NaN). `.size` O(1) thay vÃ¬ `Object.keys().length`. Directly iterable. KhÃ´ng bá»‹ **prototype pollution**. Tuy nhiÃªn Object há»— trá»£ **JSON native** vÃ  syntax `obj.key` tiá»‡n hÆ¡n.

**120. Táº¡i sao `map[key]` sai?**

> `map[key]` treats Map nhÆ° **plain object** â†’ chá»‰ string/symbol keys, máº¥t táº¥t cáº£ optimizations cá»§a Map. Pháº£i dÃ¹ng `map.set(key, value)` vÃ  `map.get(key)`. VÃ­ dá»¥: `map[1]` vÃ  `map["1"]` cÃ¹ng key trong object, nhÆ°ng **khÃ¡c** trong Map.

**121. Object.entries vÃ  Object.fromEntries dÃ¹ng tháº¿ nÃ o?**

> `Object.entries(obj)` â†’ `[[key, value], ...]` (array of pairs) â†’ dÃ¹ng `new Map(Object.entries(obj))` táº¡o Map tá»« Object. NgÆ°á»£c láº¡i: `Object.fromEntries(map)` táº¡o Object tá»« Map. Map lÃ  iterable nÃªn khÃ´ng cáº§n `.entries()` explicit: `Object.fromEntries(map)` OK.

**122. Set khÃ¡c Array tháº¿ nÃ o cho uniqueness?**

> Set dÃ¹ng **O(1) hash-based lookup** cho `has/add/delete`. Array dÃ¹ng `includes/find` = **O(n)** linear scan. Set **tá»± loáº¡i trÃ¹ng**: `set.add(x)` nhiá»u láº§n chá»‰ lÆ°u 1. Unique array: `[...new Set(arr)]` hoáº·c `Array.from(new Set(arr))`. Performance gap lá»›n khi n > 1000.

**123. Táº¡i sao forEach cá»§a Set cÃ³ 2 láº§n value?**

> `set.forEach((value, valueAgain, set))` â€” `valueAgain === value`. Thiáº¿t káº¿ Ä‘á»ƒ **tÆ°Æ¡ng thÃ­ch vá»›i Map** (Map cÃ³ `(value, key, map)`). GiÃºp dá»… dÃ ng **replace Map báº±ng Set** vÃ  ngÆ°á»£c láº¡i trong code.

**124. `map.keys()` tráº£ gÃ¬? Táº¡i sao `.push()` lá»—i?**

> `map.keys()` tráº£ **MapIterator** (iterable), KHÃ”NG pháº£i Array â†’ khÃ´ng cÃ³ `.push()`, `.map()`. Fix: `Array.from(map.keys())` hoáº·c `[...map.keys()]` chuyá»ƒn sang Array tháº­t. TÆ°Æ¡ng tá»± cho `.values()` vÃ  `.entries()`.

**125. WeakMap khÃ¡c Map tháº¿ nÃ o?**

> WeakMap chá»‰ cháº¥p nháº­n **objects lÃ m keys**. Khi key khÃ´ng cÃ²n referenced á»Ÿ chá»— nÃ o khÃ¡c â†’ **GC tá»± xÃ³a** entry. Chá»‰ cÃ³ **4 methods**: set/get/has/delete. KHÃ”NG cÃ³ size, keys, values, entries, clear, forEach. KHÃ”NG iterable. VÃ¬ **GC timing khÃ´ng xÃ¡c Ä‘á»‹nh** nÃªn engine khÃ´ng thá»ƒ cung cáº¥p size/iteration.

**126. WeakMap dÃ¹ng khi nÃ o?**

> **Additional data**: gáº¯n data vÃ o 3rd-party objects mÃ  khÃ´ng modify chÃºng (VD: visit count cho user objects). **Caching**: cache káº¿t quáº£ tÃ­nh toÃ¡n theo object key â€” object bá»‹ GC â†’ cache tá»± dá»n. **Private data**: lÆ°u private fields báº±ng WeakMap (pre-ES2022 pattern).

**127. WeakSet khÃ¡c Set tháº¿ nÃ o?**

> WeakSet chá»‰ cháº¥p nháº­n **objects**. Object bá»‹ GC â†’ tá»± xÃ³a khá»i set. Chá»‰ cÃ³ **3 methods**: add/has/delete. KHÃ”NG cÃ³ size, iteration. DÃ¹ng cho **boolean flags**: "message Ä‘Ã£ Ä‘á»c?", "user Ä‘Ã£ visit?". KhÃ´ng cáº§n tá»± dá»n khi object khÃ´ng cÃ²n dÃ¹ng.

**128. Táº¡i sao WeakMap/WeakSet khÃ´ng cÃ³ size vÃ  iteration?**

> VÃ¬ **GC timing khÃ´ng xÃ¡c Ä‘á»‹nh**: engine cÃ³ thá»ƒ dá»n ngay hoáº·c chá». Táº¡i má»™t thá»i Ä‘iá»ƒm, khÃ´ng biáº¿t chÃ­nh xÃ¡c cÃ²n bao nhiÃªu entries. Náº¿u cÃ³ `.size` â†’ káº¿t quáº£ cÃ³ thá»ƒ sai vÃ¬ GC chÆ°a cháº¡y. Náº¿u cÃ³ iteration â†’ cÃ³ thá»ƒ tháº¥y objects Ä‘ang bá»‹ GC = **undefined behavior**.

**129. LÆ°u "unread" flags cho messages nÃªn dÃ¹ng gÃ¬?**

> DÃ¹ng **WeakSet**: `readMessages.add(msg)` = Ä‘Ã£ Ä‘á»c, `readMessages.has(msg)` = check. Khi message bá»‹ xÃ³a khá»i array â†’ GC â†’ tá»± xÃ³a khá»i WeakSet. Náº¿u cáº§n lÆ°u **date** Ä‘á»c â†’ dÃ¹ng **WeakMap**: `readMap.set(msg, new Date())`. KhÃ´ng modify message objects!

**130. Array destructuring hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> `let [a, b] = arr` gÃ¡n `arr[0]` cho `a`, `arr[1]` cho `b`. Internal: dÃ¹ng **iterator** (for..of) â†’ hoáº¡t Ä‘á»™ng vá»›i **má»i iterable** (string, Set, Map). Array gá»‘c **khÃ´ng bá»‹ modify**. Bá» qua báº±ng comma: `[a, , c]`. Rest: `[a, ...rest]`. Default: `[a = 1]`.

**131. Swap variables khÃ´ng dÃ¹ng temp?**

> `[a, b] = [b, a]` â€” táº¡o temporary array `[b, a]` rá»“i destructure ngÆ°á»£c láº¡i. CÃ³ thá»ƒ swap **nhiá»u hÆ¡n 2** variables: `[a, b, c] = [c, a, b]`.

**132. Object destructuring khÃ¡c array destructuring tháº¿ nÃ o?**

> **Array**: theo **thá»© tá»±** (position). **Object**: theo **tÃªn property** (thá»© tá»± khÃ´ng quan trá»ng). Object há»— trá»£ **rename** `{width: w}` vÃ  káº¿t há»£p `{width: w = 100}`. Cáº£ hai Ä‘á»u cÃ³ ...rest vÃ  defaults.

**133. Gotcha `{x} = obj` khÃ´ng cÃ³ `let`?**

> JS hiá»ƒu `{...}` á»Ÿ Ä‘áº§u statement lÃ  **code block** â†’ SyntaxError. Fix: bá»c trong `()`: `({x, y} = obj)`. Vá»›i `let` khÃ´ng cÃ³ váº¥n Ä‘á» vÃ¬ `let {x} = obj` khÃ´ng báº¯t Ä‘áº§u báº±ng `{`.

**134. Nested destructuring lÃ  gÃ¬?**

> TrÃ­ch giÃ¡ trá»‹ tá»« **objects/arrays lá»“ng nhau**: `let { size: { width } } = options`. Pattern bÃªn trÃ¡i pháº£i **cÃ¹ng cáº¥u trÃºc** vá»›i bÃªn pháº£i. LÆ°u Ã½: `size` KHÃ”NG trá»Ÿ thÃ nh variable (chá»‰ lÃ  Ä‘Æ°á»ng dáº«n).

**135. Smart function parameters lÃ  gÃ¬?**

> DÃ¹ng destructuring trong **params**: `function({title="", width=100} = {})`. Lá»£i Ã­ch: khÃ´ng cáº§n nhá»› **thá»© tá»±**, chá»‰ truyá»n props cáº§n. `= {}` á»Ÿ cuá»‘i Ä‘á»ƒ gá»i `fn()` khÃ´ng args khÃ´ng lá»—i (khÃ´ng cÃ³ â†’ destructure `undefined` â†’ TypeError).

**136. new Date() cÃ³ máº¥y cÃ¡ch táº¡o? Gotcha lÃ  gÃ¬?**

> **4 cÃ¡ch**: `new Date()` (hiá»‡n táº¡i), `new Date(ms)` (timestamp), `new Date(string)` (parse ISO), `new Date(y,m,d,h,min,s,ms)` (components). Gotcha: **month báº¯t Ä‘áº§u tá»« 0** (Jan=0, Dec=11). `getDay()` cÅ©ng tá»« 0 (Sunday=0).

**137. Autocorrection cá»§a Date lÃ  gÃ¬?**

> Date tá»± Ä‘iá»u chá»‰nh khi gÃ¡n **out-of-range**: `new Date(2013,0,32)` â†’ **1 Feb**. `setDate(0)` = ngÃ y cuá»‘i thÃ¡ng trÆ°á»›c. `date.setDate(date.getDate()+2)` tá»± xá»­ lÃ½ **leap year** vÃ  overflow thÃ¡ng. Ráº¥t tiá»‡n cho cá»™ng/trá»« ngÃ y.

**138. Date.now() khÃ¡c new Date() tháº¿ nÃ o?**

> `Date.now()` tráº£ **timestamp** (number) trá»±c tiáº¿p, KHÃ”NG táº¡o Date object â†’ **nhanh hÆ¡n**, khÃ´ng GC pressure. `new Date()` táº¡o object Ä‘áº§y Ä‘á»§. DÃ¹ng `Date.now()` khi chá»‰ cáº§n **Ä‘o thá»i gian** (start/end diff).

**139. Date.parse dÃ¹ng format gÃ¬?**

> ISO 8601: `"YYYY-MM-DDTHH:mm:ss.sssZ"`. T lÃ  delimiter. Z = timezone (`+-hh:mm` hoáº·c `Z` = UTC). Shorter OK: `"YYYY-MM-DD"`, `"YYYY-MM"`, `"YYYY"`. Invalid â†’ **NaN**. Káº¿t quáº£: **timestamp** (ms), dÃ¹ng `new Date(Date.parse(str))` táº¡o Date.

**140. LÃ m sao láº¥y ngÃ y cuá»‘i cá»§a thÃ¡ng?**

> `new Date(year, month + 1, 0).getDate()`. Day 0 = ngÃ y cuá»‘i thÃ¡ng trÆ°á»›c (autocorrection). VD: `getLastDayOfMonth(2012, 1)` = **29** (Feb leap year).

**141. Benchmark function Ä‘Ãºng cÃ¡ch?**

> 1. Cháº¡y **nhiá»u láº§n** (100K+). 2) **Xen káº½** (alternate) 2 functions Ä‘á»ƒ trÃ¡nh CPU bias. 3) **Warm-up** trÆ°á»›c (JIT optimization). 4) DÃ¹ng `Date.now()` hoáº·c `performance.now()`. 5) `getTime()` nhanh hÆ¡n `date2 - date1` (khÃ´ng type conversion).

**142. JSON.stringify bá» qua nhá»¯ng gÃ¬?**

> Bá» qua **3 thá»©**: **functions** (methods), **Symbol** keys/values, vÃ  properties cÃ³ giÃ¡ trá»‹ **undefined**. Há»— trá»£: objects, arrays, strings, numbers, booleans, null. **Circular reference** â†’ Error.

**143. Replacer trong JSON.stringify dÃ¹ng tháº¿ nÃ o?**

> **Array**: `JSON.stringify(obj, ["title","name"])` â€” whitelist props (Ã¡p dá»¥ng toÃ n bá»™ cÃ¢y). **Function**: `fn(key, value)` â€” return value Ä‘á»ƒ giá»¯, `undefined` Ä‘á»ƒ bá». Láº§n gá»i Ä‘áº§u `key=""` (wrapper `{"":obj}`). ÄÆ°á»£c gá»i **recursive** cho má»i nested.

**144. toJSON lÃ  gÃ¬? Date cÃ³ toJSON khÃ´ng?**

> Object cÃ³ method `toJSON()` â†’ JSON.stringify **tá»± gá»i** nÃ³ thay vÃ¬ serialize bÃ¬nh thÆ°á»ng. **Date** cÃ³ built-in `toJSON` tráº£ **ISO string** (`"2017-01-01T00:00:00.000Z"`). CÃ³ thá»ƒ tá»± define cho objects khÃ¡c.

**145. Reviver trong JSON.parse lÃ  gÃ¬? Khi nÃ o cáº§n?**

> `JSON.parse(str, fn(key, value))` â€” reviver transform values khi parse. Use case chÃ­nh: chuyá»ƒn date strings vá» **Date objects**: `if (key==="date") return new Date(value)`. ÄÆ°á»£c gá»i **recursive** cho má»i nested.

**146. Deep clone báº±ng JSON cÃ³ háº¡n cháº¿ gÃ¬?**

> `JSON.parse(JSON.stringify(obj))` táº¡o deep clone. NhÆ°ng **máº¥t**: functions, Symbol, undefined, Date (thÃ nh string), RegExp, Map/Set, circular refs â†’ Error. DÃ¹ng `structuredClone()` cho deep clone Ä‘áº§y Ä‘á»§ hÆ¡n.

**147. JSON format cÃ³ nhá»¯ng quy táº¯c gÃ¬?**

> Keys **pháº£i double-quoted** (`"name"`, khÃ´ng `name` hay `'name'`). Values string cÅ©ng **double-quoted**. KhÃ´ng há»— trá»£: **comments**, trailing commas, `new`, single quotes. JSON5 má»Ÿ rá»™ng cho phÃ©p nhÆ°ng lÃ  library riÃªng.

**148. Callback lÃ  gÃ¬? Táº¡i sao cáº§n?**

> Callback lÃ  **function truyá»n vÃ o function khÃ¡c** nhÆ° argument, Ä‘Æ°á»£c gá»i khi async action **hoÃ n thÃ nh**. Cáº§n vÃ¬ JS lÃ  **single-threaded**: khÃ´ng thá»ƒ chá» Ä‘á»£i, pháº£i "gá»i láº¡i" khi xong.

**149. Error-first callback convention lÃ  gÃ¬?**

> `callback(err, result)`: arg1 = **error** (null náº¿u thÃ nh cÃ´ng), arg2+ = **káº¿t quáº£**. Má»™t function xá»­ lÃ½ cáº£ success vÃ  error. ÄÃ¢y lÃ  convention cá»§a **Node.js** (fs.readFile, http.get...).

**150. Pyramid of Doom / Callback Hell lÃ  gÃ¬?**

> Khi nhiá»u async actions **tuáº§n tá»±** (sequential), callbacks lá»“ng nhau sÃ¢u dáº§n â†’ code hÃ¬nh **kim tá»± thÃ¡p**, khÃ³ Ä‘á»c, khÃ³ maintain, khÃ³ xá»­ lÃ½ error. Giáº£m thiá»‡u: tÃ¡ch named functions, nhÆ°ng váº«n khÃ³ follow.

**151. CÃ¡ch giáº£i quyáº¿t Callback Hell?**

> 1. **Promises**: chain `.then().then()` thay vÃ¬ nesting. 2) **async/await**: viáº¿t nhÆ° sync. 3) TÃ¡ch named functions (giáº£m thiá»‡u nhÆ°ng khÃ´ng triá»‡t Ä‘á»ƒ). Promises lÃ  giáº£i phÃ¡p chÃ­nh, async/await lÃ  syntax sugar cá»§a Promises.

**152. Sequential async vá»›i callbacks nhÆ° tháº¿ nÃ o?**

> Äáº·t async call tiáº¿p theo **trong callback** cá»§a call trÆ°á»›c: `loadScript('1.js', () => { loadScript('2.js', () => { ... }) })`. Má»—i action chá» action trÆ°á»›c hoÃ n thÃ nh. Vá»›i error-first: pháº£i check `if (err)` á»Ÿ **má»—i level**.

**153. Promise lÃ  gÃ¬? Táº¡i sao cáº§n?**

> Promise lÃ  **object Ä‘áº·c biá»‡t** liÃªn káº¿t "producing code" vÃ  "consuming code". Táº¡o báº±ng `new Promise((resolve, reject) => {...})`. **Executor** cháº¡y tá»± Ä‘á»™ng, gá»i `resolve(value)` khi thÃ nh cÃ´ng, `reject(error)` khi tháº¥t báº¡i. Giáº£i quyáº¿t Callback Hell báº±ng **natural order** vÃ  **chaining**.

**154. Promise cÃ³ máº¥y states? Chuyá»ƒn Ä‘á»•i tháº¿ nÃ o?**

> **3 states**: `pending` (ban Ä‘áº§u) â†’ `fulfilled` (khi resolve) hoáº·c `rejected` (khi reject). State change lÃ  **final** â€” chá»‰ 1 láº§n! resolve/reject tiáº¿p theo bá»‹ **ignore**. Promise Ä‘Ã£ settled (fulfilled/rejected) khÃ´ng Ä‘á»•i ná»¯a.

**155. .then, .catch, .finally khÃ¡c nhau tháº¿ nÃ o?**

> `.then(onOK, onErr)`: 2 callbacks cho success/error. `.catch(fn)` = `.then(null, fn)` â€” chá»‰ error. `.finally(fn)`: cháº¡y **luÃ´n** (settled), **khÃ´ng nháº­n args**, **pass-through** result/error, return bá»‹ ignore (trá»« throw).

**156. finally cÃ³ pass-through result khÃ´ng?**

> **CÃ³**. `finally` khÃ´ng nháº­n argument, return value bá»‹ ignore. Result/error "Ä‘i xuyÃªn qua" tá»›i handler tiáº¿p. **Ngoáº¡i lá»‡**: náº¿u finally **throw error** â†’ error Ä‘Ã³ Ä‘i tá»›i nearest error handler thay vÃ¬ result ban Ä‘áº§u.

**157. Promise vs Callback: Æ°u Ä‘iá»ƒm gÃ¬?**

> 1. **Natural order**: cháº¡y code â†’ `.then` viáº¿t sau. Callback pháº£i biáº¿t trÆ°á»›c. 2) **Multiple handlers**: `.then` nhiá»u láº§n trÃªn cÃ¹ng promise. Callback chá»‰ 1. 3) **Chaining**: `.then().then()` thay vÃ¬ nesting. 4) Handler trÃªn settled promise cháº¡y **ngay** (linh hoáº¡t hÆ¡n subscription).

**158. Resolve ngay láº­p tá»©c cÃ³ Ä‘Æ°á»£c khÃ´ng?**

> **CÃ³**. `new Promise(resolve => resolve(123))` â€” promise fulfilled **ngay**. Useful cho cached values. `.then` handler váº«n cháº¡y (asynchronously via microtask queue, nhÆ°ng ngay sau current code).

**159. Viáº¿t delay(ms) dÃ¹ng Promise?**

> `function delay(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }`. Gá»i: `delay(3000).then(() => ...)`. resolve **khÃ´ng argument** â€” chá»‰ cáº§n delay, khÃ´ng cáº§n giÃ¡ trá»‹.

**160. Promise chaining hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> `.then()` luÃ´n tráº£ vá» **new Promise**. Return value thÆ°á»ng â†’ promise resolved vá»›i value Ä‘Ã³. Return Promise â†’ chain **chá»** nÃ³ settle. Káº¿t quáº£ **truyá»n xuá»‘ng** handler tiáº¿p theo: `1 â†’ 2 â†’ 4`.

**161. Chaining khÃ¡c nhiá»u .then trÃªn 1 promise tháº¿ nÃ o?**

> **Chaining**: `.then().then()` â€” má»—i .then nháº­n result cá»§a .then **trÆ°á»›c** (truyá»n tiáº¿p). **Nhiá»u .then trÃªn 1 promise**: táº¥t cáº£ nháº­n **cÃ¹ng result gá»‘c**, xá»­ lÃ½ **Ä‘á»™c láº­p**. Lá»—i newbie thÆ°á»ng gáº·p!

**162. Thenable lÃ  gÃ¬?**

> Object cÃ³ method `.then(resolve, reject)` â€” JS coi nÃ³ nhÆ° Promise. Khi handler return thenable, JS gá»i `.then()` cá»§a nÃ³, chá» resolve/reject. Cho phÃ©p **3rd-party libraries** tÆ°Æ¡ng thÃ­ch promise chain mÃ  khÃ´ng káº¿ thá»«a Promise.

**163. fetch chaining trÃ´ng nhÆ° tháº¿ nÃ o?**

> `fetch(url)` â†’ `.then(r => r.json())` â†’ `.then(data => ...)`. Má»—i step return promise, chain chá» tá»«ng step. Code "Ä‘i xuá»‘ng" (flat), khÃ´ng pyramid. **Good practice**: async action luÃ´n return promise Ä‘á»ƒ extendable.

**164. .then(f1).catch(f2) vs .then(f1, f2)?**

> **KhÃ¡c**! `.then(f1).catch(f2)`: náº¿u f1 **throw** â†’ f2 **báº¯t** Ä‘Æ°á»£c (catch á»Ÿ step tiáº¿p). `.then(f1, f2)`: f1 throw â†’ f2 **khÃ´ng** báº¯t (Ä‘Æ°á»£c cÃ¹ng level, chá»‰ 1 cháº¡y). **â†’ .then().catch() an toÃ n hÆ¡n**.

**165. Táº¡i sao async action nÃªn luÃ´n return promise?**

> Äá»ƒ **chain extendable** â€” cÃ³ thá»ƒ `.then()` tiáº¿p sau. VÃ­ dá»¥: show avatar 3s rá»“i resolve â†’ `.then(user => alert("Done"))`. Náº¿u khÃ´ng return promise, khÃ´ng thá»ƒ biáº¿t khi nÃ o action xong.

**166. Implicit try..catch trong Promise lÃ  gÃ¬?**

> Executor vÃ  .then handlers cÃ³ **"invisible try..catch"**. Náº¿u **throw** error (hoáº·c programming error nhÆ° ReferenceError) â†’ tá»± Ä‘á»™ng chuyá»ƒn thÃ nh **rejected promise**. Giá»‘ng há»‡t gá»i `reject(error)`. .catch báº¯t Ä‘Æ°á»£c cáº£ throw vÃ  reject.

**167. .catch á»Ÿ cuá»‘i chain cÃ³ tÃ¡c dá»¥ng gÃ¬?**

> Báº¯t **má»i** error tá»« báº¥t ká»³ .then nÃ o trÆ°á»›c Ä‘Ã³. Reject, throw, programming errors Ä‘á»u bá»‹ catch. **KhÃ´ng cáº§n** Ä‘áº·t ngay sau â€” cÃ³ thá»ƒ sau nhiá»u .then.

**168. Rethrowing trong .catch lÃ  gÃ¬?**

> Náº¿u `.catch` **xá»­ lÃ½ xong** bÃ¬nh thÆ°á»ng â†’ tiáº¿p tá»¥c `.then` káº¿ tiáº¿p (recovery). Náº¿u `.catch` **throw láº¡i** â†’ nháº£y Ä‘áº¿n `.catch` tiáº¿p theo. DÃ¹ng `instanceof` Ä‘á»ƒ check error type, rethrow nhá»¯ng error khÃ´ng xá»­ lÃ½ Ä‘Æ°á»£c.

**169. Unhandled rejection lÃ  gÃ¬?**

> Khi promise rejected mÃ  **khÃ´ng cÃ³ .catch** â†’ error "káº¹t", global error. Browser: `window.addEventListener("unhandledrejection", fn)` vá»›i `event.promise` vÃ  `event.reason`. Node.js cÃ³ `process.on("unhandledRejection")`. NÃªn **luÃ´n cÃ³** handler nÃ y.

**170. setTimeout throw trong Promise cÃ³ bá»‹ catch khÃ´ng?**

> **KhÃ´ng**! Implicit try..catch chá»‰ bao **synchronous** code. `setTimeout` callback cháº¡y **sau**, trong async context riÃªng â†’ Promise Ä‘Ã£ settled. **Fix**: dÃ¹ng `reject(new Error(...))` thay vÃ¬ `throw` trong setTimeout.

**171. Best practices xá»­ lÃ½ error trong Promise chain?**

> 1. Äáº·t `.catch` cuá»‘i chain. 2) DÃ¹ng **custom error classes** + `instanceof` Ä‘á»ƒ phÃ¢n loáº¡i. 3) **Rethrow** unknown errors. 4) LuÃ´n cÃ³ **unhandledrejection** handler. 5) Trong setTimeout dÃ¹ng `reject()` khÃ´ng `throw`.

**172. Promise.all lÃ m gÃ¬? Khi nÃ o dÃ¹ng?**

> Chá» **táº¥t cáº£** promises resolve, tráº£ **array káº¿t quáº£** theo thá»© tá»± gá»‘c. 1 reject = **táº¥t cáº£ fail** (fail-fast). DÃ¹ng khi cáº§n **má»i** káº¿t quáº£: `Promise.all(urls.map(url => fetch(url)))`. Cháº¥p nháº­n non-promise values.

**173. Promise.all cÃ³ cancel promises khÃ¡c khi 1 fail khÃ´ng?**

> **KhÃ´ng**. CÃ¡c promise khÃ¡c váº«n tiáº¿p tá»¥c cháº¡y, nhÆ°ng káº¿t quáº£ bá»‹ **ignore**. KhÃ´ng cÃ³ khÃ¡i niá»‡m "cancellation" trong Promise. DÃ¹ng **AbortController** náº¿u cáº§n cancel.

**174. Promise.allSettled khÃ¡c Promise.all tháº¿ nÃ o?**

> `.allSettled` chá» táº¥t cáº£ settle, **khÃ´ng fail-fast**. Tráº£ array `{status: "fulfilled", value}` hoáº·c `{status: "rejected", reason}`. DÃ¹ng khi cáº§n káº¿t quáº£ cá»§a má»i promise, ká»ƒ cáº£ failed. `.all` thÃ¬ "all or nothing".

**175. Promise.race khÃ¡c Promise.any tháº¿ nÃ o?**

> `.race`: first **settled** (resolve hoáº·c reject) wins. `.any`: first **fulfilled** wins, bá» qua reject. Náº¿u `.any` táº¥t cáº£ reject â†’ **AggregateError** vá»›i `.errors` array. `.race` cÃ³ thá»ƒ tráº£ error náº¿u promise nhanh nháº¥t reject.

**176. AggregateError lÃ  gÃ¬?**

> Error Ä‘áº·c biá»‡t chá»©a **nhiá»u errors** trong `.errors` property. Chá»‰ xuáº¥t hiá»‡n khi **Promise.any** táº¥t cáº£ reject: `err.errors[0]`, `err.errors[1]`...

**177. Promise.resolve/reject dÃ¹ng khi nÃ o?**

> Táº¡o promise Ä‘Ã£ settle sáºµn cho **compatibility** â€” function luÃ´n tráº£ promise: `return cache.has(url) ? Promise.resolve(cache.get(url)) : fetch(url)`. Ãt dÃ¹ng hÆ¡n vá»›i **async/await**.

**178. Trick map array â†’ Promise.all lÃ  gÃ¬?**

> `urls.map(url => fetch(url))` táº¡o array promises, bá»c vÃ o `Promise.all(requests)`. Káº¿t quáº£: array responses theo thá»© tá»± gá»‘c. CÃ³ thá»ƒ chain: `.then(res => Promise.all(res.map(r => r.json())))`.

**179. Promisification lÃ  gÃ¬?**

> Chuyá»ƒn fn callback-based thÃ nh fn tráº£ **Promise**. Táº¡o wrapper: bá»c fn gá»‘c trong `new Promise`, dÃ¹ng custom callback Ä‘á»ƒ `reject(err)` hoáº·c `resolve(result)`. Káº¿t quáº£: `loadScriptPromise(src).then(...)`.

**180. promisify(f) helper hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> Tráº£ wrapper function: 1) Táº¡o custom `callback(err, result)`. 2) Push callback vÃ o cuá»‘i args. 3) Gá»i `f.call(this, ...args)`. Promise resolve/reject dá»±a trÃªn err. Vá»›i `manyArgs = true`: resolve vá»›i **array** results.

**181. Promisification cÃ³ háº¡n cháº¿ gÃ¬?**

> Chá»‰ cho fn gá»i callback **Ä‘Ãºng 1 láº§n**! Promise chá»‰ cÃ³ 1 result, calls tiáº¿p bá»‹ ignore. KhÃ´ng thay tháº¿ toÃ n bá»™ callbacks â€” bá»• sung. Vá»›i callback khÃ´ng theo error-first convention, pháº£i promisify thá»§ cÃ´ng.

**182. Node.js cÃ³ gÃ¬ há»— trá»£ promisification?**

> `util.promisify()` built-in: `const readFile = util.promisify(fs.readFile)`. Tá»± Ä‘á»™ng wrap error-first callback. NgoÃ i ra cÃ³ library `es6-promisify` linh hoáº¡t hÆ¡n.

**183. Khi nÃ o nÃªn promisify?**

> Khi dÃ¹ng **promise-based code** (chaining, async/await) nhÆ°ng library/fn chá»‰ cÃ³ callback API. Äáº·c biá»‡t há»¯u Ã­ch vá»›i **Node.js APIs** (fs, dns, crypto). Vá»›i browser: nhiá»u API Ä‘Ã£ cÃ³ Promise sáºµn (fetch, etc.).

**184. Microtask queue lÃ  gÃ¬?**

> HÃ ng Ä‘á»£i ná»™i bá»™ (PromiseJobs / microtask queue). `.then/.catch/.finally` handlers vÃ o hÃ ng Ä‘á»£i nÃ y. Cháº¡y **SAU** current code nhÆ°ng **TRÆ¯á»œC** macrotask (setTimeout). FIFO: enqueue trÆ°á»›c cháº¡y trÆ°á»›c.

**185. Táº¡i sao .then cháº¡y sau synchronous code?**

> DÃ¹ Promise Ä‘Ã£ resolve ngay, handler váº«n vÃ o **microtask queue**. Engine chá»‰ láº¥y task khi **khÃ´ng cÃ²n code nÃ o Ä‘ang cháº¡y**. VÃ¬ tháº¿ `alert("code finished")` hiá»ƒn trÆ°á»›c `alert("promise done!")`.

**186. Microtask vs Macrotask khÃ¡c nhau tháº¿ nÃ o?**

> **Microtask**: Promise handlers, queueMicrotask() â€” cháº¡y **ngay sau** current code. **Macrotask**: setTimeout, setInterval, I/O â€” cháº¡y **sau** microtask queue rá»—ng. Thá»© tá»±: `[sync] â†’ [microtask] â†’ [macrotask]`.

**187. Táº¡i sao setTimeout .catch váº«n trigger unhandledrejection?**

> `unhandledrejection` check **sau khi microtask queue rá»—ng**. `setTimeout` lÃ  macrotask, cháº¡y **sau** Ä‘Ã³. LÃºc check: chÆ°a cÃ³ .catch â†’ event fires. setTimeout .catch Ä‘Ãºng nhÆ°ng **quÃ¡ muá»™n**.

**188. LÃ m sao Ä‘áº£m báº£o thá»© tá»± thá»±c thi vá»›i Promise?**

> DÃ¹ng **.then chain**: `Promise.resolve().then(() => step1()).then(() => step2())`. Má»—i .then lÃ  1 microtask, cháº¡y theo thá»© tá»±. **KhÃ´ng** Ä‘áº·t code sau .then ngoÃ i chain náº¿u cáº§n thá»© tá»±.

**189. Event loop algorithm lÃ  gÃ¬?**

> VÃ²ng láº·p vÃ´ háº¡n: 1) Láº¥y **macrotask cÅ© nháº¥t** (script, setTimeout...) cháº¡y. 2) Cháº¡y **Há»T** microtask queue. 3) **Render** DOM náº¿u cÃ³ thay Ä‘á»•i. 4) Quay láº¡i bÆ°á»›c 1 (hoáº·c sleep). Rendering KHÃ”NG xáº£y ra khi Ä‘ang cháº¡y task.

**190. Táº¡i sao cáº§n split CPU-heavy tasks?**

> Task quÃ¡ lÃ¢u cháº·n event loop â†’ UI freeze, "Page Unresponsive". Split vá»›i `setTimeout(fn, 0)`: lÃ m 1 pháº§n, nhÆ°á»ng event loop, tiáº¿p tá»¥c. User events Ä‘Æ°á»£c xá»­ lÃ½ giá»¯a cÃ¡c chunks.

**191. Táº¡i sao schedule setTimeout TRÆ¯á»œC khi lÃ m viá»‡c nhanh hÆ¡n?**

> setTimeout nested cÃ³ **minimum delay 4ms**. Schedule trÆ°á»›c â†’ táº­n dá»¥ng thá»i gian chá»: trong khi chá» 4ms, code Ä‘ang cháº¡y. Káº¿t quáº£: tá»•ng thá»i gian ngáº¯n hÆ¡n Ä‘Ã¡ng ká»ƒ.

**192. Táº¡i sao DOM paint chá»‰ xáº£y ra sau task?**

> Browser khÃ´ng render **trong khi** cháº¡y task. Má»i thay Ä‘á»•i DOM gá»™p láº¡i, paint **1 láº§n** sau task. Äá»ƒ tháº¥y progress: split vá»›i setTimeout â†’ repaint giá»¯a cÃ¡c chunks. queueMicrotask khÃ´ng gÃ¢y render!

**193. queueMicrotask khÃ¡c setTimeout tháº¿ nÃ o?**

> `queueMicrotask(fn)`: cháº¡y **trÆ°á»›c render**, sau current code. `setTimeout(fn, 0)`: cháº¡y **sau render** (macrotask). DÃ¹ng queueMicrotask khi cáº§n async nhÆ°ng trong **cÃ¹ng mÃ´i trÆ°á»ng** (khÃ´ng thay Ä‘á»•i mouse, network...).

**194. Output order: 1, setTimeout(2), .then(3), .then(â†’setTimeout(4)), .then(5), setTimeout(6), 7?**

> **1 7 3 5 2 6 4**. BÆ°á»›c 1 sync: 1, 7. BÆ°á»›c 2 microtask: 3, (enqueue setTimeout(4)), 5. BÆ°á»›c 3 macrotask: 2, 6, 4. Microtask bÃªn trong táº¡o macrotask má»›i â†’ vÃ o cuá»‘i macro queue.

**195. Web Workers lÃ  gÃ¬?**

> Thread **song song**, cháº¡y code riÃªng, **khÃ´ng cÃ³ DOM**. Trao Ä‘á»•i data vá»›i main process báº±ng **postMessage/onmessage**. CÃ³ variables vÃ  event loop riÃªng. DÃ¹ng cho heavy calculations (multi-core CPU).

**196. Khi nÃ o dÃ¹ng setTimeout(fn, 0) trong event handler?**

> Äá»ƒ cháº¡y action **sau khi event bubbling xong**. VÃ­ dá»¥: dispatch custom event sau click xá»­ lÃ½ hoÃ n táº¥t. setTimeout Ä‘Æ°a vÃ o macrotask queue â†’ cháº¡y sau microtasks vÃ  render.

**197. async keyword lÃ m gÃ¬?**

> Äáº·t trÆ°á»›c function: 1) Function **luÃ´n tráº£ Promise** (non-promise auto-wrapped). 2) Cho phÃ©p dÃ¹ng **await** bÃªn trong. `async function f() { return 1; }` = `f().then(alert)` â†’ 1.

**198. await hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> **Suspends** execution cá»§a async function, chá» promise **settle**. Resolve â†’ tráº£ result. Reject â†’ **throw** error (nhÆ° throw statement). KhÃ´ng tá»‘n CPU â€” engine lÃ m viá»‡c khÃ¡c. **CHá»ˆ** dÃ¹ng trong async function!

**199. Error handling trong async/await?**

> DÃ¹ng **try..catch** bao await: báº¯t cáº£ fetch errors vÃ  json errors. KhÃ´ng try..catch â†’ async function tráº£ rejected promise â†’ dÃ¹ng `.catch()` ngoÃ i. KhÃ´ng .catch â†’ **unhandledrejection**.

**200. So sÃ¡nh async/await vá»›i .then/.catch?**

> async/await: code dá»… Ä‘á»c nhÆ° **synchronous**, try..catch thay .catch. NhÆ°ng váº«n dá»±a trÃªn Promise. á» top-level (ngoÃ i async fn): váº«n cáº§n .then/.catch. Promise.all váº«n há»¯u Ã­ch vá»›i await.

**201. await + Promise.all dÃ¹ng tháº¿ nÃ o?**

> `let results = await Promise.all([fetch(u1), fetch(u2)])` â€” **parallel**! Error propagates bÃ¬nh thÆ°á»ng, try..catch báº¯t Ä‘Æ°á»£c. Äá»«ng await tá»«ng cÃ¡i (sequential) khi cÃ³ thá»ƒ parallel.

**202. Gá»i async function tá»« non-async tháº¿ nÃ o?**

> async fn tráº£ **Promise** â†’ dÃ¹ng `.then()`: `wait().then(result => alert(result))`. KhÃ´ng thá»ƒ await trong regular function (SyntaxError).

**203. Top-level await lÃ  gÃ¬?**

> Trong **ES modules**, await hoáº¡t Ä‘á»™ng á»Ÿ top level khÃ´ng cáº§n async wrapper. Náº¿u khÃ´ng dÃ¹ng module: bá»c trong **IIFE**: `(async () => { let r = await fetch(...); })();`

**204. await cÃ³ cháº¥p nháº­n Thenable khÃ´ng?**

> **CÃ³**! Giá»‘ng .then, await cháº¥p nháº­n object cÃ³ `.then()` method. Gá»i `.then(resolve, reject)` vÃ  chá» káº¿t quáº£. TÆ°Æ¡ng thÃ­ch vá»›i third-party promise-like objects.

**205. Dangerous Promise.all lÃ  gÃ¬?**

> Promise.all reject ngay khi 1 fail, nhÆ°ng cÃ¡c promise khÃ¡c **váº«n cháº¡y** â†’ cÃ³ thá»ƒ throw errors **khÃ´ng ai catch**. Fix: customPromiseAll (ignore subsequent) hoáº·c chá» táº¥t cáº£ settle trÆ°á»›c khi reject.

**206. LÃ m sao rewrite rethrow/recursion vá»›i async/await?**

> Thay recursion báº±ng **while(true)** + **try/catch** + **break**: thÃ nh cÃ´ng â†’ break, error Ä‘Ã£ biáº¿t â†’ alert + tiáº¿p loop, error láº¡ â†’ throw. Dá»… Ä‘á»c vÃ  khÃ´ng gÃ¢y stack overflow.

**207. window object cÃ³ máº¥y vai trÃ²?**

> **2 vai trÃ²**: 1) **Global object** cho JS code (global functions = methods cá»§a window). 2) **Browser window** â€” cung cáº¥p methods Ä‘iá»u khiá»ƒn cá»­a sá»• (innerHeight, scrollTo...).

**208. DOM lÃ  gÃ¬?**

> **Document Object Model** â€” biá»ƒu diá»…n táº¥t cáº£ page content lÃ  **objects** cÃ³ thá»ƒ thao tÃ¡c. `document` lÃ  entry point. KhÃ´ng chá»‰ cho browser â€” server-side cÅ©ng dÃ¹ng. Spec: **DOM Living Standard**.

**209. CSSOM lÃ  gÃ¬ vÃ  khi nÃ o cáº§n?**

> **CSS Object Model** â€” biá»ƒu diá»…n CSS rules nhÆ° objects, Ä‘á»c/ghi. DÃ¹ng cÃ¹ng DOM khi modify style rules. **Hiáº¿m khi cáº§n** vÃ¬ thÆ°á»ng add/remove CSS classes, khÃ´ng modify rules trá»±c tiáº¿p.

**210. BOM bao gá»“m nhá»¯ng gÃ¬?**

> **Browser Object Model** â€” má»i thá»© ngoÃ i document: `navigator` (userAgent, platform), `location` (href, redirect), `alert/confirm/prompt`. Thuá»™c **HTML specification**, khÃ´ng pháº£i DOM spec.

**211. 3 specs chÃ­nh cá»§a web platform lÃ  gÃ¬?**

> 1. **DOM** (dom.spec.whatwg.org): cáº¥u trÃºc document, events. 2) **CSSOM** (w3.org/TR/cssom-1): stylesheets, style rules. 3) **HTML** (html.spec.whatwg.org): tags + BOM (setTimeout, alert, location...). HTML spec má»Ÿ rá»™ng DOM.

**212. TÃ¬m thÃ´ng tin vá» Web API á»Ÿ Ä‘Ã¢u?**

> **MDN** (developer.mozilla.org): dá»… Ä‘á»c, thá»±c táº¿. **Spec** (WHATWG/W3C): chi tiáº¿t, fundamental. TÃ¬m: "WHATWG [term]" hoáº·c "MDN [term]". Spec lÃ  nguá»“n sá»± tháº­t cuá»‘i cÃ¹ng.

**213. DOM tree cÃ³ nhá»¯ng loáº¡i node nÃ o?**

> **12 loáº¡i**, 4 thÆ°á»ng dÃ¹ng: **document** (entry point), **element nodes** (HTML tags), **text nodes** (ná»™i dung vÄƒn báº£n, ká»ƒ cáº£ spaces/newlines), **comment nodes** (<!-- -->). Má»i thá»© trong HTML Ä‘á»u vÃ o DOM.

**214. Spaces vÃ  newlines cÃ³ táº¡o DOM nodes khÃ´ng?**

> **CÃ³**! Spaces vÃ  newlines táº¡o **text nodes** (#text). 2 ngoáº¡i lá»‡: 1) Spaces/newlines **trÆ°á»›c `<head>`** bá»‹ ignore. 2) Ná»™i dung **sau `</body>`** tá»± Ä‘á»™ng chuyá»ƒn vÃ o body. DevTools áº©n space-only text nodes.

**215. Autocorrection cá»§a browser hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> Browser **tá»± sá»­a HTML lá»—i**: thÃªm `<html>`, `<head>`, `<body>` náº¿u thiáº¿u. ÄÃ³ng tags chÆ°a Ä‘Ã³ng. Äáº·c biá»‡t: `<table>` luÃ´n cÃ³ `<tbody>` (tá»± thÃªm dÃ¹ HTML khÃ´ng viáº¿t!). Cáº©n tháº­n khi query table.

**216. Táº¡i sao table luÃ´n cÃ³ tbody trong DOM?**

> Theo DOM spec, `<table>` **pháº£i cÃ³ `<tbody>`**. DÃ¹ HTML khÃ´ng viáº¿t, browser tá»± thÃªm. DOM: `TABLE â†’ TBODY â†’ TR â†’ TD`. Náº¿u query `table.children` sáº½ tháº¥y TBODY chá»© khÃ´ng pháº£i TR!

**217. Comment cÃ³ vÃ o DOM khÃ´ng?**

> **CÃ³**! Má»i thá»© trong HTML Ä‘á»u lÃ  DOM node, ká»ƒ cáº£ comments vÃ  `<!DOCTYPE>`. Comments cÃ³ thá»ƒ chá»©a data Ä‘á»ƒ JS Ä‘á»c qua `node.data` hoáº·c `node.nodeValue`.

**218. $0 trong DevTools lÃ  gÃ¬?**

> **$0** = element vá»«a chá»n trong Elements tab, **$1** = element trÆ°á»›c Ä‘Ã³. DÃ¹ng trong Console: `$0.style.background = "red"`. NgÆ°á»£c láº¡i: `inspect(node)` tá»« Console â†’ scroll Ä‘áº¿n element trong Elements.

**219. DevTools Elements tab hiá»ƒn thá»‹ DOM tháº¿ nÃ o?**

> **Simplified**: áº©n space-only text nodes, text nodes hiá»ƒn nhÆ° text thuáº§n. CÃ¡c subtabs: **Styles** (CSS rules), **Computed** (tÃ­nh toÃ¡n cuá»‘i), **Event Listeners** (handlers). Háº§u háº¿t values editable in-place.

**220. document.documentElement, document.body, document.head lÃ  gÃ¬?**

> Truy cáº­p top-level nodes: `document.documentElement` = `<html>`, `document.body` = `<body>`, `document.head` = `<head>`. âš ï¸ `document.body` cÃ³ thá»ƒ **null** náº¿u script náº±m trong `<head>` (browser chÆ°a Ä‘á»c body).

**221. childNodes vÃ  children khÃ¡c nhau tháº¿ nÃ o?**

> `childNodes`: **táº¥t cáº£** child nodes (element + text + comment). `children`: chá»‰ **element** nodes. `childNodes` lÃ  DOM collection (array-like, iterable, **live**, **read-only**), khÃ´ng cÃ³ array methods.

**222. DOM collections cÃ³ Ä‘áº·c Ä‘iá»ƒm gÃ¬?**

> **Array-like** (cÃ³ length), **iterable** (for..of âœ…), **LIVE** (tá»± cáº­p nháº­t khi DOM thay Ä‘á»•i), **read-only** (khÃ´ng gÃ¡n `childNodes[i] = ...`). âŒ KhÃ´ng cÃ³ filter/map â†’ dÃ¹ng `Array.from()`. âŒ KhÃ´ng dÃ¹ng for..in (láº¥y extra props).

**223. parentElement vÃ  parentNode khÃ¡c nhau tháº¿ nÃ o?**

> ThÆ°á»ng giá»‘ng nhau. KhÃ¡c khi: `document.documentElement.parentNode` = **document**, nhÆ°ng `parentElement` = **null** (vÃ¬ document khÃ´ng pháº£i element). DÃ¹ng `parentElement` Ä‘á»ƒ loop lÃªn Ä‘áº¿n `<html>` khÃ´ng vÆ°á»£t qua document.

**224. previousSibling vÃ  previousElementSibling khÃ¡c nhau tháº¿ nÃ o?**

> `previousSibling`: node trÆ°á»›c Ä‘Ã³ (cÃ³ thá»ƒ lÃ  **text node**). `previousElementSibling`: **element** trÆ°á»›c Ä‘Ã³ (bá» qua text/comment). TÆ°Æ¡ng tá»±: `nextSibling` vs `nextElementSibling`.

**225. elem.lastChild.nextSibling luÃ´n lÃ  null?**

> **ÄÃºng**! `lastChild` lÃ  node cuá»‘i cÃ¹ng, khÃ´ng cÃ³ `nextSibling`. NhÆ°ng `elem.children[0].previousSibling` cÃ³ thá»ƒ **khÃ´ng null** vÃ¬ trÆ°á»›c element Ä‘áº§u cÃ³ thá»ƒ cÃ³ text node.

**226. Table cÃ³ nhá»¯ng navigation properties Ä‘áº·c biá»‡t nÃ o?**

> `table.rows` (táº¥t cáº£ `<tr>`), `table.tBodies/tHead/tFoot/caption`, `tbody.rows`, `tr.cells` (`<td>/<th>`), `tr.rowIndex/sectionRowIndex`, `td.cellIndex`. Truy cáº­p: `table.rows[0].cells[1]`.

**227. Táº¡i sao khÃ´ng nÃªn dÃ¹ng for..in vá»›i DOM collections?**

> `for..in` láº·p **táº¥t cáº£ enumerable properties** â†’ láº¥y thÃªm `length`, `item`, `values`... DÃ¹ng **for..of** hoáº·c `Array.from()` rá»“i dÃ¹ng array methods.

**228. document.body cÃ³ thá»ƒ null khi nÃ o?**

> Khi script **cháº¡y trong `<head>`** vÃ  browser chÆ°a parse `<body>`. `null` trong DOM nghÄ©a lÃ  "khÃ´ng tá»“n táº¡i" hoáº·c "chÆ°a cÃ³". Giáº£i phÃ¡p: Ä‘áº·t script trÆ°á»›c `</body>` hoáº·c dÃ¹ng `DOMContentLoaded`.

**229. querySelector vÃ  querySelectorAll khÃ¡c nhau tháº¿ nÃ o?**

> `querySelector`: tráº£ **pháº§n tá»­ Ä‘áº§u tiÃªn** khá»›p CSS selector (nhanh hÆ¡n). `querySelectorAll`: tráº£ **táº¥t cáº£** khá»›p, **static** collection (snapshot). Cáº£ hai gá»i Ä‘Æ°á»£c trÃªn báº¥t ká»³ element.

**230. querySelectorAll vÃ  getElementsBy\* khÃ¡c nhau tháº¿ nÃ o?**

> `querySelectorAll`: **static** (snapshot táº¡i thá»i Ä‘iá»ƒm gá»i). `getElementsBy*`: **live** (tá»± cáº­p nháº­t khi DOM thay Ä‘á»•i). querySelectorAll máº¡nh hÆ¡n (dÃ¹ng CSS selector), getElementsBy\* chá»‰ theo tag/class/name.

**231. getElementById cÃ³ Ä‘áº·c Ä‘iá»ƒm gÃ¬?**

> Chá»‰ gá»i trÃªn **document** (khÃ´ng trÃªn element). id pháº£i **unique**. Nhiá»u id giá»‘ng â†’ behavior khÃ´ng Ä‘oÃ¡n Ä‘Æ°á»£c. âš ï¸ id táº¡o global variable nhÆ°ng **Ä‘á»«ng dÃ¹ng** (JS variable cÃ¹ng tÃªn override!).

**232. matches() dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Kiá»ƒm tra elem cÃ³ **khá»›p CSS selector** khÃ´ng â†’ true/false. Ráº¥t há»¯ u khi filter elements trong loop: `if (elem.matches('a[href$="zip"]'))`. KhÃ´ng tÃ¬m kiáº¿m DOM.

**233. closest() hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> Äi lÃªn tá»« element (bao gá»“m **chÃ­nh nÃ³**), tÃ¬m **ancestor gáº§n nháº¥t** khá»›p CSS selector. Tráº£ null náº¿u khÃ´ng tÃ¬m tháº¥y. VÃ­ dá»¥: `li.closest(".book")` â†’ UL cha gáº§n nháº¥t cÃ³ class book.

**234. Live collection vÃ  static collection khÃ¡c nhau tháº¿ nÃ o?**

> **Live** (getElementsBy\*): thÃªm/xÃ³a DOM node â†’ collection tá»± cáº­p nháº­t length. **Static** (querySelectorAll): snapshot, khÃ´ng thay Ä‘á»•i dÃ¹ DOM thay Ä‘á»•i. Static an toÃ n hÆ¡n khi láº·p vÃ  chá»‰nh sá»­a DOM.

**235. Táº¡i sao khÃ´ng nÃªn dÃ¹ng id-named global variables?**

> Browser tá»± táº¡o global variable tá»« id nhÆ°ng: 1) **Naming conflicts** vá»›i JS variables. 2) KhÃ´ng rÃµ nguá»“n biáº¿n khi Ä‘á»c code. 3) JS variable cÃ¹ng tÃªn **override**. DÃ¹ng `document.getElementById()` trong production.

**236. getElementsByTagName tráº£ vá» gÃ¬ vÃ  cáº§n lÆ°u Ã½ gÃ¬?**

> Tráº£ **live HTMLCollection**. LÆ°u Ã½: 1) Äá»«ng quÃªn chá»¯ **"s"** (getElement**s**). 2) Tráº£ **collection**, khÃ´ng pháº£i element â†’ `[0]` Ä‘á»ƒ láº¥y element. 3) `"*"` láº¥y táº¥t cáº£ tags.

**237. elemA.contains(elemB) lÃ m gÃ¬?**

> Tráº£ **true** náº¿u elemB náº±m trong elemA (descendant) hoáº·c elemA === elemB. DÃ¹ng kiá»ƒm tra quan há»‡ cha-con giá»¯a 2 nodes.

**238. DOM class hierarchy trÃ´ng nhÆ° tháº¿ nÃ o?**

> **EventTarget** â†’ **Node** â†’ Document / CharacterData (Text, Comment) / **Element** â†’ **HTMLElement** â†’ concrete (HTMLInputElement, HTMLAnchorElement...). Má»i DOM node káº¿ thá»«a tá»« prototype chain nÃ y.

**239. nodeType cÃ³ nhá»¯ng giÃ¡ trá»‹ nÃ o?**

> **1** = element, **3** = text, **9** = document. Read-only. Hiá»‡n Ä‘áº¡i dÃ¹ng `instanceof` nhÆ°ng nodeType Ä‘Ã´i khi tiá»‡n hÆ¡n (vÃ­ dá»¥: `node.nodeType === 1`).

**240. tagName vÃ  nodeName khÃ¡c nhau tháº¿ nÃ o?**

> `tagName`: chá»‰ cho **Element** nodes (uppercase trong HTML). `nodeName`: cho **má»i** node type. Text node: `nodeName = "#text"`, document: `nodeName = "#document"`. Cho elements, hai cÃ¡i giá»‘ng nhau.

**241. innerHTML cÃ³ nhá»¯ng cáº¡m báº«y gÃ¬?**

> 1. `<script>` chÃ¨n qua innerHTML **khÃ´ng execute**. 2) `innerHTML +=` lÃ  **full overwrite**: xÃ³a toÃ n bá»™ rá»“i ghi láº¡i â†’ images reload, input values máº¥t, selection máº¥t. 3) Browser tá»± sá»­a HTML lá»—i.

**242. innerHTML += táº¡i sao nguy hiá»ƒm?**

> KhÃ´ng pháº£i **append** mÃ  lÃ  `elem.innerHTML = elem.innerHTML + "..."` â†’ **xÃ³a sáº¡ch vÃ  ghi láº¡i toÃ n bá»™**. Háº­u quáº£: resources reload, event handlers máº¥t, form data máº¥t. DÃ¹ng `insertAdjacentHTML` thay tháº¿.

**243. outerHTML khÃ¡c innerHTML tháº¿ nÃ o?**

> `outerHTML`: bao gá»“m **chÃ­nh element** (Ä‘áº§y Ä‘á»§ tag). âš ï¸ GÃ¡n `outerHTML` **khÃ´ng thay Ä‘á»•i biáº¿n** â€” element cÅ© bá»‹ remove khá»i DOM nhÆ°ng biáº¿n váº«n trá» tá»›i nÃ³. HTML má»›i thay tháº¿ trong DOM nhÆ°ng khÃ´ng save vÃ o biáº¿n nÃ o.

**244. textContent vÃ  innerHTML khÃ¡c nhau tháº¿ nÃ o?**

> `innerHTML`: render **HTML** (tags Ä‘Æ°á»£c xá»­ lÃ½). `textContent`: insert **pure text** (tags hiá»ƒn thá»‹ nhÆ° text). âœ… `textContent` an toÃ n cho **user input** (khÃ´ng bá»‹ XSS injection).

**245. data vÃ  nodeValue dÃ¹ng khi nÃ o?**

> Cho **text nodes** vÃ  **comment nodes** (innerHTML chá»‰ cho elements). Hai cÃ¡i gáº§n giá»‘ng nhau, dÃ¹ng `data` vÃ¬ ngáº¯n hÆ¡n. DÃ¹ng Ä‘á»c comment data cho template instructions.

**246. hidden property hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> `elem.hidden = true` = CSS `display:none` nhÆ°ng ngáº¯n hÆ¡n. DÃ¹ng cho blinking: `setInterval(() => elem.hidden = !elem.hidden, 1000)`. CÃ³ thá»ƒ set trong HTML: `<div hidden>`.

**247. console.log vÃ  console.dir khÃ¡c nhau vá»›i DOM elements?**

> `console.log(elem)`: hiá»ƒn **DOM tree** (nhÆ° Elements tab). `console.dir(elem)`: hiá»ƒn **JS object** (properties, prototype chain). DÃ¹ng `dir` Ä‘á»ƒ khÃ¡m phÃ¡ properties cá»§a element.

**248. document náº±m á»Ÿ Ä‘Ã¢u trong DOM hierarchy?**

> `document` thuá»™c class **HTMLDocument** káº¿ thá»«a tá»« **Document â†’ Node â†’ EventTarget**. NÃ³ khÃ´ng káº¿ thá»«a tá»« Element hay HTMLElement. VÃ¬ váº­y `document.documentElement.parentElement` = null.

**249. createElement vÃ  createTextNode khÃ¡c nhau tháº¿ nÃ o?**

> `createElement(tag)`: táº¡o **element node** (nhÆ° `<div>`, `<p>`). `createTextNode(text)`: táº¡o **text node** thuáº§n. Element má»›i chÆ°a trong DOM, cáº§n insert (append/before...) Ä‘á»ƒ hiá»ƒn thá»‹.

**250. CÃ¡c insertion methods modern cÃ³ nhá»¯ng gÃ¬?**

> `append` (cuá»‘i), `prepend` (Ä‘áº§u), `before` (trÆ°á»›c), `after` (sau), `replaceWith` (thay tháº¿). Nháº­n **nodes hoáº·c strings**. Strings chÃ¨n nhÆ° **text** (safe, khÃ´ng pháº£i HTML). CÃ³ thá»ƒ truyá»n nhiá»u giÃ¡ trá»‹.

**251. insertAdjacentHTML cÃ³ máº¥y vá»‹ trÃ­ vÃ  dÃ¹ng khi nÃ o?**

> 4 vá»‹ trÃ­: `"beforebegin"` (trÆ°á»›c elem), `"afterbegin"` (Ä‘áº§u trong), `"beforeend"` (cuá»‘i trong), `"afterend"` (sau elem). DÃ¹ng khi cáº§n chÃ¨n **HTML string** (thay tháº¿ `innerHTML +=`). KhÃ´ng overwrite ná»™i dung cÅ©!

**252. Táº¡i sao insert tá»± remove khá»i vá»‹ trÃ­ cÅ©?**

> Má»i insertion method **tá»± Ä‘á»™ng remove** node tá»« vá»‹ trÃ­ cÅ© trÆ°á»›c khi chÃ¨n vÃ o vá»‹ trÃ­ má»›i. KhÃ´ng cáº§n gá»i `remove()` trÆ°á»›c. VÃ­ dá»¥: `second.after(first)` â†’ first tá»± Ä‘á»™ng di chuyá»ƒn.

**253. cloneNode(true) vÃ  cloneNode(false) khÃ¡c nhau tháº¿ nÃ o?**

> `cloneNode(true)`: **deep clone** (vá»›i táº¥t cáº£ children vÃ  attributes). `cloneNode(false)`: **shallow** (chá»‰ element, khÃ´ng children). Clone lÃ  báº£n sao Ä‘á»™c láº­p, thay Ä‘á»•i khÃ´ng áº£nh hÆ°á»Ÿng original.

**254. DocumentFragment lÃ  gÃ¬ vÃ  khi nÃ o dÃ¹ng?**

> DOM node Ä‘áº·c biá»‡t dÃ¹ng lÃ m wrapper. Khi insert, chá»‰ **children** Ä‘Æ°á»£c chÃ¨n (fragment "blend in"). Thá»±c táº¿ Ã­t dÃ¹ng, thay báº±ng **array + spread**: `ul.append(...nodes)`.

**255. CÃ¡c old-school methods vÃ  táº¡i sao váº«n cáº§n biáº¿t?**

> `appendChild`, `insertBefore`, `removeChild`, `replaceChild` â€” táº¥t cáº£ tráº£ vá» node. Váº«n gáº·p trong **code cÅ©**. Modern: `append/prepend/before/after/remove/replaceWith` linh hoáº¡t hÆ¡n.

**256. document.write cÃ³ váº¥n Ä‘á» gÃ¬?**

> Chá»‰ hoáº¡t Ä‘á»™ng **khi page Ä‘ang load**. Gá»i **sau khi load xong** â†’ **xÃ³a toÃ n bá»™ document**! Nhanh vÃ¬ ghi tháº³ng vÃ o HTML stream (khÃ´ng modify DOM). Chá»‰ tháº¥y trong scripts cÅ©.

**257. createTextNode vÃ  textContent giá»‘ng nhau khÃ´ng?**

> Cáº£ hai chÃ¨n text **safe** (khÃ´ng render HTML). `createTextNode` táº¡o text node rá»“i append. `textContent` gÃ¡n trá»±c tiáº¿p. `innerHTML` thÃ¬ render HTML (khÃ´ng safe). `append(createTextNode(text))` = `elem.textContent = text`.

**258. CÃ¡ch xÃ³a táº¥t cáº£ children cá»§a element?**

> CÃ¡ch 1: `while (elem.firstChild) elem.firstChild.remove()`. CÃ¡ch 2: `elem.innerHTML = ""`. âš ï¸ KhÃ´ng dÃ¹ng for loop vá»›i `childNodes.length` (live collection shift index!).

**259. Sort table báº±ng DOM tháº¿ nÃ o?**

> `Array.from(table.tBodies[0].rows).sort((a, b) => a.cells[0].innerHTML.localeCompare(b.cells[0].innerHTML))` rá»“i `table.tBodies[0].append(...sorted)`. Insert tá»± remove cÅ© â†’ khÃ´ng cáº§n xÃ³a trÆ°á»›c.

**260. className vÃ  classList khÃ¡c nhau tháº¿ nÃ o?**

> `className`: **toÃ n bá»™ string** class (gÃ¡n = thay tháº¿ háº¿t). `classList`: object vá»›i methods `add/remove/toggle/contains`, thao tÃ¡c **tá»«ng class**. classList lÃ  **iterable** (for..of).

**261. classList cÃ³ nhá»¯ng methods gÃ¬?**

> `add("class")`: thÃªm class. `remove("class")`: xÃ³a. `toggle("class")`: thÃªm náº¿u chÆ°a cÃ³, xÃ³a náº¿u cÃ³. `contains("class")`: kiá»ƒm tra â†’ true/false. CÃ³ thá»ƒ add/remove nhiá»u class: `classList.add("a", "b")`.

**262. Táº¡i sao elem.style dÃ¹ng camelCase?**

> CSS dÃ¹ng dáº¥u `-` (background-color), JS dÃ¹ng **camelCase** (backgroundColor). VÃ¬ `-` khÃ´ng há»£p lá»‡ trong JS property name. Prefixed: `-moz-` â†’ `Moz`, `-webkit-` â†’ `Webkit` (chá»¯ hoa Ä‘áº§u).

**263. Táº¡i sao elem.style.margin = 20 khÃ´ng hoáº¡t Ä‘á»™ng?**

> CSS values cáº§n **Ä‘Æ¡n vá»‹**. Pháº£i lÃ  `"20px"`, `"2em"`, `"50%"`. GÃ¡n sá»‘ khÃ´ng cÃ³ Ä‘Æ¡n vá»‹ â†’ bá»‹ ignore, tráº£ `""` (empty string).

**264. CÃ¡ch reset inline style vá» máº·c Ä‘á»‹nh?**

> GÃ¡n **empty string**: `elem.style.display = ""` â†’ CSS classes Ã¡p dá»¥ng láº¡i bÃ¬nh thÆ°á»ng. Hoáº·c `elem.style.removeProperty("display")`. KhÃ´ng dÃ¹ng `delete`.

**265. style.cssText dÃ¹ng khi nÃ o?**

> GÃ¡n **toÃ n bá»™ inline style** cÃ¹ng lÃºc, há»— trá»£ `!important`. âš ï¸ XÃ³a styles cÅ© (full overwrite). Chá»‰ dÃ¹ng cho **elements má»›i**. TÆ°Æ¡ng Ä‘Æ°Æ¡ng `setAttribute("style", "...")`.

**266. Táº¡i sao elem.style khÃ´ng Ä‘á»c Ä‘Æ°á»£c CSS class styles?**

> `elem.style` chá»‰ Ä‘á»c **inline style** (attribute "style"). CSS cascade (classes, external sheets) khÃ´ng pháº£n Ã¡nh. DÃ¹ng `getComputedStyle(elem)` Ä‘á»ƒ Ä‘á»c **resolved styles** cuá»‘i cÃ¹ng.

**267. getComputedStyle tráº£ vá» gÃ¬?**

> Object **read-only** chá»©a resolved styles (táº¥t cáº£ CSS Ä‘Ã£ Ã¡p dá»¥ng). Values lÃ  **absolute** (px, rgb...), khÃ´ng relative (em, %). DÃ¹ng full property name: `marginTop` âœ…, `margin` âŒ.

**268. Computed value vÃ  resolved value khÃ¡c nhau?**

> **Computed**: sau CSS cascade (cÃ³ thá»ƒ `1em`, `125%`). **Resolved**: absolute, fixed units (`20px`, `16px`). `getComputedStyle` thá»±c táº¿ tráº£ resolved value. Geometry properties cÃ³ thá»ƒ floating point (`50.5px`).

**269. Táº¡i sao :visited styles bá»‹ áº©n?**

> Báº£o máº­t: trang web cÃ³ thá»ƒ táº¡o links vÃ  check styles Ä‘á»ƒ biáº¿t user Ä‘Ã£ visit URLs nÃ o â†’ **vi pháº¡m privacy**. JS khÃ´ng thá»ƒ Ä‘á»c :visited styles. CSS cÅ©ng cáº¥m thay Ä‘á»•i geometry trong :visited.

**270. CÃ³ máº¥y cÃ¡ch gÃ¡n event handler?**

> 3 cÃ¡ch: 1) **HTML attribute**: `onclick="..."` (khÃ´ng khuyáº¿n khÃ­ch). 2) **DOM property**: `elem.onclick = fn` (chá»‰ 1 handler/event). 3) **addEventListener**: linh hoáº¡t nháº¥t, nhiá»u handlers, há»— trá»£ options.

**271. addEventListener cÃ³ nhá»¯ng options nÃ o?**

> `once`: true â†’ tá»± xÃ³a handler sau 1 láº§n trigger. `capture`: true â†’ xá»­ lÃ½ á»Ÿ capturing phase. `passive`: true â†’ khÃ´ng gá»i `preventDefault()`. Historical: boolean = `{capture: bool}`.

**272. Táº¡i sao removeEventListener khÃ´ng hoáº¡t Ä‘á»™ng?**

> Cáº§n truyá»n **cÃ¹ng function reference** (cÃ¹ng object). Arrow function táº¡o má»›i má»—i láº§n â†’ khÃ¡c object â†’ khÃ´ng xÃ³a Ä‘Æ°á»£c. LÆ°u function vÃ o biáº¿n trÆ°á»›c khi add/remove.

**273. onclick = sayThanks vs onclick = sayThanks() khÃ¡c nhau?**

> `sayThanks`: gÃ¡n **function reference** (handler). `sayThanks()`: **gá»i function** vÃ  gÃ¡n **káº¿t quáº£** (thÆ°á»ng `undefined`). Trong HTML attribute thÃ¬ cáº§n `()` vÃ¬ browser wrap thÃ nh `function() { sayThanks(); }`.

**274. Táº¡i sao má»™t sá»‘ events chá»‰ hoáº¡t Ä‘á»™ng vá»›i addEventListener?**

> VÃ­ dá»¥ `DOMContentLoaded`, `transitionend` khÃ´ng cÃ³ DOM property tÆ°Æ¡ng á»©ng. `document.onDOMContentLoaded` = âŒ. Pháº£i dÃ¹ng `addEventListener`. ÄÃ¢y lÃ  ngoáº¡i lá»‡.

**275. Event object chá»©a nhá»¯ng gÃ¬?**

> `event.type`: loáº¡i event ("click"). `event.currentTarget`: element cÃ³ handler (= `this`). `event.clientX/Y`: toáº¡ Ä‘á»™ chuá»™t. Properties khÃ¡c nhau tÃ¹y loáº¡i event (keyboard, pointer...).

**276. event.currentTarget vÃ  this khi nÃ o khÃ¡c nhau?**

> Giá»‘ng nhau trá»« khi handler lÃ  **arrow function** (khÃ´ng cÃ³ `this` riÃªng) hoáº·c `this` Ä‘Ã£ bá»‹ **bind** vÃ o giÃ¡ trá»‹ khÃ¡c. Khi Ä‘Ã³ dÃ¹ng `event.currentTarget` Ä‘á»ƒ láº¥y element.

**277. handleEvent pattern lÃ  gÃ¬?**

> Truyá»n **object** cho addEventListener thay vÃ¬ function. Browser gá»i `obj.handleEvent(event)`. CÃ³ thá»ƒ dispatch toáº¡ specific methods (`onMousedown`, `onMouseup`). Dá»… tÃ¡ch logic.

**278. Táº¡i sao khÃ´ng dÃ¹ng setAttribute cho event handlers?**

> `setAttribute("onclick", fn)` chuyá»ƒn function thÃ nh **string** (attributes luÃ´n lÃ  string). Káº¿t quáº£: handler khÃ´ng hoáº¡t Ä‘á»™ng. DÃ¹ng DOM property hoáº·c addEventListener.

**279. DOM property vÃ  addEventListener cÃ³ cháº¡y Ä‘á»“ng thá»i khÃ´ng?**

> CÃ³! `elem.onclick = fn1` vÃ  `elem.addEventListener("click", fn2)` **cáº£ 2 Ä‘á»u cháº¡y**. ThÆ°á»ng chá»‰ dÃ¹ng 1 cÃ¡ch. addEventListener Ä‘Æ°á»£c khuyáº¿n khÃ­ch hÆ¡n.

**280. LÃ m sao Ä‘á»ƒ handler chá»‰ cháº¡y 1 láº§n?**

> DÃ¹ng option `{ once: true }`: `elem.addEventListener("click", fn, { once: true })`. Handler tá»± Ä‘á»™ng bá»‹ xÃ³a sau láº§n trigger Ä‘áº§u tiÃªn.

**281. Bubbling lÃ  gÃ¬?**

> Khi event xáº£y ra, handler cháº¡y trÃªn target rá»“i **lÃªn trÃªn** qua tá»«ng ancestor: target â†’ parent â†’ ... â†’ document. Gá»i lÃ  "bubbling" vÃ¬ nhÆ° bá»t nÆ°á»›c ná»•i lÃªn. Háº§u háº¿t events bubble (ngoáº¡i lá»‡: `focus`).

**282. event.target vÃ  event.currentTarget khÃ¡c nhau?**

> `event.target`: element Ä‘Æ°á»£c click/trigger **thá»±c sá»±** (khÃ´ng Ä‘á»•i qua bubbling). `event.currentTarget` (= `this`): element cÃ³ **handler Ä‘ang cháº¡y**. VÃ­ dá»¥: click `<p>` trong `<form>` â†’ target = P, currentTarget = FORM.

**283. stopPropagation vÃ  stopImmediatePropagation khÃ¡c nhau?**

> `stopPropagation()`: dá»«ng bubble **lÃªn trÃªn**, nhÆ°ng handlers **khÃ¡c cÃ¹ng element váº«n cháº¡y**. `stopImmediatePropagation()`: dá»«ng **táº¥t cáº£** â€” khÃ´ng bubble + khÃ´ng cháº¡y handlers khÃ¡c cÃ¹ng elem.

**284. Táº¡i sao khÃ´ng nÃªn stopPropagation tÃ¹y tiá»‡n?**

> Táº¡o "dead zone": analytics (`document.addEventListener('click')`) sáº½ khÃ´ng báº¯t Ä‘Æ°á»£c clicks trong vÃ¹ng Ä‘Ã£ stop. DÃ¹ng **custom events** hoáº·c **event.target check** thay tháº¿.

**285. 3 phases cá»§a event propagation lÃ  gÃ¬?**

> 1. **Capturing**: document â†’ html â†’ ... â†’ target (xuá»‘ng). 2) **Target**: event Ä‘áº¿n target element. 3) **Bubbling**: target â†’ ... â†’ document (lÃªn). Máº·c Ä‘á»‹nh handlers cháº¡y á»Ÿ phase 2-3.

**286. LÃ m sao báº¯t event á»Ÿ capturing phase?**

> `addEventListener(event, handler, { capture: true })` hoáº·c `addEventListener(event, handler, true)`. `on<event>` vÃ  HTML attributes khÃ´ng há»— trá»£ capturing.

**287. removeEventListener cáº§n lÆ°u Ã½ gÃ¬ vá»›i capturing?**

> Cáº§n truyá»n **cÃ¹ng phase**: `removeEventListener("click", handler, true)`. Add vá»›i `true` mÃ  remove khÃ´ng cÃ³ `true` â†’ khÃ´ng xÃ³a Ä‘Æ°á»£c.

**288. event.eventPhase cho biáº¿t gÃ¬?**

> Sá»‘ phase hiá»‡n táº¡i: **1** = capturing, **2** = target, **3** = bubbling. Ãt dÃ¹ng vÃ¬ thÆ°á»ng biáº¿t sáºµn tá»« cÃ¡ch add handler.

**289. stopPropagation á»Ÿ capturing phase cÃ³ cháº·n bubbling khÃ´ng?**

> **CÃ³!** Gá»i `stopPropagation()` á»Ÿ capturing â†’ event dá»«ng háº³n, khÃ´ng Ä‘áº¿n target, khÃ´ng bubbling. TÆ°Æ¡ng tá»± `stopImmediatePropagation()`.

**290. Event delegation lÃ  gÃ¬?**

> Thay vÃ¬ gÃ¡n handler cho **má»—i element** con, gÃ¡n **1 handler** trÃªn container. DÃ¹ng `event.target` xÃ¡c Ä‘á»‹nh element thá»±c sá»±. Tiáº¿t kiá»‡m memory, thÃªm/xÃ³a DOM tá»± do.

**291. Táº¡i sao cáº§n closest() trong delegation?**

> `event.target` cÃ³ thá»ƒ lÃ  **child** cá»§a element cáº§n xá»­ lÃ½ (vÃ­ dá»¥ `<strong>` trong `<td>`). `closest("td")` tÃ¬m **ancestor gáº§n nháº¥t** match selector â†’ luÃ´n tÃ¬m Ä‘Ãºng `<td>`.

**292. Táº¡i sao cáº§n container.contains(td)?**

> Khi cÃ³ **nested tables**, `closest("td")` cÃ³ thá»ƒ tráº£ vá» `<td>` cá»§a table **khÃ¡c**. `table.contains(td)` Ä‘áº£m báº£o `<td>` thuá»™c Ä‘Ãºng table hiá»‡n táº¡i.

**293. data-action pattern hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> Button cÃ³ attribute `data-action="save"`. Handler Ä‘á»c `event.target.dataset.action`, gá»i `this[action]()`. âš ï¸ Cáº§n `bind(this)` khi gÃ¡n `elem.onclick = this.onClick.bind(this)`.

**294. Behavior pattern lÃ  gÃ¬?**

> ThÃªm **data-\* attribute** vÃ o element + **document-level handler** xá»­ lÃ½. VÃ­ dá»¥: `data-counter` tÄƒng value, `data-toggle-id` show/hide. KhÃ´ng cáº§n JS riÃªng cho má»—i element.

**295. Táº¡i sao document-level handler nÃªn dÃ¹ng addEventListener?**

> `document.onclick = ...` sáº½ **ghi Ä‘Ã¨** handlers cÅ©. Nhiá»u pháº§n code Ä‘á»u cáº§n gÃ¡n handler lÃªn document â†’ `addEventListener` cho phÃ©p **nhiá»u handlers** cÃ¹ng tá»“n táº¡i.

**296. Event delegation cÃ³ nhá»¯ng Æ°u Ä‘iá»ƒm gÃ¬?**

> 1. **Tiáº¿t kiá»‡m memory**: 1 handler thay vÃ¬ N. 2) **Ãt code**: khÃ´ng cáº§n add/remove handler khi Ä‘á»•i DOM. 3) **innerHTML an toÃ n**: thÃªm/xÃ³a elements tá»± do, handler váº«n báº¯t.

**297. Event delegation cÃ³ háº¡n cháº¿ gÃ¬?**

> 1. Event pháº£i **bubble** (focus khÃ´ng bubble). 2) Handlers con khÃ´ng Ä‘Æ°á»£c `stopPropagation()`. 3) Container handler cháº¡y cho **má»i** event trong container â†’ **thÃªm CPU** (thÆ°á»ng khÃ´ng Ä‘Ã¡ng ká»ƒ).

**298. LÃ m sao sort table báº±ng delegation?**

> GÃ¡n handler trÃªn `<thead>`. Click `<th>` â†’ Ä‘á»c `data-type` ("number"/"string"), sort `tbody.rows` tÆ°Æ¡ng á»©ng. DÃ¹ng `Array.from(rows).sort()` rá»“i `tbody.append(...sorted)`.

**299. CÃ¡ch nÃ o Ä‘á»ƒ cháº·n default action cá»§a browser?**

> 2 cÃ¡ch: 1) `event.preventDefault()` (luÃ´n hoáº¡t Ä‘á»™ng). 2) `return false` (chá»‰ vá»›i `on<event>`, khÃ´ng vá»›i `addEventListener`). VÃ­ dá»¥: cháº·n click `<a>` navigate.

**300. Táº¡i sao return false khÃ´ng hoáº¡t Ä‘á»™ng trong addEventListener?**

> `addEventListener` **ignore** return value. Chá»‰ `on<event>` (HTML attribute hoáº·c DOM property) xá»­ lÃ½ `return false`. Trong addEventListener pháº£i dÃ¹ng `event.preventDefault()`.

**301. onclick="handler()" táº¡i sao return false khÃ´ng cháº·n Ä‘Æ°á»£c?**

> Browser táº¡o wrapper: `function(event) { handler(); }`. Return cá»§a handler khÃ´ng Ä‘Æ°á»£c truyá»n ra. Sá»­a: `onclick="return handler()"` hoáº·c dÃ¹ng `event.preventDefault()` trong handler.

**302. passive: true dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> BÃ¡o browser ráº±ng handler **khÃ´ng gá»i preventDefault**. Browser scroll **ngay** khÃ´ng Ä‘á»£i handler xong â†’ **mÆ°á»£t hÆ¡n** (mobile touchmove). Chrome/Firefox: passive máº·c Ä‘á»‹nh cho `touchstart/touchmove`.

**303. event.defaultPrevented dÃ¹ng khi nÃ o?**

> Thay tháº¿ `stopPropagation()` cho nested menus. Handler con gá»i `preventDefault()`. Parent check `if (event.defaultPrevented) return;` â†’ biáº¿t event Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ mÃ  váº«n **cho phÃ©p bubbling**.

**304. preventDefault vÃ  stopPropagation khÃ¡c nhau?**

> HoÃ n toÃ n **Ä‘á»™c láº­p**! `preventDefault()`: cháº·n **default action** cá»§a browser (navigate, submit...). `stopPropagation()`: cháº·n **event lan truyá»n** lÃªn/xuá»‘ng. CÃ³ thá»ƒ dÃ¹ng cáº£ 2 hoáº·c riÃªng.

**305. Follow-up events lÃ  gÃ¬?**

> Events liÃªn tiáº¿p: `mousedown` â†’ `focus`. Cháº·n `mousedown` (preventDefault) â†’ **máº¥t focus**. `keydown` â†’ `input`. Cháº·n event trÆ°á»›c sáº½ khÃ´ng cÃ³ event sau.

**306. Táº¡i sao nÃªn giá»¯ semantic HTML khi dÃ¹ng preventDefault?**

> `<a>` dÃ¹ng cho **navigation** (right-click open new tab, SEO crawl). `<button>` cho **actions**. DÃ¹ cÃ³ thá»ƒ customize báº±ng JS, giá»¯ semantic giÃºp **accessibility** vÃ  browser features hoáº¡t Ä‘á»™ng Ä‘Ãºng.

**307. LÃ m sao catch all links báº±ng delegation?**

> GÃ¡n handler trÃªn container. DÃ¹ng `event.target.closest("a")` tÃ¬m link. `link.getAttribute("href")` (Ä‘á»«ng dÃ¹ng `link.href` â€” tráº£ full URL). `event.preventDefault()` ngÄƒn navigate.

**308. LÃ m sao táº¡o custom event?**

> `new Event(type, {bubbles, cancelable})` hoáº·c `new CustomEvent(type, {detail, bubbles, cancelable})`. PhÃ¡t báº±ng `elem.dispatchEvent(event)`. Máº·c Ä‘á»‹nh: khÃ´ng bubble, khÃ´ng cancelable.

**309. Event vÃ  CustomEvent khÃ¡c nhau?**

> `CustomEvent` thÃªm property **`detail`** cho data tÃ¹y Ã½ (`event.detail`). `Event` generic khÃ´ng cÃ³. About táº¥t cáº£ cÃ²n láº¡i giá»‘ng nhau. DÃ¹ng `CustomEvent` cho events tá»± Ä‘á»‹nh nghÄ©a.

**310. Táº¡i sao dÃ¹ng new MouseEvent thay vÃ¬ new Event cho click?**

> `MouseEvent` constructor há»— trá»£ properties riÃªng: `clientX`, `clientY`, `button`... `new Event("click", {clientX: 100})` â†’ `clientX = undefined` (bá»‹ ignore). CÃ¡c class khÃ¡c: `KeyboardEvent`, `FocusEvent`...

**311. event.isTrusted lÃ  gÃ¬?**

> `true`: event tá»« **user tháº­t** (click, keydown...). `false`: event tá»« **script** (dispatchEvent). DÃ¹ng Ä‘á»ƒ phÃ¢n biá»‡t user action vá»›i programmatic trigger.

**312. Táº¡i sao dispatchEvent cáº§n bubbles: true?**

> Máº·c Ä‘á»‹nh `{bubbles: false}` â†’ event khÃ´ng lÃªn trÃªn. Náº¿u muá»‘n handler trÃªn document báº¯t Ä‘Æ°á»£c â†’ pháº£i `{bubbles: true}`. Bubbling giá»‘ng nhÆ° built-in events.

**313. dispatchEvent tráº£ vá» gÃ¬?**

> Tráº£ `false` náº¿u handler gá»i `preventDefault()` (vÃ  event cÃ³ `cancelable: true`). Tráº£ `true` náº¿u khÃ´ng ai prevent. DÃ¹ng Ä‘á»ƒ biáº¿t cÃ³ nÃªn tiáº¿p tá»¥c action khÃ´ng.

**314. Táº¡i sao preventDefault khÃ´ng hoáº¡t Ä‘á»™ng trÃªn custom event?**

> Cáº§n `cancelable: true` khi táº¡o event. Máº·c Ä‘á»‹nh `{cancelable: false}` â†’ `preventDefault()` bá»‹ **ignore**. ÄÃ¢y lÃ  lá»—i thÆ°á»ng gáº·p.

**315. Custom events báº¯t báº±ng on<event> Ä‘Æ°á»£c khÃ´ng?**

> **KhÃ´ng!** `document.onhello = fn` khÃ´ng hoáº¡t Ä‘á»™ng. Custom events CHá»ˆ báº¯t vá»›i `addEventListener`. `on<event>` chá»‰ cho built-in events.

**316. Events-in-events xá»­ lÃ½ tháº¿ nÃ o?**

> **Äá»“ng bá»™!** dispatchEvent trong handler â†’ event má»›i cháº¡y **ngay láº­p tá»©c**, xong má»›i tiáº¿p tá»¥c handler cÅ©. VÃ­ dá»¥: `alert(1) â†’ dispatchEvent â†’ alert("nested") â†’ alert(2)`. Muá»‘n async: bá»c trong `setTimeout`.

**317. Khi nÃ o nÃªn dÃ¹ng custom events?**

> **Architectural**: components signal láº«n nhau (menu open, item select, carousel slide). **Automated testing**: giáº£ láº­p click. **KhÃ´ng nÃªn**: fake browser events (hacky). DÃ¹ng custom names cho riÃªng.

**318. MutationObserver lÃ  gÃ¬?**

> Built-in object **theo dÃµi DOM changes** vÃ  gá»i callback khi phÃ¡t hiá»‡n thay Ä‘á»•i. Táº¡o: `new MutationObserver(callback)`. Gáº¯n: `observer.observe(node, config)`. Pháº£n á»©ng vá»›i attributes, text, thÃªm/xÃ³a children.

**319. CÃ¡c config options cá»§a observe lÃ  gÃ¬?**

> `childList`: children trá»±c tiáº¿p. `subtree`: táº¥t cáº£ descendants. `attributes`: attrs thay Ä‘á»•i. `attributeFilter`: chá»‰ cÃ¡c attr cá»¥ thá»ƒ. `characterData`: text content. `*OldValue`: giá»¯ giÃ¡ trá»‹ cÅ©.

**320. MutationRecord chá»©a nhá»¯ng gÃ¬?**

> `type`: "attributes"/"characterData"/"childList". `target`: node bá»‹ Ä‘á»•i. `addedNodes/removedNodes`: nodes thÃªm/xÃ³a. `previousSibling/nextSibling`. `attributeName`. `oldValue` (náº¿u báº­t `*OldValue`).

**321. disconnect() vÃ  takeRecords() dÃ¹ng khi nÃ o?**

> `disconnect()`: dá»«ng theo dÃµi. `takeRecords()`: láº¥y mutations **chÆ°a xá»­ lÃ½** (xÃ³a khá»i queue â†’ callback khÃ´ng gá»i láº¡i). Gá»i `takeRecords()` **trÆ°á»›c** `disconnect()` Ä‘á»ƒ khÃ´ng máº¥t data.

**322. MutationObserver Ã¡p dá»¥ng cho integration tháº¿ nÃ o?**

> XÃ³a **unwanted elements** tá»« 3rd-party scripts (ads). Detect DOM changes tá»« libraries khÃ¡c Ä‘á»ƒ **adapt UI** (resize, reposition). KhÃ´ng cáº§n patch 3rd-party code.

**323. MutationObserver Ã¡p dá»¥ng cho architecture tháº¿ nÃ o?**

> **Auto syntax highlighting**: observe container, khi code snippet Ä‘Æ°á»£c thÃªm (innerHTML) â†’ tá»± Ä‘á»™ng highlight. KhÃ´ng cáº§n gá»i highlight á»Ÿ má»i nÆ¡i load content. 1 observer xá»­ lÃ½ táº¥t cáº£.

**324. MutationObserver cÃ³ cháº·n garbage collection khÃ´ng?**

> **KhÃ´ng!** Observer dÃ¹ng **weak references**. Node bá»‹ xÃ³a khá»i DOM vÃ  khÃ´ng cÃ²n reference â†’ váº«n Ä‘Æ°á»£c GC bÃ¬nh thÆ°á»ng.

**325. Táº¡i sao cáº§n config options?**

> **Tá»‘i Æ°u hiá»‡u suáº¥t**: chá»‰ theo dÃµi nhá»¯ng gÃ¬ cáº§n, khÃ´ng lÃ£ng phÃ­ tÃ i nguyÃªn cho callbacks khÃ´ng cáº§n thiáº¿t. VÃ­ dá»¥: chá»‰ cáº§n `childList` thÃ¬ khÃ´ng báº­t `attributes`.

**326. LÃ m sao detect DOM change tá»« 3rd-party script?**

> `observer.observe(document.body, {childList: true, subtree: true})`. Trong callback check `addedNodes` tÃ¬m elements cá»¥ thá»ƒ. Xá»­ lÃ½/xÃ³a tÃ¹y Ã½ mÃ  khÃ´ng cáº§n sá»­a source cá»§a 3rd-party.

**327. Range lÃ  gÃ¬?**

> Object chá»©a cáº·p **boundary points** (start, end). `setStart(node, offset)` / `setEnd(node, offset)`. Offset lÃ  vá»‹ trÃ­ text (text node) hoáº·c child index (element node).

**328. Range cÃ³ nhá»¯ng editing methods nÃ o?**

> `deleteContents()`: xÃ³a. `extractContents()`: xÃ³a + tráº£ DocumentFragment. `cloneContents()`: copy. `insertNode(node)`: chÃ¨n á»Ÿ Ä‘áº§u. `surroundContents(node)`: bao bá»c (âš ï¸ cáº§n full opening/closing tags).

**329. Selection vÃ  Range khÃ¡c nhau?**

> `Range`: object Ä‘Æ¡n thuáº§n, khÃ´ng hiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh. `Selection` (`window.getSelection()`): **vÃ¹ng chá»n** thá»±c táº¿ trÃªn UI, chá»©a ranges. DÃ¹ng `addRange(range)` Ä‘á»ƒ Ã¡p dá»¥ng.

**330. anchor/focus khÃ¡c start/end nhÆ° tháº¿ nÃ o?**

> Range: `start` luÃ´n trÆ°á»›c `end`. Selection: `anchor` lÃ  nÆ¡i **báº¯t Ä‘áº§u kÃ©o**, `focus` lÃ  nÆ¡i **tháº£** chuá»™t. KÃ©o pháº£iâ†’trÃ¡i â†’ focus **trÆ°á»›c** anchor.

**331. Táº¡i sao cáº§n removeAllRanges trÆ°á»›c addRange?**

> Náº¿u `Selection` Ä‘Ã£ cÃ³ range, táº¥t cáº£ browsers (trá»« Firefox) **ignore** `addRange()`. Pháº£i `removeAllRanges()` trÆ°á»›c. `setBaseAndExtent()` thÃ¬ thay tháº¿ trá»±c tiáº¿p.

**332. Form controls cÃ³ API selection riÃªng khÃ´ng?**

> **CÃ³!** `selectionStart/End` (writable), `selectionDirection`. Methods: `select()`, `setSelectionRange(start, end)`, `setRangeText(text, start, end, mode)`. KhÃ´ng cáº§n Range/Selection.

**333. LÃ m sao di chuyá»ƒn cursor trong input?**

> Set `selectionStart = selectionEnd = position`. Khi 2 giÃ¡ trá»‹ báº±ng nhau = cursor position. DÃ¹ng trong `setTimeout` sau `onfocus` Ä‘á»ƒ chá» browser xong focus action.

**334. setRangeText dÃ¹ng tháº¿ nÃ o?**

> `input.setRangeText(replacement)`: thay tháº¿ selection. Vá»›i args: `setRangeText(text, start, end, selectionMode)`. `selectionMode`: `"select"` (chá»n text má»›i), `"start"/"end"` (cursor trÆ°á»›c/sau), `"preserve"` (giá»¯ selection, default).

**335. 3 cÃ¡ch lÃ m unselectable?**

> 1. CSS `user-select: none` (váº«n chá»n Ä‘Æ°á»£c tá»« ngoÃ i). 2) `onselectstart = () => false` (cháº·n báº¯t Ä‘áº§u). 3) `document.getSelection().empty()` (xÃ³a sau, bá»‹ nháº¥p nhÃ¡y).

**336. onselectstart vÃ  onselectionchange khÃ¡c nhau?**

> `onselectstart`: gáº¯n trÃªn **element**, fire khi báº¯t Ä‘áº§u chá»n. `onselectionchange`: chá»‰ trÃªn **document**, fire khi selection thay Ä‘á»•i. `onselectionchange` khÃ´ng reliable cho form controls.

**337. fetch tráº£ vá» gÃ¬?**

> `Promise<Response>`. Resolve vá»›i Response object khi server tráº£ **headers**. âš ï¸ 404/500 váº«n resolve! Chá»‰ **network error** (khÃ´ng káº¿t ná»‘i, DNS fail) má»›i **reject**.

**338. 2 giai Ä‘oáº¡n cá»§a fetch response?**

> Giai Ä‘oáº¡n 1: `await fetch(url)` â†’ Response vá»›i headers (check `.ok`, `.status`). Giai Ä‘oáº¡n 2: Ä‘á»c body vá»›i `.json()`, `.text()`, `.blob()`... Má»—i method tráº£ Promise.

**339. Táº¡i sao khÃ´ng Ä‘á»c body 2 láº§n?**

> Body chá»‰ Ä‘á»c Ä‘Æ°á»£c **1 láº§n** (consumed). `await response.text()` rá»“i `await response.json()` â†’ **fail**. Cáº§n chá»n 1 method phÃ¹ há»£p.

**340. CÃ¡c body methods cÃ³ nhá»¯ng gÃ¬?**

> `.text()`: plain text. `.json()`: parse JSON. `.blob()`: binary vá»›i type. `.arrayBuffer()`: low-level binary. `.formData()`: FormData object. `.body`: ReadableStream cho streaming.

**341. LÃ m sao gá»­i POST vá»›i JSON?**

> `fetch(url, { method: "POST", headers: {"Content-Type": "application/json;charset=utf-8"}, body: JSON.stringify(data) })`. âš ï¸ Pháº£i set Content-Type thá»§ cÃ´ng! Máº·c Ä‘á»‹nh string â†’ `text/plain`.

**342. body cÃ³ nhá»¯ng kiá»ƒu nÃ o?**

> `string` (JSON), `FormData` (multipart), `Blob/BufferSource` (binary), `URLSearchParams` (x-www-form-urlencoded). Blob tá»± set Content-Type tá»« `blob.type`.

**343. Forbidden headers lÃ  gÃ¬?**

> Headers **khÃ´ng Ä‘Æ°á»£c set** trong fetch: Cookie, Origin, Referer, Host, Connection, Content-Length, Sec-_, Proxy-_... Browser kiá»ƒm soÃ¡t Ä‘á»ƒ Ä‘áº£m báº£o **HTTP an toÃ n**.

**344. response.headers dÃ¹ng tháº¿ nÃ o?**

> Map-like object. `.get("Content-Type")` láº¥y 1 header. Iterable: `for (let [key, value] of response.headers)`. KhÃ´ng pháº£i Map tháº­t nhÆ°ng cÃ³ cÃ¡c methods tÆ°Æ¡ng tá»±.

**345. LÃ m sao gá»­i Blob (hÃ¬nh áº£nh)?**

> `fetch(url, { method: "POST", body: blob })`. Blob cÃ³ sáºµn `type` (vÃ­ dá»¥: `image/png` tá»« `canvas.toBlob`) â†’ **tá»± Ä‘á»™ng** set Content-Type. KhÃ´ng cáº§n set thá»§ cÃ´ng.

**346. Parallel fetch + Ä‘á»c JSON hiá»‡u quáº£ tháº¿ nÃ o?**

> Gáº¯n `.then(res => res.json())` **trá»±c tiáº¿p vÃ o tá»«ng fetch**, rá»“i `Promise.all(jobs)`. KhÃ´ng Ä‘á»£i táº¥t cáº£ fetch xong má»›i Ä‘á»c body. Tá»«ng fetch báº¯t Ä‘áº§u parse JSON ngay khi cÃ³ response.

**347. fetch khÃ¡c XMLHttpRequest?**

> `fetch`: Promise-based, clean API, há»— trá»£ streaming. `XMLHttpRequest`: callback-based, cÅ© hÆ¡n nhÆ°ng há»— trá»£ progress events vÃ  upload tracking tá»‘t hÆ¡n. Fetch khÃ´ng há»— trá»£ progress native.

**348. FormData lÃ  gÃ¬?**

> Object Ä‘áº¡i diá»‡n **HTML form data**. `new FormData(form)` tá»± capture táº¥t cáº£ fields. DÃ¹ng lÃ m `fetch body` â†’ auto `Content-Type: multipart/form-data`. Server nháº­n nhÆ° form submit bÃ¬nh thÆ°á»ng.

**349. append vÃ  set khÃ¡c nhau?**

> `append`: thÃªm field, **cho phÃ©p nhiá»u** field cÃ¹ng tÃªn. `set`: **xÃ³a háº¿t** fields cÃ¹ng tÃªn rá»“i thÃªm 1 field má»›i. ÄÃ¢y lÃ  **sá»± khÃ¡c biá»‡t duy nháº¥t**.

**350. LÃ m sao gá»­i file vá»›i FormData?**

> `formData.append(name, blob, fileName)`. Arg 3 = tÃªn file (nhÆ° tá»« filesystem). Giá»‘ng nhÆ° `<input type="file">`. Form luÃ´n gá»­i `multipart/form-data` encoding.

**351. LÃ m sao gá»­i Blob kÃ¨m metadata?**

> Táº¡o `FormData`, `append` cÃ¡c text fields + `append("image", blob, "image.png")`. Gá»­i qua fetch. Server nháº­n cáº£ **text + file** trong 1 request.

**352. FormData cÃ³ nhá»¯ng methods nÃ o?**

> `append(name, value)`, `set(name, value)`, `delete(name)`, `get(name)`, `has(name)`. File: `append(name, blob, fileName)`, `set(name, blob, fileName)`. Iterable vá»›i `for..of`.

**353. Táº¡i sao khÃ´ng cáº§n set Content-Type cho FormData?**

> Fetch **tá»± Ä‘á»™ng** set `Content-Type: multipart/form-data` vá»›i boundary. Náº¿u set thá»§ cÃ´ng sáº½ **thiáº¿u boundary** â†’ server khÃ´ng parse Ä‘Æ°á»£c!

**354. FormData cÃ³ thá»ƒ táº¡o khÃ´ng cáº§n form element?**

> **CÃ³!** `new FormData()` (khÃ´ng truyá»n form). ThÃªm fields báº±ng `append`/`set`. PhÃ¹ há»£p khi khÃ´ng cÃ³ HTML form, chá»‰ táº¡o data tá»« JS.

**355. Khi nÃ o dÃ¹ng FormData thay vÃ¬ JSON?**

> Khi cáº§n gá»­i **files** (JSON khÃ´ng há»— trá»£ binary). Khi server expect **multipart form**. Khi cáº§n mix text + binary data. JSON phÃ¹ há»£p cho pure data (khÃ´ng cÃ³ files).

**356. LÃ m sao theo dÃµi download progress vá»›i fetch?**

> DÃ¹ng `response.body.getReader()` (ReadableStream). Gá»i `reader.read()` trong while loop â†’ nháº­n `{done, value}`. `value` lÃ  `Uint8Array`. Cá»™ng `value.length` vÃ o counter Ä‘á»ƒ track progress.

**357. reader.read() tráº£ vá» gÃ¬?**

> Object `{done, value}`. `done`: `true` khi háº¿t data. `value`: `Uint8Array` chá»©a bytes cá»§a chunk. DÃ¹ng trong `while(true)` loop vá»›i `if (done) break`.

**358. LÃ m sao biáº¿t total size Ä‘á»ƒ tÃ­nh pháº§n trÄƒm?**

> `+response.headers.get("Content-Length")`. âš ï¸ CÃ³ thá»ƒ **váº¯ng** cho cross-origin requests. Server cÅ©ng khÃ´ng báº¯t buá»™c set. Cáº§n handle trÆ°á»ng há»£p null.

**359. LÃ m sao gá»™p chunks thÃ nh káº¿t quáº£?**

> Táº¡o `new Uint8Array(totalLength)`. DÃ¹ng `.set(chunk, position)` copy tá»«ng chunk. Decode: `new TextDecoder("utf-8").decode(array)` cho string, hoáº·c `new Blob(chunks)` cho binary.

**360. Táº¡i sao khÃ´ng dÃ¹ng cáº£ reader vÃ  response.json()?**

> Body chá»‰ Ä‘á»c **1 láº§n** (consumed). Náº¿u dÃ¹ng `getReader()` thÃ¬ khÃ´ng thá»ƒ gá»i `.json()/.text()` ná»¯a. Pháº£i chá»n 1 trong 2 cÃ¡ch.

**361. Fetch cÃ³ há»— trá»£ upload progress khÃ´ng?**

> **KhÃ´ng!** Fetch chá»‰ há»— trá»£ **download** progress qua ReadableStream. Upload progress cáº§n `XMLHttpRequest` vá»›i `xhr.upload.onprogress`.

**362. Cáº§n lÆ°u Ã½ gÃ¬ vá» memory khi Ä‘á»c chunks?**

> Náº¿u size khÃ´ng biáº¿t (khÃ´ng cÃ³ Content-Length), cáº§n check `receivedLength` vÃ  **break** khi Ä‘áº¡t limit Ä‘á»ƒ trÃ¡nh **overflow memory**. Chunks lÆ°u trong array cÃ³ thá»ƒ ráº¥t lá»›n.

**363. AbortController lÃ  gÃ¬?**

> Object Ä‘Æ¡n giáº£n vá»›i `abort()` method vÃ  `signal` property. Gá»i `abort()` â†’ signal phÃ¡t event "abort" + `signal.aborted = true`. DÃ¹ng Ä‘á»ƒ há»§y fetch vÃ  async tasks.

**364. LÃ m sao há»§y fetch?**

> `fetch(url, {signal: controller.signal})`. Gá»i `controller.abort()` â†’ fetch promise **rejects** vá»›i `AbortError`. Báº¯t báº±ng `try/catch`, check `err.name === "AbortError"`.

**365. abort() cÃ³ reject vá»›i error gÃ¬?**

> `AbortError` (err.name). KhÃ¡c vá»›i network error hay HTTP error. Cáº§n **phÃ¢n biá»‡t** trong catch: xá»­ lÃ½ abort riÃªng, throw láº¡i error khÃ¡c.

**366. Há»§y nhiá»u fetch cÃ¹ng lÃºc tháº¿ nÃ o?**

> DÃ¹ng **1 controller** cho táº¥t cáº£ fetches: `urls.map(url => fetch(url, {signal}))`. Gá»i `abort()` má»™t láº§n â†’ há»§y **táº¥t cáº£**. Scalable.

**367. DÃ¹ng AbortController cho custom task tháº¿ nÃ o?**

> Trong Promise: `controller.signal.addEventListener("abort", reject)`. Káº¿t há»£p vá»›i `Promise.all([...fetchJobs, ourJob])`. `abort()` há»§y cáº£ fetches vÃ  custom tasks.

**368. Pattern timeout vá»›i AbortController?**

> `setTimeout(() => controller.abort(), 5000)`. Sau 5s tá»± Ä‘á»™ng há»§y náº¿u chÆ°a xong. Káº¿t há»£p vá»›i `AbortSignal.timeout(5000)` (API má»›i hÆ¡n).

**369. AbortController cÃ³ dÃ¹ng Ä‘Æ°á»£c ngoÃ i fetch khÃ´ng?**

> **CÃ³!** Báº¥t ká»³ async operation nÃ o. Pattern chung: bÃªn thá»±c hiá»‡n listen `signal.addEventListener("abort", ...)`, bÃªn há»§y gá»i `abort()`. Universal.

**370. referrer option dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Set hoáº·c xÃ³a **Referer header**. `referrer: ""` khÃ´ng gá»­i. `referrer: "https://..."` set URL khÃ¡c (chá»‰ trong same origin). Máº·c Ä‘á»‹nh gá»­i URL hiá»‡n táº¡i.

**371. referrerPolicy cÃ³ nhá»¯ng giÃ¡ trá»‹ nÃ o?**

> 8 giÃ¡ trá»‹: `no-referrer`, `no-referrer-when-downgrade`, `origin`, `origin-when-cross-origin`, `same-origin`, `strict-origin`, `strict-origin-when-cross-origin` (default), `unsafe-url`. Kiá»ƒm soÃ¡t gá»­i gÃ¬ cho same/cross-origin/HTTPSâ†’HTTP.

**372. mode option lÃ  gÃ¬?**

> `"cors"` (default): cross-origin OK. `"same-origin"`: cháº·n cross-origin. `"no-cors"`: chá»‰ safe cross-origin. DÃ¹ng khi URL tá»« 3rd-party vÃ  cáº§n **giá»›i háº¡n**.

**373. credentials option lÃ m gÃ¬?**

> Kiá»ƒm soÃ¡t gá»­i **cookies + Authorization**. `"same-origin"` (default): chá»‰ same-origin. `"include"`: luÃ´n gá»­i (cáº§n `Access-Control-Allow-Credentials`). `"omit"`: khÃ´ng gá»­i.

**374. CÃ¡c cache modes lÃ  gÃ¬?**

> `"default"`: standard HTTP cache. `"no-store"`: ignore hoÃ n toÃ n. `"reload"`: khÃ´ng dÃ¹ng cache, populate cache. `"no-cache"`: conditional request. `"force-cache"`: dÃ¹ng dÃ¹ stale. `"only-if-cached"`: chá»‰ cache (same-origin).

**375. redirect option dÃ¹ng khi nÃ o?**

> `"follow"` (default): tá»± Ä‘á»™ng follow 301/302. `"error"`: error náº¿u redirect. `"manual"`: xá»­ lÃ½ thá»§ cÃ´ng (response.type = "opaqueredirect").

**376. integrity option lÃ m gÃ¬?**

> **Verify checksum** cá»§a response. `integrity: "sha256-abcdef"`. Fetch tá»± tÃ­nh hash, so sÃ¡nh vá»›i giÃ¡ trá»‹ cung cáº¥p. Mismatch â†’ error. Há»— trá»£ SHA-256, SHA-384, SHA-512.

**377. keepalive option dÃ¹ng cho gÃ¬?**

> Request **sá»‘ng sau khi page unload** (vÃ­ dá»¥: gá»­i analytics trong `onunload`). âš ï¸ Body tá»•ng â‰¤ **64KB** cho táº¥t cáº£ keepalive requests. KhÃ´ng handle Ä‘Æ°á»£c response sau unload.

**378. Táº¡i sao credentials: "include" cáº§n header phÃ­a server?**

> Server pháº£i tráº£ `Access-Control-Allow-Credentials: true` Ä‘á»ƒ browser cho phÃ©p JS **Ä‘á»c response**. Náº¿u khÃ´ng, browser cháº·n dÃ¹ request Ä‘Ã£ gá»­i thÃ nh cÃ´ng.

**379. Referrer policy cÃ³ Ã¡p dá»¥ng ngoÃ i fetch khÃ´ng?**

> **CÃ³!** Set global báº±ng `Referrer-Policy` HTTP header hoáº·c per-link vá»›i `<a rel="noreferrer">`. KhÃ´ng chá»‰ riÃªng fetch.

**380. URL class dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Táº¡o vÃ  **parse URL**. `new URL(url, base)`: base lÃ  optional. Tráº£ object vá»›i `protocol`, `host`, `pathname`, `search`, `hash`, `href`. DÃ¹ng thay string á»Ÿ fetch, XMLHttpRequest.

**381. URL constructor vá»›i base parameter hoáº¡t Ä‘á»™ng sao?**

> `new URL("/path", "https://site.com")` â†’ `https://site.com/path`. `new URL("c", base)` láº¥y relative tá»« base. Náº¿u `url` Ä‘áº§y Ä‘á»§ thÃ¬ `base` bá»‹ ignore.

**382. searchParams lÃ  gÃ¬?**

> `url.searchParams`: object `URLSearchParams`. Methods: `set`, `get`, `getAll`, `append`, `delete`, `has`, `sort`. **Auto-encode** special chars. Iterable vá»›i `for..of`.

**383. searchParams tá»± encode khÃ´ng?**

> **CÃ³!** `url.searchParams.set("q", "test me!")` â†’ `?q=test+me%21`. KhÃ´ng cáº§n encode thá»§ cÃ´ng. Khi iterate, tráº£ vá» **decoded** values.

**384. encodeURI vÃ  encodeURIComponent khÃ¡c nhau?**

> `encodeURI`: encode **whole URL**, giá»¯ `:, ?, =, &, #` (kÃ½ tá»± há»£p lá»‡ trong URL). `encodeURIComponent`: encode **1 param**, encode **cáº£** `:, ?, =, &, #`. DÃ¹ng cho search params.

**385. Táº¡i sao dÃ¹ng encodeURI cho param bá»‹ sai?**

> `encodeURI("Rock&Roll")` = `"Rock&Roll"` (giá»¯ `&`). Trong `?q=Rock&Roll`, browser hiá»ƒu `q=Rock` + param `Roll`. Pháº£i dÃ¹ng `encodeURIComponent` â†’ `Rock%26Roll`.

**386. URL class khÃ¡c encode\* functions tháº¿ nÃ o?**

> URL class dÃ¹ng **RFC3986** (má»›i). `encode*` dÃ¹ng **RFC2396** (cÅ©, 1998). VÃ­ dá»¥: IPv6 `[...]` bá»‹ `encodeURI` encode sai. Æ¯u tiÃªn URL class.

**387. getAll khÃ¡c get tháº¿ nÃ o?**

> `get(name)`: tráº£ giÃ¡ trá»‹ **Ä‘áº§u tiÃªn**. `getAll(name)`: tráº£ **array** táº¥t cáº£ giÃ¡ trá»‹. VÃ­ dá»¥: `?user=John&user=Pete` â†’ `getAll("user")` = `["John", "Pete"]`.

**388. URL object cÃ³ dÃ¹ng Ä‘Æ°á»£c thay string khÃ´ng?**

> **CÃ³!** Háº§u háº¿t methods (fetch, XHR,...) cháº¥p nháº­n URL object. Tá»± Ä‘á»™ng gá»i `toString()` chuyá»ƒn thÃ nh string vá»›i full URL.

**389. Khi nÃ o dÃ¹ng URL class thay vÃ¬ strings?**

> Khi cáº§n **parse** URL components. Khi cáº§n **auto-encode** params. Khi lÃ m viá»‡c vá»›i **relative paths**. Strings ngáº¯n gá»n hÆ¡n cho URL Ä‘Æ¡n giáº£n.

**390. XMLHttpRequest cÃ²n dÃ¹ng khi nÃ o?**

> 3 lÃ½ do: há»— trá»£ **legacy code**, há»— trá»£ **old browsers** (khÃ´ng polyfill), cáº§n **upload progress** (fetch khÃ´ng há»— trá»£). NgoÃ i ra dÃ¹ng `fetch`.

**391. 3 bÆ°á»›c cÆ¡ báº£n cá»§a XHR?**

> `new XMLHttpRequest()` â†’ `xhr.open(method, url)` (chá»‰ cáº¥u hÃ¬nh, chÆ°a gá»­i!) â†’ `xhr.send(body)` gá»­i request. Listen events: `onload`, `onerror`, `onprogress`.

**392. open() cÃ³ gá»­i request khÃ´ng?**

> **KhÃ´ng!** `open()` chá»‰ **cáº¥u hÃ¬nh** request (method, URL). Network chá»‰ báº¯t Ä‘áº§u khi gá»i `send()`. TÃªn "open" gÃ¢y nháº§m láº«n.

**393. Sá»± khÃ¡c biá»‡t giá»¯a load vÃ  error events?**

> `load`: request **hoÃ n thÃ nh** (dÃ¹ status 200, 404, 500 â€” cáº§n check `xhr.status`). `error`: request **khÃ´ng thá»±c hiá»‡n Ä‘Æ°á»£c** (network down, invalid URL). KhÃ´ng pháº£i HTTP error.

**394. responseType cÃ³ nhá»¯ng giÃ¡ trá»‹ nÃ o?**

> `""` / `"text"` (default): string. `"json"`: auto parse. `"blob"`: Blob. `"arraybuffer"`: ArrayBuffer. `"document"`: XML/HTML. Pháº£i set **trÆ°á»›c** `send()`.

**395. readyState lÃ  gÃ¬?**

> 5 states: 0 (UNSENT) â†’ 1 (OPENED) â†’ 2 (HEADERS_RECEIVED) â†’ 3 (LOADING, láº·p láº¡i) â†’ 4 (DONE). `readystatechange` event **deprecated** â†’ dÃ¹ng `load`/`error`/`progress`.

**396. setRequestHeader cÃ³ overwrite khÃ´ng?**

> **KhÃ´ng!** NÃ³ **appends**. Gá»i 2 láº§n `setRequestHeader("X-Auth", "123")` + `("X-Auth", "456")` â†’ `X-Auth: 123, 456`. KhÃ´ng thá»ƒ xÃ³a header Ä‘Ã£ set.

**397. getAllResponseHeaders tráº£ vá» gÃ¬?**

> **String** cá»§a táº¥t cáº£ headers (trá»« `Set-Cookie`). Separator: `"\r\n"` giá»¯a headers, `": "` giá»¯a name vÃ  value. Parse: `split("\r\n").reduce(...)`.

**398. Upload progress vá»›i XHR tháº¿ nÃ o?**

> `xhr.upload.onprogress = (event) => { event.loaded, event.total }`. RiÃªng object `xhr.upload` vá»›i cÃ¡c events: loadstart/progress/abort/error/load/timeout/loadend. **Æ¬u tháº¿ chÃ­nh cá»§a XHR vs fetch!**

**399. withCredentials dÃ¹ng khi nÃ o?**

> `xhr.withCredentials = true`: gá»­i **cookies + auth** cho **cross-origin** requests. TÆ°Æ¡ng Ä‘Æ°Æ¡ng `credentials: "include"` trong fetch. Cáº§n server há»— trá»£ CORS.

**400. Sync mode lÃ  gÃ¬? CÃ³ nÃªn dÃ¹ng?**

> `xhr.open("GET", url, false)`: JavaScript **block** Ä‘áº¿n khi cÃ³ response. **KhÃ´ng nÃªn dÃ¹ng!** Block UI, khÃ´ng cÃ³ progress, khÃ´ng timeout, khÃ´ng cross-origin.

**401. Lifecycle events cá»§a XHR?**

> `loadstart â†’ progress â†’ abort/error/load/timeout â†’ loadend`. 4 events `error`, `abort`, `timeout`, `load` lÃ  **mutually exclusive** (chá»‰ 1 xáº£y ra).

**402. XHR vs Fetch: khi nÃ o dÃ¹ng cÃ¡i nÃ o?**

> **Fetch**: modern, Promise-based, clean API, ReadableStream. **XHR**: upload progress, legacy support, old browsers. Fetch lÃ  default choice, XHR chá»‰ khi cáº§n upload progress.

**403. Táº¡i sao resumable upload dÃ¹ng XHR chá»© khÃ´ng fetch?**

> Cáº§n **upload progress** (`xhr.upload.onprogress`). Fetch khÃ´ng há»— trá»£ track upload progress. Vá»›i files lá»›n, cáº§n progress indicator cho UX.

**404. fileId táº¡o tháº¿ nÃ o?**

> `file.name + "-" + file.size + "-" + file.lastModified`. Thay Ä‘á»•i báº¥t ká»³ thÃ nh pháº§n nÃ o â†’ fileId má»›i. Server dÃ¹ng Ä‘á»ƒ nháº­n dáº¡ng file cáº§n resume.

**405. Algorithm resumable upload gá»“m máº¥y bÆ°á»›c?**

> 3 bÆ°á»›c: (1) Táº¡o fileId. (2) Fetch há»i server Ä‘Ã£ nháº­n bao nhiÃªu bytes (`startByte`). (3) XHR gá»­i `file.slice(startByte)` vá»›i headers X-File-Id + X-Start-Byte.

**406. Táº¡i sao onprogress khÃ´ng dÃ¹ng Ä‘Æ°á»£c Ä‘á»ƒ resume?**

> `onprogress` chá»‰ biáº¿t data Ä‘Ã£ **gá»­i** (sent), khÃ´ng cháº¯c server Ä‘Ã£ **nháº­n** (received). CÃ³ thá»ƒ bá»‹ **buffer bá»Ÿi proxy**, server crash, máº¥t giá»¯a Ä‘Æ°á»ng. Chá»‰ server biáº¿t chÃ­nh xÃ¡c.

**407. file.slice() dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> `file.slice(startByte)`: táº¡o **Blob** chá»©a pháº§n file tá»« `startByte` Ä‘áº¿n háº¿t. Gá»­i qua `xhr.send()` Ä‘á»ƒ upload pháº§n cÃ²n láº¡i mÃ  khÃ´ng gá»­i láº¡i tá»« Ä‘áº§u.

**408. Progress tÃ­nh tháº¿ nÃ o khi resume?**

> `startByte + event.loaded` / `startByte + event.total`. Cá»™ng `startByte` (pháº§n Ä‘Ã£ upload trÆ°á»›c) vá»›i progress hiá»‡n táº¡i Ä‘á»ƒ Ä‘Æ°á»£c tá»•ng thá»±c táº¿.

**409. Server cáº§n lÃ m gÃ¬ cho resumable upload?**

> Track uploads báº±ng **X-File-Id**. Tráº£ vá» sá»‘ bytes Ä‘Ã£ nháº­n khi client há»i status. Verify **X-Start-Byte** khá»›p vá»›i size hiá»‡n táº¡i. Append data vÃ o file.

**410. Long polling khÃ¡c regular polling tháº¿ nÃ o?**

> Regular: gá»­i request má»—i N giÃ¢y (vÃ­ dá»¥ 10s) â†’ delay + lÃ£ng phÃ­. Long: server **giá»¯ connection** cho Ä‘áº¿n khi cÃ³ data â†’ respond ngay, browser reconnect láº­p tá»©c. **Zero delay**.

**411. Flow cá»§a long polling?**

> (1) Browser gá»­i request â†’ (2) Server giá»¯ connection (pending) â†’ (3) CÃ³ message â†’ server respond â†’ (4) Browser reconnect **ngay** â†’ láº·p láº¡i.

**412. Xá»­ lÃ½ lá»—i trong long polling tháº¿ nÃ o?**

> **502** (connection timeout): reconnect ngay (proxy/server Ä‘Ã³ng). **Lá»—i khÃ¡c**: hiá»ƒn thá»‹, Ä‘á»£i 1s rá»“i reconnect. **200**: xá»­ lÃ½ message + reconnect láº¥y message tiáº¿p.

**413. Server cáº§n gÃ¬ cho long polling?**

> Handle **nhiá»u pending connections** cÃ¹ng lÃºc. Node.js: event-driven, OK. PHP/Ruby: 1 process/connection â†’ tá»‘n memory. Cáº§n kiáº¿n trÃºc async, non-blocking.

**414. Khi nÃ o dÃ¹ng long polling?**

> Messages **hiáº¿m** (rare). Messages nhiá»u â†’ má»—i message = 1 request vá»›i headers overhead â†’ dÃ¹ng **WebSocket** hoáº·c **Server-Sent Events** thay tháº¿.

**415. Táº¡i sao dÃ¹ng recursive async function?**

> `subscribe()` tá»± gá»i láº¡i sau khi nháº­n response. `async/await` giá»¯ code sáº¡ch. Má»—i láº§n call táº¡o request má»›i â†’ **persistent connection** kiá»ƒu Ä‘Æ¡n giáº£n nháº¥t.

**416. Long polling so vá»›i WebSocket?**

> Long polling: **HTTP** requests, Ä‘Æ¡n giáº£n. WebSocket: **persistent bi-directional** connection, nháº¹ hÆ¡n cho messages nhiá»u. Long polling khÃ´ng cáº§n protocol Ä‘áº·c biá»‡t.

**417. WebSocket lÃ  gÃ¬?**

> Protocol (RFC 6455) táº¡o **persistent bi-directional connection** giá»¯a browser vÃ  server. Data truyá»n dáº¡ng "frames" mÃ  khÃ´ng cáº§n HTTP requests má»›i. Tá»‘t cho real-time: games, trading.

**418. Táº¡i sao luÃ´n dÃ¹ng wss thay ws?**

> `wss://` = WebSocket over **TLS** (encrypted). `ws://` khÃ´ng mÃ£ hÃ³a, proxy cÅ© cÃ³ thá»ƒ cháº·n vÃ¬ khÃ´ng hiá»ƒu WebSocket headers. wss Ä‘i qua proxy an toÃ n.

**419. Handshake cá»§a WebSocket hoáº¡t Ä‘á»™ng sao?**

> Browser gá»­i HTTP vá»›i `Connection: Upgrade`, `Upgrade: websocket`, `Sec-WebSocket-Key/Version`. Server tráº£ **101 Switching Protocols** + `Sec-WebSocket-Accept`. KhÃ´ng thá»ƒ emulate báº±ng XHR/fetch.

**420. WebSocket cÃ³ nhá»¯ng events nÃ o?**

> 4 events: `open` (connected), `message` (data received â€” `event.data`), `error` (lá»—i), `close` (`event.code`, `event.reason`, `event.wasClean`).

**421. send() gá»­i Ä‘Æ°á»£c nhá»¯ng gÃ¬?**

> `string`, `Blob`, `ArrayBuffer`, `ArrayBufferView`. KhÃ´ng cáº§n config format. Nháº­n: text luÃ´n string, binary theo `binaryType` ("blob" default hoáº·c "arraybuffer").

**422. bufferedAmount dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Sá»‘ bytes Ä‘ang **Ä‘á»£i gá»­i** trong buffer. Check `bufferedAmount === 0` trÆ°á»›c khi send thÃªm Ä‘á»ƒ trÃ¡nh quÃ¡ táº£i network (rate limiting).

**423. Close codes quan trá»ng nÃ o cáº§n biáº¿t?**

> `1000`: normal close (default). `1006`: connection lost (khÃ´ng set thá»§ cÃ´ng). `1001`: going away. `1009`: message too big. `1011`: server error. Codes < 1000 **reserved**.

**424. readyState cá»§a WebSocket?**

> 0 = CONNECTING, 1 = OPEN, 2 = CLOSING, 3 = CLOSED. Check trÆ°á»›c khi send Ä‘á»ƒ Ä‘áº£m báº£o connection sáºµn sÃ ng.

**425. WebSocket cÃ³ cross-origin khÃ´ng?**

> **KhÃ´ng háº¡n cháº¿** cross-origin (khÃ¡c fetch/XHR). Server dÃ¹ng `Origin` header Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cháº¥p nháº­n hay khÃ´ng.

**426. Subprotocols lÃ  gÃ¬?**

> Parameter thá»© 2 cá»§a constructor: `new WebSocket(url, ["soap", "wamp"])`. MÃ´ táº£ **data format**. Server chá»n protocol há»— trá»£ trong `Sec-WebSocket-Protocol` response.

**427. WebSocket thiáº¿u gÃ¬ cáº§n tá»± implement?**

> **Reconnection**, **authentication**, heartbeat, message queuing. DÃ¹ng libraries (Socket.io, ws) hoáº·c tá»± viáº¿t. API cÆ¡ báº£n ráº¥t Ä‘Æ¡n giáº£n.

**428. WebSocket vs Long Polling vs SSE?**

> **WebSocket**: bi-directional, persistent, real-time. **Long Polling**: HTTP, Ä‘Æ¡n giáº£n, rare messages. **SSE**: serverâ†’client one-way, auto-reconnect. Chá»n theo use case.

**429. EventSource lÃ  gÃ¬?**

> Built-in class táº¡o **persistent connection** vá»›i server, chá»‰ **nháº­n** data (one-directional). DÃ¹ng regular HTTP, chá»‰ text. Auto-reconnect built-in. ÄÆ¡n giáº£n hÆ¡n WebSocket.

**430. SSE khÃ¡c WebSocket tháº¿ nÃ o?**

> SSE: **one-way** (serverâ†’client), **text only**, regular HTTP, **auto-reconnect**. WebSocket: **bi-directional**, text+binary, WS protocol, tá»± implement reconnect. SSE Ä‘á»§ khi chá»‰ cáº§n nháº­n.

**431. Server response cáº§n gÃ¬ cho SSE?**

> Status **200** + `Content-Type: text/event-stream`. Giá»¯ connection vÃ  gá»­i messages dáº¡ng `data: ...\n\n`. Sai Content-Type hoáº·c status â†’ ngá»«ng reconnect.

**432. Server gá»­i message format nÃ o?**

> 4 fields: `data:` (body), `id:` (lastEventId), `retry:` (delay ms), `event:` (custom name). Messages phÃ¢n cÃ¡ch `\n\n`. Nhiá»u `data:` liÃªn tiáº¿p = 1 message vá»›i `\n`.

**433. Auto-reconnect hoáº¡t Ä‘á»™ng sao?**

> Máº¥t connection â†’ browser tá»± **reconnect** (vÃ i giÃ¢y default). Server set `retry: 15000` thay Ä‘á»•i delay. Response **204** â†’ ngá»«ng reconnect. Event `error` fire khi reconnecting.

**434. Message id dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> Server gá»­i `id: 1`. Browser lÆ°u `lastEventId`. Khi reconnect, gá»­i header `Last-Event-ID: 1`. Server gá»­i láº¡i messages **sau** id Ä‘Ã³. Resume khÃ´ng máº¥t data.

**435. Custom events lÃ  gÃ¬?**

> Server gá»­i `event: join\ndata: Bob`. Client dÃ¹ng `addEventListener("join", ...)` (khÃ´ng dÃ¹ng `onmessage`!). `onmessage` chá»‰ báº¯t messages khÃ´ng cÃ³ `event:` field.

**436. readyState cá»§a EventSource?**

> 0 = CONNECTING (connecting/reconnecting), 1 = OPEN (connected), 2 = CLOSED (Ä‘Ã³ng). Check `readyState` trong error handler Ä‘á»ƒ biáº¿t Ä‘ang reconnect hay Ä‘Ã³ng háº£n.

**437. close() cÃ³ reopen Ä‘Æ°á»£c khÃ´ng?**

> **KhÃ´ng!** `source.close()` Ä‘Ã³ng vÄ©nh viá»…n. Muá»‘n káº¿t ná»‘i láº¡i pháº£i táº¡o `new EventSource()` má»›i. KhÃ¡c WebSocket (cÅ©ng khÃ´ng reopen).

**438. EventSource cÃ³ cross-origin khÃ´ng?**

> **CÃ³!** NhÆ° fetch. Server cáº§n `Access-Control-Allow-Origin`. Gá»­i credentials: `new EventSource(url, { withCredentials: true })`.

**439. Khi nÃ o dÃ¹ng SSE thay WebSocket?**

> Chá»‰ cáº§n **nháº­n** data tá»« server: chat messages, stock prices, notifications, live feeds. KhÃ´ng cáº§n gá»­i data ngÆ°á»£c láº¡i. ÄÆ¡n giáº£n, auto-reconnect, khÃ´ng cáº§n protocol má»›i.

**440. retry: cÃ³ set tá»« JavaScript Ä‘Æ°á»£c khÃ´ng?**

> **KhÃ´ng!** Chá»‰ server set trong response: `retry: 15000`. Browser tá»± Ä‘á»™ng Ã¡p dá»¥ng. KhÃ´ng cÃ³ API Ä‘á»ƒ thay Ä‘á»•i tá»« client.

**441. Announce vs Reestablish vs Fail khÃ¡c nhau?**

> **Announce**: set OPEN + fire `open`. **Reestablish** (máº¥t káº¿t ná»‘i): set CONNECTING + fire `error` + Ä‘á»£i retry + gá»­i `Last-Event-ID`. **Fail** (fatal): set CLOSED + fire `error` + **khÃ´ng reconnect**.

**442. Khi nÃ o connection bá»‹ fail?**

> Status **khÃ¡c 200** hoáº·c `Content-Type` **khÃ¡c** `text/event-stream`. LÃºc nÃ y readyState = CLOSED, fire error, **khÃ´ng bao giá» reconnect**.

**443. Comment line trong SSE lÃ  gÃ¬?**

> Line báº¯t Ä‘áº§u báº±ng `:` (colon). Browser **ignore** hoÃ n toÃ n. DÃ¹ng lÃ m **keepalive** má»—i 15s chá»‘ng legacy proxy timeout cáº¯t connection.

**444. data: field xá»­ lÃ½ tháº¿ nÃ o?**

> **Append** vÃ o data buffer + thÃªm `\n`. Nhiá»u `data:` liÃªn tiáº¿p = 1 message join báº±ng `\n`. Khi dispatch, **xÃ³a trailing \n** cuá»‘i cÃ¹ng.

**445. id field cÃ³ háº¡n cháº¿ gÃ¬?**

> Náº¿u chá»©a **U+0000 NULL** â†’ bá»‹ **ignore**. `id` khÃ´ng cÃ³ value (`id\n`) â†’ reset lastEventId vá» `""` â†’ khÃ´ng gá»­i `Last-Event-ID` khi reconnect.

**446. retry field cháº¥p nháº­n giÃ¡ trá»‹ nÃ o?**

> Chá»‰ **ASCII digits** (0-9). `retry: 15000` OK. `retry: abc` bá»‹ **ignore**. Parse lÃ m integer base 10 set lÃ m reconnection time.

**447. Khi nÃ o event KHÃ”NG Ä‘Æ°á»£c dispatch?**

> Data buffer **rá»—ng** (empty string) sau blank line. Buffers Ä‘Æ°á»£c reset mÃ  khÃ´ng fire event. File káº¿t thÃºc **giá»¯a event** (khÃ´ng cÃ³ blank line) â†’ discard.

**448. 6 connection limit lÃ  gÃ¬?**

> HTTP/1.1 giá»›i háº¡n **6 connections/domain**. Nhiá»u tabs má»Ÿ EventSource cÃ¹ng domain â†’ háº¿t slots. Giáº£i phÃ¡p: **SharedWorker** chia sáº» 1 EventSource, hoáº·c unique subdomain.

**449. Cache mode cá»§a EventSource?**

> Theo spec: `cache: "no-store"`. KhÃ´ng cache request. Accept header: `text/event-stream`. CORS: Anonymous hoáº·c Use Credentials.

**450. GC rules cá»§a EventSource?**

> Strong reference khi: CONNECTING + cÃ³ open/message/error listeners, hoáº·c OPEN + cÃ³ message/error listeners. Document unload â†’ **forcibly close**. GC khi connection open â†’ abort.

**451. Space sau colon cÃ³ báº¯t buá»™c khÃ´ng?**

> **KhÃ´ng!** Space sau `:` lÃ  **optional**. `data:test` vÃ  `data: test` cho káº¿t quáº£ giá»‘ng nhau. Náº¿u cÃ³ space, nÃ³ bá»‹ remove khá»i value.

**452. Web Worker lÃ  gÃ¬?**

> Script cháº¡y trong **background thread**, khÃ´ng block UI. Communicate vá»›i main thread qua `postMessage`/`onmessage`. KhÃ´ng truy cáº­p DOM, cÃ³ fetch/WS/IndexedDB.

**453. Dedicated vs Shared Worker?**

> **Dedicated**: 1 script táº¡o, chá»‰ script Ä‘Ã³ dÃ¹ng. **Shared**: nhiá»u scripts/tabs cÃ¹ng dÃ¹ng, pháº£i cÃ¹ng origin. Shared dÃ¹ng **port** object (`port.postMessage`), Dedicated dÃ¹ng trá»±c tiáº¿p.

**454. Data truyá»n giá»¯a threads tháº¿ nÃ o?**

> 3 cÃ¡ch: **Structured clone** (default, copy, há»— trá»£ JSON + circular ref). **Transferable** (zero-copy, original cleared, vÃ­ dá»¥ ArrayBuffer). **SharedArrayBuffer** (shared memory, cáº£ 2 tháº¥y).

**455. Transferable objects hoáº¡t Ä‘á»™ng sao?**

> `postMessage(buffer, [buffer])` â€” chuyá»ƒn **ownership**, khÃ´ng copy. Original bá»‹ cleared (`byteLength === 0`). Hiá»‡u suáº¥t cao cho data lá»›n (vÃ­ dá»¥ 32MB ArrayBuffer).

**456. Táº¡i sao Web Worker khÃ´ng gÃ¢y race condition?**

> Communication qua **serialized messages** (postMessage). KhÃ´ng access DOM, khÃ´ng shared state (trá»« SharedArrayBuffer). "You have to work really hard to cause problems."

**457. Worker cÃ³ truy cáº­p Ä‘Æ°á»£c gÃ¬?**

> `fetch()`, `WebSocket`, `IndexedDB`, `setTimeout/setInterval`, `Navigator`, `Array/Date/Math/String`. **KhÃ´ng**: DOM, `window` (dÃ¹ng `self`), parent page objects.

**458. importScripts() hoáº¡t Ä‘á»™ng sao?**

> **Synchronous**! Download báº¥t ká»³ order, execute **theo thá»© tá»±** truyá»n vÃ o. Load fail â†’ NETWORK_ERROR. Code trÆ°á»›c váº«n hoáº¡t Ä‘á»™ng.

**459. terminate() vs close() trong Worker?**

> Main thread: `worker.terminate()` kill ngay. Trong worker: `self.close()` tá»± Ä‘Ã³ng. Terminate khÃ´ng cho worker dá»n dáº¹p.

**460. Shared Worker dÃ¹ng port tháº¿ nÃ o?**

> Main: `shared.port.postMessage()`, `shared.port.onmessage`. Worker: `onconnect = (e) => { const port = e.ports[0]; port.onmessage = ... }`. `port.start()` cáº§n náº¿u dÃ¹ng addEventListener.

**461. Embedded Worker lÃ  gÃ¬?**

> Táº¡o worker tá»« **Blob URL** thay vÃ¬ file. `new Blob([code], {type: "text/javascript"})` + `URL.createObjectURL(blob)`. KhÃ´ng cáº§n file riÃªng.

**462. CSP cá»§a Worker?**

> Worker cÃ³ **CSP riÃªng**, khÃ´ng inherit parent document. Parent cáº¥m `eval()` nhÆ°ng worker cÃ³ thá»ƒ dÃ¹ng. Ngoáº¡i lá»‡: blob/data URL workers inherit CSP.

**463. onerror cá»§a Worker nháº­n gÃ¬?**

> ErrorEvent vá»›i 3 fields: `message` (human-readable), `filename` (script file), `lineno` (line number). Event khÃ´ng bubble, cancelable.

**464. Subworkers cÃ³ háº¡n cháº¿ gÃ¬?**

> Pháº£i cÃ¹ng **origin** vá»›i parent page. URI resolve **relative to parent worker** (khÃ´ng pháº£i owning page).

**465. ServiceWorker khÃ¡c Web Worker?**

> **ServiceWorker**: **proxy** giá»¯a app vÃ  network, offline experience, push notifications, background sync. **Web Worker**: background computation, khÃ´ng cÃ³ network proxy capabilities.

**466. Worker cÃ³ nhá»¯ng global functions nÃ o?**

> `setTimeout/setInterval`, `fetch()`, `atob/btoa`, `structuredClone()`, `queueMicrotask()`, `reportError()`, `createImageBitmap()`. **Worker-only**: `importScripts()`. **Dedicated-only**: `postMessage()`, `requestAnimationFrame()`.

**467. Web APIs nÃ o cÃ³ trong Worker?**

> **Network**: Fetch, XHR, WebSocket, SSE. **Storage**: IndexedDB, Cache. **Graphics**: Canvas, WebGL, WebGPU. **Crypto**: Web Crypto, Web Locks. **Media**: WebCodecs, MediaCapabilities. **Background**: Push, Notifications, BackgroundSync.

**468. APIs nÃ o KHÃ”NG cÃ³ trong Worker?**

> **DOM** (document, Element), **window** object, `alert()/confirm()/prompt()`, `localStorage/sessionStorage` (dÃ¹ng IndexedDB thay). XHR khÃ´ng cÃ³ `responseXML`.

**469. importScripts chá»‰ cÃ³ trong Worker?**

> **ÄÃºng!** `importScripts()` lÃ  **worker-only**. Main thread dÃ¹ng `<script>` tags hoáº·c ES modules. importScripts lÃ  synchronous, load + execute theo thá»© tá»±.

**470. requestAnimationFrame cÃ³ trong Worker khÃ´ng?**

> Chá»‰ trong **Dedicated Worker** (khÃ´ng cÃ³ trong Shared/Service Worker). DÃ¹ng cho OffscreenCanvas rendering. `cancelAnimationFrame()` cÅ©ng cÃ³.

**471. Worker dÃ¹ng gÃ¬ thay localStorage?**

> **IndexedDB** â€” async, há»— trá»£ structured data, cÃ³ trong má»i loáº¡i worker. Cache API cho ServiceWorker. Cookie Store API chá»‰ cÃ³ trong ServiceWorker.

**472. BroadcastChannel dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬ trong Worker?**

> Communicate giá»¯a **nhiá»u tabs/workers** cÃ¹ng origin mÃ  khÃ´ng cáº§n reference trá»±c tiáº¿p. ÄÆ¡n giáº£n hÆ¡n SharedWorker cho broadcast messages.

**473. Worker cÃ³ thá»ƒ táº¡o Worker khÃ¡c khÃ´ng?**

> **CÃ³!** Workers spawn sub-workers. APIs `Worker`, `WorkerGlobalScope`, `WorkerLocation`, `WorkerNavigator` Ä‘á»u cÃ³. Sub-workers pháº£i cÃ¹ng origin.

**474. Structured clone algorithm lÃ  gÃ¬?**

> **Deep copy** algorithm dÃ¹ng recursion + **cycle detection** map. DÃ¹ng trong `structuredClone()`, `postMessage()`, IndexedDB. Clone Ä‘Æ°á»£c circular references.

**475. Structured clone KHÃ”NG clone Ä‘Æ°á»£c gÃ¬?**

> **Functions** â†’ DataCloneError. **DOM nodes** â†’ DataCloneError. **Symbol** bá»‹ máº¥t. Property **descriptors/getters/setters** khÃ´ng preserved. **Prototype chain** khÃ´ng walked. Class **private fields** khÃ´ng clone.

**476. RegExp clone cÃ³ gÃ¬ Ä‘áº·c biá»‡t?**

> RegExp **clone Ä‘Æ°á»£c** nhÆ°ng `lastIndex` **reset vá» 0**. Pattern vÃ  flags preserved, lastIndex khÃ´ng.

**477. Property descriptors khi clone?**

> **Máº¥t hoÃ n toÃ n!** Object `readonly` (writable: false) â†’ clone thÃ nh **read/write** (default). Getters/setters â†’ chá»‰ láº¥y **giÃ¡ trá»‹ tÄ©nh**.

**478. Prototype chain cÃ³ clone khÃ´ng?**

> **KhÃ´ng!** `class Dog { bark() {} }` â†’ clone máº¥t prototype. `cloneDog instanceof Dog === false`. Methods trÃªn prototype **undefined**.

**479. Error types clone tháº¿ nÃ o?**

> Serialize `name` + `message` + `stack` + `cause`. TÃªn pháº£i lÃ  Error/TypeError/RangeError/ReferenceError/SyntaxError/EvalError/URIError. TÃªn khÃ¡c â†’ set thÃ nh "Error".

**480. Circular reference cÃ³ clone Ä‘Æ°á»£c khÃ´ng?**

> **CÃ³!** Structured clone dÃ¹ng **visited map** â†’ khÃ´ng infinite loop. `const obj = {}; obj.self = obj; structuredClone(obj)` â†’ OK.

**481. Web/API types nÃ o clone Ä‘Æ°á»£c?**

> **Blob, File, FileList, ImageBitmap, ImageData, CryptoKey**, DOMMatrix/Point/Quad/Rect, DOMException, AudioData, VideoFrame, FileSystemHandle, RTCCertificate. Marked `[Serializable]` trong Web IDL.

**482. structuredClone vs JSON.parse(JSON.stringify)?**

> Structured clone: **circular ref OK**, **Date/RegExp/Map/Set/ArrayBuffer** preserved. JSON: máº¥t Date (thÃ nh string), máº¥t RegExp/Map/Set, **circular ref â†’ error**. Cáº£ hai Ä‘á»u máº¥t functions.

**483. Transferable object lÃ  gÃ¬?**

> Object cÃ³ resources Ä‘Æ°á»£c **chuyá»ƒn ownership** (khÃ´ng copy). Original bá»‹ **detach**, khÃ´ng dÃ¹ng Ä‘Æ°á»£c ná»¯a. Read/write sau transfer â†’ throw exception.

**484. Transfer khÃ¡c clone (structured clone) sao?**

> **Clone** = copy (cáº£ 2 dÃ¹ng Ä‘Æ°á»£c). **Transfer** = move (original detach, chá»‰ receiver dÃ¹ng). Transfer nhanh hÆ¡n vÃ¬ **zero-copy**.

**485. TypedArray cÃ³ transferable khÃ´ng?**

> **KhÃ´ng!** TypedArray (Uint8Array, Int32Array...) lÃ  **serializable** (clone Ä‘Æ°á»£c) nhÆ°ng khÃ´ng **transferable**. Pháº£i transfer **`.buffer`** (ArrayBuffer) thay vÃ¬ TypedArray.

**486. postMessage transfer cÃº phÃ¡p tháº¿ nÃ o?**

> `worker.postMessage(data, [transferList])`. Data lÃ  object chá»©a resources, transferList lÃ  array cÃ¡c resources cáº§n transfer. Resources **pháº£i attach** vÃ o data.

**487. structuredClone transfer cÃº phÃ¡p?**

> `structuredClone(data, { transfer: [original.buffer] })`. Move thay vÃ¬ copy. `original.byteLength === 0` sau transfer.

**488. byteLength sau transfer lÃ  bao nhiÃªu?**

> **0!** ArrayBuffer bá»‹ detach, `byteLength = 0`. Báº¥t ká»³ read/write â†’ throw. TypedArray dÃ¹ng buffer Ä‘Ã³ cÅ©ng bá»‹ áº£nh hÆ°á»Ÿng.

**489. Nhá»¯ng objects nÃ o transferable?**

> **ArrayBuffer**, **MessagePort**, **ReadableStream/WritableStream/TransformStream**, **ImageBitmap**, **OffscreenCanvas**, AudioData, VideoFrame, RTCDataChannel, MIDIAccess. Marked `[Transferable]` trong Web IDL.

**490. Serializable vs Transferable?**

> **Serializable** = clone Ä‘Æ°á»£c (cáº£ 2 tá»“n táº¡i). **Transferable** = move Ä‘Æ°á»£c (original detach). Má»™t object cÃ³ thá»ƒ lÃ  cáº£ 2, chá»‰ 1, hoáº·c khÃ´ng. ArrayBuffer: cáº£ 2.

**491. Worker constructor nháº­n gÃ¬?**

> `new Worker(url)` hoáº·c `new Worker(url, { name })`. Name dÃ¹ng cho debugging. CÃ³ thá»ƒ dÃ¹ng Blob URLs. Workers cÃ³ thá»ƒ táº¡o sub-workers.

**492. terminate() vs close() trong Worker?**

> **Main thread**: `worker.terminate()` kill ngay, khÃ´ng cho dá»n dáº¹p. **Trong worker**: `self.close()` há»§y tasks trong event loop, Ä‘Ã³ng scope. ServiceWorker **khÃ´ng** há»— trá»£ terminate().

**493. messageerror event lÃ  gÃ¬?**

> Fire khi nháº­n message **khÃ´ng deserialize Ä‘Æ°á»£c**. VÃ­ dá»¥ data chá»©a types khÃ´ng há»— trá»£ structured clone. KhÃ¡c message event (deserialize thÃ nh cÃ´ng).

**494. SharedWorker.port lÃ  gÃ¬?**

> **MessagePort** â€” kÃªnh giao tiáº¿p duy nháº¥t vá»›i shared worker. `port.postMessage()`, `port.onmessage`. `port.start()` cáº§n náº¿u dÃ¹ng addEventListener.

**495. onconnect trong SharedWorkerGlobalScope?**

> Fire khi **client má»›i** káº¿t ná»‘i. `e.ports[0]` lÃ  MessagePort cá»§a client Ä‘Ã³. Set `port.onmessage` trong handler. `port.start()` cáº§n náº¿u dÃ¹ng addEventListener.

**496. WorkerGlobalScope cÃ³ nhá»¯ng properties gÃ¬?**

> `self` (reference), `location` (WorkerLocation), `navigator` (WorkerNavigator), `caches` (CacheStorage), `crypto`, `indexedDB`, `performance`, `isSecureContext`, `origin`, `fonts`, `scheduler`, `trustedTypes`.

**497. WorkerGlobalScope events nÃ o?**

> `error` (runtime), `online/offline` (network), `languagechange`, `unhandledrejection/rejectionhandled` (Promise), `securitypolicyviolation` (CSP).

**498. WorkerLocation khÃ¡c Location?**

> **Subset read-only**: `href`, `protocol`, `host`, `hostname`, `origin`, `port`, `pathname`, `search`, `hash`. `toString() === href`. KhÃ´ng cÃ³ `assign()`, `replace()`, `reload()`.

**499. WorkerNavigator cÃ³ nhá»¯ng gÃ¬ quan trá»ng?**

> `onLine` (máº¡ng), `hardwareConcurrency` (CPU cores), `language/languages`, `connection` (NetworkInfo), `deviceMemory` (GB), `locks` (Web Locks), `permissions`, `gpu` (WebGPU), `storage`, `userAgent`.

**500. DedicatedWorkerGlobalScope cÃ³ gÃ¬ Ä‘áº·c biá»‡t?**

> `name` (optional, debugging), `close()`, `postMessage()`, **`requestAnimationFrame()`** (cho OffscreenCanvas), `cancelAnimationFrame()`. Events: `message`, `messageerror`.

**501. SharedWorker alive khi nÃ o?**

> Khi cÃ²n **Document hoáº·c WorkerGlobalScope** giá»¯ reference (owner set khÃ´ng empty). Táº¥t cáº£ pages Ä‘Ã³ng â†’ shared worker bá»‹ há»§y.

**502. rAF trong Worker dÃ¹ng khi nÃ o?**

> Chá»‰ **Dedicated Worker** vá»›i **OffscreenCanvas**. Render canvas trong background thread, khÃ´ng block main thread UI. Shared/Service Worker khÃ´ng cÃ³ rAF.

**503. Service Worker lÃ  gÃ¬?**

> **Proxy server** giá»¯a app/browser/network. Event-driven worker, intercept network requests, cho phÃ©p **offline-first** experience. HTTPS only (localhost OK).

**504. Service Worker lifecycle?**

> **Download â†’ Install â†’ Activate**. First visit: download + install + activate. Update: new version install in background, **worker-in-waiting** cho Ä‘áº¿n pages cÅ© Ä‘Ã³ng. `skipWaiting()` + `clients.claim()` bá» qua.

**505. CÃ¡ch register Service Worker?**

> `navigator.serviceWorker.register('/sw.js', { scope: '/' })`. Scope máº·c Ä‘á»‹nh = directory chá»©a sw.js. Má»Ÿ rá»™ng scope vá»›i `Service-Worker-Allowed` header.

**506. waitUntil() dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> **ExtendableEvent.waitUntil(promise)** giá»¯ SW alive cho Ä‘áº¿n promise resolve. DÃ¹ng trong `install` (populate cache) vÃ  `activate` (dá»n cache cÅ©). Promise reject â†’ install lá»—i.

**507. respondWith() hoáº¡t Ä‘á»™ng sao?**

> **FetchEvent.respondWith(response)** intercept request, tráº£ vá» **custom response**. CÃ³ thá»ƒ tá»« cache, network, hoáº·c tá»± táº¡o `new Response()`.

**508. Cache-first strategy?**

> Check **cache trÆ°á»›c**, náº¿u cÃ³ tráº£ vá» ngay. KhÃ´ng cÃ³ â†’ **fetch tá»« network**, clone response, lÆ°u vÃ o cache. Network lá»—i â†’ **fallback** response.

**509. Táº¡i sao cáº§n response.clone()?**

> Response lÃ  **stream, chá»‰ Ä‘á»c 1 láº§n**! 1 báº£n tráº£ vá» browser, 1 báº£n lÆ°u cache. KhÃ´ng clone â†’ máº¥t data.

**510. skipWaiting() vÃ  clients.claim()?**

> `skipWaiting()` trong install: **activate ngay**, bá» qua waiting state. `clients.claim()` trong activate: **control pages Ä‘ang má»Ÿ** ngay, khÃ´ng cáº§n reload.

**511. Worker-in-waiting lÃ  gÃ¬?**

> New version **Ä‘Ã£ install** nhÆ°ng chÆ°a activate. Chá» táº¥t cáº£ pages dÃ¹ng old worker Ä‘Ã³ng. DÃ¹ng `skipWaiting()` Ä‘á»ƒ bá» qua.

**512. CÃ¡ch dá»n cache cÅ©?**

> Trong **activate** event: `caches.keys()` láº¥y táº¥t cáº£ tÃªn, filter giá»¯ láº¡i version má»›i, `caches.delete()` cÃ¡c cache cÅ©. `waitUntil()` Ä‘áº£m báº£o xong trÆ°á»›c fetch events.

**513. Navigation preload lÃ  gÃ¬?**

> Download resources **song song vá»›i SW startup**, giáº£m delay. Enable trong activate: `registration.navigationPreload.enable()`. DÃ¹ng `event.preloadResponse` trong fetch handler.

**514. Cache API vs localStorage?**

> **Cache API**: async, lÆ°u Request/Response pairs, dÃ¹ng trong SW. **localStorage**: sync (**cáº¥m** trong SW), lÆ°u string key-value. SW dÃ¹ng Cache API hoáº·c IndexedDB.

**515. Scope cá»§a Service Worker lÃ  gÃ¬?**

> **Pháº¡m vi URLs** mÃ  SW control. Máº·c Ä‘á»‹nh: directory chá»©a sw.js. `/js/sw.js` chá»‰ control `/js/*`. Má»Ÿ rá»™ng vá»›i `Service-Worker-Allowed` header hoáº·c Ä‘áº·t sw.js á»Ÿ root.

**516. Nhá»¯ng API nÃ o KHÃ”NG dÃ¹ng Ä‘Æ°á»£c trong SW?**

> **DOM** (document, Element), **sync XHR**, **localStorage/sessionStorage**, **dynamic import()**, `alert/confirm/prompt`. DÃ¹ng IndexedDB vÃ  Cache API thay tháº¿.

**517. FetchEvent cÃ³ nhá»¯ng properties gÃ¬?**

> `request` (Request object), `respondWith(response)` (custom response), `preloadResponse` (Promise, navigation preload), `clientId`, `resultingClientId`.

**518. Service Worker vs AppCache?**

> SW: **full control**, programmatic caching, khÃ´ng assumptions. AppCache: declarative, **dá»… vá»¡**, assumptions dáº«n Ä‘áº¿n bugs. AppCache **deprecated**, SW lÃ  replacement.

**519. History API lÃ  gÃ¬?**

> Cho phÃ©p **tÆ°Æ¡ng tÃ¡c vá»›i session history** cá»§a browser. `window.history` lÃ  singleton, chá»‰ main thread. Navigate: `back/forward/go`. Modify: `pushState/replaceState`.

**520. pushState() hoáº¡t Ä‘á»™ng sao?**

> `pushState(state, "", url)` **thÃªm entry má»›i** vÃ o history stack. KhÃ´ng reload page. State pháº£i serializable, URL pháº£i same-origin. Title luÃ´n truyá»n `""` (bá»‹ ignore trá»« Safari).

**521. replaceState() khÃ¡c pushState()?**

> `replaceState()` **cáº­p nháº­t entry hiá»‡n táº¡i**, khÃ´ng thÃªm má»›i. pushState **thÃªm entry**. Cáº£ 2 Ä‘á»u khÃ´ng reload page, khÃ´ng trigger popstate.

**522. popstate event fire khi nÃ o?**

> Khi **active history entry thay Ä‘á»•i** â€” back/forward button, `history.back/forward/go()`. **KHÃ”NG fire** khi gá»i `pushState()` hay `replaceState()` trá»±c tiáº¿p.

**523. event.state chá»©a gÃ¬?**

> **Copy** of state object tá»« `pushState/replaceState`. Read-only. Entry khÃ´ng cÃ³ state â†’ `null`. CÃ³ thá»ƒ xem trÆ°á»›c qua `history.state` mÃ  khÃ´ng cáº§n chá» popstate.

**524. SPA dÃ¹ng History API tháº¿ nÃ o?**

> 1. `replaceState()` lÆ°u state ban Ä‘áº§u. 2) Click link â†’ fetch data + `pushState()` synthesize navigation. 3) `popstate` listener restore state khi back/forward.

**525. Táº¡i sao cáº§n replaceState cho initial page?**

> Entry ban Ä‘áº§u **khÃ´ng cÃ³ state** (null). Khi user back vá», popstate cÃ³ `state: null` â†’ khÃ´ng restore Ä‘Æ°á»£c. `replaceState()` gÃ¡n state Ä‘á»ƒ popstate handler hoáº¡t Ä‘á»™ng.

**526. history.go() hoáº¡t Ä‘á»™ng sao?**

> `go(n)` navigate tÆ°Æ¡ng Ä‘á»‘i: `-1` = back, `1` = forward. `go(0)` hoáº·c `go()` = **reload**. Out-of-bounds â†’ **silent**, khÃ´ng lá»—i.

**527. scrollRestoration lÃ  gÃ¬?**

> `history.scrollRestoration`: `'auto'` (browser tá»± restore scroll position) hoáº·c `'manual'` (app tá»± control). Há»¯u Ã­ch cho SPA cáº§n custom scroll behavior.

**528. Security constraints cá»§a History API?**

> KhÃ´ng access **URLs cá»§a pages khÃ¡c**. KhÃ´ng **clear** hay **disable** history. `location.replace()` thay tháº¿ entry hiá»‡n táº¡i. pushState URL **pháº£i same-origin**.

**529. popstate edge cases?**

> `window.location` Ä‘Ã£ update nhÆ°ng **document cÃ³ thá»ƒ chÆ°a sáºµn sÃ ng** â†’ dÃ¹ng `setTimeout(fn, 0)`. Browsers cÃ³ thá»ƒ **khÃ´ng fire** popstate náº¿u page chÆ°a Ä‘Æ°á»£c interact.

**530. history.length cho biáº¿t gÃ¬?**

> Sá»‘ **entries trong session history** (including current page). Tab má»›i â†’ `1`. Má»—i `pushState()` â†’ tÄƒng 1. `replaceState()` â†’ **khÃ´ng tÄƒng** (thay tháº¿ entry hiá»‡n táº¡i).

**531. fetch() khÃ¡c XMLHttpRequest gÃ¬?**

> **Promise-based** (XHR dÃ¹ng callbacks), tÃ­ch há»£p Service Worker + CORS, available trong window + Worker. Tráº£ `Promise<Response>`. XHR cÃ³ `onreadystatechange`.

**532. fetch() cÃ³ reject khi 404/500 khÃ´ng?**

> **KHÃ”NG!** Chá»‰ reject khi **network error** hoáº·c bad scheme. 404/500 váº«n resolve bÃ¬nh thÆ°á»ng. **LuÃ´n check `response.ok`** hoáº·c `response.status`.

**533. Fetch body types nÃ o?**

> `string`, `ArrayBuffer`, `TypedArray`, `DataView`, `Blob`, `File`, `URLSearchParams`, `FormData`, `ReadableStream`. Objects khÃ¡c â†’ `toString()`.

**534. Táº¡i sao body chá»‰ Ä‘á»c 1 láº§n?**

> Request/Response body lÃ  **ReadableStream**. Stream **locked** sau khi attach reader, **disturbed** sau khi Ä‘á»c. Äá»c láº§n 2 â†’ throw. Giáº£i phÃ¡p: `clone()` trÆ°á»›c khi Ä‘á»c.

**535. Mode cors vs no-cors vs same-origin?**

> **cors** (default): CORS mechanism, preflight náº¿u not simple. **same-origin**: reject cross-origin. **no-cors**: opaque response (status=0, body=null), methods chá»‰ GET/HEAD/POST.

**536. Credentials option lÃ  gÃ¬?**

> Control cookies/TLS certs/Auth headers. **same-origin** (default): same-origin only. **include**: luÃ´n gá»­i. **omit**: khÃ´ng gá»­i. `include` + cross-origin cáº§n `Access-Control-Allow-Credentials: true`.

**537. AbortController dÃ¹ng tháº¿ nÃ o?**

> `new AbortController()`, truyá»n `signal` vÃ o fetch options. Gá»i `controller.abort()` â†’ Promise reject vá»›i **AbortError**. Abort sau fetch fulfilled â†’ read body cÅ©ng throw.

**538. Response type cÃ³ máº¥y loáº¡i?**

> **basic** (same-origin), **cors** (cross-origin CORS), **opaque** (no-cors, status=0, body=null), **opaqueredirect** (redirect='manual'). Type quyáº¿t Ä‘á»‹nh headers/body nÃ o accessible.

**539. Response body methods?**

> `json()`, `text()`, `blob()`, `arrayBuffer()`, `formData()`. Táº¥t cáº£ **async** (tráº£ Promise). Chá»‰ Ä‘á»c **1 láº§n** vÃ¬ body lÃ  stream.

**540. response.clone() dÃ¹ng khi nÃ o?**

> Khi cáº§n **Ä‘á»c body nhiá»u láº§n**. VÃ­ dá»¥ Service Worker: clone â†’ tráº£ original cho browser, cache clone. Clone **PHáº¢I** trÆ°á»›c khi Ä‘á»c body.

**541. Streaming response body?**

> `response.body` = **ReadableStream**. `pipeThrough(new TextDecoderStream())` decode UTF-8. `for await (const chunk of stream)` xá»­ lÃ½ incremental. Tiáº¿t kiá»‡m memory.

**542. Headers object cÃ³ gÃ¬ Ä‘áº·c biá»‡t?**

> **Sanitization**: lowercase header names, trim whitespace. **Forbidden headers** (Host, Cookie...) browser tá»± set. `no-cors` chá»‰ CORS-safelisted headers.

**543. GET request gá»­i data sao?**

> Append **query string** vÃ o URL: `new URLSearchParams({key: 'value'})` â†’ `fetch(\`/api?\${params}\`)`. GET **khÃ´ng cÃ³ body**.

**544. Request object dÃ¹ng khi nÃ o?**

> `new Request(url, options)` â€” cÃ¹ng params nhÆ° `fetch()`. Táº¡o request rá»“i truyá»n vÃ o `fetch(request)`. Clone: `new Request(oldReq, {body: newBody})`.

**545. fetchLater() lÃ  gÃ¬?**

> **Deferred fetch** cho end-of-visit beaconing (analytics). Gá»­i khi **tab Ä‘Ã³ng** hoáº·c sau `activateAfter` timeout. Quota: **640KiB/document** (512KiB top-level + 128KiB subframes). Há»§y báº±ng AbortController.

**546. Credentials include + cross-origin cáº§n gÃ¬?**

> Server **PHáº¢I** set `Access-Control-Allow-Credentials: true` VÃ€ `Access-Control-Allow-Origin` explicit (KHÃ”NG wildcard `*`). SameSite=Strict/Lax cookies váº«n khÃ´ng gá»­i cross-site.

**547. Cookie lÃ  gÃ¬ vÃ  hoáº¡t Ä‘á»™ng sao?**

> Strings nhá» lÆ°u trong browser. Server set qua **Set-Cookie** header, browser tá»± gá»­i qua **Cookie** header á»Ÿ má»—i request cÃ¹ng domain. DÃ¹ng cho authentication, session tracking.

**548. document.cookie hoáº¡t Ä‘á»™ng sao?**

> **Accessor** (getter/setter). Read: tráº£ táº¥t cáº£ cookies `"name1=val1; name2=val2"`. Write: **chá»‰ update cookie Ä‘Æ°á»£c mention**, khÃ´ng ghi Ä‘Ã¨ táº¥t cáº£. Cáº§n `encodeURIComponent()`.

**549. Cookie limits?**

> **4KB/cookie** (sau encode). ~**20+ cookies/domain** (tÃ¹y browser). Chá»‰ set/update **1 cookie** má»—i láº§n qua `document.cookie`.

**550. Cookie path attribute?**

> URL prefix. `path=/` â†’ accessible má»i trang. `path=/admin` â†’ chá»‰ `/admin` vÃ  `/admin/*`. Default: **current path**.

**551. Cookie domain attribute?**

> Máº·c Ä‘á»‹nh chá»‰ **domain set cookie** (khÃ´ng subdomains). `domain=site.com` â†’ accessible táº¡i `*.site.com`. KhÃ´ng set Ä‘Æ°á»£c domain khÃ¡c 2nd-level.

**552. expires vs max-age?**

> **expires**: GMT date string (`date.toUTCString()`). **max-age**: seconds tá»« hiá»‡n táº¡i. max-age cÃ³ **precedence**. KhÃ´ng set â†’ **session cookie** (xÃ³a khi Ä‘Ã³ng browser). `max-age=0` = xÃ³a ngay.

**553. Cookie secure attribute?**

> Chá»‰ gá»­i qua **HTTPS**. Máº·c Ä‘á»‹nh cookies khÃ´ng phÃ¢n biá»‡t protocol. `secure` Ä‘áº£m báº£o dá»¯ liá»‡u nháº¡y cáº£m khÃ´ng gá»­i qua HTTP.

**554. httpOnly cookie?**

> Chá»‰ set qua **Set-Cookie header** (server). JS **KHÃ”NG access** Ä‘Æ°á»£c qua `document.cookie`. Báº£o vá»‡ khá»i **XSS** â€” hacker inject JS khÃ´ng Ä‘á»c Ä‘Æ°á»£c auth cookies.

**555. samesite=strict vs lax vs none?**

> **strict**: khÃ´ng gá»­i tá»« site khÃ¡c (ká»ƒ cáº£ click link). **lax** (default): gá»­i náº¿u safe GET + top-level navigation. **none**: luÃ´n gá»­i, **Báº®T BUá»˜C** kÃ¨m `secure`. Báº£o vá»‡ **XSRF**.

**556. XSRF attack vÃ  samesite?**

> evil.com submit form Ä‘áº¿n bank.com â†’ browser gá»­i cookies â†’ bank thá»±c hiá»‡n giao dá»‹ch. **samesite=strict/lax** ngÄƒn gá»­i cookie tá»« cross-site, cháº·n attack.

**557. Third-party cookies lÃ  gÃ¬?**

> Cookie set bá»Ÿi **domain khÃ¡c** trang Ä‘ang truy cáº­p. VÃ­ dá»¥: ads.com banner trÃªn site.com. DÃ¹ng cho **tracking**. Safari block máº·c Ä‘á»‹nh, Chrome phasing out.

**558. Script third-party set cookie thuá»™c domain nÃ o?**

> `<script src="analytics.com">` set cookie â†’ cookie thuá»™c **domain HIá»†N Táº I** (khÃ´ng pháº£i third-party). Script's origin khÃ´ng quyáº¿t Ä‘á»‹nh, domain trang web quyáº¿t Ä‘á»‹nh.

**559. XÃ³a cookie báº±ng cÃ¡ch nÃ o?**

> Set `max-age=0` hoáº·c `max-age=-1`, hoáº·c `expires` ngÃ y quÃ¡ khá»©. **PHáº¢I** dÃ¹ng cÃ¹ng `path` vÃ  `domain` khi set. KhÃ´ng cÃ³ API xÃ³a trá»±c tiáº¿p.

**560. GDPR yÃªu cáº§u gÃ¬ vá»›i cookies?**

> **Explicit consent** cho tracking/identifying cookies. Functional cookies (khÃ´ng track) khÃ´ng cáº§n. 2 pattern: checkbox registration hoáº·c modal splash screen.

**561. IndexedDB khÃ¡c localStorage gÃ¬?**

> IndexedDB: **key-value DB**, any serializable values, **transactions**, indexes, key ranges, **khÃ´ng giá»›i háº¡n 5MB**. localStorage: chá»‰ strings, 5-10MB, synchronous, khÃ´ng transactions.

**562. indexedDB.open() hoáº¡t Ä‘á»™ng sao?**

> `open(name, version)` tráº£ `openRequest`. Events: **upgradeneeded** (version < specified hoáº·c DB má»›i), **success** (DB ready), **error**. DB scoped theo **origin**.

**563. upgradeneeded event dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> **Schema migration**: táº¡o/xÃ³a object stores, táº¡o indexes. Fire khi version < specified hoáº·c DB chÆ°a tá»“n táº¡i. `event.oldVersion` cho biáº¿t version cÅ©. DÃ¹ng **switch case** cho incremental upgrades.

**564. Object store lÃ  gÃ¬?**

> TÆ°Æ¡ng Ä‘Æ°Æ¡ng **table**. Táº¡o báº±ng `db.createObjectStore(name, {keyPath/autoIncrement})`. **Chá»‰ táº¡o/xÃ³a trong upgradeneeded**. Key types: number, date, string, binary, array.

**565. keyPath vs autoIncrement?**

> **keyPath**: property cá»§a object lÃ m key (vÃ­ dá»¥ `'id'`). **autoIncrement**: key tá»± tÄƒng. KhÃ´ng set â†’ pháº£i cung cáº¥p key khi add. CÃ³ thá»ƒ dÃ¹ng cáº£ 2.

**566. Transaction types trong IndexedDB?**

> **readonly** (default): nhiá»u transaction Ä‘á»c cÃ¹ng store. **readwrite**: LOCK store. **versionchange**: tá»± táº¡o trong upgradeneeded, cÃ³ thá»ƒ táº¡o/xÃ³a object stores.

**567. Transaction autocommit nghÄ©a gÃ¬?**

> Tá»± commit khi **má»i requests hoÃ n thÃ nh** + **microtask queue trá»‘ng**. KHÃ”NG Ä‘áº·t fetch/setTimeout trong transaction â†’ **TransactionInactiveError**. Fetch trÆ°á»›c, rá»“i má»›i transaction.

**568. add() vs put()?**

> `add()`: **ConstraintError** náº¿u key Ä‘Ã£ tá»“n táº¡i. `put()`: **replace** náº¿u key Ä‘Ã£ tá»“n táº¡i. Cáº£ 2 Ä‘á»u add náº¿u key chÆ°a cÃ³.

**569. IDBKeyRange dÃ¹ng tháº¿ nÃ o?**

> `lowerBound(x)` â‰¥x, `upperBound(x)` â‰¤x, `bound(a,b)` aâ‰¤xâ‰¤b, `only(x)` =x. Tham sá»‘ `open` = exclusive. DÃ¹ng vá»›i `getAll/getAllKeys/count/openCursor`.

**570. Index trong IndexedDB?**

> `store.createIndex(name, keyPath, {unique, multiEntry})` trong upgradeneeded. Search by **object field** (not key). Results **sorted by index field**. `multiEntry`: array values â†’ má»—i pháº§n tá»­ thÃ nh key.

**571. Cursor dÃ¹ng khi nÃ o?**

> Khi data **quÃ¡ lá»›n** cho `getAll()`. `openCursor(query, direction)`: tráº£ 1 record/láº§n. `cursor.continue()`, `cursor.advance(n)`. Direction: `next/prev/nextunique/prevunique`.

**572. Event delegation trong IndexedDB?**

> Events **bubble**: request â†’ transaction â†’ database. `db.onerror` catch all errors. `event.preventDefault()` ngÄƒn abort transaction. `event.stopPropagation()` ngÄƒn bubble.

**573. Parallel update problem?**

> Tab A má»Ÿ DB v1, tab B muá»‘n upgrade v2. `db.onversionchange`: close DB cÅ©. `openRequest.onblocked`: tab cÅ© chÆ°a close. DB **shared per origin**, khÃ´ng thá»ƒ 2 versions cÃ¹ng lÃºc.

**574. versionchange event lÃ  gÃ¬?**

> Fire trÃªn DB object khi **tab khÃ¡c** upgrade DB. Handler nÃªn `db.close()` + alert user reload. Náº¿u khÃ´ng close â†’ connection má»›i bá»‹ **blocked**.

**575. Promise wrapper (idb) hoáº¡t Ä‘á»™ng sao?**

> `openDB()` tráº£ Promise. `tx.done` = `oncomplete`. `try/catch` thay onsuccess/onerror. âš ï¸ **Inactive transaction pitfall** váº«n Ã¡p dá»¥ng â€” khÃ´ng await fetch trong transaction.

**576. IndexedDB lÆ°u trá»¯ á»Ÿ Ä‘Ã¢u?**

> Trong **home directory** cá»§a user, cÃ¹ng browser settings. Má»—i browser + OS user cÃ³ **storage riÃªng**. Data scope theo **origin** (domain/protocol/port).

**577. Object lÃ  gÃ¬?**

> **Unordered** list of name-value pairs (properties + methods). Mutable. Thá»±c cháº¥t lÃ  collection cá»§a key-value. Core data type cá»§a JavaScript.

**578. Primitive vs Reference?**

> **Primitive**: stored as value, immutable, copy táº¡o independent copy. **Reference** (Object): stored as pointer, mutable, copy **share cÃ¹ng** object. Thay Ä‘á»•i 1 â†’ áº£nh hÆ°á»Ÿng cáº£ 2.

**579. 4 cÃ¡ch táº¡o object?**

> **Literal** `{}`, **new Object()**, **Constructor pattern** (`function F() { this.x = v; }` + `new F()`), **Prototype pattern** (`F.prototype.x = v`). Constructor: má»—i instance cÃ³ copy methods. Prototype: share methods.

**580. Property attributes lÃ  gÃ¬?**

> **configurable** (delete/redefine), **enumerable** (for...in), **writable** (change value). Default **true**. `Object.defineProperty()` Ä‘á»ƒ set. Accessor properties: **getter/setter**.

**581. Dot vs bracket notation?**

> **Dot**: `obj.key` â€” key lÃ  identifier há»£p lá»‡. **Bracket**: `obj['key']` â€” há»— trá»£ dynamic keys, numbers, reserved words, spaces. Number keys Báº®T BUá»˜C bracket.

**582. hasOwnProperty vs in?**

> `in`: check **own + inherited**. `hasOwnProperty()`: chá»‰ **own**. VÃ­ dá»¥: `'toString' in obj` = true, `obj.hasOwnProperty('toString')` = false.

**583. for...in vs Object.keys()?**

> `for...in`: enumerate **own + inherited** enumerable properties. `Object.keys()`: chá»‰ **own** enumerable. `Object.getOwnPropertyNames()`: own (cáº£ non-enumerable).

**584. delete operator hoáº¡t Ä‘á»™ng sao?**

> Chá»‰ delete **own** properties. **LuÃ´n tráº£ true** (ká»ƒ cáº£ nonexistent). KhÃ´ng delete: inherited, non-configurable, var-declared. Muá»‘n xÃ³a inherited â†’ delete trÃªn **prototype object**.

**585. JSON.stringify/parse dÃ¹ng sao?**

> `stringify()`: object â†’ JSON string. `parse()`: string â†’ object. Deep clone: `JSON.parse(JSON.stringify(obj))`. âš ï¸ Máº¥t functions/undefined/Symbol/Date. Modern: `structuredClone()`.

**586. Prototype chain?**

> `instance` â†’ `Constructor.prototype` â†’ `Object.prototype` â†’ `null`. Property lookup: tÃ¬m tá»« instance lÃªn prototype chain. `Object.create(proto)` táº¡o object vá»›i prototype chá»‰ Ä‘á»‹nh.

**587. Own vs inherited property?**

> **Own**: Ä‘á»‹nh nghÄ©a trá»±c tiáº¿p trÃªn object (vÃ­ dá»¥ `this.x` trong constructor). **Inherited**: tá»« prototype chain. `hasOwnProperty()` phÃ¢n biá»‡t.

**588. Constructor pattern báº¥t lá»£i gÃ¬?**

> Má»—i instance táº¡o **copy má»›i** cá»§a methods â†’ tá»‘n memory. Giáº£i phÃ¡p: Ä‘áº·t methods trÃªn **prototype** â†’ share across instances.

**589. Object.defineProperty dÃ¹ng khi nÃ o?**

> Khi cáº§n **control attributes** (non-writable, non-enumerable, non-configurable). Táº¡o getter/setter. `Object.defineProperties()` cho nhiá»u properties cÃ¹ng lÃºc.

**590. Nonexistent property tráº£ gÃ¬?**

> Tráº£ **undefined**. KhÃ´ng throw error. PhÃ¢n biá»‡t vá»›i property cÃ³ value `undefined` báº±ng `'key' in obj` hoáº·c `hasOwnProperty()`.

**591. Object constructor vs literal?**

> **Literal** `{}`: ngáº¯n gá»n, performance tá»‘t hÆ¡n. **new Object()**: verbose, khÃ´ng cÃ³ lá»£i tháº¿. âš ï¸ `new Object('string')` tráº£ String object, khÃ´ng pháº£i plain object.

**592. Prototype pattern trade-off?**

> Share properties/methods â†’ tiáº¿t kiá»‡m memory. NhÆ°ng reference values (arrays/objects) trÃªn prototype bá»‹ **share qua instances** â†’ mutate áº£nh hÆ°á»Ÿng táº¥t cáº£.

**593. Prototype property vs prototype attribute?**

> **Prototype property** (`F.prototype`): property trÃªn **function**, dÃ¹ng attach methods cho inheritance. **Prototype attribute** (`[[Prototype]]`): Ä‘áº·c tÃ­nh trÃªn **object**, trá» Ä‘áº¿n parent object. 2 khÃ¡i niá»‡m khÃ¡c nhau.

**594. Prototype property cÃ³ enumerable khÃ´ng?**

> **KhÃ´ng**. `F.prototype` khÃ´ng xuáº¥t hiá»‡n trong `for...in`. `__proto__` lÃ  pseudo property (deprecated) Ä‘á»ƒ access `[[Prototype]]`. DÃ¹ng `Object.getPrototypeOf()` thay tháº¿.

**595. Constructor lÃ  gÃ¬?**

> Function dÃ¹ng **initialize object**, gá»i báº±ng `new`. Instances káº¿ thá»«a `constructor` property trá» Ä‘áº¿n constructor function. `userAccount.constructor` = `Account()`.

**596. Prototype attribute set khi nÃ o?**

> **Tá»± Ä‘á»™ng** khi táº¡o object. `{}` / `new Object()` â†’ `Object.prototype`. `new F()` â†’ `F.prototype`. `Object.create(proto)` â†’ `proto`.

**597. Prototype-based inheritance hoáº¡t Ä‘á»™ng sao?**

> `Child.prototype = new Parent()` â†’ Child instances káº¿ thá»«a **táº¥t cáº£** tá»« Parent. Chain: `child` â†’ `Child.prototype` (=Parent instance) â†’ `Parent.prototype` â†’ `Object.prototype` â†’ `null`.

**598. Prototype chain lÃ  gÃ¬?**

> Chuá»—i tá»« object â†’ `[[Prototype]]` â†’ `[[Prototype]]` â†’ ... â†’ `Object.prototype` â†’ `null`. JS dÃ¹ng chain nÃ y Ä‘á»ƒ **lookup properties**. TÃ¬m tháº¥y â†’ dá»«ng, háº¿t chain â†’ `undefined`.

**599. Property lookup hoáº¡t Ä‘á»™ng sao?**

> TÃ¬m **trÃªn object trÆ°á»›c**. KhÃ´ng cÃ³ â†’ lÃªn `[[Prototype]]`. Tiáº¿p tá»¥c lÃªn chain. TÃ¬m tháº¥y â†’ **dá»«ng ngay**, tráº£ value. Äáº¿n `null` mÃ  khÃ´ng cÃ³ â†’ `undefined`.

**600. Property shadowing lÃ  gÃ¬?**

> Own property **ghi Ä‘Ã¨** inherited property cÃ¹ng tÃªn. Lookup dá»«ng táº¡i own property, **khÃ´ng tiáº¿p lÃªn chain**. VÃ­ dá»¥: `famous.superstar = 'Jobs'` shadow prototype value.

**601. Object.prototype methods?**

> Má»i object káº¿ thá»«a: `constructor`, `hasOwnProperty()`, `isPrototypeOf()`, `propertyIsEnumerable()`, `toLocaleString()`, `toString()`, `valueOf()`.

**602. Táº¡i sao ghi Ä‘Ã¨ F.prototype = {} máº¥t constructor?**

> Default `F.prototype = { constructor: F }`. Ghi Ä‘Ã¨ = **thay object má»›i** â†’ máº¥t `constructor`. Fix: `F.prototype = { constructor: F, ...methods }`.

**603. Built-in prototype chains?**

> `[]` â†’ `Array.prototype` â†’ `Object.prototype` â†’ `null`. TÆ°Æ¡ng tá»±: `Number/String/Function.prototype` â†’ `Object.prototype`. **Táº¥t cáº£** built-in constructors káº¿ thá»«a tá»« `Object.prototype`.

**604. Object.create(null) khÃ¡c gÃ¬ {}?**

> `Object.create(null)`: **khÃ´ng cÃ³ prototype** â†’ khÃ´ng `toString`, `hasOwnProperty`, etc. DÃ¹ng lÃ m **pure dictionary**. `{}`: prototype = `Object.prototype`, cÃ³ inherited methods.

**605. **proto** vs Object.getPrototypeOf()?**

> `__proto__`: deprecated, browser-specific pseudo property. `Object.getPrototypeOf(obj)`: **standard** (ES5+), tráº£ `[[Prototype]]`. `Object.setPrototypeOf()` Ä‘á»ƒ set (cháº­m, trÃ¡nh dÃ¹ng).

**606. Táº¡i sao JS dÃ¹ng prototype thay class?**

> JS **khÃ´ng cÃ³ classical inheritance** (class-based). Má»i inheritance qua **prototype chain**. ES6 `class` = **syntactic sugar** trÃªn prototype. Under the hood váº«n lÃ  prototype.

**607. Prototype property default lÃ  gÃ¬?**

> Object rá»—ng chá»©a 1 property: `{ constructor: F }`. `F.prototype.constructor === F`. CÃ³ thá»ƒ **attach thÃªm** methods/properties cho instances káº¿ thá»«a.

**608. CÃ¡ch kiá»ƒm tra prototype chain?**

> `obj instanceof F`: check `F.prototype` cÃ³ trong chain. `Object.getPrototypeOf(obj)`: láº¥y prototype. `F.prototype.isPrototypeOf(obj)`: check cá»¥ thá»ƒ. `obj.constructor`: trá» Ä‘áº¿n constructor.

**609. Variable scope lÃ  gÃ¬?**

> **Context** nÆ¡i variable tá»“n táº¡i vÃ  accessible. `var`: **function scope** (KHÃ”NG block). `let/const`: **block scope**. Local var chá»‰ truy cáº­p trong function/block.

**610. Táº¡i sao var khÃ´ng cÃ³ block scope?**

> `var` chá»‰ cÃ³ **function-level scope**. `var` trong `if`/`for` = **váº«n global/function scope**. `let`/`const` (ES6) fix: táº¡o **block scope** trong `{}`.

**611. Biáº¿n khÃ´ng khai bÃ¡o var sáº½ sao?**

> Tá»± **thÃªm vÃ o global scope**! Thay Ä‘á»•i global variable mÃ  khÃ´ng biáº¿t. `"use strict"` â†’ **ReferenceError**. LuÃ´n dÃ¹ng `var`/`let`/`const`.

**612. Local variable Æ°u tiÃªn hÆ¡n global?**

> **CÃ³**. CÃ¹ng tÃªn â†’ local **shadow** global trong function. Lookup báº¯t Ä‘áº§u tá»« local scope trÆ°á»›c. Global khÃ´ng bá»‹ thay Ä‘á»•i.

**613. Global variables gáº¯n vÃ o Ä‘Ã¢u?**

> Gáº¯n vÃ o **window** object (browser). `var x = 5` â†’ `window.x === 5`. `'x' in window` = `true`. `let`/`const` KHÃ”NG gáº¯n vÃ o window.

**614. setTimeout this trá» Ä‘áº¿n Ä‘Ã¢u?**

> Regular function trong setTimeout: `this` = **window** (global). Fix: **arrow function** (lexical this), `bind(this)`, hoáº·c lÆ°u `const self = this`.

**615. CÃ¡ch trÃ¡nh pollute global scope?**

> **ES modules** (import/export), **IIFE** `(function(){...})()`, `let`/`const` (block scope), **closures**. Khai bÃ¡o biáº¿n trong function, khÃ´ng á»Ÿ top-level.

**616. Variable hoisting lÃ  gÃ¬?**

> `var` declarations **Ä‘Æ°a lÃªn TOP** function/global. Chá»‰ **declaration** (value = `undefined`), KHÃ”NG pháº£i **assignment**. `console.log(x); var x = 5;` â†’ `undefined`.

**617. Function declaration hoisting khÃ¡c var?**

> Function declaration **hoisted toÃ n bá»™** (cáº£ body). `var` chá»‰ hoisted declaration (value = undefined). Function declaration **override** var declaration.

**618. var assignment vs function declaration?**

> `var myName = 'Richard'` (assignment) **override** `function myName(){}`. Assignment xáº£y ra **runtime**, sau hoisting. `typeof myName` = `'string'`.

**619. Function expression cÃ³ hoisted khÃ´ng?**

> **KHÃ”NG**. `var f = function(){}` â†’ `f` hoisted as `undefined` (var hoisting), function body KHÃ”NG. Gá»i trÆ°á»›c khai bÃ¡o â†’ **TypeError** (undefined is not a function).

**620. let/const hoisting khÃ¡c var?**

> `let`/`const` **cÃ³ hoisted** nhÆ°ng náº±m trong **TDZ** (Temporal Dead Zone). Truy cáº­p trÆ°á»›c khai bÃ¡o â†’ **ReferenceError** (khÃ´ng pháº£i undefined nhÆ° var).

**621. for loop var vs let?**

> `for(var i)`: `i` lÃ  **global/function scope** â†’ accessible sau loop (value = 11). `for(let j)`: `j` lÃ  **block scope** â†’ má»—i iteration cÃ³ j riÃªng, khÃ´ng accessible ngoÃ i.

**622. var trong if block?**

> `var` trong `if {}` **KHÃ”NG** táº¡o local scope â†’ váº«n **global/function scope**. Re-declare cÃ¹ng tÃªn = **ghi Ä‘Ã¨**. DÃ¹ng `let`/`const` Ä‘á»ƒ cÃ³ block scope.

**623. Initialized without var táº¡i sao global?**

> JS engine khÃ´ng tÃ¬m tháº¥y declaration â†’ **táº¡o property trÃªn global object** (window). `age = 90` = `window.age = 90`. Strict mode **ngÄƒn** behavior nÃ y.

**624. Hoisting order tá»•ng quÃ¡t?**

> 1. **Function declarations** (toÃ n bá»™). 2. **var declarations** (value=undefined). 3. Runtime: **assignments** theo thá»© tá»± code. Function > var declaration. Assignment > function.

**625. Closure lÃ  gÃ¬?**

> **Inner function** cÃ³ access **outer function's scope chain**: own scope + outer variables/parameters + global. Táº¡o báº±ng cÃ¡ch Ä‘áº·t function bÃªn trong function khÃ¡c.

**626. Closure cÃ³ máº¥y scope chains?**

> **3 chains**: (1) Own scope (biáº¿n trong {}). (2) Outer function's vars + params. (3) Global. âš ï¸ Access outer **parameters** trá»±c tiáº¿p, KHÃ”NG access outer **arguments** object.

**627. Closure váº«n hoáº¡t Ä‘á»™ng sau outer function return?**

> **CÃ³**. Functions giá»¯ scope chain lÃºc **CREATION**. DÃ¹ outer function Ä‘Ã£ return, inner function váº«n access outer vars. ÄÃ¢y lÃ  tÃ­nh nÄƒng quan trá»ng nháº¥t.

**628. Closures store references hay values?**

> **References**. KhÃ´ng copy value lÃºc táº¡o closure. Äá»c **current value** khi gá»i â†’ tháº¥y Ä‘Æ°á»£c updated value. DÃ¹ng cho **private variables** pattern (getID/setID).

**629. Private variables pattern dÃ¹ng closure?**

> Return object vá»›i **getter/setter** functions. Biáº¿n outer function **khÃ´ng access trá»±c tiáº¿p** tá»« ngoÃ i â†’ chá»‰ qua methods â†’ **encapsulation** (Douglas Crockford pattern).

**630. Closure bug trong for loop?**

> Táº¥t cáº£ closures **share cÃ¹ng biáº¿n i**. Khi gá»i, for loop Ä‘Ã£ xong â†’ `i` = last value â†’ táº¥t cáº£ tráº£ cÃ¹ng káº¿t quáº£. Root cause: closure store **reference**, i thay Ä‘á»•i.

**631. Fix for loop closure báº±ng IIFE?**

> Wrap báº±ng **IIFE**: `(function(j){ return function(){ return j; } })(i)`. IIFE **capture** giÃ¡ trá»‹ `i` hiá»‡n táº¡i vÃ o `j` má»—i iteration â†’ má»—i closure cÃ³ giÃ¡ trá»‹ riÃªng.

**632. Fix for loop closure báº±ng let?**

> `for(let i = 0; ...)`: `let` táº¡o **block scope** â†’ má»—i iteration cÃ³ `i` **riÃªng biá»‡t**. Modern JS: dÃ¹ng `let` thay IIFE. ÄÆ¡n giáº£n vÃ  clean hÆ¡n.

**633. Táº¡i sao closure giá»¯ vars sau return?**

> JS function giá»¯ **scope chain lÃºc creation** (lexical scope). Outer function return nhÆ°ng **vars váº«n sá»‘ng** trong memory vÃ¬ closure váº«n reference chÃºng â†’ GC khÃ´ng xÃ³a.

**634. Closure cÃ³ thá»ƒ gÃ¢y memory leak?**

> **CÃ³**. Closure giá»¯ reference â†’ outer vars **khÃ´ng bá»‹ GC**. Fix: null-ify references sau khi dÃ¹ng, limit scope. Event listeners + closures = common leak source.

**635. Scope chain theo creation hay call site?**

> **Creation site** (lexical scoping). Function nhá»› scope chain lÃºc **khai bÃ¡o**, khÃ´ng pháº£i lÃºc gá»i. ÄÃ¢y lÃ  ná»n táº£ng cá»§a closure.

**636. Callback lÃ  closure?**

> **ThÆ°á»ng lÃ **. Callback truyá»n vÃ o async function thÆ°á»ng access outer vars â†’ closure. jQuery click handler, Node.js callbacks, setTimeout â€” Ä‘á»u lÃ  closures.

**637. Closure vs regular function?**

> Regular function: chá»‰ access own scope + global. Closure: access **outer function scope** â†’ thÃªm layer giá»¯a. Má»i function CÃ“ THá»‚ lÃ  closure náº¿u access outer scope.

**638. this trong closure?**

> Regular function closure: `this` = **call-time** (window/undefined). KHÃ”NG inherit outer this. Fix: `const self = this`, `.bind(this)`, hoáº·c **arrow function** (lexical this).

**639. Closure trong interview thÆ°á»ng há»i gÃ¬?**

> (1) For loop closure bug + fix. (2) Private variables pattern. (3) Scope chain explanation. (4) setTimeout + closure output. (5) Module pattern. Äá»u xoay quanh **reference vs value**.

**640. Module pattern dÃ¹ng closure?**

> IIFE return object vá»›i public methods, giá»¯ private vars trong closure: `const module = (function(){ var x = 0; return { get(){ return x; } } })()`. ES modules thay tháº¿ pattern nÃ y.

**641. Callback function lÃ  gÃ¬?**

> Function **truyá»n vÃ o function khÃ¡c** nhÆ° argument, **gá»i SAU** (called back) bÃªn trong containing function. CÃ²n gá»i lÃ  **higher-order function pattern**. Functional programming paradigm.

**642. Táº¡i sao functions lÃ  first-class objects?**

> Functions lÃ  **type Object**: stored in variables, passed as arguments, created within functions, returned from functions. DÃ¹ng **nhÆ° má»i object khÃ¡c** (String, Array, Number).

**643. Callbacks lÃ  closures?**

> **CÃ³**. Callback execute trong body cá»§a containing function â†’ **access containing scope + global**. NhÆ° closure: cháº¡y táº¡i má»™t thá»i Ä‘iá»ƒm khÃ¡c nhÆ°ng giá»¯ scope chain.

**644. Named vs anonymous callbacks?**

> **Anonymous**: tiá»‡n, inline. **Named**: **reusable**, dá»… **debug** (xuáº¥t hiá»‡n trong stack trace), dá»… Ä‘á»c. Best practice: dÃ¹ng named cho logic phá»©c táº¡p.

**645. Táº¡i sao check typeof trÆ°á»›c khi gá»i callback?**

> TrÃ¡nh **runtime error** náº¿u caller khÃ´ng truyá»n callback hoáº·c truyá»n non-function. `if (typeof callback === 'function') callback()`. LÃ m callback **optional**.

**646. this problem vá»›i method callback?**

> Pass method lÃ m callback â†’ **máº¥t context** â†’ `this` = **window** (hoáº·c undefined strict). `clientData.setUserName` pass vÃ o global fn â†’ `this.fullName` set trÃªn window.

**647. Fix this vá»›i call/apply?**

> `callback.apply(callbackObj, [args])`: set `this` = `callbackObj`. `callback.call(obj, a, b)`: tÆ°Æ¡ng tá»± nhÆ°ng args riÃªng láº». Modern: `callback.bind(obj)` hoáº·c **arrow function**.

**648. call vs apply vs bind?**

> `call(obj, a, b)`: gá»i ngay, args riÃªng. `apply(obj, [a, b])`: gá»i ngay, args array. `bind(obj)`: **tráº£ function má»›i** vá»›i this gáº¯n cá»‘ Ä‘á»‹nh (khÃ´ng gá»i ngay).

**649. Multiple callbacks pattern?**

> Truyá»n nhiá»u callbacks: `success`, `error`, `complete`. jQuery AJAX, event handlers. CÃ¹ng function nhÆ°ng **khÃ¡c behavior** theo tÃ¬nh huá»‘ng.

**650. Callback Hell lÃ  gÃ¬?**

> **Nested callbacks** nhiá»u táº§ng â†’ **Pyramid of Doom**. KhÃ³ Ä‘á»c, khÃ³ maintain, khÃ³ handle errors. ThÆ°á»ng gáº·p trong **async code** (Node.js, AJAX).

**651. CÃ¡ch thoÃ¡t Callback Hell?**

> (1) **Named functions** thay anonymous. (2) **Modularity** tÃ¡ch modules. (3) **Promises** `.then().catch()`. (4) **async/await** sequential style. Modern JS: Promises + async/await.

**652. Táº¡o callback function cá»§a riÃªng?**

> Nháº­n function nhÆ° parameter cuá»‘i. Check typeof. Gá»i callback vá»›i data. **DRY**: khÃ´ng láº·p code. **Abstraction**: cÃ¹ng fn + khÃ¡c callback = khÃ¡c behavior.

**653. Error-first callback lÃ  gÃ¬?**

> **Node.js convention**: `callback(err, result)`. `err` = null náº¿u OK. Check `if (err)` Ä‘áº§u tiÃªn. Má»i async API trong Node dÃ¹ng pattern nÃ y.

**654. Callback Ä‘Æ°á»£c gá»i synchronous hay async?**

> **Cáº£ hai**. `forEach(callback)` = **sync**. `setTimeout(callback)` = **async**. Phá»¥ thuá»™c containing function quyáº¿t Ä‘á»‹nh. Háº§u háº¿t I/O callbacks lÃ  async.

**655. forEach callback khÃ¡c setTimeout callback?**

> `forEach`: gá»i **ngay láº­p tá»©c** trong loop (sync). `setTimeout`: Ä‘áº·t vÃ o **macro-task queue**, cháº¡y **sau** current code + microtasks (async).

**656. Khi nÃ o dÃ¹ng callback?**

> **Async execution** (files, HTTP). **Event handlers** (click, submit). **setTimeout/setInterval**. **Generalization** (cÃ¹ng fn, khÃ¡c behavior). DÃ¹ng Promises/async-await cho complex async.

**657. this trong JS trá» Ä‘áº¿n Ä‘Ã¢u?**

> Trá» Ä‘áº¿n **object INVOKE function** chá»©a `this`. GÃ¡n giÃ¡ trá»‹ táº¡i **invocation time**, KHÃ”NG pháº£i definition. NhÆ° pronoun: shortcut refer to invoking object.

**658. this trong global scope?**

> `this` = **window** (browser). `var x = 5; this.x === 5`. Strict mode: `this` = **undefined** trong global function vÃ  anonymous function.

**659. Biggest gotcha vá»›i this?**

> `this` chÆ°a cÃ³ giÃ¡ trá»‹ cho Ä‘áº¿n khi **object invoke** function. Value dá»±a trÃªn **invoking object**, khÃ´ng pháº£i nÆ¡i define. Context Ä‘á»•i â†’ this Ä‘á»•i.

**660. Method as callback: this máº¥t context?**

> Pass `user.clickHandler` lÃ m callback â†’ `this` = **DOM element / window**, khÃ´ng pháº£i user. VÃ¬ button **invoke** callback. Fix: `.bind(user)`.

**661. this trong closure/inner function?**

> Inner function **khÃ´ng inherit outer this** â†’ `this` = **window**. Fix: `var self = this` trÆ°á»›c inner fn, hoáº·c **arrow function** (lexical this), hoáº·c `.bind(this)`.

**662. var self = this lÃ  gÃ¬?**

> **Capture** this vÃ o biáº¿n thÆ°á»ng trÆ°á»›c inner function. CÃ²n gá»i `var that = this`. Inner fn access `self` qua **closure** thay vÃ¬ dÃ¹ng this. Classic pattern trÆ°á»›c arrow fn.

**663. Method assign to variable: this biáº¿n máº¥t?**

> `var fn = obj.method; fn()` â†’ `this` = **window** (global call). Method tÃ¡ch khá»i object â†’ máº¥t context. Fix: `var fn = obj.method.bind(obj)`.

**664. Borrowing methods: this trá» Ä‘Ã¢u?**

> `appCtrl.avg.apply(gameCtrl)`: `this` = **gameCtrl** (target object). `.apply()` set `this` explicitly. Borrower object nháº­n káº¿t quáº£, original khÃ´ng thay Ä‘á»•i.

**665. call vs apply vs bind cho this?**

> `call(obj, a, b)`: gá»i ngay, set this. `apply(obj, [a,b])`: gá»i ngay, args array. `bind(obj)`: **tráº£ fn má»›i** vá»›i this cá»‘ Ä‘á»‹nh. DÃ¹ng bind cho callbacks.

**666. Arrow function fix this nhÆ° tháº¿ nÃ o?**

> Arrow fn **khÃ´ng cÃ³ this riÃªng** â†’ inherit this tá»« **enclosing scope** (lexical this). KhÃ´ng cáº§n `var self = this`. KHÃ”NG dÃ¹ng lÃ m method trÃªn object (this = outer, khÃ´ng pháº£i object).

**667. this trong event handler?**

> Regular function: `this` = **DOM element fired** event. Arrow: this = **enclosing scope**. jQuery: `$(this)` = jQuery-wrapped element. React: class method cáº§n `.bind(this)` trong constructor.

**668. new keyword thay Ä‘á»•i this?**

> `new Fn()`: (1) Táº¡o object má»›i. (2) Set this = object má»›i. (3) Link prototype. (4) Return object. `this` trong constructor = **instance má»›i** Ä‘Æ°á»£c táº¡o.

**669. this trong class method?**

> Class method: `this` = **instance**. NhÆ°ng pass method lÃ m callback â†’ máº¥t context. Fix: `this.method = this.method.bind(this)` trong constructor hoáº·c dÃ¹ng **arrow class field**.

**670. Thá»© tá»± Æ°u tiÃªn xÃ¡c Ä‘á»‹nh this?**

> (1) `new` â†’ new object. (2) `bind/call/apply` â†’ explicit. (3) Object method `obj.fn()` â†’ obj. (4) Default â†’ window/undefined. Arrow fn: luÃ´n lexical.

**671. this trong setTimeout?**

> Regular fn: `this` = **window**. Fix: `.bind(obj)`, `var self = this`, hoáº·c **arrow fn**: `setTimeout(() => this.method(), 1000)`. CÃ¹ng issue nhÆ° closure trap.

**672. CÃ¡ch debug this sai?**

> `console.log(this)` Ä‘áº§u function. Check **ai invoke**: `obj.fn()` â†’ obj, `fn()` â†’ window. Strict mode help detect. DÃ¹ng **bind/arrow fn** khi truyá»n method. Rule: this = **caller**.

**673. call vs apply vs bind?**

> `call(obj, a, b)`: gá»i **ngay**, args riÃªng. `apply(obj, [a,b])`: gá»i **ngay**, args **array**. `bind(obj)`: **tráº£ fn má»›i** vá»›i this cá»‘ Ä‘á»‹nh, khÃ´ng gá»i. Dá»… nhá»›: A for Array.

**674. Bind dÃ¹ng Ä‘á»ƒ lÃ m gÃ¬?**

> (1) **Fix this** cho callbacks/events. (2) **Borrow methods** gáº¯n lÃªn object khÃ¡c. (3) **Currying** (partial application): preset má»™t sá»‘ args, tráº£ fn má»›i chá»‰ cáº§n args cÃ²n láº¡i.

**675. Currying dÃ¹ng bind?**

> `greet.bind(null, 'male', 45)` â†’ tráº£ fn chá»‰ cáº§n `name`. `null` = khÃ´ng dÃ¹ng this. Preset args tá»« **trÃ¡i sang pháº£i**. Fn má»›i **nhá»›** preset args qua closure.

**676. Borrow Array methods trÃªn array-like?**

> `Array.prototype.slice.call(arrayLike, 0)` â†’ convert to real array. Array methods lÃ  **generic** (trá»« toString/toLocaleString). DÃ¹ng trÃªn `arguments`, NodeList, array-like objects.

**677. arguments lÃ  array-like?**

> **CÃ³**. CÃ³ `length` + numeric keys, nhÆ°ng **khÃ´ng cÃ³ Array methods**. Convert: `Array.prototype.slice.call(arguments)`. Modern: `Array.from(arguments)` hoáº·c `[...arguments]`.

**678. apply dÃ¹ng cho variadic functions?**

> Variadic = nháº­n **sá»‘ lÆ°á»£ng args khÃ´ng cá»‘ Ä‘á»‹nh**. `Math.max.apply(null, [23,11,56])` â†’ 56. apply **spread array** thÃ nh individual args. Modern: `Math.max(...arr)`.

**679. Táº¡i sao dÃ¹ng null lÃ m first arg?**

> Khi function **khÃ´ng dÃ¹ng this**: `Math.max.apply(null, arr)`, `greet.bind(null, 'male')`. `null`/`undefined` = this **khÃ´ng quan trá»ng**. Strict mode: this = null/undefined tháº­t.

**680. Borrow method cÃ³ copy khÃ´ng?**

> **KhÃ´ng copy**, chá»‰ **reference**. Thay Ä‘á»•i original method â†’ borrowed cÅ©ng thay Ä‘á»•i. call/apply tá»‘t hÆ¡n bind cho borrowing vÃ¬ khÃ´ng gáº¯n method má»›i lÃªn object.

**681. Set this trong callback vá»›i apply?**

> `callback.apply(callbackObj, [args])`: set `this` = `callbackObj`. Äáº£m báº£o method callback **giá»¯ context** Ä‘Ãºng. DÃ¹ng trong pattern: `getUserInput(name, callback, callbackObj)`.

**682. Khi nÃ o dÃ¹ng call vs apply?**

> `call`: biáº¿t **chÃ­nh xÃ¡c sá»‘ args**. `apply`: args lÃ  **array** hoáº·c **khÃ´ng biáº¿t sá»‘ lÆ°á»£ng** (variadic). Mnemonics: **A**pply = **A**rray, **C**all = **C**ommas.

**683. bind polyfill (ES3)?**

> Tá»± implement trÃªn `Function.prototype`. DÃ¹ng `apply` bÃªn trong. LÆ°u `fToBind = this`, concat args. Cáº§n handle `new` operator. **KhÃ´ng cáº§n** trong modern browsers (ES5+).

**684. Arrow function thay tháº¿ bind?**

> Nhiá»u trÆ°á»ng há»£p **cÃ³**. Arrow fn: lexical this = khÃ´ng cáº§n bind. NhÆ°ng bind cÃ²n dÃ¹ng cho **currying** (preset args) â€” arrow fn khÃ´ng lÃ m Ä‘Æ°á»£c.

**685. Spread operator thay apply?**

> **CÃ³**. `Math.max(...arr)` thay `Math.max.apply(null, arr)`. `fn(...args)` thay `fn.apply(null, args)`. Clean hÆ¡n, dá»… Ä‘á»c hÆ¡n. ES6+.

**686. Array.from thay slice.call?**

> **CÃ³**. `Array.from(arguments)` thay `Array.prototype.slice.call(arguments)`. CÃ²n nháº­n **mapping fn**: `Array.from(nodeList, el => el.id)`. ES6+.

**687. Borrow trÃªn String?**

> Strings **immutable** â†’ chá»‰ borrow **non-mutating** Array methods: `slice`, `indexOf`, `forEach`. **KhÃ´ng** dÃ¹ng `reverse`, `pop`, `push` (thay Ä‘á»•i original).

**688. TÃ³m lÆ°á»£c ba methods?**

> **call**: gá»i ngay + set this + args riÃªng. **apply**: gá»i ngay + set this + args array + variadic. **bind**: tráº£ fn má»›i + this cá»‘ Ä‘á»‹nh + currying. Táº¥t cáº£ trÃªn `Function.prototype`.

**689. this substitution lÃ  gÃ¬?**

> Non-strict: `this` luÃ´n lÃ  **object**. `null`/`undefined` â†’ `globalThis`. Primitive (`7`, `'foo'`) â†’ **wrapper object** (Number, String). Strict mode: giá»¯ nguyÃªn value.

**690. Strict mode thay Ä‘á»•i this?**

> `fn()` standalone: this = **undefined** (thay vÃ¬ window). `fn.call(null)`: this = **null** (khÃ´ng thÃ nh globalThis). `fn.call(7)`: this = **7** (khÃ´ng wrap Number). Detects bugs sá»›m hÆ¡n.

**691. Arrow fn vÃ  bind/call/apply?**

> Arrow fn: `call()`, `apply()`, `bind()` **Bá»Š IGNORED** vá»›i thisArg. `this` luÃ´n = enclosing scope (lexical). Chá»‰ nháº­n other args, khÃ´ng Ä‘á»•i this.

**692. bind chá»‰ works má»™t láº§n?**

> `g = f.bind(A); h = g.bind(B)` â†’ `h()` váº«n dÃ¹ng **A** (khÃ´ng pháº£i B). Láº§n `bind` Ä‘áº§u tiÃªn **cá»‘ Ä‘á»‹nh vÄ©nh viá»…n**. Rebind bá»‹ ignored.

**693. Constructor return overrides this?**

> `new Fn()`: náº¿u constructor return **non-primitive** (object/array/function), new object bá»‹ **discard**. Return `{a:38}` â†’ o.a = 38, khÃ´ng pháº£i this.a = 37.

**694. thisArg trong forEach/map?**

> `arr.forEach(fn, thisArg)`: set `this` = `thisArg` trong callback. Háº§u háº¿t iterative methods (map, filter, some, every) Ä‘á»u cÃ³ optional **thisArg** parameter cuá»‘i.

**695. Class instance vs static this?**

> Instance field: `this` = **instance** Ä‘ang construct. Static field: `this` = **class** itself. Constructor: `this` = new instance. Static method: `this` = class.

**696. Derived class this trÆ°á»›c super()?**

> **ReferenceError**! Derived constructor **pháº£i gá»i super()** trÆ°á»›c khi access `this`. `super()` táº¡o this binding. Ngoáº¡i lá»‡: return object hoáº·c khÃ´ng cÃ³ constructor.

**697. Getter/setter: this = ?**

> `this` = object **accessed on** (gá»i property), khÃ´ng pháº£i object **defined on**. NhÆ° method: phá»¥ thuá»™c caller, khÃ´ng pháº£i owner.

**698. this trong DOM addEventListener?**

> Regular fn: `this` = **DOM element** gáº¯n listener (`e.currentTarget`). Arrow fn: `this` = **enclosing scope** (thÆ°á»ng window). DÃ¹ng regular fn khi cáº§n access element.

**699. Inline event handler this?**

> Outer code: `this` = **DOM element**. `onclick="alert(this.tagName)"` â†’ button. NhÆ°ng inner function trong handler: `this` = **globalThis** (non-strict).

**700. Bound method trong class: váº¥n Ä‘á»?**

> Má»—i instance táº¡o **báº£n sao riÃªng** cá»§a bound method â†’ **tÄƒng memory**. Arrow class field cÅ©ng váº­y. Chá»‰ dÃ¹ng khi tháº­t sá»± cáº§n. Alt: lazy getter pattern.

**701. Module top-level this?**

> `<script type="module">`: this = **undefined**. KhÃ¡c script thÆ°á»ng (this = window). Node ESM: cÅ©ng undefined. CommonJS: this = **module.exports**.

**702. globalThis lÃ  gÃ¬?**

> **Universal reference** Ä‘áº¿n global object: `window` (browser), `global` (Node), `self` (Worker). Cross-platform: dÃ¹ng `globalThis` thay vÃ¬ check environment.

**703. this trong eval?**

> Direct eval `eval('this')`: this = **enclosing context**. Indirect eval `eval?.('this')`: this = **globalThis**. Cáº£ strict vÃ  non-strict.

**704. Tá»•ng há»£p this context table?**

> `obj.fn()` â†’ obj | `fn()` non-strict â†’ globalThis | `fn()` strict â†’ undefined | arrow â†’ lexical | `new` â†’ new obj | `bind` â†’ bound obj (once) | getter/setter â†’ accessed obj | DOM â†’ element | module â†’ undefined.

**705. Synchronous programming lÃ  gÃ¬?**

> ChÆ°Æ¡ng trÃ¬nh cháº¡y **tá»«ng bÆ°á»›c**, má»—i dÃ²ng **chá» xong** má»›i tiáº¿p dÃ²ng sau. Caller **blocked** cho Ä‘áº¿n khi function return. ÄÆ¡n giáº£n nhÆ°ng **khÃ´ng tá»‘t** cho long-running tasks.

**706. Táº¡i sao long-running sync lÃ  váº¥n Ä‘á»?**

> JS = **single-threaded**: 1 thread lÃ m 1 viá»‡c. Long-running sync â†’ **UI freeze**: khÃ´ng type, click, scroll Ä‘Æ°á»£c. Entire page **unresponsive** cho Ä‘áº¿n khi xong.

**707. Asynchronous programming giáº£i quyáº¿t gÃ¬?**

> (1) Báº¯t Ä‘áº§u operation. (2) **Return ngay** (khÃ´ng block). (3) Cháº¡y khÃ´ng block main thread. (4) **Notify** káº¿t quáº£ khi xong. UI váº«n responsive trong lÃºc chá».

**708. Event handlers lÃ  async?**

> **CÃ³**! Event handler = function gá»i **khÃ´ng ngay láº­p tá»©c**, mÃ  **khi event xáº£y ra**. "Event" cÃ³ thá»ƒ lÃ  async operation hoÃ n thÃ nh. XMLHttpRequest dÃ¹ng `loadend` event.

**709. XMLHttpRequest vÃ  async?**

> Early async API. Gáº¯n event listener (`loadend`) â†’ send request â†’ code tiáº¿p tá»¥c cháº¡y â†’ handler gá»i khi response vá». `log('Started')` cháº¡y TRÆ¯á»œC `log('Finished')`.

**710. Callback hell lÃ  gÃ¬?**

> **Nested callbacks** nhiá»u táº§ng: `doStep1(0, r1 => { doStep2(r1, r2 => { doStep3(r2, r3 => {...}) }) })`. Indentation táº¡o **pyramid shape**. KhÃ³ Ä‘á»c, khÃ³ debug.

**711. Error handling trong callback hell?**

> Pháº£i handle errors táº¡i **Má»–I táº§ng** nested (khÃ´ng pháº£i 1 nÆ¡i). Má»—i callback cáº§n error check riÃªng. **KhÃ´ng cÃ³** centralized error handling nhÆ° try/catch.

**712. Modern async thay callbacks?**

> **Promises**: `.then().then().catch()` â€” chainable, flat. **async/await**: code trÃ´ng nhÆ° sync nhÆ°ng lÃ  async. Ná»n táº£ng async hiá»‡n Ä‘áº¡i trong JS.

**713. JS lÃ  single-threaded nghÄ©a lÃ  gÃ¬?**

> **1 call stack** = chá»‰ lÃ m 1 viá»‡c táº¡i 1 thá»i Ä‘iá»ƒm. Async khÃ´ng táº¡o thread má»›i â€” dÃ¹ng **event loop** + Web APIs Ä‘á»ƒ khÃ´ng block main thread.

**714. fetch() lÃ  sync hay async?**

> **Async**. Return **Promise**, khÃ´ng block. `fetch(url).then(res => res.json()).then(data => ...)`. Thay tháº¿ XMLHttpRequest. Modern HTTP API.

**715. setTimeout lÃ  async?**

> **CÃ³**. `setTimeout(fn, ms)`: Ä‘áº·t fn vÃ o **macro-task queue** sau ms milliseconds. Code tiáº¿p tá»¥c cháº¡y ngay. `setTimeout(fn, 0)` váº«n async (chá» current code xong).

**716. Blocking vs non-blocking?**

> **Blocking**: code dá»«ng láº¡i chá» (sync). **Non-blocking**: code tiáº¿p tá»¥c cháº¡y, káº¿t quáº£ Ä‘áº¿n sau qua callback/promise (async). Node.js: almost all I/O is non-blocking.

**717. Sync vs async function?**

> Sync: **return value** trá»±c tiáº¿p, caller chá». Async: return **Promise** hoáº·c nháº­n **callback**, caller khÃ´ng chá». `forEach` = sync callback. `setTimeout` = async callback.

**718. getUserMedia lÃ  async?**

> **CÃ³**. Return **Promise** (vÃ¬ cáº§n user permission + hardware access). `navigator.mediaDevices.getUserMedia({video: true}).then(stream => ...)`. CÃ³ thá»ƒ máº¥t vÃ i giÃ¢y.

**719. Táº¡i sao event-based async?**

> **TrÆ°á»›c Promises**: async dÃ¹ng events. Gáº¯n listener â†’ operation cháº¡y â†’ event fire khi xong. Váº«n dÃ¹ng cho DOM events, WebSocket, Server-Sent Events. Promises cho one-shot async.

**720. Async programming lÃ  gÃ¬?**

> Ká»¹ thuáº­t cho phÃ©p **báº¯t Ä‘áº§u task dÃ i** mÃ  váº«n **responsive**. KhÃ´ng chá» task xong má»›i tiáº¿p. Káº¿t quáº£ Ä‘Æ°á»£c **trÃ¬nh bÃ y sau** qua callback/promise/event.

**721. Memory life cycle?**

> 3 giai Ä‘oáº¡n: **Allocate** â†’ **Use** (read/write) â†’ **Release**. JS: allocate vÃ  release **tá»± Ä‘á»™ng**. Low-level (C): manual `malloc()`/`free()`. GC = automatic release.

**722. JS allocate memory khi nÃ o?**

> **Value init**: `const n = 123`, `const o = {}`, `const a = []`, `function f() {}`. **Function calls**: `new Date()`, `document.createElement()`. **Methods**: `substring()`, `concat()` táº¡o objects má»›i.

**723. Reference-counting GC?**

> Äáº¿m sá»‘ references Ä‘áº¿n object. **0 refs** = collectible. âŒ Váº¥n Ä‘á»: **circular reference** (`x.a = y; y.a = x`) â†’ má»—i object cÃ³ 1 ref â†’ **khÃ´ng bao giá» 0** â†’ memory leak. **KhÃ´ng** modern engine nÃ o dÃ¹ng.

**724. Mark-and-sweep GC?**

> Báº¯t Ä‘áº§u tá»« **root** (global object). TÃ¬m táº¥t cáº£ **reachable** objects. **Unreachable** = collected. âœ… Fixes circular refs (unreachable dÃ¹ ref láº«n nhau). Táº¥t cáº£ modern engines dÃ¹ng.

**725. Circular reference cÃ²n lÃ  váº¥n Ä‘á»?**

> Vá»›i mark-and-sweep: **khÃ´ng**. Sau function return, objects unreachable tá»« root â†’ GC dÃ¹ cÃ³ circular refs. Chá»‰ lÃ  váº¥n Ä‘á» vá»›i reference-counting (cÅ©).

**726. Táº¡i sao khÃ´ng manually trigger GC?**

> JS khÃ´ng expose GC API. Äá»ƒ "release": lÃ m object **unreachable** (set `= null`, let go out of scope). V8: `node --expose-gc` cho debugging. **KhÃ´ng** cÃ³ trong core language.

**727. WeakMap vs Map?**

> WeakMap: keys **weakly held** â†’ GC-able khi khÃ´ng strong ref. Chá»‰ **objects/symbols** lÃ m key. **KhÃ´ng iterable**, khÃ´ng `.size`, khÃ´ng `.clear()`. Map: keys strongly held.

**728. Táº¡i sao WeakMap khÃ´ng iterable?**

> Náº¿u iterable â†’ cÃ³ thá»ƒ observe GC (biáº¿t object nÃ o bá»‹ collect). GC pháº£i **invisible**. `Array.from(wm.keys())` sáº½ giá»¯ strong refs â†’ phÃ¡ vá»¡ purpose.

**729. WeakMap chá»‰ nháº­n objects?**

> Primitives **forged**: `1 === 1` (cÃ¹ng value). Objects **unique**: `{} !== {}`. Primitives khÃ´ng GC-able â†’ sáº½ á»Ÿ trong WeakMap mÃ£i. ES2023: **Symbols** cÅ©ng cho phÃ©p (Symbol() GC-able).

**730. Ephemerons lÃ  gÃ¬?**

> WeakMap entries = **ephemerons** (khÃ´ng pháº£i simple refs). Key connectivity Ä‘á»‹nh value connectivity (khÃ´ng ngÆ°á»£c láº¡i). Fixes: value refs key khÃ´ng táº¡o cycle. 3-phase GC thay vÃ¬ 2.

**731. WeakRef dÃ¹ng cho gÃ¬?**

> **Weak reference** Ä‘áº¿n object. `deref()` = object hoáº·c **undefined** (náº¿u Ä‘Ã£ GC). Use case: **cache** vá»›i Map + WeakRef (values weak). KhÃ¡c WeakMap (keys weak, values strong).

**732. WeakRef cache pattern?**

> `cache.set(key, new WeakRef(value))`. Get: `cache.get(key).deref()`. Náº¿u `undefined` â†’ re-compute. Large objects tá»± Ä‘á»™ng GC khi memory cáº§n. KhÃ´ng giá»¯ strong ref.

**733. FinalizationRegistry lÃ  gÃ¬?**

> **Callback** khi object bá»‹ GC. `registry.register(obj, heldValue)`. Callback nháº­n `heldValue`. DÃ¹ng cleanup cache entries (delete stale WeakRef). âš ï¸ **KhÃ´ng guarantee** timing.

**734. FinalizationRegistry cÃ³ reliable?**

> **KhÃ´ng**. Callback cÃ³ thá»ƒ **khÃ´ng bao giá» gá»i** (browser tab close, etc.). Chá»‰ cho **non-critical cleanup**. Deterministic: dÃ¹ng `try...finally`. Performance + security concerns.

**735. --max-old-space-size lÃ  gÃ¬?**

> V8 flag: set **max heap memory** (MB). Default: ~1.5GB. `node --max-old-space-size=6000` = 6GB. DÃ¹ng cho large datasets. `--expose-gc`: expose `global.gc()` cho debugging.

**736. Memory leak trong JS?**

> NguyÃªn nhÃ¢n: (1) **Global variables** vÃ´ tÃ¬nh. (2) **Closures** giá»¯ refs khÃ´ng cáº§n. (3) **Event listeners** khÃ´ng remove. (4) **DOM detached** nhÆ°ng JS cÃ²n ref. Fix: set null, removeEventListener, WeakRef.

**737. Frontend architecture cáº§n giáº£i quyáº¿t gÃ¬?**

> (1) **Problem-solving**: giáº£i váº¥n Ä‘á» ká»¹ thuáº­t. (2) **Cost/benefit**: chi phÃ­ vs lá»£i Ã­ch. (3) **Measurable**: Ä‘o lÆ°á»ng Ä‘Æ°á»£c (quantitative/qualitative). (4) **Data-driven**: data = báº±ng chá»©ng thuyáº¿t phá»¥c.

**738. Basic Layer gá»“m gÃ¬?**

> Háº¡ táº§ng, Ã­t liÃªn quan business: **GitLab** + version mgmt + **Jenkins** CI/CD + FE versioning + scaffold + **Node BFF** + analytics + monitoring + security + ESLint + **canary release** + FE-BE sep + mock + backups.

**739. Táº¡i sao branch lock sau release?**

> Release 0.0.1 â†’ branch **LOCKED**, khÃ´ng Ä‘Æ°á»£c modify. TrÃ¡nh version chaos. Multi-version coexist trÃªn CDN: **rollback nhanh** khi bug production.

**740. Pure FE versioning lÃ  gÃ¬?**

> Deploy new code â†’ accessible qua version URL nhÆ°ng **chÆ°a active**. Config tool Ä‘á»•i HTML imports â†’ live. **KhÃ´ng cáº§n backend deploy** khi chá»‰ thay Ä‘á»•i FE. Rollback = Ä‘á»•i config.

**741. Node BFF dÃ¹ng lÃ m gÃ¬?**

> (1) **SSR** cho SEO (React/Vue isomorphic). (2) Giáº£m **blank screen** time. (3) FE Ä‘á»c trá»±c tiáº¿p backend services/DB. âš ï¸ Risk: cÃ³ thá»ƒ gÃ¢y P0 failures.

**742. Analytics/tracking system cáº§n gÃ¬?**

> **PV/UV** (daily/weekly/monthly), **feature usage**, **error capture**, **charts**. Decouple tá»« business. Data = tiá»n. Hiá»ƒu user habits chÃ­nh xÃ¡c hÆ¡n backend.

**743. Canary release phases?**

> **1%** â†’ **5-10%** â†’ **30-50%** â†’ **100%**. Test production vá»›i nhÃ³m nhá». Cho IP/account cá»¥ thá»ƒ access gray version. **Rollback nhanh** náº¿u bug.

**744. Táº¡i sao backend own HTML?**

> Backend **inject**: tracking JS, monitoring JS, i18n text, page ID. Unified header/footer. Giáº£m coupling. FE version control per page dá»… hÆ¡n. Há»— trá»£ canary.

**745. Mock trong scaffold?**

> `?debug=true` â†’ Ä‘á»c `src/test_ajax/userinfo.json` thay vÃ¬ API. Giáº£m communication cost. FE-BE **parallel dev**. Copy real data tá»« network tab vÃ o JSON.

**746. Multi-page vs SPA cho large projects?**

> **Multi-page** tá»‘t hÆ¡n: pages Ä‘á»™c láº­p, refactor 1 page khÃ´ng áº£nh hÆ°á»Ÿng khÃ¡c. Update/version/canary dá»… hÆ¡n. SPA: update 1 module = update all. NhÆ°á»£c: blank screen khi navigate.

**747. Split by application nghÄ©a lÃ  gÃ¬?**

> 1 business function = **1 repo** (FE + BE). KhÃ´ng gá»™p táº¥t cáº£ FE vÃ o 1 mega-repo. Permission per app, publish per app. TÄƒng **security** + giáº£m maintenance cost.

**748. Component library prerequisites?**

> **Unified tech stack** (báº¯t buá»™c). TypeScript + extensible + detailed docs. Version isolation: minor = add features, major = breaking. Cáº§n **UI designer** tham gia. <10 devs: dÃ¹ng Antd.

**749. SSO benefits?**

> Login **1 láº§n** â†’ access táº¥t cáº£ business lines. Unified user data. Giáº£m dev cost per business (khÃ´ng build login system má»—i app). TÄƒng UX + traffic redirection.

**750. CDN giáº£i quyáº¿t gÃ¬?**

> Users access server **gáº§n hÆ¡n** â†’ giáº£m latency. Giáº£m bandwidth cost + cross-carrier slow. Há»— trá»£ video/static/live. Giáº£m **DDoS** impact.

**751. Shared APIs lÃ  gÃ¬?**

> CÃ¹ng business (PC + H5) = **cÃ¹ng interface**. Response chá»©a data cho cáº£ 2 (redundant OK). **Append** data khi business thay Ä‘á»•i, khÃ´ng break. Unique API chá»‰ khi platform-specific flow.

**752. Monitoring alarm scenarios?**

> Traffic **drop >80%** â†’ alarm. Error **spike >200%** â†’ alarm. No visits (báº¥t thÆ°á»ng) â†’ alarm. Auto summary browser/OS/errors. PhÃ¡t hiá»‡n bugs **trÆ°á»›c work order**.

**753. Monorepo lÃ  gÃ¬?**

> Quáº£n lÃ½ **nhiá»u projects** trong **1 repo**. Share code, config, deps. Google, Facebook, Microsoft dÃ¹ng. Evolution: Monolith â†’ MultiRepo â†’ **MonoRepo**.

**754. MultiRepo vs MonoRepo?**

> MultiRepo: âœ… isolation, per-repo access. âŒ Duplicate deps, npm link manual, inconsistent configs. MonoRepo: âœ… hoist deps, auto link, 1 cmd deploy, consistent config. âŒ Repo lá»›n (GB), no per-project access.

**755. Ghost dependencies lÃ  gÃ¬?**

> npm/yarn **hoist** deps. Project dÃ¹ng dep **khÃ´ng cÃ³** trong package.json (vÃ¬ project khÃ¡c install). Dep bá»‹ remove â†’ **crash**. Fix: **pnpm** (node_modules = package.json deps).

**756. pnpm giáº£i quyáº¿t gÃ¬?**

> **CAS** (Content Addressable Storage): hard links tá»« central store. **Virtual store**: `.pnpm/<pkg>@<version>`. âœ… No ghost deps. âœ… Fastest install. âœ… Disk efficient (same version = 1 copy).

**757. Lerna lÃ m gÃ¬ chÃ­nh?**

> (1) **Run commands** (lerna run). (2) **Manage deps** (lerna bootstrap, auto npm link). (3) **Publish** (detect changes â†’ update versions â†’ git tag â†’ npm publish). âŒ KhÃ´ng cÃ³ build/cache.

**758. Lerna Fixed vs Independent?**

> **Fixed/Locked**: táº¥t cáº£ packages **cÃ¹ng version** ("version": "0.0.0"). **Independent**: má»—i package **version riÃªng** ("version": "independent"). Git detect changes, chá»‰ release packages thay Ä‘á»•i.

**759. Turborepo features?**

> **Parallel tasks**: config dep order trong turbo.json. **Local cache**: `node_modules/.cache/turbo/` (láº§n 2 gáº§n instant). **Remote cache**: share trong CI/CD team (cloud). Vercel team.

**760. Nx vs Turborepo?**

> Nx: **incremental** build (minimal). **Distributed** build via Nx Cloud (nhiá»u CI agents). Remote cache: **public API** (tá»± host). Can **speed up Lerna**. Turborepo: simpler, remote cache = built-in only.

**761. Rush lÃ  gÃ¬?**

> Microsoft. Ghost deps **FIXED**: install vÃ o `common/temp` + symlinks. Parallel build + **plugin system**. Auto ChangeLog. Rush Stack: Heft + API Extractor + ESLint config.

**762. Yarn workspace vs Lerna?**

> Yarn workspace: **dep management** (hoisting). Lerna: **workflow** (publishing, versioning). Best: **cáº£ hai**: lerna.json `"npmClient": "yarn"`, `"useWorkspaces": true"`.

**763. lerna bootstrap lÃ m gÃ¬?**

> **npm install** + **npm link** cho táº¥t cáº£ packages. npm: redundant deps (má»—i package install riÃªng). Fix: `--hoist` hoáº·c dÃ¹ng yarn (auto hoist). Yarn: khÃ´ng cáº§n `--hoist`.

**764. lerna publish lÃ m gÃ¬?**

> (1) Detect packages cÃ³ changes. (2) Update version trong lerna.json + package.json. (3) Update deps of updated packages. (4) **Git commit + tag**. (5) **npm publish**.

**765. Incremental build lÃ  gÃ¬?**

> Chá»‰ build **packages thay Ä‘á»•i** (khÃ´ng full build). Turborepo/Nx/Rush support. Káº¿t há»£p **cache**: náº¿u unchanged + cached = **skip build**. Giáº£m build time Ä‘Ã¡ng ká»ƒ.

**766. Khi nÃ o cáº©n tháº­n vá»›i Monorepo?**

> (1) Code **quÃ¡ lá»›n**: build performance, git clone cháº­m. (2) **Access control** phá»©c táº¡p. (3) Teams **Ä‘á»™c láº­p cao**: MultiRepo linh hoáº¡t hÆ¡n. CÃ¢n nháº¯c cost/benefit.

**767. pnpm vs npm/yarn install?**

> npm/yarn: **copy** deps vÃ o node_modules (cháº­m, tá»‘n disk). pnpm: **hard links** tá»« central store (nhanh, tiáº¿t kiá»‡m). Different versions: chá»‰ store **diff files**. No duplicate copies.

**768. Progressive Monorepo strategy?**

> Start: **Lerna + pnpm workspace** + lerna-changelog (dep + version + publish). Scale: thÃªm **Nx/Turborepo** (incremental + parallel + cache). Smooth migration, khÃ´ng cáº§n lÃ m láº¡i tá»« Ä‘áº§u.

**769. FE Infrastructure lÃ  gÃ¬?**

> Tá»•ng há»£p: FE **engineering**, **DevOps**, **CI/CD**, **BFF**, cross-platform, tools. Serving **chá»‰ FE team**. Náº±m trong 4 táº§ng: Business âŠƒ Engineering âŠƒ FE âŠƒ BE.

**770. Táº¡i sao cáº§n FE infrastructure?**

> (1) **Business reuse**. (2) TÄƒng **R&D efficiency**. (3) **Standardize** quy trÃ¬nh. (4) **Team growth**. (5) Tech **influence**. (6) **Open source** contribution.

**771. CÃ¡ch promote FE infra?**

> â‘  **Find people**: dev cÃ³ Ä‘á»™ng lá»±c, systemic thinking, stable. â‘¡ Define **problems** dá»±a trÃªn hiá»‡n tráº¡ng. â‘¢ **Solutions**: viáº¿t BP chi tiáº¿t thuyáº¿t phá»¥c leadership. â‘£ Execute **incrementally**.

**772. 4 key traits cá»§a FE infra?**

> (1) **Tech soundness**: giáº£i phÃ¡p ká»¹ thuáº­t Ä‘Ãºng. (2) **Stability**: khÃ´ng gÃ¢y downtime. (3) **R&D efficiency**: tÄƒng nÄƒng suáº¥t thá»±c sá»±. (4) **UX**: user experience tá»‘t cho end-user.

**773. FE Standards bao gá»“m gÃ¬?**

> **Coding** conventions (naming, indentation, comments). **Git** conventions (branch, commit messages). **Code review** process. **CSS/JS** conventions. Giáº£m dev cost + ensure **consistency**.

**774. Táº¡i sao cáº§n FE documentation?**

> KhÃ´ng docs â†’ new hire **1 thÃ¡ng** váº«n chÆ°a hiá»ƒu business. Docs giÃºp: **há»c nhanh**, integrate team, hiá»ƒu business. Gá»“m: onboarding + business + API + architecture docs.

**775. CLI Scaffolding hiá»‡n táº¡i cÃ³ váº¥n Ä‘á» gÃ¬?**

> **>90%** teams chá»‰ dÃ¹ng CLI Ä‘á»ƒ táº¡o project (chÆ°a **maximize resources**). Cáº§n: template selection, config generation, auto dep install, lint integration, env setup.

**776. Khi nÃ o build component library riÃªng?**

> Khi company **design** khÃ¡c open source (Antd/Element). Äá»ƒ **thá»‘ng nháº¥t design language** toÃ n company. Náº¿u nhá»: dÃ¹ng open source + customize. Lá»›n: build own.

**777. Responsive vs Adaptive?**

> **Responsive**: 1 code, layout thay Ä‘á»•i theo screen. **Adaptive**: nhiá»u code, detect device â†’ return page riÃªng. Layout diff **lá»›n** giá»¯a PC/H5 â†’ adaptive. TÆ°Æ¡ng tá»± â†’ responsive.

**778. Utils library vs Tool automation?**

> **Utils**: code-level method reuse (Day.js, lodash alternatives). **Tool automation**: high-level process (ESLint + Prettier + Husky + CommitLint + Jest). KhÃ¡c nhau á»Ÿ **level**: code vs process.

**779. BFF lÃ m gÃ¬?**

> **Aggregate** backend microservices â†’ **unified API**. Compatible: mobile/web/H5. Benefits: **decouple** services + **security** + error handling. Free backend tá»« client-specific logic.

**780. Khi nÃ o cáº§n SSR?**

> Báº¯t buá»™c cho **ToC** projects cáº§n **SEO**. Server render HTML â†’ browser hydrate. Benefits: FE-BE separation + **fast first paint** + SEO. PHP/ASP/JSP = early SSR.

**781. Monitoring tracking cÃ³ máº¥y loáº¡i data?**

> 4 loáº¡i: (1) **Behavior**: time/location/user/interaction. (2) **Quality**: browser loading/errors. (3) **Environment**: browser/geo/carrier. (4) **Operations**: PV/UV/conversion/retention.

**782. Low-Code platform khi nÃ o phÃ¹ há»£p?**

> PhÃ¹ há»£p: **B2B** platforms, **high business volume**. KhÃ´ng phÃ¹ há»£p: Ã­t business, doanh nghiá»‡p nhá». Key: "DÃ¹ng tech má»›i vÃ¬ **PHÃ™ Há»¢P**, khÃ´ng vÃ¬ tiÃªn tiáº¿n."

**783. Micro-Frontend benefits?**

> Chia large app â†’ **small independent** apps (own repo, focus 1 feature). Integrate thÃ nh **SPA** (khÃ´ng máº¥t UX). Benefits: tech flexibility + independent deploy + code isolation + **parallel dev** + incremental upgrade.

**784. FE Visualization Platform lÃ m gÃ¬?**

> **Project management** + workflow visualization. **1-click** CI/CD stream setup. Env config: dev/test/prod trong **10 phÃºt** (thay vÃ¬ tÃ¬m ops ná»­a ngÃ y). WYSIWYG engineering dashboard.

---

## Checklist Há»c Táº­p

- [ ] Náº¯m Ä‘Æ°á»£c 8 kiá»ƒu dá»¯ liá»‡u trong JavaScript
- [ ] PhÃ¢n biá»‡t primitive vs reference types
- [ ] Hiá»ƒu cÃ¡ch lÆ°u trá»¯ memory (stack vs heap)
- [ ] Biáº¿t khi nÃ o dÃ¹ng typeof, instanceof, toString.call()
- [ ] Nhá»› cÃ¡c gotchas: typeof null, NaN !== NaN
- [ ] Viáº¿t Ä‘Æ°á»£c utility function kiá»ƒm tra type
- [ ] PhÃ¢n biá»‡t var, let, const (scope, hoisting, TDZ)
- [ ] Hiá»ƒu Temporal Dead Zone vÃ  táº¡i sao let/const an toÃ n hÆ¡n var
- [ ] Giáº£i thÃ­ch Ä‘Æ°á»£c bug classic for-loop vá»›i var vs let
- [ ] Biáº¿t best practice: const > let > never var
- [ ] Hiá»ƒu cÆ¡ cháº¿ Garbage Collection (Mark-and-Sweep, Reference Counting)
- [ ] Biáº¿t V8 Generational GC (Young/Old Generation)
- [ ] Nháº­n diá»‡n 4 loáº¡i Memory Leak vÃ  cÃ¡ch kháº¯c phá»¥c
- [ ] Biáº¿t cÃ¡ch giáº£i phÃ³ng bá»™ nhá»› thá»§ cÃ´ng (= null, WeakMap, clear timers)
- [ ] PhÃ¢n biá»‡t 3 loáº¡i scope: Global, Function, Block
- [ ] Hiá»ƒu Scope Chain vÃ  cÆ¡ cháº¿ tÃ¬m kiáº¿m biáº¿n
- [ ] Náº¯m khÃ¡i niá»‡m Lexical Scope (scope theo nÆ¡i Táº O, khÃ´ng pháº£i nÆ¡i Gá»ŒI)
- [ ] PhÃ¢n biá»‡t Scope Chain vs Prototype Chain
- [ ] Hiá»ƒu khÃ¡i niá»‡m Closure vÃ  2 chá»©c nÄƒng chÃ­nh (Báº£o vá»‡ & LÆ°u giá»¯)
- [ ] Biáº¿t Ä‘iá»u kiá»‡n hÃ¬nh thÃ nh closure (nested + reference outer vars)
- [ ] Náº¯m cÃ¡c á»©ng dá»¥ng: module pattern, currying, debounce, event handlers
- [ ] Hiá»ƒu trade-off closure: kÃ©o dÃ i vÃ²ng Ä‘á»i biáº¿n vs memory leak
- [ ] Náº¯m 5 trÆ°á»ng há»£p xÃ¡c Ä‘á»‹nh this (regular, method, new, arrow, call/apply/bind)
- [ ] Hiá»ƒu thá»© tá»± Æ°u tiÃªn this binding (new > bind > implicit > default)
- [ ] PhÃ¢n biá»‡t call vs apply vs bind (params, invoke, return)
- [ ] Biáº¿t cÃ¡c gotchas: callback máº¥t this, arrow fn khÃ´ng nÃªn lÃ m method
- [ ] Hiá»ƒu tam giÃ¡c: Constructor â†” Prototype â†” Instance (**proto**)
- [ ] Náº¯m cÆ¡ cháº¿ Prototype Chain lookup (obj â†’ prototype â†’ ... â†’ null)
- [ ] Biáº¿t pass-by-reference: thay Ä‘á»•i prototype áº£nh hÆ°á»Ÿng táº¥t cáº£ instances
- [ ] PhÃ¢n biá»‡t hasOwnProperty vs in, Object.keys() vs for...in
- [ ] Náº¯m 4 bÆ°á»›c cá»§a new operator (táº¡o {}, gÃ¡n prototype, bind this, check return)
- [ ] Viáº¿t Ä‘Æ°á»£c polyfill myNew() â€” cÃ¢u há»i phá»ng váº¥n kinh Ä‘iá»ƒn
- [ ] Biáº¿t edge cases: quÃªn new, arrow fn khÃ´ng dÃ¹ng new, return object override
- [ ] Hiá»ƒu Event Loop: Sync â†’ ALL Micro â†’ 1 Macro â†’ ALL Micro â†’ láº·p
- [ ] PhÃ¢n biá»‡t Macro-tasks (setTimeout, I/O) vs Micro-tasks (Promise.then)
- [ ] Biáº¿t Node.js Event Loop 6 phases vÃ  process.nextTick priority
- [ ] PhÃ¢n biá»‡t setTimeout (macro) vs Promise.then (micro) vs async/await (micro)
- [ ] Hiá»ƒu Promise constructor = SYNC, .then = ASYNC, resolve() khÃ´ng dá»«ng code
- [ ] Náº¯m 3 tráº¡ng thÃ¡i Promise: Pending â†’ Fulfilled / Rejected (immutable)
- [ ] Biáº¿t Promise chaining: .then() return Promise má»›i â†’ chain tiáº¿p
- [ ] PhÃ¢n biá»‡t Promise.all vs allSettled vs race vs any
- [ ] Hiá»ƒu error handling: .catch() báº¯t toÃ n chain, onRejected chá»‰ cÃ¹ng level
- [ ] Hiá»ƒu async/await = Generator + auto-executor + Promise
- [ ] PhÃ¢n biá»‡t sequential (await tuáº§n tá»±) vs parallel (Promise.all)
- [ ] Biáº¿t gotchas: await trong loop, forEach + await, async luÃ´n return Promise
- [ ] Hiá»ƒu Throttle: giá»›i háº¡n táº§n suáº¥t, dÃ¹ng timestamp, cháº¡y láº§n Ä‘áº§u má»—i chu ká»³
- [ ] Hiá»ƒu Debounce: chá» ngá»«ng trigger, dÃ¹ng clearTimeout, cháº¡y láº§n cuá»‘i
- [ ] Viáº¿t Ä‘Æ°á»£c polyfill throttle() vÃ  debounce() â€” cÃ¢u há»i phá»ng váº¥n phá»• biáº¿n
- [ ] PhÃ¢n biá»‡t offsetWidth vs clientWidth vs scrollWidth
- [ ] Biáº¿t scrollLeft/scrollTop lÃ  writable, cÃ²n láº¡i read-only
- [ ] Hiá»ƒu táº¡i sao KHÃ”NG dÃ¹ng getComputedStyle cho width/height
- [ ] Biáº¿t dÃ¹ng documentElement.clientW/H thay vÃ¬ window.innerW/H
- [ ] Hiá»ƒu táº¡i sao document full size cáº§n Math.max() tá»« nhiá»u sources
- [ ] Biáº¿t pageYOffset/scrollY Ä‘á»ƒ Ä‘á»c scroll position (read-only)
- [ ] PhÃ¢n biá»‡t scrollTo (tuyá»‡t Ä‘á»‘i) vs scrollBy (tÆ°Æ¡ng Ä‘á»‘i)
- [ ] Biáº¿t scrollIntoView(true/false) Ä‘á»ƒ scroll Ä‘áº¿n element
- [ ] Hiá»ƒu cÃ¡ch freeze scroll vÃ  fix "content jump"
- [ ] PhÃ¢n biá»‡t Window coords (clientX/Y) vs Document coords (pageX/Y)
- [ ] Biáº¿t getBoundingClientRect() vÃ  DOMRect properties
- [ ] Hiá»ƒu right/bottom trong JS â‰  CSS (JS tÃ­nh tá»« top-left)
- [ ] Biáº¿t dÃ¹ng elementFromPoint(x, y) vÃ  xá»­ lÃ½ null
- [ ] Biáº¿t chuyá»ƒn Ä‘á»•i window â†’ document coords (+ pageYOffset)
- [ ] PhÃ¢n biá»‡t position:fixed (window) vs position:absolute (document)
- [ ] Hiá»ƒu Proxy lÃ  wrapper cháº·n operations qua traps trong handler
- [ ] Náº¯m cÃ¡c traps chÃ­nh: get, set, has, deleteProperty, apply, construct, ownKeys
- [ ] Biáº¿t set trap PHáº¢I return true (náº¿u khÃ´ng â†’ TypeError)
- [ ] Hiá»ƒu táº¡i sao Reflect.get tá»‘t hÆ¡n target[prop] (receiver cho getter)
- [ ] Biáº¿t limitations: Built-in slots, private fields, proxy !== target
- [ ] Biáº¿t dÃ¹ng Proxy.revocable vÃ  WeakMap quáº£n lÃ½ revoke
- [ ] Náº¯m use cases: validation, default values, logging, observable, negative index
- [ ] Hiá»ƒu Event Loop algorithm: 1 Macro â†’ ALL Micros â†’ Render â†’ láº·p
- [ ] PhÃ¢n biá»‡t Macrotask (setTimeout, I/O) vs Microtask (Promise.then, await)
- [ ] Biáº¿t microtasks cháº¡y TRÆ¯á»šC render, Ä‘áº£m báº£o cÃ¹ng environment state
- [ ] Biáº¿t chia CPU-heavy task báº±ng setTimeout + chunks
- [ ] Hiá»ƒu DOM paint CHá»ˆ sau task hoÃ n thÃ nh â†’ setTimeout cho progress
- [ ] PhÃ¢n biá»‡t queueMicrotask (trÆ°á»›c render) vs setTimeout (sau render)
- [ ] Hiá»ƒu Reachability: object reachable tá»« root qua chuá»—i references â†’ giá»¯ láº¡i
- [ ] PhÃ¢n biá»‡t "referenced" vs "reachable from root" (Ä‘áº£o interlinked)
- [ ] Náº¯m Mark-and-Sweep algorithm: mark roots â†’ follow refs â†’ sweep unmarked
- [ ] Biáº¿t V8 optimizations: Generational, Incremental, Idle-time, Concurrent
- [ ] Biáº¿t 4 nguyÃªn nhÃ¢n memory leak: globals, timers, closures, detached DOM
- [ ] Biáº¿t patterns giáº£i phÃ³ng: null refs, WeakMap/WeakSet, clear timers/listeners
- [ ] Hiá»ƒu KHÃ”NG thá»ƒ force/prevent GC â€” chá»‰ cáº¯t references
- [ ] Biáº¿t 2 cÃ¡ch táº¡o object: {} (literal) vÃ  new Object()
- [ ] PhÃ¢n biá»‡t dot notation vs square brackets (key báº¥t ká»³, biáº¿n)
- [ ] Hiá»ƒu computed properties { [expr]: val } vÃ  shorthand { name }
- [ ] Biáº¿t dÃ¹ng delete, "in" operator, for..in loop
- [ ] Hiá»ƒu "in" chÃ­nh xÃ¡c hÆ¡n === undefined (khi value = undefined)
- [ ] Náº¯m property order: integer keys sorted, non-integer = creation order
- [ ] Biáº¿t **proto** lÃ  special property, number keys auto-convert string
- [ ] Hiá»ƒu obj.key â‰  obj[key] â€” dot tÃ¬m literal "key", [] dÃ¹ng biáº¿n
- [ ] Hiá»ƒu primitive copy by value vs object copy by reference
- [ ] Biáº¿t so sÃ¡nh object = so sÃ¡nh reference (khÃ´ng so content)
- [ ] Hiá»ƒu const object váº«n sá»­a properties Ä‘Æ°á»£c (chá»‰ lock reference)
- [ ] PhÃ¢n biá»‡t shallow clone (Object.assign, spread) vs deep clone
- [ ] Biáº¿t structuredClone: deep clone + circular refs, khÃ´ng há»— trá»£ functions
- [ ] Biáº¿t shallow clone â†’ nested objects váº«n chia sáº» reference
- [ ] Biáº¿t dÃ¹ng \_.cloneDeep cho complex cases vá»›i function properties
- [ ] Hiá»ƒu method = function stored in object property
- [ ] Biáº¿t method shorthand sayHi() {} vÃ  3 cÃ¡ch táº¡o method
- [ ] Hiá»ƒu this = object trÆ°á»›c dáº¥u cháº¥m, xÃ¡c Ä‘á»‹nh lÃºc call-time
- [ ] Biáº¿t arrow function khÃ´ng cÃ³ this riÃªng, láº¥y tá»« outer
- [ ] Hiá»ƒu táº¡i sao dÃ¹ng this thay vÃ¬ tÃªn biáº¿n trong method
- [ ] Biáº¿t ref: this trong literal = this cá»§a outer function
- [ ] Náº¯m method chaining pattern: return this
- [ ] Hiá»ƒu constructor = regular function + tÃªn Viáº¿t Hoa + gá»i báº±ng new
- [ ] Biáº¿t 3 bÆ°á»›c cá»§a new: this={}, cháº¡y body, return this
- [ ] Hiá»ƒu return rules: object â†’ override this, primitive â†’ bá» qua
- [ ] Biáº¿t new.target kiá»ƒm tra constructor mode
- [ ] Hiá»ƒu IIFE constructor: new function(){} cho 1 láº§n dÃ¹ng
- [ ] Biáº¿t methods trong constructor táº¡o má»›i má»—i láº§n new
- [ ] Hiá»ƒu arrow function KHÃ”NG lÃ m constructor Ä‘Æ°á»£c
- [ ] Biáº¿t 3 dáº¡ng optional chaining: ?.prop, ?.[], ?.()
- [ ] Hiá»ƒu short-circuiting: dá»«ng toÃ n bá»™ khi null/undefined
- [ ] Biáº¿t ?. chá»‰ optional pháº§n trÆ°á»›c, khÃ´ng pháº£i sau
- [ ] Hiá»ƒu KHÃ”NG dÃ¹ng ?. bÃªn trÃ¡i assignment
- [ ] Biáº¿t biáº¿n pháº£i khai bÃ¡o trÆ°á»›c khi dÃ¹ng ?.
- [ ] Hiá»ƒu Ä‘á»«ng láº¡m dá»¥ng ?. â€” che giáº¥u programming errors
- [ ] Biáº¿t dÃ¹ng ?. vá»›i delete OK
- [ ] Hiá»ƒu 3 hints: "string", "number", "default" vÃ  khi nÃ o dÃ¹ng
- [ ] Biáº¿t Symbol.toPrimitive xá»­ lÃ½ táº¥t cáº£ hints, báº¯t buá»™c return primitive
- [ ] Hiá»ƒu thá»© tá»±: Symbol.toPrimitive â†’ toString/valueOf theo hint
- [ ] Biáº¿t default toString = "[object Object]", valueOf = object chÃ­nh nÃ³
- [ ] Hiá»ƒu toString catch-all khi khÃ´ng cÃ³ tá»• há»£p khÃ¡c
- [ ] Biáº¿t 2-stage conversion: obj â†’ primitive â†’ kiá»ƒu cáº§n thiáº¿t
- [ ] Hiá»ƒu objects luÃ´n true trong boolean context
- [ ] Hiá»ƒu auto-boxing: primitive gá»i method â†’ táº¡o wrapper táº¡m â†’ há»§y
- [ ] Biáº¿t 5 wrapper types: String, Number, Boolean, Symbol, BigInt
- [ ] Hiá»ƒu null & undefined KHÃ”NG cÃ³ wrapper/methods
- [ ] Biáº¿t new Number(0) â†’ object (truthy!) â‰  Number(0) â†’ primitive
- [ ] Hiá»ƒu str.test = 5 â†’ wrapper táº¡m nháº­n rá»“i há»§y â†’ máº¥t
- [ ] Biáº¿t primitives KHÃ”NG lÆ°u thÃªm properties
- [ ] Biáº¿t strict mode TypeError khi gÃ¡n property cho primitive
- [ ] Biáº¿t e-notation: 1e9 (tá»·), 1e-6 (pháº§n triá»‡u), \_ separator
- [ ] Hiá»ƒu 3 há»‡ sá»‘: 0x (hex), 0b (binary), 0o (octal)
- [ ] Biáº¿t num.toString(base) vÃ  trick hai dáº¥u cháº¥m 123456..toString(36)
- [ ] Hiá»ƒu 4 rounding: floor â†“, ceil â†‘, round â‰ˆ, trunc âœ‚ï¸
- [ ] Biáº¿t toFixed(n) tráº£ STRING vÃ  gotcha 6.35.toFixed(1) = "6.3"
- [ ] Hiá»ƒu IEEE-754: 0.1 + 0.2 â‰  0.3 vÃ  cÃ¡ch fix
- [ ] PhÃ¢n biá»‡t isNaN (convert) vs Number.isNaN (strict)
- [ ] PhÃ¢n biá»‡t isFinite (convert) vs Number.isFinite (strict)
- [ ] Biáº¿t Object.is: NaN===NaN, 0!==-0
- [ ] Hiá»ƒu parseInt/parseFloat lÃ  "soft" conversion vs Number() "strict"
- [ ] Biáº¿t Math.floor + (max+1-min) cho uniform random integer
- [ ] Hiá»ƒu strings luÃ´n UTF-16 vÃ  immutable
- [ ] Biáº¿t 3 loáº¡i quotes: single, double, backticks (${}+multi-line)
- [ ] Biáº¿t str.length lÃ  PROPERTY (khÃ´ng cÃ³ ())
- [ ] Hiá»ƒu str[0] vs str.at(-1) (negative index)
- [ ] Biáº¿t special characters: \n, \t, \\, \', \", \`
- [ ] PhÃ¢n biá»‡t slice (nÃªn dÃ¹ng) vs substring (swap) vs substr (deprecated)
- [ ] Hiá»ƒu indexOf gotcha: tráº£ 0 = falsy, check !== -1
- [ ] Biáº¿t includes/startsWith/endsWith tráº£ boolean
- [ ] Hiá»ƒu so sÃ¡nh string theo character code (a > Z)
- [ ] Biáº¿t localeCompare cho so sÃ¡nh i18n Ä‘Ãºng
- [ ] Biáº¿t trim(), repeat(n), codePointAt/fromCodePoint
- [ ] Hiá»ƒu Array lÃ  object Ä‘áº·c biá»‡t, copy by reference
- [ ] Biáº¿t khai bÃ¡o [] (âœ…) vÃ  gotcha new Array(2)
- [ ] Hiá»ƒu arr[0] vs arr.at(-1) (negative index)
- [ ] Biáº¿t push/pop NHANH O(1), shift/unshift CHáº¬M O(n)
- [ ] Hiá»ƒu táº¡i sao shift pháº£i dá»‹ch táº¥t cáº£ elements
- [ ] Biáº¿t for(i) âœ…, for..of âœ…, for..in âŒ cho arrays
- [ ] Hiá»ƒu arr.length = greatest index + 1, writable
- [ ] Biáº¿t arr.length = 0 xÃ³a sáº¡ch, giáº£m length truncate
- [ ] Hiá»ƒu toString: [1,2]â†’"1,2" vÃ  [] + 1 â†’ "1"
- [ ] Biáº¿t [] == [] false, 0 == [] true (conversion)
- [ ] Hiá»ƒu Kadane's algorithm cho max subarray sum O(n)
- [ ] PhÃ¢n biá»‡t splice (MUTATE) vs slice (copy) vs concat (new)
- [ ] Biáº¿t splice cÃ³ thá»ƒ xÃ³a, thay tháº¿, vÃ  chÃ¨n (deleteCount=0)
- [ ] Hiá»ƒu forEach khÃ´ng tráº£ gÃ¬ (return bá»‹ ignore)
- [ ] Biáº¿t indexOf dÃ¹ng === (NaN sai), includes xá»­ lÃ½ NaN Ä‘Ãºng
- [ ] PhÃ¢n biá»‡t find (1st item) vs filter (all items) vs findIndex (pos)
- [ ] Biáº¿t map tráº£ object pháº£i bá»c (): user => ({...})
- [ ] Hiá»ƒu sort() default = STRING, cáº§n (a,b)=>a-b cho numbers
- [ ] Biáº¿t sort/reverse/splice MUTATE array gá»‘c
- [ ] Hiá»ƒu split(delim)â†”join(glue) chuyá»ƒn strâ†”arr
- [ ] Biáº¿t reduce(fn, init) vÃ  báº«y empty array + no initial
- [ ] Biáº¿t Array.isArray() vÃ¬ typeof [] = "object"
- [ ] Hiá»ƒu some (âˆƒ)/every (âˆ€) vÃ  Fisher-Yates shuffle
- [ ] Hiá»ƒu iterable = object cÃ³ Symbol.iterator method
- [ ] Biáº¿t iterator protocol: next() â†’ { done, value }
- [ ] Biáº¿t táº¡o custom iterable (range example)
- [ ] Hiá»ƒu separation of concerns: obj vs iterator riÃªng biá»‡t
- [ ] Biáº¿t merged iterator â†’ khÃ´ng 2 for..of song song
- [ ] Hiá»ƒu String lÃ  iterable, xá»­ lÃ½ surrogate pairs Ä‘Ãºng
- [ ] Biáº¿t gá»i iterator thá»§ cÃ´ng: str[Symbol.iterator]()
- [ ] PhÃ¢n biá»‡t iterable (Symbol.iterator) vs array-like (indexes+length)
- [ ] Biáº¿t Array.from() chuyá»ƒn iterable/array-like â†’ Array tháº­t
- [ ] Hiá»ƒu Array.from(str) xá»­ lÃ½ surrogate Ä‘Ãºng, khÃ¡c split("")
- [ ] Biáº¿t Map cho phÃ©p keys Báº¤T Ká»² type (obj, NaN, function)
- [ ] Hiá»ƒu SameValueZero: NaN === NaN trong Map
- [ ] Biáº¿t map[key] SAI â†’ dÃ¹ng map.set/get
- [ ] Biáº¿t Object lÃ m key trong Map âœ…, trong Object âŒ
- [ ] Hiá»ƒu Objectâ†”Map: Object.entries / Object.fromEntries
- [ ] Biáº¿t Map iteration giá»¯ insertion order
- [ ] Biáº¿t map.keys() tráº£ iterable, KHÃ”NG pháº£i Array
- [ ] Hiá»ƒu Set = unique values, .has() O(1)
- [ ] Biáº¿t Set loáº¡i trÃ¹ng: [...new Set(arr)]
- [ ] Hiá»ƒu forEach cá»§a Set: (value, value, set) cho Map compat
- [ ] Biáº¿t Set .keys()=.values(), .entries()â†’[v,v]
- [ ] Hiá»ƒu WeakMap: keys = objects only, weak reference
- [ ] Biáº¿t key bá»‹ GC â†’ entry tá»± xÃ³a (khÃ´ng memory leak)
- [ ] Biáº¿t WeakMap chá»‰ cÃ³ 4 methods: set/get/has/delete
- [ ] Hiá»ƒu táº¡i sao khÃ´ng cÃ³ size/keys/values/iterate (GC timing)
- [ ] Biáº¿t use case: additional data cho 3rd-party objects
- [ ] Biáº¿t use case: caching tá»± dá»n khi object bá»‹ GC
- [ ] Hiá»ƒu WeakSet: objects only, add/has/delete (chá»‰ 3)
- [ ] Biáº¿t WeakSet dÃ¹ng cho boolean flags ("read?", "visited?")
- [ ] Hiá»ƒu WeakMap/WeakSet = "secondary" storage
- [ ] Hiá»ƒu array destructuring: let [a, b] = arr (dÃ¹ng iterator)
- [ ] Biáº¿t bá» qua báº±ng comma: [a, , c] vÃ  rest: [...rest]
- [ ] Biáº¿t destructuring hoáº¡t Ä‘á»™ng vá»›i má»i iterable
- [ ] Biáº¿t swap trick: [a, b] = [b, a] khÃ´ng cáº§n temp
- [ ] Hiá»ƒu object destructuring: {prop: var = default}
- [ ] Biáº¿t rename {width: w} vÃ  káº¿t há»£p {width: w = 100}
- [ ] Hiá»ƒu ...rest cho object â†’ object (khÃ¡c array â†’ array)
- [ ] Biáº¿t gotcha: {x}=obj khÃ´ng let â†’ bá»c ({x}=obj)
- [ ] Hiá»ƒu nested destructuring: {size:{width}}
- [ ] Biáº¿t smart params: fn({a=1}={}) vÃ  táº¡i sao cáº§n ={}
- [ ] Biáº¿t destructuring khÃ´ng modify source (chá»‰ copy)
- [ ] Biáº¿t 4 cÃ¡ch táº¡o Date: new Date() / ms / string / components
- [ ] Hiá»ƒu month=0..11 (Jan=0!) vÃ  getDay()=0(Sunday)
- [ ] Biáº¿t getFullYear() (KHÃ”NG getYear!), getTime()â†’timestamp
- [ ] Hiá»ƒu autocorrection: out-of-range tá»± Ä‘iá»u chá»‰nh
- [ ] Biáº¿t setDate(0) = ngÃ y cuá»‘i thÃ¡ng trÆ°á»›c
- [ ] Hiá»ƒu +date = timestamp, date2-date1 = ms
- [ ] Biáº¿t Date.now() nhanh hÆ¡n new Date() (khÃ´ng táº¡o object)
- [ ] Biáº¿t Date.parse("ISO") â†’ timestamp, invalid â†’ NaN
- [ ] Hiá»ƒu benchmark: warm-up, alternate, nhiá»u láº§n
- [ ] Biáº¿t clone date: new Date(date) trÆ°á»›c khi modify
- [ ] Biáº¿t performance.now() cho microsecond precision
- [ ] Hiá»ƒu JSON.stringify: obj/arr/string/number/bool/null â†’ JSON
- [ ] Biáº¿t stringify bá» qua functions, Symbol, undefined
- [ ] Hiá»ƒu circular reference â†’ Error khi stringify
- [ ] Biáº¿t replacer: array (whitelist) hoáº·c function (filter)
- [ ] Biáº¿t space param cho pretty-print
- [ ] Hiá»ƒu toJSON(): custom serialize (Date cÃ³ built-in)
- [ ] Hiá»ƒu JSON.parse(str, reviver) vÃ  reviver transform
- [ ] Biáº¿t deep clone: JSON.parse(JSON.stringify(obj))
- [ ] Hiá»ƒu háº¡n cháº¿ deep clone JSON: máº¥t fn/Symbol/Date/circular
- [ ] Hiá»ƒu callback: fn truyá»n vÃ o, cháº¡y khi async hoÃ n thÃ nh
- [ ] Biáº¿t error-first callback: callback(err, result)
- [ ] Hiá»ƒu callback-in-callback cho sequential async
- [ ] Biáº¿t Pyramid of Doom / Callback Hell vÃ  váº¥n Ä‘á»
- [ ] Biáº¿t giáº£i phÃ¡p: tÃ¡ch named fn (giáº£m thiá»‡u)
- [ ] Hiá»ƒu Promises vÃ  async/await giáº£i quyáº¿t Callback Hell
- [ ] Hiá»ƒu Promise constructor: new Promise((resolve, reject) => {})
- [ ] Biáº¿t executor cháº¡y Tá»° Äá»˜NG, resolve/reject chá»‰ 1 láº§n
- [ ] Hiá»ƒu 3 states: pending â†’ fulfilled / rejected
- [ ] Biáº¿t .then(onOK, onErr), .catch(fn), .finally(fn)
- [ ] Hiá»ƒu finally: no args, pass-through, return ignored
- [ ] Biáº¿t handler on settled promise cháº¡y ngay
- [ ] Hiá»ƒu Promise > Callback: natural order, multiple .then
- [ ] Biáº¿t viáº¿t delay(ms) báº±ng Promise
- [ ] Hiá»ƒu loadScript callback â†’ Promise rewrite
- [ ] Biáº¿t resolve ngay = OK (cached result)
- [ ] Hiá»ƒu .then() tráº£ NEW promise â†’ chaining
- [ ] Biáº¿t return value â†’ resolved, return Promise â†’ chá»
- [ ] PhÃ¢n biá»‡t chaining vs nhiá»u .then trÃªn 1 promise
- [ ] Hiá»ƒu Thenable: object cÃ³ .then() tÆ°Æ¡ng thÃ­ch
- [ ] Biáº¿t fetch chaining: .then(râ†’r.json()).then(...)
- [ ] Hiá»ƒu .then(f1).catch(f2) vs .then(f1,f2)
- [ ] Biáº¿t async action nÃªn luÃ´n return promise
- [ ] Biáº¿t tÃ¡ch reusable fn (loadJson, showAvatar)
- [ ] Hiá»ƒu implicit try..catch: throw = auto reject
- [ ] Biáº¿t .catch cuá»‘i chain báº¯t má»i error trÆ°á»›c Ä‘Ã³
- [ ] Hiá»ƒu rethrowing: .catch xá»­ lÃ½ â†’ .then, throw â†’ .catch tiáº¿p
- [ ] Biáº¿t unhandled rejection vÃ  unhandledrejection event
- [ ] Hiá»ƒu setTimeout throw â‰  reject (async context riÃªng)
- [ ] Biáº¿t dÃ¹ng reject() trong setTimeout, khÃ´ng throw
- [ ] Biáº¿t instanceof Ä‘á»ƒ check error type vÃ  rethrow
- [ ] Hiá»ƒu .catch recovery: xá»­ lÃ½ xong â†’ tiáº¿p .then
- [ ] Biáº¿t Promise.all: chá» táº¥t cáº£, 1 fail = reject ngay
- [ ] Hiá»ƒu Promise.all giá»¯ thá»© tá»± káº¿t quáº£ theo input
- [ ] Biáº¿t Promise.allSettled: tráº£ {status, value/reason}
- [ ] PhÃ¢n biá»‡t Promise.race (first settled) vs .any (first fulfilled)
- [ ] Biáº¿t AggregateError khi Promise.any táº¥t cáº£ reject
- [ ] Hiá»ƒu Promise.resolve/reject cho compatibility
- [ ] Biáº¿t trick: urls.map(fn) + Promise.all
- [ ] Hiá»ƒu Promise.all khÃ´ng cancel promises khÃ¡c
- [ ] Biáº¿t allSettled polyfill pattern
- [ ] Hiá»ƒu promisification: callback fn â†’ Promise wrapper
- [ ] Biáº¿t viáº¿t promisify(f) generic helper
- [ ] Hiá»ƒu manyArgs: resolve vá»›i array results
- [ ] Biáº¿t háº¡n cháº¿: chá»‰ fn gá»i callback 1 láº§n
- [ ] Biáº¿t Node.js util.promisify() built-in
- [ ] Hiá»ƒu promisify khÃ´ng thay tháº¿ toÃ n bá»™ callbacks
- [ ] Biáº¿t f.call(this, ...args) giá»¯ context
- [ ] Hiá»ƒu microtask queue: .then cháº¡y SAU current code
- [ ] Biáº¿t thá»© tá»±: sync â†’ microtask â†’ macrotask
- [ ] Hiá»ƒu FIFO: enqueue trÆ°á»›c cháº¡y trÆ°á»›c
- [ ] Biáº¿t unhandledrejection check sau microtask queue rá»—ng
- [ ] Hiá»ƒu setTimeout .catch = quÃ¡ trá»… cho unhandledrejection
- [ ] Biáº¿t Ä‘áº£m báº£o thá»© tá»± báº±ng .then chain
- [ ] PhÃ¢n biá»‡t microtask (Promise) vs macrotask (setTimeout)
- [ ] Hiá»ƒu event loop: macrotask â†’ all microtasks â†’ render
- [ ] Biáº¿t split CPU task vá»›i setTimeout(fn, 0)
- [ ] Hiá»ƒu schedule trÆ°á»›c lÃ m viá»‡c (táº­n dá»¥ng 4ms delay)
- [ ] Biáº¿t DOM paint chá»‰ sau task (cáº§n setTimeout cho progress)
- [ ] PhÃ¢n biá»‡t queueMicrotask vs setTimeout (trÆ°á»›c/sau render)
- [ ] Giáº£i Ä‘Æ°á»£c bÃ i output order: 1 7 3 5 2 6 4
- [ ] Biáº¿t Web Workers: parallel thread, khÃ´ng DOM
- [ ] Hiá»ƒu setTimeout(fn, 0) cho post-event actions
- [ ] Biáº¿t "Page Unresponsive" do task quÃ¡ lÃ¢u
- [ ] Hiá»ƒu async fn luÃ´n tráº£ Promise
- [ ] Biáº¿t await suspend execution, reject = throw
- [ ] DÃ¹ng try..catch cho error handling trong async/await
- [ ] Biáº¿t await + Promise.all cho parallel
- [ ] Hiá»ƒu top-level await (ES modules) vÃ  IIFE fallback
- [ ] Biáº¿t gá»i async tá»« non-async: fn().then(...)
- [ ] Hiá»ƒu await cháº¥p nháº­n Thenable objects
- [ ] Biáº¿t dangerous Promise.all vÃ  cÃ¡ch fix
- [ ] Rewrite recursion â†’ while(true) + try/catch + break
- [ ] Biáº¿t async class methods
- [ ] Hiá»ƒu window: global object + browser window
- [ ] Biáº¿t DOM: document = page content lÃ  objects
- [ ] Hiá»ƒu CSSOM: CSS rules lÃ  objects (hiáº¿m dÃ¹ng trá»±c tiáº¿p)
- [ ] Biáº¿t BOM: navigator, location, alert/confirm/prompt
- [ ] PhÃ¢n biá»‡t DOM vs BOM vs CSSOM
- [ ] Biáº¿t 3 specs: DOM, CSSOM, HTML (bao gá»“m BOM)
- [ ] Biáº¿t tÃ¬m thÃ´ng tin: MDN vs WHATWG/W3C spec
- [ ] Hiá»ƒu HTML spec má»Ÿ rá»™ng DOM spec
- [ ] Biáº¿t DOM tree: tags = element nodes, text = text nodes
- [ ] Hiá»ƒu spaces/newlines táº¡o text nodes
- [ ] Biáº¿t 2 ngoáº¡i lá»‡: trÆ°á»›c <head> vÃ  sau </body>
- [ ] Hiá»ƒu autocorrection: browser sá»­a HTML lá»—i
- [ ] Biáº¿t table luÃ´n cÃ³ <tbody> (tá»± thÃªm!)
- [ ] Biáº¿t 4 node types: document/element/text/comment
- [ ] Hiá»ƒu comments vÃ  DOCTYPE cÅ©ng lÃ  DOM nodes
- [ ] Biáº¿t $0 vÃ  inspect(node) trong DevTools
- [ ] PhÃ¢n biá»‡t 12 node types (4 thÆ°á»ng dÃ¹ng)
- [ ] Biáº¿t document.documentElement / .body / .head
- [ ] Hiá»ƒu document.body cÃ³ thá»ƒ null
- [ ] PhÃ¢n biá»‡t childNodes vs children
- [ ] Biáº¿t DOM collections: live, read-only, iterable
- [ ] Hiá»ƒu parentElement vs parentNode
- [ ] PhÃ¢n biá»‡t previousSibling vs previousElementSibling
- [ ] Biáº¿t table navigation: rows, cells, cellIndex
- [ ] Biáº¿t khÃ´ng dÃ¹ng for..in vá»›i DOM collections
- [ ] DÃ¹ng Array.from() cho DOM collections
- [ ] Biáº¿t getElementById: chá»‰ document, id unique
- [ ] DÃ¹ng querySelector/querySelectorAll (STATIC)
- [ ] PhÃ¢n biá»‡t live vs static collections
- [ ] Biáº¿t matches(css): kiá»ƒm tra elem khá»›p selector
- [ ] Biáº¿t closest(css): ancestor gáº§n nháº¥t
- [ ] Biáº¿t getElementsBy\*: live, legacy
- [ ] Hiá»ƒu Ä‘á»«ng dÃ¹ng id-named global variables
- [ ] Biáº¿t contains(): kiá»ƒm tra cha-con
- [ ] PhÃ¢n biá»‡t querySelector vs querySelectorAll
- [ ] Hiá»ƒu DOM class hierarchy (EventTarget â†’ Node â†’ Element)
- [ ] Biáº¿t nodeType: 1=element, 3=text, 9=document
- [ ] PhÃ¢n biá»‡t tagName vs nodeName
- [ ] Hiá»ƒu innerHTML vÃ  cáº¡m bá»«y += (full overwrite)
- [ ] Hiá»ƒu outerHTML khÃ´ng thay Ä‘á»•i biáº¿n reference
- [ ] Biáº¿t textContent an toÃ n cho user input
- [ ] DÃ¹ng data/nodeValue cho text/comment nodes
- [ ] Biáº¿t hidden property (áº©n element)
- [ ] PhÃ¢n biá»‡t console.log vs console.dir cho DOM
- [ ] Biáº¿t class-specific: value, href, type, id
- [ ] DÃ¹ng createElement vÃ  createTextNode
- [ ] Biáº¿t append/prepend/before/after/replaceWith
- [ ] Hiá»ƒu strings chÃ¨n nhÆ° text (safe), khÃ´ng HTML
- [ ] DÃ¹ng insertAdjacentHTML (4 positions)
- [ ] Biáº¿t node.remove() vÃ  insert tá»± move
- [ ] PhÃ¢n biá»‡t cloneNode(true) vs cloneNode(false)
- [ ] Hiá»ƒu DocumentFragment (vÃ  thay báº±ng array)
- [ ] Biáº¿t old-school: appendChild/insertBefore/removeChild
- [ ] Hiá»ƒu document.write chá»‰ dÃ¹ng khi loading
- [ ] XÃ³a children: while loop hoáº·c innerHTML = ""
- [ ] PhÃ¢n biá»‡t className vs classList
- [ ] Biáº¿t classList: add/remove/toggle/contains
- [ ] Hiá»ƒu elem.style camelCase vÃ  cáº§n units
- [ ] Biáº¿t reset style: gÃ¡n "" hoáº·c removeProperty
- [ ] Hiá»ƒu style.cssText ghi Ä‘Ã¨ toÃ n bá»™
- [ ] DÃ¹ng getComputedStyle Ä‘á»c resolved styles
- [ ] Biáº¿t elem.style khÃ´ng tháº¥y CSS class styles
- [ ] Hiá»ƒu computed vs resolved values
- [ ] Biáº¿t :visited styles bá»‹ áº©n vÃ¬ báº£o máº­t
- [ ] LuÃ´n dÃ¹ng full property name trong getComputedStyle
- [ ] Biáº¿t 3 cÃ¡ch gÃ¡n event handler
- [ ] Hiá»ƒu addEventListener options: once/capture/passive
- [ ] Biáº¿t removeEventListener cáº§n cÃ¹ng fn reference
- [ ] PhÃ¢n biá»‡t onclick = fn vs fn() (reference vs call)
- [ ] Biáº¿t events chá»‰ vá»›i addEventListener (DOMContentLoaded)
- [ ] Hiá»ƒu event object: type, currentTarget, clientX/Y
- [ ] Biáº¿t currentTarget vs this (arrow function)
- [ ] Hiá»ƒu handleEvent pattern (object handler)
- [ ] KhÃ´ng dÃ¹ng setAttribute cho handlers
- [ ] Biáº¿t DOM prop vÃ  addEventListener cháº¡y Ä‘á»“ng thá»i
- [ ] Hiá»ƒu bubbling: event cháº¡y tá»« target lÃªn ancestors
- [ ] PhÃ¢n biá»‡t event.target vs event.currentTarget
- [ ] Biáº¿t stopPropagation vs stopImmediatePropagation
- [ ] Hiá»ƒu táº¡i sao khÃ´ng nÃªn stop bubbling tÃ¹y tiá»‡n
- [ ] Biáº¿t 3 phases: capturing â†’ target â†’ bubbling
- [ ] DÃ¹ng {capture: true} cho capturing phase
- [ ] Biáº¿t removeEventListener cáº§n cÃ¹ng phase
- [ ] Hiá»ƒu stopPropagation á»Ÿ capturing cháº·n cáº£ bubbling
- [ ] Hiá»ƒu event delegation: 1 handler trÃªn container
- [ ] DÃ¹ng closest() thay vÃ¬ tagName check
- [ ] Biáº¿t container.contains() cho nested structures
- [ ] Hiá»ƒu data-action pattern (map clicks â†’ methods)
- [ ] Hiá»ƒu behavior pattern (data-\* + document handler)
- [ ] Biáº¿t document-level luÃ´n dÃ¹ng addEventListener
- [ ] Biáº¿t Æ°u Ä‘iá»ƒm: Ã­t memory, DOM Ä‘á»™ng, Ã­t code
- [ ] Biáº¿t háº¡n cháº¿: event pháº£i bubble
- [ ] Hiá»ƒu preventDefault() cháº·n default action
- [ ] Biáº¿t return false chá»‰ vá»›i on<event>
- [ ] Hiá»ƒu passive: true cho mobile scroll
- [ ] DÃ¹ng defaultPrevented thay stopPropagation
- [ ] PhÃ¢n biá»‡t preventDefault vs stopPropagation
- [ ] Hiá»ƒu follow-up events (mousedown â†’ focus)
- [ ] Giá»¯ semantic HTML (<a> navigation, <button> action)
- [ ] Biáº¿t onclick="return handler()" gotcha
- [ ] Táº¡o event: new Event(type, {bubbles, cancelable})
- [ ] DÃ¹ng MouseEvent/KeyboardEvent cho properties riÃªng
- [ ] Hiá»ƒu CustomEvent vá»›i detail property
- [ ] Biáº¿t dispatchEvent(event) phÃ¡t event
- [ ] Biáº¿t dispatchEvent tráº£ false náº¿u Ä‘Ã£ preventDefault
- [ ] Biáº¿t cancelable: true Ä‘á»ƒ preventDefault hoáº¡t Ä‘á»™ng
- [ ] PhÃ¢n biá»‡t isTrusted: true (user) vs false (script)
- [ ] Hiá»ƒu events-in-events Ä‘á»“ng bá»™ (setTimeout cho async)
- [ ] Custom events chá»‰ báº¯t vá»›i addEventListener
- [ ] Hiá»ƒu MutationObserver: observe DOM changes
- [ ] Biáº¿t config: childList, subtree, attributes, characterData
- [ ] Hiá»ƒu MutationRecord: type, target, addedNodes
- [ ] DÃ¹ng disconnect() vÃ  takeRecords() Ä‘Ãºng cÃ¡ch
- [ ] Ãp dá»¥ng: auto-highlight, xÃ³a ads, 3rd-party integration
- [ ] Biáº¿t \*OldValue options giá»¯ giÃ¡ trá»‹ cÅ©
- [ ] Biáº¿t observer dÃ¹ng weak refs (khÃ´ng cháº·n GC)
- [ ] Config Ä‘á»ƒ tá»‘i Æ°u, khÃ´ng theo dÃµi thá»«a
- [ ] Hiá»ƒu Range: setStart/setEnd vá»›i text offset vÃ  child index
- [ ] Biáº¿t Range editing: delete/extract/clone/insert/surround
- [ ] PhÃ¢n biá»‡t Selection anchor/focus vs Range start/end
- [ ] Biáº¿t removeAllRanges() trÆ°á»›c addRange()
- [ ] Hiá»ƒu form selection API: selectionStart/End
- [ ] DÃ¹ng setRangeText cho form controls
- [ ] Biáº¿t cursor = selectionStart === selectionEnd
- [ ] Hiá»ƒu 3 cÃ¡ch lÃ m unselectable
- [ ] Biáº¿t onselectstart vs onselectionchange
- [ ] Hiá»ƒu fetch tráº£ Promise<Response> (2 giai Ä‘oáº¡n)
- [ ] Biáº¿t 404/500 khÃ´ng reject, chá»‰ network error reject
- [ ] DÃ¹ng response.ok / .status check HTTP status
- [ ] Biáº¿t body chá»‰ Ä‘á»c 1 láº§n (consumed)
- [ ] DÃ¹ng .json() .text() .blob() .arrayBuffer() .formData()
- [ ] POST vá»›i JSON.stringify + Content-Type: application/json
- [ ] Biáº¿t Blob body tá»± set Content-Type
- [ ] Hiá»ƒu forbidden headers (browser control)
- [ ] Parallel fetch vá»›i Promise.all + per-fetch .json()
- [ ] PhÃ¢n biá»‡t fetch vs XMLHttpRequest
- [ ] Hiá»ƒu FormData: new FormData(form) auto capture
- [ ] Biáº¿t append vs set (append cho trÃ¹ng, set xÃ³a trÃ¹ng)
- [ ] Gá»­i file: append(name, blob, fileName)
- [ ] Biáº¿t fetch tá»± set Content-Type: multipart/form-data
- [ ] KhÃ´ng set Content-Type thá»§ cÃ´ng cho FormData!
- [ ] Táº¡o FormData khÃ´ng cáº§n form element
- [ ] Biáº¿t khi nÃ o dÃ¹ng FormData thay JSON
- [ ] Iterate FormData vá»›i for..of
- [ ] Hiá»ƒu response.body ReadableStream
- [ ] DÃ¹ng getReader() + while loop Ä‘á»c chunks
- [ ] Biáº¿t Content-Length cÃ³ thá»ƒ váº¯ng (cross-origin)
- [ ] Gá»™p Uint8Array chunks vá»›i .set(chunk, position)
- [ ] Decode: TextDecoder cho string, Blob cho binary
- [ ] Biáº¿t fetch khÃ´ng há»— trá»£ upload progress
- [ ] Handle memory overflow khi size khÃ´ng biáº¿t
- [ ] Hiá»ƒu AbortController: abort() + signal
- [ ] DÃ¹ng fetch(url, {signal}) Ä‘á»ƒ há»§y request
- [ ] Báº¯t AbortError trong try/catch
- [ ] 1 controller há»§y nhiá»u fetch cÃ¹ng lÃºc
- [ ] DÃ¹ng signal.addEventListener cho custom tasks
- [ ] Pattern timeout: setTimeout + abort()
- [ ] Biáº¿t AbortController dÃ¹ng Ä‘Æ°á»£c ngoÃ i fetch
- [ ] Hiá»ƒu referrer/referrerPolicy (8 policies)
- [ ] Biáº¿t mode: cors/same-origin/no-cors
- [ ] Hiá»ƒu credentials: same-origin/include/omit
- [ ] Biáº¿t 6 cache modes
- [ ] Hiá»ƒu redirect: follow/error/manual
- [ ] DÃ¹ng integrity cho SHA checksum verification
- [ ] Hiá»ƒu keepalive: sá»‘ng sau unload (â‰¤ 64KB)
- [ ] Biáº¿t credentials: include cáº§n server header
- [ ] Biáº¿t referrer policy Ã¡p dá»¥ng ngoÃ i fetch
- [ ] Hiá»ƒu URL class: new URL(url, base)
- [ ] Biáº¿t URL components: protocol/host/pathname/search/hash
- [ ] DÃ¹ng searchParams (auto-encode, iterable)
- [ ] PhÃ¢n biá»‡t encodeURI vs encodeURIComponent
- [ ] Biáº¿t encodeURI giá»¯ &?=# (cho whole URL)
- [ ] DÃ¹ng encodeURIComponent cho search params
- [ ] Hiá»ƒu URL (RFC3986) vs encode\* (RFC2396)
- [ ] Biáº¿t getAll tráº£ array, get tráº£ giÃ¡ trá»‹ Ä‘áº§u
- [ ] Biáº¿t URL object dÃ¹ng thay string á»Ÿ fetch/XHR
- [ ] Hiá»ƒu 3 bÆ°á»›c XHR: new â†’ open â†’ send
- [ ] Biáº¿t open() chá»‰ cáº¥u hÃ¬nh, khÃ´ng gá»­i request
- [ ] PhÃ¢n biá»‡t load (hoÃ n thÃ nh) vs error (network fail)
- [ ] Biáº¿t responseType: text/json/blob/arraybuffer
- [ ] Hiá»ƒu readyState 0â†’4 (readystatechange deprecated)
- [ ] Biáº¿t setRequestHeader appends khÃ´ng overwrite
- [ ] Parse getAllResponseHeaders: split \r\n + ": "
- [ ] DÃ¹ng xhr.upload.onprogress cho upload progress
- [ ] Hiá»ƒu withCredentials cho cross-origin cookies
- [ ] Biáº¿t sync mode block JS (trÃ¡nh dÃ¹ng)
- [ ] Biáº¿t lifecycle: loadstartâ†’progressâ†’load/errorâ†’loadend
- [ ] PhÃ¢n biá»‡t khi nÃ o dÃ¹ng XHR vs fetch
- [ ] Biáº¿t táº¡o fileId: name + size + lastModified
- [ ] Hiá»ƒu algorithm 3 bÆ°á»›c resumable upload
- [ ] DÃ¹ng file.slice(startByte) gá»­i pháº§n cÃ²n láº¡i
- [ ] Biáº¿t onprogress chá»‰ track sent khÃ´ng pháº£i received
- [ ] TÃ­nh progress resume: startByte + event.loaded
- [ ] Hiá»ƒu custom headers X-File-Id, X-Start-Byte
- [ ] Biáº¿t server cáº§n track vÃ  verify cho resume
- [ ] PhÃ¢n biá»‡t regular polling vs long polling
- [ ] Hiá»ƒu flow: request â†’ server giá»¯ â†’ respond â†’ reconnect
- [ ] Viáº¿t subscribe() recursive async function
- [ ] Xá»­ lÃ½ 502 reconnect ngay, error khÃ¡c delay 1s
- [ ] Biáº¿t server cáº§n handle nhiá»u pending connections
- [ ] Biáº¿t long polling tá»‘t cho rare messages
- [ ] Khi messages nhiá»u â†’ dÃ¹ng WebSocket/SSE
- [ ] Hiá»ƒu WebSocket: persistent bi-directional connection
- [ ] LuÃ´n dÃ¹ng wss:// (encrypted, proxy-safe)
- [ ] Biáº¿t 4 events: open/message/error/close
- [ ] Hiá»ƒu handshake: Upgrade â†’ 101 Switching Protocols
- [ ] Gá»­i string/Blob/ArrayBuffer vá»›i send()
- [ ] Biáº¿t binaryType: blob (default) / arraybuffer
- [ ] DÃ¹ng bufferedAmount cho rate limiting
- [ ] Hiá»ƒu close codes: 1000/1006/1001
- [ ] Biáº¿t readyState: 0â†’3 (CONNECTINGâ†’CLOSED)
- [ ] Biáº¿t WebSocket cross-origin khÃ´ng háº¡n cháº¿
- [ ] Biáº¿t cáº§n tá»± implement reconnection/auth
- [ ] Hiá»ƒu SSE: one-way serverâ†’client, text only
- [ ] Biáº¿t SSE vs WebSocket: khi nÃ o dÃ¹ng cÃ¡i nÃ o
- [ ] Server: Content-Type: text/event-stream
- [ ] Biáº¿t 4 fields: data/id/retry/event
- [ ] Hiá»ƒu auto-reconnect + retry: (ms) + 204 stops
- [ ] DÃ¹ng id + lastEventId + Last-Event-ID resume
- [ ] Custom events dÃ¹ng addEventListener khÃ´ng onmessage
- [ ] Biáº¿t readyState: 0/1/2 (CONNECTING/OPEN/CLOSED)
- [ ] Biáº¿t close() khÃ´ng reopen, táº¡o má»›i
- [ ] Hiá»ƒu cross-origin vá»›i withCredentials
- [ ] Biáº¿t retry khÃ´ng set tá»« JavaScript
- [ ] PhÃ¢n biá»‡t announce vs reestablish vs fail
- [ ] Biáº¿t fail: status!=200 hoáº·c wrong Content-Type
- [ ] DÃ¹ng comment (:) lÃ m keepalive má»—i 15s
- [ ] Hiá»ƒu data: append + \n, trailing \n removed
- [ ] Biáº¿t id khÃ´ng cháº¥p nháº­n NULL, empty resets
- [ ] Biáº¿t retry chá»‰ cháº¥p nháº­n ASCII digits
- [ ] Hiá»ƒu dispatch rules: empty data = skip
- [ ] Biáº¿t 6 conn/domain limit â†’ SharedWorker
- [ ] Hiá»ƒu cache: no-store cho EventSource
- [ ] Biáº¿t GC rules: strong ref khi cÃ³ listeners
- [ ] Hiá»ƒu Web Worker: background thread, khÃ´ng block UI
- [ ] Táº¡o Dedicated Worker vÃ  gá»­i/nháº­n postMessage
- [ ] PhÃ¢n biá»‡t Dedicated vs Shared Worker
- [ ] Hiá»ƒu structured clone (copy) cho data transfer
- [ ] DÃ¹ng Transferable objects (zero-copy ArrayBuffer)
- [ ] Biáº¿t SharedArrayBuffer cho shared memory
- [ ] Biáº¿t Worker khÃ´ng cÃ³ DOM/window, cÃ³ fetch/WS
- [ ] DÃ¹ng terminate() vÃ  onerror
- [ ] Hiá»ƒu importScripts() synchronous
- [ ] Táº¡o embedded worker vá»›i Blob URL
- [ ] Biáº¿t Shared Worker dÃ¹ng port communication
- [ ] Hiá»ƒu CSP riÃªng cho workers
- [ ] PhÃ¢n biá»‡t ServiceWorker vs Web Worker
- [ ] Liá»‡t kÃª WorkerGlobalScope functions cÃ³ sáºµn
- [ ] Biáº¿t importScripts() chá»‰ cÃ³ trong Worker
- [ ] Biáº¿t rAF chá»‰ cÃ³ trong Dedicated Worker
- [ ] PhÃ¢n nhÃ³m Web APIs cÃ³ trong Worker
- [ ] Liá»‡t kÃª APIs KHÃ”NG cÃ³: DOM, window, localStorage
- [ ] DÃ¹ng IndexedDB thay localStorage trong Worker
- [ ] Biáº¿t BroadcastChannel trong Worker
- [ ] Biáº¿t Workers cÃ³ thá»ƒ táº¡o sub-workers
- [ ] Hiá»ƒu structured clone: deep copy + cycle detection
- [ ] Biáº¿t clone KHÃ”NG Ä‘Æ°á»£c: functions, DOM nodes
- [ ] Biáº¿t Symbol, descriptors, prototype chain máº¥t
- [ ] Biáº¿t RegExp lastIndex reset vá» 0 khi clone
- [ ] Liá»‡t kÃª JS types clone Ä‘Æ°á»£c
- [ ] Liá»‡t kÃª Web/API types clone Ä‘Æ°á»£c
- [ ] Hiá»ƒu Error types serialize name+message+stack
- [ ] So sÃ¡nh structuredClone vs JSON deep copy
- [ ] Biáº¿t circular references clone OK
- [ ] Hiá»ƒu transferable: move ownership, original detach
- [ ] DÃ¹ng postMessage(data, [transferList])
- [ ] DÃ¹ng structuredClone({ transfer: [...] })
- [ ] Biáº¿t TypedArray serializable nhÆ°ng KHÃ”NG transferable
- [ ] Transfer .buffer (ArrayBuffer) thay vÃ¬ TypedArray
- [ ] Liá»‡t kÃª supported transferable objects
- [ ] PhÃ¢n biá»‡t [Serializable] vs [Transferable]
- [ ] Biáº¿t byteLength = 0 sau transfer
- [ ] Hiá»ƒu Worker interface: postMessage, terminate
- [ ] Hiá»ƒu SharedWorker: port (MessagePort), connect
- [ ] PhÃ¢n biá»‡t terminate() (main) vs close() (worker)
- [ ] Biáº¿t messageerror event
- [ ] Liá»‡t kÃª WorkerGlobalScope properties
- [ ] Liá»‡t kÃª WorkerGlobalScope events
- [ ] Hiá»ƒu WorkerLocation: URL subset read-only
- [ ] Hiá»ƒu WorkerNavigator: Navigator subset
- [ ] Biáº¿t DedicatedScope cÃ³ rAF cho OffscreenCanvas
- [ ] Hiá»ƒu SharedWorker lifetime (owner set)
- [ ] Biáº¿t SharedWorkerGlobalScope connect event
- [ ] Hiá»ƒu Service Worker lÃ  proxy server
- [ ] Biáº¿t lifecycle: Download â†’ Install â†’ Activate
- [ ] DÃ¹ng navigator.serviceWorker.register()
- [ ] Hiá»ƒu waitUntil() giá»¯ SW alive
- [ ] DÃ¹ng respondWith() intercept requests
- [ ] Implement cache-first strategy
- [ ] Biáº¿t response.clone() vÃ¬ stream Ä‘á»c 1 láº§n
- [ ] DÃ¹ng skipWaiting() + clients.claim()
- [ ] Hiá»ƒu worker-in-waiting concept
- [ ] Dá»n cache cÅ© trong activate event
- [ ] Biáº¿t navigation preload giáº£m delay
- [ ] PhÃ¢n biá»‡t Cache API vs localStorage
- [ ] Hiá»ƒu scope cá»§a Service Worker
- [ ] Liá»‡t kÃª APIs khÃ´ng dÃ¹ng Ä‘Æ°á»£c trong SW
- [ ] Biáº¿t Service Worker thay tháº¿ AppCache
- [ ] Hiá»ƒu History API: window.history singleton
- [ ] DÃ¹ng pushState() thÃªm entry má»›i
- [ ] DÃ¹ng replaceState() cáº­p nháº­t entry hiá»‡n táº¡i
- [ ] Biáº¿t popstate fire khi back/forward, KHÃ”NG khi push/replace
- [ ] Hiá»ƒu event.state lÃ  copy of state
- [ ] Implement SPA pattern: replaceState + pushState + popstate
- [ ] Biáº¿t replaceState cho initial page state
- [ ] Hiá»ƒu history.go(n): relative navigation
- [ ] Biáº¿t scrollRestoration: auto vs manual
- [ ] Hiá»ƒu security constraints: same-origin URL
- [ ] Biáº¿t popstate edge cases: setTimeout workaround
- [ ] Hiá»ƒu fetch() promise-based, thay tháº¿ XHR
- [ ] Biáº¿t fetch() KHÃ”NG reject khi 404/500
- [ ] Liá»‡t kÃª body types cho fetch
- [ ] Hiá»ƒu body lÃ  stream: chá»‰ Ä‘á»c 1 láº§n, clone()
- [ ] PhÃ¢n biá»‡t mode: cors/same-origin/no-cors
- [ ] Hiá»ƒu credentials: omit/same-origin/include
- [ ] DÃ¹ng AbortController cancel request
- [ ] PhÃ¢n biá»‡t response type: basic/cors/opaque
- [ ] DÃ¹ng response body methods: json/text/blob
- [ ] Biáº¿t response.clone() cho multiple reads
- [ ] Streaming response.body vá»›i ReadableStream
- [ ] Hiá»ƒu Headers object sanitization
- [ ] DÃ¹ng URLSearchParams cho query strings
- [ ] Biáº¿t fetchLater() cho deferred beaconing
- [ ] Hiá»ƒu credentials include + cross-origin requirements
- [ ] Hiá»ƒu cookie: Set-Cookie â†’ Cookie header cycle
- [ ] Biáº¿t document.cookie lÃ  accessor, write chá»‰ update 1 cookie
- [ ] Encode cookie name/value báº±ng encodeURIComponent
- [ ] Biáº¿t limits: 4KB/cookie, ~20+/domain
- [ ] Hiá»ƒu path attribute: default current path
- [ ] Hiá»ƒu domain attribute: subdomains access
- [ ] PhÃ¢n biá»‡t expires vs max-age (precedence)
- [ ] Biáº¿t session cookie: khÃ´ng expires/max-age
- [ ] Hiá»ƒu secure: HTTPS only
- [ ] Hiá»ƒu httpOnly: JS khÃ´ng access, server set
- [ ] PhÃ¢n biá»‡t samesite: strict/lax/none
- [ ] Hiá»ƒu XSRF attack vÃ  samesite protection
- [ ] Biáº¿t third-party cookies: tracking, Safari block
- [ ] Hiá»ƒu IndexedDB: key-value DB, máº¡nh hÆ¡n localStorage
- [ ] DÃ¹ng indexedDB.open(name, version)
- [ ] Hiá»ƒu upgradeneeded: schema versioning
- [ ] Táº¡o object store vá»›i keyPath/autoIncrement
- [ ] PhÃ¢n biá»‡t transaction types: readonly/readwrite
- [ ] Hiá»ƒu autocommit: khÃ´ng fetch trong transaction
- [ ] PhÃ¢n biá»‡t add() vs put(): ConstraintError
- [ ] DÃ¹ng IDBKeyRange: bound/lowerBound/upperBound
- [ ] Táº¡o vÃ  dÃ¹ng indexes cho search by field
- [ ] DÃ¹ng cursors cho large datasets
- [ ] Hiá»ƒu event delegation: bubble requestâ†’txâ†’db
- [ ] Handle parallel update: versionchange + onblocked
- [ ] Biáº¿t error handling: preventDefault, stopPropagation
- [ ] DÃ¹ng promise wrapper (idb) vá»›i async/await
- [ ] Hiá»ƒu inactive transaction pitfall
- [ ] Hiá»ƒu object: unordered name-value pairs
- [ ] PhÃ¢n biá»‡t primitive (value) vs reference (pointer)
- [ ] Táº¡o object: literal, constructor, prototype patterns
- [ ] Hiá»ƒu property attributes: configurable/enumerable/writable
- [ ] DÃ¹ng dot notation vs bracket notation
- [ ] PhÃ¢n biá»‡t own vs inherited properties
- [ ] DÃ¹ng hasOwnProperty vs in operator
- [ ] Enumerate: for...in vs Object.keys()
- [ ] Hiá»ƒu delete operator (own only, luÃ´n true)
- [ ] Serialize: JSON.stringify/parse
- [ ] Hiá»ƒu prototype chain: instance â†’ F.prototype â†’ Object.prototype
- [ ] Biáº¿t Object.create() cho prototype
- [ ] Hiá»ƒu Object.defineProperty cho attributes
- [ ] Biáº¿t constructor pattern vs prototype pattern trade-offs
- [ ] Hiá»ƒu structuredClone() cho deep copy
- [ ] Hiá»ƒu 2 concepts: prototype property vs prototype attribute
- [ ] Biáº¿t F.prototype: attach methods cho inheritance
- [ ] Hiá»ƒu [[Prototype]] attribute trá» Ä‘áº¿n parent
- [ ] Biáº¿t constructor property vÃ  cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng
- [ ] Hiá»ƒu prototype attribute rules: literal vs new F() vs Object.create
- [ ] Implement prototype-based inheritance: Child.prototype = new Parent()
- [ ] Hiá»ƒu prototype chain: obj â†’ F.prototype â†’ Object.prototype â†’ null
- [ ] Biáº¿t property lookup mechanism theo chain
- [ ] Hiá»ƒu property shadowing: own ghi Ä‘Ã¨ inherited
- [ ] Biáº¿t Object.prototype methods: toString/valueOf/hasOwnProperty
- [ ] Hiá»ƒu táº¡i sao ghi Ä‘Ã¨ F.prototype = {} máº¥t constructor
- [ ] Biáº¿t built-in prototype chains: Array/String/Number
- [ ] Hiá»ƒu Object.create(null) táº¡o pure dictionary
- [ ] DÃ¹ng Object.getPrototypeOf() thay **proto**
- [ ] Hiá»ƒu ES6 class = syntactic sugar trÃªn prototype
- [ ] Hiá»ƒu variable scope: local vs global
- [ ] Biáº¿t var: function scope, KHÃ”NG block scope
- [ ] Biáº¿t let/const: block scope (ES6)
- [ ] Hiá»ƒu undeclared variable â†’ auto global trap
- [ ] Biáº¿t local variable Æ°u tiÃªn hÆ¡n global cÃ¹ng tÃªn
- [ ] Hiá»ƒu global vars gáº¯n vÃ o window object
- [ ] Biáº¿t setTimeout callback: this = window
- [ ] TrÃ¡nh pollute global: modules, IIFE, let/const
- [ ] Hiá»ƒu hoisting: chá»‰ declaration, KHÃ”NG assignment
- [ ] Biáº¿t function declaration override var declaration
- [ ] Biáº¿t var assignment override function declaration
- [ ] Hiá»ƒu function expression KHÃ”NG hoisted
- [ ] Biáº¿t let/const TDZ â†’ ReferenceError
- [ ] Hiá»ƒu for var i = global vs for let j = block
- [ ] DÃ¹ng strict mode ngÄƒn undeclared variables
- [ ] Hiá»ƒu closure = inner fn + outer scope access
- [ ] Biáº¿t 3 scope chains: own + outer + global
- [ ] Hiá»ƒu closure váº«n access sau outer fn return
- [ ] Biáº¿t closures store REFERENCES, khÃ´ng values
- [ ] Implement private variables pattern vá»›i closure
- [ ] Hiá»ƒu for loop closure bug (share cÃ¹ng i)
- [ ] Fix báº±ng IIFE: capture giÃ¡ trá»‹ má»—i iteration
- [ ] Fix báº±ng let: block scope má»—i iteration
- [ ] Hiá»ƒu scope chain theo creation site (lexical)
- [ ] Biáº¿t closure giá»¯ refs â†’ memory leak risk
- [ ] Hiá»ƒu callback thÆ°á»ng lÃ  closure
- [ ] Biáº¿t this trong closure: call-time, khÃ´ng inherit
- [ ] Fix this: arrow fn / bind / const self = this
- [ ] Implement module pattern dÃ¹ng IIFE + closure
- [ ] Hiá»ƒu closure interview patterns: loop/private/scope
- [ ] Hiá»ƒu functions lÃ  first-class objects
- [ ] Biáº¿t callback = fn truyá»n vÃ o fn khÃ¡c, gá»i sau
- [ ] Hiá»ƒu callbacks lÃ  closures (access outer scope)
- [ ] DÃ¹ng named vs anonymous callbacks
- [ ] Check typeof === 'function' trÆ°á»›c khi gá»i
- [ ] Hiá»ƒu this problem: method callback máº¥t context
- [ ] Fix vá»›i call/apply/bind truyá»n context
- [ ] Biáº¿t call vs apply vs bind sá»± khÃ¡c nhau
- [ ] Truyá»n multiple callbacks: success/error/complete
- [ ] Táº¡o versatile function vá»›i callback
- [ ] Hiá»ƒu Callback Hell (Pyramid of Doom)
- [ ] Fix: named fns, modules, Promises, async/await
- [ ] Biáº¿t error-first callback convention (Node.js)
- [ ] PhÃ¢n biá»‡t sync vs async callbacks
- [ ] Biáº¿t khi nÃ o dÃ¹ng callback vs Promise
- [ ] Hiá»ƒu this = INVOKING object, gÃ¡n táº¡i invocation
- [ ] Biáº¿t this trong global = window (strict: undefined)
- [ ] Hiá»ƒu biggest gotcha: this theo invocation, khÃ´ng definition
- [ ] Fix method as callback máº¥t context: .bind(obj)
- [ ] Fix this trong closure: var self = this hoáº·c arrow fn
- [ ] Fix method assign to variable: .bind(obj)
- [ ] Fix borrowing methods: .apply(targetObj)
- [ ] Hiá»ƒu context concept vÃ  cÃ¡ch change context
- [ ] Biáº¿t call vs apply vs bind cho this
- [ ] Hiá»ƒu arrow fn: lexical this, khÃ´ng cÃ³ this riÃªng
- [ ] Biáº¿t this trong event handler: DOM element
- [ ] Hiá»ƒu new keyword: this = instance má»›i
- [ ] Biáº¿t thá»© tá»± Æ°u tiÃªn: new > bind > obj.fn > default
- [ ] Fix this trong setTimeout: arrow fn / bind
- [ ] Debug this: console.log(this) + check caller
- [ ] Biáº¿t call(obj, a, b): gá»i ngay, args riÃªng láº»
- [ ] Biáº¿t apply(obj, [a,b]): gá»i ngay, args array
- [ ] Biáº¿t bind(obj): tráº£ fn má»›i, khÃ´ng gá»i ngay
- [ ] DÃ¹ng bind fix callback/event context
- [ ] DÃ¹ng bind cho currying/partial application
- [ ] Borrow Array methods trÃªn array-like (call)
- [ ] Convert arguments â†’ array: slice.call/Array.from
- [ ] DÃ¹ng apply cho variadic: Math.max.apply(null, arr)
- [ ] Biáº¿t null lÃ m first arg khi khÃ´ng dÃ¹ng this
- [ ] Hiá»ƒu borrowed method = reference, khÃ´ng copy
- [ ] DÃ¹ng apply set this trong callback
- [ ] Biáº¿t call vs apply: commas vs array
- [ ] Hiá»ƒu arrow fn thay bind (nhÆ°ng khÃ´ng curry)
- [ ] DÃ¹ng spread (...) thay apply (modern)
- [ ] DÃ¹ng Array.from thay slice.call (ES6+)
- [ ] Hiá»ƒu this substitution: non-strict â†’ object luÃ´n
- [ ] Biáº¿t strict mode: this = undefined / giá»¯ primitive
- [ ] Arrow fn: bind/call/apply bá»‹ ignored vá»›i this
- [ ] bind chá»‰ works má»™t láº§n (rebind ignored)
- [ ] Constructor return object overrides this
- [ ] DÃ¹ng thisArg trong forEach/map/filter
- [ ] Class: instance field this vs static field this
- [ ] Derived class: super() trÆ°á»›c khi dÃ¹ng this
- [ ] Getter/setter: this = object accessed on
- [ ] DOM handler: this = element (regular fn)
- [ ] Bound methods: memory cost (má»—i instance = copy)
- [ ] Module top-level: this = undefined
- [ ] Biáº¿t globalThis cross-platform
- [ ] this trong eval: direct vs indirect
- [ ] Thuá»™c context table: 12 trÆ°á»ng há»£p this
- [ ] Hiá»ƒu sync: step-by-step, blocking, chá» xong má»›i tiáº¿p
- [ ] Biáº¿t JS single-threaded: 1 thread = 1 viá»‡c
- [ ] Hiá»ƒu long-running sync = UI freeze
- [ ] Biáº¿t async: báº¯t Ä‘áº§u â†’ return ngay â†’ notify khi xong
- [ ] Hiá»ƒu event handlers lÃ  async programming
- [ ] Biáº¿t XMLHttpRequest async pattern (loadend event)
- [ ] Hiá»ƒu callbacks vÃ  callback hell (pyramid of doom)
- [ ] Biáº¿t error handling váº¥n Ä‘á» trong nested callbacks
- [ ] Hiá»ƒu Promises thay tháº¿ callbacks (modern)
- [ ] Biáº¿t fetch() lÃ  async, return Promise
- [ ] Hiá»ƒu setTimeout lÃ  async (macro-task queue)
- [ ] PhÃ¢n biá»‡t blocking vs non-blocking
- [ ] PhÃ¢n biá»‡t sync vs async function
- [ ] Biáº¿t common async APIs: fetch, getUserMedia
- [ ] Hiá»ƒu async programming concept tá»•ng quÃ¡t
- [ ] Hiá»ƒu memory life cycle: allocate â†’ use â†’ release
- [ ] Biáº¿t JS auto allocate: value init + function calls
- [ ] Hiá»ƒu reference-counting GC vÃ  circular ref problem
- [ ] Hiá»ƒu mark-and-sweep: root â†’ reachable, âœ… fixes circular
- [ ] Biáº¿t khÃ´ng thá»ƒ manually trigger GC trong JS
- [ ] Hiá»ƒu WeakMap: keys weakly held, only objects, not iterable
- [ ] Biáº¿t táº¡i sao WeakMap khÃ´ng iterable (GC invisible)
- [ ] Hiá»ƒu ephemerons trong WeakMap
- [ ] Biáº¿t WeakRef + deref() cho cache pattern
- [ ] Hiá»ƒu FinalizationRegistry: callback khi GC (no guarantee)
- [ ] Biáº¿t V8 flags: --max-old-space-size, --expose-gc
- [ ] Hiá»ƒu memory leak causes: globals, closures, listeners, DOM
- [ ] Biáº¿t WeakRef cache pattern: Map + WeakRef values
- [ ] Hiá»ƒu WeakMap vs WeakRef use cases
- [ ] DÃ¹ng try...finally cho deterministic cleanup
- [ ] Hiá»ƒu core architecture: problem-solving + measurable
- [ ] Biáº¿t Basic Layer: GitLab + Jenkins CI/CD + FE versioning
- [ ] Hiá»ƒu branch lock + multi-version coexist + rollback
- [ ] Biáº¿t Node BFF: SSR + backend service access
- [ ] Hiá»ƒu analytics/tracking: PV/UV + feature + errors
- [ ] Biáº¿t canary release: 1% â†’ 5% â†’ 50% â†’ 100%
- [ ] Hiá»ƒu FE-BE separation: backend own HTML
- [ ] Biáº¿t mock trong scaffold: ?debug=true pattern
- [ ] Hiá»ƒu multi-page > SPA cho large projects
- [ ] Biáº¿t split by application/domain
- [ ] Hiá»ƒu component library prerequisites
- [ ] Biáº¿t SSO: login 1 láº§n access táº¥t cáº£
- [ ] Hiá»ƒu CDN + load balancing benefits
- [ ] Biáº¿t shared APIs: PC + H5 cÃ¹ng interface
- [ ] Hiá»ƒu monitoring alarm scenarios
- [ ] Hiá»ƒu Monorepo evolution: Monolith â†’ MultiRepo â†’ MonoRepo
- [ ] Biáº¿t MultiRepo vs MonoRepo pros/cons
- [ ] Hiá»ƒu ghost dependencies vÃ  cÃ¡ch pnpm fix
- [ ] Biáº¿t pnpm: CAS, hard links, virtual store
- [ ] Hiá»ƒu Lerna: fixed vs independent mode
- [ ] Biáº¿t Lerna commands: init, bootstrap, publish
- [ ] Hiá»ƒu Turborepo: parallel + local/remote cache
- [ ] Biáº¿t Nx: incremental + distributed build
- [ ] Hiá»ƒu Rush: common/temp + parallel + plugins
- [ ] Biáº¿t yarn workspace + Lerna combination
- [ ] Hiá»ƒu incremental build vs full build
- [ ] Biáº¿t khi nÃ o cáº©n tháº­n vá»›i Monorepo
- [ ] Hiá»ƒu pnpm vs npm/yarn install mechanism
- [ ] Biáº¿t progressive Monorepo strategy
- [ ] Hiá»ƒu tool comparison: Turbo/Rush/Nx/Lerna/pnpm
- [ ] Hiá»ƒu FE infrastructure: 4 táº§ng (Business/Engineering/FE/BE)
- [ ] Biáº¿t táº¡i sao cáº§n FE infra: reuse + efficiency + standardize
- [ ] Hiá»ƒu cÃ¡ch promote: people â†’ problems â†’ solutions â†’ execute
- [ ] Biáº¿t 4 key traits: tech sound + stable + efficient + UX
- [ ] Hiá»ƒu FE Standards: coding/git/review conventions
- [ ] Biáº¿t FE Documentation: onboarding/business/API/arch docs
- [ ] Hiá»ƒu CLI Scaffold: maximize resource utilization
- [ ] Biáº¿t khi nÃ o build component library riÃªng
- [ ] Hiá»ƒu Responsive vs Adaptive: chá»n theo layout diff
- [ ] Biáº¿t Utils library vs Tool automation difference
- [ ] Hiá»ƒu BFF: aggregate microservices â†’ unified API
- [ ] Biáº¿t SSR: báº¯t buá»™c cho ToC + SEO
- [ ] Hiá»ƒu Monitoring: 4 loáº¡i data (behavior/quality/env/ops)
- [ ] Biáº¿t Low-Code: phÃ¹ há»£p B2B high volume
- [ ] Hiá»ƒu Micro-Frontend: split â†’ independent apps + parallel dev

---

## 102. VÆ°á»£t Qua NÃºt Tháº¯t Ká»¹ Thuáº­t (Technical Bottlenecks) â€” DÃ nh Cho P6 Trá»Ÿ Xuá»‘ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VÆ¯á»¢T QUA NÃšT THáº®T Ká»¸ THUáº¬T â€” HOW TO BREAKTHROUGH              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Äá»‘i tÆ°á»£ng: P6 trá»Ÿ xuá»‘ng (Junior â†’ Mid-level)                  â”‚
â”‚  Má»¥c tiÃªu: NÃ¢ng cao nÄƒng lá»±c Ä‘á»ƒ Äá»ŒC SOURCE CODE má»™t cÃ¡ch       â”‚
â”‚            thoáº£i mÃ¡i, khÃ´ng cáº§n debug                            â”‚
â”‚                                                                 â”‚
â”‚  Hiá»‡n tÆ°á»£ng: 1 nÄƒm trÆ°á»›c Ä‘á»c source code Cáº¢M THáº¤Y KHÃ“         â”‚
â”‚  â†’ BÃ¢y giá» Ä‘á»c source code KHÃ”NG CÃ’N KHÃ“ ná»¯a                  â”‚
â”‚  â†’ VÃ¬ Ä‘Ã£ tráº£i qua QUÃ TRÃŒNH tÃ­ch lÅ©y                           â”‚
â”‚                                                                 â”‚
â”‚  âš ï¸ LÆ¯U Ã CHO NEWCOMERS:                                       â”‚
â”‚  Náº¿u Má»šI vÃ o ngÃ nh â†’ Äá»ªNG lo láº¯ng!                             â”‚
â”‚  Nhiá»‡m vá»¥ chÃ­nh = hoÃ n thÃ nh business logic                    â”‚
â”‚  Giai Ä‘oáº¡n nÃ y improvement Tá»ª BUSINESS lÃ  Lá»šN NHáº¤T             â”‚
â”‚  BÃ i viáº¿t nÃ y cho ngÆ°á»i muá»‘n BREAKTHROUGH sau khi Ä‘Ã£ quen API  â”‚
â”‚                                                                 â”‚
â”‚  Thá»±c táº¿: ~90% dev KHÃ”NG muá»‘n breakthrough                     â”‚
â”‚  â†’ KhÃ´ng breakthrough cÅ©ng KHÃ”NG SAO                            â”‚
â”‚  â†’ Háº§u háº¿t má»i ngÆ°á»i coi Ä‘Ã¢y lÃ  CÃ”NG VIá»†C BÃŒNH THÆ¯á»œNG          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3 BÆ°á»›c Breakthrough Strategy

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Káº¾T LUáº¬N (Äáº¶T TRÆ¯á»šC Äá»‚ NHá»š):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BÆ¯á»šC 1 â†’ BÆ¯á»šC 2 â†’ BÆ¯á»šC 3

BÆ¯á»šC 1: Äá»ŒC BÃ€I + XEM VIDEO NGÆ¯á»œI KHÃC
  â”‚  Äá»ªNG tá»± Ä‘á»c source code ngay!
  â”‚  â†’ Äá»c articles + xem videos Cá»¦A NGÆ¯á»œI KHÃC trÆ°á»›c
  â”‚  â†’ Má»¥c tiÃªu: tiáº¿p xÃºc code TRÃŠN TRÃŒNH Äá»˜ hiá»‡n táº¡i
  â”‚  â†’ Pave the way cho viá»‡c vÆ°á»£t qua giá»›i háº¡n
  â”‚
  â–¼
BÆ¯á»šC 2: TÃCH LÅ¨Y PROBLEM-SOLVING STRATEGIES
  â”‚  ChÃº Ã½ tÃ­ch lÅ©y cÃ¡ch giáº£i quyáº¿t váº¥n Ä‘á» hÃ ng ngÃ y
  â”‚  â†’ KHÃ”NG CHá»ˆ viáº¿t ra â€” pháº£i HIá»‚U NGUYÃŠN LÃ
  â”‚  â†’ CÃ¡i khÃ´ng hiá»ƒu Sáº¼ QUÃŠN
  â”‚  â†’ TÃ­ch lÅ©y NÄ‚NG Lá»°C, khÃ´ng pháº£i kiáº¿n thá»©c bá» máº·t
  â”‚  â†’ â­ PHáº¢I hiá»ƒu Publish-Subscribe pattern!
  â”‚     (ká»¹ thuáº­t phá»• biáº¿n trong nhiá»u libraries)
  â”‚
  â–¼
BÆ¯á»šC 3: Tá»° Äá»ŒC SOURCE CODE NHá»
  â†’ Báº¯t Ä‘áº§u vá»›i repos CODE NHá»
  â†’ Component libraries: Tencent / Alibaba / ByteDance
  â†’ Háº§u háº¿t components trong Ä‘Ã¢y TÆ¯Æ NG Äá»I ÄÆ N GIáº¢N
  â†’ ÄÃ¢y lÃ  bÆ°á»›c cuá»‘i cÃ¹ng, KHÃ”NG PHáº¢I bÆ°á»›c Ä‘áº§u!
```

### BÆ°á»›c 1: NÆ¡i Äá»ƒ Há»c Videos + Articles

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“º VIDEO â€” FASTEST WAY TO IMPROVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Táº¡i sao video NHANH NHáº¤T?
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Instructor GÃ•CODE trÆ°á»›c máº·t báº¡n             â”‚
â”‚  âœ… CÃ³ THá»œI GIAN SUY NGHÄ¨ theo                  â”‚
â”‚  âœ… Giáº£i thÃ­ch CHI TIáº¾T NHáº¤T                     â”‚
â”‚  âœ… PhÃ¹ há»£p BEGINNER muá»‘n reinvent the wheel    â”‚
â”‚  âœ… KhÃ´ng cÃ³ phÆ°Æ¡ng phÃ¡p nÃ o NHANH Báº°NG          â”‚
â”‚                                                   â”‚
â”‚  âš ï¸ KhÃ´ng hiá»ƒu cÅ©ng KHÃ”NG SAO!                   â”‚
â”‚  â†’ Hiá»ƒu Ä‘Æ°á»£c bao nhiÃªu thÃ¬ hiá»ƒu báº¥y nhiÃªu      â”‚
â”‚  â†’ KHÃ”NG AI hiá»ƒu háº¿t ngay láº§n Ä‘áº§u               â”‚
â”‚  â†’ Trá»« khi báº¡n lÃ  THIÃŠN TÃ€I                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Há»c táº­p lÃ  QUÃ TRÃŒNH XOáº®N á»C (Spiral Learning):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                   â”‚
â”‚  Láº§n 1: hiá»ƒu 20%  â”€â”€â”€â”€â–º                         â”‚
â”‚  Láº§n 2: hiá»ƒu 40%  â”€â”€â”€â”€â”€â”€â”€â”€â–º                     â”‚
â”‚  Láº§n 3: hiá»ƒu 60%  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                 â”‚
â”‚  Láº§n 4: hiá»ƒu 80%  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º             â”‚
â”‚  Láº§n 5: hiá»ƒu 95%  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º         â”‚
â”‚                                                   â”‚
â”‚  KHÃ”NG PHáº¢I: 0% â†’ 100% Ä‘á»™t nhiÃªn               â”‚
â”‚  MÃ€ LÃ€: tá»«ng chÃºt má»™t, má»—i láº§n tá»‘t hÆ¡n        â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Nguá»“n video:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  #1: Bilibili (Bç«™)          â”‚  â† FREE, Ä‘á»§ loáº¡i
â”‚  â€¢ Linux tutorials           â”‚
â”‚  â€¢ React Hooks source code   â”‚
â”‚  â€¢ Webpack internals         â”‚
â”‚  â€¢ Framework source code     â”‚
â”‚                               â”‚
â”‚  #2: Forums / Communities    â”‚  â† Training videos
â”‚  â€¢ Google search             â”‚
â”‚  â€¢ Baidu (search materials)  â”‚
â”‚  â€¢ TÃ¬m training courses free â”‚
â”‚                               â”‚
â”‚  â­ Google > Baidu cho search â”‚
â”‚  "Äá»«ng tiáº¿c tiá»n" cho tools  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ARTICLES â€” CHáº¤T LÆ¯á»¢NG > Sá» LÆ¯á»¢NG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

QUAN TRá»ŒNG:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Má»—i ngÆ°á»i á»Ÿ GIAI ÄOáº N KHÃC NHAU               â”‚
â”‚  Äá»ªNG mÃ¹ quÃ¡ng Ä‘uá»•i theo "expert articles"      â”‚
â”‚                                                   â”‚
â”‚  VÃ­ dá»¥: Beginner Ä‘á»c bÃ i chuyÃªn sÃ¢u            â”‚
â”‚  â†’ KHÃ”NG HIá»‚U â†’ lÃ£ng phÃ­ thá»i gian             â”‚
â”‚  â†’ Kiáº¿n thá»©c khÃ´ng hiá»ƒu = CHÆ¯A Há»ŒC              â”‚
â”‚  â†’ VÃ i ngÃ y sau Sáº¼ QUÃŠN háº¿t                     â”‚
â”‚                                                   â”‚
â”‚  CÃCH CHá»ŒN ÄÃšNG:                                 â”‚
â”‚  â€¢ Chá»n 1-2 nguá»“n phÃ¹ há»£p TRÃŒNH Äá»˜ hiá»‡n táº¡i    â”‚
â”‚  â€¢ Juejin (æ˜é‡‘), Zhihu (çŸ¥ä¹), FE public accts â”‚
â”‚  â€¢ Äá»c ká»¹ + hiá»ƒu tháº­t sá»±                        â”‚
â”‚  â€¢ KiÃªn trÃ¬ 1 NÄ‚M â†’ sáº½ tháº¥y khÃ¡c biá»‡t!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“š SÃCH â€” Bá»” SUNG KIáº¾N THá»¨C Ná»€N Táº¢NG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SÃ¡ch nÃªn Ä‘á»c:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“• Mainstream FE books (Red Book, Definitive   â”‚
â”‚     Guide...) â†’ Ä‘á»c nhiá»u láº§n                   â”‚
â”‚                                                   â”‚
â”‚  â­ HIGHLY RECOMMENDED:                           â”‚
â”‚  ã€ŠJavaScript Design Patterns and               â”‚
â”‚    Development Practicesã€‹ â€” Turingå‡ºç‰ˆ           â”‚
â”‚  (TÃ¡c giáº£: Senior developer táº¡i Tencent)        â”‚
â”‚                                                   â”‚
â”‚  LÃ½ do:                                          â”‚
â”‚  â€¢ Kiáº¿n thá»©c Ráº¤T THá»°C Táº¾ (dry knowledge)        â”‚
â”‚  â€¢ Ráº¥t nhiá»u ká»¹ thuáº­t (techniques)               â”‚
â”‚  â€¢ CÃ¢u há»i Má», thÃº vá»‹ hÆ¡n cÃ¢u há»i cÃ´ng thá»©c    â”‚
â”‚                                                   â”‚
â”‚  VÃ­ dá»¥ cÃ¢u há»i trong sÃ¡ch:                       â”‚
â”‚  "Äá»“ng nghiá»‡p viáº¿t 1 function, báº¡n KHÃ”NG MUá»N   â”‚
â”‚   phÃ¡ function Ä‘Ã³, cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ EXTEND nÃ³?"    â”‚
â”‚                                                   â”‚
â”‚  â†’ AOP (Aspect-Oriented Programming)             â”‚
â”‚  â†’ Before / After wrapper functions              â”‚
â”‚  â†’ Chain of Responsibility pattern               â”‚
â”‚  â†’ Compose function                              â”‚
â”‚  â†’ Decorator pattern                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Compose Function â€” Ká»¹ Thuáº­t Quan Trá»ng

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPOSE FUNCTION LÃ€ GÃŒ?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BÃ i toÃ¡n: Bá» CON VOI VÃ€O Tá»¦ Láº NH
â†’ Cáº§n: 1. Má»Ÿ tá»§ láº¡nh  2. Bá» voi vÃ o  3. ÄÃ³ng tá»§ láº¡nh

CÃ¡ch thÆ°á»ng lÃ m (táº¥t cáº£ trong 1 function):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  function è£…å¤§è±¡() {                              â”‚
â”‚    // æ‰“å¼€å†°ç®± â€” Má»Ÿ tá»§ láº¡nh                     â”‚
â”‚    // è£…å¤§è±¡   â€” Bá» voi vÃ o                      â”‚
â”‚    // å…³é—­å†°ç®±é—¨ â€” ÄÃ³ng tá»§ láº¡nh                  â”‚
â”‚  }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CÃ¡ch Compose (TÃCH + TRá»ªU TÆ¯á»¢NG HÃ“A):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  // TÃ¡ch thÃ nh cÃ¡c functions nhá», Ä‘á»™c láº­p       â”‚
â”‚  function è£…ä¸œè¥¿() {}   // Bá» Ä‘á»“ vÃ o (abstract) â”‚
â”‚  function æ‰“å¼€å†°ç®±() {} // Má»Ÿ tá»§ láº¡nh            â”‚
â”‚  function å…³é—­å†°ç®±() {} // ÄÃ³ng tá»§ láº¡nh          â”‚
â”‚                                                   â”‚
â”‚  // Compose gá»™p 3 functions â†’ 1 pipeline        â”‚
â”‚  compose(æ‰“å¼€å†°ç®±, è£…ä¸œè¥¿, å…³é—­å†°ç®±)              â”‚
â”‚                                                   â”‚
â”‚  // Truyá»n tham sá»‘ = hoÃ n thÃ nh!                 â”‚
â”‚  compose(æ‰“å¼€å†°ç®±, è£…ä¸œè¥¿, å…³é—­å†°ç®±)(å¤§è±¡)        â”‚
â”‚  //                                  â†‘ elephant  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

á»¨NG Dá»¤NG THá»°C Táº¾:

1. Koa Middleware (Async Compose):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  app.use(logger)    // middleware 1              â”‚
â”‚  app.use(auth)      // middleware 2              â”‚
â”‚  app.use(handler)   // middleware 3              â”‚
â”‚                                                   â”‚
â”‚  Request â†’ logger â†’ auth â†’ handler â†’ Response   â”‚
â”‚  NguyÃªn lÃ½: compose(logger, auth, handler)      â”‚
â”‚                                                   â”‚
â”‚  â†’ Hiá»ƒu Koa source code = táº¡o Ä‘Æ°á»£c automated    â”‚
â”‚    deployment script DÃ™NG CÃC NGUYÃŠN LÃ NÃ€Y    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Redux Middleware (Sync Compose):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  applyMiddleware(thunk, logger, crashReporter)   â”‚
â”‚                                                   â”‚
â”‚  Action â†’ thunk â†’ logger â†’ crashReporter â†’ store â”‚
â”‚  CÃ¹ng nguyÃªn lÃ½ compose, nhÆ°ng Äá»’NG Bá»˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Koa = Async Compose
Redux = Sync Compose
â†’ CÃ™NG 1 PATTERN, khÃ¡c implementation!
```

### XÃ¢y Dá»±ng HÆ°á»›ng PhÃ¡t Triá»ƒn Sá»± Nghiá»‡p

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Váº¤N Äá»€ THá»°C Táº¾: SAU 35 TUá»”I LÃ€M GÃŒ?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Thá»±c táº¿: Náº¿u khÃ´ng Ä‘áº¡t Alibaba P7 level                       â”‚
â”‚  â†’ Sáº½ KHÃ“ tÃ¬m viá»‡c á»Ÿ cÃ´ng ty vá»«a/nhá» sau 35                   â”‚
â”‚                                                                  â”‚
â”‚  VÃ¬ váº­y: Äá»c source code / há»c framework                        â”‚
â”‚  â†’ Táº¤T Cáº¢ vÃ¬ má»¥c Ä‘Ã­ch NÃ‚NG CAO NÄ‚NG Lá»°C                       â”‚
â”‚  â†’ KÃ‰O DÃ€I tuá»•i thá» nghá» nghiá»‡p                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CHIáº¾N LÆ¯á»¢C: Táº¬P TRUNG, Äá»ªNG LAN MAN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FE cÃ³ NHIá»€U hÆ°á»›ng:                              â”‚
â”‚  â€¢ Mini-games                                    â”‚
â”‚  â€¢ Data visualization (D3, ECharts)              â”‚
â”‚  â€¢ B2B backend systems                           â”‚
â”‚  â€¢ Audio/Video                                   â”‚
â”‚  â€¢ ...                                            â”‚
â”‚                                                   â”‚
â”‚  âŒ Äá»ªNG: khÃ¡m phÃ¡ lung tung NHIá»€U hÆ°á»›ng        â”‚
â”‚  âœ… HÃƒY: chá»n 1 hÆ°á»›ng â†’ Ä‘i SÃ‚U                 â”‚
â”‚                                                   â”‚
â”‚  VÃ­ dá»¥ tÃ¡c giáº£ (B2B sector):                    â”‚
â”‚  â”œâ”€ âœ… Component libraries â†’ CHUYÃŠN SÃ‚U         â”‚
â”‚  â”œâ”€ âœ… Node.js small tools â†’ Báº®T BUá»˜C           â”‚
â”‚  â”œâ”€ âœ… Low-code platforms â†’ Má»¤C TIÃŠU DÃ€I Háº N   â”‚
â”‚  â”œâ”€ âŒ Deno â†’ KHÃ”NG QUAN TÃ‚M                    â”‚
â”‚  â””â”€ âš ï¸ Canvas/AI annotation â†’ Há»ŒC KHI Cáº¦N      â”‚
â”‚        (má»Ÿ rá»™ng kiáº¿n thá»©c nhÆ°ng KHÃ”NG pháº£i focus)â”‚
â”‚                                                   â”‚
â”‚  Roadmap:                                        â”‚
â”‚  Component Library â†’ Support Low-Code            â”‚
â”‚  â†’ Low-Code platform (like Appsmith)             â”‚
â”‚  â†’ Communication giá»¯a components                 â”‚
â”‚  â†’ Apply cho NHIá»€U vertical industries           â”‚
â”‚     (website building, WeChat editors...)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ThoÃ¡t Khá»i Comfort Zone

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Táº I SAO PHáº¢I THOÃT COMFORT ZONE?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Má»‘i liÃªn há»‡: Comfort Zone â†” Äá»c Source Code

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Project phá»©c táº¡p â†’ Third-party libs KHÃ”NG Ä‘Ã¡p á»©ng             â”‚
â”‚  VÃ­ dá»¥: Large SaaS project â†’ Ant Design KHÃ”NG Äá»¦              â”‚
â”‚                                                                  â”‚
â”‚  Náº¿u KHÃ”NG Ä‘á»c source code Ä‘á»§ nhiá»u:                            â”‚
â”‚  â†’ Business gáº¥p â†’ Code CHáº¤T LÆ¯á»¢NG KÃ‰M                          â”‚
â”‚  â†’ KhÃ´ng cÃ³ thá»i gian Tá»° Há»ŒC                                   â”‚
â”‚  â†’ Muá»‘n lÃ m software DÃ€I Háº N mÃ  KHÃ”NG GROW                    â”‚
â”‚     = Ráº¤T NGUY HIá»‚M                                             â”‚
â”‚     (trá»« khi báº¡n giÃ u rá»“i ğŸ˜„)                                  â”‚
â”‚                                                                  â”‚
â”‚  DÃ¹ tháº¿ nÃ o, CÃ“ SKILL luÃ´n lÃ  Ä‘iá»u Tá»T                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GROWTH CYCLE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                        â”‚
â”‚  Comfort Zone   â†’ KhÃ³ khÄƒn tÄƒng       â”‚
â”‚       â†‘              â†“                 â”‚
â”‚       â”‚         Buá»™c pháº£i improve      â”‚
â”‚       â”‚              â†“                 â”‚
â”‚  Consolidate    â† Skills tÄƒng         â”‚
â”‚  (Ä‘á»•i viá»‡c =        â†“                 â”‚
â”‚   thá»i Ä‘iá»ƒm     Tá»± tin hÆ¡n            â”‚
â”‚   cá»§ng cá»‘)           â†“                 â”‚
â”‚                  "TÃ´i cÃ³ thá»ƒ lead      â”‚
â”‚                   team tá»« Ä‘áº§u          â”‚
â”‚                   vÃ  xá»­ lÃ½ tasks       â”‚
â”‚                   khÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng"     â”‚
â”‚                       â†“                â”‚
â”‚                  CONGRATULATIONS!      â”‚
â”‚                  â†’ Apply P7 level      â”‚
â”‚                  (khÃ´ng Ä‘á»ƒ Ä‘á»•i viá»‡c    â”‚
â”‚                   mÃ  Ä‘á»ƒ TEST báº£n thÃ¢n) â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Lá»œI KHUYÃŠN:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘  Äá»ªNG á»Ÿ comfort zone QUÃ LÃ‚U                 â”‚
â”‚  â‘¡ Chá»n cÃ´ng ty cÃ³ TASKS KHÃ“                    â”‚
â”‚  â‘¢ Äá»•i viá»‡c = consolidate kiáº¿n thá»©c              â”‚
â”‚  â‘£ Apply P7 Ä‘á»ƒ TEST, khÃ´ng pháº£i Ä‘á»ƒ Ä‘á»•i viá»‡c      â”‚
â”‚  â‘¤ ThÃ­ch THá»ˆNH THOáº¢NG apply â†’ xem mÃ¬nh tá»›i Ä‘Ã¢u â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tá»•ng Há»£p: VÆ°á»£t Qua NÃºt Tháº¯t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TECHNICAL BOTTLENECK BREAKTHROUGH â€” SUMMARY                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  3 BÆ¯á»šC:                                                        â”‚
â”‚  â‘  Xem video + Ä‘á»c bÃ i â†’ tiáº¿p xÃºc code TRÃŠN trÃ¬nh Ä‘á»™          â”‚
â”‚  â‘¡ TÃ­ch lÅ©y problem-solving + hiá»ƒu NGUYÃŠN LÃ                   â”‚
â”‚  â‘¢ Tá»± Ä‘á»c source code NHá» (component libraries)                â”‚
â”‚                                                                  â”‚
â”‚  RESOURCES:                                                      â”‚
â”‚  â€¢ Video: Bilibili, forums (nhanh nháº¥t)                         â”‚
â”‚  â€¢ Articles: Juejin, Zhihu (cháº¥t > lÆ°á»£ng)                       â”‚
â”‚  â€¢ SÃ¡ch: JS Design Patterns (must-read)                         â”‚
â”‚                                                                  â”‚
â”‚  KEY PATTERNS:                                                   â”‚
â”‚  â€¢ Compose function (Koa async / Redux sync)                    â”‚
â”‚  â€¢ Publish-Subscribe pattern (libraries phá»• biáº¿n)               â”‚
â”‚  â€¢ Decorator, Chain of Responsibility, AOP                      â”‚
â”‚                                                                  â”‚
â”‚  CAREER:                                                         â”‚
â”‚  â€¢ Chá»n 1 hÆ°á»›ng â†’ Ä‘i SÃ‚U                                       â”‚
â”‚  â€¢ ThoÃ¡t comfort zone â†’ tasks KHÃ“ hÆ¡n                           â”‚
â”‚  â€¢ Má»¤C TIÃŠU: P7 level skills â†’ kÃ©o dÃ i sá»± nghiá»‡p              â”‚
â”‚                                                                  â”‚
â”‚  SPIRAL LEARNING:                                                â”‚
â”‚  â€¢ KhÃ´ng ai hiá»ƒu háº¿t ngay láº§n Ä‘áº§u                               â”‚
â”‚  â€¢ Má»—i láº§n há»c â†’ hiá»ƒu thÃªm má»™t chÃºt                            â”‚
â”‚  â€¢ KiÃªn trÃ¬ 1 nÄƒm â†’ tháº¥y khÃ¡c biá»‡t                             â”‚
â”‚                                                                  â”‚
â”‚  ~90% dev khÃ´ng muá»‘n breakthrough â†’ KHÃ”NG SAO                   â”‚
â”‚  NhÆ°ng náº¿u Báº N MUá»N â†’ follow 3 bÆ°á»›c trÃªn!                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Quick Reference

```
BREAKTHROUGH STRATEGY:
  BÆ°á»›c 1 â†’ Video + Articles (tiáº¿p xÃºc code cao hÆ¡n trÃ¬nh Ä‘á»™)
  BÆ°á»›c 2 â†’ TÃ­ch lÅ©y problem-solving (hiá»ƒu nguyÃªn lÃ½)
  BÆ°á»›c 3 â†’ Tá»± Ä‘á»c source code nhá» (component libs)

KEY PATTERNS TO MASTER:
  Compose     â†’ Koa (async) / Redux (sync) middleware
  Pub-Sub     â†’ EventEmitter, custom events, libraries
  Decorator   â†’ Extend function mÃ  KHÃ”NG phÃ¡ function gá»‘c
  AOP         â†’ Before / After hooks
  CoR         â†’ Chain of Responsibility

CAREER DIRECTION:
  âœ… Chá»n 1 hÆ°á»›ng â†’ Ä‘i sÃ¢u (B2B, D3, Audio/Video...)
  âœ… Component library â†’ Low-code â†’ vertical industries
  âŒ Äá»«ng lan man nhiá»u hÆ°á»›ng cÃ¹ng lÃºc
  âš ï¸ Sau 35 tuá»•i: cáº§n P7 level skills

LEARNING RESOURCES:
  Videos    â†’ Bilibili (free), Forums (training courses)
  Articles  â†’ Juejin, Zhihu, FE public accounts
  Books     â†’ JS Design Patterns (Turing) â† MUST READ
  Search    â†’ Google > Baidu (for learning materials)

SPIRAL LEARNING:
  Láº§n 1 â†’ 20% hiá»ƒu
  Láº§n 2 â†’ 40% hiá»ƒu
  Láº§n N â†’ 95% hiá»ƒu
  â†’ Äá»ªNG Vá»˜I, kiÃªn trÃ¬ 1 nÄƒm!
```

### CÃ¢u Há»i Phá»ng Váº¥n: Technical Growth

```
Q1: LÃ m tháº¿ nÃ o Ä‘á»ƒ vÆ°á»£t qua nÃºt tháº¯t ká»¹ thuáº­t?
A: 3 bÆ°á»›c: (1) Xem video/Ä‘á»c bÃ i ngÆ°á»i khÃ¡c â†’ tiáº¿p xÃºc code
   cao hÆ¡n trÃ¬nh Ä‘á»™. (2) TÃ­ch lÅ©y problem-solving strategies,
   hiá»ƒu NGUYÃŠN LÃ chá»© khÃ´ng chá»‰ cÃº phÃ¡p. (3) Tá»± Ä‘á»c source
   code nhá» (component libraries Tencent/Alibaba/ByteDance).

Q2: Compose function lÃ  gÃ¬? á»¨ng dá»¥ng trong thá»±c táº¿?
A: Compose gá»™p nhiá»u functions nhá» â†’ 1 pipeline.
   VÃ­ dá»¥: compose(f, g, h)(x) = f(g(h(x)))
   Koa middleware = async compose.
   Redux middleware = sync compose.
   CÃ¹ng pattern, khÃ¡c implementation.

Q3: Táº¡i sao pháº£i hiá»ƒu design patterns?
A: VÃ¬ nhiá»u libraries/frameworks Dá»°A TRÃŠN design patterns.
   Pub-Sub: EventEmitter, Vue reactivity, Redux store.
   Decorator: extend function mÃ  khÃ´ng phÃ¡ function gá»‘c.
   Compose: middleware pattern (Koa, Redux, Express).
   AOP: Before/After hooks, logging, auth checks.

Q4: Chá»n hÆ°á»›ng phÃ¡t triá»ƒn nhÆ° tháº¿ nÃ o?
A: Chá»n 1 domain (B2B, visualization, audio/video...) â†’ Ä‘i sÃ¢u.
   Äá»«ng lan man. VÃ­ dá»¥: Component Library â†’ Low-Code â†’ Vertical.
   Má»—i kiáº¿n thá»©c phá»¥c vá»¥ Má»¤C TIÃŠU DÃ€I Háº N, khÃ´ng random.

Q5: Khi nÃ o nÃªn Ä‘á»c source code?
A: KHÃ”NG PHáº¢I ngay tá»« Ä‘áº§u. TrÆ°á»›c tiÃªn xem video/Ä‘á»c bÃ i â†’
   hiá»ƒu concept. Sau Ä‘Ã³ tÃ­ch lÅ©y qua thá»±c táº¿. CUá»I CÃ™NG
   má»›i tá»± Ä‘á»c source code, báº¯t Ä‘áº§u tá»« repos NHá».
   Spiral learning: má»—i láº§n hiá»ƒu thÃªm má»™t chÃºt.

Q6: Comfort zone vÃ  career growth liÃªn quan tháº¿ nÃ o?
A: Projects KHÃ“ â†’ buá»™c pháº£i improve â†’ skills tÄƒng.
   Third-party libs khÃ´ng Ä‘á»§ â†’ pháº£i Ä‘á»c source code.
   Äá»•i viá»‡c = consolidate kiáº¿n thá»©c.
   Má»¥c tiÃªu: "TÃ´i cÃ³ thá»ƒ lead team tá»« Ä‘áº§u" = P7 ready.
```

---

### Learning Checklist

- [ ] Hiá»ƒu cáº¥u trÃºc message (requests/responses)
- [ ] Biáº¿t táº¥t cáº£ methods phá»• biáº¿n vÃ  thuá»™c tÃ­nh
- [ ] Thuá»™c status codes quan trá»ng
- [ ] ThÃ nh tháº¡o caching headers
- [ ] Hiá»ƒu luá»“ng CORS
- [ ] So sÃ¡nh HTTP/1.1 vs HTTP/2 vs HTTP/3
- [ ] Biáº¿t cookie vs token trade-offs
- [ ] Hiá»ƒu security headers
- [ ] Thá»±c hÃ nh retry strategies
- [ ] Biáº¿t Core Web Vitals
- [ ] Hiá»ƒu FE infrastructure 16 components
- [ ] Biáº¿t Monorepo evolution + tools
- [ ] Hiá»ƒu 3 bÆ°á»›c breakthrough: video â†’ tÃ­ch lÅ©y â†’ tá»± Ä‘á»c source
- [ ] Biáº¿t compose function (Koa async / Redux sync)
- [ ] Hiá»ƒu táº¡i sao design patterns quan trá»ng (Pub-Sub, Decorator, AOP)
- [ ] Biáº¿t spiral learning: má»—i láº§n hiá»ƒu thÃªm má»™t chÃºt
- [ ] XÃ¢y dá»±ng career direction: chá»n 1 hÆ°á»›ng â†’ Ä‘i sÃ¢u
- [ ] Hiá»ƒu comfort zone â†’ growth cycle â†’ P7 test
- [ ] Äá»c JS Design Patterns and Development Practices
- [ ] TÃ­ch lÅ©y problem-solving strategies hÃ ng ngÃ y

---

_Cáº­p nháº­t láº§n cuá»‘i: ThÃ¡ng 2, 2026_
