# React Compiler â€” Deep Dive!

> **Chá»§ Ä‘á»**: React Compiler, Auto Memoization, Build-time Optimization
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!

---

## Má»¥c Lá»¥c

1. [Â§1. React Compiler LÃ  GÃ¬?](#1)
2. [Â§2. Váº¥n Äá» Re-render & Manual Memoization!](#2)
3. [Â§3. Auto Memoization â€” Compiler LÃ m GÃ¬?](#3)
4. [Â§4. Rules of React â€” Compiler Giáº£ Äá»‹nh GÃ¬?](#4)
5. [Â§5. Single-File Analysis & Compiler Scope!](#5)
6. [Â§6. Effect Memoization â€” Open Research!](#6)
7. [Â§7. Tá»± Viáº¿t â€” Simple React Memoizer!](#7)
8. [Â§8. Tá»± Viáº¿t â€” Simple Compiler Analyzer!](#8)
9. [Â§9. Tá»± Viáº¿t â€” Simple Fine-Grained Reactivity!](#9)
10. [Â§10. Migration & Best Practices!](#10)
11. [Â§11. Tá»•ng Káº¿t & CÃ¢u Há»i Phá»ng Váº¥n!](#11)

---

## Â§1. React Compiler LÃ  GÃ¬?

```
  REACT COMPILER â€” Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React Compiler = BUILD-TIME TOOL                      â”‚
  â”‚  â†’ Tá»± Ä‘á»™ng optimize React app!                        â”‚
  â”‚  â†’ Focus: cáº£i thiá»‡n RE-RENDER performance!            â”‚
  â”‚  â†’ KHÃ”NG cáº§n thay Ä‘á»•i code!                           â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  TRÆ¯á»šC Compiler:                                 â”‚  â”‚
  â”‚  â”‚  Developer pháº£i Tá»° TAY thÃªm:                    â”‚  â”‚
  â”‚  â”‚  â€¢ useMemo()     â€” cache giÃ¡ trá»‹ tÃ­nh toÃ¡n      â”‚  â”‚
  â”‚  â”‚  â€¢ useCallback() â€” cache function reference     â”‚  â”‚
  â”‚  â”‚  â€¢ React.memo()  â€” skip re-render component     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âŒ Dá»… QUÃŠN thÃªm!                                â”‚  â”‚
  â”‚  â”‚  âŒ Dá»… thÃªm SAI dependencies!                    â”‚  â”‚
  â”‚  â”‚  âŒ Tá»‘n effort maintain!                         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  SAU Compiler:                                   â”‚  â”‚
  â”‚  â”‚  Compiler Tá»° Äá»˜NG thÃªm memoization!             â”‚  â”‚
  â”‚  â”‚  â€¢ PhÃ¢n tÃ­ch code táº¡i BUILD TIME                â”‚  â”‚
  â”‚  â”‚  â€¢ XÃ¡c Ä‘á»‹nh dependency chÃ­nh xÃ¡c                â”‚  â”‚
  â”‚  â”‚  â€¢ ChÃ¨n memoization code vÃ o output             â”‚  â”‚
  â”‚  â”‚  â€¢ Náº¿u phÃ¡t hiá»‡n lá»—i â†’ SKIP component Ä‘Ã³       â”‚  â”‚
  â”‚  â”‚    â†’ Compile tiáº¿p cÃ¡c component khÃ¡c!            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… KhÃ´ng quÃªn!                                   â”‚  â”‚
  â”‚  â”‚  âœ… Dependencies luÃ´n Ä‘Ãºng!                       â”‚  â”‚
  â”‚  â”‚  âœ… Zero maintenance!                             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BUILD PIPELINE:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Source Code (.jsx/.tsx)                          â”‚  â”‚
  â”‚  â”‚       â”‚                                          â”‚  â”‚
  â”‚  â”‚       â–¼                                          â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚  Babel Parser   â”‚ â† Parse thÃ nh AST          â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚           â–¼                                      â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚ React Compiler  â”‚ â† PhÃ¢n tÃ­ch + Transform    â”‚  â”‚
  â”‚  â”‚  â”‚  (Babel Plugin) â”‚   Auto memoization!         â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚           â–¼                                      â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚  Optimized Code â”‚ â† Code Ä‘Ã£ cÃ³ memoization   â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚           â–¼                                      â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚  â”‚
  â”‚  â”‚  â”‚  Bundler Output â”‚ â† Bundle cuá»‘i cÃ¹ng         â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  ÄÃƒ DÃ™NG á» ÄÃ‚U?                                      â”‚
  â”‚  â†’ Meta Ä‘Ã£ dÃ¹ng trÃªn instagram.com (PRODUCTION!)     â”‚
  â”‚  â†’ TÆ°Æ¡ng thÃ­ch vá»›i háº§u háº¿t React frameworks           â”‚
  â”‚  â†’ Integration chÃ­nh: Babel plugin                    â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Váº¥n Äá» Re-render & Manual Memoization!

```
  Váº¤N Äá»€ RE-RENDER (Cascading Re-renders):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  React máº·c Ä‘á»‹nh: Khi parent re-render                 â”‚
  â”‚  â†’ Táº¤T Cáº¢ children re-render!                        â”‚
  â”‚                                                        â”‚
  â”‚  <App>                    â† state thay Ä‘á»•i            â”‚
  â”‚    â”œâ”€â”€ <Header />         â† RE-RENDER! (khÃ´ng cáº§n!)  â”‚
  â”‚    â”œâ”€â”€ <FriendList>       â† RE-RENDER!                â”‚
  â”‚    â”‚     â”œâ”€â”€ <FriendCard /> â† RE-RENDER!              â”‚
  â”‚    â”‚     â”œâ”€â”€ <FriendCard /> â† RE-RENDER!              â”‚
  â”‚    â”‚     â””â”€â”€ <FriendCard /> â† RE-RENDER!              â”‚
  â”‚    â”œâ”€â”€ <MessageButton />  â† RE-RENDER! (khÃ´ng cáº§n!)  â”‚
  â”‚    â””â”€â”€ <Footer />         â† RE-RENDER! (khÃ´ng cáº§n!)  â”‚
  â”‚                                                        â”‚
  â”‚  Chá»‰ <FriendList> Cáº¦N re-render!                     â”‚
  â”‚  NhÆ°ng 6 components khÃ¡c CÅ¨NG bá»‹ re-render!           â”‚
  â”‚  â†’ LÃƒNG PHÃ performance!                              â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  3 USE CASES Cá»¦A MEMOIZATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  SKIP CASCADING RE-RENDERS (chÃ­nh!):                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Parent re-render â†’ children KHÃ”NG re-render    â”‚  â”‚
  â”‚  â”‚  náº¿u props KHÃ”NG thay Ä‘á»•i!                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Manual:                                        â”‚  â”‚
  â”‚  â”‚  const MemoButton = React.memo(MessageButton);  â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ re-render khi props THá»°C Sá»° thay Ä‘á»•i!  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ SKIP EXPENSIVE CALCULATIONS:                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Avoid re-compute expensive functions:           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Manual:                                        â”‚  â”‚
  â”‚  â”‚  const data = useMemo(                          â”‚  â”‚
  â”‚  â”‚    () => expensiveProcess(items),               â”‚  â”‚
  â”‚  â”‚    [items]                                       â”‚  â”‚
  â”‚  â”‚  );                                              â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ re-compute khi items thay Ä‘á»•i!          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ MEMOIZE DEPS TO EFFECTS:                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Äáº£m báº£o dependency === qua re-renders:         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Manual:                                        â”‚  â”‚
  â”‚  â”‚  const config = useMemo(                        â”‚  â”‚
  â”‚  â”‚    () => ({ theme, lang }),                      â”‚  â”‚
  â”‚  â”‚    [theme, lang]                                 â”‚  â”‚
  â”‚  â”‚  );                                              â”‚  â”‚
  â”‚  â”‚  useEffect(() => {                              â”‚  â”‚
  â”‚  â”‚    setupApp(config);                             â”‚  â”‚
  â”‚  â”‚  }, [config]); // â† config === á»•n Ä‘á»‹nh!        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš ï¸ Náº¿u KHÃ”NG memo config:                     â”‚  â”‚
  â”‚  â”‚  â†’ Má»—i render táº¡o object Má»šI                   â”‚  â”‚
  â”‚  â”‚  â†’ config !== prevConfig (reference khÃ¡c!)      â”‚  â”‚
  â”‚  â”‚  â†’ useEffect CHáº Y Láº I má»—i render!              â”‚  â”‚
  â”‚  â”‚  â†’ INFINITE LOOP! ğŸ’€                            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  React Compiler focus: â‘  vÃ  â‘¡ (re-renders!)           â”‚
  â”‚  â‘¢ (effects) = váº«n Ä‘ang nghiÃªn cá»©u!                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  VÃ Dá»¤ THá»°C Táº¾ â€” FriendList:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  function FriendList({ friends }) {                    â”‚
  â”‚    const onlineCount = useFriendOnlineCount();         â”‚
  â”‚    if (friends.length === 0) return <NoFriends />;     â”‚
  â”‚    return (                                            â”‚
  â”‚      <div>                                             â”‚
  â”‚        <span>{onlineCount} online</span>               â”‚
  â”‚        {friends.map(f => (                             â”‚
  â”‚          <FriendListCard key={f.id} friend={f} />      â”‚
  â”‚        ))}                                             â”‚
  â”‚        <MessageButton />                               â”‚
  â”‚      </div>                                            â”‚
  â”‚    );                                                  â”‚
  â”‚  }                                                     â”‚
  â”‚                                                        â”‚
  â”‚  âŒ KHÃ”NG cÃ³ Compiler:                                  â”‚
  â”‚  onlineCount thay Ä‘á»•i â†’ FriendList re-render          â”‚
  â”‚  â†’ Táº¤T Cáº¢ FriendListCard re-render! (khÃ´ng cáº§n!)    â”‚
  â”‚  â†’ MessageButton re-render!      (khÃ´ng cáº§n!)        â”‚
  â”‚                                                        â”‚
  â”‚  âœ… CÃ“ Compiler:                                       â”‚
  â”‚  Compiler Tá»° Äá»˜NG nháº­n ra:                            â”‚
  â”‚  â€¢ FriendListCard chá»‰ phá»¥ thuá»™c friend prop           â”‚
  â”‚  â€¢ MessageButton khÃ´ng cÃ³ props thay Ä‘á»•i               â”‚
  â”‚  â†’ Chá»‰ re-render <span>{onlineCount}</span>!         â”‚
  â”‚  â†’ Skip Táº¤T Cáº¢ FriendListCard + MessageButton!       â”‚
  â”‚  = "Fine-grained reactivity"!                         â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Auto Memoization â€” Compiler LÃ m GÃ¬?

```
  COMPILER TRANSFORM â€” TRÆ¯á»šC vs SAU:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TRÆ¯á»šC (code developer viáº¿t):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  function Product({ item, onBuy }) {             â”‚  â”‚
  â”‚  â”‚    const price = calculatePrice(item);           â”‚  â”‚
  â”‚  â”‚    const label = item.name + ' - $' + price;     â”‚  â”‚
  â”‚  â”‚    return (                                      â”‚  â”‚
  â”‚  â”‚      <div>                                       â”‚  â”‚
  â”‚  â”‚        <span>{label}</span>                      â”‚  â”‚
  â”‚  â”‚        <button onClick={onBuy}>Buy</button>      â”‚  â”‚
  â”‚  â”‚      </div>                                      â”‚  â”‚
  â”‚  â”‚    );                                            â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SAU (compiler output â€” conceptual):                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  function Product({ item, onBuy }) {             â”‚  â”‚
  â”‚  â”‚    const $ = useMemoCache(4);                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    let price;                                    â”‚  â”‚
  â”‚  â”‚    if ($[0] !== item) {                          â”‚  â”‚
  â”‚  â”‚      price = calculatePrice(item);               â”‚  â”‚
  â”‚  â”‚      $[0] = item;                                â”‚  â”‚
  â”‚  â”‚      $[1] = price;                               â”‚  â”‚
  â”‚  â”‚    } else {                                      â”‚  â”‚
  â”‚  â”‚      price = $[1];                               â”‚  â”‚
  â”‚  â”‚    }                                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    let label;                                    â”‚  â”‚
  â”‚  â”‚    if ($[0] !== item) {                          â”‚  â”‚
  â”‚  â”‚      label = item.name + ' - $' + price;         â”‚  â”‚
  â”‚  â”‚    } else {                                      â”‚  â”‚
  â”‚  â”‚      label = $[2];                               â”‚  â”‚
  â”‚  â”‚    }                                             â”‚  â”‚
  â”‚  â”‚    $[2] = label;                                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    let jsx;                                      â”‚  â”‚
  â”‚  â”‚    if ($[0] !== item || $[3] !== onBuy) {        â”‚  â”‚
  â”‚  â”‚      jsx = <div>                                 â”‚  â”‚
  â”‚  â”‚        <span>{label}</span>                      â”‚  â”‚
  â”‚  â”‚        <button onClick={onBuy}>Buy</button>      â”‚  â”‚
  â”‚  â”‚      </div>;                                     â”‚  â”‚
  â”‚  â”‚    } else {                                      â”‚  â”‚
  â”‚  â”‚      jsx = $[4];                                 â”‚  â”‚
  â”‚  â”‚    }                                             â”‚  â”‚
  â”‚  â”‚    $[3] = onBuy;                                 â”‚  â”‚
  â”‚  â”‚    $[4] = jsx;                                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    return jsx;                                   â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  PHÃ‚N TÃCH:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  useMemoCache(4) = internal cache array          â”‚  â”‚
  â”‚  â”‚  â†’ Má»—i slot lÆ°u 1 giÃ¡ trá»‹ cached!              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Compiler KHÃ”NG dÃ¹ng useMemo/useCallback!       â”‚  â”‚
  â”‚  â”‚  â†’ DÃ¹ng LOW-LEVEL PRIMITIVES ($[0], $[1]...)   â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng cáº§n follow Rules of Hooks!             â”‚  â”‚
  â”‚  â”‚  â†’ GRANULAR hÆ¡n manual memoization!             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Cache check = SIMPLE === comparison!            â”‚  â”‚
  â”‚  â”‚  â†’ $[0] !== item â†’ recalculate                  â”‚  â”‚
  â”‚  â”‚  â†’ $[0] === item â†’ return cached                â”‚  â”‚
  â”‚  â”‚  â†’ NHANH hÆ¡n re-execute toÃ n bá»™ component!     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  FINE-GRAINED vs COARSE-GRAINED:                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Manual (useMemo):                               â”‚  â”‚
  â”‚  â”‚  â†’ Memoize Cáº¢ BLOCK code                        â”‚  â”‚
  â”‚  â”‚  â†’ 1 dependency thay Ä‘á»•i â†’ re-run Táº¤T Cáº¢      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Compiler (auto):                                â”‚  â”‚
  â”‚  â”‚  â†’ Memoize Tá»ªNG EXPRESSION riÃªng láº»!           â”‚  â”‚
  â”‚  â”‚  â†’ price chá»‰ phá»¥ thuá»™c item                     â”‚  â”‚
  â”‚  â”‚  â†’ label chá»‰ phá»¥ thuá»™c item                     â”‚  â”‚
  â”‚  â”‚  â†’ jsx phá»¥ thuá»™c item + onBuy                   â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u onBuy thay Ä‘á»•i nhÆ°ng item KHÃ”NG:        â”‚  â”‚
  â”‚  â”‚    â†’ price: cached! âœ…                           â”‚  â”‚
  â”‚  â”‚    â†’ label: cached! âœ…                           â”‚  â”‚
  â”‚  â”‚    â†’ jsx: re-create (vÃ¬ onBuy má»›i) ğŸ”„           â”‚  â”‚
  â”‚  â”‚  = CHÃNH XÃC HÆ N manual memo!                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
  EXPENSIVE CALCULATIONS â€” GIá»šI Háº N:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Compiler memoize expensive functions BÃŠN TRONG       â”‚
  â”‚  components/hooks. NHÆ¯NG cÃ³ giá»›i háº¡n:                  â”‚
  â”‚                                                        â”‚
  â”‚  âŒ KHÃ”NG memoize functions NGOÃ€I component:           â”‚
  â”‚  function expensiveProcess() { ... }                   â”‚
  â”‚  â†’ Compiler CHá»ˆ optimize components vÃ  hooks!          â”‚
  â”‚                                                        â”‚
  â”‚  âŒ KHÃ”NG share cache giá»¯a components:                 â”‚
  â”‚  <ComponentA items={items} /> â†’ calculate!             â”‚
  â”‚  <ComponentB items={items} /> â†’ calculate Láº I!        â”‚
  â”‚  â†’ Má»—i component instance cÃ³ cache RIÃŠNG!             â”‚
  â”‚                                                        â”‚
  â”‚  âœ… Náº¿u function THá»°C Sá»° expensive:                    â”‚
  â”‚  â†’ Implement memoization RIÃŠNG (ngoÃ i React)          â”‚
  â”‚  â†’ VÃ­ dá»¥: LRU cache, WeakMap cache                   â”‚
  â”‚  â†’ Profiling TRÆ¯á»šC khi optimize!                      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Rules of React â€” Compiler Giáº£ Äá»‹nh GÃ¬?

```
  COMPILER GIáº¢ Äá»ŠNH CODE Cá»¦A Báº N:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  Valid, Semantic JavaScript:                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Code pháº£i lÃ  JS/TS há»£p lá»‡                      â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng hack, khÃ´ng eval tricks                â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng dynamic property access báº¥t thÆ°á»ng     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Nullable Safety:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Kiá»ƒm tra null/undefined TRÆ¯á»šC khi access:      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… if (obj.prop) { obj.prop.foo }               â”‚  â”‚
  â”‚  â”‚  âœ… obj.prop?.foo                                 â”‚  â”‚
  â”‚  â”‚  âŒ obj.prop.foo // cÃ³ thá»ƒ null!                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Báº­t strictNullChecks trong TypeScript!        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Rules of React (QUAN TRá»ŒNG NHáº¤T!):                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Rule 1: Components pháº£i PURE!                   â”‚  â”‚
  â”‚  â”‚  â†’ CÃ¹ng props + state â†’ cÃ¹ng output!            â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng modify global variables!               â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng mutate objects/arrays!                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âŒ VI PHáº M:                                     â”‚  â”‚
  â”‚  â”‚  let count = 0;                                  â”‚  â”‚
  â”‚  â”‚  function Counter() {                            â”‚  â”‚
  â”‚  â”‚    count++; // â† Mutate biáº¿n ngoÃ i!             â”‚  â”‚
  â”‚  â”‚    return <span>{count}</span>;                  â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚  â†’ Compiler SKIP component nÃ y!                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Rule 2: Props/State = IMMUTABLE!                â”‚  â”‚
  â”‚  â”‚  âŒ props.items.push(newItem);                   â”‚  â”‚
  â”‚  â”‚  âœ… setItems([...items, newItem]);               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Rule 3: Hooks = top-level only!                 â”‚  â”‚
  â”‚  â”‚  âŒ if (cond) { useState(0); }                   â”‚  â”‚
  â”‚  â”‚  âœ… const [x, setX] = useState(0);               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Rule 4: KhÃ´ng gá»i component nhÆ° function!       â”‚  â”‚
  â”‚  â”‚  âŒ const result = MyComponent(props);           â”‚  â”‚
  â”‚  â”‚  âœ… <MyComponent {...props} />                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  KHI COMPILER PHÃT HIá»†N Lá»–I:                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Compiler scan â†’ phÃ¡t hiá»‡n vi pháº¡m Rules        â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG crash build!                            â”‚  â”‚
  â”‚  â”‚  â†’ SKIP component/hook vi pháº¡m                  â”‚  â”‚
  â”‚  â”‚  â†’ Compile tiáº¿p components khÃ¡c bÃ¬nh thÆ°á»ng!    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  App váº«n cháº¡y! Chá»‰ component vi pháº¡m            â”‚  â”‚
  â”‚  â”‚  KHÃ”NG Ä‘Æ°á»£c optimize thÃ´i!                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  TIP: CÃ i eslint-plugin-react-compiler          â”‚  â”‚
  â”‚  â”‚  â†’ Tháº¥y lá»—i TRÆ¯á»šC khi build!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Single-File Analysis & Compiler Scope!

```
  COMPILER "THáº¤Y" ÄÆ¯á»¢C GÃŒ?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  SINGLE-FILE ANALYSIS:                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Compiler chá»‰ phÃ¢n tÃ­ch 1 FILE táº¡i 1 thá»i Ä‘iá»ƒm â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG Ä‘á»c cross-file information!            â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG biáº¿t component imported tá»« file khÃ¡c   â”‚  â”‚
  â”‚  â”‚    return gÃ¬ hay cÃ³ side effects khÃ´ng!          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  File A: export function helper() { ... }       â”‚  â”‚
  â”‚  â”‚  File B: import { helper } from './A';          â”‚  â”‚
  â”‚  â”‚          function MyComp() {                    â”‚  â”‚
  â”‚  â”‚            const x = helper();                  â”‚  â”‚
  â”‚  â”‚          }                                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Khi compile File B:                            â”‚  â”‚
  â”‚  â”‚  â†’ Compiler KHÃ”NG Ä‘á»c File A!                   â”‚  â”‚
  â”‚  â”‚  â†’ KhÃ´ng biáº¿t helper() pure hay khÃ´ng!          â”‚  â”‚
  â”‚  â”‚  â†’ Pháº£i dá»±a vÃ o React conventions!              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  Táº I SAO VáºªN HOáº T Äá»˜NG Tá»T?                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  React's programming model:                      â”‚  â”‚
  â”‚  â”‚  â€¢ Components = PURE functions                   â”‚  â”‚
  â”‚  â”‚  â€¢ Hooks = follow strict rules                   â”‚  â”‚
  â”‚  â”‚  â€¢ Props = immutable                             â”‚  â”‚
  â”‚  â”‚  â€¢ State updates = via setState                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Conventions Ä‘á»§ CHáº¶T Ä‘á»ƒ compiler              â”‚  â”‚
  â”‚  â”‚    suy luáº­n mÃ  KHÃ”NG cáº§n cross-file info!       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Tradeoff:                                       â”‚  â”‚
  â”‚  â”‚  âŒ KhÃ´ng cross-file â†’ bá» lá»¡ má»™t sá»‘ tá»‘i Æ°u    â”‚  â”‚
  â”‚  â”‚  âœ… Single-file â†’ compiler ÄÆ N GIáº¢N hÆ¡n       â”‚  â”‚
  â”‚  â”‚  âœ… Output quality VáºªN Tá»T trong thá»±c táº¿!      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  INTERNAL TYPE SYSTEM:                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Compiler KHÃ”NG dÃ¹ng TypeScript/Flow types!     â”‚  â”‚
  â”‚  â”‚  â†’ CÃ³ type system RIÃŠNG (internal)              â”‚  â”‚
  â”‚  â”‚  â†’ Hiá»ƒu code qua flow analysis                  â”‚  â”‚
  â”‚  â”‚  â†’ XÃ¡c Ä‘á»‹nh: biáº¿n nÃ o reactive, nÃ o stable     â”‚  â”‚
  â”‚  â”‚  â†’ Dá»±a vÃ o React semantics, khÃ´ng TS types     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Effect Memoization â€” Open Research!

```
  EFFECT MEMOIZATION â€” Váº¤N Äá»€ Má»:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€:                                              â”‚
  â”‚  Compiler memo GRANULAR hÆ¡n manual memo                â”‚
  â”‚  â†’ Dependencies cÃ³ thá»ƒ KHÃC vá»›i trÆ°á»›c!                â”‚
  â”‚  â†’ Effects dá»±a vÃ o deps cÃ³ thá»ƒ fire SAI!              â”‚
  â”‚                                                        â”‚
  â”‚  VÃ Dá»¤:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  // TRÆ¯á»šC compiler (manual memo):                â”‚  â”‚
  â”‚  â”‚  const config = useMemo(                         â”‚  â”‚
  â”‚  â”‚    () => ({ theme, lang, debug }),                â”‚  â”‚
  â”‚  â”‚    [theme, lang, debug]                           â”‚  â”‚
  â”‚  â”‚  );                                               â”‚  â”‚
  â”‚  â”‚  useEffect(() => {                               â”‚  â”‚
  â”‚  â”‚    initSDK(config);                               â”‚  â”‚
  â”‚  â”‚  }, [config]);                                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  config thay Ä‘á»•i khi: theme OR lang OR debug    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // SAU compiler (auto memo):                    â”‚  â”‚
  â”‚  â”‚  Compiler cÃ³ thá»ƒ memo KHÃC:                      â”‚  â”‚
  â”‚  â”‚  â†’ TÃ¡ch thÃ nh nhiá»u cache slots                 â”‚  â”‚
  â”‚  â”‚  â†’ config identity cÃ³ thá»ƒ thay Ä‘á»•i              â”‚  â”‚
  â”‚  â”‚    á»Ÿ thá»i Ä‘iá»ƒm KHÃC vá»›i manual!                 â”‚  â”‚
  â”‚  â”‚  â†’ useEffect fire khÃ¡c â†’ BUG!                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš ï¸ Infinite loop náº¿u deps thay Ä‘á»•i má»—i render!â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  COMPILER Xá»¬ LÃ THáº¾ NÃ€O?                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Static validation:                              â”‚  â”‚
  â”‚  â”‚  â†’ Compiler CHECK auto memo vs manual memo      â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u CHá»¨NG MINH Ä‘Æ°á»£c cáº£ 2 giá»‘ng nhau â†’ OK   â”‚  â”‚
  â”‚  â”‚  â†’ Náº¿u KHÃ”NG chá»©ng minh Ä‘Æ°á»£c â†’ SKIP component! â”‚  â”‚
  â”‚  â”‚  â†’ An toÃ n! KhÃ´ng bao giá» phÃ¡ code!            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  KHUYáº¾N NGHá»Š:                                    â”‚  â”‚
  â”‚  â”‚  â‘  GIá»® useMemo/useCallback hiá»‡n cÃ³!             â”‚  â”‚
  â”‚  â”‚    â†’ Äáº£m báº£o effect behavior khÃ´ng Ä‘á»•i!        â”‚  â”‚
  â”‚  â”‚  â‘¡ Code Má»šI: khÃ´ng cáº§n useMemo/useCallback     â”‚  â”‚
  â”‚  â”‚    â†’ Viáº¿t bÃ¬nh thÆ°á»ng, compiler lo!             â”‚  â”‚
  â”‚  â”‚  â‘¢ KHÃ”NG xÃ³a useMemo/useCallback cÅ©!           â”‚  â”‚
  â”‚  â”‚    â†’ Compiler sáº½ Tá»° táº¡o memo tá»‘t hÆ¡n           â”‚  â”‚
  â”‚  â”‚    â†’ NhÆ°ng giá»¯ cÅ© Ä‘á»ƒ effect an toÃ n!           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Tá»± Viáº¿t â€” Simple React Memoizer!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T â€” SimpleReactMemoizer
// MÃ´ phá»ng useMemoCache â€” cÆ¡ cháº¿ cache ná»™i bá»™ cá»§a Compiler!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SimpleReactMemoizer = (function () {
  // â‘  useMemoCache â€” táº¡o cache array cho má»—i component:
  function createMemoCache(size) {
    var cache = new Array(size);
    var EMPTY = Symbol("empty");
    for (var i = 0; i < size; i++) cache[i] = EMPTY;

    return {
      // Check & update slot:
      check: function (slot, currentValue) {
        if (cache[slot] === EMPTY || cache[slot] !== currentValue) {
          cache[slot] = currentValue;
          return false; // CHANGED â†’ cáº§n recalculate!
        }
        return true; // SAME â†’ dÃ¹ng cached!
      },

      // Get cached value:
      get: function (slot) {
        return cache[slot];
      },

      // Set cached value:
      set: function (slot, value) {
        cache[slot] = value;
      },

      // Debug view:
      inspect: function () {
        return cache.map(function (v, i) {
          return (
            "slot[" + i + "] = " + (v === EMPTY ? "(empty)" : JSON.stringify(v))
          );
        });
      },
    };
  }

  // â‘¡ Memoize má»™t expression dá»±a trÃªn dependencies:
  function memoizeExpression(cache, depSlot, valueSlot, deps, compute) {
    var changed = false;
    for (var i = 0; i < deps.length; i++) {
      if (!cache.check(depSlot + i, deps[i])) {
        changed = true;
      }
    }

    if (changed) {
      var result = compute();
      cache.set(valueSlot, result);
      return result;
    }
    return cache.get(valueSlot);
  }

  // â‘¢ Simulate compiler-transformed component:
  function compileComponent(originalFn) {
    var cache = null;

    return function compiledComponent(props) {
      // Khá»Ÿi táº¡o cache láº§n Ä‘áº§u (giá»‘ng useMemoCache):
      if (!cache) {
        cache = createMemoCache(20); // 20 slots
      }

      // Cháº¡y original function nhÆ°ng Vá»šI memoization:
      // Compiler sáº½ wrap tá»«ng expression vÃ o memoizeExpression
      return originalFn(props, cache, memoizeExpression);
    };
  }

  return {
    createMemoCache: createMemoCache,
    memoizeExpression: memoizeExpression,
    compileComponent: compileComponent,
  };
})();

// Sá»¬ Dá»¤NG â€” Simulate compiled Product component:
var CompiledProduct = SimpleReactMemoizer.compileComponent(
  function (props, $, memo) {
    // Expression 1: price (depends on item)
    var price = memo($, 0, 2, [props.item], function () {
      console.log("  [COMPUTE] calculatePrice()");
      return props.item.price * 1.1; // +10% tax
    });

    // Expression 2: label (depends on item)
    var label = memo($, 3, 5, [props.item], function () {
      console.log("  [COMPUTE] label string");
      return props.item.name + " - $" + price;
    });

    // Expression 3: jsx (depends on item + onBuy)
    var jsx = memo($, 6, 9, [props.item, props.onBuy], function () {
      console.log("  [COMPUTE] JSX output");
      return {
        tag: "div",
        children: [
          { tag: "span", text: label },
          { tag: "button", onClick: props.onBuy, text: "Buy" },
        ],
      };
    });

    return jsx;
  },
);

// Render 1: táº¥t cáº£ compute!
console.log("=== Render 1 ===");
var buyFn = function () {};
CompiledProduct({ item: { name: "Phone", price: 100 }, onBuy: buyFn });
// â†’ [COMPUTE] calculatePrice()
// â†’ [COMPUTE] label string
// â†’ [COMPUTE] JSX output

// Render 2: KHÃ”NG Ä‘á»•i gÃ¬ â†’ ALL CACHED!
console.log("=== Render 2 (same props) ===");
CompiledProduct({ item: { name: "Phone", price: 100 }, onBuy: buyFn });
// â†’ (khÃ´ng log gÃ¬ â€” táº¥t cáº£ cached!)

// Render 3: chá»‰ onBuy Ä‘á»•i
console.log("=== Render 3 (new onBuy) ===");
CompiledProduct({ item: { name: "Phone", price: 100 }, onBuy: function () {} });
// â†’ [COMPUTE] JSX output    â† chá»‰ JSX recalculate!
// â†’ price: cached! âœ… label: cached! âœ…
```

---

## Â§8. Tá»± Viáº¿t â€” Simple Compiler Analyzer!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T â€” SimpleCompilerAnalyzer
// MÃ´ phá»ng cÃ¡ch compiler phÃ¢n tÃ­ch dependency graph
// vÃ  kiá»ƒm tra Rules of React!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SimpleCompilerAnalyzer = (function () {
  // â‘  PhÃ¢n tÃ­ch dependencies cá»§a tá»«ng expression:
  function analyzeDeps(code) {
    var deps = {};
    var lines = code.split("\n");

    lines.forEach(function (line, idx) {
      var trimmed = line.trim();
      if (!trimmed || trimmed.startsWith("//")) return;

      // TÃ¬m variable assignments:
      var assignMatch = trimmed.match(/(?:const|let|var)\s+(\w+)\s*=\s*(.+)/);
      if (assignMatch) {
        var varName = assignMatch[1];
        var expr = assignMatch[2];

        // TÃ¬m dependencies trong expression:
        var usedVars = [];

        // Check props access:
        var propMatches = expr.match(/props\.(\w+)/g);
        if (propMatches) {
          propMatches.forEach(function (p) {
            usedVars.push(p);
          });
        }

        // Check other variable references:
        var varRefs = expr.match(/\b([a-z]\w*)\b/g);
        if (varRefs) {
          varRefs.forEach(function (v) {
            if (deps[v] && usedVars.indexOf(v) === -1) {
              usedVars.push(v);
            }
          });
        }

        deps[varName] = {
          line: idx + 1,
          expression: expr.substring(0, 50),
          dependencies: usedVars,
        };
      }
    });

    return deps;
  }

  // â‘¡ Kiá»ƒm tra Rules of React:
  function checkRules(code) {
    var violations = [];

    // Rule 1: No global mutations
    if (code.match(/\b\w+\s*\+\+/)) {
      violations.push({
        rule: "PURITY",
        message: "Mutation detected (++)! Components must be PURE!",
      });
    }
    if (code.match(/\b\w+\.push\s*\(/)) {
      violations.push({
        rule: "IMMUTABILITY",
        message: "Array.push() detected! Use spread: [...arr, item]",
      });
    }
    if (code.match(/\b\w+\.splice\s*\(/)) {
      violations.push({
        rule: "IMMUTABILITY",
        message: "Array.splice() detected! Mutating arrays is NOT allowed!",
      });
    }

    // Rule 2: Hooks in conditionals
    if (code.match(/if\s*\([^)]*\)\s*\{[^}]*use[A-Z]/)) {
      violations.push({
        rule: "HOOKS_ORDER",
        message: "Hook inside conditional! Hooks must be top-level!",
      });
    }

    // Rule 3: Component called as function
    if (code.match(/\b[A-Z]\w+\s*\(\s*\{/)) {
      violations.push({
        rule: "COMPONENT_CALL",
        message: "Component called as function! Use <Component /> instead!",
      });
    }

    return {
      valid: violations.length === 0,
      violations: violations,
      action:
        violations.length > 0
          ? "SKIP (giá»¯ nguyÃªn, khÃ´ng optimize)"
          : "COMPILE (auto memoize!)",
    };
  }

  // â‘¢ Táº¡o dependency graph (simplified):
  function buildDepGraph(deps) {
    var graph = "  Dependency Graph:\n";
    for (var name in deps) {
      var d = deps[name];
      if (d.dependencies.length > 0) {
        graph += "  " + name + " â† [" + d.dependencies.join(", ") + "]\n";
      } else {
        graph += "  " + name + " â† (no deps â€” static!)\n";
      }
    }
    return graph;
  }

  return {
    analyzeDeps: analyzeDeps,
    checkRules: checkRules,
    buildDepGraph: buildDepGraph,
  };
})();

// Sá»¬ Dá»¤NG â€” Analyze component:
var goodCode = [
  "const price = calculatePrice(props.item);",
  'const label = props.item.name + " - $" + price;',
  'const jsx = createElement("div", label, props.onBuy);',
].join("\n");

var deps = SimpleCompilerAnalyzer.analyzeDeps(goodCode);
console.log(SimpleCompilerAnalyzer.buildDepGraph(deps));
// â†’ price â† [props.item]
// â†’ label â† [props.item, price]
// â†’ jsx   â† [props.onBuy, label]

var ruleCheck = SimpleCompilerAnalyzer.checkRules(goodCode);
console.log(ruleCheck); // â†’ { valid: true, action: "COMPILE!" }

// Vi pháº¡m Rules:
var badCode = "counter++;\nprops.items.push(newItem);";
var badResult = SimpleCompilerAnalyzer.checkRules(badCode);
console.log(badResult);
// â†’ violations: [PURITY, IMMUTABILITY]
// â†’ action: "SKIP (giá»¯ nguyÃªn, khÃ´ng optimize)"
```

---

## Â§9. Tá»± Viáº¿t â€” Simple Fine-Grained Reactivity!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T â€” SimpleFineGrainedReactivity
// MÃ´ phá»ng cÃ¡ch compiler táº¡o fine-grained re-renders!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SimpleFineGrainedReactivity = (function () {
  // â‘  Component tree tracker:
  var tree = {};
  var renderCount = {};

  function registerComponent(name, deps) {
    tree[name] = {
      deps: deps, // phá»¥ thuá»™c nhá»¯ng props/state nÃ o
      lastValues: {}, // giÃ¡ trá»‹ láº§n render trÆ°á»›c
      shouldUpdate: false,
    };
    renderCount[name] = 0;
  }

  // â‘¡ Check xem component CÃ“ Cáº¦N re-render:
  function shouldRerender(name, currentValues) {
    var comp = tree[name];
    if (!comp) return true; // chÆ°a register â†’ render!

    var needsUpdate = false;
    comp.deps.forEach(function (dep) {
      var prev = comp.lastValues[dep];
      var curr = currentValues[dep];

      if (prev !== curr) {
        needsUpdate = true;
      }
    });

    // Cáº­p nháº­t lastValues:
    comp.deps.forEach(function (dep) {
      comp.lastValues[dep] = currentValues[dep];
    });

    comp.shouldUpdate = needsUpdate;
    return needsUpdate;
  }

  // â‘¢ Simulate render cycle:
  function renderTree(state) {
    console.log("\n--- Render Cycle ---");
    console.log("State:", JSON.stringify(state));

    for (var name in tree) {
      if (shouldRerender(name, state)) {
        renderCount[name]++;
        console.log(
          "  ğŸ”„ " +
            name +
            " â†’ RE-RENDERED! (render #" +
            renderCount[name] +
            ")",
        );
      } else {
        console.log("  â­ï¸  " + name + " â†’ SKIPPED! (cached)");
      }
    }
  }

  // â‘£ Get stats:
  function getStats() {
    var stats = {};
    for (var name in renderCount) {
      stats[name] = renderCount[name] + " renders";
    }
    return stats;
  }

  return {
    registerComponent: registerComponent,
    renderTree: renderTree,
    getStats: getStats,
  };
})();

// Sá»¬ Dá»¤NG â€” Simulate FriendList example:

// Register components vá»›i dependencies:
SimpleFineGrainedReactivity.registerComponent("Header", []);
SimpleFineGrainedReactivity.registerComponent("FriendCount", ["onlineCount"]);
SimpleFineGrainedReactivity.registerComponent("FriendCard1", ["friend1"]);
SimpleFineGrainedReactivity.registerComponent("FriendCard2", ["friend2"]);
SimpleFineGrainedReactivity.registerComponent("MessageButton", []);
SimpleFineGrainedReactivity.registerComponent("Footer", []);

// Render 1: Initial
SimpleFineGrainedReactivity.renderTree({
  onlineCount: 5,
  friend1: "Alice",
  friend2: "Bob",
});
// â†’ Táº¤T Cáº¢ render (láº§n Ä‘áº§u!)

// Render 2: Chá»‰ onlineCount thay Ä‘á»•i!
SimpleFineGrainedReactivity.renderTree({
  onlineCount: 6,
  friend1: "Alice",
  friend2: "Bob",
});
// â†’ ğŸ”„ FriendCount â†’ RE-RENDERED!
// â†’ â­ï¸  Header â†’ SKIPPED!
// â†’ â­ï¸  FriendCard1 â†’ SKIPPED!
// â†’ â­ï¸  FriendCard2 â†’ SKIPPED!
// â†’ â­ï¸  MessageButton â†’ SKIPPED!
// â†’ â­ï¸  Footer â†’ SKIPPED!
// = FINE-GRAINED! Chá»‰ 1/6 components re-render!

console.log(SimpleFineGrainedReactivity.getStats());
// â†’ Header: 1, FriendCount: 2, Cards: 1, Button: 1, Footer: 1
```

---

## Â§10. Migration & Best Practices!

```
  MIGRATION STRATEGY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CODE HIá»†N Táº I ÄÃƒ CÃ“ MEMO:                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  GIá»® useMemo/useCallback hiá»‡n cÃ³!             â”‚  â”‚
  â”‚  â”‚    â†’ Compiler sáº½ Tá»° táº¡o memo tá»‘t hÆ¡n           â”‚  â”‚
  â”‚  â”‚    â†’ NhÆ°ng giá»¯ cÅ© Ä‘á»ƒ effect deps an toÃ n!      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ GIá»® React.memo() hiá»‡n cÃ³!                    â”‚  â”‚
  â”‚  â”‚    â†’ An toÃ n, khÃ´ng conflict vá»›i compiler       â”‚  â”‚
  â”‚  â”‚    â†’ Compiler sáº½ thÃªm memo BÃŠN TRONG           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ KHÃ”NG xÃ³a memo code cÅ©!                      â”‚  â”‚
  â”‚  â”‚    â†’ Effect behavior cÃ³ thá»ƒ thay Ä‘á»•i!           â”‚  â”‚
  â”‚  â”‚    â†’ Giá»¯ Ä‘á»ƒ backward compatible!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  CODE Má»šI (viáº¿t tá»« Ä‘áº§u):                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  KHÃ”NG Cáº¦N useMemo/useCallback!               â”‚  â”‚
  â”‚  â”‚    â†’ Compiler auto thÃªm!                        â”‚  â”‚
  â”‚  â”‚    â†’ Code clean hÆ¡n!                             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ KHÃ”NG Cáº¦N React.memo()!                      â”‚  â”‚
  â”‚  â”‚    â†’ Compiler auto skip unnecessary renders     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ Follow Rules of React nghiÃªm tÃºc!            â”‚  â”‚
  â”‚  â”‚    â†’ PURE components!                           â”‚  â”‚
  â”‚  â”‚    â†’ IMMUTABLE props/state!                     â”‚  â”‚
  â”‚  â”‚    â†’ Hooks á»Ÿ top-level!                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘£ CÃ i eslint-plugin-react-compiler:            â”‚  â”‚
  â”‚  â”‚    â†’ PhÃ¡t hiá»‡n lá»—i TRÆ¯á»šC build!                â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  ROLLOUT AN TOÃ€N:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Step 1: CÃ i eslint plugin                       â”‚  â”‚
  â”‚  â”‚  â†’ Fix Táº¤T Cáº¢ violations trÆ°á»›c!                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Step 2: Enable compiler cho 1-2 components     â”‚  â”‚
  â”‚  â”‚  â†’ Test ká»¹ behavior!                            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Step 3: Má»Ÿ rá»™ng dáº§n                             â”‚  â”‚
  â”‚  â”‚  â†’ Monitor effect behavior!                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Step 4: Enable toÃ n bá»™ codebase                â”‚  â”‚
  â”‚  â”‚  â†’ Profile trÆ°á»›c/sau!                           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš ï¸ Náº¿u app ÄÃƒ well-memoized:                 â”‚  â”‚
  â”‚  â”‚  â†’ CÃ³ thá»ƒ KHÃ”NG tháº¥y cáº£i thiá»‡n lá»›n!            â”‚  â”‚
  â”‚  â”‚  â†’ NhÆ°ng GIáº¢M maintenance cost!                â”‚  â”‚
  â”‚  â”‚  â†’ Compiler catch cases developer QUÃŠN!         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âš¡ PROFILING TIP:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  TrÆ°á»›c khi dÃ¹ng compiler, PROFILE app!          â”‚  â”‚
  â”‚  â”‚  â†’ React DevTools Profiler                      â”‚  â”‚
  â”‚  â”‚  â†’ Chrome Performance tab                       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Sau khi enable compiler:                        â”‚  â”‚
  â”‚  â”‚  â†’ So sÃ¡nh re-render counts!                    â”‚  â”‚
  â”‚  â”‚  â†’ So sÃ¡nh update times!                        â”‚  â”‚
  â”‚  â”‚  â†’ Check effect firing patterns!                â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Manual memoization SAI ráº¥t khÃ³ detect!         â”‚  â”‚
  â”‚  â”‚  â†’ Stale closures                               â”‚  â”‚
  â”‚  â”‚  â†’ Missing dependencies                         â”‚  â”‚
  â”‚  â”‚  â†’ Over-memoization (cache overhead!)           â”‚  â”‚
  â”‚  â”‚  â†’ Compiler fix Táº¤T Cáº¢ tá»± Ä‘á»™ng!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. Tá»•ng Káº¿t & CÃ¢u Há»i Phá»ng Váº¥n!

```
  Tá»”NG Káº¾T â€” REACT COMPILER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  React Compiler = BUILD-TIME auto memoization!      â”‚
  â”‚     â†’ DÃ¹ng Babel plugin, phÃ¢n tÃ­ch AST                â”‚
  â”‚     â†’ Tá»± chÃ¨n cache checks vÃ o component output      â”‚
  â”‚     â†’ ÄÃ£ production trÃªn instagram.com!               â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Focus: Re-render performance (updates)!            â”‚
  â”‚     â†’ Skip cascading re-renders                       â”‚
  â”‚     â†’ Memoize expensive calculations                  â”‚
  â”‚     â†’ Effect memoization = váº«n nghiÃªn cá»©u!           â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ useMemoCache (internal primitive):                  â”‚
  â”‚     â†’ Cache array vá»›i === comparison                  â”‚
  â”‚     â†’ GRANULAR hÆ¡n useMemo (per-expression!)          â”‚
  â”‚     â†’ KhÃ´ng follow Rules of Hooks!                    â”‚
  â”‚                                                        â”‚
  â”‚  â‘£ Rules of React = TIÃŠN QUYáº¾T:                       â”‚
  â”‚     â†’ PURE components, IMMUTABLE data                 â”‚
  â”‚     â†’ Vi pháº¡m = SKIP (khÃ´ng crash!)                   â”‚
  â”‚     â†’ eslint-plugin-react-compiler!                   â”‚
  â”‚                                                        â”‚
  â”‚  â‘¤ Single-file, NO cross-file analysis:               â”‚
  â”‚     â†’ Internal type system                            â”‚
  â”‚     â†’ React conventions = Ä‘á»§ info!                    â”‚
  â”‚                                                        â”‚
  â”‚  â‘¥ Migration:                                          â”‚
  â”‚     â†’ GIá»® useMemo/useCallback cÅ©!                    â”‚
  â”‚     â†’ Code Má»šI khÃ´ng cáº§n manual memo!                 â”‚
  â”‚     â†’ Profile trÆ°á»›c/sau!                              â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**â“ Q1: React Compiler lÃ  gÃ¬? NÃ³ hoáº¡t Ä‘á»™ng tháº¿ nÃ o?**

> React Compiler lÃ  **build-time tool** (Babel plugin) tá»± Ä‘á»™ng thÃªm memoization vÃ o React components vÃ  hooks. NÃ³ phÃ¢n tÃ­ch AST táº¡i build time, xÃ¡c Ä‘á»‹nh dependency graph cá»§a tá»«ng expression, vÃ  chÃ¨n cache checks (`useMemoCache` â€” internal primitive) vÃ o compiled output. Thay vÃ¬ developer pháº£i thÃªm `useMemo`/`useCallback`/`React.memo` báº±ng tay, compiler tá»± lÃ m â€” CHÃNH XÃC hÆ¡n vÃ¬ nÃ³ memoize á»Ÿ **per-expression level** (fine-grained), khÃ´ng pháº£i per-block nhÆ° manual memo.

**â“ Q2: useMemoCache khÃ¡c useMemo tháº¿ nÃ o?**

> `useMemoCache` lÃ  **internal primitive** cá»§a compiler â€” má»™t cache array vá»›i cÃ¡c slots. Má»—i slot lÆ°u 1 giÃ¡ trá»‹ vÃ  check báº±ng `===`. KhÃ¡c `useMemo`: â‘  useMemoCache memoize **tá»«ng expression riÃªng láº»** (granular), useMemo memoize **cáº£ block**. â‘¡ useMemoCache **khÃ´ng follow Rules of Hooks** â€” compiler generate code nÃªn an toÃ n. â‘¢ Khi 1 dep thay Ä‘á»•i, useMemo re-run toÃ n bá»™ factory, nhÆ°ng useMemoCache chá»‰ recalculate **expressions phá»¥ thuá»™c dep Ä‘Ã³**!

**â“ Q3: Khi compiler phÃ¡t hiá»‡n vi pháº¡m Rules of React thÃ¬ sao?**

> Compiler **KHÃ”NG crash build**! NÃ³ **SKIP** component/hook vi pháº¡m vÃ  compile tiáº¿p cÃ¡c components khÃ¡c bÃ¬nh thÆ°á»ng. App váº«n cháº¡y Ä‘Ãºng â€” chá»‰ component vi pháº¡m khÃ´ng Ä‘Æ°á»£c optimize thÃ´i. Vi pháº¡m phá»• biáº¿n: mutate global variables (impure), `props.items.push()` (mutate props), hooks trong conditionals, gá»i component nhÆ° function. NÃªn cÃ i `eslint-plugin-react-compiler` Ä‘á»ƒ detect errors trÆ°á»›c build!

**â“ Q4: Táº¡i sao compiler chá»‰ analyze single file?**

> Compiler chá»‰ Ä‘á»c **1 file** táº¡i 1 thá»i Ä‘iá»ƒm â€” khÃ´ng Ä‘á»c cross-file information. LÃ½ do: â‘  React's programming model (PURE components, immutable props, strict hooks) cung cáº¥p Ä‘á»§ **conventions** Ä‘á»ƒ compiler suy luáº­n mÃ  khÃ´ng cáº§n cross-file info. â‘¡ Single-file approach giá»¯ compiler **Ä‘Æ¡n giáº£n** hÆ¡n, build **nhanh** hÆ¡n. â‘¢ Tradeoff: bá» lá»¡ má»™t sá»‘ tá»‘i Æ°u cross-file, nhÆ°ng output quality **váº«n tá»‘t** trong thá»±c táº¿ (Meta production!).

**â“ Q5: Effect memoization cÃ³ váº¥n Ä‘á» gÃ¬?**

> Compiler memo **granular hÆ¡n** manual memo â†’ dependencies cÃ³ thá»ƒ khÃ¡c â†’ effects (useEffect, useLayoutEffect) fire á»Ÿ thá»i Ä‘iá»ƒm **khÃ¡c vá»›i trÆ°á»›c**. VÃ­ dá»¥: manual useMemo táº¡o 1 object config, compiler tÃ¡ch thÃ nh nhiá»u cache slots â†’ config identity thay Ä‘á»•i khÃ¡c â†’ useEffect fire khÃ¡c â†’ potential infinite loop! Giáº£i phÃ¡p: Compiler **static validate** auto vs manual memo â€” náº¿u khÃ´ng prove giá»‘ng nhau thÃ¬ **SKIP**. Khuyáº¿n nghá»‹: **giá»¯ useMemo/useCallback cÅ©**, code má»›i khÃ´ng cáº§n thÃªm!

**â“ Q6: App Ä‘Ã£ well-memoized cÃ³ nÃªn dÃ¹ng compiler khÃ´ng?**

> CÃ“, vÃ¬: â‘  **Giáº£m maintenance cost** â€” khÃ´ng cáº§n manually maintain useMemo/useCallback. â‘¡ Compiler **catch cases developer quÃªn** â€” trong thá»±c táº¿, manual memoization thÆ°á»ng bá» sÃ³t nhiá»u chá»—. â‘¢ **Preventing future regressions** â€” code má»›i tá»± Ä‘á»™ng Ä‘Æ°á»£c optimize. Tuy nhiÃªn, **performance improvement cÃ³ thá»ƒ khÃ´ng lá»›n** náº¿u app Ä‘Ã£ well-memoized. LuÃ´n **profile trÆ°á»›c/sau** Ä‘á»ƒ measure actual impact!

**â“ Q7: Expensive function ngoÃ i component cÃ³ Ä‘Æ°á»£c compiler optimize khÃ´ng?**

> **KHÃ”NG!** Compiler chá»‰ optimize React **components** vÃ  **hooks** â€” function thÆ°á»ng ngoÃ i component khÃ´ng Ä‘Æ°á»£c memoize. ThÃªm ná»¯a, compiler **khÃ´ng share cache giá»¯a components** â€” náº¿u `expensiveProcess(items)` Ä‘Æ°á»£c gá»i trong ComponentA vÃ  ComponentB vá»›i cÃ¹ng items, nÃ³ sáº½ compute **2 láº§n**. Náº¿u function thá»±c sá»± expensive â†’ implement memoization riÃªng (LRU cache, WeakMap) **ngoÃ i React**. LuÃ´n **profiling trÆ°á»›c** khi optimize!

**â“ Q8: So sÃ¡nh React Compiler vá»›i Signals (SolidJS, Vue, Svelte)?**

> React Compiler Ä‘áº¡t **fine-grained reactivity** tÆ°Æ¡ng tá»± Signals nhÆ°ng approach hoÃ n toÃ n khÃ¡c: â‘  Signals: **runtime reactivity** â€” track dependencies lÃºc cháº¡y, tá»± Ä‘á»™ng update chá»‰ pháº§n thay Ä‘á»•i. â‘¡ React Compiler: **build-time analysis** â€” analyze code lÃºc compile, chÃ¨n cache checks. â‘¢ React giá»¯ **mental model quen thuá»™c** (function components, hooks) â€” developer khÃ´ng cáº§n há»c paradigm má»›i. â‘£ Compiler transparent â€” **khÃ´ng thay Ä‘á»•i code**, chá»‰ optimize output. Signals Ä‘Ã²i há»i viáº¿t code theo pattern má»›i!

---

> ğŸ“ **Ghi nhá»› cuá»‘i cÃ¹ng:**
> "React Compiler = BUILD-TIME auto memoization via Babel! DÃ¹ng useMemoCache (internal cache array, === check, per-expression granular)! Focus: skip cascading re-renders + memoize expensive calculations! Effects = open research â€” GIá»® useMemo/useCallback cÅ©! Single-file analysis â€” React conventions Ä‘á»§ info! Vi pháº¡m Rules â†’ SKIP component (khÃ´ng crash)! Code má»›i: KHÃ”NG cáº§n manual memo â€” compiler lo! Profile trÆ°á»›c/sau! ÄÃ£ production trÃªn instagram.com!"
