# Next.js layout.js â€” Deep Dive!

> **Chá»§ Ä‘á»**: `layout.js` â€” Shared UI Across Routes
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/api-reference/file-conventions/layout
> **HÃ¬nh áº£nh trang gá»‘c**: 0 (trang chá»‰ cÃ³ text + code blocks, KHÃ”NG cÃ³ diagram/hÃ¬nh áº£nh)

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” layout.js lÃ  gÃ¬?](#1)
2. [Â§2. Props â€” children + params](#2)
3. [Â§3. LayoutProps Helper â€” Type-Safe Props](#3)
4. [Â§4. Root Layout â€” Layout Gá»‘c](#4)
5. [Â§5. Caveats â€” Háº¡n Cháº¿ & HÃ nh Vi Äáº·c Biá»‡t](#5)
6. [Â§6. Fetching Data + Accessing Child Segments](#6)
7. [Â§7. Examples â€” Metadata, Active Nav Links, Params](#7)
8. [Â§8. SÆ¡ Äá»“ Tá»± Váº½ â€” Tá»•ng Há»£p](#8)
9. [Â§9. Tá»± Viáº¿t â€” LayoutEngine](#9)
10. [Â§10. CÃ¢u Há»i Luyá»‡n Táº­p](#10)

---

## Â§1. Tá»•ng Quan â€” layout.js lÃ  gÃ¬?

```
  layout.js â€” Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Äá»ŠNH NGHÄ¨A:                                                 â”‚
  â”‚  File layout.js (hoáº·c .ts/.tsx) Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ Ä‘á»‹nh nghÄ©a     â”‚
  â”‚  LAYOUT â€” giao diá»‡n DÃ™NG CHUNG giá»¯a nhiá»u trang!            â”‚
  â”‚                                                              â”‚
  â”‚  3 Äáº¶C TÃNH QUAN TRá»ŒNG:                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘  Báº¢O TOÃ€N TRáº NG THÃI (State Preservation)         â”‚    â”‚
  â”‚  â”‚   â†’ Khi navigate giá»¯a cÃ¡c trang con                â”‚    â”‚
  â”‚  â”‚   â†’ Layout KHÃ”NG re-render!                         â”‚    â”‚
  â”‚  â”‚   â†’ State bÃªn trong layout ÄÆ¯á»¢C GIá»® NGUYÃŠN!        â”‚    â”‚
  â”‚  â”‚   â†’ VÃ­ dá»¥: sidebar má»Ÿ/Ä‘Ã³ng, scroll position...    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ TÆ¯Æ NG TÃC KHÃ”NG Bá»Š Máº¤T (Interactivity)           â”‚    â”‚
  â”‚  â”‚   â†’ Event listeners, timers... váº«n hoáº¡t Ä‘á»™ng       â”‚    â”‚
  â”‚  â”‚   â†’ Input values váº«n giá»¯ nguyÃªn                    â”‚    â”‚
  â”‚  â”‚   â†’ Animation states khÃ´ng bá»‹ reset                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¢ Lá»’NG NHAU ÄÆ¯á»¢C (Nested Layouts)                   â”‚    â”‚
  â”‚  â”‚   â†’ Layout cÃ³ thá»ƒ chá»©a layout con!                 â”‚    â”‚
  â”‚  â”‚   â†’ RootLayout â†’ DashboardLayout â†’ SettingsLayout  â”‚    â”‚
  â”‚  â”‚   â†’ Má»—i level thÃªm UI riÃªng                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CÃCH HOáº T Äá»˜NG:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€ layout.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
  â”‚  â”‚  â”‚ <html>                                      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚ <body>                                      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   <nav>Sidebar</nav>  â† KHÃ”NG re-render!   â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€ children â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”‚                                  â”‚      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”‚  page.js (thay Ä‘á»•i khi navigate)â”‚      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”‚  loading.js (fallback)           â”‚      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”‚  error.js (error boundary)       â”‚      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â”‚                                  â”‚      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚ </body>                                     â”‚     â”‚    â”‚
  â”‚  â”‚  â”‚ </html>                                     â”‚     â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  Khi navigate /dashboard â†’ /dashboard/settings:     â”‚    â”‚
  â”‚  â”‚  â†’ layout.js = GIá»® NGUYÃŠN (no re-render!)          â”‚    â”‚
  â”‚  â”‚  â†’ children = THAY Äá»”I (page.js má»›i!)              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Props â€” children + params

```
  PROPS Cá»¦A LAYOUT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  PROP 1: children (REQUIRED!)                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Type: React.ReactNode                                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ children Sáº¼ ÄÆ¯á»¢C POPULATE Vá»šI:                       â”‚    â”‚
  â”‚  â”‚ â†’ Child Layout (náº¿u cÃ³ layout.js con)               â”‚    â”‚
  â”‚  â”‚ â†’ Page component (page.js)                          â”‚    â”‚
  â”‚  â”‚ â†’ Loading component (loading.js)                    â”‚    â”‚
  â”‚  â”‚ â†’ Error component (error.js)                        â”‚    â”‚
  â”‚  â”‚ â†’ Báº¥t ká»³ special file nÃ o applicable!               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CODE:                                                â”‚    â”‚
  â”‚  â”‚ export default function DashboardLayout({            â”‚    â”‚
  â”‚  â”‚   children,                                          â”‚    â”‚
  â”‚  â”‚ }: {                                                 â”‚    â”‚
  â”‚  â”‚   children: React.ReactNode                          â”‚    â”‚
  â”‚  â”‚ }) {                                                 â”‚    â”‚
  â”‚  â”‚   return <section>{children}</section>               â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  PROP 2: params (OPTIONAL!)                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Type: Promise<{ [key]: string }>                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âš ï¸ Tá»ª Next.js 15: params lÃ  PROMISE!               â”‚    â”‚
  â”‚  â”‚ â†’ Pháº£i dÃ¹ng async/await hoáº·c React.use()!           â”‚    â”‚
  â”‚  â”‚ â†’ v14 trá»Ÿ vá» trÆ°á»›c: params lÃ  synchronous           â”‚    â”‚
  â”‚  â”‚ â†’ v15 váº«n há»— trá»£ sync (deprecated!)                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Báº¢NG VÃ Dá»¤:                                         â”‚    â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
  â”‚  â”‚ â”‚ Route                   â”‚ URL       â”‚ params     â”‚â”‚   â”‚
  â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚   â”‚
  â”‚  â”‚ â”‚ app/dashboard/          â”‚ /dash/1   â”‚ Promise<   â”‚â”‚   â”‚
  â”‚  â”‚ â”‚   [team]/layout.js      â”‚           â”‚ {team:'1'} â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚ >          â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚            â”‚â”‚   â”‚
  â”‚  â”‚ â”‚ app/shop/[tag]/         â”‚ /shop/1/2 â”‚ Promise<   â”‚â”‚   â”‚
  â”‚  â”‚ â”‚   [item]/layout.js      â”‚           â”‚ {tag:'1',  â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚ item:'2'}> â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚            â”‚â”‚   â”‚
  â”‚  â”‚ â”‚ app/blog/               â”‚ /blog/1/2 â”‚ Promise<   â”‚â”‚   â”‚
  â”‚  â”‚ â”‚   [...slug]/layout.js   â”‚           â”‚ {slug:     â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚ ['1','2']} â”‚â”‚   â”‚
  â”‚  â”‚ â”‚                         â”‚           â”‚ >          â”‚â”‚   â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CODE:                                                â”‚    â”‚
  â”‚  â”‚ export default async function Layout({               â”‚    â”‚
  â”‚  â”‚   children,                                          â”‚    â”‚
  â”‚  â”‚   params,                                            â”‚    â”‚
  â”‚  â”‚ }: {                                                 â”‚    â”‚
  â”‚  â”‚   children: React.ReactNode                          â”‚    â”‚
  â”‚  â”‚   params: Promise<{ team: string }>                  â”‚    â”‚
  â”‚  â”‚ }) {                                                 â”‚    â”‚
  â”‚  â”‚   const { team } = await params  // â† AWAIT!       â”‚    â”‚
  â”‚  â”‚   return <h1>Team: {team}</h1>                       â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. LayoutProps Helper â€” Type-Safe Props!

```
  LAYOUTPROPS HELPER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: LayoutProps lÃ  globally available type helper!         â”‚
  â”‚  â†’ Tá»± Ä‘á»™ng infer TYPED params + named slots tá»«              â”‚
  â”‚    directory structure!                                      â”‚
  â”‚                                                              â”‚
  â”‚  CÃCH DÃ™NG:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ export default function Layout(                      â”‚    â”‚
  â”‚  â”‚   props: LayoutProps<'/dashboard'>                    â”‚    â”‚
  â”‚  â”‚ ) {                                                  â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <section>                                        â”‚    â”‚
  â”‚  â”‚       {props.children}                               â”‚    â”‚
  â”‚  â”‚       {/* Náº¿u cÃ³ app/dashboard/@analytics: */}       â”‚    â”‚
  â”‚  â”‚       {/* props.analytics â† typed slot! */}          â”‚    â”‚
  â”‚  â”‚     </section>                                       â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Äáº¶C ÄIá»‚M:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â€¢ Types tá»± generate khi: next dev, next build,      â”‚    â”‚
  â”‚  â”‚   hoáº·c next typegen                                  â”‚    â”‚
  â”‚  â”‚ â€¢ Globally available â†’ KHÃ”NG cáº§n import!            â”‚    â”‚
  â”‚  â”‚ â€¢ Infer params tá»« dynamic segments tá»± Ä‘á»™ng!         â”‚    â”‚
  â”‚  â”‚ â€¢ Infer @slot props tá»« parallel routes tá»± Ä‘á»™ng!     â”‚    â”‚
  â”‚  â”‚ â€¢ Type-safe â†’ IDE autocomplete + error checking!    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Root Layout â€” Layout Gá»‘c!

```
  ROOT LAYOUT â€” LAYOUT CAO NHáº¤T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Äá»ŠNH NGHÄ¨A: Root Layout = layout CAO NHáº¤T trong app/.       â”‚
  â”‚  ThÆ°á»ng lÃ  app/layout.js (hoáº·c .tsx)                         â”‚
  â”‚                                                              â”‚
  â”‚  YÃŠU Cáº¦U Báº®T BUá»˜C:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  PHáº¢I cÃ³ <html> tag!                               â”‚    â”‚
  â”‚  â”‚ â‘¡ PHáº¢I cÃ³ <body> tag!                               â”‚    â”‚
  â”‚  â”‚ â‘¢ App directory PHáº¢I cÃ³ ÃT NHáº¤T 1 root layout!     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CODE:                                                â”‚    â”‚
  â”‚  â”‚ export default function RootLayout({                 â”‚    â”‚
  â”‚  â”‚   children,                                          â”‚    â”‚
  â”‚  â”‚ }: {                                                 â”‚    â”‚
  â”‚  â”‚   children: React.ReactNode                          â”‚    â”‚
  â”‚  â”‚ }) {                                                 â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <html lang="en">    â† Báº®T BUá»˜C!               â”‚    â”‚
  â”‚  â”‚       <body>            â† Báº®T BUá»˜C!               â”‚    â”‚
  â”‚  â”‚         {children}                                   â”‚    â”‚
  â”‚  â”‚       </body>                                        â”‚    â”‚
  â”‚  â”‚     </html>                                          â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHÃ”NG NÃŠN LÃ€M:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âŒ KHÃ”NG thÃªm <head> tags báº±ng tay!                 â”‚    â”‚
  â”‚  â”‚   â†’ KhÃ´ng dÃ¹ng <title>...</title> trá»±c tiáº¿p!       â”‚    â”‚
  â”‚  â”‚   â†’ KhÃ´ng dÃ¹ng <meta .../> trá»±c tiáº¿p!              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… DÃ¹ng Metadata API thay tháº¿!                      â”‚    â”‚
  â”‚  â”‚   â†’ export const metadata = { title: '...' }       â”‚    â”‚
  â”‚  â”‚   â†’ export function generateMetadata() {}           â”‚    â”‚
  â”‚  â”‚   â†’ Metadata API auto: streaming + de-duplicating!  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  NHIá»€U ROOT LAYOUTS (Multiple Root Layouts!):                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CÃCH 1: DÃ¹ng Route Groups:                          â”‚    â”‚
  â”‚  â”‚ app/                                                 â”‚    â”‚
  â”‚  â”‚ â”œâ”€â”€ (shop)/                                          â”‚    â”‚
  â”‚  â”‚ â”‚   â””â”€â”€ layout.js    â† Root layout cho shop routes! â”‚   â”‚
  â”‚  â”‚ â”‚       (cÃ³ <html>, <body>)                          â”‚    â”‚
  â”‚  â”‚ â””â”€â”€ (marketing)/                                     â”‚    â”‚
  â”‚  â”‚     â””â”€â”€ layout.js    â† Root layout cho marketing!   â”‚    â”‚
  â”‚  â”‚         (cÃ³ <html>, <body>)                          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CÃCH 2: Bá» app/layout.js:                           â”‚    â”‚
  â”‚  â”‚ app/                                                 â”‚    â”‚
  â”‚  â”‚ â”œâ”€â”€ dashboard/                                       â”‚    â”‚
  â”‚  â”‚ â”‚   â””â”€â”€ layout.js  â† Trá»Ÿ thÃ nh root layout!        â”‚    â”‚
  â”‚  â”‚ â””â”€â”€ blog/                                            â”‚    â”‚
  â”‚  â”‚     â””â”€â”€ layout.js  â† Trá»Ÿ thÃ nh root layout!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âš ï¸ QUAN TRá»ŒNG: Navigate giá»¯a DIFFERENT root        â”‚    â”‚
  â”‚  â”‚ layouts â†’ FULL PAGE LOAD! (khÃ´ng pháº£i client-side!) â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Root layout dÆ°á»›i dynamic segment:                    â”‚    â”‚
  â”‚  â”‚ app/[lang]/layout.js â† cho internationalization!    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Caveats â€” Háº¡n Cháº¿ & HÃ nh Vi Äáº·c Biá»‡t!

```
  CAVEATS â€” 5 ÄIá»€U QUAN TRá»ŒNG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  âš ï¸ 1. LAYOUT KHÃ”NG RE-RENDER KHI NAVIGATE!                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Layouts CACHED trong client khi navigate           â”‚    â”‚
  â”‚  â”‚ â†’ TrÃ¡nh unnecessary server requests                  â”‚    â”‚
  â”‚  â”‚ â†’ State, event listeners... PRESERVED!               â”‚    â”‚
  â”‚  â”‚ â†’ CHá»ˆ children thay Ä‘á»•i (page.js má»›i)              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ ÄÃ‚Y LÃ€ INTENDED BEHAVIOR! (designed!)               â”‚    â”‚
  â”‚  â”‚ â†’ Next.js cá»‘ tÃ¬nh restrict layout access raw req    â”‚    â”‚
  â”‚  â”‚ â†’ TrÃ¡nh expensive user code cháº¡y trong layout       â”‚    â”‚
  â”‚  â”‚ â†’ â†’ Performance tá»‘t hÆ¡n!                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ 2. LAYOUT KHÃ”NG CÃ“ REQUEST OBJECT!                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ KHÃ”NG cÃ³ searchParams, KHÃ”NG cÃ³ pathname!         â”‚    â”‚
  â”‚  â”‚ â†’ VÃ¬ layout KHÃ”NG re-render â†’ data sáº½ STALE!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CÃCH TRUY Cáº¬P THAY THáº¾:                             â”‚    â”‚
  â”‚  â”‚ â†’ headers() + cookies() trong Server Components     â”‚    â”‚
  â”‚  â”‚   import { cookies } from 'next/headers'             â”‚    â”‚
  â”‚  â”‚   const cookieStore = await cookies()                â”‚    â”‚
  â”‚  â”‚   const theme = cookieStore.get('theme')             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ 3. LAYOUT KHÃ”NG CÃ“ searchParams!                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Layout KHÃ”NG re-render â†’ searchParams Sáº¼ STALE!   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ GIáº¢I PHÃP:                                           â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng Page searchParams prop (Page CÃ“ re-render!) â”‚    â”‚
  â”‚  â”‚ â†’ Hoáº·c dÃ¹ng useSearchParams() trong CLIENT Componentâ”‚    â”‚
  â”‚  â”‚   'use client'                                       â”‚    â”‚
  â”‚  â”‚   import { useSearchParams } from 'next/navigation'  â”‚    â”‚
  â”‚  â”‚   const searchParams = useSearchParams()             â”‚    â”‚
  â”‚  â”‚   const search = searchParams.get('search')          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Client Components CÃ“ re-render khi navigate!     â”‚    â”‚
  â”‚  â”‚ â†’ NÃªn data luÃ´n FRESH!                              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ 4. LAYOUT KHÃ”NG CÃ“ pathname!                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Layout KHÃ”NG re-render â†’ pathname Sáº¼ STALE!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ GIáº¢I PHÃP:                                           â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng usePathname() trong CLIENT Component!        â”‚    â”‚
  â”‚  â”‚   'use client'                                       â”‚    â”‚
  â”‚  â”‚   import { usePathname } from 'next/navigation'      â”‚    â”‚
  â”‚  â”‚   const pathname = usePathname()                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ USE CASE: Breadcrumbs!                               â”‚    â”‚
  â”‚  â”‚   const segments = pathname.split('/')               â”‚    â”‚
  â”‚  â”‚   // ['', 'dashboard', 'settings']                  â”‚    â”‚
  â”‚  â”‚   // â†’ Hiá»ƒn thá»‹ > dashboard > settings              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ 5. LAYOUT KHÃ”NG THá»‚ TRUYá»€N DATA XUá»NG CHILDREN!         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ KHÃ”NG thá»ƒ: layout fetch data â†’ pass qua props    â”‚    â”‚
  â”‚  â”‚ â†’ children prop = React.ReactNode (khÃ´ng pháº£i comp)â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ GIáº¢I PHÃP: Fetch data á»Ÿ Cáº¢ layout VÃ€ page!        â”‚    â”‚
  â”‚  â”‚ â†’ CÃ™NG fetch call â†’ Next.js AUTO DEDUPLICATE!      â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng React cache() hoáº·c Next.js fetch()          â”‚    â”‚
  â”‚  â”‚ â†’ Chá»‰ 1 request thá»±c sá»± Ä‘Æ°á»£c gá»­i!                  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Fetching Data + Accessing Child Segments!

```
  FETCHING DATA + CHILD SEGMENTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  FETCHING DATA TRONG LAYOUT:                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Layout CÃ“ THá»‚ fetch data (async layout!)         â”‚    â”‚
  â”‚  â”‚ â†’ NHÆ¯NG khÃ´ng thá»ƒ pass data xuá»‘ng children!        â”‚    â”‚
  â”‚  â”‚ â†’ Giáº£i phÃ¡p: fetch CÃ™NG data á»Ÿ cáº£ 2 nÆ¡i!         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CODE â€” Layout fetch user:                            â”‚    â”‚
  â”‚  â”‚ // lib/data.ts                                       â”‚    â”‚
  â”‚  â”‚ export async function getUser(id: string) {          â”‚    â”‚
  â”‚  â”‚   const res = await fetch(`https://.../users/${id}`) â”‚    â”‚
  â”‚  â”‚   return res.json()                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // layout.tsx â€” fetch user cho nav                   â”‚    â”‚
  â”‚  â”‚ import { getUser } from '@/app/lib/data'             â”‚    â”‚
  â”‚  â”‚ export default async function Layout({ children })   â”‚    â”‚
  â”‚  â”‚ {                                                    â”‚    â”‚
  â”‚  â”‚   const user = await getUser('1')                    â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <>                                               â”‚    â”‚
  â”‚  â”‚       <nav><UserName user={user.name} /></nav>       â”‚    â”‚
  â”‚  â”‚       {children}                                     â”‚    â”‚
  â”‚  â”‚     </>                                              â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // page.tsx â€” CÃ™NG fetch user!                       â”‚    â”‚
  â”‚  â”‚ import { getUser } from '@/app/lib/data'             â”‚    â”‚
  â”‚  â”‚ export default async function Page() {               â”‚    â”‚
  â”‚  â”‚   const user = await getUser('1') // â† DEDUPLICATED!â”‚    â”‚
  â”‚  â”‚   return <h1>Welcome {user.name}</h1>                â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ 2 láº§n gá»i getUser('1') â†’ ONLY 1 ACTUAL REQUEST! â”‚    â”‚
  â”‚  â”‚ â†’ Next.js auto deduplication with fetch()!          â”‚    â”‚
  â”‚  â”‚ â†’ Hoáº·c dÃ¹ng React cache() cho non-fetch calls!     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  ACCESSING CHILD SEGMENTS:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Layout KHÃ”NG biáº¿t child segments nÃ o Ä‘ang active! â”‚    â”‚
  â”‚  â”‚ â†’ VÃ¬ layout khÃ´ng re-render khi navigate!           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ GIáº¢I PHÃP: 2 hooks!                                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘  useSelectedLayoutSegment()                        â”‚    â”‚
  â”‚  â”‚   â†’ Tráº£ vá» segment CON TRá»°C TIáº¾P Ä‘ang active       â”‚    â”‚
  â”‚  â”‚   â†’ VÃ­ dá»¥: á»Ÿ /blog/hello â†’ tráº£ vá» 'hello'        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ useSelectedLayoutSegments()                       â”‚    â”‚
  â”‚  â”‚   â†’ Tráº£ vá» Táº¤T Cáº¢ segments con Ä‘ang active         â”‚    â”‚
  â”‚  â”‚   â†’ VÃ­ dá»¥: á»Ÿ /blog/a/b â†’ tráº£ vá» ['a', 'b']       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CODE â€” Active NavLink:                               â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ import { useSelectedLayoutSegment }                   â”‚    â”‚
  â”‚  â”‚   from 'next/navigation'                              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export default function NavLink({slug, children}) {  â”‚    â”‚
  â”‚  â”‚   const segment = useSelectedLayoutSegment()         â”‚    â”‚
  â”‚  â”‚   const isActive = slug === segment                  â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <Link href={`/blog/${slug}`}                     â”‚    â”‚
  â”‚  â”‚       style={{fontWeight: isActive ? 'bold':'normal'}}â”‚   â”‚
  â”‚  â”‚     >                                                â”‚    â”‚
  â”‚  â”‚       {children}                                     â”‚    â”‚
  â”‚  â”‚     </Link>                                          â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Examples â€” Metadata, Active Nav Links, Params!

```
  EXAMPLES Tá»ª DOCS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  EXAMPLE 1: METADATA                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ import type { Metadata } from 'next'                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export const metadata: Metadata = {                  â”‚    â”‚
  â”‚  â”‚   title: 'Next.js',                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export default function Layout({                     â”‚    â”‚
  â”‚  â”‚   children                                           â”‚    â”‚
  â”‚  â”‚ }: { children: React.ReactNode }) {                  â”‚    â”‚
  â”‚  â”‚   return '...'                                       â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Export metadata OBJECT hoáº·c generateMetadata()    â”‚    â”‚
  â”‚  â”‚ â†’ KHÃ”NG dÃ¹ng <title>, <meta> trá»±c tiáº¿p!           â”‚    â”‚
  â”‚  â”‚ â†’ Metadata API handle streaming + dedup!            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE 2: ACTIVE NAV LINKS                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // nav-links.tsx â€” CLIENT Component                  â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ import { usePathname } from 'next/navigation'        â”‚    â”‚
  â”‚  â”‚ import Link from 'next/link'                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export function NavLinks() {                         â”‚    â”‚
  â”‚  â”‚   const pathname = usePathname()                     â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <nav>                                            â”‚    â”‚
  â”‚  â”‚       <Link                                          â”‚    â”‚
  â”‚  â”‚         className={                                  â”‚    â”‚
  â”‚  â”‚           `link ${pathname === '/' ? 'active' : ''}`â”‚    â”‚
  â”‚  â”‚         }                                            â”‚    â”‚
  â”‚  â”‚         href="/"                                     â”‚    â”‚
  â”‚  â”‚       >Home</Link>                                   â”‚    â”‚
  â”‚  â”‚       <Link                                          â”‚    â”‚
  â”‚  â”‚         className={                                  â”‚    â”‚
  â”‚  â”‚           `link ${pathname === '/about'              â”‚    â”‚
  â”‚  â”‚             ? 'active' : ''}`                        â”‚    â”‚
  â”‚  â”‚         }                                            â”‚    â”‚
  â”‚  â”‚         href="/about"                                â”‚    â”‚
  â”‚  â”‚       >About</Link>                                  â”‚    â”‚
  â”‚  â”‚     </nav>                                           â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ // layout.tsx â€” Import Client Component              â”‚    â”‚
  â”‚  â”‚ import { NavLinks } from '@/app/ui/nav-links'        â”‚    â”‚
  â”‚  â”‚ export default function Layout({children}) {         â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <html lang="en">                                 â”‚    â”‚
  â”‚  â”‚       <body>                                         â”‚    â”‚
  â”‚  â”‚         <NavLinks /> â† Client! Re-renders!          â”‚    â”‚
  â”‚  â”‚         <main>{children}</main>                      â”‚    â”‚
  â”‚  â”‚       </body>                                        â”‚    â”‚
  â”‚  â”‚     </html>                                          â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ PATTERN: Layout = Server (no re-render)              â”‚    â”‚
  â”‚  â”‚          NavLinks = Client (re-renders on navigate!) â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE 3: DISPLAY CONTENT BASED ON PARAMS                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // app/dashboard/[team]/layout.tsx                    â”‚    â”‚
  â”‚  â”‚ export default async function DashboardLayout({      â”‚    â”‚
  â”‚  â”‚   children,                                          â”‚    â”‚
  â”‚  â”‚   params,                                            â”‚    â”‚
  â”‚  â”‚ }: {                                                 â”‚    â”‚
  â”‚  â”‚   children: React.ReactNode                          â”‚    â”‚
  â”‚  â”‚   params: Promise<{ team: string }>                  â”‚    â”‚
  â”‚  â”‚ }) {                                                 â”‚    â”‚
  â”‚  â”‚   const { team } = await params  â† MUST AWAIT!     â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <section>                                        â”‚    â”‚
  â”‚  â”‚       <header>                                       â”‚    â”‚
  â”‚  â”‚         <h1>Welcome to {team}'s Dashboard</h1>       â”‚    â”‚
  â”‚  â”‚       </header>                                      â”‚    â”‚
  â”‚  â”‚       <main>{children}</main>                        â”‚    â”‚
  â”‚  â”‚     </section>                                       â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE 4: READING PARAMS IN CLIENT COMPONENTS               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Client Components KHÃ”NG thá»ƒ async!                â”‚    â”‚
  â”‚  â”‚ â†’ DÃ¹ng React.use() thay vÃ¬ await!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ import { use } from 'react'                          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export default function Page({                       â”‚    â”‚
  â”‚  â”‚   params,                                            â”‚    â”‚
  â”‚  â”‚ }: {                                                 â”‚    â”‚
  â”‚  â”‚   params: Promise<{ slug: string }>                  â”‚    â”‚
  â”‚  â”‚ }) {                                                 â”‚    â”‚
  â”‚  â”‚   const { slug } = use(params) â† React.use()!      â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ async/await â†’ Server Components                     â”‚    â”‚
  â”‚  â”‚ React.use() â†’ Client Components                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. SÆ¡ Äá»“ Tá»± Váº½ â€” Tá»•ng Há»£p!

> **Trang docs gá»‘c KHÃ”NG cÃ³ diagram/hÃ¬nh áº£nh nÃ o (0 images).**
> CÃ¡c sÆ¡ Ä‘á»“ dÆ°á»›i Ä‘Ã¢y hoÃ n toÃ n tá»± váº½!

### SÆ¡ Äá»“ 1: Nested Layouts â€” Luá»“ng Render

```
  NESTED LAYOUTS â€” RENDER FLOW:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  URL: /dashboard/settings/profile                            â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€ app/layout.js (Root Layout) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ <html>                                             â”‚      â”‚
  â”‚  â”‚ <body>                                             â”‚      â”‚
  â”‚  â”‚   <GlobalNav />  â† KHÃ”NG re-render!               â”‚      â”‚
  â”‚  â”‚                                                    â”‚      â”‚
  â”‚  â”‚   â”Œâ”€â”€â”€ app/dashboard/layout.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚      â”‚
  â”‚  â”‚   â”‚ <Sidebar />  â† KHÃ”NG re-render!            â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚                                             â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”Œâ”€â”€â”€ app/dashboard/settings/layout.js â”  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚ <SettingsTabs /> â† KHÃ”NG re-render! â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚                                      â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚   â”Œâ”€â”€â”€ children â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚   â”‚ profile/page.js              â”‚  â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚   â”‚ (CHá»ˆ PHáº¦N NÃ€Y thay Ä‘á»•i!)    â”‚  â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â”‚                                      â”‚  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚      â”‚
  â”‚  â”‚   â”‚                                             â”‚  â”‚      â”‚
  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚      â”‚
  â”‚  â”‚                                                    â”‚      â”‚
  â”‚  â”‚ </body>                                            â”‚      â”‚
  â”‚  â”‚ </html>                                            â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  Navigate: /dashboard/settings/profile                       â”‚
  â”‚         â†’ /dashboard/settings/security                       â”‚
  â”‚                                                              â”‚
  â”‚  Káº¾T QUáº¢:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Root Layout     â†’ GIá»® NGUYÃŠN âœ… (no re-render)     â”‚    â”‚
  â”‚  â”‚ Dashboard Layout â†’ GIá»® NGUYÃŠN âœ… (Sidebar kept!)   â”‚    â”‚
  â”‚  â”‚ Settings Layout  â†’ GIá»® NGUYÃŠN âœ… (Tabs kept!)      â”‚    â”‚
  â”‚  â”‚ Page (children)  â†’ THAY Äá»”I! ğŸ”„ (security page!)  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 2: Layout KhÃ´ng Re-render â€” Data Flow

```
  LAYOUT DATA ACCESS RESTRICTIONS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€ layout.js (Server Component, NO re-render!) â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚                                                     â”‚     â”‚
  â”‚  â”‚  âŒ searchParams  â†’ sáº½ STALE!                      â”‚     â”‚
  â”‚  â”‚  âŒ pathname      â†’ sáº½ STALE!                      â”‚     â”‚
  â”‚  â”‚  âŒ request obj   â†’ bá»‹ blocked!                    â”‚     â”‚
  â”‚  â”‚  âŒ pass data â†’ children  â†’ impossible!            â”‚     â”‚
  â”‚  â”‚                                                     â”‚     â”‚
  â”‚  â”‚  âœ… params (dynamic route)                          â”‚     â”‚
  â”‚  â”‚  âœ… cookies() (server-side)                         â”‚     â”‚
  â”‚  â”‚  âœ… headers() (server-side)                         â”‚     â”‚
  â”‚  â”‚  âœ… fetch data (with dedup!)                        â”‚     â”‚
  â”‚  â”‚                                                     â”‚     â”‚
  â”‚  â”‚  â”Œâ”€â”€ Client Component (CÃ“ re-render!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
  â”‚  â”‚  â”‚                                               â”‚  â”‚     â”‚
  â”‚  â”‚  â”‚  âœ… useSearchParams()  â†’ FRESH data!         â”‚  â”‚     â”‚
  â”‚  â”‚  â”‚  âœ… usePathname()      â†’ FRESH pathname!     â”‚  â”‚     â”‚
  â”‚  â”‚  â”‚  âœ… useSelectedLayoutSegment() â†’ FRESH!      â”‚  â”‚     â”‚
  â”‚  â”‚  â”‚                                               â”‚  â”‚     â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
  â”‚  â”‚                                                     â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â”‚  PATTERN: Layout (Server) â†’ chá»©a Client Components          â”‚
  â”‚  â†’ Layout khÃ´ng re-render nhÆ°ng Client bÃªn trong CÃ“!       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Äá»“ 3: Multiple Root Layouts

```
  MULTIPLE ROOT LAYOUTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  CÃCH 1: Route Groups                                        â”‚
  â”‚                                                              â”‚
  â”‚  app/                                                        â”‚
  â”‚  â”œâ”€â”€ (shop)/                    â† Route Group (no URL!)     â”‚
  â”‚  â”‚   â”œâ”€â”€ layout.js             â† Root Layout #1! <html>    â”‚
  â”‚  â”‚   â”œâ”€â”€ page.js               â†’ /                          â”‚
  â”‚  â”‚   â””â”€â”€ products/                                           â”‚
  â”‚  â”‚       â””â”€â”€ page.js           â†’ /products                  â”‚
  â”‚  â””â”€â”€ (marketing)/              â† Route Group (no URL!)     â”‚
  â”‚      â”œâ”€â”€ layout.js             â† Root Layout #2! <html>    â”‚
  â”‚      â”œâ”€â”€ page.js               â†’ /                          â”‚
  â”‚      â””â”€â”€ about/                                              â”‚
  â”‚          â””â”€â”€ page.js           â†’ /about                     â”‚
  â”‚                                                              â”‚
  â”‚  /products â†’ /about =                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âš ï¸ FULL PAGE LOAD! (different root layouts!)        â”‚    â”‚
  â”‚  â”‚ â†’ HoÃ n toÃ n re-mount! State máº¥t háº¿t!               â”‚    â”‚
  â”‚  â”‚ â†’ KHÃ”NG pháº£i client-side navigation!                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  /products â†’ /products/[id] =                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âœ… Client-side navigation! (same root layout!)      â”‚    â”‚
  â”‚  â”‚ â†’ Smooth! Layout preserved!                         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Tá»± Viáº¿t â€” LayoutEngine!

```javascript
/**
 * LayoutEngine â€” MÃ´ phá»ng Next.js Layout System!
 * Tá»± viáº¿t báº±ng tay, KHÃ”NG dÃ¹ng thÆ° viá»‡n nÃ o!
 * Covers: nesting, state preservation, data access rules,
 *         params resolution, child segment detection
 */
var LayoutEngine = (function () {

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. NESTED LAYOUT RESOLVER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function resolveLayoutChain(url) {
    var segments = url.split('/').filter(function (s) { return s !== ''; });
    var chain = [];

    // Root layout luÃ´n cÃ³
    chain.push({
      level: 0,
      file: 'app/layout.js',
      type: 'ROOT',
      hasHtml: true,
      hasBody: true,
      reRendersOnNav: false
    });

    var currentPath = 'app';
    for (var i = 0; i < segments.length; i++) {
      currentPath += '/' + segments[i];
      var isLast = i === segments.length - 1;

      chain.push({
        level: i + 1,
        file: currentPath + (isLast ? '/page.js' : '/layout.js'),
        type: isLast ? 'PAGE' : 'LAYOUT',
        segment: segments[i],
        reRendersOnNav: isLast
      });
    }

    return {
      url: url,
      chain: chain,
      totalLayouts: chain.length - 1,
      note: 'CHá»ˆ page.js (cuá»‘i) re-render khi navigate! Layouts PRESERVED!'
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. DATA ACCESS CHECKER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function checkDataAccess(componentType) {
    if (componentType === 'layout') {
      return {
        componentType: 'layout.js (Server Component)',
        reRendersOnNav: false,
        access: {
          children: { available: true, note: 'REQUIRED prop, React.ReactNode' },
          params: { available: true, note: 'Promise<{...}> â€” pháº£i await!' },
          searchParams: { available: false,
            reason: 'Layout khÃ´ng re-render â†’ searchParams sáº½ STALE!' },
          pathname: { available: false,
            reason: 'Layout khÃ´ng re-render â†’ pathname sáº½ STALE!' },
          requestObject: { available: false,
            reason: 'Next.js blocks access Ä‘á»ƒ ensure performance!' },
          cookies: { available: true, note: 'import { cookies } from "next/headers"' },
          headers: { available: true, note: 'import { headers } from "next/headers"' },
          fetchData: { available: true, note: 'async layout â†’ auto dedup with fetch()!' }
        },
        solution: 'DÃ¹ng Client Components bÃªn trong layout cho dynamic data!'
      };
    }

    if (componentType === 'page') {
      return {
        componentType: 'page.js (Server Component)',
        reRendersOnNav: true,
        access: {
          params: { available: true },
          searchParams: { available: true, note: 'FRESH trÃªn má»—i navigation!' },
          cookies: { available: true },
          headers: { available: true },
          fetchData: { available: true }
        }
      };
    }

    return {
      componentType: 'Client Component (use client)',
      reRendersOnNav: true,
      access: {
        useSearchParams: { available: true, note: 'FRESH!' },
        usePathname: { available: true, note: 'FRESH!' },
        useSelectedLayoutSegment: { available: true },
        useSelectedLayoutSegments: { available: true },
        params: { available: true, note: 'DÃ¹ng React.use(params) thay vÃ¬ await!' }
      }
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. PARAMS RESOLVER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function resolveParams(routePattern, actualUrl) {
    var patternParts = routePattern.split('/').filter(function (s) { return s !== ''; });
    var urlParts = actualUrl.split('/').filter(function (s) { return s !== ''; });
    var params = {};

    for (var i = 0; i < patternParts.length; i++) {
      var part = patternParts[i];
      if (part.match(/^\[\.\.\.(\w+)\]$/)) {
        // Catch-all: [...slug]
        var key = part.replace('[...', '').replace(']', '');
        params[key] = urlParts.slice(i);
        break;
      } else if (part.match(/^\[(\w+)\]$/)) {
        // Dynamic: [id]
        var paramKey = part.replace('[', '').replace(']', '');
        params[paramKey] = urlParts[i] || '';
      }
    }

    return {
      routePattern: routePattern,
      actualUrl: actualUrl,
      params: params,
      note: 'Trong Next.js 15: params lÃ  Promise! Pháº£i await!'
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. NAVIGATION SIMULATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateNavigation(fromUrl, toUrl) {
    var fromParts = fromUrl.split('/').filter(function (s) { return s !== ''; });
    var toParts = toUrl.split('/').filter(function (s) { return s !== ''; });

    var commonDepth = 0;
    for (var i = 0; i < Math.min(fromParts.length, toParts.length); i++) {
      if (fromParts[i] === toParts[i]) {
        commonDepth++;
      } else {
        break;
      }
    }

    var preserved = [];
    var reRendered = [];

    preserved.push('app/layout.js (Root Layout)');
    for (var j = 0; j < commonDepth; j++) {
      preserved.push('app/' + fromParts.slice(0, j + 1).join('/') + '/layout.js');
    }

    for (var k = commonDepth; k < toParts.length; k++) {
      var isLast = k === toParts.length - 1;
      reRendered.push(
        'app/' + toParts.slice(0, k + 1).join('/')
        + (isLast ? '/page.js' : '/layout.js')
      );
    }

    return {
      from: fromUrl,
      to: toUrl,
      commonDepth: commonDepth,
      preserved: preserved,
      reRendered: reRendered,
      navigationType: commonDepth > 0 ? 'Client-side (partial)' : 'Full page load',
      note: 'Layouts cho shared segments PRESERVED! Chá»‰ children thay Ä‘á»•i!'
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  LAYOUT ENGINE â€” DEMO                     â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    // 1. Layout Chain
    console.log('\nâ”€â”€â”€ 1. LAYOUT CHAIN â”€â”€â”€');
    console.log(JSON.stringify(
      resolveLayoutChain('/dashboard/settings/profile'), null, 2));

    // 2. Data Access
    console.log('\nâ”€â”€â”€ 2. DATA ACCESS â”€â”€â”€');
    console.log('Layout:', JSON.stringify(
      checkDataAccess('layout'), null, 2));
    console.log('Client:', JSON.stringify(
      checkDataAccess('client'), null, 2));

    // 3. Params
    console.log('\nâ”€â”€â”€ 3. PARAMS RESOLVER â”€â”€â”€');
    console.log(JSON.stringify(
      resolveParams('/shop/[tag]/[item]', '/shop/electronics/phone'), null, 2));
    console.log(JSON.stringify(
      resolveParams('/blog/[...slug]', '/blog/2024/01/hello'), null, 2));

    // 4. Navigation
    console.log('\nâ”€â”€â”€ 4. NAVIGATION SIM â”€â”€â”€');
    console.log(JSON.stringify(
      simulateNavigation('/dashboard/settings/profile',
                         '/dashboard/settings/security'), null, 2));
    console.log(JSON.stringify(
      simulateNavigation('/dashboard/settings',
                         '/blog/hello'), null, 2));

    console.log('\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
    console.log('â•‘  âœ… Demo Complete!                         â•‘');
    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  }

  return {
    resolveLayoutChain: resolveLayoutChain,
    checkDataAccess: checkDataAccess,
    resolveParams: resolveParams,
    simulateNavigation: simulateNavigation,
    demo: demo
  };
})();

// Cháº¡y: LayoutEngine.demo();
```

---

## Â§10. CÃ¢u Há»i Luyá»‡n Táº­p!

### â“ CÃ¢u 1: Layout cÃ³ re-render khi navigate giá»¯a cÃ¡c trang con khÃ´ng?

**Tráº£ lá»i:**

**KHÃ”NG!** Layout KHÃ”NG re-render khi navigate â†’ Ä‘Ã¢y lÃ  **core behavior** quan trá»ng nháº¥t.

- State, event listeners, animations... **PRESERVED!**
- CHá»ˆ `children` (page.js) thay Ä‘á»•i
- Layout Ä‘Æ°á»£c cache á»Ÿ client â†’ trÃ¡nh unnecessary server requests
- ÄÃ¢y lÃ  **intended design** Ä‘á»ƒ optimize performance!

### â“ CÃ¢u 2: Táº¡i sao layout khÃ´ng cÃ³ searchParams?

**Tráº£ lá»i:**

VÃ¬ layout **KHÃ”NG re-render** khi navigate â†’ náº¿u cÃ³ searchParams thÃ¬ data sáº½ **STALE** (cÅ©)!

**Giáº£i phÃ¡p:**
| CÃ¡ch | Component type | Hook/Prop |
|---|---|---|
| Page | Server Component | `searchParams` prop (fresh!) |
| Client Component | Client (`'use client'`) | `useSearchParams()` hook |

Client Components CÃ“ re-render â†’ data luÃ´n FRESH!

### â“ CÃ¢u 3: Root Layout báº¯t buá»™c cÃ³ gÃ¬?

**Tráº£ lá»i:**

**2 tháº» Báº®T BUá»˜C:**
- `<html>` tag
- `<body>` tag

**KHÃ”NG NÃŠN:**
- âŒ ThÃªm `<head>`, `<title>`, `<meta>` báº±ng tay
- âœ… DÃ¹ng **Metadata API** (auto streaming + dedup!)

### â“ CÃ¢u 4: Layout cÃ³ thá»ƒ pass data xuá»‘ng children khÃ´ng?

**Tráº£ lá»i:**

**KHÃ”NG!** Layout khÃ´ng thá»ƒ truyá»n data xuá»‘ng children qua props.

- `children` = `React.ReactNode` (khÃ´ng pháº£i component trá»±c tiáº¿p)
- **Giáº£i phÃ¡p**: Fetch **CÃ™NG data** á»Ÿ cáº£ layout vÃ  page
- Next.js **auto deduplication** â†’ chá»‰ 1 request thá»±c sá»±!
- DÃ¹ng `fetch()` (auto dedup) hoáº·c `React.cache()` (manual dedup)

### â“ CÃ¢u 5: Sá»± khÃ¡c biá»‡t giá»¯a async/await vÃ  React.use() cho params?

**Tráº£ lá»i:**

| Method | DÃ¹ng á»Ÿ | LÃ½ do |
|---|---|---|
| `await params` | **Server** Components | Server Components CÃ“ THá»‚ async! |
| `use(params)` | **Client** Components | Client Components KHÃ”NG thá»ƒ async! |

```javascript
// Server Component
export default async function Layout({ params }) {
  const { team } = await params // â† await!
}

// Client Component
'use client'
import { use } from 'react'
export default function Page({ params }) {
  const { slug } = use(params)  // â† React.use()!
}
```

### â“ CÃ¢u 6: Navigate giá»¯a 2 root layouts khÃ¡c nhau thÃ¬ sao?

**Tráº£ lá»i:**

**FULL PAGE LOAD!** KhÃ´ng pháº£i client-side navigation!

- State máº¥t háº¿t (toÃ n bá»™ re-mount!)
- Giá»‘ng refresh trang â†’ `<html>`, `<body>` má»›i hoÃ n toÃ n
- Xáº£y ra khi: navigate giá»¯a `(shop)/layout.js` â†” `(marketing)/layout.js`

---

> ğŸ¯ **Tá»•ng káº¿t**: Guide phÃ¢n tÃ­ch TOÃ€N Bá»˜ trang `layout.js`:
> - **0 hÃ¬nh áº£nh** trong trang gá»‘c (chá»‰ text + code blocks)
> - **3 sÆ¡ Ä‘á»“ tá»± váº½**: nested layout render chain, data access restrictions, multiple root layouts
> - **LayoutEngine** tá»± viáº¿t vá»›i 4 functions mÃ´ phá»ng (chain, data access, params, navigation)
> - **6 cÃ¢u há»i luyá»‡n táº­p** vá»›i Ä‘Ã¡p Ã¡n chi tiáº¿t
> - **Version History**: v13.0.0 (layout introduced), v15.0.0-RC (params â†’ Promise)
