# Frontend Caching Architecture â€” Deep Dive!

> **Kiáº¿n trÃºc cache toÃ n trÃ¬nh: Onion Model!**
> Memory â†’ Service Worker â†’ HTTP Cache â†’ Network!

---

## Â§1. Onion Model â€” Kiáº¿n TrÃºc PhÃ¢n Táº§ng!

```
  ONION MODEL â€” MÃ” HÃŒNH HÃ€NH TÃ‚Y:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  "Request tá»‘t nháº¥t = request KHÃ”NG Cáº¦N Gá»¬I!" â˜…             â”‚
  â”‚                                                              â”‚
  â”‚  Request Ä‘i qua tá»«ng lá»›p â†’ chá»‰ Ä‘áº¿n server khi THáº¬T Cáº¦N!  â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ L1: MEMORY CACHE (RAM!) â˜…â˜…â˜… NHANH NHáº¤T!            â”‚     â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
  â”‚  â”‚ â”‚ L2: SERVICE WORKER (Programmable!) â˜…â˜…        â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”‚ L3: HTTP DISK CACHE (Browser!) â˜…    â”‚     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ L4: NETWORK (Server!) ğŸ¢   â”‚     â”‚     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”‚ â”‚ CDN â†’ Origin Server         â”‚     â”‚     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚     â”‚     â”‚
  â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚     â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Táº§ng    â”‚ Keyword      â”‚ Tá»‘c Ä‘á»™      â”‚ Thá»i gian  â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ L1 Memoryâ”‚ Variable/Map â”‚ ğŸš€ ns       â”‚ Page close  â”‚   â”‚
  â”‚  â”‚ L2 SW    â”‚ Programmable â”‚ âš¡ï¸ ms        â”‚ Persistent  â”‚   â”‚
  â”‚  â”‚ L3 HTTP  â”‚ Cache-Controlâ”‚ âš¡ï¸ ms        â”‚ Header qÄ‘ â”‚   â”‚
  â”‚  â”‚ L4 Net   â”‚ CDN/Server   â”‚ ğŸ¢ 100ms+    â”‚ N/A         â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                              â”‚
  â”‚  FLOW:                                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Request                                              â”‚    â”‚
  â”‚  â”‚    â”‚                                                  â”‚    â”‚
  â”‚  â”‚    â”œâ”€â‘ â†’ Memory cache? â”€â”€â”€ HIT â†’ â˜… Return (0ms!)     â”‚    â”‚
  â”‚  â”‚    â”‚                  â””â”€â”€ MISS â†“                      â”‚    â”‚
  â”‚  â”‚    â”œâ”€â‘¡â†’ Service Worker? â”€â”€ HIT â†’ â˜… Return (~5ms!)   â”‚    â”‚
  â”‚  â”‚    â”‚                  â””â”€â”€ MISS â†“                      â”‚    â”‚
  â”‚  â”‚    â”œâ”€â‘¢â†’ HTTP Cache? â”€â”€â”€â”€â”€â”€ HIT â†’ â˜… Return (~10ms!)  â”‚    â”‚
  â”‚  â”‚    â”‚                  â””â”€â”€ MISS â†“                      â”‚    â”‚
  â”‚  â”‚    â””â”€â‘£â†’ Network! â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Return (~200ms+!) ğŸ¢  â”‚    â”‚
  â”‚  â”‚         â”‚                                             â”‚    â”‚
  â”‚  â”‚         â””â†’ Response Ä‘i ngÆ°á»£c láº¡i, Cáº¬P NHáº¬T cache!   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Browser Storage â€” So SÃ¡nh!

```
  BROWSER STORAGE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚           â”‚ Memory   â”‚ Local    â”‚ Session  â”‚ IndexedDBâ”‚  â”‚
  â”‚  â”‚           â”‚ (Map)    â”‚ Storage  â”‚ Storage  â”‚          â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Dung lÆ°á»£ngâ”‚ RAM â˜…    â”‚ ~5MB     â”‚ ~5MB     â”‚ >250MB â˜…â”‚  â”‚
  â”‚  â”‚ Tá»‘c Ä‘á»™  â”‚ ğŸš€ ns    â”‚ ğŸ¢ sync â”‚ ğŸ¢ sync â”‚ âš¡ï¸ asyncâ”‚  â”‚
  â”‚  â”‚ VÃ²ng Ä‘á»iâ”‚ Refresh=0â”‚ VÄ©nh viá»…nâ”‚ Tab closeâ”‚ VÄ©nh viá»…nâ”‚  â”‚
  â”‚  â”‚ Kiá»ƒu DL â”‚ Any JS â˜… â”‚ String   â”‚ String   â”‚ Struct â˜… â”‚  â”‚
  â”‚  â”‚ PhÃ¹ há»£pâ”‚ Táº¡m thá»iâ”‚ Settings â”‚ Form draftâ”‚ Big data â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚  â”‚ â˜… Nhá»›: Cookie chá»‰ 4KB, Gá»¬I Má»–I REQUEST! âŒ     â”‚       â”‚
  â”‚  â”‚ â˜… localStorage: SYNC blocking! KhÃ´ng dÃ¹ng cho   â”‚       â”‚
  â”‚  â”‚   data lá»›n hoáº·c Ä‘á»c/ghi thÆ°á»ng xuyÃªn!           â”‚       â”‚
  â”‚  â”‚ â˜… IndexedDB: ASYNC, structured, lá»›n â†’ tá»‘t nháº¥t â”‚       â”‚
  â”‚  â”‚   cho offline data!                                â”‚       â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. HTTP Cache â€” Strong vs Conditional!

```
  HTTP CACHE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  STRONG CACHE (khÃ´ng há»i server!):                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Browser â”€â”€â†’ Cache HIT? â”€â”€YESâ”€â”€â†’ Return! (200 from  â”‚    â”‚
  â”‚  â”‚                                     disk/memory!) â˜…  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  Headers:                                              â”‚    â”‚
  â”‚  â”‚  Cache-Control: max-age=31536000, immutable â˜…          â”‚    â”‚
  â”‚  â”‚  â†’ 1 nÄƒm! KhÃ´ng há»i server! â˜…                        â”‚    â”‚
  â”‚  â”‚  â†’ immutable: KHÃ”NG gá»­i conditional request! â˜…        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â˜… DÃ¹ng cho: JS/CSS/Image/Font cÃ³ HASH! â˜…             â”‚    â”‚
  â”‚  â”‚  â†’ app.a1b2c3.js â†’ Ä‘á»•i code = Ä‘á»•i hash = URL má»›i!  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CONDITIONAL CACHE (há»i server "cÃ³ má»›i khÃ´ng?"):            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Browser â”€â”€â†’ Cache expired? â”€â”€YESâ”€â”€â†’ Há»i server!     â”‚    â”‚
  â”‚  â”‚                                       â”‚               â”‚    â”‚
  â”‚  â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
  â”‚  â”‚                          â”‚                      â”‚     â”‚    â”‚
  â”‚  â”‚                     304 Not Modified!      200 + New! â”‚    â”‚
  â”‚  â”‚                     â†’ DÃ¹ng cache! â˜…    â†’ Download!   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  Headers:                                              â”‚    â”‚
  â”‚  â”‚  ETag: "abc123" â†’ If-None-Match: "abc123"              â”‚    â”‚
  â”‚  â”‚  Last-Modified: Mon... â†’ If-Modified-Since: Mon...     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â˜… DÃ¹ng cho: HTML, API data! â˜…                        â”‚    â”‚
  â”‚  â”‚  â†’ no-cache = LUÃ”N há»i server!                       â”‚    â”‚
  â”‚  â”‚  â†’ no-store = KHÃ”NG cache gÃ¬ háº¿t! (sensitive data!)  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CACHE STRATEGY CHEAT SHEET:                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
  â”‚  â”‚ Resource          â”‚ Header                        â”‚       â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
  â”‚  â”‚ HTML              â”‚ no-cache â˜… (luÃ´n verify!)    â”‚       â”‚
  â”‚  â”‚ JS/CSS (hashed)   â”‚ max-age=31536000, immutable â˜…â”‚       â”‚
  â”‚  â”‚ API (public)      â”‚ max-age=60                    â”‚       â”‚
  â”‚  â”‚ API (private)     â”‚ private, max-age=60 â˜…        â”‚       â”‚
  â”‚  â”‚ Sensitive data    â”‚ no-store â˜… (khÃ´ng cache!)    â”‚       â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Memory Cache â€” Tá»± Viáº¿t!

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T: Memory Cache vá»›i TTL!
// â˜… KhÃ´ng dÃ¹ng thÆ° viá»‡n! O(1) lookup!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function MemoryCache(options) {
  this.cache = {};
  this.maxSize = (options && options.maxSize) || 100;
  this.defaultTTL = (options && options.defaultTTL) || 5000; // 5s
  this.size = 0;
  this.hits = 0;
  this.misses = 0;
}

// â˜… SET: lÆ°u data + timestamp + TTL!
MemoryCache.prototype.set = function (key, data, ttl) {
  ttl = ttl || this.defaultTTL;

  // Evict náº¿u Ä‘áº§y! (LRU Ä‘Æ¡n giáº£n: xÃ³a cÅ© nháº¥t!)
  if (!this.cache[key] && this.size >= this.maxSize) {
    this._evictOldest();
  }

  if (!this.cache[key]) this.size++;

  this.cache[key] = {
    data: data,
    timestamp: Date.now(),
    ttl: ttl,
    accessTime: Date.now(),
  };
};

// â˜… GET: kiá»ƒm tra TTL trÆ°á»›c khi tráº£!
MemoryCache.prototype.get = function (key) {
  var entry = this.cache[key];

  if (!entry) {
    this.misses++;
    return null; // MISS!
  }

  // Háº¿t háº¡n?
  if (Date.now() - entry.timestamp > entry.ttl) {
    delete this.cache[key];
    this.size--;
    this.misses++;
    return null; // EXPIRED!
  }

  // HIT!
  entry.accessTime = Date.now(); // Update access time!
  this.hits++;
  return entry.data;
};

// â˜… XÃ³a entry cÅ© nháº¥t (LRU!)
MemoryCache.prototype._evictOldest = function () {
  var oldestKey = null;
  var oldestTime = Infinity;

  for (var key in this.cache) {
    if (this.cache[key].accessTime < oldestTime) {
      oldestTime = this.cache[key].accessTime;
      oldestKey = key;
    }
  }

  if (oldestKey) {
    delete this.cache[oldestKey];
    this.size--;
  }
};

// â˜… Hit rate monitoring!
MemoryCache.prototype.getStats = function () {
  var total = this.hits + this.misses;
  return {
    hits: this.hits,
    misses: this.misses,
    hitRate: total > 0 ? Math.round((this.hits / total) * 100) + "%" : "0%",
    size: this.size,
  };
};

MemoryCache.prototype.clear = function () {
  this.cache = {};
  this.size = 0;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T: fetchWithCache â€” API cache layer!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var apiCache = new MemoryCache({ maxSize: 200, defaultTTL: 10000 });

function fetchWithCache(url, options) {
  var ttl = (options && options.ttl) || 5000;
  var forceRefresh = options && options.forceRefresh;

  // â‘  Check cache!
  if (!forceRefresh) {
    var cached = apiCache.get(url);
    if (cached) {
      console.log("âš¡ï¸ Cache HIT:", url);
      return Promise.resolve(cached);
    }
  }

  // â‘¡ Cache MISS â†’ fetch!
  console.log("ğŸ“¡ Network request:", url);
  return fetch(url)
    .then(function (res) {
      return res.json();
    })
    .then(function (data) {
      apiCache.set(url, data, ttl); // â‘¢ LÆ°u cache!
      return data;
    });
}

// Sá»¬ Dá»¤NG:
// fetchWithCache('/api/products', { ttl: 10000 })
//   .then(data => renderProducts(data));
// â†’ Láº§n 2 gá»i cÃ¹ng URL â†’ tráº£ tá»« memory! âš¡ï¸
```

---

## Â§5. Service Worker Cache!

```
  SERVICE WORKER CACHE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  CACHE STRATEGIES:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â‘  CACHE FIRST (Offline-first!) â˜…                     â”‚    â”‚
  â”‚  â”‚  Request â†’ Cache? â”€HITâ†’ Return cache!                 â”‚    â”‚
  â”‚  â”‚                   â””MISSâ†’ Network â†’ Return + Cache!    â”‚    â”‚
  â”‚  â”‚  â†’ DÃ¹ng cho: App Shell, static assets! â˜…              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â‘¡ NETWORK FIRST (Fresh-first!)                        â”‚    â”‚
  â”‚  â”‚  Request â†’ Network? â”€OKâ†’ Return + Update cache!       â”‚    â”‚
  â”‚  â”‚                     â””FAILâ†’ Return cache! (fallback!)  â”‚    â”‚
  â”‚  â”‚  â†’ DÃ¹ng cho: API data, dynamic content! â˜…             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â‘¢ STALE-WHILE-REVALIDATE â˜…â˜…â˜… (tá»‘t nháº¥t!)            â”‚    â”‚
  â”‚  â”‚  Request â†’ Cache? â”€HITâ†’ Return cache NGAY!            â”‚    â”‚
  â”‚  â”‚                   â”‚     + Fetch má»›i â†’ update cache!   â”‚    â”‚
  â”‚  â”‚                   â””MISSâ†’ Network â†’ Return + Cache!    â”‚    â”‚
  â”‚  â”‚  â†’ User tháº¥y data CÅ¨ ngay â†’ data Má»šI láº§n sau! â˜…     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â‘£ CACHE ONLY (Pure offline!)                           â”‚    â”‚
  â”‚  â”‚  Request â†’ Return cache! (khÃ´ng bao giá» network!)     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â‘¤ NETWORK ONLY (Pure network!)                        â”‚    â”‚
  â”‚  â”‚  Request â†’ Network! (khÃ´ng bao giá» cache!)            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T: Service Worker vá»›i nhiá»u strategies!
// â˜… KhÃ´ng dÃ¹ng Workbox! Viáº¿t tá»« Ä‘áº§u!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var CACHE_NAME = "app-cache-v1";
var STATIC_ASSETS = ["/", "/index.html", "/styles.css", "/app.js"];

// â˜… INSTALL: Pre-cache static assets!
self.addEventListener("install", function (event) {
  event.waitUntil(
    caches.open(CACHE_NAME).then(function (cache) {
      console.log("[SW] Pre-caching static assets!");
      return cache.addAll(STATIC_ASSETS);
    }),
  );
  self.skipWaiting(); // Activate ngay!
});

// â˜… ACTIVATE: XÃ³a cache cÅ©!
self.addEventListener("activate", function (event) {
  event.waitUntil(
    caches.keys().then(function (keys) {
      return Promise.all(
        keys
          .filter(function (key) {
            return key !== CACHE_NAME;
          })
          .map(function (key) {
            console.log("[SW] Deleting old cache:", key);
            return caches.delete(key);
          }),
      );
    }),
  );
  self.clients.claim(); // Kiá»ƒm soÃ¡t táº¥t cáº£ tabs!
});

// â˜… FETCH: Route requests to strategies!
self.addEventListener("fetch", function (event) {
  var url = new URL(event.request.url);

  if (url.pathname.startsWith("/api/")) {
    // API â†’ Stale-While-Revalidate! â˜…
    event.respondWith(staleWhileRevalidate(event.request));
  } else if (event.request.destination === "image") {
    // Images â†’ Cache First! â˜…
    event.respondWith(cacheFirst(event.request));
  } else {
    // HTML/CSS/JS â†’ Network First! â˜…
    event.respondWith(networkFirst(event.request));
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STRATEGY 1: Cache First!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cacheFirst(request) {
  return caches.match(request).then(function (cached) {
    if (cached) return cached; // â˜… HIT â†’ tráº£ ngay!

    return fetch(request).then(function (response) {
      if (response.ok) {
        var clone = response.clone();
        caches.open(CACHE_NAME).then(function (cache) {
          cache.put(request, clone); // LÆ°u cho láº§n sau!
        });
      }
      return response;
    });
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STRATEGY 2: Network First!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function networkFirst(request) {
  return fetch(request)
    .then(function (response) {
      if (response.ok) {
        var clone = response.clone();
        caches.open(CACHE_NAME).then(function (cache) {
          cache.put(request, clone);
        });
      }
      return response;
    })
    .catch(function () {
      // â˜… Network fail â†’ fallback to cache!
      return caches.match(request);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STRATEGY 3: Stale-While-Revalidate! â˜…â˜…â˜…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function staleWhileRevalidate(request) {
  return caches.open(CACHE_NAME).then(function (cache) {
    return cache.match(request).then(function (cached) {
      // â˜… Fetch Má»šI á»Ÿ background (dÃ¹ cÃ³ cache hay khÃ´ng!)
      var fetchPromise = fetch(request).then(function (response) {
        if (response.ok) {
          cache.put(request, response.clone()); // Update cache!
        }
        return response;
      });

      // â˜… Tráº£ cache NGAY náº¿u cÃ³! Náº¿u khÃ´ng â†’ Ä‘á»£i fetch!
      return cached || fetchPromise;
    });
  });
}
```

---

## Â§6. Stale-While-Revalidate Pattern!

```
  STALE-WHILE-REVALIDATE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  "Tráº£ data CÅ¨ ngay â†’ cáº­p nháº­t Má»šI á»Ÿ background!" â˜…        â”‚
  â”‚                                                              â”‚
  â”‚  Láº¦N 1 (chÆ°a cÃ³ cache!):                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Request â†’ Cache MISS â†’ Fetch â†’ Return v1 â†’ Cache v1 â”‚    â”‚
  â”‚  â”‚  User tháº¥y: loading... â†’ v1 hiá»‡n!                     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Láº¦N 2 (cÃ³ cache v1, server cÃ³ v2!):                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Request â†’ Cache HIT v1 â†’ Return v1 NGAY! â˜… (0ms!)  â”‚    â”‚
  â”‚  â”‚           â””â”€ Background: Fetch v2 â†’ Cache v2!         â”‚    â”‚
  â”‚  â”‚  User tháº¥y: v1 ngay! (khÃ´ng loading!) â˜…               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  Láº¦N 3 (cache Ä‘Ã£ lÃ  v2!):                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Request â†’ Cache HIT v2 â†’ Return v2 NGAY! â˜…           â”‚    â”‚
  â”‚  â”‚           â””â”€ Background: Fetch v3 (náº¿u cÃ³!) â†’ Cache! â”‚    â”‚
  â”‚  â”‚  User tháº¥y: data Má»šI NHáº¤T! â˜…                         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  â˜… User LUÃ”N tháº¥y data NGAY (khÃ´ng loading!)                â”‚
  â”‚  â˜… Data tá»± cáº­p nháº­t á»Ÿ background! â˜…                          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Káº¿t Quáº£ Thá»±c Táº¿!

```
  SCENARIO 1: STATIC RESOURCES (Strong Cache + Hash!):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ Chá»‰ sá»‘          â”‚ TrÆ°á»›c    â”‚ Sau      â”‚ Cáº£i thiá»‡nâ”‚      â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
  â”‚  â”‚ First screen (2nd)â”‚ 2.5s     â”‚ 0.3s     â”‚ 88% â†“ â˜…â”‚      â”‚
  â”‚  â”‚ Bandwidth         â”‚ 100%     â”‚ <1%      â”‚ 99% â†“ â˜…â”‚      â”‚
  â”‚  â”‚ HTTP requests     â”‚ 50+      â”‚ 1-2      â”‚ 95% â†“  â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  SCENARIO 2: HIGH-FREQ API (Memory Cache!):                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ HÃ nh vi        â”‚ TrÆ°á»›c         â”‚ Sau             â”‚      â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
  â”‚  â”‚ Click quay láº¡i    â”‚ Loading 1s âŒ â”‚ Hiá»‡n ngay! â˜…    â”‚      â”‚
  â”‚  â”‚ Server QPS        â”‚ 1000          â”‚ 200 (â†“80%) â˜…    â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  SCENARIO 3: OFFLINE (Service Worker!):                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ MÃ´i trÆ°á»ng     â”‚ TrÆ°á»›c         â”‚ Sau             â”‚      â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
  â”‚  â”‚ 4G               â”‚ 1.5s loading â”‚ <100ms â˜…         â”‚      â”‚
  â”‚  â”‚ Offline           â”‚ ğŸ¦– 404!      â”‚ Duyá»‡t bÃ¬nh      â”‚      â”‚
  â”‚  â”‚                  â”‚ âŒ            â”‚ thÆ°á»ng! âœ… â˜…     â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Best Practices!

```
  GOLDEN RULES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â‘  KHÃ”NG cache HTML! â˜…â˜…â˜…                                       â”‚
  â”‚  â†’ HTML = entry point! Cache â†’ user KHÃ”NG tháº¥y update!     â”‚
  â”‚  â†’ Cache-Control: no-cache!                                  â”‚
  â”‚                                                              â”‚
  â”‚  â‘¡ Static PHáº¢I cÃ³ hash! â˜…â˜…â˜…                                    â”‚
  â”‚  â†’ script.js âŒ â†’ script.8a7b9c.js âœ…                      â”‚
  â”‚  â†’ Äá»•i code = Ä‘á»•i hash = browser táº£i file Má»šI!            â”‚
  â”‚  â†’ max-age=31536000, immutable!                              â”‚
  â”‚                                                              â”‚
  â”‚  â‘¢ private cho user data! â˜…                                    â”‚
  â”‚  â†’ API tráº£ user info â†’ PHáº¢I cÃ³ private!                     â”‚
  â”‚  â†’ KhÃ´ng private â†’ CDN cache user A â†’ hiá»‡n cho user B! âŒ  â”‚
  â”‚                                                              â”‚
  â”‚  â‘£ Stale-While-Revalidate cho UX tá»‘t nháº¥t! â˜…â˜…â˜…                â”‚
  â”‚  â†’ Tráº£ data cÅ© NGAY â†’ update á»Ÿ background!                 â”‚
  â”‚  â†’ User khÃ´ng bao giá» tháº¥y loading! â˜…                       â”‚
  â”‚                                                              â”‚
  â”‚  â‘¤ Monitor hit rate! â˜…                                         â”‚
  â”‚  â†’ Tá»‘i Æ°u mÃ  khÃ´ng Ä‘o = mÃ¹ quÃ¡ng!                         â”‚
  â”‚  â†’ Track cache HIT/MISS ratio!                               â”‚
  â”‚  â†’ Target: hit rate > 90%!                                   â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. CÃ¢u Há»i Phá»ng Váº¥n!

```
  CÃ‚U Há»I:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â“ 1: Onion model cache gá»“m máº¥y táº§ng?                         â”‚
  â”‚  â†’ L1 Memory (RAM, nhanh nháº¥t, máº¥t khi refresh!)            â”‚
  â”‚  â†’ L2 Service Worker (programmable, offline!)                â”‚
  â”‚  â†’ L3 HTTP Cache (browser tá»± quáº£n lÃ½, Cache-Control!)      â”‚
  â”‚  â†’ L4 Network (cháº­m nháº¥t, chá»‰ khi cache miss!) â˜…           â”‚
  â”‚                                                              â”‚
  â”‚  â“ 2: Strong cache vs Conditional cache?                        â”‚
  â”‚  â†’ Strong: max-age â†’ KHÃ”NG há»i server! (200 from cache!)   â”‚
  â”‚  â†’ Conditional: ETag/Last-Modified â†’ há»i server â†’ 304! â˜…  â”‚
  â”‚  â†’ HTML: conditional! Static + hash: strong! â˜…               â”‚
  â”‚                                                              â”‚
  â”‚  â“ 3: no-cache vs no-store?                                     â”‚
  â”‚  â†’ no-cache: CÃ“ cache nhÆ°ng LUÃ”N verify vá»›i server! â˜…       â”‚
  â”‚  â†’ no-store: KHÃ”NG cache gÃ¬ háº¿t! (sensitive data!)           â”‚
  â”‚  â†’ DÃ¹ng no-cache cho HTML!                                    â”‚
  â”‚                                                              â”‚
  â”‚  â“ 4: Stale-While-Revalidate lÃ  gÃ¬?                             â”‚
  â”‚  â†’ Tráº£ data CÅ¨ trong cache NGAY Láº¬P Tá»¨C! â˜…                 â”‚
  â”‚  â†’ Fetch data Má»šI á»Ÿ BACKGROUND!                              â”‚
  â”‚  â†’ Láº§n sau user sáº½ tháº¥y data má»›i!                           â”‚
  â”‚  â†’ User KHÃ”NG BAO GIá»œ tháº¥y loading spinner! â˜…               â”‚
  â”‚                                                              â”‚
  â”‚  â“ 5: private vs public trong Cache-Control?                    â”‚
  â”‚  â†’ public: CDN + browser Ä‘á»u cache! â˜…                       â”‚
  â”‚  â†’ private: CHá»ˆ browser cache! CDN khÃ´ng! â˜…                 â”‚
  â”‚  â†’ User data PHáº¢I private! (trÃ¡nh CDN cache láº«n user!)     â”‚
  â”‚                                                              â”‚
  â”‚  â“ 6: Táº¡i sao static resource cáº§n hash trong filename?          â”‚
  â”‚  â†’ max-age=1year â†’ browser KHÃ”NG há»i server!                â”‚
  â”‚  â†’ Äá»•i code â†’ Ä‘á»•i hash â†’ URL má»›i â†’ browser táº£i má»›i! â˜…    â”‚
  â”‚  â†’ Náº¿u khÃ´ng hash â†’ user bá»‹ káº¹t báº£n cÅ© 1 nÄƒm! âŒ          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
