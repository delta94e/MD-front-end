# Next.js Layouts & Pages â€” Deep Dive!

> **Chá»§ Ä‘á»**: Layouts vÃ  Pages trong Next.js App Router â€” tá»« A Ä‘áº¿n Z
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/getting-started/layouts-and-pages

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” File-System Based Routing!](#1)
2. [Â§2. Creating a Page â€” Táº¡o Trang!](#2)
3. [Â§3. Creating a Layout â€” Root Layout!](#3)
4. [Â§4. Nested Routes â€” Route Lá»“ng Nhau!](#4)
5. [Â§5. Nesting Layouts â€” Layout Lá»“ng Nhau!](#5)
6. [Â§6. Dynamic Segments â€” Route Äá»™ng!](#6)
7. [Â§7. Search Params â€” Tham Sá»‘ TÃ¬m Kiáº¿m!](#7)
8. [Â§8. Linking Between Pages â€” Component Link!](#8)
9. [Â§9. Route Props Helpers â€” PageProps & LayoutProps!](#9)
10. [Â§10. Tá»± Viáº¿t â€” Layout & Page Renderer!](#10)
11. [Â§11. Tá»± Viáº¿t â€” Route Resolver & Link Navigator!](#11)
12. [Â§12. Tá»•ng Káº¿t & CÃ¢u Há»i Luyá»‡n Táº­p!](#12)

---

## Â§1. Tá»•ng Quan â€” File-System Based Routing!

```
  LAYOUTS & PAGES â€” Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Next.js dÃ¹ng FILE-SYSTEM BASED ROUTING:              â”‚
  â”‚  â†’ FOLDERS Ä‘á»‹nh nghÄ©a route segments                  â”‚
  â”‚  â†’ FILES táº¡o UI cho segments Ä‘Ã³                       â”‚
  â”‚                                                        â”‚
  â”‚  2 FILE CHÃNH:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  page.tsx                                        â”‚  â”‚
  â”‚  â”‚  â†’ UI RIÃŠNG cho 1 route cá»¥ thá»ƒ                 â”‚  â”‚
  â”‚  â”‚  â†’ Má»—i route Cáº¦N page.tsx Ä‘á»ƒ PUBLIC!           â”‚  â”‚
  â”‚  â”‚  â†’ Default export React component               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  layout.tsx                                      â”‚  â”‚
  â”‚  â”‚  â†’ UI CHIA Sáºº giá»¯a nhiá»u pages                 â”‚  â”‚
  â”‚  â”‚  â†’ PERSIST across navigations!                  â”‚  â”‚
  â”‚  â”‚  â†’ Nháº­n children prop                           â”‚  â”‚
  â”‚  â”‚  â†’ Root layout Báº®T BUá»˜C!                       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  LUá»’NG HOáº T Äá»˜NG:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  User truy cáº­p URL                               â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  Next.js map URL â†’ folder structure              â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  TÃ¬m page.tsx trong folder tÆ°Æ¡ng á»©ng            â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  Wrap page trong Táº¤T Cáº¢ layouts (recursive)    â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  Render káº¿t quáº£ â†’ gá»­i HTML Ä‘áº¿n client          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  KHI NAVIGATE:                                   â”‚  â”‚
  â”‚  â”‚  â†’ Layout KHÃ”NG re-render!                      â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ page.tsx Má»šI Ä‘Æ°á»£c render!              â”‚  â”‚
  â”‚  â”‚  â†’ State trong layout GIá»®U Láº I!               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Creating a Page â€” Táº¡o Trang!

```
  CREATING A PAGE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  page.tsx = UI cho 1 route Cá»¤ THá»‚:                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CÃCH Táº O:                                      â”‚  â”‚
  â”‚  â”‚  â‘  Táº¡o folder trong app/ (= URL segment)       â”‚  â”‚
  â”‚  â”‚  â‘¡ ThÃªm file page.tsx vÃ o folder               â”‚  â”‚
  â”‚  â”‚  â‘¢ Export default React component               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  VÃ Dá»¤ â€” Táº¡o trang chá»§ /:                      â”‚  â”‚
  â”‚  â”‚  app/                                            â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ page.tsx â† Export default component        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL: / â†’ render app/page.tsx                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” Tá»ª FOLDER Äáº¾N URL:                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  FOLDER STRUCTURE:     RENDERED URL:             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  app/                                            â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ page.tsx          â†’ /                      â”‚  â”‚
  â”‚  â”‚  â”‚                                               â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ blog/                                       â”‚  â”‚
  â”‚  â”‚  â”‚   â””â”€â”€ page.tsx      â†’ /blog                  â”‚  â”‚
  â”‚  â”‚  â”‚                                               â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ about/                                      â”‚  â”‚
  â”‚  â”‚      â””â”€â”€ page.tsx      â†’ /about                 â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  QUAN TRá»ŒNG:                                     â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG CÃ“ page.tsx = route KHÃ”NG public!     â”‚  â”‚
  â”‚  â”‚  â†’ Folder chá»‰ DEFINE segment, KHÃ”NG táº¡o UI!   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Táº¡o page cho route `/`:**

```typescript
// app/page.tsx
// Default export = React component cho route nÃ y
export default function Page() {
  return <h1>Hello Next.js!</h1>
}
```

**Giáº£i thÃ­ch**:

- `app/page.tsx` â†’ TÆ°Æ¡ng á»©ng URL `/` (index page)
- `export default` â†’ **Báº®T BUá»˜C**, Next.js cáº§n default export Ä‘á»ƒ render!
- Component nháº­n (tuá»³ chá»n) `params` vÃ  `searchParams` props tá»« route

---

## Â§3. Creating a Layout â€” Root Layout!

```
  CREATING A LAYOUT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  layout.tsx = UI CHIA Sáºº giá»¯a NHIá»€U pages:            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Äáº¶C ÄIá»‚M Cá»¦A LAYOUT:                          â”‚  â”‚
  â”‚  â”‚  â‘  Shared UI â€” dÃ¹ng chung cho nhiá»u trang      â”‚  â”‚
  â”‚  â”‚  â‘¡ PERSIST â€” KHÃ”NG re-render khi navigate!     â”‚  â”‚
  â”‚  â”‚  â‘¢ State GIá»®U Láº I â€” input, scroll, v.v.       â”‚  â”‚
  â”‚  â”‚  â‘£ Nháº­n children prop â€” page hoáº·c layout con   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  ROOT LAYOUT (Báº®T BUá»˜C):                        â”‚  â”‚
  â”‚  â”‚  â†’ app/layout.tsx                                â”‚  â”‚
  â”‚  â”‚  â†’ PHáº¢I cÃ³ <html> vÃ  <body> tags!              â”‚  â”‚
  â”‚  â”‚  â†’ Wrap TOÃ€N Bá»˜ á»©ng dá»¥ng!                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” ROOT LAYOUT WRAP PAGE:                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€ app/layout.tsx â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚ <html lang="en">                           â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚   <body>                                   â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚     <header>Nav Bar</header>               â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚     <main>                                 â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â”Œâ”€â”€ children â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â”‚                              â”‚     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â”‚  app/page.tsx                â”‚     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â”‚  <h1>Hello Next.js!</h1>     â”‚     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â”‚                              â”‚     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚     </main>                                â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚     <footer>Footer</footer>                â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚   </body>                                  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚ </html>                                    â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Layout WRAP page thÃ´ng qua {children}!       â”‚  â”‚
  â”‚  â”‚  â†’ Khi navigate: layout GIá»® NGUYÃŠN!            â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ children thay Ä‘á»•i!                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” LAYOUT PERSIST KHI NAVIGATE:                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Navigate: / â†’ /blog â†’ /about                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Láº§n 1: /                                        â”‚  â”‚
  â”‚  â”‚  â”Œâ”€ Layout (RENDER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€ Page: / (RENDER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  <h1>Home</h1>                      â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Láº§n 2: /blog                                    â”‚  â”‚
  â”‚  â”‚  â”Œâ”€ Layout (KHÃ”NG re-render!) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€ Page: /blog (RENDER Má»šI) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚  <h1>Blog</h1>                      â”‚  â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Layout KHÃ”NG bá»‹ re-render!                   â”‚  â”‚
  â”‚  â”‚  â†’ State bÃªn trong layout GIá»®U Láº I!            â”‚  â”‚
  â”‚  â”‚  â†’ Performance tá»‘t hÆ¡n nhiá»u!                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Root Layout:**

```typescript
// app/layout.tsx â€” ROOT LAYOUT (Báº®T BUá»˜C!)
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        {/* Layout UI â€” shared cho Táº¤T Cáº¢ pages */}
        {/* Äáº·t children á»Ÿ vá»‹ trÃ­ báº¡n muá»‘n render page */}
        <main>{children}</main>
      </body>
    </html>
  )
}
```

**Giáº£i thÃ­ch chi tiáº¿t**:

- `children` prop â†’ **Báº®T BUá»˜C** â€” Ä‘Ã¢y lÃ  nÆ¡i page.tsx (hoáº·c nested layout) sáº½ Ä‘Æ°á»£c render
- `<html>` vÃ  `<body>` â†’ **CHá»ˆ cÃ³ á»Ÿ root layout** â€” cÃ¡c layout con KHÃ”NG cáº§n html/body
- Layout lÃ  **Server Component** máº·c Ä‘á»‹nh â€” cÃ³ thá»ƒ fetch data, async/await

---

## Â§4. Nested Routes â€” Route Lá»“ng Nhau!

```
  NESTED ROUTES â€” FOLDER Lá»’NG NHAU = URL Lá»’NG NHAU:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  CÆ  CHáº¾:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Nested route = URL cÃ³ NHIá»€U segments            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  VÃ Dá»¤: /blog/[slug]                            â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚  â”‚
  â”‚  â”‚  â”‚  /  â”‚ blog â”‚ [slug] â”‚                         â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚  â”‚
  â”‚  â”‚  Root   Segment  Leaf                            â”‚  â”‚
  â”‚  â”‚  Seg.            Segment                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  FOLDER = Route segment                          â”‚  â”‚
  â”‚  â”‚  FILE (page/layout) = UI cho segment Ä‘Ã³         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” Táº O NESTED ROUTES:                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÆ¯á»šC 1: Táº¡o folder /blog                       â”‚  â”‚
  â”‚  â”‚  app/                                            â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ blog/           â† Táº¡o folder              â”‚  â”‚
  â”‚  â”‚      â””â”€â”€ page.tsx    â† ThÃªm page â†’ /blog       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  BÆ¯á»šC 2: ThÃªm nested route [slug]:              â”‚  â”‚
  â”‚  â”‚  app/                                            â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ blog/                                       â”‚  â”‚
  â”‚  â”‚      â”œâ”€â”€ page.tsx       â†’ /blog                 â”‚  â”‚
  â”‚  â”‚      â””â”€â”€ [slug]/        â† Nested folder         â”‚  â”‚
  â”‚  â”‚          â””â”€â”€ page.tsx   â†’ /blog/:slug           â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL MAPPING:                                    â”‚  â”‚
  â”‚  â”‚  /blog          â†’ app/blog/page.tsx             â”‚  â”‚
  â”‚  â”‚  /blog/hello    â†’ app/blog/[slug]/page.tsx      â”‚  â”‚
  â”‚  â”‚                   params = { slug: "hello" }     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Blog list page:**

```typescript
// app/blog/page.tsx
import { getPosts } from '@/lib/posts'
import { Post } from '@/ui/post'

// Server Component â€” cÃ³ thá»ƒ async!
export default async function Page() {
  const posts = await getPosts()
  return (
    <ul>
      {posts.map((post) => (
        <Post key={post.id} post={post} />
      ))}
    </ul>
  )
}
```

**Code vÃ­ dá»¥ â€” Blog post page (dynamic):**

```typescript
// app/blog/[slug]/page.tsx
// [slug] = dynamic segment, match báº¥t ká»³ giÃ¡ trá»‹ nÃ o
function generateStaticParams() {}

export default function Page() {
  return <h1>Hello, Blog Post Page!</h1>
}
```

---

## Â§5. Nesting Layouts â€” Layout Lá»“ng Nhau!

```
  NESTING LAYOUTS â€” LAYOUT WRAP LAYOUT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  NGUYÃŠN Táº®C:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Layouts TRONG folder hierarchy =               â”‚  â”‚
  â”‚  â”‚  tá»± Ä‘á»™ng NESTED (lá»“ng nhau)!                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Parent layout WRAP child layout                â”‚  â”‚
  â”‚  â”‚  thÃ´ng qua children prop!                       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” 2 LAYOUTS Lá»’NG NHAU:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  FILE STRUCTURE:                                 â”‚  â”‚
  â”‚  â”‚  app/                                            â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ layout.tsx       â† ROOT layout             â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ blog/                                       â”‚  â”‚
  â”‚  â”‚      â”œâ”€â”€ layout.tsx   â† BLOG layout             â”‚  â”‚
  â”‚  â”‚      â”œâ”€â”€ page.tsx     â†’ /blog                   â”‚  â”‚
  â”‚  â”‚      â””â”€â”€ [slug]/                                 â”‚  â”‚
  â”‚  â”‚          â””â”€â”€ page.tsx â†’ /blog/:slug             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  RENDER KHI TRUY Cáº¬P /blog:                     â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€ Root Layout (app/layout.tsx) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚ <html><body>                               â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€ Blog Layout (app/blog/layout.tsx) â”€â”€â” â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚ <section>                              â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   <nav>Blog Nav</nav>                  â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”Œâ”€â”€ children â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”‚ app/blog/page.tsx               â”‚  â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”‚ <ul>...posts...</ul>            â”‚  â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚ </section>                             â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚ </body></html>                              â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  RENDER KHI TRUY Cáº¬P /blog/hello-world:         â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€ Root Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€ Blog Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”Œâ”€â”€ children â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”‚ app/blog/[slug]/page.tsx      â”‚   â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â”‚ <h1>Hello, Blog Post!</h1>    â”‚   â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Root layout wraps Blog layout                â”‚  â”‚
  â”‚  â”‚  â†’ Blog layout wraps page                       â”‚  â”‚
  â”‚  â”‚  â†’ Navigate /blog â†’ /blog/[slug]:              â”‚  â”‚
  â”‚  â”‚    Cáº¢ HAI layouts GIá»®U NGUYÃŠN!                 â”‚  â”‚
  â”‚  â”‚    Chá»‰ page (children) thay Ä‘á»•i!              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Blog Layout:**

```typescript
// app/blog/layout.tsx â€” BLOG LAYOUT (nested)
export default function BlogLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return <section>{children}</section>
}
```

**Giáº£i thÃ­ch flow káº¿t há»£p 2 layouts**:

- Root layout (`app/layout.tsx`) wraps Blog layout (`app/blog/layout.tsx`)
- Blog layout wraps page (`app/blog/page.tsx` HOáº¶C `app/blog/[slug]/page.tsx`)
- Khi navigate giá»¯a `/blog` vÃ  `/blog/hello` â†’ **Cáº¢ HAI layouts giá»¯ nguyÃªn**, chá»‰ page thay Ä‘á»•i!

---

## Â§6. Dynamic Segments â€” Route Äá»™ng!

```
  DYNAMIC SEGMENTS â€” [segmentName]:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Dynamic segment = táº¡o routes Tá»ª DATA:                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  CÃCH Táº O:                                      â”‚  â”‚
  â”‚  â”‚  â†’ Wrap tÃªn folder trong []:                    â”‚  â”‚
  â”‚  â”‚    [slug], [id], [category]                      â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  VÃ Dá»¤:                                         â”‚  â”‚
  â”‚  â”‚  app/blog/[slug]/page.tsx                        â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL /blog/hello-world                           â”‚  â”‚
  â”‚  â”‚  â†’ params = { slug: "hello-world" }             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URL /blog/nextjs-guide                          â”‚  â”‚
  â”‚  â”‚  â†’ params = { slug: "nextjs-guide" }            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  QUAN TRá»ŒNG â€” params lÃ  Promise (Next.js 15+):        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // TRÆ¯á»šC (Next.js 14):                         â”‚  â”‚
  â”‚  â”‚  function Page({ params }) {                     â”‚  â”‚
  â”‚  â”‚    const slug = params.slug     // Ä‘á»“ng bá»™      â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  // SAU (Next.js 15+):                          â”‚  â”‚
  â”‚  â”‚  async function Page({ params }) {               â”‚  â”‚
  â”‚  â”‚    const { slug } = await params  // Báº¤T Äá»’NG Bá»˜â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ params giá» lÃ  Promise!                       â”‚  â”‚
  â”‚  â”‚  â†’ PHáº¢I await trÆ°á»›c khi dÃ¹ng!                  â”‚  â”‚
  â”‚  â”‚  â†’ Ãp dá»¥ng cho Cáº¢ page VÃ€ layout!             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Dynamic segment vá»›i params Promise:**

```typescript
// app/blog/[slug]/page.tsx
export default async function BlogPostPage({
  params,
}: {
  params: Promise<{ slug: string }>
}) {
  // params lÃ  Promise â†’ PHáº¢I await!
  const { slug } = await params
  const post = await getPost(slug)

  return (
    <div>
      <h1>{post.title}</h1>
      <p>{post.content}</p>
    </div>
  )
}
```

**LÆ°u Ã½**: Layouts trong Dynamic Segments cÅ©ng CÃ“ THá»‚ truy cáº­p `params` prop â€” cÅ©ng lÃ  Promise!

---

## Â§7. Search Params â€” Tham Sá»‘ TÃ¬m Kiáº¿m!

```
  SEARCH PARAMS â€” ?key=value:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  2 CÃCH Äá»ŒC SEARCH PARAMS:                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘  SERVER COMPONENT â€” searchParams prop:         â”‚  â”‚
  â”‚  â”‚     â†’ DÃ¹ng trong page.tsx (Server Component)    â”‚  â”‚
  â”‚  â”‚     â†’ searchParams cÅ©ng lÃ  Promise!             â”‚  â”‚
  â”‚  â”‚     â†’ âš ï¸ Opt page vÃ o DYNAMIC RENDERING!       â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ CLIENT COMPONENT â€” useSearchParams hook:      â”‚  â”‚
  â”‚  â”‚     â†’ DÃ¹ng trong Client Components              â”‚  â”‚
  â”‚  â”‚     â†’ import tá»« 'next/navigation'               â”‚  â”‚
  â”‚  â”‚     â†’ Re-render khi params thay Ä‘á»•i             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ OPTIMIZATION â€” URLSearchParams:               â”‚  â”‚
  â”‚  â”‚     â†’ new URLSearchParams(window.location.search)â”‚  â”‚
  â”‚  â”‚     â†’ DÃ¹ng trong callbacks/event handlers       â”‚  â”‚
  â”‚  â”‚     â†’ KHÃ”NG trigger re-render!                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  KHI NÃ€O DÃ™NG CÃI NÃ€O?                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  searchParams prop:                              â”‚  â”‚
  â”‚  â”‚  â†’ Cáº§n search params Ä‘á»ƒ LOAD DATA tá»« DB         â”‚  â”‚
  â”‚  â”‚  â†’ Pagination, filtering tá»« server              â”‚  â”‚
  â”‚  â”‚  â†’ VÃ Dá»¤: /products?page=2&sort=price          â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  useSearchParams hook:                           â”‚  â”‚
  â”‚  â”‚  â†’ Search params dÃ¹ng CHá»ˆ á»Ÿ client              â”‚  â”‚
  â”‚  â”‚  â†’ Filter danh sÃ¡ch Ä‘Ã£ load qua props          â”‚  â”‚
  â”‚  â”‚  â†’ VÃ Dá»¤: filter UI Ä‘Ã£ cÃ³ sáºµn data            â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  URLSearchParams:                                â”‚  â”‚
  â”‚  â”‚  â†’ Äá»c trong callbacks, KHÃ”NG cáº§n re-render    â”‚  â”‚
  â”‚  â”‚  â†’ VÃ Dá»¤: onClick handler Ä‘á»c current params  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Server Component vá»›i searchParams:**

```typescript
// app/products/page.tsx â€” SERVER COMPONENT
export default async function Page({
  searchParams,
}: {
  searchParams: Promise<{ [key: string]: string | string[] | undefined }>;
}) {
  // searchParams cÅ©ng lÃ  Promise!
  const filters = (await searchParams).filters;
  // DÃ¹ng filters Ä‘á»ƒ query DB...
}
```

**Code vÃ­ dá»¥ â€” Client Component vá»›i useSearchParams:**

```typescript
"use client";
import { useSearchParams } from "next/navigation";

export function FilterPanel() {
  const searchParams = useSearchParams();
  const category = searchParams.get("category");
  // Filter UI Ä‘Ã£ cÃ³ sáºµn data...
}
```

---

## Â§8. Linking Between Pages â€” Component Link!

```
  LINK COMPONENT â€” NAVIGATE GIá»®A CÃC PAGES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  <Link> = CÃCH CHÃNH Ä‘á»ƒ navigate trong Next.js:       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  import Link from 'next/link'                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Äáº¶C ÄIá»‚M:                                      â”‚  â”‚
  â”‚  â”‚  â‘  Extends HTML <a> tag                          â”‚  â”‚
  â”‚  â”‚  â‘¡ PREFETCHING â€” táº£i trÆ°á»›c trang tiáº¿p theo!     â”‚  â”‚
  â”‚  â”‚  â‘¢ CLIENT-SIDE NAVIGATION â€” khÃ´ng full reload!  â”‚  â”‚
  â”‚  â”‚  â‘£ Nháº­n href prop â€” URL Ä‘Ã­ch                    â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  SO SÃNH:                                        â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
  â”‚  â”‚  â”‚ <a href="/blog"> â”‚ <Link href="/blog">   â”‚    â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚  â”‚
  â”‚  â”‚  â”‚ Full page reload â”‚ Client-side navigate  â”‚    â”‚  â”‚
  â”‚  â”‚  â”‚ Máº¥t state!      â”‚ Giá»¯u state layout!    â”‚    â”‚  â”‚
  â”‚  â”‚  â”‚ Cháº­m!           â”‚ Nhanh! (prefetch)     â”‚    â”‚  â”‚
  â”‚  â”‚  â”‚ KhÃ´ng prefetch  â”‚ Tá»± Ä‘á»™ng prefetch      â”‚    â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SÆ  Äá»’ â€” PREFETCHING & CLIENT-SIDE NAVIGATION:       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  User nhÃ¬n tháº¥y <Link href="/blog">             â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  Next.js Tá»° Äá»˜NG prefetch /blog:                â”‚  â”‚
  â”‚  â”‚  â†’ Fetch layout + page data á»Ÿ background       â”‚  â”‚
  â”‚  â”‚  â†’ Cache láº¡i!                                    â”‚  â”‚
  â”‚  â”‚       â†“                                          â”‚  â”‚
  â”‚  â”‚  User CLICK link:                                â”‚  â”‚
  â”‚  â”‚  â†’ KHÃ”NG full page reload!                      â”‚  â”‚
  â”‚  â”‚  â†’ Client-side transition (SPA-like)            â”‚  â”‚
  â”‚  â”‚  â†’ Layout GIá»®U NGUYÃŠN                          â”‚  â”‚
  â”‚  â”‚  â†’ Chá»‰ page Má»šI render                        â”‚  â”‚
  â”‚  â”‚  â†’ Tá»« cache â†’ INSTANT!                         â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  useRouter hook:                                 â”‚  â”‚
  â”‚  â”‚  â†’ DÃ¹ng cho ADVANCED navigation                 â”‚  â”‚
  â”‚  â”‚  â†’ router.push(), router.back(), v.v.            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥ â€” Link component:**

```typescript
import Link from 'next/link'

export default async function Post({ post }) {
  const posts = await getPosts()
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.slug}>
          <Link href={`/blog/${post.slug}`}>{post.title}</Link>
        </li>
      ))}
    </ul>
  )
}
```

---

## Â§9. Route Props Helpers â€” PageProps & LayoutProps!

```
  ROUTE PROPS HELPERS â€” TYPE-SAFE ROUTING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Next.js cung cáº¥p UTILITY TYPES tá»± Ä‘á»™ng:              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  PageProps<'/blog/[slug]'>                        â”‚  â”‚
  â”‚  â”‚  â†’ Tá»± táº¡o type cho page components              â”‚  â”‚
  â”‚  â”‚  â†’ Bao gá»“m: params + searchParams              â”‚  â”‚
  â”‚  â”‚  â†’ params.slug sáº½ cÃ³ type string!              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  LayoutProps<'/dashboard'>                        â”‚  â”‚
  â”‚  â”‚  â†’ Tá»± táº¡o type cho layout components            â”‚  â”‚
  â”‚  â”‚  â†’ Bao gá»“m: children + named slots             â”‚  â”‚
  â”‚  â”‚  â†’ VD: @analytics â†’ props.analytics             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Äáº¶C ÄIá»‚M:                                      â”‚  â”‚
  â”‚  â”‚  â†’ GLOBAL helpers â€” KHÃ”NG cáº§n import!           â”‚  â”‚
  â”‚  â”‚  â†’ Tá»± generate khi cháº¡y next dev/build         â”‚  â”‚
  â”‚  â”‚  â†’ Static routes: params = {}                   â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Code vÃ­ dá»¥:**

```typescript
// app/blog/[slug]/page.tsx â€” DÃ¹ng PageProps
export default async function Page(props: PageProps<'/blog/[slug]'>) {
  const { slug } = await props.params
  return <h1>Blog post: {slug}</h1>
}

// app/dashboard/layout.tsx â€” DÃ¹ng LayoutProps
export default function Layout(props: LayoutProps<'/dashboard'>) {
  return (
    <section>
      {props.children}
      {/* Náº¿u cÃ³ app/dashboard/@analytics â†’ */}
      {/* {props.analytics} */}
    </section>
  )
}
```

---

## Â§10. Tá»± Viáº¿t â€” Layout & Page Renderer!

> **Má»¥c tiÃªu**: MÃ´ phá»ng cÃ¡ch Next.js render layouts/pages â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!

```
  Tá»° VIáº¾T â€” LAYOUT & PAGE RENDERER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  LUá»’NG:                                                â”‚
  â”‚  â‘  Nháº­n URL path                                      â”‚
  â”‚  â‘¡ Split thÃ nh segments                               â”‚
  â”‚  â‘¢ Vá»›i má»—i segment â†’ tÃ¬m layout.tsx                  â”‚
  â”‚  â‘£ TÃ¬m page.tsx á»Ÿ segment cuá»‘i                       â”‚
  â”‚  â‘¤ Nest: outermost layout â†’ ... â†’ page               â”‚
  â”‚  â‘¥ Output káº¿t quáº£ dáº¡ng HTML string                   â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T â€” LayoutPageRenderer
// MÃ´ phá»ng cÃ¡ch Next.js App Router render layouts + pages
// KHÃ”NG dÃ¹ng báº¥t ká»³ thÆ° viá»‡n nÃ o!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var LayoutPageRenderer = (function () {
  // 1. FILE SYSTEM GIáº¢ Láº¬P
  var fileSystem = {
    app: {
      "layout.tsx": function (children) {
        return (
          '<html lang="en"><body>' +
          "<header>[Root Nav]</header>" +
          "<main>" +
          children +
          "</main>" +
          "<footer>[Root Footer]</footer>" +
          "</body></html>"
        );
      },
      "page.tsx": function () {
        return "<h1>Home Page</h1><p>Welcome!</p>";
      },
      blog: {
        "layout.tsx": function (children) {
          return (
            '<section class="blog-layout">' +
            "<nav>[Blog Sidebar]</nav>" +
            '<div class="blog-content">' +
            children +
            "</div>" +
            "</section>"
          );
        },
        "page.tsx": function () {
          return "<h1>Blog List</h1><ul><li>Post 1</li></ul>";
        },
        "[slug]": {
          "page.tsx": function (params) {
            return (
              "<article><h1>Blog: " +
              params.slug +
              "</h1><p>Ná»™i dung...</p></article>"
            );
          },
        },
      },
      dashboard: {
        "layout.tsx": function (children) {
          return (
            '<div class="dashboard">' +
            "<aside>[Menu]</aside>" +
            "<div>" +
            children +
            "</div></div>"
          );
        },
        "page.tsx": function () {
          return "<h1>Dashboard</h1>";
        },
        settings: {
          "page.tsx": function () {
            return "<h1>Settings</h1>";
          },
        },
      },
    },
  };

  // 2. PARSE URL â†’ SEGMENTS
  function parseUrl(url) {
    var cleaned = url.replace(/^\/+|\/+$/g, "");
    if (cleaned === "") return [];
    return cleaned.split("/");
  }

  // 3. RESOLVE FOLDER (há»— trá»£ dynamic [xxx])
  function resolveFolder(currentFolder, segment) {
    if (currentFolder[segment]) {
      return { folder: currentFolder[segment], params: {} };
    }
    var keys = Object.keys(currentFolder);
    for (var i = 0; i < keys.length; i++) {
      var key = keys[i];
      if (key.charAt(0) === "[" && key.charAt(key.length - 1) === "]") {
        var paramName = key.slice(1, -1);
        var params = {};
        params[paramName] = segment;
        return { folder: currentFolder[key], params: params };
      }
    }
    return null;
  }

  // 4. RENDER â€” Core logic!
  function render(url) {
    var segments = parseUrl(url);
    var layouts = [];
    var allParams = {};
    var currentFolder = fileSystem["app"];

    console.log("â•â•â• RENDERING: " + url + " â•â•â•");

    // Thu tháº­p ROOT layout
    if (currentFolder["layout.tsx"]) {
      layouts.push({
        path: "app/layout.tsx",
        render: currentFolder["layout.tsx"],
      });
    }

    // Traverse segments
    for (var i = 0; i < segments.length; i++) {
      var result = resolveFolder(currentFolder, segments[i]);
      if (!result) {
        return "<h1>404</h1>";
      }
      currentFolder = result.folder;
      var pk = Object.keys(result.params);
      for (var j = 0; j < pk.length; j++)
        allParams[pk[j]] = result.params[pk[j]];

      if (typeof currentFolder === "object" && currentFolder["layout.tsx"]) {
        layouts.push({
          path: "app/" + segments.slice(0, i + 1).join("/") + "/layout.tsx",
          render: currentFolder["layout.tsx"],
        });
      }
    }

    // TÃ¬m page.tsx
    if (typeof currentFolder !== "object" || !currentFolder["page.tsx"]) {
      return "<h1>404 â€” No page.tsx</h1>";
    }
    var output = currentFolder["page.tsx"](allParams);

    // NEST layouts (trong â†’ ngoÃ i)
    console.log("ğŸ—ï¸ Nesting: Page");
    for (var k = layouts.length - 1; k >= 0; k--) {
      output = layouts[k].render(output);
      console.log("  â†‘ " + layouts[k].path);
    }

    console.log("Params: " + JSON.stringify(allParams));
    console.log("Output: " + output.substring(0, 100) + "...");
    return output;
  }

  // 5. DEMO layout persist
  function demoLayoutPersist() {
    console.log("\nâ•”â•â•â• LAYOUT PERSIST DEMO â•â•â•â•—");
    var urls = [
      "/",
      "/blog",
      "/blog/hello",
      "/dashboard",
      "/dashboard/settings",
    ];
    var cache = {};
    for (var i = 0; i < urls.length; i++) {
      console.log("\nğŸ§­ Navigate: " + urls[i]);
      var segs = parseUrl(urls[i]);
      var cur = fileSystem["app"];
      var lays = [];
      if (cur["layout.tsx"]) lays.push("app/layout.tsx");
      for (var j = 0; j < segs.length; j++) {
        var r = resolveFolder(cur, segs[j]);
        if (r) {
          cur = r.folder;
          if (typeof cur === "object" && cur["layout.tsx"])
            lays.push("app/" + segs.slice(0, j + 1).join("/") + "/layout.tsx");
        }
      }
      for (var k = 0; k < lays.length; k++) {
        if (cache[lays[k]]) console.log("  â™»ï¸ " + lays[k] + " PERSIST");
        else {
          console.log("  ğŸ†• " + lays[k] + " RENDER");
          cache[lays[k]] = true;
        }
      }
      console.log("  ğŸ“„ Page â†’ RENDER");
    }
  }

  return {
    render: render,
    parseUrl: parseUrl,
    demoLayoutPersist: demoLayoutPersist,
  };
})();
// Cháº¡y thá»­: LayoutPageRenderer.render('/blog/hello');
// LayoutPageRenderer.demoLayoutPersist();
```

---

## Â§11. Tá»± Viáº¿t â€” Route Resolver & Link Navigator!

> **Má»¥c tiÃªu**: MÃ´ phá»ng `<Link>`, prefetching, searchParams â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!

```
  ROUTE RESOLVER & LINK:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â‘  RouteResolver â€” parse URL â†’ route info             â”‚
  â”‚  â‘¡ PrefetchCache â€” mÃ´ phá»ng prefetch cache           â”‚
  â”‚  â‘¢ LinkNavigator â€” mÃ´ phá»ng <Link> behavior          â”‚
  â”‚  â‘£ SearchParamsParser â€” parse ?key=value              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Tá»° VIáº¾T â€” RouteResolverAndLink
// KHÃ”NG dÃ¹ng báº¥t ká»³ thÆ° viá»‡n nÃ o!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var RouteResolverAndLink = (function () {
  // 1. ROUTE DEFINITIONS
  var routes = [
    { pattern: "/", hasPage: true, hasLayout: true },
    { pattern: "/blog", hasPage: true, hasLayout: true },
    { pattern: "/blog/[slug]", hasPage: true, hasLayout: false },
    { pattern: "/dashboard", hasPage: true, hasLayout: true },
    { pattern: "/dashboard/settings", hasPage: true, hasLayout: false },
    { pattern: "/products/[id]", hasPage: true, hasLayout: false },
  ];

  // 2. SEARCH PARAMS PARSER
  function parseSearchParams(url) {
    var qi = url.indexOf("?");
    if (qi === -1) return {};
    var qs = url.slice(qi + 1),
      params = {},
      pairs = qs.split("&");
    for (var i = 0; i < pairs.length; i++) {
      var ei = pairs[i].indexOf("=");
      if (ei === -1) continue;
      var key = decodeURIComponent(pairs[i].slice(0, ei));
      var val = decodeURIComponent(pairs[i].slice(ei + 1));
      if (params[key] !== undefined) {
        if (Array.isArray(params[key])) params[key].push(val);
        else params[key] = [params[key], val];
      } else params[key] = val;
    }
    return params;
  }

  // 3. ROUTE RESOLVER
  function resolveRoute(url) {
    var qi = url.indexOf("?");
    var pathname =
      (qi === -1 ? url : url.slice(0, qi)).replace(/\/+$/, "") || "/";
    var searchParams = parseSearchParams(url);
    var pathSegs =
      pathname === "/" ? [] : pathname.replace(/^\//, "").split("/");

    for (var i = 0; i < routes.length; i++) {
      var r = routes[i];
      var patSegs =
        r.pattern === "/" ? [] : r.pattern.replace(/^\//, "").split("/");
      if (pathSegs.length !== patSegs.length) continue;
      var params = {},
        matched = true;
      for (var j = 0; j < patSegs.length; j++) {
        if (patSegs[j].charAt(0) === "[")
          params[patSegs[j].slice(1, -1)] = pathSegs[j];
        else if (patSegs[j] !== pathSegs[j]) {
          matched = false;
          break;
        }
      }
      if (matched) {
        return {
          found: true,
          pattern: r.pattern,
          pathname: pathname,
          params: params,
          searchParams: searchParams,
          hasLayout: r.hasLayout,
          layouts: findLayouts(pathname),
        };
      }
    }
    return { found: false, pathname: pathname, searchParams: searchParams };
  }

  function findLayouts(pathname) {
    var result = ["/"];
    if (pathname === "/") return result;
    var segs = pathname.replace(/^\//, "").split("/"),
      acc = "";
    for (var i = 0; i < segs.length; i++) {
      acc += "/" + segs[i];
      for (var j = 0; j < routes.length; j++) {
        if (matchPattern(routes[j].pattern, acc) && routes[j].hasLayout)
          result.push(routes[j].pattern);
      }
    }
    return result;
  }

  function matchPattern(pattern, path) {
    var a = pattern === "/" ? [] : pattern.replace(/^\//, "").split("/");
    var b = path === "/" ? [] : path.replace(/^\//, "").split("/");
    if (a.length !== b.length) return false;
    for (var i = 0; i < a.length; i++) {
      if (a[i].charAt(0) === "[") continue;
      if (a[i] !== b[i]) return false;
    }
    return true;
  }

  // 4. PREFETCH CACHE
  var cache = {};
  function prefetch(url) {
    if (cache[url]) {
      console.log("âš¡ Cache HIT: " + url);
      return cache[url];
    }
    console.log("ğŸ“¥ Prefetch: " + url);
    cache[url] = { routeInfo: resolveRoute(url), time: Date.now() };
    return cache[url];
  }

  // 5. NAVIGATE (mÃ´ phá»ng <Link> click)
  function navigate(from, to) {
    console.log("\nğŸ§­ <Link> navigate: " + from + " â†’ " + to);
    var cached = cache[to];
    if (cached) console.log("âš¡ From prefetch cache!");
    else cached = prefetch(to);
    var toR = cached.routeInfo;
    if (!toR.found) {
      console.log("âŒ 404");
      return;
    }
    var fromR = resolveRoute(from);
    var fromL = fromR.found ? fromR.layouts : [];
    for (var i = 0; i < toR.layouts.length; i++) {
      var shared = false;
      for (var j = 0; j < fromL.length; j++)
        if (fromL[j] === toR.layouts[i]) shared = true;
      console.log(
        shared
          ? "  â™»ï¸ " + toR.layouts[i] + " PERSIST"
          : "  ğŸ†• " + toR.layouts[i] + " RENDER",
      );
    }
    console.log("  ğŸ“„ Page â†’ RENDER");
    if (Object.keys(toR.params).length > 0)
      console.log("  ğŸ”‘ params: " + JSON.stringify(toR.params));
    if (Object.keys(toR.searchParams).length > 0)
      console.log("  ğŸ” searchParams: " + JSON.stringify(toR.searchParams));
  }

  // 6. DEMO
  function demo() {
    console.log("â•”â•â•â• ROUTE RESOLVER & LINK DEMO â•â•â•â•—\n");
    var urls = ["/", "/blog", "/blog/nextjs", "/products/42?sort=price&page=2"];
    for (var i = 0; i < urls.length; i++) {
      var r = resolveRoute(urls[i]);
      console.log("URL: " + urls[i]);
      console.log(
        r.found
          ? "  âœ… " +
              r.pattern +
              " params=" +
              JSON.stringify(r.params) +
              " search=" +
              JSON.stringify(r.searchParams)
          : "  âŒ 404",
      );
    }
    console.log("\nâ”€â”€ Prefetch â”€â”€");
    prefetch("/blog");
    prefetch("/dashboard");
    prefetch("/blog");
    console.log("\nâ”€â”€ Navigate â”€â”€");
    navigate("/", "/blog");
    navigate("/blog", "/blog/nextjs");
    navigate("/blog/nextjs", "/dashboard");
  }

  return {
    resolveRoute: resolveRoute,
    parseSearchParams: parseSearchParams,
    prefetch: prefetch,
    navigate: navigate,
    demo: demo,
  };
})();
// Cháº¡y thá»­: RouteResolverAndLink.demo();
```

---

## Â§12. Tá»•ng Káº¿t & CÃ¢u Há»i Luyá»‡n Táº­p!

```
  Tá»”NG Káº¾T â€” LAYOUTS & PAGES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â‘  page.tsx â†’ UI cho 1 route, default export          â”‚
  â”‚  â‘¡ layout.tsx â†’ shared UI, PERSIST, children prop     â”‚
  â”‚  â‘¢ Root layout Báº®T BUá»˜C (html + body)                â”‚
  â”‚  â‘£ Nested routes = folder lá»“ng nhau                   â”‚
  â”‚  â‘¤ Nesting layouts = auto-wrap qua children          â”‚
  â”‚  â‘¥ Dynamic [slug] â†’ params lÃ  Promise (15+)          â”‚
  â”‚  â‘¦ searchParams: prop (server) / hook (client)       â”‚
  â”‚  â‘§ <Link> = prefetch + client-side navigation        â”‚
  â”‚  â‘¨ PageProps & LayoutProps = global type helpers      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÃ¢u Há»i Luyá»‡n Táº­p

**CÃ¢u 1**: `page.tsx` khÃ¡c `layout.tsx` tháº¿ nÃ o? Táº¡i sao layout KHÃ”NG re-render?

<details><summary>ÄÃ¡p Ã¡n</summary>

- `page.tsx` â†’ UI cho **1 route**, render láº¡i má»—i khi navigate Ä‘áº¿n
- `layout.tsx` â†’ UI **chia sáº»**, **PERSIST** across navigations
- Layout KHÃ”NG re-render vÃ¬ Next.js dÃ¹ng **partial rendering**: chá»‰ `children` thay Ä‘á»•i, layout giá»¯ nguyÃªn trong React tree â†’ state, scroll, event listeners preserved!

</details>

---

**CÃ¢u 2**: Root layout cÃ³ gÃ¬ Ä‘áº·c biá»‡t?

<details><summary>ÄÃ¡p Ã¡n</summary>

- á» **top-level** `app/layout.tsx`, **Báº®T BUá»˜C** pháº£i cÃ³
- Chá»©a `<html>` + `<body>` tags (chá»‰ root layout má»›i cÃ³)
- Wrap **toÃ n bá»™** á»©ng dá»¥ng
- Äáº·t global CSS, fonts, metadata, providers

</details>

---

**CÃ¢u 3**: Cho structure sau, khi truy cáº­p `/blog/hello`, HTML output lÃ  gÃ¬?

```
app/layout.tsx      â†’ <html><body>{children}</body></html>
app/blog/layout.tsx â†’ <section>{children}</section>
app/blog/[slug]/page.tsx â†’ <h1>Post: {slug}</h1>
```

<details><summary>ÄÃ¡p Ã¡n</summary>

```html
<html>
  <body>
    <section>
      <h1>Post: hello</h1>
    </section>
  </body>
</html>
```

Flow: Root Layout â†’ Blog Layout â†’ Page. Nesting tá»« ngoÃ i vÃ o trong!

</details>

---

**CÃ¢u 4**: Táº¡i sao `params` lÃ  `Promise` trong Next.js 15+?

<details><summary>ÄÃ¡p Ã¡n</summary>

- Há»— trá»£ **streaming** + **async rendering** tá»‘t hÆ¡n
- Pháº£i `await params` trÆ°á»›c khi dÃ¹ng
- Ãp dá»¥ng cho **Cáº¢ page VÃ€ layout**
- `searchParams` cÅ©ng lÃ  Promise

```typescript
// âœ… ÄÃšNG
const { slug } = await params;

// âŒ SAI
const slug = params.slug; // TypeError!
```

</details>

---

**CÃ¢u 5**: So sÃ¡nh 3 cÃ¡ch Ä‘á»c search params.

<details><summary>ÄÃ¡p Ã¡n</summary>

| CÃ¡ch                | á» Ä‘Ã¢u            | Khi nÃ o            | LÆ°u Ã½                     |
| ------------------- | ---------------- | ------------------ | ------------------------- |
| `searchParams` prop | Server Component | Load data tá»« DB    | Opt vÃ o dynamic rendering |
| `useSearchParams()` | Client Component | Filter client-side | Re-render khi thay Ä‘á»•i    |
| `URLSearchParams`   | Callbacks        | Event handlers     | KHÃ”NG re-render           |

</details>

---

**CÃ¢u 6**: `<Link>` khÃ¡c `<a>` tháº¿ nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

| `<a>`            | `<Link>`             |
| ---------------- | -------------------- |
| Full page reload | Client-side navigate |
| Máº¥t state        | Layout persist       |
| Cháº­m             | Prefetch â†’ instant   |

Prefetch flow: Link hiá»‡n â†’ auto fetch background â†’ cache â†’ click â†’ instant!

</details>

---

**CÃ¢u 7**: `PageProps` vÃ  `LayoutProps` lÃ  gÃ¬?

<details><summary>ÄÃ¡p Ã¡n</summary>

- **Global utility types** â€” KHÃ”NG cáº§n import
- Auto-generate khi `next dev/build/typegen`
- `PageProps<'/blog/[slug]'>` â†’ `{ params: Promise<{ slug: string }>, searchParams: Promise<...> }`
- `LayoutProps<'/dashboard'>` â†’ `{ children: ReactNode, analytics?: ReactNode }`
- Static routes: params = `{}`

</details>

---

**CÃ¢u 8**: Cho structure sau, liá»‡t kÃª routes, layouts, params:

```
app/
â”œâ”€â”€ layout.tsx
â”œâ”€â”€ page.tsx
â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ [slug]/page.tsx
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â””â”€â”€ settings/page.tsx
â””â”€â”€ products/[id]/page.tsx
```

<details><summary>ÄÃ¡p Ã¡n</summary>

| Route                 | Layouts          | Params     |
| --------------------- | ---------------- | ---------- |
| `/`                   | Root             | `{}`       |
| `/blog`               | Root â†’ Blog      | `{}`       |
| `/blog/:slug`         | Root â†’ Blog      | `{ slug }` |
| `/dashboard`          | Root â†’ Dashboard | `{}`       |
| `/dashboard/settings` | Root â†’ Dashboard | `{}`       |
| `/products/:id`       | Root             | `{ id }`   |

6 public routes. Navigate `/dashboard` â†’ `/dashboard/settings`: Dashboard layout **PERSIST**!

</details>
