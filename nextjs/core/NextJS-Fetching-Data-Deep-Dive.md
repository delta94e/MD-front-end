# Next.js Fetching Data â€” Deep Dive!

> **Chá»§ Ä‘á»**: Fetching Data trong Next.js App Router â€” Server, Client & Streaming!
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/getting-started/fetching-data

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Fetching Data lÃ  gÃ¬?](#1)
2. [Â§2. Server Components â€” fetch, ORM, Database](#2)
3. [Â§3. Client Components â€” use API & SWR/React Query](#3)
4. [Â§4. Deduplicate Requests & Cache Data](#4)
5. [Â§5. Streaming â€” CÆ¡ Cháº¿ Hoáº¡t Äá»™ng](#5)
6. [Â§6. loading.js â€” Auto Loading State](#6)
7. [Â§7. Suspense â€” Granular Streaming](#7)
8. [Â§8. Meaningful Loading States](#8)
9. [Â§9. Sequential vs Parallel Data Fetching](#9)
10. [Â§10. Preloading Data](#10)
11. [Â§11. PhÃ¢n TÃ­ch HÃ¬nh áº¢nh Tá»« Docs](#11)
12. [Â§12. Tá»± Viáº¿t â€” Data Fetching Engine](#12)
13. [Â§13. Tá»•ng Káº¿t & CÃ¢u Há»i Luyá»‡n Táº­p](#13)

---

## Â§1. Tá»•ng Quan â€” Fetching Data lÃ  gÃ¬?

```
  FETCHING DATA â€” Tá»”NG QUAN:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  TRONG NEXT.JS APP ROUTER:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Server Components:                              â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ fetch API (network requests)               â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ ORM / Database (Drizzle, Prisma)           â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ Node.js APIs (fs, ...)                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Client Components:                              â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€ React use() API (stream tá»« server)         â”‚  â”‚
  â”‚  â”‚  â””â”€â”€ SWR / React Query (community libs)         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  NGUYÃŠN Táº®C CHÃNH:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  Fetch á»Ÿ Server Components KHI CÃ“ THá»‚        â”‚  â”‚
  â”‚  â”‚    â†’ Gáº§n data source hÆ¡n (DB, API)             â”‚  â”‚
  â”‚  â”‚    â†’ KHÃ”NG lá»™ secrets (API keys, tokens)       â”‚  â”‚
  â”‚  â”‚    â†’ Giáº£m client bundle size                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ Client Components chá»‰ khi Cáº¦N interactivity â”‚  â”‚
  â”‚  â”‚    â†’ Real-time updates, user events            â”‚  â”‚
  â”‚  â”‚    â†’ Infinite scroll, live search              â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¢ Streaming Ä‘á»ƒ KHÃ”NG block UI                  â”‚  â”‚
  â”‚  â”‚    â†’ loading.js â†’ route-level loading          â”‚  â”‚
  â”‚  â”‚    â†’ <Suspense> â†’ component-level loading      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Server Components â€” fetch, ORM, Database!

```
  SERVER COMPONENTS â€” DATA FETCHING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  3 CÃCH FETCH DATA TRÃŠN SERVER:                        â”‚
  â”‚                                                        â”‚
  â”‚  â‘  fetch API:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  export default async function Page() {          â”‚  â”‚
  â”‚  â”‚    const data = await fetch('https://api...')    â”‚  â”‚
  â”‚  â”‚    const posts = await data.json()               â”‚  â”‚
  â”‚  â”‚    return <ul>{posts.map(...)}</ul>              â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âš ï¸ fetch responses KHÃ”NG cached by default!    â”‚  â”‚
  â”‚  â”‚  â†’ Next.js pre-render route â†’ output cached     â”‚  â”‚
  â”‚  â”‚  â†’ Muá»‘n dynamic: { cache: 'no-store' }         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ ORM / Database:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  import { db, posts } from '@/lib/db'            â”‚  â”‚
  â”‚  â”‚  export default async function Page() {          â”‚  â”‚
  â”‚  â”‚    const allPosts = await db.select().from(posts)â”‚  â”‚
  â”‚  â”‚    return <ul>{allPosts.map(...)}</ul>           â”‚  â”‚
  â”‚  â”‚  }                                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… AN TOÃ€N! Server Components render trÃªn      â”‚  â”‚
  â”‚  â”‚  server â†’ query DB trá»±c tiáº¿p, KHÃ”NG lá»™          â”‚  â”‚
  â”‚  â”‚  connection string ra client!                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ Node.js APIs (fs, path...):                         â”‚
  â”‚  â†’ Äá»c file, config, static data                      â”‚
  â”‚  â†’ Chá»‰ dÃ¹ng sync operations cho prerender             â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// â‘  FETCH API â€” cÃ¡ch phá»• biáº¿n nháº¥t
export default async function Page() {
  const data = await fetch('https://api.vercel.app/blog')
  const posts = await data.json()
  return (
    <ul>
      {posts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}

// â‘¡ ORM / DATABASE â€” query trá»±c tiáº¿p
import { db, posts } from '@/lib/db'

export default async function Page() {
  const allPosts = await db.select().from(posts)
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

---

## Â§3. Client Components â€” use API & Community Libraries!

```
  CLIENT COMPONENTS â€” 2 CÃCH FETCH:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  React use() API â€” STREAMING tá»« Server:             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  FLOW:                                           â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    promise    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
  â”‚  â”‚  â”‚   Server    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚   Client     â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  Component  â”‚   (as prop)  â”‚  Component   â”‚  â”‚  â”‚
  â”‚  â”‚  â”‚  getPosts() â”‚              â”‚  use(posts)  â”‚  â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Server: KHÃ”NG await! Truyá»n promise trá»±c tiáº¿p  â”‚  â”‚
  â”‚  â”‚  Client: dÃ¹ng use() Ä‘á»ƒ unwrap promise            â”‚  â”‚
  â”‚  â”‚  Suspense: hiá»‡n fallback trong khi chá»           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ Community Libraries (SWR, React Query):             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  'use client'                                    â”‚  â”‚
  â”‚  â”‚  const { data, error, isLoading } = useSWR(...)  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  âœ… Tá»± caching, revalidation, dedup              â”‚  â”‚
  â”‚  â”‚  âœ… Loading/error states built-in                â”‚  â”‚
  â”‚  â”‚  âš ï¸ Cáº§n 'use client' directive                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// â‘  USE API â€” Server truyá»n promise, Client unwrap
// Server Component (page.tsx)
import Posts from '@/app/ui/posts'
import { Suspense } from 'react'

export default function Page() {
  const posts = getPosts()  // â† KHÃ”NG await! Truyá»n promise
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Posts posts={posts} />
    </Suspense>
  )
}

// Client Component (posts.tsx)
'use client'
import { use } from 'react'

export default function Posts({
  posts,
}: {
  posts: Promise<{ id: string; title: string }[]>
}) {
  const allPosts = use(posts)  // â† Unwrap promise!
  return (
    <ul>
      {allPosts.map((post) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

```typescript
// â‘¡ SWR â€” Community library
'use client'
import useSWR from 'swr'

const fetcher = (url) => fetch(url).then((r) => r.json())

export default function BlogPage() {
  const { data, error, isLoading } = useSWR(
    'https://api.vercel.app/blog',
    fetcher
  )
  if (isLoading) return <div>Loading...</div>
  if (error) return <div>Error: {error.message}</div>
  return (
    <ul>
      {data.map((post: { id: string; title: string }) => (
        <li key={post.id}>{post.title}</li>
      ))}
    </ul>
  )
}
```

---

## Â§4. Deduplicate Requests & Cache Data!

```
  DEDUPLICATION & CACHING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€: Nhiá»u components cÃ¹ng fetch 1 URL!          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  <Layout />  â†’ fetch('/api/user')  â”€â”            â”‚  â”‚
  â”‚  â”‚  <Header />  â†’ fetch('/api/user')   â”œâ†’ CÃ™NG URL! â”‚  â”‚
  â”‚  â”‚  <Sidebar /> â†’ fetch('/api/user')  â”€â”˜            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘  REQUEST MEMOIZATION (tá»± Ä‘á»™ng!):                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  fetch GET/HEAD + same URL + same options:       â”‚  â”‚
  â”‚  â”‚  â†’ Tá»° Äá»˜NG gá»™p thÃ nh 1 request duy nháº¥t!       â”‚  â”‚
  â”‚  â”‚  â†’ Scoped to lifetime of 1 render pass          â”‚  â”‚
  â”‚  â”‚  â†’ Opt-out: truyá»n AbortSignal                  â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  Component A â”€â”€â†’ fetch('/api/user') â”            â”‚  â”‚
  â”‚  â”‚  Component B â”€â”€â†’ fetch('/api/user') â”œâ†’ 1 REQUEST â”‚  â”‚
  â”‚  â”‚  Component C â”€â”€â†’ fetch('/api/user') â”˜   THáº¬T!    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ DATA CACHE (cross-request):                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  fetch('...', { cache: 'force-cache' })          â”‚  â”‚
  â”‚  â”‚  â†’ Cache data across render passes + requests   â”‚  â”‚
  â”‚  â”‚  â†’ Share data giá»¯a current & incoming requests  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â‘¢ React.cache() â€” cho ORM/DB (khi KHÃ”NG dÃ¹ng fetch): â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  import { cache } from 'react'                   â”‚  â”‚
  â”‚  â”‚  export const getPost = cache(async (id) => {    â”‚  â”‚
  â”‚  â”‚    return await db.query.posts.findFirst(...)    â”‚  â”‚
  â”‚  â”‚  })                                              â”‚  â”‚
  â”‚  â”‚  â†’ Wrap data access â†’ dedup + memoize           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// React.cache() â€” dedup cho ORM/database queries
import { cache } from "react";
import { db, posts, eq } from "@/lib/db";

export const getPost = cache(async (id: string) => {
  const post = await db.query.posts.findFirst({
    where: eq(posts.id, parseInt(id)),
  });
  return post;
});
// Nhiá»u components gá»i getPost(id) â†’ chá»‰ query DB 1 Láº¦N!
```

---

## Â§5. Streaming â€” CÆ¡ Cháº¿ Hoáº¡t Äá»™ng!

```
  STREAMING â€” Táº I SAO Cáº¦N?
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€ KHI KHÃ”NG CÃ“ STREAMING:                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Server Component â†’ fetch data (3s) â†’ render    â”‚  â”‚
  â”‚  â”‚  â†“                                               â”‚  â”‚
  â”‚  â”‚  User tháº¥y BLANK SCREEN 3 giÃ¢y!!                â”‚  â”‚
  â”‚  â”‚  â†’ ToÃ n bá»™ route BLOCKED cho Ä‘áº¿n khi            â”‚  â”‚
  â”‚  â”‚    Táº¤T Cáº¢ data fetched xong                     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  STREAMING GIáº¢I QUYáº¾T:                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Chia page HTML thÃ nh CHUNKS nhá»                â”‚  â”‚
  â”‚  â”‚  â†’ Gá»­i chunks tá»« server â†’ client Dáº¦N Dáº¦N       â”‚  â”‚
  â”‚  â”‚  â†’ User tháº¥y content NGAY khi cÃ³!              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  2 CÃCH STREAMING:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â‘  loading.js  â†’ stream TOÃ€N Bá»˜ page           â”‚  â”‚
  â”‚  â”‚     â†’ Route-level loading state                 â”‚  â”‚
  â”‚  â”‚     â†’ Tá»± Ä‘á»™ng wrap trong <Suspense>             â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â‘¡ <Suspense>  â†’ stream Tá»ªNG component          â”‚  â”‚
  â”‚  â”‚     â†’ Component-level, granular                 â”‚  â”‚
  â”‚  â”‚     â†’ Chá»n fallback UI cho má»—i pháº§n           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¸ PhÃ¢n TÃ­ch HÃ¬nh 1 â€” Streaming Mechanism

```
  HÃŒNH 1 â€” HOW STREAMING WORKS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€ BÃŠN TRÃI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚  "Partial content with loading state"             â”‚   â”‚
  â”‚  â”‚                                                   â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€ Browser (acme.com/blog) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â—‹   â”‚ (header loaded)                â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”¤                                 â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚ â”‚â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â”‚     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â”‚ skel  â”‚ â”‚   skeleton UI      â”‚     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â”‚â–‘â–‘â–‘â–‘â–‘ loading skeleton â–‘â–‘â–‘â–‘â–‘â–‘â”‚     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚   â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
  â”‚  â”‚                                                   â”‚   â”‚
  â”‚  â”‚  â†’ Static parts + skeleton UI gá»­i NGAY!          â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚               â† â† â† STREAMING â† â† â†                  â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€ BÃŠN PHáº¢I â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚  "Suspended content streaming in"                 â”‚   â”‚
  â”‚  â”‚                                                   â”‚   â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
  â”‚  â”‚  â”‚ â–ˆ Content A    â”‚ â†’ thay tháº¿ skeleton 1        â”‚   â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚   â”‚
  â”‚  â”‚  â”‚ â–ˆâ–ˆ Content B   â”‚ â†’ thay tháº¿ skeleton 2        â”‚   â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚   â”‚
  â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆ Content C  â”‚ â†’ thay tháº¿ skeleton 3        â”‚   â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
  â”‚  â”‚                                                   â”‚   â”‚
  â”‚  â”‚  â†’ RSC Payload stream tá»« server                  â”‚   â”‚
  â”‚  â”‚  â†’ Tá»«ng chunk thay tháº¿ skeleton tÆ°Æ¡ng á»©ng       â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                        â”‚
  â”‚  Káº¾T QUáº¢: User tháº¥y layout NGAY, content fill dáº§n!   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. loading.js â€” Auto Loading State!

### ğŸ“¸ PhÃ¢n TÃ­ch HÃ¬nh 2 â€” loading.js File Structure

```
  HÃŒNH 2 â€” FILE TREE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                  â”‚
  â”‚  app/                                            â”‚
  â”‚  â””â”€â”€ blog/                                       â”‚
  â”‚      â”œâ”€â”€ layout.js     â† Layout bá»c ngoÃ i      â”‚
  â”‚      â”œâ”€â”€ loading.js    â† â­ LOADING UI!        â”‚
  â”‚      â””â”€â”€ page.js       â† Page component         â”‚
  â”‚                                                  â”‚
  â”‚  loading.js Ä‘áº·t CÃ™NG FOLDER vá»›i page.js         â”‚
  â”‚  â†’ Next.js Tá»° Äá»˜NG táº¡o loading state!          â”‚
  â”‚                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// loading.js â€” Ä‘Æ¡n giáº£n!
export default function Loading() {
  return <div>Loading...</div>
}
```

### ğŸ“¸ PhÃ¢n TÃ­ch HÃ¬nh 3 â€” Loading State Transition

```
  HÃŒNH 3 â€” LOADING â†’ LOADED TRANSITION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€ TRÆ¯á»šC (Loading State) â”€â”€â”  â”Œâ”€â”€ SAU (Loaded) â”€â”€â”  â”‚
  â”‚  â”‚                           â”‚  â”‚                    â”‚  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
  â”‚  â”‚  â”‚  Our Blog           â”‚  â”‚  â”‚  â”‚  Our Blog    â”‚ â”‚  â”‚
  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â”‚  â”‚  â”‚ Post Title 1â”‚ â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘ skeleton â–‘â–‘â–‘â–‘  â”‚  â”‚â†’â”‚  â”‚ Post Title 2â”‚ â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â”‚  â”‚  â”‚ Post Title 3â”‚ â”‚  â”‚
  â”‚  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚  â”‚  â”‚  â”‚ Post Title 4â”‚ â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
  â”‚  â”‚                           â”‚  â”‚                    â”‚  â”‚
  â”‚  â”‚  "Partial content with    â”‚  â”‚  "Loaded content"  â”‚  â”‚
  â”‚  â”‚   loading state"          â”‚  â”‚                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â†’ Navigation: user NGAY tháº¥y layout + loading UI     â”‚
  â”‚  â†’ Khi data ready: content tá»± swap vÃ o!               â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¸ PhÃ¢n TÃ­ch HÃ¬nh 4 â€” Component Hierarchy (Behind the Scenes)

```
  HÃŒNH 4 â€” BEHIND THE SCENES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  loading.js      â†’    Component Hierarchy              â”‚
  â”‚                                                        â”‚
  â”‚  â”Œâ”€â”€ Files â”€â”€â”€â”€â”      â”Œâ”€â”€ Rendered Tree â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚             â”‚      â”‚                           â”‚    â”‚
  â”‚  â”‚ layout.js   â”‚      â”‚  <Layout>                 â”‚    â”‚
  â”‚  â”‚ loading.js  â”‚  â†’   â”‚    <Suspense              â”‚    â”‚
  â”‚  â”‚ page.js     â”‚      â”‚      fallback={<Loading>}>â”‚    â”‚
  â”‚  â”‚             â”‚      â”‚      <Page />              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    </Suspense>             â”‚    â”‚
  â”‚                        â”‚  </Layout>                 â”‚    â”‚
  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                        â”‚
  â”‚  ÄÃ‚Y LÃ€ CÃCH NEXT.JS LÃ€M BEHIND THE SCENES:         â”‚
  â”‚  â‘  loading.js â†’ biáº¿n thÃ nh <Loading> component        â”‚
  â”‚  â‘¡ Tá»± WRAP page.js vÃ o <Suspense>                     â”‚
  â”‚  â‘¢ loading.js â†’ fallback prop cá»§a <Suspense>          â”‚
  â”‚  â‘£ layout.js â†’ bá»c ngoÃ i cÃ¹ng                        â”‚
  â”‚                                                        â”‚
  â”‚  âš ï¸ loading.js cÅ©ng wrap children (nested routes)     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Suspense â€” Granular Streaming!

```
  <Suspense> â€” KIá»‚M SOÃT CHI TIáº¾T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  loading.js = toÃ n bá»™ route                           â”‚
  â”‚  <Suspense> = CHá»ŒN chÃ­nh xÃ¡c pháº§n nÃ o stream!        â”‚
  â”‚                                                        â”‚
  â”‚  VÃ Dá»¤:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  <div>                                           â”‚  â”‚
  â”‚  â”‚    <header>                                      â”‚  â”‚
  â”‚  â”‚      <h1>Welcome to the Blog</h1>  â† Gá»¬I NGAY  â”‚  â”‚
  â”‚  â”‚      <p>Read the latest posts</p>  â† Gá»¬I NGAY  â”‚  â”‚
  â”‚  â”‚    </header>                                     â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚    <main>                                        â”‚  â”‚
  â”‚  â”‚      <Suspense fallback={<BlogListSkeleton />}> â”‚  â”‚
  â”‚  â”‚        <BlogList />  â† STREAM khi ready!        â”‚  â”‚
  â”‚  â”‚      </Suspense>                                 â”‚  â”‚
  â”‚  â”‚    </main>                                       â”‚  â”‚
  â”‚  â”‚  </div>                                          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  SO SÃNH:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ loading.js    â”‚ <Suspense>                       â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Route-level   â”‚ Component-level                  â”‚  â”‚
  â”‚  â”‚ Tá»± Ä‘á»™ng       â”‚ Manual, chá»n boundary            â”‚  â”‚
  â”‚  â”‚ 1 loading/    â”‚ Nhiá»u boundaries/route           â”‚  â”‚
  â”‚  â”‚ route         â”‚                                  â”‚  â”‚
  â”‚  â”‚ Convention    â”‚ Explicit                          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
import { Suspense } from 'react'
import BlogList from '@/components/BlogList'
import BlogListSkeleton from '@/components/BlogListSkeleton'

export default function BlogPage() {
  return (
    <div>
      {/* Gá»­i NGAY cho client! */}
      <header>
        <h1>Welcome to the Blog</h1>
        <p>Read the latest posts below.</p>
      </header>

      <main>
        {/* Dynamic content â†’ stream khi ready */}
        <Suspense fallback={<BlogListSkeleton />}>
          <BlogList />
        </Suspense>
      </main>
    </div>
  )
}
```

---

## Â§8. Meaningful Loading States!

```
  MEANINGFUL LOADING STATES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  âŒ BAD: "Loading..." text Ä‘Æ¡n giáº£n                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Loading...                                      â”‚  â”‚
  â”‚  â”‚  (User khÃ´ng biáº¿t Ä‘ang load CÃI GÃŒ!)           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âœ… GOOD: Skeleton UI giá»‘ng layout tháº­t!               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                     â”‚  â”‚
  â”‚  â”‚  â”‚ â—‹    â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                          â”‚  â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                                        â”‚  â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                   â”‚  â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                       â”‚  â”‚
  â”‚  â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘                          â”‚  â”‚
  â”‚  â”‚  (User tháº¥y SHAPE cá»§a content sáº¯p hiá»‡n!)        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  BEST PRACTICES:                                       â”‚
  â”‚  â‘  Skeleton = same shape as final content             â”‚
  â”‚  â‘¡ Cover photo, title â†’ hiá»‡n 1 pháº§n meaningful       â”‚
  â”‚  â‘¢ Spinner chá»‰ dÃ¹ng cho interactive actions           â”‚
  â”‚  â‘£ React DevTools: preview loading states!            â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Sequential vs Parallel Data Fetching!

```
  SEQUENTIAL vs PARALLEL:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  â‘  SEQUENTIAL (tuáº§n tá»±) â€” request PHá»¤ THUá»˜C nhau:    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  const artist = await getArtist(username)       â”‚  â”‚
  â”‚  â”‚  //  â†“ Cáº¦N artist.id trÆ°á»›c!                    â”‚  â”‚
  â”‚  â”‚  const playlists = await getPlaylists(artist.id)â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  TIMELINE:                                      â”‚  â”‚
  â”‚  â”‚  â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€                    â”‚  â”‚
  â”‚  â”‚    0        1.5s       3.0s                      â”‚  â”‚
  â”‚  â”‚    â”‚ Artist   â”‚ Playlist â”‚                       â”‚  â”‚
  â”‚  â”‚    â”‚ fetch    â”‚ fetch    â”‚ render                â”‚  â”‚
  â”‚  â”‚    â”‚ BLOCK! â†’ â”‚ BLOCK! â†’ â”‚ UI                   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Tá»•ng: 3s! Má»—i request BLOCK cÃ¡i sau!       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  â†’ FIX: Wrap <Playlists> trong <Suspense>!             â”‚
  â”‚  â†’ Artist render trÆ°á»›c, Playlists stream sau          â”‚
  â”‚                                                        â”‚
  â”‚  â‘¡ PARALLEL (song song) â€” request Äá»˜C Láº¬P:           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  const artistData = getArtist(username)  // NO   â”‚  â”‚
  â”‚  â”‚  const albumsData = getAlbums(username)  // awaitâ”‚  â”‚
  â”‚  â”‚  const [artist, albums] =                        â”‚  â”‚
  â”‚  â”‚    await Promise.all([artistData, albumsData])   â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  TIMELINE:                                      â”‚  â”‚
  â”‚  â”‚  â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€                               â”‚  â”‚
  â”‚  â”‚    0        1.5s                                 â”‚  â”‚
  â”‚  â”‚    â”‚ Artist â”€â”€â”‚                                  â”‚  â”‚
  â”‚  â”‚    â”‚ Albums â”€â”€â”‚ render                           â”‚  â”‚
  â”‚  â”‚    â”‚ PARALLEL!â”‚ UI                               â”‚  â”‚
  â”‚  â”‚                                                  â”‚  â”‚
  â”‚  â”‚  â†’ Tá»•ng: 1.5s! Cáº¢ HAI cháº¡y cÃ¹ng lÃºc!         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  âš ï¸ Promise.all: 1 fail = Táº¤T Cáº¢ fail!               â”‚
  â”‚  â†’ DÃ¹ng Promise.allSettled náº¿u muá»‘n handle riÃªng     â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
// â‘  SEQUENTIAL â€” phá»¥ thuá»™c nhau
export default async function Page({ params }) {
  const { username } = await params
  const artist = await getArtist(username)
  return (
    <>
      <h1>{artist.name}</h1>
      <Suspense fallback={<div>Loading...</div>}>
        <Playlists artistID={artist.id} />  {/* Cáº§n artist.id! */}
      </Suspense>
    </>
  )
}

// â‘¡ PARALLEL â€” Ä‘á»™c láº­p, dÃ¹ng Promise.all
export default async function Page({ params }) {
  const { username } = await params
  // Khá»Ÿi táº¡o Cáº¢ HAI request CÃ™NG LÃšC!
  const artistData = getArtist(username)     // NO await
  const albumsData = getAlbums(username)     // NO await
  const [artist, albums] = await Promise.all([artistData, albumsData])
  return (
    <>
      <h1>{artist.name}</h1>
      <Albums list={albums} />
    </>
  )
}
```

---

## Â§10. Preloading Data!

```
  PRELOADING â€” KHá»I Táº O Sá»šM:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  Váº¤N Äá»€:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  const isAvailable = await checkIsAvailable()    â”‚  â”‚
  â”‚  â”‚  //  â†‘ BLOCK 2s                                 â”‚  â”‚
  â”‚  â”‚  return isAvailable ? <Item id={id} /> : null    â”‚  â”‚
  â”‚  â”‚  //                    â†‘ Item báº¯t Ä‘áº§u fetch á»Ÿ   â”‚  â”‚
  â”‚  â”‚  //                    Ä‘Ã¢y â†’ THÃŠM 2s ná»¯a!       â”‚  â”‚
  â”‚  â”‚  â†’ Tá»•ng: 4s!                                    â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  GIáº¢I PHÃP â€” preload():                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  preload(id)            // â† Báº¯t Ä‘áº§u fetch!    â”‚  â”‚
  â”‚  â”‚  const isAvailable =                             â”‚  â”‚
  â”‚  â”‚    await checkIsAvailable()  // 2s              â”‚  â”‚
  â”‚  â”‚  return isAvailable ? <Item id={id} /> : null    â”‚  â”‚
  â”‚  â”‚  //                    â†‘ Data ÄÃƒ CÃ“ Sáº´N!       â”‚  â”‚
  â”‚  â”‚  â†’ Tá»•ng: 2s! (overlap fetch + check)           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                        â”‚
  â”‚  TIMELINE SO SÃNH:                                     â”‚
  â”‚  TRÆ¯á»šC:  check(2s) â”€â”€â†’ fetch(2s)  = 4s                â”‚
  â”‚  SAU:    check(2s) â”€â”€â†’ ready!     = 2s                 â”‚
  â”‚          fetch(2s) â”€â”˜  (overlap!)                      â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```typescript
import { getItem, checkIsAvailable } from '@/lib/data'

export default async function Page({ params }) {
  const { id } = await params
  preload(id)  // â† Khá»Ÿi táº¡o fetch Sá»šM!
  const isAvailable = await checkIsAvailable()
  return isAvailable ? <Item id={id} /> : null
}

const preload = (id: string) => {
  void getItem(id)  // void = fire-and-forget!
}

export async function Item({ id }: { id: string }) {
  const result = await getItem(id)  // â† Data Ä‘Ã£ cÃ³ sáºµn!
  // ...
}
```

```typescript
// Káº¿t há»£p React.cache + server-only cho reusable preload
import { cache } from "react";
import "server-only";

export const preload = (id: string) => {
  void getItem(id);
};

export const getItem = cache(async (id: string) => {
  // fetch/query data...
});
```

---

## Â§11. PhÃ¢n TÃ­ch HÃ¬nh áº¢nh Tá»« Docs!

> Trang docs chÃ­nh thá»©c cÃ³ **4 hÃ¬nh minh há»a**. DÆ°á»›i Ä‘Ã¢y phÃ¢n tÃ­ch chi tiáº¿t:

### HÃ¬nh 1 â€” Streaming Mechanism

```
  STREAMING MECHANISM:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                        â”‚
  â”‚  HÃ¬nh minh há»a cÃ¡ch streaming hoáº¡t Ä‘á»™ng:              â”‚
  â”‚                                                        â”‚
  â”‚  BÃŠN TRÃI (Initial Response):                          â”‚
  â”‚  â†’ Browser nháº­n HTML Ä‘áº§u tiÃªn                         â”‚
  â”‚  â†’ Static content + skeleton (loading) UI              â”‚
  â”‚  â†’ User tháº¥y layout trang NGAY Láº¬P Tá»¨C              â”‚
  â”‚  â†’ NhÃ£n: "Partial content with loading state"          â”‚
  â”‚                                                        â”‚
  â”‚  BÃŠN PHáº¢I (Streaming Content):                         â”‚
  â”‚  â†’ Server tiáº¿p tá»¥c resolve async components           â”‚
  â”‚  â†’ RSC Payload chunks gá»­i qua HTTP stream             â”‚
  â”‚  â†’ Má»—i chunk THAY THáº¾ skeleton tÆ°Æ¡ng á»©ng             â”‚
  â”‚  â†’ NhÃ£n: "Suspended content streaming in"              â”‚
  â”‚                                                        â”‚
  â”‚  Ã NGHÄ¨A: KhÃ´ng cáº§n chá» Táº¤T Cáº¢ data xong má»›i        â”‚
  â”‚  hiá»‡n trang! Tá»«ng pháº§n hiá»‡n Dáº¦N Dáº¦N.                  â”‚
  â”‚                                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HÃ¬nh 2 â€” loading.js File Structure

```
  FILE TREE â€” Cáº¤U TRÃšC loading.js:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                  â”‚
  â”‚  HÃ¬nh minh há»a nÆ¡i Ä‘áº·t loading.js:              â”‚
  â”‚                                                  â”‚
  â”‚  app/                                            â”‚
  â”‚  â””â”€â”€ blog/                                       â”‚
  â”‚      â”œâ”€â”€ layout.js  â† Layout (persist)          â”‚
  â”‚      â”œâ”€â”€ loading.js â† â­ Loading UI            â”‚
  â”‚      â””â”€â”€ page.js    â† Content (streams)         â”‚
  â”‚                                                  â”‚
  â”‚  Ã NGHÄ¨A:                                       â”‚
  â”‚  â†’ loading.js CÃ™NG LEVEL vá»›i page.js            â”‚
  â”‚  â†’ Next.js tá»± detect + táº¡o Suspense boundary   â”‚
  â”‚  â†’ Convention-based, KHÃ”NG cáº§n config!          â”‚
  â”‚                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HÃ¬nh 3 â€” Loading â†’ Loaded Transition

```
  TRANSITION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                  â”‚
  â”‚  HÃ¬nh minh há»a 2 tráº¡ng thÃ¡i:                    â”‚
  â”‚                                                  â”‚
  â”‚  LEFT: "Partial content with loading state"      â”‚
  â”‚  â†’ Header visible + skeleton cho blog list      â”‚
  â”‚  â†’ User tháº¥y APP ÄANG RESPOND!                 â”‚
  â”‚                                                  â”‚
  â”‚  RIGHT: "Loaded content"                         â”‚
  â”‚  â†’ Skeleton thay báº±ng actual blog posts         â”‚
  â”‚  â†’ Smooth transition, khÃ´ng full page reload    â”‚
  â”‚                                                  â”‚
  â”‚  Ã NGHÄ¨A:                                       â”‚
  â”‚  â†’ Perceived performance Cá»°C Tá»T!             â”‚
  â”‚  â†’ User luÃ´n tháº¥y feedback tá»« app              â”‚
  â”‚                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### HÃ¬nh 4 â€” Component Hierarchy Behind the Scenes

```
  COMPONENT HIERARCHY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                  â”‚
  â”‚  HÃ¬nh minh há»a cÃ¡ch loading.js THáº¬T Sá»° hoáº¡t    â”‚
  â”‚  Ä‘á»™ng bÃªn trong Next.js:                         â”‚
  â”‚                                                  â”‚
  â”‚  FILES:          â†’    COMPONENT TREE:            â”‚
  â”‚  layout.js            <Layout>                   â”‚
  â”‚  loading.js    â†’        <Suspense                â”‚
  â”‚  page.js                  fallback={<Loading>}>  â”‚
  â”‚                           <Page />               â”‚
  â”‚                         </Suspense>              â”‚
  â”‚                       </Layout>                  â”‚
  â”‚                                                  â”‚
  â”‚  Ã NGHÄ¨A:                                       â”‚
  â”‚  â†’ loading.js KHÃ”NG pháº£i magic!                 â”‚
  â”‚  â†’ NÃ³ chá»‰ lÃ  syntactic sugar cho <Suspense>    â”‚
  â”‚  â†’ Next.js tá»± insert Suspense boundary         â”‚
  â”‚  â†’ Loading component = fallback prop            â”‚
  â”‚  â†’ Page component = children cá»§a Suspense       â”‚
  â”‚                                                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§12. Tá»± Viáº¿t â€” Data Fetching Engine!

> **Má»¥c tiÃªu**: MÃ´ phá»ng Server/Client fetching, dedup, streaming â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!

```javascript
var DataFetchingEngine = (function () {
  // 1. REQUEST CACHE (memoization)
  var requestCache = {};
  var pendingRequests = {};

  // 2. SIMULATED DATA SOURCES
  var dataSources = {
    "/api/posts": [
      { id: "1", title: "Hello World" },
      { id: "2", title: "Next.js Deep Dive" },
      { id: "3", title: "React Patterns" },
    ],
    "/api/artist/john": { id: "a1", name: "John", genre: "Rock" },
    "/api/artist/john/albums": [
      { id: "al1", name: "Album 1" },
      { id: "al2", name: "Album 2" },
    ],
  };

  // 3. FETCH WITH DEDUP (Request Memoization)
  function fetchWithDedup(url, options) {
    var key = url + ":" + JSON.stringify(options || {});

    // Already cached in this render pass?
    if (requestCache[key]) {
      console.log("  âš¡ DEDUP HIT: " + url + " (cached!)");
      return requestCache[key];
    }

    // Already pending?
    if (pendingRequests[key]) {
      console.log("  âš¡ DEDUP REUSE: " + url + " (pending!)");
      return pendingRequests[key];
    }

    console.log("  ğŸŒ FETCH: " + url);
    var result = dataSources[url] || null;
    requestCache[key] = result;
    return result;
  }

  // 4. SEQUENTIAL FETCHING
  function sequentialFetch(urls) {
    console.log("\nâ”â”â” SEQUENTIAL FETCH â”â”â”");
    var results = [];
    var totalTime = 0;
    for (var i = 0; i < urls.length; i++) {
      var delay = 500 + Math.floor(Math.random() * 500);
      totalTime += delay;
      console.log("  â³ Fetching " + urls[i] + " (" + delay + "ms)");
      console.log("     â†’ Must wait for previous: BLOCKED!");
      results.push(fetchWithDedup(urls[i]));
    }
    console.log("  ğŸ“Š Total time: ~" + totalTime + "ms (sequential!)");
    return results;
  }

  // 5. PARALLEL FETCHING
  function parallelFetch(urls) {
    console.log("\nâ”â”â” PARALLEL FETCH (Promise.all) â”â”â”");
    var maxDelay = 0;
    var results = [];
    for (var i = 0; i < urls.length; i++) {
      var delay = 500 + Math.floor(Math.random() * 500);
      if (delay > maxDelay) maxDelay = delay;
      console.log("  ğŸš€ Initiated " + urls[i] + " (" + delay + "ms)");
      results.push(fetchWithDedup(urls[i]));
    }
    console.log("  ğŸ“Š Total time: ~" + maxDelay + "ms (parallel!)");
    return results;
  }

  // 6. STREAMING SIMULATOR
  function streamPage(components) {
    console.log("\nâ”â”â” STREAMING â”â”â”");
    var shell = [];
    var streams = [];

    for (var i = 0; i < components.length; i++) {
      var comp = components[i];
      if (comp.static) {
        shell.push("  âœ… [INSTANT] " + comp.name + ": " + comp.html);
      } else {
        shell.push("  â³ [SKELETON] " + comp.name + ": " + comp.fallback);
        streams.push(comp);
      }
    }

    console.log("\n  === STATIC SHELL (sent instantly) ===");
    for (var j = 0; j < shell.length; j++) {
      console.log(shell[j]);
    }

    if (streams.length > 0) {
      console.log("\n  === STREAMING (chunks arrive) ===");
      for (var k = 0; k < streams.length; k++) {
        var s = streams[k];
        console.log("  ğŸ“¦ Stream chunk " + (k + 1) + ": " + s.name);
        console.log("     â†’ Replace skeleton with: " + s.html);
      }
    }
  }

  // 7. PRELOAD SIMULATOR
  function preloadDemo() {
    console.log("\nâ”â”â” PRELOAD DEMO â”â”â”");
    console.log("  ğŸš€ preload(id) â†’ void getItem(id)  // fire-and-forget");
    console.log("  â³ await checkIsAvailable()         // 2s");
    console.log("  â†‘ getItem already running in background!");
    console.log("  âœ… <Item /> renders â†’ data ALREADY cached!");
    console.log("  ğŸ“Š Saved: 2s (overlap preload + check)");
  }

  // 8. DEMO
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘  DATA FETCHING ENGINE â€” DEMO              â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // Dedup demo
    console.log("\nâ”â”â” REQUEST MEMOIZATION â”â”â”");
    fetchWithDedup("/api/posts");
    fetchWithDedup("/api/posts"); // DEDUP!
    fetchWithDedup("/api/posts"); // DEDUP!

    // Sequential vs Parallel
    var urls = ["/api/artist/john", "/api/artist/john/albums"];
    sequentialFetch(urls);
    requestCache = {}; // Reset cache
    parallelFetch(urls);

    // Streaming
    streamPage([
      { name: "Header", static: true, html: "<h1>Blog</h1>" },
      { name: "Nav", static: true, html: "<nav>Home|About</nav>" },
      {
        name: "BlogList",
        static: false,
        fallback: "<div>Loading posts...</div>",
        html: "<ul><li>Post 1</li><li>Post 2</li></ul>",
      },
      {
        name: "UserPrefs",
        static: false,
        fallback: "<div>Loading prefs...</div>",
        html: "<div>Theme: dark</div>",
      },
    ]);

    // Preload
    preloadDemo();
  }

  return {
    fetchWithDedup: fetchWithDedup,
    sequentialFetch: sequentialFetch,
    parallelFetch: parallelFetch,
    streamPage: streamPage,
    demo: demo,
  };
})();
// Cháº¡y thá»­: DataFetchingEngine.demo();
```

---

## Â§13. Tá»•ng Káº¿t & CÃ¢u Há»i Luyá»‡n Táº­p!

```
  Tá»”NG Káº¾T:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  â‘  Server: fetch API, ORM/DB, Node.js APIs           â”‚
  â”‚  â‘¡ Client: use() API (stream promise) + SWR/RQ       â”‚
  â”‚  â‘¢ Dedup: Request Memoization (tá»± Ä‘á»™ng cho fetch)    â”‚
  â”‚  â‘£ Data Cache: force-cache cho cross-request          â”‚
  â”‚  â‘¤ React.cache(): dedup cho ORM/DB queries           â”‚
  â”‚  â‘¥ Streaming: loading.js (route) + Suspense (comp)   â”‚
  â”‚  â‘¦ loading.js = syntactic sugar cho <Suspense>       â”‚
  â”‚  â‘§ Sequential: request phá»¥ thuá»™c + Suspense          â”‚
  â”‚  â‘¨ Parallel: Promise.all cho independent requests    â”‚
  â”‚  â‘© Preload: void getItem(id) = fire-and-forget       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÃ¢u Há»i Luyá»‡n Táº­p

**CÃ¢u 1**: Server Components vs Client Components â€” khi nÃ o fetch á»Ÿ Ä‘Ã¢u?

<details><summary>ÄÃ¡p Ã¡n</summary>

**Server Components**: Máº·c Ä‘á»‹nh dÃ¹ng khi cÃ³ thá»ƒ! Gáº§n data source (DB, API), khÃ´ng lá»™ secrets, giáº£m client bundle. DÃ¹ng fetch API hoáº·c ORM trá»±c tiáº¿p.

**Client Components**: Chá»‰ khi cáº§n interactivity (real-time updates, user events). DÃ¹ng `use()` API Ä‘á»ƒ stream promise tá»« server, hoáº·c SWR/React Query.

</details>

---

**CÃ¢u 2**: Request Memoization hoáº¡t Ä‘á»™ng tháº¿ nÃ o? Khi nÃ o Tá»° Äá»˜NG, khi nÃ o cáº§n manual?

<details><summary>ÄÃ¡p Ã¡n</summary>

**Tá»± Ä‘á»™ng**: `fetch` vá»›i `GET/HEAD` + same URL + same options â†’ gá»™p thÃ nh 1 request. Scoped to 1 render pass. Opt-out báº±ng AbortSignal.

**Manual**: Khi dÃ¹ng ORM/DB (khÃ´ng dÃ¹ng fetch) â†’ wrap báº±ng `React.cache()`. VD: `export const getPost = cache(async (id) => db.query(...))`

</details>

---

**CÃ¢u 3**: `loading.js` tháº­t sá»± lÃ m gÃ¬ behind the scenes?

<details><summary>ÄÃ¡p Ã¡n</summary>

`loading.js` = syntactic sugar! Next.js tá»±:

1. Import `loading.js` â†’ táº¡o `<Loading>` component
2. Wrap `page.js` vÃ o `<Suspense fallback={<Loading>}>`
3. Insert vÃ o trong `<Layout>` tree

Káº¿t quáº£: `<Layout> â†’ <Suspense fallback={<Loading>}> â†’ <Page />`

</details>

---

**CÃ¢u 4**: Sequential vs Parallel fetching â€” giáº£i thÃ­ch timeline?

<details><summary>ÄÃ¡p Ã¡n</summary>

|         | Sequential               | Parallel                                             |
| ------- | ------------------------ | ---------------------------------------------------- |
| CÃ¡ch    | `await A; await B;`      | `const a=A(); const b=B(); await Promise.all([a,b])` |
| Time    | time(A) + time(B)        | max(time(A), time(B))                                |
| VD      | A=1.5s + B=1.5s = **3s** | max(1.5s, 1.5s) = **1.5s**                           |
| Khi nÃ o | B Cáº¦N data tá»« A          | A vÃ  B Äá»˜C Láº¬P                                       |

âš ï¸ `Promise.all`: 1 fail = táº¥t cáº£ fail â†’ dÃ¹ng `Promise.allSettled` náº¿u cáº§n handle riÃªng.

</details>

---

**CÃ¢u 5**: `use()` API khÃ¡c `await` tháº¿ nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

|          | `await`                         | `use()`                     |
| -------- | ------------------------------- | --------------------------- |
| á» Ä‘Ã¢u    | Server Components               | Client Components           |
| CÃ¡ch     | `const data = await fetch(...)` | `const data = use(promise)` |
| Promise  | Resolve trÃªn server             | Stream tá»« server â†’ client   |
| Suspense | KhÃ´ng cáº§n                       | Cáº¦N `<Suspense>` wrapper!   |

Flow: Server táº¡o promise (KHÃ”NG await) â†’ truyá»n qua props â†’ Client dÃ¹ng `use()` â†’ Suspense hiá»‡n fallback cho Ä‘áº¿n khi resolve.

</details>

---

**CÃ¢u 6**: Preloading data giÃºp gÃ¬? Viáº¿t pattern preload.

<details><summary>ÄÃ¡p Ã¡n</summary>

**GiÃºp**: Overlap computation! Thay vÃ¬ sequential (check 2s â†’ fetch 2s = 4s), khá»Ÿi táº¡o fetch Sá»šM â†’ overlap vá»›i blocking operation â†’ 2s!

```
const preload = (id) => { void getItem(id) }
// void = fire-and-forget, khÃ´ng await

preload(id)                    // â† báº¯t Ä‘áº§u fetch ngay!
const ok = await check()       // â† 2s (fetch cháº¡y song song!)
return ok ? <Item id={id} /> : null  // â† data Ä‘Ã£ cÃ³!
```

Káº¿t há»£p `React.cache()` + `server-only` cho reusable utility.

</details>

---

**CÃ¢u 7**: CÃ³ bao nhiá»u cÃ¡ch streaming trong Next.js? So sÃ¡nh chÃºng.

<details><summary>ÄÃ¡p Ã¡n</summary>

|               | `loading.js`             | `<Suspense>`           |
| ------------- | ------------------------ | ---------------------- |
| Level         | Route (page)             | Component              |
| Setup         | Convention (file-based)  | Explicit (JSX)         |
| Granularity   | 1 loading/route          | Nhiá»u boundaries/route |
| Behind scenes | Tá»± wrap vÃ o `<Suspense>` | ChÃ­nh nÃ³!              |
| Best for      | ToÃ n bá»™ page cáº§n loading | Tá»«ng pháº§n riÃªng biá»‡t   |

Tip: Káº¿t há»£p cáº£ 2! `loading.js` cho route-level + `<Suspense>` cho critical sections bÃªn trong.

</details>
