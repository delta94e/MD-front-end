# Next.js Caching â€” Deep Dive!

> **Chá»§ Ä‘á»**: Caching trong Next.js â€” Hiá»ƒu sÃ¢u cÆ¡ cháº¿ cache!
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/guides/caching
> **Sá»‘ sÆ¡ Ä‘á»“ gá»‘c**: 8 diagrams â€” táº¥t cáº£ Ä‘Æ°á»£c phÃ¢n tÃ­ch chi tiáº¿t!

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” 4 CÆ¡ Cháº¿ Cache](#1)
2. [Â§2. PhÃ¢n TÃ­ch 8 SÆ¡ Äá»“ Gá»‘c](#2)
3. [Â§3. Rendering Strategies](#3)
4. [Â§4. Request Memoization](#4)
5. [Â§5. Data Cache](#5)
6. [Â§6. Full Route Cache](#6)
7. [Â§7. Client-side Router Cache](#7)
8. [Â§8. Cache Interactions](#8)
9. [Â§9. APIs áº¢nh HÆ°á»Ÿng Cache](#9)
10. [Â§10. Tá»± Viáº¿t â€” CacheEngine](#10)
11. [Â§11. CÃ¢u Há»i Luyá»‡n Táº­p](#11)

---

## Â§1. Tá»•ng Quan â€” 4 CÆ¡ Cháº¿ Cache!

```
  4 CÆ  CHáº¾ CACHING TRONG NEXT.JS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                             â”‚
  â”‚  Next.js cache Má»ŒI THá»¨ cÃ³ thá»ƒ â†’ tá»‘i Æ°u hiá»‡u suáº¥t!        â”‚
  â”‚  Máº·c Ä‘á»‹nh: routes = STATIC, data requests = CACHED!        â”‚
  â”‚                                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â” â”‚
  â”‚  â”‚  Router    â”‚   â”‚ Full Route  â”‚   â”‚ Request   â”‚   â”‚Dataâ”‚ â”‚
  â”‚  â”‚  Cache     â”‚   â”‚ Cache       â”‚   â”‚ Memoize   â”‚   â”‚Cashâ”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ CLIENT    â”‚   â”‚ SERVER      â”‚   â”‚ SERVER    â”‚   â”‚SVR â”‚ â”‚
  â”‚  â”‚ in-memory â”‚   â”‚ persistent  â”‚   â”‚ in-memory â”‚   â”‚per.â”‚ â”‚
  â”‚  â”‚ RSC       â”‚   â”‚ RSC Payload â”‚   â”‚ Function  â”‚   â”‚JSONâ”‚ â”‚
  â”‚  â”‚ Payload   â”‚   â”‚ + HTML      â”‚   â”‚ Returns   â”‚   â”‚    â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”˜ â”‚
  â”‚       â†‘                â†‘                 â†‘            â†‘    â”‚
  â”‚    Browser          Server           Rendering    Data     â”‚
  â”‚    Navigation      Build/Reval      Render Pass   Source   â”‚
  â”‚                                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Mechanism     â”‚ Vá»‹ trÃ­  â”‚ Má»¥c Ä‘Ã­ch    â”‚ Duration   â”‚   â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
  â”‚  â”‚ Request Memo  â”‚ Server  â”‚ Dedupe fetchâ”‚ 1 render   â”‚   â”‚
  â”‚  â”‚ Data Cache    â”‚ Server  â”‚ LÆ°u data    â”‚ Persistent â”‚   â”‚
  â”‚  â”‚ Full Route    â”‚ Server  â”‚ LÆ°u HTML+RSCâ”‚ Persistent â”‚   â”‚
  â”‚  â”‚ Router Cache  â”‚ Client  â”‚ Prefetch    â”‚ Session    â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. PhÃ¢n TÃ­ch 8 SÆ¡ Äá»“ Gá»‘c!

### SÆ¡ Ä‘á»“ 1: Tá»•ng Quan Caching (Overview)

```
  SÆ  Äá»’ 1 â€” DEFAULT CACHING BEHAVIOR:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  CLIENT                       SERVER                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚ Router   â”‚  â”‚  Full Route  â”‚ Rendering â”‚Requestâ”‚Dataâ”‚  â”‚
  â”‚  â”‚ Cache    â”‚  â”‚  Cache       â”‚           â”‚Memo   â”‚Cashâ”‚  â”‚
  â”‚  â”‚ (memory) â”‚  â”‚  (persist)   â”‚           â”‚(mem)  â”‚(p) â”‚  â”‚
  â”‚  â”‚ RSC      â”‚  â”‚  RSC+HTML    â”‚           â”‚Fn Ret â”‚JSONâ”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                            â”‚
  â”‚  BUILD TIME:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  /a â”€â”€â†’ Render â”€â”€â†’ Fetch â”€â”€â†’ MISS â”€â”€â†’ MISS â”€â”€â†’ HIT â”‚  â”‚
  â”‚  â”‚                            â†â”€â”€ SET  â†â”€â”€ SET         â”‚  â”‚
  â”‚  â”‚  SET  â†â”€â”€ Render To Payload                          â”‚  â”‚
  â”‚  â”‚  SET  â†â”€â”€ Render To HTML                             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  REQUEST TIME:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  /a â”€â”€â†’ MISS â”€â”€â†’ HIT (Full Route Cache!)            â”‚  â”‚
  â”‚  â”‚  SET  â†â”€â”€ (Router Cache lÆ°u RSC Payload)             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  GIáº¢I THÃCH:                                               â”‚
  â”‚  â†’ Build time: React render â†’ fetch data â†’ cache data     â”‚
  â”‚  â†’ Request time: serve tá»« Full Route Cache!               â”‚
  â”‚  â†’ Client cache RSC Payload cho navigation sau!           â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 2: Deduplicated Fetch Requests

```
  SÆ  Äá»’ 2 â€” DEDUPE FETCH REQUESTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  React Component Tree:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
  â”‚  â”‚ Layout   â”‚ â†’ fetch('/api/data')  â† Láº¦N 1: thá»±c thi!  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                              â”‚
  â”‚  â”‚ Page     â”‚ â†’ fetch('/api/data')  â† Láº¦N 2: dÃ¹ng cache! â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                              â”‚
  â”‚  â”‚Component â”‚ â†’ fetch('/api/data')  â† Láº¦N 3: dÃ¹ng cache! â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
  â”‚                                                            â”‚
  â”‚  â†’ CÃ¹ng URL + options = CHá»ˆ FETCH 1 Láº¦N!                 â”‚
  â”‚  â†’ KhÃ´ng cáº§n prop drilling data xuá»‘ng!                    â”‚
  â”‚  â†’ Má»—i component tá»± fetch â€” React tá»± dedupe!             â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 3: Request Memoization Lifecycle

```
  SÆ  Äá»’ 3 â€” MEMOIZATION MISS â†’ HIT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  Rendering pass báº¯t Ä‘áº§u:                                  â”‚
  â”‚                                                            â”‚
  â”‚  fetch('/api/item/1')                                      â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Check memory cache â†’ MISS!                               â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Execute function â†’ fetch external â†’ GET data             â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Store result in memory                                    â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Return data                                               â”‚
  â”‚                                                            â”‚
  â”‚  fetch('/api/item/1')  â† Láº¦N 2                           â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Check memory cache â†’ HIT!                                â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  Return cached data (KHÃ”NG fetch!)                        â”‚
  â”‚                                                            â”‚
  â”‚  Rendering pass káº¿t thÃºc â†’ CLEAR memory!                  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 4: Data Cache â€” Cached vs Uncached

```
  SÆ  Äá»’ 4 â€” DATA CACHE INTERACTION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  â‘  force-cache (CACHED):                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  fetch('...', { cache: 'force-cache' })              â”‚  â”‚
  â”‚  â”‚    â”‚                                                  â”‚  â”‚
  â”‚  â”‚    â–¼                                                  â”‚  â”‚
  â”‚  â”‚  Data Cache â†’ MISS láº§n Ä‘áº§u                           â”‚  â”‚
  â”‚  â”‚    â”‚                                                  â”‚  â”‚
  â”‚  â”‚    â–¼                                                  â”‚  â”‚
  â”‚  â”‚  Fetch from Data Source â†’ SET into Data Cache         â”‚  â”‚
  â”‚  â”‚    â”‚                                                  â”‚  â”‚
  â”‚  â”‚    â–¼                                                  â”‚  â”‚
  â”‚  â”‚  Láº§n sau â†’ HIT! (tráº£ tá»« cache, KHÃ”NG fetch!)        â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¡ no-store (UNCACHED):                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  fetch('...', { cache: 'no-store' })                 â”‚  â”‚
  â”‚  â”‚    â”‚                                                  â”‚  â”‚
  â”‚  â”‚    â–¼                                                  â”‚  â”‚
  â”‚  â”‚  BYPASS Data Cache â†’ Fetch Data Source Má»–I Láº¦N!     â”‚  â”‚
  â”‚  â”‚  (nhÆ°ng VáºªN Ä‘Æ°á»£c Request Memoize trong render!)     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  KEY INSIGHT: DÃ¹ cached hay uncached, cáº£ hai Ä‘á»u         â”‚
  â”‚  Ä‘Æ°á»£c MEMOIZE trong cÃ¹ng 1 render pass!                   â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 5: Time-based Revalidation

```
  SÆ  Äá»’ 5 â€” STALE-WHILE-REVALIDATE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  fetch('...', { next: { revalidate: 60 } })                â”‚
  â”‚                                                            â”‚
  â”‚  â‘  UNCACHED REQUEST (láº§n Ä‘áº§u):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  /a â”€â”€â†’ fetch â”€â”€â†’ Data Cache MISS â”€â”€â†’ Data Source    â”‚  â”‚
  â”‚  â”‚                   â†â”€â”€ SET (lÆ°u + timestamp!)         â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¡ CACHED REQUEST (< 60s sau):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  /a â”€â”€â†’ fetch â”€â”€â†’ Data Cache HIT! (tráº£ ngay!)       â”‚  â”‚
  â”‚  â”‚  KhÃ´ng gá»i Data Source!                              â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¢ STALE REQUEST (> 60s sau):                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  /a â”€â”€â†’ fetch â”€â”€â†’ Data Cache STALE!                  â”‚  â”‚
  â”‚  â”‚    â”œâ”€â”€ Tráº£ STALE data ngay (user tháº¥y data cÅ©!)     â”‚  â”‚
  â”‚  â”‚    â””â”€â”€ BACKGROUND: Revalidate!                       â”‚  â”‚
  â”‚  â”‚        â”œâ”€â”€ Fetch Data Source má»›i                      â”‚  â”‚
  â”‚  â”‚        â”œâ”€â”€ SET data má»›i vÃ o cache                    â”‚  â”‚
  â”‚  â”‚        â””â”€â”€ Láº§n sau â†’ data Má»šI!                      â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚  Náº¿u background fetch FAIL â†’ giá»¯ data cÅ©!          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 6: On-demand Revalidation

```
  SÆ  Äá»’ 6 â€” ON-DEMAND REVALIDATION:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  KHÃC vá»›i time-based:                                      â”‚
  â”‚  â†’ Time-based: giá»¯ stale data â†’ background refresh       â”‚
  â”‚  â†’ On-demand: PURGE cache ngay â†’ láº§n sau = MISS!         â”‚
  â”‚                                                            â”‚
  â”‚  â‘  Láº§n Ä‘áº§u: fetch â†’ MISS â†’ GET from source â†’ SET        â”‚
  â”‚  â‘¡ Trigger: revalidateTag('blog') hoáº·c                   â”‚
  â”‚             revalidatePath('/blog')                        â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  PURGE cache entries! (xÃ³a sáº¡ch!)                         â”‚
  â”‚    â”‚                                                       â”‚
  â”‚    â–¼                                                       â”‚
  â”‚  â‘¢ Láº§n sau: MISS â†’ fetch from source â†’ SET má»›i!          â”‚
  â”‚                                                            â”‚
  â”‚  2 NÆ I DÃ™NG:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Route Handler: webhook tá»« CMS                        â”‚  â”‚
  â”‚  â”‚   â†’ Revalidate data NHÆ¯NG Router Cache KHÃ”NG clear! â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Server Action: form submit                           â”‚  â”‚
  â”‚  â”‚   â†’ Revalidate data + Router Cache clear!            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 7: Full Route Cache

```
  SÆ  Äá»’ 7 â€” FULL ROUTE CACHE (STATIC):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  SERVER:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Full Route   â”‚  â”‚Rendering â”‚  â”‚ Data Cache/Source â”‚    â”‚
  â”‚  â”‚ Cache        â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â”‚RSC       â”‚ â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â”‚Payload   â”‚ â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â”‚HTML      â”‚ â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚          â”‚  â”‚                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                            â”‚
  â”‚  BUILD TIME / REVALIDATION:                                â”‚
  â”‚  /a â”€â”€â†’ Full Route Cache MISS                              â”‚
  â”‚         â”€â”€â†’ Rendering â”€â”€â†’ Fetch â”€â”€â†’ Data Cache HIT        â”‚
  â”‚    â†â”€â”€ Render To RSC Payload â”€â”€â†’ SET                      â”‚
  â”‚    â†â”€â”€ Render To HTML â”€â”€â†’ SET                              â”‚
  â”‚                                                            â”‚
  â”‚  â†’ Cache cáº£ RSC Payload LáºªN HTML!                        â”‚
  â”‚  â†’ Chá»‰ cho STATIC routes!                                â”‚
  â”‚  â†’ Persistent across user requests!                        â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SÆ¡ Ä‘á»“ 8: Static vs Dynamic Rendering

```
  SÆ  Äá»’ 8 â€” STATIC vs DYNAMIC:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  STATIC ROUTE:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Build time: Render â†’ Cache RSC + HTML               â”‚  â”‚
  â”‚  â”‚  Request: Serve tá»« Full Route Cache!                 â”‚  â”‚
  â”‚  â”‚  Data: Cached in Data Cache!                         â”‚  â”‚
  â”‚  â”‚  â†’ NHANH NHáº¤T!                                      â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  DYNAMIC ROUTE:                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  Build time: KHÃ”NG render!                           â”‚  â”‚
  â”‚  â”‚  Request: Render Má»–I Láº¦N (cookies/headers/search)   â”‚  â”‚
  â”‚  â”‚  Full Route Cache: SKIP!                             â”‚  â”‚
  â”‚  â”‚  Data Cache: VáºªN cÃ³ thá»ƒ dÃ¹ng!                       â”‚  â”‚
  â”‚  â”‚  â†’ Cháº­m hÆ¡n nhÆ°ng luÃ´n fresh!                       â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Rendering Strategies!

```
  STATIC vs DYNAMIC RENDERING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  STATIC (Máº·c Ä‘á»‹nh!):                                      â”‚
  â”‚  â†’ Render táº¡i BUILD TIME hoáº·c sau revalidation            â”‚
  â”‚  â†’ Káº¿t quáº£ cached â†’ reuse across requests                â”‚
  â”‚  â†’ Full Route Cache = YES!                                â”‚
  â”‚                                                            â”‚
  â”‚  DYNAMIC (Opt-in!):                                        â”‚
  â”‚  Chuyá»ƒn sang dynamic KHI dÃ¹ng:                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚  cookies()        â†’ request-specific data!           â”‚  â”‚
  â”‚  â”‚  headers()        â†’ request-specific data!           â”‚  â”‚
  â”‚  â”‚  connection()     â†’ connection info!                 â”‚  â”‚
  â”‚  â”‚  draftMode()      â†’ draft content!                   â”‚  â”‚
  â”‚  â”‚  searchParams     â†’ URL query params!                â”‚  â”‚
  â”‚  â”‚  unstable_noStore â†’ explicit opt-out!                â”‚  â”‚
  â”‚  â”‚  fetch({ cache: 'no-store' }) â†’ uncached fetch!     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â†’ Dynamic routes KHÃ”NG cÃ³ Full Route Cache               â”‚
  â”‚  â†’ NHÆ¯NG váº«n cÃ³ thá»ƒ dÃ¹ng Data Cache!                     â”‚
  â”‚  â†’ DÃ¹ng Cache Components Ä‘á»ƒ MIX static + dynamic!        â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Request Memoization!

```
  REQUEST MEMOIZATION â€” REACT FEATURE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  LÃ€ GÃŒ? React tá»± Ä‘á»™ng dedupe fetch cÃ¹ng URL+options!     â”‚
  â”‚  â†’ Gá»i fetch 10 láº§n = chá»‰ THá»°C THI 1 láº§n!               â”‚
  â”‚  â†’ Chá»‰ trong 1 render pass!                               â”‚
  â”‚  â†’ Chá»‰ GET method!                                        â”‚
  â”‚  â†’ Chá»‰ trong React Component tree!                        â”‚
  â”‚                                                            â”‚
  â”‚  ÃP Dá»¤NG CHO:                                             â”‚
  â”‚  âœ… Server Components (Layout, Page...)                    â”‚
  â”‚  âœ… generateMetadata, generateStaticParams                 â”‚
  â”‚  âŒ Route Handlers (khÃ´ng pháº£i component tree!)           â”‚
  â”‚                                                            â”‚
  â”‚  DURATION: 1 server request = 1 render pass               â”‚
  â”‚  â†’ Render xong = CLEAR háº¿t memory!                        â”‚
  â”‚  â†’ KhÃ´ng cáº§n revalidate (tá»± clear!)                       â”‚
  â”‚                                                            â”‚
  â”‚  OPT-OUT: DÃ¹ng AbortController signal                     â”‚
  â”‚  const { signal } = new AbortController()                  â”‚
  â”‚  fetch(url, { signal })                                    â”‚
  â”‚                                                            â”‚
  â”‚  KHÃ”NG DÃ™NG FETCH? â†’ React.cache():                       â”‚
  â”‚  import { cache } from 'react'                             â”‚
  â”‚  const getItem = cache(async (id) => {                     â”‚
  â”‚    return db.item.findUnique({ id })                       â”‚
  â”‚  })                                                        â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Data Cache!

```
  DATA CACHE â€” PERSISTENT SERVER CACHE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  LÃ€ GÃŒ? Cache Káº¾T QUáº¢ FETCH trÃªn server!                â”‚
  â”‚  â†’ Persistent across requests + deployments!              â”‚
  â”‚  â†’ Next.js extends fetch API Ä‘á»ƒ má»—i request tá»± set      â”‚
  â”‚    caching semantics riÃªng!                                â”‚
  â”‚                                                            â”‚
  â”‚  SO SÃNH Vá»šI MEMOIZATION:                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚         â”‚ Request Memo   â”‚ Data Cache               â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Durationâ”‚ 1 render pass  â”‚ Persistent!              â”‚  â”‚
  â”‚  â”‚ Scope   â”‚ Component tree â”‚ Across requests          â”‚  â”‚
  â”‚  â”‚ Feature â”‚ React          â”‚ Next.js                  â”‚  â”‚
  â”‚  â”‚ Storage â”‚ Memory         â”‚ Disk/persistent          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  REVALIDATION â€” 2 CÃCH:                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ â‘  Time-based: fetch('...', {                         â”‚  â”‚
  â”‚  â”‚      next: { revalidate: 3600 }  // 1 giá»           â”‚  â”‚
  â”‚  â”‚    })                                                 â”‚  â”‚
  â”‚  â”‚    â†’ Stale-while-revalidate!                         â”‚  â”‚
  â”‚  â”‚    â†’ Serve stale â†’ background refresh!              â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â‘¡ On-demand: revalidateTag('blog')                   â”‚  â”‚
  â”‚  â”‚              revalidatePath('/blog')                  â”‚  â”‚
  â”‚  â”‚    â†’ PURGE cache â†’ next request = MISS!             â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  OPT-OUT:                                                  â”‚
  â”‚  fetch('...', { cache: 'no-store' })                       â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Full Route Cache!

```
  FULL ROUTE CACHE â€” CACHE Cáº¢ ROUTE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  LÃ€ GÃŒ? Cache Káº¾T QUáº¢ RENDER (RSC Payload + HTML)!       â”‚
  â”‚  â†’ Chá»‰ cho STATIC routes!                                â”‚
  â”‚  â†’ Build time hoáº·c revalidation!                          â”‚
  â”‚  â†’ Persistent across user requests!                        â”‚
  â”‚                                                            â”‚
  â”‚  5 BÆ¯á»šC HOáº T Äá»˜NG:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ â‘  React render Server Components trÃªn server        â”‚  â”‚
  â”‚  â”‚   â†’ RSC Payload (binary, optimized for streaming)   â”‚  â”‚
  â”‚  â”‚   â†’ Chá»©a: rendered SC, placeholders cho CC,         â”‚  â”‚
  â”‚  â”‚     JS references, props SCâ†’CC                      â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â‘¡ Next.js cache RSC Payload + HTML trÃªn server      â”‚  â”‚
  â”‚  â”‚   â†’ Full Route Cache SET!                            â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â‘¢ Client: Hydration + Reconciliation                 â”‚  â”‚
  â”‚  â”‚   â†’ HTML = instant preview (non-interactive)        â”‚  â”‚
  â”‚  â”‚   â†’ RSC Payload = reconcile DOM                     â”‚  â”‚
  â”‚  â”‚   â†’ JS = hydrate Client Components                  â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â‘£ RSC Payload â†’ Router Cache (client-side!)         â”‚  â”‚
  â”‚  â”‚   â†’ Split by route segment!                          â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ â‘¤ Subsequent navigations:                            â”‚  â”‚
  â”‚  â”‚   â†’ Check Router Cache first!                       â”‚  â”‚
  â”‚  â”‚   â†’ HIT â†’ skip server request!                      â”‚  â”‚
  â”‚  â”‚   â†’ MISS â†’ fetch from server â†’ populate cache!     â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  INVALIDATION:                                             â”‚
  â”‚  â†’ Revalidate Data Cache â†’ invalidate Full Route Cache!  â”‚
  â”‚  â†’ Redeploy â†’ CLEAR Full Route Cache (Data Cache giá»¯!)  â”‚
  â”‚                                                            â”‚
  â”‚  OPT-OUT:                                                  â”‚
  â”‚  â†’ Dynamic API (cookies, headers...) â†’ auto opt-out!     â”‚
  â”‚  â†’ dynamic = 'force-dynamic' â†’ skip BOTH caches!        â”‚
  â”‚  â†’ revalidate = 0 â†’ skip BOTH caches!                   â”‚
  â”‚  â†’ 1 uncached fetch â†’ opt-out Full Route Cache!          â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Client-side Router Cache!

```
  ROUTER CACHE â€” CLIENT IN-MEMORY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  LÃ€ GÃŒ? In-memory cache trÃªn BROWSER!                    â”‚
  â”‚  â†’ LÆ°u RSC Payload, split by route segments!              â”‚
  â”‚  â†’ Layouts + Loading states = cached!                     â”‚
  â”‚  â†’ Pages = KHÃ”NG cached máº·c Ä‘á»‹nh (Next.js 15)!           â”‚
  â”‚                                                            â”‚
  â”‚  Lá»¢I ÃCH:                                                 â”‚
  â”‚  â†’ Instant back/forward!                                  â”‚
  â”‚  â†’ KhÃ´ng full-page reload!                                â”‚
  â”‚  â†’ Preserve React state + browser state!                  â”‚
  â”‚                                                            â”‚
  â”‚  DURATION:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚                    â”‚ Dynamic page â”‚ Static page      â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Default prefetch   â”‚ NOT cached   â”‚ 5 minutes       â”‚  â”‚
  â”‚  â”‚ (prefetch={null})  â”‚              â”‚                  â”‚  â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
  â”‚  â”‚ Full prefetch      â”‚ 5 minutes    â”‚ 5 minutes       â”‚  â”‚
  â”‚  â”‚ (prefetch={true})  â”‚              â”‚                  â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â†’ Page refresh = CLEAR ALL!                              â”‚
  â”‚  â†’ staleTimes config = adjust thá»i gian!                  â”‚
  â”‚                                                            â”‚
  â”‚  INVALIDATION:                                             â”‚
  â”‚  â†’ Server Action + revalidatePath/revalidateTag           â”‚
  â”‚  â†’ cookies.set / cookies.delete                           â”‚
  â”‚  â†’ router.refresh()                                       â”‚
  â”‚  â†’ Opt-out prefetch: <Link prefetch={false}>              â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. Cache Interactions!

```
  CACHE INTERACTIONS â€” CÃCH CÃC CACHE TÆ¯Æ NG TÃC:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                            â”‚
  â”‚  â‘  Data Cache â†” Full Route Cache:                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Revalidate Data Cache â†’ invalidate Full Route Cache!â”‚  â”‚
  â”‚  â”‚ (render output PHá»¤ THUá»˜C data!)                      â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Invalidate Full Route Cache â‰  invalidate Data Cache â”‚  â”‚
  â”‚  â”‚ (cÃ³ thá»ƒ dynamic render vá»›i cached data!)            â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¡ Data Cache â†” Router Cache:                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ Server Action + revalidatePath/Tag                   â”‚  â”‚
  â”‚  â”‚   â†’ Invalidate BOTH Data + Router Cache!            â”‚  â”‚
  â”‚  â”‚                                                      â”‚  â”‚
  â”‚  â”‚ Route Handler + revalidatePath/Tag                   â”‚  â”‚
  â”‚  â”‚   â†’ Invalidate Data Cache ONLY!                     â”‚  â”‚
  â”‚  â”‚   â†’ Router Cache váº«n serve cÅ© cho Ä‘áº¿n refresh!     â”‚  â”‚
  â”‚  â”‚   (vÃ¬ Route Handler khÃ´ng tied to route!)           â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â”‚  â‘¢ revalidatePath vs router.refresh():                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚ revalidatePath:        â”‚ router.refresh():           â”‚  â”‚
  â”‚  â”‚ â†’ Purge Data Cache    â”‚ â†’ KHÃ”NG affect Data Cache  â”‚  â”‚
  â”‚  â”‚ â†’ Purge Full Route    â”‚ â†’ KHÃ”NG affect Full Route  â”‚  â”‚
  â”‚  â”‚ â†’ Server-side API     â”‚ â†’ Clear Router Cache       â”‚  â”‚
  â”‚  â”‚                        â”‚ â†’ Client-side API          â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚                                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. APIs áº¢nh HÆ°á»Ÿng Cache!

```
  APIS & CACHE EFFECTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ API                    â”‚ Routerâ”‚ Full â”‚ Data â”‚ Memo    â”‚
  â”‚                        â”‚ Cache â”‚ Routeâ”‚ Cacheâ”‚         â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ <Link prefetch>        â”‚ SET   â”‚  -   â”‚  -   â”‚  -      â”‚
  â”‚ router.prefetch        â”‚ SET   â”‚  -   â”‚  -   â”‚  -      â”‚
  â”‚ router.refresh         â”‚ CLEAR â”‚  -   â”‚  -   â”‚  -      â”‚
  â”‚ fetch (no options,     â”‚  -    â”‚  -   â”‚  -   â”‚ SET     â”‚
  â”‚   static render)       â”‚  -    â”‚ SET  â”‚ SET  â”‚ SET     â”‚
  â”‚ fetch cache:force-cacheâ”‚  -    â”‚ SET  â”‚ SET  â”‚ SET     â”‚
  â”‚ fetch cache:no-store   â”‚  -    â”‚  -   â”‚  -   â”‚ SET     â”‚
  â”‚ fetch next.revalidate  â”‚  -    â”‚ SET  â”‚ SET  â”‚ SET     â”‚
  â”‚ fetch next.tags        â”‚  -    â”‚ SET  â”‚ SET  â”‚ SET     â”‚
  â”‚ revalidateTag          â”‚ CLEAR*â”‚CLEAR â”‚CLEAR â”‚  -      â”‚
  â”‚ revalidatePath         â”‚ CLEAR*â”‚CLEAR â”‚CLEAR â”‚  -      â”‚
  â”‚ cookies/headers/search â”‚  -    â”‚ OPTâ†“ â”‚  -   â”‚  -      â”‚
  â”‚ dynamic='force-dynamic'â”‚  -    â”‚ OPTâ†“ â”‚ OPTâ†“â”‚  -      â”‚
  â”‚ generateStaticParams   â”‚  -    â”‚ SET  â”‚  -   â”‚  -      â”‚
  â”‚ React.cache            â”‚  -    â”‚  -   â”‚  -   â”‚ SET     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  * = chá»‰ khi trong Server Action!
  OPTâ†“ = opt-out (skip cache)
```

---

## Â§10. Tá»± Viáº¿t â€” CacheEngine!

```javascript
var CacheEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. REQUEST MEMOIZATION (per render)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var memoCache = {};
  var memoHits = 0;
  var memoMisses = 0;

  function memoFetch(url) {
    if (memoCache[url]) {
      memoHits++;
      console.log("  ğŸ“¦ Memo HIT: " + url);
      return memoCache[url];
    }
    memoMisses++;
    console.log("  ğŸ”„ Memo MISS: " + url);
    var data = dataFetch(url);
    memoCache[url] = data;
    return data;
  }

  function clearMemo() {
    memoCache = {};
    console.log("  ğŸ§¹ Memo cleared (render pass done)");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. DATA CACHE (persistent)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var dataCache = {};

  function dataFetch(url, options) {
    var noStore = options && options.cache === "no-store";
    if (!noStore && dataCache[url]) {
      var entry = dataCache[url];
      if (entry.revalidateAt && Date.now() > entry.revalidateAt) {
        console.log(
          "  â° Data STALE: " + url + " â†’ serve stale + background refresh",
        );
        setTimeout(function () {
          var fresh = fetchFromSource(url);
          dataCache[url] = {
            data: fresh,
            revalidateAt: entry.revalidateAt ? Date.now() + entry.ttl : null,
            ttl: entry.ttl,
          };
          console.log("  ğŸ”„ Background refresh done: " + url);
        }, 0);
        return entry.data;
      }
      console.log("  ğŸ’¾ Data Cache HIT: " + url);
      return entry.data;
    }
    var data = fetchFromSource(url);
    if (!noStore) {
      var ttl = options && options.next && options.next.revalidate;
      dataCache[url] = {
        data: data,
        revalidateAt: ttl ? Date.now() + ttl * 1000 : null,
        ttl: ttl ? ttl * 1000 : null,
      };
      console.log("  ğŸ’¾ Data Cache SET: " + url);
    } else {
      console.log("  ğŸš« Data Cache SKIP (no-store): " + url);
    }
    return data;
  }

  function fetchFromSource(url) {
    console.log("  ğŸŒ Fetching from source: " + url);
    return { url: url, timestamp: Date.now(), fresh: true };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. FULL ROUTE CACHE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var routeCache = {};

  function renderRoute(path, isDynamic) {
    if (!isDynamic && routeCache[path]) {
      console.log("  ğŸ“„ Full Route HIT: " + path);
      return routeCache[path];
    }
    console.log(
      "  ğŸ”¨ Rendering: " + path + (isDynamic ? " (DYNAMIC)" : " (STATIC)"),
    );
    var html = "<html>" + path + "</html>";
    var rscPayload = { path: path, components: ["Layout", "Page"] };
    if (!isDynamic) {
      routeCache[path] = { html: html, rsc: rscPayload };
      console.log("  ğŸ“„ Full Route SET: " + path);
    }
    clearMemo();
    return { html: html, rsc: rscPayload };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. ROUTER CACHE (client)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var routerCache = {};

  function navigate(path) {
    if (routerCache[path]) {
      console.log("  ğŸƒ Router Cache HIT: " + path);
      return routerCache[path];
    }
    console.log("  ğŸƒ Router Cache MISS: " + path);
    var result = renderRoute(path, false);
    routerCache[path] = result.rsc;
    console.log("  ğŸƒ Router Cache SET: " + path);
    return result;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. REVALIDATION
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function revalidatePath(path) {
    console.log("\n  â™»ï¸ revalidatePath: " + path);
    delete dataCache[path];
    delete routeCache[path];
    delete routerCache[path];
    console.log("  â†’ Purged: Data + Route + Router caches");
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 6. DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘  CACHING ENGINE DEMO                â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    console.log("\nâ”€â”€ Render pass 1 (Build) â”€â”€");
    memoFetch("/api/posts");
    memoFetch("/api/posts");
    memoFetch("/api/posts");
    renderRoute("/blog", false);

    console.log("\nâ”€â”€ Request 1 (User visit) â”€â”€");
    navigate("/blog");

    console.log("\nâ”€â”€ Request 2 (Same page) â”€â”€");
    navigate("/blog");

    console.log("\nâ”€â”€ Revalidation â”€â”€");
    revalidatePath("/blog");

    console.log("\nâ”€â”€ Request 3 (After revalidation) â”€â”€");
    navigate("/blog");

    console.log("\nâ”€â”€ Stats â”€â”€");
    console.log("  Memo hits: " + memoHits + ", misses: " + memoMisses);
  }

  return { demo: demo };
})();
// Cháº¡y: CacheEngine.demo();
```

---

## Â§11. CÃ¢u Há»i Luyá»‡n Táº­p!

**CÃ¢u 1**: 4 cÆ¡ cháº¿ caching trong Next.js lÃ  gÃ¬? So sÃ¡nh duration vÃ  scope!

<details><summary>ÄÃ¡p Ã¡n</summary>

| Mechanism               | Vá»‹ trÃ­              | Duration                               | Scope                |
| ----------------------- | ------------------- | -------------------------------------- | -------------------- |
| **Request Memoization** | Server (memory)     | 1 render pass                          | React component tree |
| **Data Cache**          | Server (persistent) | Across requests + deployments          | Per fetch request    |
| **Full Route Cache**    | Server (persistent) | Across user requests (clear on deploy) | Per route            |
| **Router Cache**        | Client (memory)     | Session (clear on refresh)             | Per route segment    |

</details>

---

**CÃ¢u 2**: Time-based vs On-demand Revalidation â€” khÃ¡c nhau tháº¿ nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

**Time-based** (Stale-While-Revalidate):

- Sau thá»i gian X giÃ¢y, data trá»Ÿ thÃ nh STALE
- Request tiáº¿p theo VáºªN nháº­n stale data
- Background: fetch fresh data â†’ update cache
- Náº¿u fail â†’ giá»¯ stale data

**On-demand**:

- Gá»i `revalidateTag('x')` hoáº·c `revalidatePath('/x')`
- PURGE cache entries ngay láº­p tá»©c! (xÃ³a háº³n)
- Request tiáº¿p theo = MISS â†’ fetch fresh from source
- PhÃ¹ há»£p khi cáº§n data má»›i NGAY (form submit, CMS update)

</details>

---

**CÃ¢u 3**: Táº¡i sao revalidateTag trong Route Handler khÃ´ng clear Router Cache?

<details><summary>ÄÃ¡p Ã¡n</summary>

Route Handler **khÃ´ng tied to specific route** â€” nÃ³ lÃ  standalone HTTP endpoint. Router Cache trÃªn client khÃ´ng biáº¿t Route Handler nÃ o liÃªn quan Ä‘áº¿n route nÃ o, nÃªn khÃ´ng thá»ƒ invalidate chÃ­nh xÃ¡c.

**Server Action** thÃ¬ khÃ¡c â€” nÃ³ luÃ´n tied to route hiá»‡n táº¡i, nÃªn cÃ³ thá»ƒ invalidate Router Cache cho route associated.

Káº¿t quáº£: Revalidate trong Route Handler â†’ Data Cache cleared, nhÆ°ng client váº«n tháº¥y old data cho Ä‘áº¿n khi hard refresh hoáº·c auto-invalidation period háº¿t.

</details>

---

**CÃ¢u 4**: Khi nÃ o route trá»Ÿ thÃ nh dynamic? Liá»‡t kÃª cÃ¡c Dynamic APIs!

<details><summary>ÄÃ¡p Ã¡n</summary>

Route tá»± Ä‘á»™ng chuyá»ƒn sang **dynamic rendering** khi dÃ¹ng:

- `cookies()` â€” Ä‘á»c/ghi cookies
- `headers()` â€” Ä‘á»c request headers
- `connection()` â€” connection info
- `draftMode()` â€” draft mode
- `searchParams` prop â€” URL query parameters
- `unstable_noStore` â€” explicit opt-out
- `fetch({ cache: 'no-store' })` â€” uncached fetch

Dynamic route: **KHÃ”NG** cÃ³ Full Route Cache, nhÆ°ng **VáºªN** cÃ³ thá»ƒ dÃ¹ng Data Cache!

</details>

---

**CÃ¢u 5**: revalidatePath vs router.refresh() â€” khÃ¡c nhau tháº¿ nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

|                      | `revalidatePath`             | `router.refresh()`                 |
| -------------------- | ---------------------------- | ---------------------------------- |
| **Type**             | Server-side API              | Client-side API                    |
| **Data Cache**       | âœ… PURGE                     | âŒ KhÃ´ng affect                    |
| **Full Route Cache** | âœ… PURGE                     | âŒ KhÃ´ng affect                    |
| **Router Cache**     | âœ… CLEAR                     | âœ… CLEAR                           |
| **Re-render**        | Server re-render + cache má»›i | Server re-render (no cache update) |

`revalidatePath` = **deep invalidation** (purge cáº£ 3 caches)
`router.refresh()` = **shallow refresh** (chá»‰ clear Router Cache + re-render)

</details>
