# Next.js File Conventions (Part 2) â€” Deep Dive!

> **Chá»§ Ä‘á»**: instrumentation Â· intercepting-routes Â· layout Â· loading Â· not-found Â· page Â· parallel-routes Â· proxy Â· route Â· route-groups Â· route-segment-config Â· template Â· unauthorized Â· vÃ  nhiá»u hÆ¡n!
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **HÃ¬nh áº£nh**: 9 diagrams phÃ¢n tÃ­ch (2 intercepting + 5 parallel + 2 loading)

---

## Má»¥c Lá»¥c

1. [Â§1. instrumentation.js â€” Server Observability](#1)
2. [Â§2. instrumentation-client.js â€” Client Observability](#2)
3. [Â§3. layout.js â€” Shared UI](#3)
4. [Â§4. template.js â€” Layout khÃ¡c gÃ¬ Template?](#4)
5. [Â§5. page.js â€” Route UI](#5)
6. [Â§6. loading.js â€” Suspense Fallback (2 Diagrams)](#6)
7. [Â§7. not-found.js + global-not-found.js](#7)
8. [Â§8. route.js â€” API Route Handlers](#8)
9. [Â§9. Parallel Routes (5 Diagrams)](#9)
10. [Â§10. Intercepting Routes (2 Diagrams)](#10)
11. [Â§11. proxy.js â€” Middleware Replacement](#11)
12. [Â§12. route-groups / route-segment-config / src / public / mdx-components](#12)
13. [Â§13. unauthorized.js â€” 401 Authentication](#13)
14. [Â§14. MASTER FILE HIERARCHY](#14)
15. [Â§15. Tá»± Viáº¿t â€” FileConventionsEngine2](#15)
16. [Â§16. CÃ¢u Há»i Luyá»‡n Táº­p](#16)

---

## Â§1. instrumentation.js â€” Server Observability!

```
  instrumentation.js â€” SERVER-SIDE MONITORING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: File tÃ­ch há»£p observability tools vÃ o server!         â”‚
  â”‚  WHERE: Root project HOáº¶C src/ folder!                       â”‚
  â”‚                                                              â”‚
  â”‚  2 EXPORTS:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘  register() â€” optional                             â”‚    â”‚
  â”‚  â”‚   â†’ Called ONCE khi server instance khá»Ÿi táº¡o!       â”‚    â”‚
  â”‚  â”‚   â†’ PHáº¢I hoÃ n thÃ nh TRÆ¯á»šC server ready!             â”‚    â”‚
  â”‚  â”‚   â†’ CÃ³ thá»ƒ async!                                   â”‚    â”‚
  â”‚  â”‚   â†’ Use case: setup OpenTelemetry, Sentry, etc.     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚   import { registerOTel } from '@vercel/otel'        â”‚    â”‚
  â”‚  â”‚   export function register() {                       â”‚    â”‚
  â”‚  â”‚     registerOTel('next-app')                         â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ onRequestError() â€” optional                       â”‚    â”‚
  â”‚  â”‚   â†’ Track server errors to observability provider!   â”‚    â”‚
  â”‚  â”‚   â†’ Params: (error, request, context)               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  onRequestError PARAMS:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ error:                                               â”‚    â”‚
  â”‚  â”‚   .message â†’ error message                          â”‚    â”‚
  â”‚  â”‚   .digest  â†’ unique ID (match server logs!)         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ request:                                             â”‚    â”‚
  â”‚  â”‚   .path    â†’ e.g. /blog?name=foo                   â”‚    â”‚
  â”‚  â”‚   .method  â†’ GET, POST, etc.                        â”‚    â”‚
  â”‚  â”‚   .headers â†’ { [key]: string | string[] }           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ context:                                             â”‚    â”‚
  â”‚  â”‚   .routerKind   â†’ 'Pages Router' | 'App Router'    â”‚    â”‚
  â”‚  â”‚   .routePath    â†’ /app/blog/[dynamic]               â”‚    â”‚
  â”‚  â”‚   .routeType    â†’ 'render'|'route'|'action'|'proxy' â”‚    â”‚
  â”‚  â”‚   .renderSource â†’ 'react-server-components' |       â”‚    â”‚
  â”‚  â”‚                    'server-rendering'                â”‚    â”‚
  â”‚  â”‚   .revalidateReason â†’ 'on-demand'|'stale'|undefined â”‚    â”‚
  â”‚  â”‚   .renderType   â†’ 'dynamic' | 'dynamic-resume'     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  RUNTIME TARGETING:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ process.env.NEXT_RUNTIME === 'edge'                  â”‚    â”‚
  â”‚  â”‚   â†’ require('./register.edge')                      â”‚    â”‚
  â”‚  â”‚ else                                                 â”‚    â”‚
  â”‚  â”‚   â†’ require('./register.node')                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. instrumentation-client.js â€” Client Observability!

```
  instrumentation-client.js â€” CLIENT-SIDE MONITORING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: Client-side monitoring, analytics, polyfills!         â”‚
  â”‚  WHERE: Root project HOáº¶C src/ folder!                       â”‚
  â”‚                                                              â”‚
  â”‚  KHÃC instrumentation.js:                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ instrumentation.js    â†’ SERVER (register export)    â”‚    â”‚
  â”‚  â”‚ instrumentation-client â†’ CLIENT (no export needed!) â”‚    â”‚
  â”‚  â”‚   â†’ Just write code directly in the file!           â”‚    â”‚
  â”‚  â”‚   â†’ Optional: export onRouterTransitionStart        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXECUTION TIMING:                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  HTML document loaded                              â”‚    â”‚
  â”‚  â”‚ â‘¡ instrumentation-client.js EXECUTES! â† HERE!      â”‚    â”‚
  â”‚  â”‚ â‘¢ React hydration begins                            â”‚    â”‚
  â”‚  â”‚ â‘£ User interactions possible                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ TIMELINE:                                            â”‚    â”‚
  â”‚  â”‚ â”€â”€[HTML]â”€â”€[instr-client]â”€â”€[hydration]â”€â”€[interactive]â”‚    â”‚
  â”‚  â”‚                â†‘                                     â”‚    â”‚
  â”‚  â”‚           ideal for setup!                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  onRouterTransitionStart(url, navigationType):                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ url: string â†’ URL Ä‘ang navigate tá»›i               â”‚    â”‚
  â”‚  â”‚ navigationType: 'push' | 'replace' | 'traverse'    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export function onRouterTransitionStart(             â”‚    â”‚
  â”‚  â”‚   url: string,                                       â”‚    â”‚
  â”‚  â”‚   navigationType: 'push' | 'replace' | 'traverse'   â”‚    â”‚
  â”‚  â”‚ ) {                                                  â”‚    â”‚
  â”‚  â”‚   console.log(`Nav: ${navigationType} to ${url}`)   â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Error tracking (window.addEventListener('error')) â”‚    â”‚
  â”‚  â”‚ â‘¡ Analytics (analytics.init())                      â”‚    â”‚
  â”‚  â”‚ â‘¢ Performance (PerformanceObserver)                  â”‚    â”‚
  â”‚  â”‚ â‘£ Polyfills (static + conditional dynamic import)   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âš ï¸ Keep lightweight! Warning náº¿u > 16ms init!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. layout.js â€” Shared UI!

```
  layout.js â€” SHARED UI ACROSS ROUTES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: UI shared giá»¯a multiple routes!                       â”‚
  â”‚  KEY: KHÃ”NG re-render khi navigate! State preserved! âœ…     â”‚
  â”‚                                                              â”‚
  â”‚  PROPS:                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ children: React.ReactNode â€” REQUIRED!               â”‚    â”‚
  â”‚  â”‚   â†’ Populated with child Layout/Page/Loading/Error  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ params: Promise<{ ... }> â€” optional!                â”‚    â”‚
  â”‚  â”‚   â†’ Dynamic route params (async/await or use())     â”‚    â”‚
  â”‚  â”‚   â†’ LayoutProps<'/dashboard'> helper for typing     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  ROOT LAYOUT (app/layout.js):                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ MUST define <html> and <body> tags!               â”‚    â”‚
  â”‚  â”‚ â†’ DON'T add <head>/<title>/<meta> manually!         â”‚    â”‚
  â”‚  â”‚   Use Metadata API instead!                          â”‚    â”‚
  â”‚  â”‚ â†’ Multiple root layouts possible:                    â”‚    â”‚
  â”‚  â”‚   app/(shop)/layout.js + app/(marketing)/layout.js â”‚    â”‚
  â”‚  â”‚   âš ï¸ Navigate between them = FULL PAGE LOAD!       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CAVEATS (quan trá»ng!):                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NO Request Object!                               â”‚    â”‚
  â”‚  â”‚   â†’ Layout cached during navigation!                â”‚    â”‚
  â”‚  â”‚   â†’ Use headers()/cookies() APIs thay tháº¿!          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NO Query Params!                                 â”‚    â”‚
  â”‚  â”‚   â†’ Layout doesn't re-render on navigation!        â”‚    â”‚
  â”‚  â”‚   â†’ Use useSearchParams() in Client Component!      â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NO Pathname!                                     â”‚    â”‚
  â”‚  â”‚   â†’ Would become stale! No re-render!               â”‚    â”‚
  â”‚  â”‚   â†’ Use usePathname() in Client Component!          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NO passing data to children!                     â”‚    â”‚
  â”‚  â”‚   â†’ Fetch same data in both layout + page!          â”‚    â”‚
  â”‚  â”‚   â†’ React cache() dedupes requests! âœ…              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âœ… useSelectedLayoutSegment(s) for child segments!  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. template.js â€” Layout khÃ¡c gÃ¬ Template?

```
  template.js vs layout.js:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  COMPARISON:                                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚                  â”‚ layout.js     â”‚ template.js   â”‚        â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
  â”‚  â”‚ State on nav     â”‚ PRESERVED âœ… â”‚ RESET âŒ     â”‚        â”‚
  â”‚  â”‚ Re-render        â”‚ NO!           â”‚ YES! (remount)â”‚        â”‚
  â”‚  â”‚ useEffect        â”‚ NOT re-run    â”‚ RE-RUN! âœ…   â”‚        â”‚
  â”‚  â”‚ DOM              â”‚ Preserved     â”‚ Recreated!    â”‚        â”‚
  â”‚  â”‚ Unique key       â”‚ No            â”‚ YES! per seg  â”‚        â”‚
  â”‚  â”‚ Suspense on nav  â”‚ First only    â”‚ EVERY nav! âœ…â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚                                                              â”‚
  â”‚  NESTING ORDER:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Layout>                                             â”‚    â”‚
  â”‚  â”‚   <Template key={routeParam}>                        â”‚    â”‚
  â”‚  â”‚     {children}                                       â”‚    â”‚
  â”‚  â”‚   </Template>                                        â”‚    â”‚
  â”‚  â”‚ </Layout>                                            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Layout wraps Template wraps Page!                    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  REMOUNT BEHAVIOR:                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ / â†’ /about:                                         â”‚    â”‚
  â”‚  â”‚   Root template: key "/" â†’ "/about" â†’ REMOUNTS!     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ /blog â†’ /blog/first-post:                           â”‚    â”‚
  â”‚  â”‚   Root template: key stays "/blog" â†’ NO remount!    â”‚    â”‚
  â”‚  â”‚   Blog template: key "/blog" â†’ "/blog/first-post"   â”‚    â”‚
  â”‚  â”‚                   â†’ REMOUNTS!                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ /blog/first â†’ /blog/second:                         â”‚    â”‚
  â”‚  â”‚   Root template: NO remount (same first segment)    â”‚    â”‚
  â”‚  â”‚   Blog template: REMOUNTS! (child segment changed)  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Re-sync useEffect on every navigation             â”‚    â”‚
  â”‚  â”‚ â‘¡ Reset input field state on route change           â”‚    â”‚
  â”‚  â”‚ â‘¢ Show Suspense fallback on EVERY navigation        â”‚    â”‚
  â”‚  â”‚   (not just first load!)                             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. page.js â€” Route UI!

```
  page.js â€” UNIQUE UI FOR EACH ROUTE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: UI duy nháº¥t cho má»—i route!                            â”‚
  â”‚  KEY FACTS:                                                   â”‚
  â”‚  â†’ .js / .jsx / .tsx extensions                              â”‚
  â”‚  â†’ ALWAYS leaf of route subtree!                             â”‚
  â”‚  â†’ REQUIRED to make route publicly accessible!               â”‚
  â”‚  â†’ Server Component by default!                              â”‚
  â”‚                                                              â”‚
  â”‚  PROPS:                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ params: Promise<{ slug: string }> â€” optional        â”‚    â”‚
  â”‚  â”‚   Server: const { slug } = await params             â”‚    â”‚
  â”‚  â”‚   Client: const { slug } = use(params)              â”‚    â”‚
  â”‚  â”‚   Type helper: PageProps<'/blog/[slug]'>            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ searchParams: Promise<{ [key]: string | string[]    â”‚    â”‚
  â”‚  â”‚                         | undefined }> â€” optional   â”‚    â”‚
  â”‚  â”‚   /shop?a=1      â†’ { a: '1' }                      â”‚    â”‚
  â”‚  â”‚   /shop?a=1&b=2  â†’ { a: '1', b: '2' }              â”‚    â”‚
  â”‚  â”‚   /shop?a=1&a=2  â†’ { a: ['1', '2'] }               â”‚    â”‚
  â”‚  â”‚   âš ï¸ Dynamic API â†’ opts into dynamic rendering!    â”‚    â”‚
  â”‚  â”‚   âš ï¸ Plain object, NOT URLSearchParams!            â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. loading.js â€” Suspense Fallback! (2 Diagrams)

### ğŸ“Š DIAGRAM 1: Instant Loading State

```
  loading.js â€” INSTANT LOADING STATE (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SOFT NAVIGATION (Client-side):                               â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚  â”‚   CURRENT PAGE      â”‚ â†’ â”‚  LOADING STATE       â”‚         â”‚
  â”‚  â”‚   /dashboard        â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
  â”‚  â”‚                     â”‚    â”‚ â”‚ â–‘â–‘â–‘â–‘ Skeleton â–‘â–‘ â”‚ â”‚         â”‚
  â”‚  â”‚                     â”‚    â”‚ â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚ â”‚         â”‚
  â”‚  â”‚                     â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚                                       â”‚                      â”‚
  â”‚                                       â–¼                      â”‚
  â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
  â”‚                              â”‚  LOADED CONTENT      â”‚         â”‚
  â”‚                              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚
  â”‚                              â”‚ â”‚ Actual Page Data â”‚ â”‚         â”‚
  â”‚                              â”‚ â”‚ Tables, Charts   â”‚ â”‚         â”‚
  â”‚                              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚
  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
  â”‚                                                              â”‚
  â”‚  Navigation prefetched â†’ IMMEDIATE skeleton shown!           â”‚
  â”‚  â†’ Interruptible (can navigate away mid-load!)              â”‚
  â”‚  â†’ Shared layouts stay interactive!                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 2: Component Hierarchy

```
  loading.js â€” COMPONENT HIERARCHY (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  FILE STRUCTURE:                                              â”‚
  â”‚  app/dashboard/                                               â”‚
  â”‚    â”œâ”€â”€ layout.js                                              â”‚
  â”‚    â”œâ”€â”€ loading.js   â† Suspense fallback!                     â”‚
  â”‚    â””â”€â”€ page.js                                                â”‚
  â”‚                                                              â”‚
  â”‚  RENDERS AS:                                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Layout>           â† layout.js                      â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ <Header />                                      â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ <SideNav />                                     â”‚    â”‚
  â”‚  â”‚  â”‚                                                   â”‚    â”‚
  â”‚  â”‚  â””â”€â”€ <Suspense fallback={<Loading />}>               â”‚    â”‚
  â”‚  â”‚       â”‚                  â†‘ loading.js                â”‚    â”‚
  â”‚  â”‚       â”‚                                              â”‚    â”‚
  â”‚  â”‚       â””â”€â”€ <Page />  â† page.js                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  loading.js nested INSIDE layout.js!                          â”‚
  â”‚  loading.js auto-wraps page.js in <Suspense>!               â”‚
  â”‚  loading.js wraps ALL children below too!                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chi Tiáº¿t loading.js

```
  loading.js â€” COMPLETE REFERENCE:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  BASICS:                                                      â”‚
  â”‚  â†’ Server Component by default!                              â”‚
  â”‚  â†’ CAN be Client Component ("use client")                   â”‚
  â”‚  â†’ Accepts NO parameters!                                    â”‚
  â”‚                                                              â”‚
  â”‚  SEO:                                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Bots (Twitterbot etc.):                              â”‚    â”‚
  â”‚  â”‚   â†’ generateMetadata resolves BEFORE streaming!     â”‚    â”‚
  â”‚  â”‚   â†’ Metadata in <head> of initial HTML!             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Full browsers:                                       â”‚    â”‚
  â”‚  â”‚   â†’ Streaming metadata may be used!                 â”‚    â”‚
  â”‚  â”‚   â†’ Auto-detect user agents!                        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Server-rendered streaming = NO SEO impact!          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  STATUS CODES:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Streaming â†’ 200 ALWAYS (headers Ä‘Ã£ sent!)           â”‚    â”‚
  â”‚  â”‚ 404 streamed? â†’ <meta robots noindex> injected!     â”‚    â”‚
  â”‚  â”‚   â†’ Google treats as "soft 404"                     â”‚    â”‚
  â”‚  â”‚   â†’ NOT indexed vÃ¬ noindex!                         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âš ï¸ QUAN TRá»ŒNG:                                     â”‚    â”‚
  â”‚  â”‚   notFound() PHáº¢I call TRÆ¯á»šC Suspense boundary!    â”‚    â”‚
  â”‚  â”‚   TRÆ¯á»šC báº¥t ká»³ await nÃ o suspend!                   â”‚    â”‚
  â”‚  â”‚   VÃ¬ headers Ä‘Ã£ sent = KHÃ”NG Ä‘á»•i status code!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  BROWSER LIMITS:                                              â”‚
  â”‚  â†’ Webkit buffers streaming < 1024 bytes!                    â”‚
  â”‚  â†’ Only "hello world" apps affected!                         â”‚
  â”‚                                                              â”‚
  â”‚  STREAMING WITH SUSPENSE (manual):                            â”‚
  â”‚                                                              â”‚
  â”‚  import { Suspense } from 'react'                             â”‚
  â”‚  export default function Posts() {                            â”‚
  â”‚    return (                                                   â”‚
  â”‚      <section>                                                â”‚
  â”‚        <Suspense fallback={<p>Loading feed...</p>}>           â”‚
  â”‚          <PostFeed />                                          â”‚
  â”‚        </Suspense>                                             â”‚
  â”‚        <Suspense fallback={<p>Loading weather...</p>}>        â”‚
  â”‚          <Weather />                                           â”‚
  â”‚        </Suspense>                                             â”‚
  â”‚      </section>                                                â”‚
  â”‚    )                                                           â”‚
  â”‚  }                                                             â”‚
  â”‚  Benefits: â‘  Streaming Server Rendering                      â”‚
  â”‚            â‘¡ Selective Hydration (priority by interaction!)   â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. not-found.js + global-not-found.js

```
  not-found.js â€” 404 HANDLING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  2 CONVENTIONS:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘  not-found.js                                     â”‚    â”‚
  â”‚  â”‚   â†’ Renders khi notFound() gá»i trong route segment â”‚    â”‚
  â”‚  â”‚   â†’ HTTP status: 200 (streamed) hoáº·c 404 (non-streamed) â”‚
  â”‚  â”‚   â†’ Server Component (cÃ³ thá»ƒ async + fetch data!)  â”‚    â”‚
  â”‚  â”‚   â†’ Accepts NO props!                               â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ global-not-found.js (EXPERIMENTAL!)              â”‚    â”‚
  â”‚  â”‚   â†’ 404 page cho TOÃ€N Bá»˜ app!                      â”‚    â”‚
  â”‚  â”‚   â†’ Khi URL KHÃ”NG match ANY route!                  â”‚    â”‚
  â”‚  â”‚   â†’ Skip rendering â†’ return directly!               â”‚    â”‚
  â”‚  â”‚   â†’ MUST define <html> + <body> tags!               â”‚    â”‚
  â”‚  â”‚   â†’ MUST import own styles/fonts!                   â”‚    â”‚
  â”‚  â”‚   â†’ CAN export metadata/generateMetadata!           â”‚    â”‚
  â”‚  â”‚   â†’ Requires: experimental.globalNotFound = true    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  KHI NÃ€O DÃ™NG global-not-found.js?                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Multiple root layouts (no single layout for 404) â”‚    â”‚
  â”‚  â”‚   app/(admin)/layout.tsx + app/(shop)/layout.tsx    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ Top-level dynamic segments                        â”‚    â”‚
  â”‚  â”‚   app/[country]/layout.tsx â†’ hard 404 composition  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Auto <meta robots noindex /> cho 404 pages!             â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§8. route.js â€” API Route Handlers!

```
  route.js â€” API ROUTE HANDLERS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: Custom request handlers using Web Request/Response!    â”‚
  â”‚  WHERE: app/api/[route]/route.js                              â”‚
  â”‚                                                              â”‚
  â”‚  HTTP METHODS (7):                                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ GET / POST / PUT / PATCH / DELETE / HEAD / OPTIONS  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âš ï¸ OPTIONS auto-implemented náº¿u khÃ´ng define!      â”‚    â”‚
  â”‚  â”‚   â†’ Sets Allow header tá»« defined methods!           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  PARAMETERS:                                                  â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ request: NextRequest (extends Web Request)          â”‚    â”‚
  â”‚  â”‚   .cookies  â†’ cookie access                         â”‚    â”‚
  â”‚  â”‚   .nextUrl  â†’ parsed URL with searchParams          â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ context: { params: Promise<{ slug: string }> }      â”‚    â”‚
  â”‚  â”‚   â†’ RouteContext<'/users/[id]'> helper! (global!)  â”‚    â”‚
  â”‚  â”‚   â†’ Types generated: next dev / next build          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLES:                                                    â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Cookies:                                             â”‚    â”‚
  â”‚  â”‚   const store = await cookies()                     â”‚    â”‚
  â”‚  â”‚   store.get('a') / store.set('b','1')               â”‚    â”‚
  â”‚  â”‚   store.delete('c')                                  â”‚    â”‚
  â”‚  â”‚   Or: Set-Cookie header in Response!                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Headers:                                             â”‚    â”‚
  â”‚  â”‚   const list = await headers()                      â”‚    â”‚
  â”‚  â”‚   list.get('referer')                                â”‚    â”‚
  â”‚  â”‚   âš ï¸ Read-only! New Response to set headers!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Revalidate:                                          â”‚    â”‚
  â”‚  â”‚   export const revalidate = 60 // ISR!              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Redirect:                                            â”‚    â”‚
  â”‚  â”‚   import { redirect } from 'next/navigation'        â”‚    â”‚
  â”‚  â”‚   redirect('https://nextjs.org/')                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Dynamic Segments:                                    â”‚    â”‚
  â”‚  â”‚   const { slug } = await params                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Query Params:                                        â”‚    â”‚
  â”‚  â”‚   request.nextUrl.searchParams.get('query')         â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Streaming:                                           â”‚    â”‚
  â”‚  â”‚   Return ReadableStream!                             â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ CORS:                                                â”‚    â”‚
  â”‚  â”‚   Set Access-Control-* headers!                     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§9. Parallel Routes! (5 Diagrams)

### ğŸ“Š DIAGRAM 1: Parallel Dashboard

```
  PARALLEL ROUTES â€” DASHBOARD (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  /dashboard (1 URL â†’ nhiá»u panels cÃ¹ng lÃºc!)                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚                DASHBOARD                           â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
  â”‚  â”‚  â”‚    @team             â”‚ â”‚    @analytics         â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ â”‚ Team Members    â”‚ â”‚ â”‚ â”‚ Revenue Chart    â”‚ â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ â”‚ â€¢ Alice         â”‚ â”‚ â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘ 78%  â”‚ â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ â”‚ â€¢ Bob           â”‚ â”‚ â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 55%  â”‚ â”‚ â”‚      â”‚
  â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  2 slots render SIMULTANEOUSLY trong cÃ¹ng 1 layout!          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 2: Slots & Layout Mapping

```
  SLOTS â€” FILE â†’ LAYOUT MAPPING (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  FILE STRUCTURE:          LAYOUT RECEIVES:                    â”‚
  â”‚                                                              â”‚
  â”‚  app/                                                         â”‚
  â”‚  â”œâ”€â”€ @analytics/          export default function Layout({   â”‚
  â”‚  â”‚   â””â”€â”€ page.js   â”€â”€â†’     analytics,  â† @analytics slot   â”‚
  â”‚  â”œâ”€â”€ @team/                 team,       â† @team slot        â”‚
  â”‚  â”‚   â””â”€â”€ page.js   â”€â”€â†’     children,   â† implicit! (page)  â”‚
  â”‚  â”œâ”€â”€ page.js       â”€â”€â†’   }) {                                â”‚
  â”‚  â””â”€â”€ layout.js                return (                       â”‚
  â”‚                                 <>                            â”‚
  â”‚       @folder = slot!          {children}                    â”‚
  â”‚       KHÃ”NG áº£nh hÆ°á»Ÿng          {team}                        â”‚
  â”‚       URL structure!            {analytics}                   â”‚
  â”‚                                </>                            â”‚
  â”‚  /@analytics/views            )                              â”‚
  â”‚  â†’ URL = /views          }                                   â”‚
  â”‚  (NOT /analytics/views!)                                     â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ children = implicit slot = app/@children/page.js       â”‚
  â”‚  âš ï¸ Separate static/dynamic slots á»Ÿ cÃ¹ng level = ERROR!   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 3: Soft vs Hard Navigation

```
  SOFT vs HARD NAVIGATION (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SOFT NAVIGATION (Client-side, e.g. <Link>):                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Navigate /dashboard â†’ /settings:                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ @team slot:      /settings page renders âœ…          â”‚    â”‚
  â”‚  â”‚ @analytics slot: KEEPS current active page! âœ…     â”‚    â”‚
  â”‚  â”‚                  (even if no /settings in @analytics)â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ PARTIAL RENDER: only changed slot updates!        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  HARD NAVIGATION (Full reload, e.g. browser refresh):        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Refresh at /settings:                                â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ @team slot:      /settings page renders âœ…          â”‚    â”‚
  â”‚  â”‚ @analytics slot: CANNOT recover active state!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ default.js exists?  â†’ RENDER default! âœ…         â”‚    â”‚
  â”‚  â”‚ â†’ default.js missing? â†’ RENDER 404! âŒ             â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 4: Conditional Routes

```
  CONDITIONAL ROUTES (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  ROLE-BASED RENDERING:                                        â”‚
  â”‚                                                              â”‚
  â”‚  app/                                                         â”‚
  â”‚  â”œâ”€â”€ @admin/                                                  â”‚
  â”‚  â”‚   â””â”€â”€ page.js     â† Admin dashboard                      â”‚
  â”‚  â”œâ”€â”€ @user/                                                   â”‚
  â”‚  â”‚   â””â”€â”€ page.js     â† User dashboard                       â”‚
  â”‚  â””â”€â”€ layout.js                                                â”‚
  â”‚                                                              â”‚
  â”‚  export default function Layout({ user, admin }) {            â”‚
  â”‚    const role = checkUserRole()                               â”‚
  â”‚    return role === 'admin' ? admin : user                    â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
  â”‚  â”‚ role=admin   â”‚    â”‚ role=user    â”‚                        â”‚
  â”‚  â”‚ â†’ @admin/    â”‚    â”‚ â†’ @user/     â”‚                        â”‚
  â”‚  â”‚   page.js    â”‚    â”‚   page.js    â”‚                        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 5: Modal Pattern (Parallel + Intercepting)

```
  MODAL PATTERN (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  GOAL: /login má»Ÿ modal (soft) hoáº·c full page (hard)!        â”‚
  â”‚                                                              â”‚
  â”‚  FILE STRUCTURE:                                              â”‚
  â”‚  app/                                                         â”‚
  â”‚  â”œâ”€â”€ @auth/                      â† Parallel Route slot       â”‚
  â”‚  â”‚   â”œâ”€â”€ (.)login/               â† Intercepts /login!       â”‚
  â”‚  â”‚   â”‚   â””â”€â”€ page.tsx            â† <Modal><Login /></Modal> â”‚
  â”‚  â”‚   â”œâ”€â”€ default.tsx             â† return null               â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx               â† return null (root)        â”‚
  â”‚  â”œâ”€â”€ login/                                                   â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx               â† Full login page            â”‚
  â”‚  â””â”€â”€ layout.tsx                 â† Renders {auth} + {children}â”‚
  â”‚                                                              â”‚
  â”‚  SOFT NAV (click <Link href="/login">):                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Current page stays!                                 â”‚    â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚    â”‚
  â”‚  â”‚  â”‚    MODAL          â”‚ â† @auth/(.)login/page.tsx     â”‚    â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                                â”‚    â”‚
  â”‚  â”‚  â”‚  â”‚  Login    â”‚    â”‚                                â”‚    â”‚
  â”‚  â”‚  â”‚  â”‚  Form     â”‚    â”‚                                â”‚    â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                                â”‚    â”‚
  â”‚  â”‚  â”‚  [Close]          â”‚ â† router.back()               â”‚    â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  HARD NAV (refresh at /login):                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚  Full login page!   â† login/page.tsx                â”‚    â”‚
  â”‚  â”‚  No modal!                                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  CLOSING: router.back() hoáº·c <Link href="/">               â”‚
  â”‚  CATCH-ALL: @auth/[...catchAll]/page.tsx â†’ return null      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ThÃªm: Tab Groups + Loading/Error per Slot

```
  TAB GROUPS + INDEPENDENT LOADING:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  TAB GROUPS:                                                  â”‚
  â”‚  app/@analytics/                                              â”‚
  â”‚  â”œâ”€â”€ layout.tsx         â† Tabs: Page Views | Visitors       â”‚
  â”‚  â”œâ”€â”€ page-views/                                              â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx       â† /page-views content                â”‚
  â”‚  â””â”€â”€ visitors/                                                â”‚
  â”‚      â””â”€â”€ page.tsx       â† /visitors content                  â”‚
  â”‚                                                              â”‚
  â”‚  â†’ Má»—i slot navigate INDEPENDENTLY!                         â”‚
  â”‚                                                              â”‚
  â”‚  INDEPENDENT LOADING/ERROR:                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ app/@analytics/                                      â”‚    â”‚
  â”‚  â”‚   â”œâ”€â”€ loading.tsx    â† Loading riÃªng cho analytics! â”‚    â”‚
  â”‚  â”‚   â”œâ”€â”€ error.tsx      â† Error riÃªng cho analytics!   â”‚    â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx                                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ app/@team/                                           â”‚    â”‚
  â”‚  â”‚   â”œâ”€â”€ loading.tsx    â† Loading riÃªng cho team!      â”‚    â”‚
  â”‚  â”‚   â”œâ”€â”€ error.tsx      â† Error riÃªng cho team!        â”‚    â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx                                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â†’ Streamed independently!                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  useSelectedLayoutSegment('auth'):                            â”‚
  â”‚  â†’ Read active segment in parallel route slot!               â”‚
  â”‚  â†’ parallelRoutesKey parameter!                              â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§10. Intercepting Routes! (2 Diagrams)

### ğŸ“Š DIAGRAM 1: Concept â€” Photo Feed Modal

```
  INTERCEPTING ROUTES â€” CONCEPT (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  SCENARIO: Photo feed â†’ click photo â†’ modal overlay!        â”‚
  â”‚                                                              â”‚
  â”‚  SOFT NAVIGATION (click from /feed):                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  /feed (still visible behind!)                     â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€ Photo Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
  â”‚  â”‚  â”‚                                      â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  â”‚        ğŸ“·              â”‚         â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  â”‚    Photo #123          â”‚         â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  â”‚                        â”‚         â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  URL bar: /photo/123                â”‚           â”‚      â”‚
  â”‚  â”‚  â”‚  (intercepted! feed still behind!) â”‚           â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â”‚  HARD NAVIGATION (direct URL / refresh):                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚  /photo/123 (full page!)                           â”‚      â”‚
  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚
  â”‚  â”‚  â”‚           Full Photo Page                   â”‚    â”‚      â”‚
  â”‚  â”‚  â”‚         (NO modal, NO feed behind!)        â”‚    â”‚      â”‚
  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Š DIAGRAM 2: Convention â€” (.) (..) (..)(..) (...)

```
  INTERCEPTING ROUTES â€” CONVENTION (From Docs):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  CONVENTION (tÆ°Æ¡ng tá»± ../ cho route segments):                â”‚
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
  â”‚  â”‚ Pattern â”‚ Meaning                            â”‚             â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
  â”‚  â”‚ (.)     â”‚ Same level                         â”‚             â”‚
  â”‚  â”‚ (..)    â”‚ One level above                    â”‚             â”‚
  â”‚  â”‚ (..)(..)â”‚ Two levels above                   â”‚             â”‚
  â”‚  â”‚ (...)   â”‚ From root app directory            â”‚             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚                                                              â”‚
  â”‚  FILE STRUCTURE EXAMPLE:                                      â”‚
  â”‚  app/                                                         â”‚
  â”‚  â”œâ”€â”€ feed/                                                    â”‚
  â”‚  â”‚   â”œâ”€â”€ @modal/                   â† Parallel slot           â”‚
  â”‚  â”‚   â”‚   â””â”€â”€ (..)photo/            â† Intercept photo!       â”‚
  â”‚  â”‚   â”‚       â””â”€â”€ [id]/                                       â”‚
  â”‚  â”‚   â”‚           â””â”€â”€ page.tsx      â† Modal view              â”‚
  â”‚  â”‚   â””â”€â”€ page.tsx                  â† Feed page               â”‚
  â”‚  â””â”€â”€ photo/                                                   â”‚
  â”‚      â””â”€â”€ [id]/                                                â”‚
  â”‚          â””â”€â”€ page.tsx              â† Full photo page          â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ (..) based on ROUTE SEGMENTS, NOT file-system!          â”‚
  â”‚  âš ï¸ @slot folders NOT counted as segments!                  â”‚
  â”‚  â†’ (..)photo works vÃ¬ @modal is slot, not segment!          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§11. proxy.js â€” Middleware Replacement!

```
  proxy.js (formerly middleware.js):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  âš ï¸ middleware.js â†’ RENAMED to proxy.js!                    â”‚
  â”‚                                                              â”‚
  â”‚  WHAT: Code runs BEFORE every request!                        â”‚
  â”‚  WHERE: Root project hoáº·c src/ (same level as app/)          â”‚
  â”‚  RUNTIME: Node.js (default, CANNOT change!)                  â”‚
  â”‚                                                              â”‚
  â”‚  EXPORTS:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  proxy function (default or named "proxy")        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â‘¡ config object (optional) â€” with matcher:          â”‚    â”‚
  â”‚  â”‚   export const config = {                            â”‚    â”‚
  â”‚  â”‚     matcher: '/about/:path*'                        â”‚    â”‚
  â”‚  â”‚   }                                                  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  NextResponse ACTIONS:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â€¢ redirect â†’ different URL                          â”‚    â”‚
  â”‚  â”‚ â€¢ rewrite â†’ display given URL                       â”‚    â”‚
  â”‚  â”‚ â€¢ Set request/response headers                      â”‚    â”‚
  â”‚  â”‚ â€¢ Set response cookies                              â”‚    â”‚
  â”‚  â”‚ â€¢ Produce response directly                         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXECUTION ORDER:                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  headers (next.config.js)                          â”‚    â”‚
  â”‚  â”‚ â‘¡ redirects (next.config.js)                        â”‚    â”‚
  â”‚  â”‚ â‘¢ PROXY (rewrites, redirects, etc.) â† HERE!        â”‚    â”‚
  â”‚  â”‚ â‘£ beforeFiles rewrites                              â”‚    â”‚
  â”‚  â”‚ â‘¤ Filesystem routes (public/, app/, pages/)        â”‚    â”‚
  â”‚  â”‚ â‘¥ afterFiles rewrites                               â”‚    â”‚
  â”‚  â”‚ â‘¦ Dynamic Routes (/blog/[slug])                    â”‚    â”‚
  â”‚  â”‚ â‘§ fallback rewrites                                 â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ Proxy deployed to CDN for fast handling!                â”‚
  â”‚  âš ï¸ KHÃ”NG share modules/globals vá»›i render code!            â”‚
  â”‚  âš ï¸ Pass info via headers/cookies/rewrites/redirects!      â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§12. route-groups / route-segment-config / src / public / mdx-components

### 12.1 Route Groups â€” (folderName)

```
  ROUTE GROUPS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Convention: (folderName) â€” ngoáº·c trÃ²n!                      â”‚
  â”‚  â†’ Folder lÃ  organizational, KHÃ”NG náº±m trong URL!           â”‚
  â”‚                                                              â”‚
  â”‚  app/                                                         â”‚
  â”‚  â”œâ”€â”€ (marketing)/       â† URL: / (not /marketing/)         â”‚
  â”‚  â”‚   â”œâ”€â”€ about/         â† URL: /about                       â”‚
  â”‚  â”‚   â””â”€â”€ layout.js      â† Marketing layout                  â”‚
  â”‚  â”œâ”€â”€ (shop)/            â† URL: / (not /shop/)              â”‚
  â”‚  â”‚   â”œâ”€â”€ cart/          â† URL: /cart                        â”‚
  â”‚  â”‚   â””â”€â”€ layout.js      â† Shop layout                       â”‚
  â”‚  â””â”€â”€ layout.js          â† Root layout (optional)            â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â‘  Organize routes by team/concern/feature                  â”‚
  â”‚  â‘¡ Define MULTIPLE ROOT LAYOUTS                              â”‚
  â”‚  â‘¢ Opt segments into/out of shared layouts                  â”‚
  â”‚                                                              â”‚
  â”‚  CAVEATS:                                                     â”‚
  â”‚  âš ï¸ Different root layouts â†’ FULL PAGE RELOAD on navigate! â”‚
  â”‚  âš ï¸ Path conflict: (a)/about + (b)/about â†’ ERROR!         â”‚
  â”‚  âš ï¸ No top-level layout.js? â†’ / must be in a group!       â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 Route Segment Config

```
  ROUTE SEGMENT CONFIG:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  âš ï¸ Disabled with cacheComponents flag! Will be deprecated! â”‚
  â”‚  âš ï¸ Only in Server Component Pages/Layouts/Route Handlers! â”‚
  â”‚                                                              â”‚
  â”‚  EXPORTS:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ dynamic: 'auto'|'force-dynamic'|'error'|'force-static'â”‚   â”‚
  â”‚  â”‚   auto: cache as much as possible (default)         â”‚    â”‚
  â”‚  â”‚   force-dynamic: SSR every request (= getSSP)       â”‚    â”‚
  â”‚  â”‚   error: force static, error on dynamic APIs        â”‚    â”‚
  â”‚  â”‚   force-static: force static, empty dynamic values  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ dynamicParams: boolean (default: true)              â”‚    â”‚
  â”‚  â”‚   false â†’ 404 for params not in generateStaticParams â”‚   â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ revalidate: false | 0 | number                      â”‚    â”‚
  â”‚  â”‚   false: cache indefinitely (=Infinity) (default)   â”‚    â”‚
  â”‚  â”‚   0: always dynamic render                           â”‚    â”‚
  â”‚  â”‚   number: ISR interval in seconds                   â”‚    â”‚
  â”‚  â”‚   âš ï¸ MUST be statically analyzable!                â”‚    â”‚
  â”‚  â”‚   âš ï¸ revalidate = 60 âœ… | 60*10 âŒ               â”‚    â”‚
  â”‚  â”‚   âš ï¸ Lowest across layout+page = route frequency! â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ fetchCache: 'auto'|'default-cache'|'only-cache'|   â”‚    â”‚
  â”‚  â”‚   'force-cache'|'force-no-store'|'default-no-store'â”‚    â”‚
  â”‚  â”‚   |'only-no-store'                                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ runtime: 'nodejs' | 'edge' (default: 'nodejs')     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ preferredRegion: 'auto'|'global'|'home'|string[]   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ maxDuration: number (seconds)                       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.3 src Folder

```
  src FOLDER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Alternative: app/ or pages/ â†’ src/app/ or src/pages/       â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ /public stays in ROOT!                                 â”‚
  â”‚  âš ï¸ package.json, next.config.js, tsconfig.json â†’ ROOT!   â”‚
  â”‚  âš ï¸ .env.* files â†’ ROOT!                                   â”‚
  â”‚  âš ï¸ src/app ignored if root app/ exists!                   â”‚
  â”‚  âš ï¸ proxy.js goes in src/ too!                             â”‚
  â”‚  âš ï¸ Tailwind: add /src prefix to content config!          â”‚
  â”‚  âš ï¸ TypeScript @/*: update paths to include src/!         â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.4 public Folder

```
  public FOLDER:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHERE: Root project/public/                                  â”‚
  â”‚  ACCESS: public/avatars/me.png â†’ /avatars/me.png            â”‚
  â”‚                                                              â”‚
  â”‚  CACHING: Cache-Control: public, max-age=0                   â”‚
  â”‚  â†’ CANNOT safely cache (files may change!)                   â”‚
  â”‚                                                              â”‚
  â”‚  METADATA FILES: robots.txt, favicon.ico â†’                   â”‚
  â”‚  Use special metadata files in app/ folder instead!          â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.5 mdx-components.js

```
  mdx-components.js:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  REQUIRED for @next/mdx with App Router!                      â”‚
  â”‚  WHERE: Root project (same level as pages/app/) or src/      â”‚
  â”‚                                                              â”‚
  â”‚  EXPORT: useMDXComponents() â€” single function!               â”‚
  â”‚  â†’ No arguments!                                              â”‚
  â”‚  â†’ Returns MDXComponents object!                              â”‚
  â”‚                                                              â”‚
  â”‚  import type { MDXComponents } from 'mdx/types'              â”‚
  â”‚  const components: MDXComponents = {}                         â”‚
  â”‚  export function useMDXComponents(): MDXComponents {          â”‚
  â”‚    return components                                          â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§13. unauthorized.js â€” 401 Authentication!

```
  unauthorized.js:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: UI khi unauthorized() function Ä‘Æ°á»£c gá»i!              â”‚
  â”‚  STATUS: 401 Unauthorized!                                    â”‚
  â”‚  PROPS: NONE! KhÃ´ng nháº­n props!                               â”‚
  â”‚                                                              â”‚
  â”‚  SO SÃNH 3 ERROR FILES:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
  â”‚  â”‚ File            â”‚ Status     â”‚ Function          â”‚        â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
  â”‚  â”‚ not-found.js    â”‚ 404        â”‚ notFound()        â”‚        â”‚
  â”‚  â”‚ forbidden.js    â”‚ 403        â”‚ forbidden()       â”‚        â”‚
  â”‚  â”‚ unauthorized.js â”‚ 401        â”‚ unauthorized()    â”‚        â”‚
  â”‚  â”‚ error.js        â”‚ 500/varies â”‚ Error Boundary    â”‚        â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
  â”‚                                                              â”‚
  â”‚  USAGE:                                                       â”‚
  â”‚  // page.tsx                                                  â”‚
  â”‚  import { verifySession } from '@/app/lib/dal'                â”‚
  â”‚  import { unauthorized } from 'next/navigation'               â”‚
  â”‚  export default async function DashboardPage() {              â”‚
  â”‚    const session = await verifySession()                      â”‚
  â”‚    if (!session) { unauthorized() }                           â”‚
  â”‚    return <div>Dashboard</div>                                â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â”‚  // unauthorized.js                                           â”‚
  â”‚  import Login from '@/app/components/Login'                   â”‚
  â”‚  export default function Unauthorized() {                     â”‚
  â”‚    return (                                                   â”‚
  â”‚      <main>                                                   â”‚
  â”‚        <h1>401 - Unauthorized</h1>                            â”‚
  â”‚        <p>Please log in to access this page.</p>              â”‚
  â”‚        <Login />                                              â”‚
  â”‚      </main>                                                  â”‚
  â”‚    )                                                          â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§14. MASTER FILE HIERARCHY â€” Táº¥t Cáº£ File Conventions!

```
  NEXT.JS APP ROUTER â€” COMPLETE FILE HIERARCHY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  REQUEST FLOW:                                                â”‚
  â”‚                                                              â”‚
  â”‚  Client Request                                               â”‚
  â”‚       â”‚                                                       â”‚
  â”‚       â–¼                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
  â”‚  â”‚ proxy.js    â”‚ â† Runs FIRST! (redirect/rewrite/headers)   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
  â”‚         â”‚                                                     â”‚
  â”‚         â–¼                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
  â”‚  â”‚ route.js    â”‚ â† API endpoint? Return Response directly!  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   (Cannot coexist with page.js!)            â”‚
  â”‚         â”‚                                                     â”‚
  â”‚         â–¼                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  RENDERING HIERARCHY (nested):                       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  <Layout>           â† layout.js (persistent!)       â”‚    â”‚
  â”‚  â”‚    <Template>       â† template.js (remounts!)       â”‚    â”‚
  â”‚  â”‚      <ErrorBoundary>â† error.js (catches errors!)    â”‚    â”‚
  â”‚  â”‚        <Suspense>   â† loading.js (fallback!)        â”‚    â”‚
  â”‚  â”‚          <Page />   â† page.js (leaf UI!)            â”‚    â”‚
  â”‚  â”‚          <NotFound/>â† not-found.js (404!)           â”‚    â”‚
  â”‚  â”‚        </Suspense>                                   â”‚    â”‚
  â”‚  â”‚      </ErrorBoundary>                                â”‚    â”‚
  â”‚  â”‚    </Template>                                       â”‚    â”‚
  â”‚  â”‚  </Layout>                                           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  + Parallel: @slot â†’ injected as layout prop!       â”‚    â”‚
  â”‚  â”‚  + Intercept: (.)route â†’ overlay same layout!       â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SPECIAL STATUS FILES:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
  â”‚  â”‚ File            â”‚ Status â”‚ Trigger           â”‚             â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
  â”‚  â”‚ not-found.js    â”‚ 404    â”‚ notFound()        â”‚             â”‚
  â”‚  â”‚ forbidden.js    â”‚ 403    â”‚ forbidden()       â”‚             â”‚
  â”‚  â”‚ unauthorized.js â”‚ 401    â”‚ unauthorized()    â”‚             â”‚
  â”‚  â”‚ error.js        â”‚ â€”      â”‚ Error thrown       â”‚             â”‚
  â”‚  â”‚ global-error.js â”‚ â€”      â”‚ Root layout error â”‚             â”‚
  â”‚  â”‚ global-not-foundâ”‚ 404    â”‚ No route matched  â”‚             â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
  â”‚                                                              â”‚
  â”‚  PROJECT-LEVEL FILES:                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ instrumentation.js       â†’ Server monitoring       â”‚     â”‚
  â”‚  â”‚ instrumentation-client.jsâ†’ Client monitoring       â”‚     â”‚
  â”‚  â”‚ proxy.js                 â†’ Request interception    â”‚     â”‚
  â”‚  â”‚ mdx-components.js        â†’ MDX custom components   â”‚     â”‚
  â”‚  â”‚ public/                  â†’ Static assets           â”‚     â”‚
  â”‚  â”‚ src/                     â†’ Alt code location       â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â”‚  ORGANIZATIONAL:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
  â”‚  â”‚ (group)       â†’ Route groups (no URL impact!)      â”‚     â”‚
  â”‚  â”‚ @slot         â†’ Parallel routes slots              â”‚     â”‚
  â”‚  â”‚ (.)intercept  â†’ Intercepting routes                â”‚     â”‚
  â”‚  â”‚ [dynamic]     â†’ Dynamic segments                   â”‚     â”‚
  â”‚  â”‚ [...catchAll] â†’ Catch-all segments                 â”‚     â”‚
  â”‚  â”‚ [[...opt]]    â†’ Optional catch-all                 â”‚     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§15. Tá»± Viáº¿t â€” FileConventionsEngine2!

```javascript
/**
 * FileConventionsEngine2 â€” MÃ´ phá»ng logic file conventions Next.js!
 * Tá»± viáº¿t báº±ng tay, KHÃ”NG dÃ¹ng thÆ° viá»‡n!
 * Covers: rendering hierarchy, proxy execution, parallel slots,
 *         intercepting routes, route-segment-config, template remount
 */
var FileConventionsEngine2 = (function () {

  // 1. RENDERING HIERARCHY SIMULATOR
  function renderHierarchy(segment) {
    var files = segment.files || {};
    var result = { rendered: [], errors: [] };

    // Layout wraps everything
    if (files['layout.js']) {
      result.rendered.push('Layout: ' + segment.path);
    }

    // Template inside layout (with unique key!)
    if (files['template.js']) {
      result.rendered.push('Template: key=' + segment.path);
    }

    // Error boundary wraps page
    if (files['error.js']) {
      result.rendered.push('ErrorBoundary: ' + segment.path);
    }

    // Loading = Suspense fallback
    if (files['loading.js']) {
      result.rendered.push('Suspense(loading): ' + segment.path);
    }

    // Page = leaf node
    if (files['page.js']) {
      result.rendered.push('Page: ' + segment.path);
    }

    return result;
  }

  // 2. PROXY EXECUTION ORDER
  function proxyExecutionOrder() {
    return [
      '1. headers (next.config.js)',
      '2. redirects (next.config.js)',
      '3. PROXY (proxy.js â€” rewrites, redirects, etc.)',
      '4. beforeFiles rewrites (next.config.js)',
      '5. Filesystem routes (public/, app/, pages/)',
      '6. afterFiles rewrites (next.config.js)',
      '7. Dynamic Routes (/blog/[slug])',
      '8. fallback rewrites (next.config.js)'
    ];
  }

  // 3. PARALLEL SLOT RESOLVER
  function resolveParallelSlots(layoutPath, slots, currentUrl, navType) {
    var result = {};
    for (var slotName in slots) {
      var slot = slots[slotName];
      var hasMatch = slot.routes.indexOf(currentUrl) !== -1;

      if (navType === 'soft') {
        // Soft nav: keep active state even if no match
        result[slotName] = hasMatch
          ? { content: 'page for ' + currentUrl, status: 'matched' }
          : { content: slot.activeContent || 'kept active', status: 'kept' };
      } else {
        // Hard nav: must have match or default.js
        if (hasMatch) {
          result[slotName] = { content: 'page for ' + currentUrl, status: 'matched' };
        } else if (slot.hasDefault) {
          result[slotName] = { content: 'default.js fallback', status: 'default' };
        } else {
          result[slotName] = { content: '404!', status: 'not-found' };
        }
      }
    }
    return result;
  }

  // 4. INTERCEPTING ROUTE MATCHER
  function interceptRoute(convention, fromSegment, targetSegment) {
    var levels = {
      '(.)': 0,    // same level
      '(..)': 1,   // one level above
      '(..)(..)': 2, // two levels above
      '(...)': Infinity // root
    };
    var levelsUp = levels[convention];
    if (levelsUp === undefined) return { matched: false, error: 'Unknown convention' };

    var fromParts = fromSegment.split('/').filter(function(p) {
      // Filter out @slot folders (not route segments!)
      return p && !p.startsWith('@');
    });
    var targetParts = targetSegment.split('/').filter(Boolean);

    if (levelsUp === Infinity) {
      return { matched: true, scope: 'root â†’ ' + targetSegment };
    }
    if (levelsUp <= fromParts.length) {
      return { matched: true, scope: fromParts.slice(0, -levelsUp).join('/') + '/' + targetParts.join('/') };
    }
    return { matched: false, error: 'Cannot go ' + levelsUp + ' levels up from ' + fromSegment };
  }

  // 5. TEMPLATE REMOUNT CHECKER
  function checkTemplateRemount(fromPath, toPath, templateLevel) {
    var fromParts = fromPath.split('/').filter(Boolean);
    var toParts = toPath.split('/').filter(Boolean);
    var segmentIndex = templateLevel; // 0-based depth

    // Template remounts when its own segment-level key changes
    var fromKey = fromParts.slice(0, segmentIndex + 1).join('/');
    var toKey = toParts.slice(0, segmentIndex + 1).join('/');

    // Also check if child segment changed (template tracks child)
    var fromChild = fromParts[segmentIndex] || '';
    var toChild = toParts[segmentIndex] || '';

    return {
      fromKey: '/' + fromKey,
      toKey: '/' + toKey,
      remounts: fromKey !== toKey,
      reason: fromKey !== toKey
        ? 'Segment changed at level ' + segmentIndex
        : 'Same segment, no remount'
    };
  }

  // 6. ROUTE SEGMENT CONFIG RESOLVER
  function resolveSegmentConfig(config) {
    var result = {};

    // dynamic
    switch (config.dynamic) {
      case 'force-dynamic':
        result.rendering = 'SSR every request';
        result.fetchDefault = '{ cache: "no-store" }';
        break;
      case 'error':
        result.rendering = 'Static, error on dynamic APIs';
        result.fetchDefault = '{ cache: "force-cache" }';
        break;
      case 'force-static':
        result.rendering = 'Static, empty dynamic values';
        break;
      default:
        result.rendering = 'Auto (cache as much as possible)';
    }

    // revalidate
    if (config.revalidate === false || config.revalidate === undefined) {
      result.revalidation = 'Infinity (cache indefinitely)';
    } else if (config.revalidate === 0) {
      result.revalidation = 'Always dynamic';
    } else {
      result.revalidation = 'ISR every ' + config.revalidate + 's';
    }

    // runtime
    result.runtime = config.runtime || 'nodejs';

    return result;
  }

  // DEMO
  function demo() {
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('  FileConventionsEngine2 â€” DEMO');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

    // 1. Rendering
    console.log('\nâ”€â”€â”€ 1. RENDERING HIERARCHY â”€â”€â”€');
    var seg = {
      path: '/dashboard',
      files: { 'layout.js': true, 'template.js': true, 'error.js': true,
               'loading.js': true, 'page.js': true }
    };
    console.log(JSON.stringify(renderHierarchy(seg), null, 2));

    // 2. Proxy
    console.log('\nâ”€â”€â”€ 2. PROXY EXECUTION ORDER â”€â”€â”€');
    proxyExecutionOrder().forEach(function(step) { console.log('  ' + step); });

    // 3. Parallel Slots
    console.log('\nâ”€â”€â”€ 3. PARALLEL SLOTS â”€â”€â”€');
    var slots = {
      '@team': { routes: ['/dashboard', '/settings'], hasDefault: true, activeContent: 'team page' },
      '@analytics': { routes: ['/dashboard'], hasDefault: true, activeContent: 'analytics page' }
    };
    console.log('Soft nav to /settings:', JSON.stringify(
      resolveParallelSlots('/dashboard', slots, '/settings', 'soft'), null, 2));
    console.log('Hard nav to /settings:', JSON.stringify(
      resolveParallelSlots('/dashboard', slots, '/settings', 'hard'), null, 2));

    // 4. Intercepting
    console.log('\nâ”€â”€â”€ 4. INTERCEPTING ROUTES â”€â”€â”€');
    console.log('(.) same level:', JSON.stringify(interceptRoute('(.)', '/feed', 'photo')));
    console.log('(..) one up:', JSON.stringify(interceptRoute('(..)', '/feed/@modal', 'photo')));
    console.log('(...) root:', JSON.stringify(interceptRoute('(...)', '/a/b/c', 'login')));

    // 5. Template Remount
    console.log('\nâ”€â”€â”€ 5. TEMPLATE REMOUNT â”€â”€â”€');
    console.log('/ â†’ /about (root):', JSON.stringify(checkTemplateRemount('/', '/about', 0)));
    console.log('/blog â†’ /blog/post (blog level):', JSON.stringify(checkTemplateRemount('/blog', '/blog/post', 1)));
    console.log('/blog/a â†’ /blog/b (blog level):', JSON.stringify(checkTemplateRemount('/blog/a', '/blog/b', 1)));

    // 6. Segment Config
    console.log('\nâ”€â”€â”€ 6. SEGMENT CONFIG â”€â”€â”€');
    console.log('force-dynamic:', JSON.stringify(
      resolveSegmentConfig({ dynamic: 'force-dynamic', revalidate: 0 }), null, 2));
    console.log('ISR 60s:', JSON.stringify(
      resolveSegmentConfig({ dynamic: 'auto', revalidate: 60 }), null, 2));

    console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('  âœ… Demo Complete!');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  }

  return {
    renderHierarchy: renderHierarchy,
    proxyExecutionOrder: proxyExecutionOrder,
    resolveParallelSlots: resolveParallelSlots,
    interceptRoute: interceptRoute,
    checkTemplateRemount: checkTemplateRemount,
    resolveSegmentConfig: resolveSegmentConfig,
    demo: demo
  };
})();

// Run: FileConventionsEngine2.demo();
```

---

## Â§16. CÃ¢u Há»i Luyá»‡n Táº­p!

### â“ CÃ¢u 1: Layout vs Template â€” khi nÃ o dÃ¹ng cÃ¡i nÃ o?

**Tráº£ lá»i:**

| TÃ­nh nÄƒng | layout.js | template.js |
|---|---|---|
| State preservation | âœ… Preserved | âŒ Reset má»—i navigation |
| Re-render | âŒ KhÃ´ng | âœ… Remount (unique key) |
| useEffect | Chá»‰ run láº§n Ä‘áº§u | Re-run má»—i navigation |
| Suspense fallback | Chá»‰ hiá»‡n láº§n Ä‘áº§u | Hiá»‡n Má»ŒI navigation |

**DÃ¹ng layout.js** khi: sidebar, navbar, header â€” UI khÃ´ng Ä‘á»•i giá»¯a routes.
**DÃ¹ng template.js** khi: page view tracking (useEffect), form reset, entrance animation má»—i route.

### â“ CÃ¢u 2: Táº¡i sao layout.js KHÃ”NG thá»ƒ access searchParams, pathname, request object?

**Tráº£ lá»i:**

Layout KHÃ”NG re-render khi navigate! Náº¿u layout access searchParams hoáº·c pathname, giÃ¡ trá»‹ sáº½ **stale** (cÅ©, khÃ´ng cáº­p nháº­t). Next.js cache layout Ä‘á»ƒ trÃ¡nh unnecessary computation.

**Giáº£i phÃ¡p:**
- `searchParams` â†’ dÃ¹ng `useSearchParams()` trong Client Component
- `pathname` â†’ dÃ¹ng `usePathname()` trong Client Component
- `request` â†’ dÃ¹ng `headers()` / `cookies()` APIs (Server Component)

### â“ CÃ¢u 3: Intercepting Routes (..) dá»±a trÃªn file-system hay route segments?

**Tráº£ lá»i:**

**Route SEGMENTS!** KhÃ´ng pháº£i file-system!

VÃ­ dá»¥: `app/feed/@modal/(..)photo/[id]/page.tsx`
- File-system: `@modal` â†’ `(..)photo` = 2 levels up trong FS
- Route segments: `@modal` KHÃ”NG pháº£i segment â†’ `(..)photo` = chá»‰ 1 level up!

`@slot` folders bá»‹ IGNORE khi tÃ­nh (..) levels!

### â“ CÃ¢u 4: Proxy (middleware) cÃ³ thá»ƒ share state vá»›i render code khÃ´ng?

**Tráº£ lá»i:**

**KHÃ”NG!** Proxy cháº¡y riÃªng biá»‡t, cÃ³ thá»ƒ deployed to CDN. KHÃ”NG thá»ƒ rely on shared modules hoáº·c globals.

**CÃ¡ch pass thÃ´ng tin tá»« proxy â†’ app:**
- Headers (set custom headers)
- Cookies (set/read cookies)
- Rewrites (rewrite URL)
- Redirects (redirect URL)
- URL modifications

**Execution order:**
headers â†’ redirects â†’ **PROXY** â†’ beforeFiles â†’ filesystem â†’ afterFiles â†’ dynamic â†’ fallback

### â“ CÃ¢u 5: Sáº¯p xáº¿p rendering hierarchy Ä‘Ãºng thá»© tá»±?

**Tráº£ lá»i:**

```
<Layout>             â† layout.js (persistent, no re-render!)
  <Template>         â† template.js (remounts on nav!)
    <ErrorBoundary>  â† error.js (catches errors!)
      <Suspense>     â† loading.js (streaming fallback!)
        <Page />     â† page.js (leaf UI!)
      </Suspense>
    </ErrorBoundary>
  </Template>
</Layout>
```

VÃ  khi cÃ³ Parallel Routes:
```
<Layout>
  {children}     â† implicit @children slot
  {team}         â† @team slot
  {analytics}    â† @analytics slot
</Layout>
```

---

> ğŸ¯ **Tá»•ng káº¿t**: Guide nÃ y cover 17 file conventions:
> `instrumentation` Â· `instrumentation-client` Â· `intercepting-routes` Â· `layout` Â· `loading` Â· `mdx-components` Â· `not-found` Â· `page` Â· `parallel-routes` Â· `proxy` Â· `public-folder` Â· `route` Â· `route-groups` Â· `route-segment-config` Â· `src-folder` Â· `template` Â· `unauthorized`
>
> Vá»›i **9 diagrams** phÃ¢n tÃ­ch, **FileConventionsEngine2** tá»± viáº¿t, vÃ  **5 cÃ¢u há»i luyá»‡n táº­p**!
