# Next.js `Script` Component â€” Deep Dive!

> **Chá»§ Ä‘á»**: `next/script` â€” Optimize Third-Party Scripts!
> **NgÃ´n ngá»¯**: Tiáº¿ng Viá»‡t â€” giáº£i thÃ­ch cá»±c ká»³ chi tiáº¿t!
> **PhÆ°Æ¡ng chÃ¢m**: Tá»± viáº¿t láº¡i báº±ng tay â€” KHÃ”NG dÃ¹ng thÆ° viá»‡n!
> **Nguá»“n**: https://nextjs.org/docs/app/api-reference/components/script + https://nextjs.org/docs/app/guides/scripts
> **HÃ¬nh áº£nh**: 0 diagrams trong trang gá»‘c â€” Táº¤T Cáº¢ sÆ¡ Ä‘á»“ tá»± váº½!

---

## Má»¥c Lá»¥c

1. [Â§1. Tá»•ng Quan â€” Script Component!](#1)
2. [Â§2. Loading Strategies â€” Deep Dive!](#2)
3. [Â§3. Event Handlers â€” onLoad / onReady / onError!](#3)
4. [Â§4. Inline Scripts!](#4)
5. [Â§5. Layout vs Application Scripts!](#5)
6. [Â§6. Web Worker (Experimental)!](#6)
7. [Â§7. Tá»± Viáº¿t â€” NextScriptEngine!](#7)
8. [Â§8. CÃ¢u Há»i Luyá»‡n Táº­p!](#8)

---

## Â§1. Tá»•ng Quan â€” Script Component!

```
  NEXT/SCRIPT COMPONENT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHAT: Optimize third-party script loading!                  â”‚
  â”‚                                                              â”‚
  â”‚  import Script from 'next/script'                            â”‚
  â”‚  <Script src="https://example.com/script.js" />             â”‚
  â”‚                                                              â”‚
  â”‚  WHY (Problem with native <script>):                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <script src="..."> blocks rendering! ğŸš«             â”‚    â”‚
  â”‚  â”‚ <script async> loads unpredictably! ğŸš«              â”‚    â”‚
  â”‚  â”‚ <script defer> still before hydration! ğŸš«           â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ No lifecycle hooks! No re-mount handling!            â”‚    â”‚
  â”‚  â”‚ No lazy loading! No web worker offload!             â”‚    â”‚
  â”‚  â”‚ No deduplication across routes!                     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  WHAT <Script> DOES:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Smart loading     â†’ 4 strategies!                â”‚    â”‚
  â”‚  â”‚ â‘¡ Deduplication     â†’ load once across routes!     â”‚    â”‚
  â”‚  â”‚ â‘¢ Event handlers    â†’ onLoad/onReady/onError!      â”‚    â”‚
  â”‚  â”‚ â‘£ Inline scripts    â†’ with tracking via id!        â”‚    â”‚
  â”‚  â”‚ â‘¤ Web Worker        â†’ offload to background!       â”‚    â”‚
  â”‚  â”‚ â‘¥ Attr forwarding   â†’ nonce, data-*, etc!         â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  <script> vs <Script>:                                        â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                  â”‚ <script>       â”‚ <Script>         â”‚    â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
  â”‚  â”‚ Loading          â”‚ Render-blockingâ”‚ Smart strategy!  â”‚    â”‚
  â”‚  â”‚ Deduplication    â”‚ âŒ None!      â”‚ âœ… Auto!        â”‚    â”‚
  â”‚  â”‚ Lifecycle hooks  â”‚ âŒ None!      â”‚ âœ… 3 handlers!  â”‚    â”‚
  â”‚  â”‚ Re-mount         â”‚ âŒ Manual!    â”‚ âœ… onReady!     â”‚    â”‚
  â”‚  â”‚ Web Worker       â”‚ âŒ Manual!    â”‚ âœ… strategy!    â”‚    â”‚
  â”‚  â”‚ Inline tracking  â”‚ âŒ None!      â”‚ âœ… id prop!     â”‚    â”‚
  â”‚  â”‚ Attr forwarding  â”‚ âœ… Native!    â”‚ âœ… Same!        â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§2. Loading Strategies â€” Deep Dive!

```
  4 LOADING STRATEGIES:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  PAGE LOADING TIMELINE:                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º        â”‚    â”‚
  â”‚  â”‚  â”‚                                                   â”‚    â”‚
  â”‚  â”‚  â”‚ HTML        Hydration    Page        Browser      â”‚    â”‚
  â”‚  â”‚  â”‚ parsed      starts       ready       idle         â”‚    â”‚
  â”‚  â”‚  â”‚ â–¼           â–¼            â–¼           â–¼            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒâ†â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ before    â”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ Interactiveâ”ƒ           â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒâ†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ  after     â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ  Interactiveâ”ƒ          â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒâ†â”€â”€â”€â”€â”€â”€â–º    â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ lazy       â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ Onload     â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ           â”ƒ            â”ƒ           â”ƒ            â”‚    â”‚
  â”‚  â”‚  â”‚ â”ƒ     [worker: runs in separate thread! â”€â”€â”€â”€â”€â”€â”€â–º] â”‚    â”‚
  â”‚  â”‚  â”‚                                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Strategy 1: `beforeInteractive`

```
  beforeInteractive:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHEN: Before ANY Next.js code! Before hydration!            â”‚
  â”‚                                                              â”‚
  â”‚  HOW IT WORKS:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Injected into initial HTML from SERVER!           â”‚    â”‚
  â”‚  â”‚ â‘¡ Downloaded before any Next.js module!             â”‚    â”‚
  â”‚  â”‚ â‘¢ Executed in ORDER they are placed!                 â”‚    â”‚
  â”‚  â”‚ â‘£ Preloaded and fetched before first-party code!    â”‚    â”‚
  â”‚  â”‚ â‘¤ Does NOT block page hydration! âœ…                â”‚    â”‚
  â”‚  â”‚ â‘¥ Always injected inside <head>! (regardless of     â”‚    â”‚
  â”‚  â”‚    where placed in component!)                       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  RESTRICTION:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âš ï¸ MUST be placed in root layout (app/layout.tsx)!  â”‚    â”‚
  â”‚  â”‚ â†’ Designed for scripts needed by ENTIRE site!       â”‚    â”‚
  â”‚  â”‚ â†’ Loads when ANY page in app is loaded server-side! â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ onLoad NOT supported! Use onReady instead!       â”‚    â”‚
  â”‚  â”‚ âŒ onError NOT supported!                           â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Bot detectors (Cloudflare Turnstile!)             â”‚    â”‚
  â”‚  â”‚ â†’ Cookie consent managers (OneTrust, CookieBot!)    â”‚    â”‚
  â”‚  â”‚ â†’ Critical polyfills                                 â”‚    â”‚
  â”‚  â”‚ â†’ CSP nonce validation scripts                       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE:                                                     â”‚
  â”‚  // app/layout.tsx (ROOT LAYOUT ONLY!)                        â”‚
  â”‚  import Script from 'next/script'                             â”‚
  â”‚  export default function RootLayout({ children }) {           â”‚
  â”‚    return (                                                   â”‚
  â”‚      <html lang="en">                                         â”‚
  â”‚        <body>                                                 â”‚
  â”‚          {children}                                           â”‚
  â”‚          <Script                                              â”‚
  â”‚            src="https://example.com/bot-detector.js"          â”‚
  â”‚            strategy="beforeInteractive"                       â”‚
  â”‚          />                                                   â”‚
  â”‚        </body>                                                â”‚
  â”‚      </html>                                                  â”‚
  â”‚    )                                                          â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Strategy 2: `afterInteractive` (DEFAULT!)

```
  afterInteractive (DEFAULT):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHEN: After SOME hydration on page! Early but NOT first!    â”‚
  â”‚                                                              â”‚
  â”‚  HOW IT WORKS:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Injected into HTML CLIENT-SIDE!                   â”‚    â”‚
  â”‚  â”‚ â‘¡ Loads AFTER some/all hydration occurs!            â”‚    â”‚
  â”‚  â”‚ â‘¢ This is the DEFAULT strategy!                      â”‚    â”‚
  â”‚  â”‚ â‘£ Does NOT block first-party Next.js code!          â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLEXIBILITY:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âœ… Can be in ANY page OR layout!                    â”‚    â”‚
  â”‚  â”‚ âœ… Only loads when that page/group is opened!       â”‚    â”‚
  â”‚  â”‚ âœ… Supports onLoad, onReady, onError!               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Tag managers (Google Tag Manager!)                â”‚    â”‚
  â”‚  â”‚ â†’ Analytics (Google Analytics, Amplitude!)          â”‚    â”‚
  â”‚  â”‚ â†’ Ad scripts                                         â”‚    â”‚
  â”‚  â”‚ â†’ A/B testing tools                                  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE:                                                     â”‚
  â”‚  // app/dashboard/page.tsx (ANY page!)                        â”‚
  â”‚  import Script from 'next/script'                             â”‚
  â”‚  export default function Page() {                             â”‚
  â”‚    return (                                                   â”‚
  â”‚      <>                                                       â”‚
  â”‚        <Script                                                â”‚
  â”‚          src="https://example.com/analytics.js"               â”‚
  â”‚          strategy="afterInteractive"  // OR just omit!       â”‚
  â”‚        />                                                     â”‚
  â”‚      </>                                                      â”‚
  â”‚    )                                                          â”‚
  â”‚  }                                                            â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Strategy 3: `lazyOnload`

```
  lazyOnload:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  WHEN: During BROWSER IDLE TIME! After ALL resources loaded! â”‚
  â”‚                                                              â”‚
  â”‚  HOW IT WORKS:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Injected into HTML CLIENT-SIDE!                   â”‚    â”‚
  â”‚  â”‚ â‘¡ Waits until ALL page resources have been fetched! â”‚    â”‚
  â”‚  â”‚ â‘¢ Loads during browser idle time! (requestIdleCallbackâ”‚   â”‚
  â”‚  â”‚    or setTimeout fallback!)                          â”‚    â”‚
  â”‚  â”‚ â‘£ For background/low priority scripts!              â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  FLEXIBILITY:                                                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âœ… Can be in ANY page OR layout!                    â”‚    â”‚
  â”‚  â”‚ âœ… Only loads when that page/group is opened!       â”‚    â”‚
  â”‚  â”‚ âœ… Supports onLoad, onReady, onError!               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  USE CASES:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Chat support plugins (Intercom, Zendesk!)         â”‚    â”‚
  â”‚  â”‚ â†’ Social media widgets (Twitter embed, FB Like!)    â”‚    â”‚
  â”‚  â”‚ â†’ Customer feedback tools                            â”‚    â”‚
  â”‚  â”‚ â†’ Non-essential tracking pixels                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  EXAMPLE:                                                     â”‚
  â”‚  <Script                                                      â”‚
  â”‚    src="https://example.com/chat-widget.js"                   â”‚
  â”‚    strategy="lazyOnload"                                      â”‚
  â”‚  />                                                           â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Strategy Comparison Table

```
  STRATEGY COMPARISON:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
  â”‚  â”‚              â”‚ before   â”‚ after    â”‚ lazy     â”‚ worker â”‚ â”‚
  â”‚  â”‚              â”‚ Inter.   â”‚ Inter.   â”‚ Onload   â”‚ (exp.) â”‚ â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
  â”‚  â”‚ Default?     â”‚ âŒ       â”‚ âœ… YES! â”‚ âŒ       â”‚ âŒ     â”‚ â”‚
  â”‚  â”‚ Where?       â”‚ Root     â”‚ ANY page â”‚ ANY page â”‚ pages/ â”‚ â”‚
  â”‚  â”‚              â”‚ layout!  â”‚ /layout! â”‚ /layout! â”‚ only!  â”‚ â”‚
  â”‚  â”‚ Injected     â”‚ Server   â”‚ Client   â”‚ Client   â”‚ Worker â”‚ â”‚
  â”‚  â”‚ When?        â”‚ Before   â”‚ After    â”‚ Browser  â”‚ Async! â”‚ â”‚
  â”‚  â”‚              â”‚ hydrate! â”‚ hydrate! â”‚ idle!    â”‚        â”‚ â”‚
  â”‚  â”‚ Blocks?      â”‚ âŒ No!  â”‚ âŒ No!  â”‚ âŒ No!  â”‚ âŒ No!â”‚ â”‚
  â”‚  â”‚ <head>?      â”‚ âœ… Alwaysâ”‚ âŒ      â”‚ âŒ       â”‚ âŒ     â”‚ â”‚
  â”‚  â”‚ onLoad       â”‚ âŒ       â”‚ âœ…       â”‚ âœ…       â”‚ âŒ     â”‚ â”‚
  â”‚  â”‚ onReady      â”‚ âœ…       â”‚ âœ…       â”‚ âœ…       â”‚ âŒ     â”‚ â”‚
  â”‚  â”‚ onError      â”‚ âŒ       â”‚ âœ…       â”‚ âœ…       â”‚ âŒ     â”‚ â”‚
  â”‚  â”‚ Priority     â”‚ CRITICAL â”‚ HIGH     â”‚ LOW      â”‚ OFF    â”‚ â”‚
  â”‚  â”‚              â”‚          â”‚          â”‚          â”‚ THREAD â”‚ â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§3. Event Handlers â€” onLoad / onReady / onError!

```
  EVENT HANDLERS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  âš ï¸ ALL handlers require 'use client'!                      â”‚
  â”‚  âš ï¸ Only work in Client Components!                         â”‚
  â”‚                                                              â”‚
  â”‚  onLoad:                                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ WHEN: After script has FINISHED loading!             â”‚    â”‚
  â”‚  â”‚ FIRES: ONCE only! (first load!)                      â”‚    â”‚
  â”‚  â”‚ USE: Initialize script, call setup functions!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NOT with beforeInteractive!                       â”‚    â”‚
  â”‚  â”‚ âœ… Works with afterInteractive + lazyOnload!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ <Script                                              â”‚    â”‚
  â”‚  â”‚   src="https://cdn.jsdelivr.net/lodash/..."          â”‚    â”‚
  â”‚  â”‚   onLoad={() => {                                    â”‚    â”‚
  â”‚  â”‚     console.log(_.sample([1, 2, 3, 4]))             â”‚    â”‚
  â”‚  â”‚   }}                                                 â”‚    â”‚
  â”‚  â”‚ />                                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  onReady:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ WHEN: After script loaded + EVERY component mount!   â”‚    â”‚
  â”‚  â”‚ FIRES: MULTIPLE times!                               â”‚    â”‚
  â”‚  â”‚   â†’ First load: âœ… fires!                           â”‚    â”‚
  â”‚  â”‚   â†’ Route change â†’ component re-mount: âœ… fires!   â”‚    â”‚
  â”‚  â”‚   â†’ SPA navigation â†’ re-mount: âœ… fires!           â”‚    â”‚
  â”‚  â”‚ USE: Re-initialize on every mount! (Maps, Charts!)  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NOT with worker strategy!                         â”‚    â”‚
  â”‚  â”‚ âœ… Works with ALL other strategies!                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ const mapRef = useRef()                              â”‚    â”‚
  â”‚  â”‚ <Script                                              â”‚    â”‚
  â”‚  â”‚   id="google-maps"                                   â”‚    â”‚
  â”‚  â”‚   src="https://maps.googleapis.com/maps/api/js"      â”‚    â”‚
  â”‚  â”‚   onReady={() => {                                   â”‚    â”‚
  â”‚  â”‚     new google.maps.Map(mapRef.current, {            â”‚    â”‚
  â”‚  â”‚       center: { lat: -34.397, lng: 150.644 },       â”‚    â”‚
  â”‚  â”‚       zoom: 8,                                       â”‚    â”‚
  â”‚  â”‚     })                                               â”‚    â”‚
  â”‚  â”‚   }}                                                 â”‚    â”‚
  â”‚  â”‚ />                                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  onError:                                                     â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ WHEN: Script FAILS to load!                          â”‚    â”‚
  â”‚  â”‚ FIRES: On load failure only!                         â”‚    â”‚
  â”‚  â”‚ USE: Error logging, fallback, retry!                 â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ âŒ NOT with beforeInteractive!                       â”‚    â”‚
  â”‚  â”‚ âœ… Works with afterInteractive + lazyOnload!        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ 'use client'                                         â”‚    â”‚
  â”‚  â”‚ <Script                                              â”‚    â”‚
  â”‚  â”‚   src="https://example.com/script.js"                â”‚    â”‚
  â”‚  â”‚   onError={(e: Error) => {                           â”‚    â”‚
  â”‚  â”‚     console.error('Script failed to load', e)       â”‚    â”‚
  â”‚  â”‚   }}                                                 â”‚    â”‚
  â”‚  â”‚ />                                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  onLoad vs onReady:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                  â”‚ onLoad         â”‚ onReady          â”‚    â”‚
  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
  â”‚  â”‚ Fires            â”‚ ONCE only!     â”‚ EVERY mount!     â”‚    â”‚
  â”‚  â”‚ First load       â”‚ âœ…             â”‚ âœ…               â”‚    â”‚
  â”‚  â”‚ Route change     â”‚ âŒ             â”‚ âœ… (re-mount!)  â”‚    â”‚
  â”‚  â”‚ Re-mount         â”‚ âŒ             â”‚ âœ…               â”‚    â”‚
  â”‚  â”‚ beforeInteract.  â”‚ âŒ             â”‚ âœ…               â”‚    â”‚
  â”‚  â”‚ Use case         â”‚ Init once!     â”‚ Re-init always!  â”‚    â”‚
  â”‚  â”‚ Example          â”‚ Load lodash!   â”‚ Google Maps!     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§4. Inline Scripts!

```
  INLINE SCRIPTS:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  Scripts WITHOUT src! Code INSIDE the component!             â”‚
  â”‚                                                              â”‚
  â”‚  âš ï¸ MUST have id prop! (for Next.js tracking!)              â”‚
  â”‚                                                              â”‚
  â”‚  METHOD 1: Curly braces!                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Script id="show-banner">                            â”‚    â”‚
  â”‚  â”‚   {`document.getElementById('banner')                â”‚    â”‚
  â”‚  â”‚     .classList.remove('hidden')`}                     â”‚    â”‚
  â”‚  â”‚ </Script>                                            â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  METHOD 2: dangerouslySetInnerHTML!                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ <Script                                              â”‚    â”‚
  â”‚  â”‚   id="show-banner"                                   â”‚    â”‚
  â”‚  â”‚   dangerouslySetInnerHTML={{                          â”‚    â”‚
  â”‚  â”‚     __html: `document.getElementById('banner')       â”‚    â”‚
  â”‚  â”‚       .classList.remove('hidden')`,                   â”‚    â”‚
  â”‚  â”‚   }}                                                 â”‚    â”‚
  â”‚  â”‚ />                                                   â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  WHY id IS REQUIRED:                                          â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Next.js uses id to TRACK inline scripts!          â”‚    â”‚
  â”‚  â”‚ â†’ Prevents DUPLICATE execution on nav!              â”‚    â”‚
  â”‚  â”‚ â†’ Enables optimization and deduplication!           â”‚    â”‚
  â”‚  â”‚ â†’ Without id: script may run MULTIPLE times! ğŸš«    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TYPICAL USE CASES:                                           â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ GTM container snippet                              â”‚    â”‚
  â”‚  â”‚ â†’ dataLayer.push configurations                     â”‚    â”‚
  â”‚  â”‚ â†’ Feature flag initialization                        â”‚    â”‚
  â”‚  â”‚ â†’ Small DOM manipulations                            â”‚    â”‚
  â”‚  â”‚ â†’ Environment variable injection                     â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§5. Layout vs Application Scripts!

```
  SCRIPT PLACEMENT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  LAYOUT SCRIPTS (per-route group):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // app/dashboard/layout.tsx                          â”‚    â”‚
  â”‚  â”‚ import Script from 'next/script'                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export default function DashboardLayout({ children })â”‚    â”‚
  â”‚  â”‚ {                                                    â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <>                                               â”‚    â”‚
  â”‚  â”‚       <section>{children}</section>                  â”‚    â”‚
  â”‚  â”‚       <Script src="https://example.com/analytics.js" â”‚    â”‚
  â”‚  â”‚       />                                             â”‚    â”‚
  â”‚  â”‚     </>                                              â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Loads when /dashboard/* is accessed!              â”‚    â”‚
  â”‚  â”‚ â†’ Loads ONCE, even navigating between:              â”‚    â”‚
  â”‚  â”‚   /dashboard/page â†” /dashboard/settings âœ…          â”‚    â”‚
  â”‚  â”‚ â†’ Does NOT load on other routes! (/about etc.)      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  APPLICATION SCRIPTS (all routes):                            â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ // app/layout.tsx (ROOT LAYOUT!)                     â”‚    â”‚
  â”‚  â”‚ import Script from 'next/script'                     â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ export default function RootLayout({ children }) {   â”‚    â”‚
  â”‚  â”‚   return (                                           â”‚    â”‚
  â”‚  â”‚     <html lang="en">                                 â”‚    â”‚
  â”‚  â”‚       <body>{children}</body>                        â”‚    â”‚
  â”‚  â”‚       <Script src="https://example.com/script.js" /> â”‚    â”‚
  â”‚  â”‚     </html>                                          â”‚    â”‚
  â”‚  â”‚   )                                                  â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ â†’ Loads on ANY route in entire app!                 â”‚    â”‚
  â”‚  â”‚ â†’ Loads ONCE, persists across all navigations!      â”‚    â”‚
  â”‚  â”‚ â†’ âš ï¸ Only include if truly needed everywhere!      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  DEDUPLICATION:                                               â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Next.js ensures script loads ONCE!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ User navigates: /dashboard â†’ /dashboard/settings    â”‚    â”‚
  â”‚  â”‚ Script in layout? â†’ Already loaded! Skip! âœ…        â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ User navigates: / â†’ /about â†’ /contact               â”‚    â”‚
  â”‚  â”‚ Script in root? â†’ Loaded on first visit! Skip! âœ…  â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  RECOMMENDATION:                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ âœ… Put scripts in SPECIFIC pages/layouts!           â”‚    â”‚
  â”‚  â”‚ âŒ Avoid putting ALL scripts in root layout!        â”‚    â”‚
  â”‚  â”‚ â†’ Minimize unnecessary impact to performance!       â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§6. Web Worker (Experimental)!

```
  WEB WORKER STRATEGY:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚                                                              â”‚
  â”‚  âš ï¸ EXPERIMENTAL! Not stable! Not for App Router yet!       â”‚
  â”‚                                                              â”‚
  â”‚  WHAT IT DOES:                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â‘  Offloads 3rd-party script to WEB WORKER!         â”‚    â”‚
  â”‚  â”‚ â‘¡ Frees up MAIN THREAD for your app code!          â”‚    â”‚
  â”‚  â”‚ â‘¢ Uses Partytown library under the hood!            â”‚    â”‚
  â”‚  â”‚ â‘£ Only critical first-party code on main thread!    â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  MAIN THREAD vs WEB WORKER:                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  MAIN THREAD:         WEB WORKER:                    â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ React rendering   â”œâ”€â”€ Analytics script â™»ï¸     â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ Event handling     â”œâ”€â”€ Ad tracking â™»ï¸          â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ DOM updates        â”œâ”€â”€ Tag manager â™»ï¸          â”‚    â”‚
  â”‚  â”‚  â”œâ”€â”€ User interactions  â””â”€â”€ Any 3rd-party! â™»ï¸      â”‚    â”‚
  â”‚  â”‚  â””â”€â”€ Your app code!                                  â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚  â†’ Main thread is FAST! ğŸï¸                         â”‚    â”‚
  â”‚  â”‚  â†’ 3rd-party can't block your UI!                   â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  SETUP:                                                       â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ Step 1: Enable in next.config.js                     â”‚    â”‚
  â”‚  â”‚ module.exports = {                                   â”‚    â”‚
  â”‚  â”‚   experimental: {                                    â”‚    â”‚
  â”‚  â”‚     nextScriptWorkers: true,                         â”‚    â”‚
  â”‚  â”‚   },                                                 â”‚    â”‚
  â”‚  â”‚ }                                                    â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Step 2: Run dev server (will prompt to install!)     â”‚    â”‚
  â”‚  â”‚ $ npm run dev                                        â”‚    â”‚
  â”‚  â”‚ â†’ "Please install @qwik.dev/partytown"              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Step 3: npm install @qwik.dev/partytown              â”‚    â”‚
  â”‚  â”‚                                                      â”‚    â”‚
  â”‚  â”‚ Step 4: Use strategy="worker"                        â”‚    â”‚
  â”‚  â”‚ <Script src="..." strategy="worker" />               â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â”‚  TRADEOFFS:                                                   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
  â”‚  â”‚ â†’ Not all 3rd-party scripts work in web worker!     â”‚    â”‚
  â”‚  â”‚ â†’ DOM access is proxied (slower!)                   â”‚    â”‚
  â”‚  â”‚ â†’ Some APIs not available in worker context!        â”‚    â”‚
  â”‚  â”‚ â†’ Only works in pages/ directory currently!         â”‚    â”‚
  â”‚  â”‚ â†’ Partytown has its own limitations!                â”‚    â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
  â”‚                                                              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Â§7. Tá»± Viáº¿t â€” NextScriptEngine!

```javascript
var NextScriptEngine = (function () {
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 1. SCRIPT REGISTRY
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var scripts = {};
  var loadOrder = [];
  var listeners = {};
  var stats = {
    loaded: 0,
    failed: 0,
    skipped: 0,
    byStrategy: {
      beforeInteractive: 0,
      afterInteractive: 0,
      lazyOnload: 0,
      worker: 0,
    },
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 2. STRATEGY RESOLVER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function resolveStrategy(strategy) {
    var strategies = {
      beforeInteractive: {
        name: "beforeInteractive",
        injection: "server-side (SSR HTML!)",
        timing: "Before ANY Next.js code!",
        location: "<head> ALWAYS!",
        placement: "Root layout (app/layout.tsx) ONLY!",
        blocksHydration: false,
        onLoad: false,
        onReady: true,
        onError: false,
        priority: "CRITICAL",
        useCases: ["Bot detectors", "Cookie consent", "Polyfills"],
      },
      afterInteractive: {
        name: "afterInteractive",
        injection: "client-side!",
        timing: "After SOME hydration!",
        location: "Where placed in DOM!",
        placement: "ANY page or layout!",
        blocksHydration: false,
        onLoad: true,
        onReady: true,
        onError: true,
        priority: "HIGH",
        useCases: ["Tag managers", "Analytics", "Ad scripts"],
      },
      lazyOnload: {
        name: "lazyOnload",
        injection: "client-side!",
        timing: "Browser IDLE time!",
        location: "Where placed in DOM!",
        placement: "ANY page or layout!",
        blocksHydration: false,
        onLoad: true,
        onReady: true,
        onError: true,
        priority: "LOW",
        useCases: ["Chat widgets", "Social media", "Feedback tools"],
      },
      worker: {
        name: "worker",
        injection: "Web Worker (Partytown!)",
        timing: "Async in separate thread!",
        location: "Off main thread!",
        placement: "pages/ directory ONLY! (experimental)",
        blocksHydration: false,
        onLoad: false,
        onReady: false,
        onError: false,
        priority: "OFF-THREAD",
        useCases: ["Heavy analytics", "Ad tracking", "Non-critical 3rd party"],
      },
    };
    return strategies[strategy] || strategies.afterInteractive;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 3. SCRIPT LOADER
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function loadScript(config) {
    var id = config.id || config.src;
    var strategy = config.strategy || "afterInteractive";
    var src = config.src || null;
    var inline = config.inline || null;

    // Deduplication check!
    if (scripts[id] && scripts[id].status === "loaded") {
      stats.skipped++;
      return {
        success: true,
        action: "SKIPPED (already loaded!)",
        id: id,
      };
    }

    // Validate inline scripts need id!
    if (inline && !config.id) {
      return {
        success: false,
        error: "Inline scripts MUST have id prop!",
      };
    }

    // Validate beforeInteractive placement!
    if (
      strategy === "beforeInteractive" &&
      config.placement !== "root-layout"
    ) {
      return {
        success: false,
        error: "beforeInteractive MUST be in root layout!",
      };
    }

    // Resolve timing
    var resolved = resolveStrategy(strategy);

    // Simulate load
    var loadSuccess = Math.random() > 0.1; // 90% success rate
    var result = {
      id: id,
      src: src,
      inline: !!inline,
      strategy: strategy,
      resolved: resolved,
      status: loadSuccess ? "loaded" : "failed",
      injectedAt: resolved.injection,
      loadTime:
        strategy === "beforeInteractive"
          ? "0ms (SSR!)"
          : strategy === "lazyOnload"
            ? "idle+" + Math.floor(Math.random() * 2000) + "ms"
            : Math.floor(Math.random() * 500) + "ms",
    };

    scripts[id] = result;
    loadOrder.push(id);

    if (loadSuccess) {
      stats.loaded++;
      stats.byStrategy[strategy]++;

      // Fire onLoad
      if (resolved.onLoad && config.onLoad) {
        result.onLoadFired = true;
        config.onLoad();
      }

      // Fire onReady
      if (resolved.onReady && config.onReady) {
        result.onReadyFired = true;
        config.onReady();
      }
    } else {
      stats.failed++;

      // Fire onError
      if (resolved.onError && config.onError) {
        result.onErrorFired = true;
        config.onError(new Error("Failed to load: " + (src || id)));
      }
    }

    return result;
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 4. REMOUNT SIMULATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function simulateRemount(id) {
    var script = scripts[id];
    if (!script) return { error: "Script not found: " + id };

    var resolved = resolveStrategy(script.strategy);
    if (!resolved.onReady) {
      return {
        id: id,
        onReadyFired: false,
        reason: resolved.name + " does NOT support onReady!",
      };
    }

    return {
      id: id,
      onReadyFired: true,
      reason: "Component re-mounted! onReady fires again!",
      scenario: "User navigated away and came back!",
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 5. PLACEMENT VALIDATOR
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function validatePlacement(strategy, location) {
    var rules = {
      beforeInteractive: {
        validLocations: ["root-layout"],
        error: "beforeInteractive MUST be in app/layout.tsx (root layout)!",
      },
      afterInteractive: {
        validLocations: ["root-layout", "layout", "page"],
        error: null,
      },
      lazyOnload: {
        validLocations: ["root-layout", "layout", "page"],
        error: null,
      },
      worker: {
        validLocations: ["pages-directory"],
        error: "worker strategy only works in pages/ directory!",
      },
    };

    var rule = rules[strategy] || rules.afterInteractive;
    var valid = rule.validLocations.indexOf(location) !== -1;

    return {
      strategy: strategy,
      location: location,
      valid: valid,
      error: valid ? null : rule.error,
    };
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // 6. DEMO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function demo() {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
    console.log("â•‘   NEXT SCRIPT ENGINE DEMO             â•‘");
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");

    // Strategy comparison
    console.log("\nâ”€â”€ Strategy Comparison â”€â”€");
    var strats = [
      "beforeInteractive",
      "afterInteractive",
      "lazyOnload",
      "worker",
    ];
    for (var i = 0; i < strats.length; i++) {
      var s = resolveStrategy(strats[i]);
      console.log("  " + s.name + ":");
      console.log("    timing:", s.timing);
      console.log("    placement:", s.placement);
      console.log("    priority:", s.priority);
      console.log(
        "    onLoad:",
        s.onLoad,
        "onReady:",
        s.onReady,
        "onError:",
        s.onError,
      );
    }

    // Loading scripts
    console.log("\nâ”€â”€ Loading Scripts â”€â”€");
    var r1 = loadScript({
      src: "https://example.com/bot-detector.js",
      strategy: "beforeInteractive",
      placement: "root-layout",
      onReady: function () {
        console.log("    â†’ Bot detector ready!");
      },
    });
    console.log("  Bot detector:", r1.status, r1.loadTime);

    var r2 = loadScript({
      src: "https://example.com/analytics.js",
      strategy: "afterInteractive",
      onLoad: function () {
        console.log("    â†’ Analytics loaded!");
      },
    });
    console.log("  Analytics:", r2.status, r2.loadTime);

    var r3 = loadScript({
      src: "https://example.com/chat.js",
      strategy: "lazyOnload",
      onLoad: function () {
        console.log("    â†’ Chat loaded!");
      },
    });
    console.log("  Chat widget:", r3.status, r3.loadTime);

    // Inline script
    console.log("\nâ”€â”€ Inline Script â”€â”€");
    var r4 = loadScript({
      id: "gtm-init",
      inline: "dataLayer.push({'event': 'init'})",
      strategy: "afterInteractive",
    });
    console.log("  GTM init:", r4.status, "inline:", r4.inline);

    // Inline WITHOUT id (should fail!)
    var r5 = loadScript({
      inline: "console.log('no id!')",
    });
    console.log("  No-id inline:", r5.success ? "OK" : "ERROR: " + r5.error);

    // Deduplication
    console.log("\nâ”€â”€ Deduplication â”€â”€");
    var r6 = loadScript({
      src: "https://example.com/analytics.js",
      strategy: "afterInteractive",
    });
    console.log("  Analytics reload:", r6.action || r6.status);

    // Placement validation
    console.log("\nâ”€â”€ Placement Validation â”€â”€");
    var placements = [
      ["beforeInteractive", "page"],
      ["beforeInteractive", "root-layout"],
      ["afterInteractive", "page"],
      ["worker", "layout"],
      ["worker", "pages-directory"],
    ];
    for (var j = 0; j < placements.length; j++) {
      var v = validatePlacement(placements[j][0], placements[j][1]);
      console.log(
        "  " + v.strategy + " in " + v.location + ":",
        v.valid ? "âœ…" : "âŒ " + v.error,
      );
    }

    // Remount simulation
    console.log("\nâ”€â”€ Remount (onReady) â”€â”€");
    var rm1 = simulateRemount("https://example.com/analytics.js");
    console.log(
      "  Analytics remount:",
      rm1.onReadyFired ? "âœ… onReady fires!" : "âŒ " + rm1.reason,
    );

    // Stats
    console.log("\nâ”€â”€ Stats â”€â”€");
    console.log(
      "  Loaded:",
      stats.loaded,
      "Failed:",
      stats.failed,
      "Skipped:",
      stats.skipped,
    );
    console.log("  By strategy:", JSON.stringify(stats.byStrategy));
    console.log("  Load order:", JSON.stringify(loadOrder));
  }

  return { demo: demo };
})();
// Cháº¡y: NextScriptEngine.demo();
```

---

## Â§8. CÃ¢u Há»i Luyá»‡n Táº­p!

**CÃ¢u 1**: 4 strategies â€” má»—i cÃ¡i khÃ¡c nhau tháº¿ nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

```
beforeInteractive:
  â†’ Load TRÆ¯á»šC má»i code Next.js!
  â†’ Injected vÃ o HTML tá»« SERVER!
  â†’ LuÃ´n náº±m trong <head>!
  â†’ CHá»ˆ dÃ¹ng trong root layout (app/layout.tsx)!
  â†’ Use: Bot detectors, cookie consent, polyfills
  â†’ âŒ onLoad, âŒ onError
  â†’ âœ… onReady

afterInteractive (DEFAULT!):
  â†’ Load SAU khi hydration báº¯t Ä‘áº§u!
  â†’ Injected CLIENT-SIDE!
  â†’ DÃ¹ng á»Ÿ Báº¤T Ká»² page/layout nÃ o!
  â†’ Use: Tag managers, analytics, ad scripts
  â†’ âœ… onLoad, âœ… onReady, âœ… onError

lazyOnload:
  â†’ Load khi browser IDLE (ráº£nh)!
  â†’ Sau khi Táº¤T Cáº¢ resources Ä‘Ã£ load xong!
  â†’ Æ¯u tiÃªn THáº¤P nháº¥t!
  â†’ Use: Chat widgets, social media, feedback
  â†’ âœ… onLoad, âœ… onReady, âœ… onError

worker (EXPERIMENTAL!):
  â†’ Cháº¡y trong WEB WORKER riÃªng biá»‡t!
  â†’ Free up main thread hoÃ n toÃ n!
  â†’ DÃ¹ng Partytown library!
  â†’ CHá»ˆ hoáº¡t Ä‘á»™ng trong pages/ directory!
  â†’ âŒ onLoad, âŒ onReady, âŒ onError
```

</details>

---

**CÃ¢u 2**: `onLoad` vs `onReady` â€” khi nÃ o dÃ¹ng cÃ¡i nÃ o?

<details><summary>ÄÃ¡p Ã¡n</summary>

```
onLoad:
  â†’ Fires ONCE khi script load xong láº§n Ä‘áº§u!
  â†’ User navigate Ä‘i rá»“i quay láº¡i â†’ KHÃ”NG fire láº¡i!
  â†’ âŒ KhÃ´ng dÃ¹ng vá»›i beforeInteractive!
  â†’ Use: Initialize thÆ° viá»‡n (lodash, jQuery)
  â†’ Use: Setup SDK láº§n Ä‘áº§u (Stripe, Firebase)

onReady:
  â†’ Fires SAU khi load + Má»–I Láº¦N component re-mount!
  â†’ User navigate Ä‘i rá»“i quay láº¡i â†’ CÃ“ fire láº¡i! âœ…
  â†’ âœ… DÃ¹ng Ä‘Æ°á»£c vá»›i beforeInteractive!
  â†’ Use: Google Maps (re-init map má»—i láº§n!)
  â†’ Use: Chart.js (re-render chart má»—i láº§n!)
  â†’ Use: Báº¥t cá»© gÃ¬ cáº§n setup láº¡i khi component mount!

KEY INSIGHT:
  onLoad = setup má»™t láº§n rá»“i thÃ´i!
  onReady = setup Má»–I Láº¦N component xuáº¥t hiá»‡n!

  SPA navigation â†’ component unmount â†’ remount:
    onLoad: âŒ Ä‘Ã£ fire rá»“i, khÃ´ng fire láº¡i!
    onReady: âœ… component mount â†’ fire láº¡i!
```

</details>

---

**CÃ¢u 3**: Inline scripts â€” táº¡i sao Báº®T BUá»˜C pháº£i cÃ³ `id`?

<details><summary>ÄÃ¡p Ã¡n</summary>

```
WHY id IS REQUIRED:
  â†’ Next.js dÃ¹ng id Ä‘á»ƒ TRACKING inline scripts!
  â†’ Má»¥c Ä‘Ã­ch: DEDUPLICATION (trÃ¡nh cháº¡y nhiá»u láº§n!)

SCENARIO KHÃ”NG CÃ“ id:
  â‘  User visits /page-a â†’ inline script cháº¡y! âœ…
  â‘¡ User navigates to /page-b
  â‘¢ User navigates BACK to /page-a
  â‘£ Inline script cháº¡y Láº I! ğŸš« (duplicate!)
  â‘¤ Side effects bá»‹ duplicate! Data bá»‹ sai!

SCENARIO CÃ“ id:
  â‘  User visits /page-a â†’ inline script cháº¡y! âœ…
  â‘¡ Next.js ghi nháº­n: id="gtm-init" â†’ DONE!
  â‘¢ User navigates to /page-b
  â‘£ User navigates BACK to /page-a
  â‘¤ Next.js check: id="gtm-init" â†’ already ran! SKIP! âœ…

2 CÃCH VIáº¾T INLINE:
  â‘  Curly braces: <Script id="x">{`code here`}</Script>
  â‘¡ dangerouslySetInnerHTML: <Script id="x"
       dangerouslySetInnerHTML={{ __html: `code` }} />
```

</details>

---

**CÃ¢u 4**: Layout scripts vs application scripts â€” best practice?

<details><summary>ÄÃ¡p Ã¡n</summary>

```
LAYOUT SCRIPTS (per-route group):
  â†’ Äáº·t trong app/dashboard/layout.tsx
  â†’ CHá»ˆ load khi user vÃ o /dashboard/*
  â†’ Load ONCE, dÃ¹ navigate giá»¯a cÃ¡c sub-routes!
  â†’ KHÃ”NG load trÃªn cÃ¡c routes khÃ¡c (/about, /contact)

APPLICATION SCRIPTS (all routes):
  â†’ Äáº·t trong app/layout.tsx (ROOT!)
  â†’ Load trÃªn Má»ŒI route trong app!
  â†’ Load ONCE, persist qua má»i navigation!

BEST PRACTICE:
  âœ… Äáº·t script á»Ÿ page/layout Cá»¤ THá»‚ nháº¥t cÃ³ thá»ƒ!
  âŒ Äá»ªNG Ä‘áº·t táº¥t cáº£ vÃ o root layout!

  WHY:
  â†’ Analytics chá»‰ cáº§n trÃªn /dashboard? â†’ dashboard layout!
  â†’ Chat widget chá»‰ cáº§n trÃªn /support? â†’ support layout!
  â†’ Bot detector cáº§n everywhere? â†’ root layout!

  IMPACT:
  â†’ Má»—i script thÃªm = thÃªm download + parse + execute!
  â†’ Náº¿u Ä‘áº·t á»Ÿ root = Má»ŒI page Ä‘á»u bá»‹ áº£nh hÆ°á»Ÿng!
  â†’ Äáº·t cá»¥ thá»ƒ = chá»‰ routes cáº§n má»›i bá»‹ impact!

DEDUPLICATION:
  Next.js Ä‘áº£m báº£o má»—i script SRC chá»‰ load Má»˜T Láº¦N!
  Navigate forward/back â†’ script KHÃ”NG load láº¡i!
  â†’ Sá»­ dá»¥ng internal tracking per src/id!
```

</details>
